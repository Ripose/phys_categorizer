1
0
0
2
 
p
e
S
 
9
1
 
 
]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[
 
 
1
v
0
5
0
9
0
1
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Metric-tensor ﬂexible-cell algorithm for isothermal-isobaric molecular dynamics
simulations

E. Hern´andez∗
Institut de Ci`encia de Materials de Barcelona, ICMAB - CSIC,
Campus de Bellaterra, 08193 Bellaterra, Barcelona, Spain
(Dated: February 2, 2008)

An extended Hamiltonian approach to conduct isothermal-isobaric molecular dynamics simula-
tions with full cell ﬂexibility is presented. The components of the metric tensor are used as the
ﬁctitious degrees of freedom for the cell, thus avoiding the problem of spurious cell rotations and
artiﬁcial symmetry breaking eﬀects present in the original Parrinello-Rahman scheme. This is com-
plemented by the Nos´e-Poincar´e approach for isothermal sampling. The combination of these two
approaches leads to equations of motion that are Hamiltonian in structure, and which can therefore
be solved numerically using recently developed powerful symplectic integrators. One such inte-
grator, the generalised leap-frog, is employed to provide a numerical algorithm for integrating the
isothermal-isobaric equations of motion obtained.

I.

INTRODUCTION

Over the last few decades advances in techniques, mod-
els and computer power have made simulation meth-
ods1,2,3 an indispensable aid to research in condensed
matter, molecular physics and chemistry, and in mate-
rials science. By emulating the conditions under which
experiments are carried out and the interactions between
the components of the system as closely as possible, sim-
ulations can often provide information that is not directly
attainable from the experiments themselves, and can help
to interpret the empirical observations.

There are two large groups of simulation methods
that are capable of taking thermal eﬀects into account,
namely the Monte Carlo (MC) and the Molecular Dy-
namics (MD) methods. In this work it is the latter that
will be of interest. Conventional MD consists of numeri-
cally integrating the classical equations of motion for an
ensemble of atoms representative of the system of inter-
est. Assuming ergodicity, a suﬃciently long trajectory
will sample the whole of the accessible phase space un-
der the conditions of the simulation, and a time aver-
age over such a trajectory of any property of the sim-
ulated system will provide an estimate of the value of
that property in the real system under the same con-
ditions. The classical equations of motion conserve the
total energy, so this procedure simulates the system of
interest in the microcanonical (constant number of par-
ticles, N, constant volume, V, and constant energy, E,
or NVE) ensemble. However, experiments are most fre-
quently conducted under conditions of constant temper-
ature, and sometimes also constant pressure, conditions
which correspond to the canonical (NVT) or isothermal-
isobaric (NPT) ensembles respectively. It would there-
fore be desirable to have MD methods that were capable
of sampling these ensembles also. In a seminal paper, An-
dersen4 proposed two diﬀerent methods for conducting
MD simulations in the canonical and iso-shape isobaric-
isoenthalpic (NPH, where H is the enthalpy) ensembles,
methods which could be combined to perform simulations

sampling the isothermal-isobaric ensemble. Andersen’s
NVT MD method involved a series of stochastic colli-
sions which changed the velocity of a randomly chosen
atom in the system to one generated from a Maxwell-
Boltzmann distribution of velocities at the desired tem-
perature. Such a series of collisions changes the total en-
ergy of the system so that it ﬂuctuates around its equilib-
rium value as prescribed by the canonical ensemble. As
for the constant-pressure (isobaric-isoenthalpic or NPH)
ensemble, Andersen showed that it could be sampled by
incorporating the volume as a new degree of freedom in
the classical equations of motion, with a ﬁctitious mass
and velocity associated to it.

Andersen’s idea of extending the dynamics of a physi-
cal system by including ﬁctitious degrees of freedom has
proved to be extremely powerful. Andersen himself4 pos-
tulated that using this method it might be possible to
perform NVT dynamics in a non-stochastic fashion. In-
deed, such a method was put forward by Nos´e5,6, and
later modiﬁed by Hoover7. The same idea was to be used
by Parrinello and Rahman8,9 for ﬂexible-cell (as opposed
to iso-shape) constant-pressure MD, and by Car and Par-
rinello10, who combined in an ingenious way the classical
dynamics of ions with the ﬁctitious dynamics of the elec-
tronic orbitals expanded in a plane-wave basis set, within
a Density Functional Theory description of the electronic
structure. This was done in such a way that as the ions
moved, the electronic orbitals followed adiabatically, so
that the system remained in the ground state, or suﬃ-
ciently close to it, allowing Car and Parrinello to carry
out ab initio MD for the ﬁrst time.

Although the extended dynamics approach has proved
very useful for sampling ensembles beyond the micro-
canonical one, over time a number of shortcommings have
been detected, both with the Nos´e-Hoover method for
NVT sampling and the Parrinello-Rahman method for
NPH simulations. The method originally proposed by
Nos´e involved a time transformation, as a result of which
the phase space is not sampled at regular time inter-
vals. While this in itself does not pose a problem for
the calculation of thermal averages of time-independent

quantities, it severely complicates the calculation of time-
correlation functions.
It is possible to transform the
equations of motion back to real time6,7 using a non-
canonical11 transformation, but then the Hamiltonian
structure is lost, i.e. the equations that result cannot be
derived from a Hamiltonian. Although the lack of Hamil-
tonian structure in the Nos´e-Hoover equations poses no
practical diﬃculties (both iterative2 and explicit12 inte-
grators can be derived for these equations), it is unde-
sirable from a formal point of view, not least because
the usual machinery of statistical mechanics is not di-
rectly applicable to non-Hamiltonian systems (see the
recent work of Tuckerman and coworkers13,14 concern-
ing this point). Recently, Bond, Leimkuhler and Laird15
have shown that it is possible to obtain NVT sampling
(subject to the usual assumption of ergodicity) starting
from Nos´e’s original Hamiltonian, but acted upon by a
Poincar´e transformation. The transformation is canoni-
cal, and therefore preserves the form of the equations of
motion; thus, all the recent developments in integration
schemes for Hamiltonian systems16 (see below) can be
used to solve numerically the resulting equations of mo-
tion. Furthermore, the Poincar´e transformation is cho-
sen in such a way that the sampling of the phase space
takes place at regular time intervals. Thus, the scheme of
Bond et al.15 overcomes the negative aspects associated
with the Nos´e-Hoover method.

Concerning the constant-pressure schemes, Parrinello
and Rahman formulated their method taking as extended
variables the Cartesian components of the simulation cell
vectors, and constructing a ﬁctitious kinetic energy term
from their squared velocities. As noted by Cleveland17
and by Wentzcovitch18, this choice leads to equations of
motion that are not invariant under transformations be-
tween equivalent cells (modular transformations), leading
to unphysical symmetry breaking eﬀects. An added diﬃ-
culty is that the ﬁctitious dynamics based on this choice
of variables results in spurious cell rotations, which com-
plicate the analysis of the results. Numerous proposals
to overcome these diﬃculties have appeared in the liter-
ature17,18,19,20,21,22, but here I am going to focus on the
method proposed by Souza and Martins22, which uses as
ﬁctitious dynamical variables the components of the cell
metric tensor. The metric tensor is independent of the
cell orientation, and by phrasing the dynamics in terms
of it, spurious cell rotations simply do not appear. Fur-
thermore, the ﬁctitious kinetic energy associated with the
metric tensor can easily be constructed such that it is in-
variant with respect to modular transformations.

Important advances have also been achieved in the un-
derstanding and design of integrators for dynamical sys-
tems12,16. Classical Hamiltonian dynamics is time re-
versible (if the Hamiltonian is an even function of the
momenta) and symplectic, i.e.
it preserves the sum of
dqi, the area
areas spanned by the vector products dpi ×
element around the point (pi, qi). It is desirable that nu-
merical integrators for Hamiltonian equations of motion
respect the symmetries underlying Hamiltonian dynam-

2

ics, such as time reversibility and symplecticness, as then
one can be more conﬁdent that the discrete-time solution
will resemble more closely the exact solution. Thus con-
siderable eﬀorts have been devoted to the development
of integrators which comply with these requirements, and
modern simulation techniques should take advantage of
the progress achieved in this ﬁeld.

Constant-pressure algorithms such as the method of
Parrinello-Rahman and its variants sample the isobaric-
isoenthalpic ensemble. However, this ensemble is not
very common, nor indeed is it very convenient. In many
circumstances it is desirable to have control over the av-
erage temperature, and it is therefore preferable to per-
form a simulation which samples the isothermal-isobaric
ensemble. This can be achieved by combining one of
the constant-pressure algorithms with a Nos´e-type ther-
mostat. The purpose of this paper is to describe how
the metric-tensor based scheme of Souza and Martins22
for constant-pressure simulations can be combined with
the Nos´e-Poincar´e scheme of Bond et al.15 to provide an
extended Hamiltonian for isothermal-isobaric MD sim-
ulations with full-cell ﬂexibility, incorporating the ad-
vantages of both methods over the original schemes of
Nos´e-Hoover and Parrinello-Rahman. Similar schemes
have been recently presented by Sergi et al.23 and by
Sturgeon and Laird24, but only in the case of isotropic
cell ﬂuctuations. It is shown how the equations of mo-
tion that result in the present scheme can be integrated
numerically using the generalised leap-frog method25,26,
leading to a symplectic, highly stable algorithm. This
NPT MD algorithm is then illustrated with a series of
realistic test cases, namely NPT simulations of diamond
and crystalline silicon.

The structure of the paper is as follows: in section II
the necessary background on the metric-tensor constant-
pressure and Nos´e-Poincar´e isothermal formalisms is re-
viewed, both schemes are then combined, and a recipe for
integrating the resulting equations of motion numerically
is provided. The methodology is then applied to the test
cases in section III, and the conclusions are summarized
in section IV.

II. METHODOLOGY

Classical Lagrangian and Hamiltonian mechanics27
provide elegant theoretical frameworks in which to set
up equations of motion for the system under study, using
the variables or coordinates most convenient in each situ-
ation. The generalized leap-frog integration scheme that
will be used below is most readily applied to Hamiltonian
equations, and therefore the Hamiltonian formulation of
classical mechanics will be used in what follows, although
the Lagrangian treatment is of course totally equivalent.
When considering a system in which both the volume
and shape of the simulation cell are allowed to evolve
in time, it is helpful to take into account the covari-
ant/contravariant character of the dynamical variables.

Therefore, in the following, the covariant or contravari-
ant character of the diﬀerent variables that will be used
shall be indicated by means of a subindex or superindex,
respectively.

Let us now review the set of dynamical variables which
will be used to specify the state of the system. Firstly,
it will be most convenient to use lattice coordinates, qi,
which give the position of atom i relative to the simula-
tion cell. The dynamics of atoms is then fully accounted
for by considering the momenta pi, conjugate to qi. Lat-
tice coordinates are related to the usual Cartesian ones,
ri, through

ri = Hqi,

×

where H is a 3
3 matrix formed by the simulation cell
vectors aα, (α = 1, 2, 3) in columns. Since the cell vectors
aα are linearly independent, matrix H can be inverted,
and its inverse, H−1, has row α equal to bα, the recipro-
cal vector of aα in the following sense:

bβ = δβ
α.

aα ·

(2)

(3)

(4)

The calculation of interatomic distances when atom posi-
tions are speciﬁed in terms of lattice coordinates is given
by:

rij =

(qi

qj) G (qi

qj),

−

−

where G is the metric tensor, with elements

p

Gαβ = aα ·

aβ.

The volume of the simulation cell is also given by the
metric tensor as Vcell = √det G. The set of vectors bα
also deﬁne a metric tensor, Gαβ, which is reciprocal to
the previous one.

Souza and Martins22 have shown that the metric ten-
sor constitutes a very convenient dynamical variable for
constant-pressure MD simulations. Firstly, G is invari-
ant under cell rotations; the orientation of the cell is ir-
relevant, and thus spurious cell rotations do not appear
during the dynamics. Secondly, it is easy to set up a
ﬁctitious kinetic energy term associated with the met-
ric tensor (see below) which is invariant under modular
transformations18 (i.e. transformations between the dif-
ferent possible cells compatible with the periodicity of
the system). This avoids artiﬁcial symmetry breaking ef-
fects. Thus, spurious cell rotations and symmetry break-
ing eﬀects, which appeared in the original Parrinello-
Rahman8,9 constant-pressure algorithm, are naturally
avoided in this formalism. Following Souza and Mar-
tins, each metric tensor component Gαβ has a conjugate
momentum P αβ, and the ﬁctitious kinetic energy term
associated to the dynamics of the metric tensor is

KG =

P α

β P β
α
2MG det G

,

(5)

where the sum over repeated indices is implied. Here
MG is a ﬁctitious mass, but the total eﬀective mass is

MG det G, which varies with the cell volume. While it
would be possible to use a constant ﬁctitious mass, this
form has the particularity of reducing the kinetic energy
expression in Eq. (5) to the same form as in Ander-
sen’s constant-pressure scheme in the case of iso-shape
cell ﬂuctuations.

In the case of hydrostatic external pressure, the po-
tential energy term associated to the metric dynamics is
simply

UG =

Pext Vcell =

Pext√det G.

(1)

Souza and Martins went on to show that the case of an
anisotropic external stress can also be contemplated, if a
potential energy term of the form

3

(6)

(7)

UG =

1
2

σβα
ext Gαβ

is included, where σβα
stress in contravariant lattice coordinates.

ext are the components of the external

The combined dynamics of atoms and metric tensor de-
scribed so far conserves the enthalpy (the generalized en-
thalpy of Thurston28, in the case of constant anisotropic
external stress), and samples the isobaric-isoenthalpic
It is therefore desirable to combine
(NPH) ensemble.
the dynamics of the extended system of atoms and met-
ric tensor with a device that enables sampling of the
isobaric-isothermal (NPT) ensemble. Souza and Martins
used stochastic Langevin dynamics in the examples re-
ported in their work. A diﬀerent strategy will be pursued
here, which consists of coupling the dynamics of atoms
and metric tensor with a Nos´e thermostat, as described
in what follows.

Canonical (NVT) MD simulations have been usu-
ally undertaken by means of the so called Nos´e-Hoover
method. Recently, however, Bond et al.15 have provided
an alternative scheme, which also samples the NVT en-
semble, but has the additional advantage of being Hamil-
tonian in structure, thereby permitting the use of sym-
plectic numerical integrators. This is achieved by per-
forming a Poincar´e transformation on the original Nos´e
Hamiltonian, HNos´e, which results in

HNos´e-Poincar´e = S(HNos´e

H0),

(8)

−

where H0 is a suitably chosen constant, and HNos´e is
given by (in Cartesian coordinates)

HNos´e =

i
X

p2
i
2 mi S2 +

U

P 2
S
2MS

(r) +

+ g kB Text ln S. (9)

Here S is the position variable of the thermostat, a
strictly positive quantity, PS its conjugate momentum,
g is the number of degrees of freedom of the physical
system (i.e.
excluding extended or ﬁctitious dynami-
cal variables), kB is Boltzmann’s constant, and Text is
the temperature of the thermostat. Bond and coworkers
have demonstrated that, under the assumption of ergod-
icity, the Nos´e-Poincar´e Hamiltonian generates dynamics

that sample the canonical ensemble, as desired. Recently,
Sturgeon and Laird24 have extended the Nos´e-Poincar´e
Hamiltonian with an Andersen barostat, which imple-
ments iso-shape cell ﬂuctuations, thereby sampling the
isothermal-isobaric (NPT) ensemble appropriate for non-
crystalline systems. For crystalline solids, however, it is
necessary to allow ﬂuctuations of the cell shape as well as
of its volume, which can be done by means of the metric
tensor dynamics described above. The scheme presented
here can therefore be regarded as a generalization of the
method reported by Sturgeon and Laird to full-cell dy-
namics NPT MD simulations.

By combining the Nos´e-Poincar´e Hamiltonian [Eq. (8)]
of Bond and coworkers15 with the metric tensor constant-
pressure scheme of Souza and Martins22, one arrives at
the following Hamiltonian:

HNPT = S

"

i
X

piα pα
i
2 mi S2 +

U

(q, G) +

P α

β P β
α
2MG det G

+

σβα
ext Gαβ +(10)

1
2

Pext √det G +
P 2
S
2MS

+ g kBText ln S

H0

.

−

(cid:21)

4

In this equation, lower case labels p and q refer to atomic
momenta and position variables of the physical system
of interest, while labels in upper case refer to ﬁctitious
degrees of freedom (thermostat or barostat). Latin in-
dices label atoms, always appear ﬁrst and are always
used as subindices, while Greek indices label compo-
nents of tensors, and if used as subindices appear after
the atom label. Sums over atoms, as in the atomic ki-
netic energy term, are written out explicitly; otherwise
the summation over repeated indices of tensorial quan-
tities is implied. Thus, piα is the covariant α compo-
nent of the momentum of atom i, while P α
β is the mixed
(contravariant-covariant) component of the second-rank
tensor Pαβ formed by the momenta associated to the
components of the metric tensor G. The constant H0
is to be chosen so that HNPT has a value of zero.

Using the standard rules of Classical Mechanics27, and
with the help of the relations ∂ det G/∂Gαβ = Gβα det G
and ∂Gλµ/∂Gαβ =
GλαGβµ, it is straight forward to
−
obtain the following equations of motion:

˙qα
i =

˙piα =

˙Gαβ = S

˙P αβ =

−

S

pα
i
mi S
∂
U
∂qα
i
Pαβ
MG det G
∂

S

−

"

U
∂Gαβ −

˙S = S

PS
MS

˙PS =

i
X

piα pα
i
mi S2 −

g kBText −

∆H

i pβ
pα
2 mi S2 +

i

P βλ Gλµ P µα
MG det G

i
X

1
2 Pext √det G

−

+

 

P λ

µ P µ
2 MG det G !

λ

Gβα +

1
2

σβα
ext

#

(11a)

(11b)

(11c)

(11d)

(11e)

(11f)

where the dot indicates a time derivative, and
µ P µ
2 MG det G

piα pα
i
2 mi S2 +

(q, G) +

∆H =

P λ

U

λ

i
X

+

Pext √det G +

σβα
extGαβ +

1
2
g kBText ln S

H0.

−

(12)

Let us now turn to the question of how to obtain a
numerical scheme to integrate these equations of motion.
Of the diﬀerent schemes that are possible, I have cho-

sen to use the generalized leap-frog scheme (GLF)25,26,
which is simple, and since the system is Hamiltonian16,
the numerical procedure that results from applying the
GLF to Eqs. (11f) is symplectic and time-reversible15,24.
Let us brieﬂy recall how the GLF works: let Q, P repre-
sent position and momentum variables respectively. The
Eqs. (11f) can be generally put in the form

˙Q = G(P, Q),
˙P = F (P, Q).

(13)

(14)

The GLF scheme consists of ﬁrst propagating the mo-
mentum variables half a time-step forward from the ini-
tial point in phase space:

P (t + 1/2 δt) = P (t) +

δt F [P (t + 1/2 δt), Q(t)]/2,

(15)

where δt is the time step. Note that the new momenta ap-
pear on both sides of the equation, which can lead (and
in general, does lead) to implicit equations for the up-
dated momentum variables. Next, the position variables
are updated a full time-step:

Q(t + δt) = Q(t) +

δt

G[P (t + 1/2 δt), Q(t)]+
{
G[P (t + 1/2 δt), Q(t + δt)]
}

/2.

(16)

Again, due to the fact that Q(t + δt) appears on both
sides, in the general case one obtains an implicit equation,
like for the momentum variables at half step. Once Q(t+
δt) has been obtained, new forces can be calculated, and
thus it is possible to bring up the momenta to full step:

P (t + δt) = P (t + 1/2 δt) +

δt F [P (t + 1/2 δt), Q(t + δt)]/2.

(17)

The scheme can then be iterated by setting t = t + δt
and returning to Eq. (15).

Applying the GLF to the NPT equations of mo-

tion (11f) leads to the following numerical scheme:

1
2

1
2

1
2

piα,1/2 = piα,0

δt S0

−

∂
U
∂qα
i,0

∂

1/2 = P αβ
P αβ

0 −

δt S0

U
∂Gαβ,0 −

"

i,1/2 pβ
pα
2 mi S2
0

i,1/2

det G0

−

+

1/2

1/2 Gλµ,0 P µα
P βλ
MG det G0
µ,1/2 P µ
P λ
2 MG det G0 !

λ,1/2

i
X

1
2 Pext

+

 

Gβα

0 +

σβα
ext

1
2

#

PS,1/2 = PS,0 +

δt

i,1/2

piα,1/2 pα
mi S2
0

p
g kBText −
∆H(q0, G0, S0, p1/2, PG,1/2, PS,1/2)

−

"

i
X

S1 = S0 +

δt

S0

+ S1

1
2

PS,1/2
MS

PS,1/2
MS (cid:19)
1/2 Gµα,0

Gβλ,0 P λµ

Gαβ,1 = Gαβ,0 +

(cid:3)

+ S1

Gβλ,1 P λµ

1/2 Gµα,1
MG det G1 !

(cid:18)
1
2

δt

(cid:18)
1
2

δt

S0

 
pα
i,1/2
mi S0

"

i
X

MG det G0

+

pα
i,1/2
mi S1 (cid:19)
piα,1/2 pα
mi S2
1

i,1/2

i,1 = qα
qα

i,0 +

1
2

δt

PS,1 = PS,1/2 +

g kBText −
∆H(q1, G1, S1, p1/2, PG,1/2, PS,1/2)

−

i,1/2 pβ
pα
2 mi S2
1

i,1/2

det G1

−

p

+

1/2 Gλµ,1 P µα
P βλ
(cid:3)
1/2
MG det G1
µ,1/2 P µ
P λ
2 MG det G1 !

λ,1/2

i
X

1
2 Pext

+

 

Gβα

1 +

σβα
ext

1
2

#

1 = P αβ
P αβ

1/2 −

1
2

∂

δt S1

U
∂Gαβ,1 −

"

piα,1 = piα,1/2 −

δt S1

1
2

∂
U
∂qα
i,1

In these equations, subindices of 0, 1/2 and 1 indi-
cate that the corresponding dynamical variable should

be taken at zero, half or full time step from the initial
point in phase space. Eqs. (18ia-c) propagate the mo-

5

(18a)

(18b)

(18c)

(18d)

(18e)

(18f)

(18g)

(18h)

(18i)

0

menta forward in time by half a time step; Eqs. (18id-f)
advance the position variables the whole length of the
time step, and ﬁnally Eqs. (18ig-i) complete the updat-
ing of the momenta to full time-step. The order in which
Eqs. (18i) are written corresponds to the order in which
they must be implemented in a computer code. Note
that, as indicated above, some of the equations are im-
plicit. In particular, Eq. (18ib) is implicit in the metric
tensor momenta at half time step, and must be solved
iteratively. This is also the case for the metric tensor
components themselves, in Eq. (18ie). Two strategies
can be adopted for solving these equations: a Newton-
Raphson29 procedure can be easily applied, but a simple
iterative scheme seems to work equally well and is even
simpler to program. In the example applications reported
below, the iterative scheme was used. This consisted of
using as initial guess for the half-step metric-tensor mo-
menta in Eq. (18ib) (P αβ
1/2) their values at the start of the
molecular dynamics time step (i.e. P αβ
). The resulting
values for P αβ
1/2 are then fed again into Eq. (18ib), thus
obtaining a new estimate for the correct values at half-
step. This procedure is iterated until the absolute values
of the diﬀerences of P αβ
1/2 found in two successive itera-
tions of the procedure diﬀer by less than 10−7. Since, for
a suﬃciently small time step, the values of P αβ
are close
to those of P αβ
1/2, this procedure converges very rapidly,
requiring only a few iterations. Exactly the same pro-
It should
cedure was followed for solving Eq. (18ie).
be emphasized that the implicit nature of Eqs. (18ib)
and (18ie) does not have any signiﬁcant impact on per-
formance; the iterative procedure is very fast, and does
not require re-evaluation of the energy, force or stress;
however, because of the fact that a convergence criterion
must be used, the exact time-reversibility of the equa-
tions of motion [Eqs. (11f)] is lost in the numerical scheme
of Eqs. (18i). Nevertheless, the use of a strict convergence
criterion makes the scheme time-reversible within numer-
ical accuracy. Equation (18ic) also deserves attention; it
is quadratic in PS,1/2, and care must be taken to choose
the right root and avoid numerical cancellation errors15.
Equations (18i) are quite simple to incorporate into
existing MD codes. The only additional information re-
quired from what is conventionally computed in an MD
program are the derivatives of the potential energy with
. These
respect to the metric tensor components,
can be obtained taking into account that inter atomic
distances depend on the components of the metric ten-
sor, as indicated in Eq. (3). However, if the program al-
ready computes the derivatives ∂U
, where ελµ are the
∂ελµ
components of the Cartesian strain tensor, this informa-
tion can be converted into the required derivatives in a
straight forward fashion, as the strain and metric tensors
are related through9

∂U
∂Gαβ

0

ε =

(H−1

0 )T G H−1

0 −

1
2

(cid:2)

1

,

(cid:3)

(19)

6

where H−1
is the inverse of the undistorted cell matrix,
0
and 1 is the unit matrix. Then, by simple application of
the chain rule, one obtains the following relation:

∂
U
∂Gαβ

=

(H

−1
0 )αλ

1
2

∂
U
∂ελµ

(H

−1
0 )T

µβ ,

(20)

where again summation over repeated indices is implied.

III. APPLICATIONS

The metric tensor Nos´e-Poincar´e NPT method de-
scribed in section II has been implemented in a computer
program which performs MD simulations of systems de-
scribed with a Tight Binding30 (TB) total energy model.
In this section, after a brief description of the model used,
I will report the results of tests of the methodology and
some examples of applications directed at demonstrating
its usefulness.

A. Model

The NPT algorithm described in this paper applies
equally well to any atomistic model from which forces
and stresses, as well as the total energy, can be obtained,
and therefore any such models can be used in conjunction
with it. Atomistic models can be broadly classiﬁed into
three groups, namely empirical potential methods, semi-
empirical total energy methods and ﬁrst principles or ab
initio total energy methods. Each group of methods has
its strengths and weaknesses; for example, empirical po-
tential methods are computationally cheap, but ad hoc
in nature, and therefore of limited reliability and trans-
ferability. First principles methods, on the other hand,
rest on ﬁrm theoretical grounds, but are orders of mag-
nitude more demanding computationally than empirical
potentials. Added diﬃculties here are the bad scaling
of the computational cost with the size of the system
under study (usually, for electronic structure methods
the cost scales as N 3 or worse, where N is the number
of atoms, although considerable progress towards linear-
scaling methods31,32 has been achieved in recent years),
and, of speciﬁc relevance to constant-pressure simula-
tions, the accuracy of the total energy and its deriva-
tives depends on the volume of the simulation cell, unless
highly converged integrations over the irreducible cell of
the reciprocal lattice are used33.

In the applications that follow, I have chosen to use an
approximate Tight Binding (TB) model30, which corre-
sponds to the group of semi-empirical methods discussed
above. This choice is motivated by several considera-
tions. Being in between the extremes of empirical poten-
tials and ﬁrst principles methods, it shares some of the
advantages (but also some of the disadvantages) of both.
Its computational demands are very modest; it is based
on a quantum treatment of the valence electrons, even

)
e
e
r
t
r
a
h
(
 
>
E
<
−
E

 

 

0.60

0.40

0.20

0.00

−0.20

−0.40

−0.60

0

7

(barostat energy) x100
thermostat energy
physical energy
total energy

0.002

0.001

0

−0.001

)
e
e
r
t
r
a
h
(
 
>
T
P
N
H
<
−
T
P
N
H

 

 

0.1

0.2

0.3

0.4

0.5

time (ps)

FIG. 1: Contributions to the conserved quantity HNPT
[Eq. (11)] for a carbon system in the diamond structure (54-
atom cell) as a function of time. The curve labeled physical
energy is the energy of the atomic sub-system (kinetic plus
potential energy).

if at a rather simpliﬁed level, and therefore it incorpo-
rates the essential features of the quantum nature of the
chemical bond.
In spite of their simplicity, there exist
TB models which are capable of surprising accuracy in
their predictions. In particular, the applications reported
below have been carried out using a TB model due to
Porezag and coworkers34.
It goes beyond conventional
TB models in that it incorporates the non-orthogonality
of the basis set, which is usually assumed to be orthogo-
nal, is constructed on the basis of Density Functional cal-
culations employing the same basis set, and the range of
the hopping integrals extends beyond the nearest neigh-
bor distance, which is the range used in most TB models.
Additional details on this model can be found in the pa-
per by Porezag et al.34.

B. Diamond

To illustrate the stability and accuracy of the integra-
tion scheme embodied in Eqs. (18ia-i), a simulation of di-
amond at 0 GPa external pressure and a temperature of
1000 K was performed. This is well below the Debye tem-
perature of diamond (2340 K), and therefore it is strictly
speaking not justiﬁed to perform a classical MD simula-
tion at this temperature. Nevertheless the aim here is to
test the methodology, and not to extract any conclusions
on the physics of diamond at 1000 K. The starting con-
ﬁguration of the system consisted of 54 atoms at their
equilibrium positions in a cell of edge length 14.33 bohr
(7.58 ˚A), with the edges forming 60o angles. Initial veloc-

−0.002

0

2

4
6
time (ps)

8

10

FIG. 2: HNPT [Eq. (11)] as a function of time for the diamond
system.

ities were chosen randomly from the Maxwell-Boltzmann
distribution at the desired temperature, and modiﬁed to
eliminate any translation of the center of mass. The ﬁcti-
tious mass of the Nos´e thermostat was chosen to be equal
to the mass of a carbon atom, while for the barostat
a mass of 10 au was used. Both thermostat and baro-
stat were assigned zero initial momenta, and the value of
HNPT at zero time ﬁxes the value of H0.

U

The total energy of the system [

(q, G) in Eq. (11)]
was calculated using the TB model of Porezag and
coworkers34 described above. The generalized eigenvalue
equation that results for each system conﬁguration ac-
cording to this model was solved using direct diagonal-
isation, and a set of 4 reciprocal lattice vectors chosen
according to the Monkhorst-Pack scheme35 were used,
which were suﬃcient to converge the total energy better
than 0.04 meV/atom. The length of the time step was
set to 1 fs, and the simulation was run for a total of 10 ps.
In Fig. (1) the diﬀerent terms contributing to HNPT
[Eq. (11)] have been plotted as a function of time for
the ﬁrst 0.5 ps of the simulation. The physical energy is
the sum of the kinetic and potential energy terms, cal-
(q, G), re-
culated from the atomic momenta and from
spectively. The thermostat and barostat contributions
include both the kinetic and potential energy terms as-
sociated to each of these ﬁctitious degrees of freedom
(the barostat energy has been scaled by a factor of 100
so that it can be appreciated on the graph). Note that,
as expected, the total energy of the atoms (their kinetic
plus potential energy, the physical energy), is not con-
served, contrary to what would happen in a conventional
microcanonical (NVE) MD simulation.
In the present
case, it is HNPT that is the conserved quantity, and as
can be seen from Fig. (1), this is indeed approximately
conserved by the numerical scheme of Eqs. (18ia-i). To
judge how well HNPT is conserved during the dynamics,

U

8

|a|
|b|
|c|

14.6

)
r
h
o
b
(
 
s
i
x
a

 
l
l
e
c

14.5

14.4

α
β
γ

60.4

)
s
e
e
r
g
e
d
(
 
s
e
l
g
n
a

 
l
l
e
c

60.2

60.0

59.8

14.3

0

1

4

5

59.6

0

1

3
2
time (ps)

3
2
time (ps)

4

5

FIG. 3: Cell vector lengths as a function of time for the 54-
atom diamond cell.

FIG. 4: Cell angles as a function of time for the 54-atom
diamond cell.

it has been plotted in Fig. (2) for the whole length of the
simulation. Except at the very ﬁrst stages of the calcu-
lation, the deviations of HNPT from its mean value are
smaller than 0.0005 hartree, and its standard deviation
has been computed to be 0.00015 hartree. No drift is ob-
served during the trajectory; simulations of up to 50 ps
(see below) were also carried out, and again, no appre-
ciable drift was observed, testifying to the stability of the
method.

Figs. (3) and (4) illustrate the time evolution of the
super-cell edge lengths and angles during the ﬁrst 5 ps
of the simulation, respectively. The edges start at time
zero having equal lengths, corresponding to that of a 54-
atom cell at 0 K, but as the simulation proceeds each
cell parameter evolves separately. Note how the average
values of the moduli of the cell vectors settle at a higher
value than the 0 K one, namely at 14.41 bohr (obtained
by averaging over the whole length of the simulation).
This is due to the thermal expansion of diamond from
0 to 1000 K, though it should be emphasized that one
must not expect an accurate estimation of the thermal
expansion in this case, partly because of the complete
neglect of quantum eﬀects, which, as indicated above,
are important below the Debye temperature. The cell
angles also evolve independently shortly after the start
of the simulation, but contrary to what happens with
the cell vector moduli, which evolve to a diﬀerent mean
value, the cell angles oscillate around their initial value
of 60o, with their instantaneous values remaining within
0.4o, indicating that, although the cell expands due to
±
the thermal motion of the atoms at 1000 K, it does not
change its shape.

Fig. (5) illustrates the time evolution of the cell vol-
ume and the internal pressure during the ﬁrst 5 ps of
the simulation. As expected, these two magnitudes dis-

2160

2140

2120

2100

)
3
^
r
h
o
b
(
 
e
m
u
l
o
v

play opposite behavior, in the sense that when the vol-
ume is lowest, the internal pressure is highest, and vice
versa. Like the cell vector moduli [Fig. (3)], the volume
expands from the 0 K value to a slightly larger value ap-
propriate to the temperature of the simulation, around
which its value oscillates. The internal pressure, on the
other hand, oscillates around 0 GPa, the value ﬁxed for
the external pressure in this simulation. At the end of
the trajectory, the thermal averages of the internal pres-
sure and the temperature of the system were computed to
be 0.2 GPa and 999.7 K respectively, in good agreement
with the imposed external values.

volume
pressure

20

10

0

)
a
P
G

(
 
e
r
u
s
s
e
r
p

2080

0

1

4

−10

5

2
3
time (ps)

FIG. 5: Cell volume (left ordinate axis) and internal pressure
(right ordinate axis) for the 54-atom diamond cell.

)

m
o
r
t
s
g
n
A

(
 
r
e
t
e
m
a
r
a
p
 
l
l
e
c

5.6

5.58

5.56

5.54

5.52

600 700 800 900 1000 1100 1200 1300 1400 1500 1600 1700
temperature (K)

FIG. 6: Silicon cell parameter as a function of temperature
obtained from NPT MD simulations at 0 GPa external pres-
sure and a series of temperatures.

C. Thermal expansion of silicon

Silicon has a smaller Debye temperature than dia-
mond, c.a. 640 K, and I will therefore use classical MD
to study its thermal expansion above this temperature.
A series of NPT simulations at 0 GPa external pressure
and diﬀerent temperatures have been carried out. The
total length of the simulation was 50 ps, using a time
step of 1 fs. The external temperature of the simulation
was varied in steps of 50 K between 700 and 1600 K, and
at each such temperatures a simulation was conducted.
In all of them the value of HNPT was accurately con-
served, and no appreciable drift in its value was observed.
The variation of the silicon cell parameter with tempera-
ture is illustrated in Fig. (6). Qualitatively, two approx-
imately linear behaviors can be observed, between 700
and 1150 K, and from 1150 to 1600 K, with the second
range of temperatures having a slightly lower slope. As
can be seen, the behavior is not very smooth, indicating
that there is still a degree of statistical noise in the ther-
mal averages of the cell parameter computed from these
I will dwell on the possible causes of this
simulations.
below.

In principle, from the data shown in Fig. (6) it would
be possible to calculate the thermal expansion coeﬃcient,
α, of silicon in the range of temperatures considered, but
the statistical inaccuracies present in the data make this
a diﬃcult task. The experimental value at 1000 K is
−1, while from the data in the ﬁgure
αexp = 4.3
−1 at
one can estimate a value of αcalc = 8.1
this temperature. The thermal expansion coeﬃcient is
extremely sensitive, and given the statistical uncertain-
ties present in the results, the calculated value can only
be considered a rather crude estimate of the value pre-

10−6K

10−6K

×

×

9

dicted by the TB model used; a more accurate estimate
could be closer to the experimental value.

It is instructive to consider the possible causes of the
poor statistics observed in Fig. (6).
It is certainly not
due to inadequate conservation of HNPT, which is suﬃ-
ciently well conserved throughout all the simulations. A
more likely explanation is that the dynamics generated
is not sampling the NPT ensemble with suﬃcient eﬃ-
ciency. Ineﬃcient sampling can occur because some de-
grees of freedom do not easily exchange energy with the
rest of the system, a situation which takes place when
there are largely diﬀerent frequencies present. Fig. (5)
lends some weight to this consideration. There it can
be seen that the volume is oscillating quasi-harmonically
with a single dominant frequency. The internal pressure,
however, has two dominant frequencies: a high one, re-
ﬂecting the thermal vibrations of the atoms, and a lower
one, with the same frequency as the volume. Sampling
eﬃciency could be increased by reducing the diﬀerence
between the high frequency oscillations in the internal
pressure and the frequency of the volume motion, which
can be achieved using a lower barostat ﬁctitious mass. It
should be pointed out that, formally at least, the NPT
ensemble is sampled independently of the values used for
the masses of the ﬁctitious degrees of freedom, provided
the dynamics is ergodic. The sampling eﬃciency, how-
ever, does depend on the values chosen, and therefore
this choice must be made with care.

D. Silicon under uniaxial external stress

In this ﬁnal example, the capability of the method to
cope with the simulation of systems subjected to non-
hydrostatic external pressures will be illustrated. Again,
a 64 atom silicon supercell in the diamond structure was
used as test case. The external temperature was ﬁxed
at 1000 K, and a series of simulations were performed
applying an external stress in the [100] direction, varying
from -5 to 5 GPa in steps of 1 GPa. In the sign convention
used here a positive sign indicates a compressive pressure.

In Fig. (7) the variation of the cell axis as a function of
the applied stress is shown. The supercell length in the
direction of the applied stress has a negative slope, and it
starts at an expanded value, larger than the equilibrium
value at the same temperature and zero stress, reaching
a value below this when the applied stress is compres-
sive. The other two cell lengths have positive, though
smaller, slopes, expanding as the ﬁrst dimension is com-
pressed. Both
show nearly identical behavior,
as expected, given the symmetry of the system. This ﬁg-
ure illustrates how the elastic constants of materials (in
this case the Poisson ratio) could be evaluated at ﬁnite
temperatures using this methodology.

b
|
|

c
|
|

and

21.75

)
r
h
o
b
(
 
s
i
x
a
 
l
l
e
c

21.25

20.75

|a|
|b|
|c|

IV. CONCLUSIONS

10

In this paper I have presented a stable, symplectic
algorithm for integrating the Hamiltonian equations of
motion resulting from the combination of the Souza and
Martins22 metric tensor-based constant-pressure scheme
and the Nos´e-Poincar´e thermostat scheme of Bond and
coworkers15. The dynamics generated by these equa-
tions samples the isothermal-isobaric (NPT) ensemble
with full-cell ﬂexibility. Conditions of non-hydrostatic
external pressure can also be simulated. The numeri-
cal scheme advocated here is easy to implement in exist-
ing molecular dynamics codes. The capabilities of this
methodology have been illustrated with a series of nu-
merical experiments in carbon and silicon in the diamond
structure, using a tight binding model.

20.25

−6

−4

−2

4
0
applied uniaxial stress (GPa)

2

6

FIG. 7: Silicon cell vector lengths as a function of the applied
uniaxial external stress in the [100] direction from simulations
at 1000 K external temperature.

Acknowledgments

It is a pleasure to acknowledge J. L. Mozos, P. Ordej´on

and J. L. Martins for helpful discussions.

ehe@icmab.es

∗
1 M. P. Allen and D. J. Tildesley, Computer Simulation of

(1992).

20 S. Melchionna, G. Ciccotti and B. D. Holian, Mol. Phys.

Liquids, (Clarendon Press, Oxford 1987).

78, 533 (1993).

2 D. Frenkel and B. Smit, Understanding Computer Simula-

21 G. J. Martyna, D. J. Tobias and M. L. Klein, J. Phys.

tion (Academic Press, New York 1996).

3 J. M. Thijssen, Computational Physics (Cambridge Uni-

versity Press, Cambridge 1999).

4 H. C. Andersen, J. Chem. Phys. 72, 2384 (1980).
5 S. Nos´e, Mol. Phys. 52, 255 (1984).
6 S. Nos´e, J. Chem. Phys. 81, 511 (1984).
7 W. G. Hoover, Phys. Rev. A 31, 1695 (1985).
8 M. Parrinello and A. Rahman, Phys. Rev. Lett. 45, 1196

9 M. Parrinello and A. Rahman, J. Appl. Phys. 52, 7182

(1980)

(1981).

10 R. Car and M. Parrinello, Phys. Rev. Lett. 55, 2471 (1985).
11 The adjective canonical is used here in two diﬀerent con-
texts, referring to the canonical or NVT ensemble of sta-
tistical mechanics, or referring to a transformation which
leaves invariant the form of the equations of motion. The
meaning should be clear by context.

12 M. E. Tuckerman, B. J. Berne and G. J. Martyna, J. Chem.

Phys. 97, 1990 (1992).

13 M. E. Tuckerman, C. J. Mundy, and G. J. Martyna, Euro-

phys. Lett. 45, 149 (1997).

14 M. E. Tuckerman, Y. Liu, G. Ciccotti, G. J. Martyna,

J. Chem. Phys. 115, 1678 (2001).

15 S. D. Bond, B. J. Leimkuhler and B. B. Laird, J. Comput.

Phys. 151, 114 (1999).

16 J. M. Sanz-Serna and M. P. Calvo, Numerical Hamiltonian

Problems, (Chapman and Hall, New York 1995).
17 C. L. Cleveland, J. Chem. Phys. 89, 4987 (1988).
18 R. M. Wentzcovitch, Phys. Rev. B 44, 2358 (1991).
19 J. V. Lill and J. Q. Broughton, Phys. Rev. B 46, 12068

Chem. 101, 4177 (1994).

22 I. Souza and J. L. Martins, Phys. Rev. B 55, 8733 (1997).
23 A. Sergi, M. Ferrario and D. Costa, Mol. Phys. 97, 825

24 J. B. Sturgeon and B. B. Laird, J. Chem. Phys. 112, 3474

(1999).

(2000).

25 E. Hairer, Ann. Numer. Math. 1, 107 (1994).
26 G. Sun, J. Comput. Math. 11, 365 (1993).
27 H. Goldstein, Classical Mechanics, 2nd edition (Addison-

Wesley, Reading, Massachusetts 1980).

28 R. N. Thurston,

in Physical Acoustics: Principles and
Methods, edited by W. P. Mason (Academic Press, New
York 1964).

29 W. H. Press, S. A. Teukolsky, W. T. Vetterling and
B. P. Flannery, Numerical Recipes in FORTRAN, The Art
of Scientiﬁc Computing 2nd Edition, (Cambridge Univer-
sity Press, Cambridge 1992).

30 For a review on Tight Binding methods, see C. M. Goringe,
D. R. Bowler and E. Hern´andez, Rep. Prog. Phys. 60, 1447
(1997).

31 S. Goedecker, Rev. Mod. Phys. 71, 1085 (1999).
32 P. Ordej´on, Comp. Mat. Sci. 12, 157 (1998).
33 M. C. Payne, M. P. Teter, D. C. Allan, T. A. Arias and
J. D. Joannopoulos, Rev. Mod. Phys. 64, 1045 (1993).
34 D. Porezag, T. Frauenheim, T. K¨ohler, G. Seifert and

R. Kashner, Phys. Rev. B 51, 12947 (1995).

35 H. J. Monkhorst and J. D. Pack, Phys. Rev. B 13, 5188

(1976).

