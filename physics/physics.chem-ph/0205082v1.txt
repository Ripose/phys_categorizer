2
0
0
2
 
y
a
M
 
9
2
 
 
]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[
 
 
1
v
2
8
0
5
0
2
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Numerical computation of critical properties and atomic
basins from 3D grid electron densities

1

Katan C.,a Rabiller P.,a Lecomte C.,b Guezo M.,a Oison V.a and

Souhassou M. b*

aGMCM-UMR CNRS 6626, Universit´e Rennes 1, av. Gal. Leclerc, 35042 Rennes,

France, and bLCM3B-UMR CNRS 7036, Universit´e Henri Poincar´e Nancy 1, 54506

Vandœuvre l`es Nancy, France . E-mail: souhas@lcm3b.uhp-nancy.fr

(Received 0 XXXXXXX 0000; accepted 0 XXXXXXX 0000)

Abstract

InteGriTy is a software package that performs topological analysis following AIM

approach on electron densities given on 3D grids. Use of tricubic interpolation is made

to get the density, its gradient and hessian matrix at any required position. Critical

points and integrated atomic properties have been derived from theoretical densities

calculated for the compounds NaCl and TTF-2,5Cl2BQ, thus covering the diﬀerent

kinds of chemical bonds: ionic, covalent, hydrogen bonds and other intermolecular

contacts.

1.

Introduction

Nowadays, very accurate electron densities can be obtained both experimentally and

theoretically. Experimental methods of recovering charge densities require high resolu-

tion X-Ray diﬀraction measurements on single crystals which are analysed within the

context of aspherical models. From the theoretical point of view, not only crystals but

also molecules, clusters and surfaces can be tackled using either quantum chemistry

PREPRINT: Journal of Applied Crystallography

A Journal of the International Union of Crystallography

2

techniques ranging from standard Hartree-Fock calculations up to extremely accu-

rate conﬁguration interaction methods or techniques based on the Density Functional

Theory (DFT) which are increasingly used to perform ab-initio calculations. Once the

total electron density is known, it can be analyzed in details by means of its topo-

logical properties within the Quantum Theory of Atoms in Molecules (Bader, 1990;

Bader, 1994). With such an analysis one can go beyond a purely qualitative descrip-

tion of the nature and strength of interatomic interactions. It can also be used to

deﬁne interactomic surfaces inside which atomic charges and moments are integrated.

The topological features of the total electron density ρ(r) can be characterized by

analyzing its gradient vector ﬁeld ∇ρ(r). Critical points (CP) are located at points

rCP where ∇ρ(rCP) = 0 and the nature of each CP is determined from the curvatures

(λ1, λ2, λ3) of the density at this point. The latter are obtained by diagonalyzing
the Hessian matrix Hij = ∂2ρ(r)
∂xi∂xj

(i, j = 1, 2, 3). The CP’s are denoted by a pair of

integers (ω, σ) where ω is the number of non-zero eigenvalues of the Hessian matrix

H(r) and σ the sum of the signs of the three eigenvalues. In a three dimensional

stable structure, four types of CP’s can be found: (3, −3) Peaks corresponding to

local maxima of ρ(r) which occur at atomic nuclear positions and in rare cases at

so called non-nuclear attractors; (3, −1) Passes, corresponding to saddle points where

ρ(r) is maximum in the plane deﬁned by the axes corresponding to the two negative

curvatures and minimum in the third direction, such bond critical points are found

between pairs of bonded atoms; (3, +1) Pales where ρ(r) is minimum in the plane

deﬁned by the axes associated with the two positive curvatures and maximum in

the third direction, such ring critical points are found within rings of bonded atoms;

(3, +3) Pits corresponding to local minima of ρ(r). The numbers of each type of CP’s

obbey the following relationship depending on the nature of the system: N (peaks) −

N (passes)+N (pales)−N (pits) = 0 or 1 for a crystal or an isolated system respectively.

IUCr macros version 2.0β5: 2001/06/20

The Laplacian of the electron density ∇2ρ(r) which is given by the trace of H(r) is

related to the kinetic and potential electronic energy densities, respectively G(r) and

V(r), by the local virial theorem,

3

∇2ρ(r) = 2G(r) + V (r)

1
4

(atomic units are used throughout the paper). The sign of the laplacian at a given

point determines whether the positive kinetic energy or the negative potential energy

density is in excess. A negative (positive) Laplacian implies that density is locally

concentrated (depleted). Within the Quantum Theory of Atoms in Molecules, a basin

is associated to each attractor (3, −3) CP, deﬁned as the region containing all gradient

paths terminating at the attractor. The boundaries of this basin are never crossed by

any gradient vector trajectory and satisfy ∇ρ(r) · N(r) = 0, where N(r) is the normal

to the surface at point r. The corresponding surface is called the zero ﬂux surface and

deﬁnes the atomic basin when the attractor corresponds to a nucleus. Only in very

rare cases non-nuclear attractors have been evidenced (Madsen, 1999). Within this

space partionning, the atomic charges deduced by integration over the whole basin

are uniquely deﬁned.

During the last twenty years, several programs have been developped to perform

topology of electron densities but they are either connected to computer program pack-

ages (Gatti et al., 1994; Koritsanszky et al., 1995; Souhassou et al., 1999; Stash,A. et

al., 2001; Stewart et al. 1983, Volkov et al., 2000) or have limitations concerning the

type of wavefunctions which have been used to determine ρ(r) in ab-initio calcula-

tions (Barzaghi, 2001; Biegler K¨onig et al., 1982, Biegler K¨onig et al., 2001; Popelier,

1996 ) or to reﬁne experimental data (Barzaghi, 2001). To our knowledge,only two

cases were described to analyse the topology of ρ(r) numerically on grids; Iversen et

al (Iversen 1995) used a maximum entropy density and Aray (Aray 1997) sampled a

theoretical density on a homogeneous grid. However, these approaches are limited to

IUCr macros version 2.0β5: 2001/06/20

4

the determination of CP’s. The present analysis of the topological features of total

electron densities is independent of the way these densities are obtained and works

for periodic or non-periodic systems. We show in this paper that this can be simply

achieved by working with densities given on regular grids in real space. The devel-

oped software InteGriTy uses a tricubic Lagrange interpolation which makes the CP

search and integration method both accurate and fast. The densities used to illustrate

the performance of our approach are theoretical ab-initio densities obtained with the

Projector Augmented Wave (PAW) method (Bl¨ochl, 1994). The next section of this

paper gives a short description of the method. Test compounds and computational

details are given in Section 3. Section 4 is devoted to the determination of CP’s and

their characteristics whereas section 5 concerns the determination of atomic basins

and charges. We will discuss the eﬀect of grid spacing of the input density and the

plane wave cutoﬀ used for the PAW calculations on the properties of diﬀerent type of

interactions (ionic, covalent and intermolecular).

2. Description of the method

2.1.

Input data and interpolation

In order to achieve the topological analysis of any experimental or theoretical elec-

tron density, the density is given on a regular, not necessarily homogeneous grid in real

space. A grid of stored values of ρ(r) must be prepared, preferably in binary format in

order to save disk space and with double precision to ensure high precision. The grid

which is deﬁned by its origin, three meshgrid vectors and the number of points in each

grid direction as well as atomic positions must be speciﬁed with respect to a cartesian

coordinate system. Determinations of the topological properties of ρ(r) requires the

knowledge of ρ(r), ∇ρ(r) and H(r) at many arbitrary points. This can be achieved

in an accurate and eﬃcient way by using a tricubic Lagrange interpolation (Press et

IUCr macros version 2.0β5: 2001/06/20

al., 1992). In one dimension, it uses values of ρ on two grid points on each side of the

current point as illustrated in ﬁgure 1. For a three-dimensional system, it uses 64 grid

points surrounding the box containing the current point:

5

ρ(x, y, z) =

ρ(i, j, k) Li(x) Lj(y) Lk(z).

4

4

4

X
i=1

X
j=1

X
k=1

As the ﬁrst and second derivatives of this expression are straighforward, the evalu-

ation of ∇ρ(r) and H(r) is numerically very cheap. It is clear that with respect to

analytical expressions, the interpolation may introduces errors. However, as shown in

section 4 and 5 these errors are small for reasonable values of the grid interval size,

and insigniﬁcant when compared to those issued from the multipolar reﬁnement of

experimental structure factors. One should also notice that this interpolation is not

suited to perform the topology of ∇2ρ(r) from the density. Higher order interpolation

would be required or the Laplacian has to be supplied on a grid.

s

ρ1 ρ2 ρ3 ρ4
s
s
x1 x2 x3 x4✻

s

s

s
✲

4

X
i=1

x, ρ(x) =

Li(x)ρi

L1(x) =

(x − x2)(x − x3)(x − x4)
(x1 − x2)(x1 − x3)(x1 − x4)

Fig. 1. One dimensional example for tricubic Lagrange interpolation. xi and ρi are
respectively the abscissa and density value at grid point i. The density at the
current abscissa x is given by ρ(x) where Li(x) are third order polynomial, passing
through all the grid points as shows the example of L1(x).

2.2. Critical points

To locate the CP’s, starting from every grid point, a standard Newton-Raphson

technique (Press et al., 1992) is used to ﬁnd the zero’s of its gradient modulus:

IUCr macros version 2.0β5: 2001/06/20

ri+1 = ri − α H

−1(ri) · ∇ρ(ri).

6

Far from the CP’s, the full Newton step will not necessarily decrease the gradient

modulus and the parameter α allows the stepsize adjustment. In all our calculations an

α value of 0.3 led to stable results. This iterative procedure is used until the gradient

modulus becomes less than a choosen threshold value. The corresponding CP is then

stored if no other CP has been found in its vinicity. Otherwise, the program keeps the

point which has the smallest gradient modulus. The CP’s can then be classiﬁed with

respect to their type and/or to the magnitude of ρ(rCP). It is worth to emphasise that,

since each grid point acts in its turn as a starting point, CP search does not require

a priori knowledge of atom location, nor the deﬁnition of plane or local coordinates

system. Periodic boundary conditions are used to treat periodic systems whereas four

grid points at each border of the input box are ignored in the case of non periodic

systems.

2.3. Atomic Basins

Interpolation of electronic density on grid can also be used to derive atomic basins

and integrate atomic charges with good accuracy and reasonable computer time. The

surface SΩ of each basin Ω is determined by its intersection with rays originating from

the attractor. Only one intersection per ray is looked for. Then the determined surfaces

may not be fully correct (Biegler K¨onig et al., 1982, Popelier, 1998) but the missing

volume that can be checked a posteriori is very low, thus having no appreciable eﬀect

on the integrated charges. Basin search is performed on total density whereas highly

accurate integration is obtained from valence part only to avoid using unreasonably

small grid steps. The program works with both periodic and non periodic conditions

for the input grids and a threshold electron density value can be applied to limit

the surface of open systems (e.g. van der Waals envelope, Bader, 1990). The presents

integration results concern only periodic systems thus allowing a posteriori validation

IUCr macros version 2.0β5: 2001/06/20

of the process according to the sum over the whole unit cell of all basin volumes,

including all atoms and possible non nuclear attractors.

7

out

(cid:16)

(cid:16)

b

(cid:16)

((cid:18) ; (cid:30))

in

(cid:16)

(cid:16)

s

(cid:16)

'$

(cid:16)

R

min

(cid:16)

(cid:16)

(

s

(

(cid:16)

(

(

(cid:16)

(

(

A

(cid:16)

(

(

!

(cid:10)
(cid:10)

(cid:3)(cid:23)

dr

(
t
(cid:16)

r

s
(cid:10)(cid:29)

(cid:3)

AK

(cid:10)

(cid:3)

(cid:10)(cid:10)(cid:29)

&%

A

(cid:3)

r(cid:26) (r)

A

(cid:3)

A

(cid:3)

S

(cid:10)

A

(cid:3)

r

A

r

A

(cid:3)

A

(cid:3)

A

(cid:3)

dr = gdr

r(cid:26)

0

jr(cid:26)j

A

(cid:3)

6

A

(cid:3)

-

Fig. 2. Schematic diagram to illustrate how a running point in radial coordinates is
checked following the gradient path inside (•) or outside (◦) a basin centered on the
attractor A and delimited by the surface SΩ. rA and r respectively give the positions
of the attractor and the running point in the absolute cartesian coordinates system.
The incremental step length g dro is deﬁned in the text.

2.3.1. Basin search To search for the surface of a basin, a radial coordinates system

centered on each attractor is used and one point of the basin surface RΩ (θ, φ) is looked

for along the ray deﬁned by θ and φ angles. A point r (θ, φ) is declared inside the basin

Ω if the following gradient path brings it towards a sphere centered on the attractor

and with radius Rmin small enough to be in the basin, as illustrated in ﬁgure 2. The

running point is declared outside of Ω if a few iteration steps successively move it away

from the attractor. The step amplitude used to follow the gradient is the product of a

minimum step dr0 weighted by a coeﬃcient g depending on the angle ω between the

considered ray and the gradient. It takes the form ln (g) = A | cos (ω) |B so that the

maximum step size corresponds to the parallel situation. The search algorithm used

for each ray is given in ﬁgure 3. A coarse bracketing, Rlow < RΩ (θ, φ) < Rhigh, is

ﬁrst performed starting from the value Rstart and using geometric progression with

IUCr macros version 2.0β5: 2001/06/20

8

common ratio 1 + ν. The sign and amplitude of ν depends on wether bracketing is

done downward to or away from the attractor. A dichotomy procedure is then used

to reﬁned the RΩ (θ, φ) value with predeﬁned tolerance dtol. At the ﬁrst (θ, φ) step,

Rstart is set to an arbitrary value given for each atom as an input parameter. A crude

estimation of basins limits is done ﬁrst on a regular (θ, φ) grid with small number of

points nθ and nφ = 2nθ with each RΩ (θ, φ) acting as starting value for the next (θ, φ)

step. This search is suﬃcient for graphical purpose and enables Rstart initialisation

by linear interpolation at all (θ, φ) points added during the integration process. The

Rmin value is updated at the end of the crude estimation in order to save time during

integration process. It is automatically reset to a lower value where it needs to be so.

IUCr macros version 2.0β5: 2001/06/20

9

(cid:15)

(cid:12)

(cid:18) ; (cid:30)

Æ

(cid:13)

r = R

start

L = f alse

H = f alse

(cid:8)

H

(cid:8)

H

(cid:8)

H

(cid:8)

H

H

(cid:8)

r 2 (cid:10)

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

(cid:19)

(cid:16)

H

(cid:8)

yes

no

(cid:18)

(cid:17)

(cid:18)

(cid:17)

R

= r

low

R

= r

high

L = true

H = true

(cid:23) = +(cid:23)

f orward

(cid:23) = (cid:0)(cid:23)

downward

(cid:8)

H

(cid:8)

H

(cid:8)

H

(cid:19)

(cid:16)

(cid:8)

H

H

(cid:8)

L & H

no

H

(cid:8)

(cid:18)

(cid:17)

r = r (1 + (cid:23) )

oarse braketing

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

yes

(cid:18)

(cid:17)

r =

(R

+ R

)

low

high

1

2

(cid:8)

H

(cid:8)

H

(cid:8)

H

(cid:8)

H

H

(cid:8)

r 2 (cid:10)

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

(cid:19)

(cid:16)

H

(cid:8)

yes

no

(cid:18)

(cid:17)

(cid:18)

(cid:17)

R

= r

low

R

= r

high

d = R

(cid:0) R

high

low

(cid:8)

H

(cid:8)

H

(cid:8)

H

(cid:19)

(cid:16)

(cid:8)

H

H

tol

(cid:8)

d < d

no

H

(cid:8)

(cid:18)

(cid:17)

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

yes

(cid:18)

(cid:17)

(cid:19)

(cid:16)

R

((cid:18) ; (cid:30)) =

(R

+ R

)

(cid:10)

low

high

1

2

(cid:18)

(cid:17)

dihotomy re(cid:12)nement

Fig. 3. Basin surface location ﬂowchart for a given ray originating from an attractor
with spherical coordinates θ and φ. L and H are dummy logical constants to check
if both the low and high limits of the coarse bracketting have been found. In the
second part of the ﬂowchart, the dichotomy process is stopped when the distance
between the two limits is below the predeﬁned tolerance dtol.

2.3.2.

Integration Two methods can be used for integration, both using three im-

bricated integration loops with spherical coordinates. The ﬁrst one is straightforward

IUCr macros version 2.0β5: 2001/06/20

10

and uses the same ﬁxed number of (θ, φ, r) points for all attractors. The number nr

and nθ of radial and θ steps are kept ﬁxed, whereas the number nφ (θ) of φ steps is θ

dependent such that elementary solid angle sin (θ) δθδφ be constant. The integral Qf

of a quantity f (θ, φ, r) is simply given by the discrete sum:

Qf = δr δθ

sin (θi) δφ (θi)

r2
k f (θi, φj, rk)

nθ
X
i=1

nφ(θi)

X
j=1

nr
X
k=1

The second method uses Romberg procedure (Press et al., 1992) and is illustrated

in ﬁgure 4 for a single variable function f to be integrated in the interval [a, b].

(cid:11)

(cid:8)

Q

= 0

0

(cid:10)

(cid:9)

n = 1

N = 2

n(cid:0)1

b(cid:0)a

h

=

n

N

1

h

n

Q

=

Q

+ h

(cid:1)

f

a + (1 + 2m)

n

n(cid:0)1

n

2

2

N (cid:0)1

X

m=1

 

!

(cid:19)

(cid:16)

(cid:8)

H

(cid:8)

H

no

n (cid:21) k

H

min

(cid:8)

(cid:8)

H

(cid:8)

H

(cid:18)

(cid:17)

H

(cid:8)

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

yes

(cid:18)

(cid:17)

extrapolation to h = 0

Q

, (cid:27)

f

(cid:19)

(cid:16)

(cid:8)

H

(cid:8)

H

(cid:8)

H

no

(cid:27) (cid:20) (cid:15) (cid:1) Q

H

(cid:8)

f

(cid:8)

H

(cid:18)

(cid:17)

H

(cid:8)

H

(cid:8)

H

(cid:8)

(cid:19)

(cid:16)

(cid:18)

(cid:17)

n = n + 1

yes

(cid:19)

(cid:16)

(cid:19)

(cid:16)

(cid:8)

H

(cid:8)

H

(cid:8)

H

no

n (cid:21) n

H

(cid:8)

max

(cid:8)

H

yes

(cid:18)

(cid:17)

(cid:18)

(cid:17)

H

(cid:8)

H

(cid:8)

H

(cid:8)

(cid:15)

(cid:12)

Q

f

Æ

(cid:13)

Fig. 4. Romberg ﬂowchart for the integration of a function f in the interval [a, b]. Qf
stands for an integrated property (charge, laplacian,volume) at the three imbricated
levels of integration, namely: radial, φ and θ in the respective intervals [0, RΩ (θ, φ)],
[0, 2π] and [0, π].

It ﬁrst calculates an estimation of the integral Qf over n stages of the extended

trapezoidal rule with successive integration steps {hn} and extrapolates Qf with k

IUCr macros version 2.0β5: 2001/06/20

11

order polynomial in h2 to the continuum limit h = 0 over the last n − k stages. The

interpolation starts after n≥ kmin stages. This iterative process is terminated when

either an estimated error σ derived from the extrapolation operation yields a desired

relative accuracy ǫ such that σ ≤ (ǫ · Qf ) or a ﬁxed maximum number of stages nmax

is reached. Several convergence criteria can be used for the radial, φ and θ levels of in-

tegration. Total and valence atomic charges, volume and laplacian are integrated and

convergence criteria can be choosen on each of these quantities. Individual quantities

are summed up at the end of the loop over all attractors. Total charges and volume are

then compared to the expected ones and residuals give the accuracy of the integration

process.

3. Test compounds

Diﬀerent types of crystals and molecules have been used to test limits, accuracy and

performance of algorithm. In this paper, we have selected two crystals, NaCl a classical

example for ionic crystals, and TTF-2,5Cl2BQ for covalent and intermolecular inter-

actions. The later compound was also chosen for the following reasons: with 26 atoms

in the unit cell the system is neither too small nor too large; the unit cell is triclinic

then the grid will not be orthogonal; the presence of inversion symmetry should be

recovered in all properties; ﬁnally the expected small intermolecular charge transfer

(about 0.5 out of 200 electrons) is a good quantity to test for the accuracy of charge

integration.

IUCr macros version 2.0β5: 2001/06/20

12

H
1

H
3

C
3

C
5

S
3

S
1

C
1

C
2

S
4

C
6

C
4

H
4

H
2

S
2

O
2
C
8

C

10

H
6

Cl
1

Cl
2

C
9

C

12

H
5

C
7

C

11

O
1

Fig. 5. Representation of a mixed stack of alternating TTF and 2,5Cl2BQ molecules
including atomic numbering. Open circles indicate bond and ring CP’s. The lines
connecting two molecules correspond to a bond pathes determined by following
∇ρ(r) with a small stepsize. Diamonds indicate some intermolecular (3, −1) CP’s.

All calculations used to generate the electron densities were carried out with the

Projector Augmented Wave (PAW) method (Bl¨ochl, 1994), an all-electron code de-

velopped by P. E. Bl¨ochl. The wave functions were expanded into augmented plane

wave up to a kinetic energy (Ecutoﬀ) ranging from 30 to 120 Ry. NaCl was treated

within an fcc cell with a = 10.62 a.u. and 8 k points in reciprocal space. For TTF-

2,5Cl2BQ we used the experimental geometry at ambient conditions (Girlando et al.,

1993). The unit cell is triclinic (a = 14.995, b = 13.636, c = 12.933 a.u., α = 106.94◦,

β = 97.58◦ and γ = 93.66◦) and contains one TTF and one 2,5Cl2BQ molecule both

setting on inversion centers. These molecules are respectively electron donor and ac-

ceptor molecules alternating along the b axis to form mixed stacks (ﬁgure 5). The

ab-initio calculations were performed with three k points between Γ and Y = 1

2 b∗ in

the Brillouin Zone (Katan et al., 1999).

IUCr macros version 2.0β5: 2001/06/20

13

4.1.

Ionic bonds

4. Critical points

NaCl presents four types of diﬀerent CP’s as shown in ﬁgure 6. Within the unit

cell there are six (3, −1) CP’s between Na and Cl, six (3, −1) CP’s between Cl· · ·Cl

surrounded in the Na· · ·Na direction by twelve (3, +1) CP’s, two (3, +3) CP’s and

two nuclear attractors. The characteristics of these CP’s are given in table 1 along

with the variation of CP properties versus grid spacing (∆rgrid) and number of plane

waves (Ecutoﬀ) for only one representative CP, all other CP’s presenting even smaller

variations. These results show that a grid spacing of about 0.15 u.a. and a plane wave

cutoﬀ of 30 Ry are suﬃcient to achieve accurate results for this ionic compound.

Fig. 6. Octahedron with one Cl at its center and six Na at each vertex. Iso-density
curves represented in the plane of Na· · ·Cl nearest neighbors. The six dark spheres
correpond to the (3, −1) CP’s between Na and Cl, the twelve grey spheres to the
(3, −1) CP’s between Cl· · ·Cl and the bright smallest one to the (3, +1) CP’s. The
(3, +3) CP’s are not shown here.

IUCr macros version 2.0β5: 2001/06/20

14

4.2. Molecular compounds

Low densities at critical points are observed in the crystal TTF-2,5Cl2BQ in inter-

action regions. Two examples are selected on table 2 and 3 respectively corresponding

to the ring CP of 2,5Cl2BQ and to the strongest hydrogen bond occuring in the plane

shown in ﬁgure 7. In both cases, the smallest Ecutoﬀ (50 Ry) and the largest grid

spacing (0.125 u.a.) give already quite good results. These properties converge even

better for all other low density CP’s. As for ionic bonding, the electron density is

particularly smooth close to the CP’s and even smaller Ecutoﬀ and ∆rgrid are enough.

The situation is much diﬀerent for covalent bonds where ρ(rCP) is much higher and

the electron density varies more rapidly. All covalent bond CP’s have been plotted on

ﬁgure 5. Typical covalent bonds of TTF-2,5Cl2BQ are summarized in table 4 and 5

for diﬀerent Ecutoﬀ and ∆rgrid. For most bonds, the CP properties do not vary too

much, except for C=O bond where low Ecutoﬀ gives a value of ∇2ρ(rCP) twice as large

as other Ecutoﬀ. This is due to the electron density that changes very rapidly along

the bond path. For this reason, the C=O bond properties are also the most sensitive

to ∆rgrid (table 5). This makes it particularly diﬃcult to treat. Evidently, the CP

characteristics of simple bonds are more easily accurate than those of double bonds.

Finally, we have checked in each case that CP’s which are equivalent by symmetry

are equivalent at least within the numbers of digits indicated in the diﬀerent tables of

this section. All these results clearly show that CP’s properties can easily be deduced

from densities given on regular grids, the choice of the grid stepsize depending on the

nature of the bonds of interest.

5. Atomic Basins

Accuracy of integration from a grid density will depend on the integration method

and on the way of determining the basins surfaces but also on the accuracy of electron

IUCr macros version 2.0β5: 2001/06/20

15

density data at the grid points, on the degree of missing information due to grid spacing

and on the possible bias introduced by the interpolation procedure. The following

residuals have been deﬁned to estimate the accuracy of integration process: Ngrid is

the number of electrons in the unit cell obtained over all elementary volume units

either by discrete summation or using analytical integral expression of the tricubic

interpolation. Then ∆N = Ngrid-Nreal is the diﬀerence between the number of valence

electrons obtained by integration over the whole unit cell and its expected real value.

The quantities vΩ and SΩ respectively refer to the volume and surface of the basin Ω.

The number of electrons in an individual basin is denoted nΩ. δN = P nΩ - Nreal is

the residual after summation over all atomic basins. The basin volume uncertainty is

set equal to the product of the tolerance dtol and an estimation of the atomic surface

SΩ. The total volume uncertainty is given by σV = dtol P SΩ and the residual volume

error by ∆V = P vΩ - Vcell. If the uncertainty σV is found clearly less than the residual

∆V, the question arises about the way the atomic surfaces are derived. In this case,

either there are several intersections of the basin surface with one ray originating

from the attractor, either the parameters used to follow the gradient path have to be

modiﬁed or some attractors are missing in the input list. Finally the largest charge

diﬀerence between symmetry equivalent atoms, the intra or inter molecular charge

transfer (CT) and its estimated uncertainty (σCT) are the other criteria which can be

used as a measure of the accuracy of the integration process.

IUCr macros version 2.0β5: 2001/06/20

16

Fig. 7. Representation of atomic basins in the plane containing both TTF and
2,5Cl2BQ molecules. The strongest hydrogen bond in TTF-2,5Cl2BQ crystal oc-
curs between O1 and H3. The arrows indicate the direction and magnitude of the
gradient in the plane. An example of unreachable small piece of volume due to
multiple intersection of the atomic surface with a ray originating from atom C5 can
be seen on top right of the ﬁgure.

5.1. Grid spacing and ab-initio calculation convergence

In the case of NaCl, ab-initio calculations are not too sensitive to the convergence

criterion Ecutoﬀ so the grid spacing eﬀect can clearly be evidenced. Well converged

integration results using Romberg procedure are given in table 6. One can notice that

the electron number residual δN after integration and sum over all basins is very

close to ∆N given as input. This residue monotonically decreases with reducing grid

spacing whereas volume residual ∆V is almost constant. Reasonnable estimation of

interatomic charge transfer can be derived from valence density within a precision of

0.01 electron for a grid spacing of about 0.06 a.u. The prohibitive grid spacing required

to get the charge transfer with the same precision from total density can be estimated

to 0.03 a.u. as illustrated in ﬁgure 8.

IUCr macros version 2.0β5: 2001/06/20

17

e
g
r
a
h
C

6

5

4

3

2

1

0

0.83

−q

Cl

q

Na

0.03

0.04

0.05

0.06

0.07

0.08

0.09

0.1

∆ r

grid

Fig. 8. NaCl atomic charges from total electron density vs. grid spacing. Solid lines are
guides for the eyes converging to the 0.83 charge transfer estimated from valence
density.

5.2. Grid spacing and ab-initio calculations convergence

In the case of molecular crystals which exhibit short bonds with large and quickly

varying electron density at their bond critical points, such C=O for example, the ab-

initio calculations are more sensitive to the convergence criterion Ecutoﬀ deﬁning the

plane waves expansion basis set. This is found in the integration results as illustrated

in table 7 for TTF-2,5Cl2BQ compound where the electron number residual δN after

integration over all atomic basins is sligthly diﬀerent from that after direct summation

over the unit cell ∆N. This may arrise from the larger number of atoms and from the

less smooth shapes of atomic basins (ﬁgure 9) in comparison to the NaCl case. Nev-

ertheless using Ecutoﬀ above 50Ry is enough to get the intermolecular charge transfer

within 0.02 electron precision which is the goal that originally motivated this work.

IUCr macros version 2.0β5: 2001/06/20

18

Fig. 9. 3D representation of some atomic basins in the TTF-2,5Cl2BQ charge transfer

complex.

5.3. Romberg vs. ﬁxed spherical grid integration

Diﬀerent sets of parameters for the Romberg integration procedure, including ad-

equate parameters for the basin limits search are given in table 8. Indicated CPU

time corresponds to a PC machine with 800MHz processor and 512Mo RAM without

including density ﬁles reading nor direct unit cell summation. The preliminary esti-

mation of basin envelopes is done with nθ = 18 and nφ = 36, using a tolerance dtol

= 0.05 a.u. This operation takes about 0.8 second per basin. The integration conver-

gence criteria have been put only on the volume and the valence density since the grid

spacing used may not correctly restore density cusps near atomic nuclei. Obtaining

the intermolecular charge transfer, in the case of TTF-2,5Cl2BQ, within a precision of

about one hundredth of an electron takes about one minute per basin. The weaker cri-

teria, although leading to unsatisfying residual from the intermolecular charge transfer

point of view, nevertheless give a good indication of atomic charges within less than

one second per basin. The residual volume error remains of the order of one cubic

atomic unit out of nearly 2500 for the unit cell and only for the more severe inte-

gration convergence criteria may appear the problem of very precise determination

of basin boundaries (ﬁgure 7, top right). The greatest discrepancy between charges

obtained for equivalent atoms ranges from 10−4 for the set of parameters leading to

IUCr macros version 2.0β5: 2001/06/20

19

the best integration, to 10−3 for the set giving the shorter CPU time. For comparison,

integration has been done using a ﬁxed spherical grid for all basins. The correspond-

ing parameters and results are listed in table 9. The total number of angular loops is

denoted nθ,φ. Below nθ,φ × nr ∼ 104 integration points, no realistic atomic charges can

be obtained. Indeed, the very short time that can be used with Romberg integration

come from its internal k order polynomial extrapolation which gives an error estimate

of order O(1/N 2k) instead of O(1/N 2) for the simple discrete summation with the

same number N of integration points.

In the case of ﬁxed spherical grid integration, compared to Romberg integration, the

volume uncertainty is in most of the cases greater than the residual volume error, thus

giving no information about missing or overlapping volumes. The discrepancy between

charges of equivalent atoms is also about an order of magnitude higher. The point that

makes the Romberg procedure more favorable is that the number of integration points

is automatically adapted to each basin to the desired level of convergence, as illustrated

for atoms C5 and S1 in table 8, whereas taking a ﬁxed mean spherical grid leads to

missing or biased information for some atoms and adds unnecessary points for other

ones. The number nr of radial loops indicated in table 8 are averages over all angular

loops for each basin.

6. Conclusion

We have shown that topological properties can be derived from electron densities given

on 3D grids with tricubic interpolation to extract at any given position the density, its

gradient and hessian matrix. Except for very short covalent bonds such C=0, critical

points properties can be obtained with grid spacing of about 0.1 a.u. The same grid

spacing can also be used to get atomic charges by intergration over atomic basins with

highly accurate values using the valence electron density. The integration is done with

IUCr macros version 2.0β5: 2001/06/20

spherical coordinates system centered on the attractors and uses the robust Romberg

algorithm which allows the number of integration points to be automatically adapted

for each basin and oﬀers the choice between saving computing time or giving the

20

preference to accuracy.

Acknowledgements

This work has beneﬁted from collaborations within the Ψk-ESF Research Program

and the Training and Mobility of Researchers Program “Electronic Structure” (Con-

tract: FMRX-CT98-0178) of the European Union and the Interational Joint Research

Grant “Development of charge transfert materials with nanostructures” (Contract:

00MB4). Parts of the calculations have been supported by the “Centre Informatique

National de l’Enseignement Sup´erieur” (CINES—France). We would like to thank

P.E. Bl¨ochl for his PAW code and P. Sablonniere for usefull discussions.

References

Aray, Y., Rodr´ıguez, J. and Rivero, J. (1997) J. Phys. Chem. A101, 6976–6982.

Bader, R.F.W. (1990). Atoms in Molecules: A quantum theory. The international Series of

Monographs on Chemistry: Oxford University, Clarendon Press.

Bader, R.F.W. (1994). Phys. Rev. B 49-19, 13348–13356.

Barzaghi, M. (2001). PAMoC (Version 2001.0), Online User’s Manual, Centro del CNR
per lo Studio delle Relazioni tra Struttura e Reattivit Chimica, Milano, Italy, 2001.
http://www.csrsrc.mi.cnr.it/ barz/pamoc/

Biegler K¨onig, F.W., Bader, R.F.W. & Tang, T. (1982) J. of Comp. Chem. 3, 317–328. AIM-

PAC interfaced to GAUSSIAN, http://www.chemistry.mcmaster.ca/aimpac

Biegler K¨onig, F.W.; Sch¨onbohm, J. & Bayles, D (2001) J. Comp. Chem. 22, 545-559.

AIM2000 http://www.aim2000.de/

Bl¨ochl, P.E. (1994). Phys. Rev. B 50, 17953–17979.

Gatti, C., Saunders, V. R. & Roetti, C. (1994) J. Chem. Phys. 101, 10686–10696 and Gatti,

C. (1996) Acta Cryst. A52, C-555–556. TOPOND interfaced to CRYSTAL.

Girlando, A., Painelli, A., Pecile, C., Calestani, G., Rizzoli, C. & Metzger, R.M. (1993). J.

Chem. Phys. 98, 7692–7698.

IUCr macros version 2.0β5: 2001/06/20

21

Iversen, B.B., Larsen, F.K., Souhassou, M. and Takata, M. (1995). Acta. Cryst. B51, 580–591

Katan, C. & Koenig, C. (1999). J. Phys.: Condens. Matter 11, 4163–4177.

Koritsanszky, T., Howard, S., Richter, T., Su, Z., Mallinson, P. R. & Hansen, N. K. (1995). XD
Computer Program Package for Multipolar Reﬁnement and Analysis of Electron Densities
from X-Ray Diﬀraction Data. Free University of Berlin, Germany. Program XDPRO.

Madsen, G. K. H., Gatti, C., Iversen, B. B., Damjavonic, Lj., Stucky, G. D. & Srdanov, V. I.

(1999). Phys. Rev. B 59, 12359–12369 and references therein.

Popelier, P. L. A.

(1996) Comp. Phys. Comm.

93,

212–240. MORPHY98

http://morphy.ch.umist.ac.uk/

Popelier, P. L. A. (1998) Comp. Phys. Comm. 108, 180–190

.

Press, W.H., Teukolsky, S.A., Vetterling, W.T. & Flannery, B.P. (1992). Numerical recipes -

The art of scientiﬁc computing. Second Edition. Cambridge University Press.

Souhassou, M. & Blessing, R. H. (1999). J. Appl. Cryst. 32, 210–217. NEWPROP interfaced

to MOLLY.

Stash, A. & Tsirelson, V. (2001). WINPRO - A Program for Calculation of the Crystal and

Molecular Properties Using the Model Electron Density, http://stash.chat.ru.

Stewart, R. F. & Spackman, M. A. (1983). VALRAY User’s manual. Carnegie-Mellon Univer-

sity, Pittsburgh, USA.

Volkov, A. , Gatti, C., Abramov, Y. & Coppens P. (2000). Acta Cryst. A56, 252–xx. Program

TOPXD interfaced to XD, http://harker.chem.buﬀalo.edu/public/topxd/

Table 1. Characteristics of crystalline NaCl critical points (CP’s) for diﬀerent grid spacing

(∆rgrid) and numbers of plane waves (Ecutoﬀ). λ1, λ2 and λ3 are the Hessian matrix
eigenvalues. All values except Ecutoﬀ are given in a.u.

Type

Ecutoﬀ ∆rgrid

ρ(rCP) ∇2ρ(rCP)

λ1, λ2, λ3

(3,-1)
NaCl

(3,-1)
ClCl

40 Ry
40 Ry
40 Ry
30 Ry
120 Ry

0.1564
0.1138
0.0939
0.1138
0.1138

0.0130
0.0130
0.0130
0.0130
0.0130

0.0577
0.0576
0.0571
0.0581
0.0583

-0.0122, -0.0119, 0.0817
-0.0122, -0.0121, 0.0820
-0.0122, -0.0121, 0.0814
-0.0123, -0.0121, 0.0825
-0.0123, -0.0121, 0.0827

40 Ry

0.1138

0.0049

0.0127

-0.0024, -0.0011, 0.0163

(3,+1)

40 Ry

0.1138

0.0047

0.0134

-0.0025, 0.0035, 0.0124

(3,+3)

40 Ry

0.1138

0.0019

0.0056

0.0019, 0.0019, 0.0019

IUCr macros version 2.0β5: 2001/06/20

Table 2. Characteristics of the ring CP of 2,5Cl2BQ and the O1 · · ·H3 hydrogen bond of

TTF-2,5Cl2BQ for diﬀerent Ecutoﬀ and ∆rgrid = 0.104 a.u.

22

Type

Ecutoﬀ

ρ(rCP) ∇2ρ(rCP)

λ1

λ2

λ3

Ring CP
2,5Cl2BQ

O1 · · ·H3

50 Ry
70 Ry
90 Ry
100 Ry

50 Ry
70 Ry
90 Ry
100 Ry

0.0210
0.0209
0.0209
0.0209

0.0103
0.0103
0.0103
0.0103

0.1233
0.1327
0.1314
0.1315

0.0359
0.0384
0.0375
0.0370

-0.0128
-0.0134
-0.0131
-0.0131

-0.0106
-0.0109
-0.0108
-0.0107

0.0613
0.0664
0.0656
0.0656

-0.0102
-0.0103
-0.0103
-0.0103

0.0747
0.0796
0.0789
0.0791

0.0567
0.0596
0.0585
0.0580

Table 3. Same as table 2 for diﬀerent ∆rgrid and Ecutoﬀ = 90 Ry.

Type

Cycle

∆rgrid

ρ(rCP) ∇2ρ(rCP)

λ1

λ2

λ3

0.125
0.104
0.085

0.0209
0.0209
0.0209

0.1314
0.1314
0.1313

-0.0132
-0.0131
-0.0131

0.0656
0.0656
0.0656

0.0790
0.0789
0.0788

O1 · · ·H3

0.125
0.104
0.085

0.0103
0.0103
0.0103

0.0375
0.0375
0.0373

-0.0108
-0.0108
-0.0107

-0.0102
-0.0103
-0.0103

0.0585
0.0585
0.0584

Table 4. Characterisitcs of selected covalent bond CP’s of TTF-2,5Cl2BQ for various Ecutoﬀ;
∆rgrid = 0.104 a.u.

Type

Ecutoﬀ

ρ(rCP) ∇2ρ(rCP)

λ1

λ2

λ3

C11-O1

C6-S2

C1-C2

50 Ry
70 Ry
90 Ry
100 Ry

50 Ry
70 Ry
90 Ry
100 Ry

50 Ry
70 Ry
90 Ry
100 Ry

0.4038
0.4070
0.4079
0.4079

0.2089
0.2094
0.2094
0.2094

0.3410
0.3387
0.3388
0.3387

0.6240
0.3862
0.3182
0.3131

-0.3931
-0.4185
-0.4243
-0.4251

-1.2044
-1.0740
-1.0786
-1.0734

-1.0511
-1.0359
-1.0401
-1.0394

-0.3364
-0.3370
-0.3371
-0.3371

-0.7568
-0.7496
-0.7453
-0.7452

-0.9774
-0.9567
-0.9579
-0.9571

-0.2823
-0.2835
-0.2833
-0.2833

-0.5956
-0.5893
-0.5853
-0.5852

2.6526
2.3788
2.3162
2.3096

0.2256
0.2021
0.1961
0.1954

0.1480
0.2649
0.2519
0.2570

IUCr macros version 2.0β5: 2001/06/20

Table 5. Same as table 4 for diﬀerent ∆rgrid; Ecutoﬀ=90 Ry.

23

Type

∆rgrid

ρ(rCP) ∇2ρ(rCP)

λ1

λ2

λ3

C11-O1

C6-S2

C1-C2

0.125
0.104
0.085

0.125
0.104
0.085

0.125
0.104
0.085

0.4080
0.4079
0.4079

0.2095
0.2094
0.2095

0.3388
0.3388
0.3388

0.2268
0.3182
0.2913

-0.4207
-0.4243
-0.4239

-1.0770
-1.0786
-1.0804

-1.0899
-1.0401
-1.0266

-1.0180
-0.9579
-0.9879

-0.3353
-0.3371
-0.3369

-0.2824
-0.2833
-0.2835

-0.7438
-0.7453
-0.7462

-0.5841
-0.5853
-0.5862

2.3347
2.3162
2.3058

0.1970
0.1961
0.1965

0.2509
0.2519
0.2520

Table 6. NaCl integration results vs. ∆rgrid; Ecutoﬀ=120 Ry.

∆rgrid

0.095

0.0885

0.08

0.063

∆N

δN

∆V

qNa
vNa

qCl
vCl

CT
σCT

∆N

δN

∆V

CT
σCT

0.0362

0.0289

0.0198

0.0086

0.0367

0.0285

0.0199

0.0090

0.095

0.096

0.020

0.090

0.8282
63.36

0.8282
63.36

0.8188
63.29

0.8283
63.36

-0.8648
236.18

-0.8572
236.18

-0.8387
236.17

-0.8373
236.17

0.85
0.04

0.84
0.03

0.83
0.02

0.83
0.01

Ecutoﬀ (Ry)

50

70

90

100

-0.006

-0.005

-0.006

-0.006

0.066

0.022

0.020

0.020

-0.92

-1.44

-1.93

-1.89

qTTF
q2,5Cl2BQ

0.455
-0.522

0.453
-0.475

0.452
-0.472

0.453
-0.473

0.49
0.07

0.46
0.02

0.46
0.02

0.46
0.02

IUCr macros version 2.0β5: 2001/06/20

Table 7. TTF-2,5Cl2BQ integration results vs. Ecutoﬀ ( ∆rgrid = 0.104 a.u.);.

Table 8. Sets of tested parameters and results for Romberg integration on the charge transfer

crystal TTF-2,5Cl2BQ. The cell volume is Vcell = 2493.062 a.u. Direct integration of
valence electron density over the whole unit cell gives an input error ∆ N = -0.0056 electron.

∆rgrid = 0.104 a.u; Ecutoﬀ = 90 Ry

24

Basin search
dro = dtol
A
B

Romberg
kmin
ǫr
ǫφ
ǫθ

5 10−2
5
0.5

5 10−3
50
0.5

10−3
250
0.5

5 10−4
500
1

5 10−4
500
1

4
10−3
10−2
5 10−2

6
10−3
10−2
5 10−2

6
5 10−4
5 10−3
10−2

6
10−4
10−3
10−3

6
2 10−7
8 10−5
5 10−5

10−4
2500
1

6
10−7
10−5
10−4

CPU time

23s

104s

222s

19min.

3.5h

43h

-0.413

0.080

0.056

0.019

0.014

0.006

18.98
120

-1.88
12

-0.98
2.4

-1.56
1.25

-0.77
1.2

-1.11
0.2

qTTF
q2,5Cl2BQ

0.862
-0.448

0.424
-0.503

0.434
-0.490

0.448
-0.467

0.454
-0.468

0.455
-0.461

0.65
0.40

0.46
0.08

0.46
0.06

0.46
0.02

0.461
0.015

0.458
0.006

89
15
-0.311
69.11

1089
33
-0.285
65.96

1089
33
-0.285
65.96

1441
56
-0.283
65.50

8639
212
-0.284
65.56

38081
258
-0.284
65.56

81
23
0.249
183.22

1089
33
0.252
181.86

1089
40
0.255
181.84

1089
61
0.258
181.95

2591
292
0.258
182.21

8513
373
0.258
182.18

δN

∆V
σV

CT
σCT

C1
nθ,φ
nr
q
v

S1
nθ,φ
nr
q
v

IUCr macros version 2.0β5: 2001/06/20

Table 9. Sets of tested parameters and results for ﬁxed spherical grid integration on

TTF-2,5Cl2BQ compound.

25

Basin search
dro = dtol
A
B

Spherical Grid
nθ
nθ,φ
nr

5 10−3
50
0.5

5 10−3
50
0.5

5 10−4
500
0.5

5 10−4
500
1

18
406
30

30
1134
50

50
3162
100

72
6574
240

CPU time

53s

135s

20min.

2.2h

δNtot
δNval

∆V
σCT

CT
σCT

C1
q
v

S1
q
v

qTTF
q2,5Cl2BQ

0.398
-0.545

0.433
-0.494

0.442
-0.484

0.449
-0.474

1.534
0.147

-0.192
0.061

-0.204
0.041

-0.227
0.025

-30.50
12.5

-2.18
11

-0.27
1.2

-0.35
1.2

0.47
0.15

0.46
0.06

0.46
0.04

0.46
0.03

-0.286
65.14

-0.284
65.52

-0.285
65.59

-0.284
65.55

0.251
181.96

0.254
182.21

0.256
182.20

0.257
182.23

Synopsis

IUCr macros version 2.0β5: 2001/06/20

InteGriTy, a software package to compute topological properties of electron densities given on
3D grids.

