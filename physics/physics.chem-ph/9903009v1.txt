9
9
9
1
 
r
a

M
 
4
 
 
]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[
 
 
1
v
9
0
0
3
0
9
9
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Symplectic algorithm for constant-pressure molecular dynamics using a
Nos´e-Poincar´e thermostat

Jess B. Sturgeon and Brian. B. Laird[1]
Department of Chemistry and Kansas Institute for Theoretical and Computational Science
University of Kansas
Lawrence, Kansas 66045, USA

February 2, 2008

Abstract

We present a new algorithm for isothermal-isobaric molecular-dynamics simulation. The method uses an
extended Hamiltonian with an Andersen piston combined with the Nos´e-Poincar´e thermostat, recently developed
by Bond, Leimkuhler and Laird [J. Comp. Phys., 151, xxxx (1999)]. This Nos´e-Poincar´e-Andersen (NPA)
formulation has advantages over the Nos´e-Hoover-Andersen approach in that the NPA is Hamiltonian and can
take advantage of symplectic integration schemes, which lead to enhanced stability for long-time simulations. The
equations of motion are integrated using a Generalized Leapfrog Algorithm and the method is easy to implement,
symplectic, explicit and time reversible. To demonstrate the stability of the method we show results for test
simulations using a model for aluminum.

1

Introduction

Traditionally, molecular-dynamics simulations are performed using constant particle number N , volume V and
energy E. However, these are not usually the conditions under which experiments are done and there has been much
attention to the development of simulation methods designed to sample from other, experimentally more relevant
ensembles, such as constant temperature (canonical) and/or constant pressure[2, 3, 4]. Some of the most popular and
useful of these are those based on so-called “extended” Hamiltonians, i.e., Hamiltonians in which extra degrees of
freedom have been added to the system in order to ensure that the trajectory samples from the statistical distribution
corresponding to the desired thermodynamic conditions.

For a constant pressure system, for example, Andersen[5] introduced the volume V , along with its corresponding
conjugate momentum πV , as extra variables. The new variables are coupled to the system in such a way as to
guarantee that the trajectory (if ergodic) samples from an isobaric statistical distribution. Similarly, to generate a
constant temperature distribution, Nos´e[6] introduced a new mechanical variable s (with conjugate momentum πs)
that couples into the system through the particle momenta and acts to eﬀectively rescale time in such a way as
to guarantee canonically distributed conﬁgurations. These two extensions can be combined to give a Hamiltonian
whose trajectories can be shown to sample from an isothermal-isobaric ensemble.[7]

This combined Nos´e-Andersen (NA) Hamiltonian is given by

HN A = V −2/3

p2
2mis2 + U (V 1/3q) +
i

π2
V
2QV

+

π2
s
2Qs

X

+ gkT ln s + PextV ,

(1)

where pi is the conjugate momentum to the scaled position qi = V −1/3ri, Pext is the external pressure and g is
given by Nf + 1 where Nf is number of degrees of freedom of the original system. The quantities QV and Qs are
the masses of the Andersen “piston” and the Nos´e thermostat variable, respectively.

The equations of motion for this system are

˙pi = −V 1/3∇iU (V 1/3q)
pi
˙qi =
s2miV 2/3

1

(2a)

(2b)

where the instantaneous pressure P is given by

˙πV = P − Pext
˙V = πv/QV

˙πs = V −2/3s−3

˙s = πs/Qs ,

X

p2
i
mi

−

gkT
s

P =

2
3V

p2
i
2miV 2/3s2 −

1
3V

i
X

∂U
∂qi

qi

i
X

There are two major drawbacks to this approach: First, because of the time rescaling, the time variable in Nos´e
dynamics is not “real” time, so any discretized trajectory generated by numerically integrating the Nos´e equations
of motion must be transformed back into “real” time, leading to the conﬁgurations that are spaced at unequal
“real”-time intervals. This is inconvenient for the construction of equilibrium averages, especially of dynamical
quantities. Second, the Hamiltonian is not separable[8] (that is, the kinetic and potential terms in the Hamiltonian
are not functions only of momenta and position variables, respectively), making standard Verlet/leapfrog approaches
inapplicable.

By a change of variables and a time rescaling of the equations of motion, Hoover[9] derived new equations of
motion that generate the same trajectories (for the exact solution) as the original Nos´e Hamiltonian, but in real time.
This Nos´e-Hoover dynamics has become a standard method in molecular simulation. However, the change of variables
that links the Nos´e Hamiltonian to the Nos´e-Hoover equations of motion is a non-canonical transformation - the
total energy function of the system is still conserved, but it is no longer a Hamiltonian, since the equations of motion
cannot be derived from it. Although a variety of very good time-reversible methods have been put forward,[10, 11]
the lack of Hamiltonian structure precludes the use of symplectic integration schemes, which have been shown to
have superior stability over non-symplectic methods[8].

2 The Nos´e-Poincar´e-Andersen (NPA) Hamiltonian

Recently, Bond, Leimkuhler and Laird[12] have developed a new formulation of Nos´e constant-temperature dynamics
in which a Poincar´e time transformation is applied directly to the Nos´e Hamiltonian, instead of applying a time
transformation to the equations of motion as in Nos´e-Hoover. The result of this is a method that runs in “real” time,
but is also Hamiltonian in structure. In this work we combine this new thermostat with the Andersen method for
constant pressure to give an algorithm for isothermal-isobaric molecular dynamics. For a system with an Andersen
piston, the new Nos´e-Poincar´e-Andersen (NPA) Hamiltonian is given by

HN P A = [HN A − HN A(t = 0)]s ,

where HN A is given in Eq. 1. As discussed in Ref. 12, the above form of the Hamiltonian (a speciﬁc case of a
Poincar´e time transformation) will generate the same trajectories as the original Nos´e-Andersen Hamiltonian, except
with time rescaled by s (which puts the trajectories back into real time), The resulting equations of motion (except
for πs) for this constant pressure and temperature Nos´e-Poincar´e Hamiltonian are the as those given above for the
Nos´e-Andersen system (Eqs. 2a-2f), except that the right-hand side is multiplied by the thermostat variable s. For
πs we have

where ∆H ≡ HN A − HN A(t = 0).

˙πs = −s

− ∆H = V −2/3

∂H
∂s

p2
i
mis2 − gkT − ∆H

X

3

Integrating the NPA Equations of motion

The NPA Hamiltonian is nonseperable since the kinetic energy contains the extended “position” variables s and
V . The equations of motion for a general time-independent, non-seperable Hamiltonian can be written (for general

2

(2c)

(2d)

(2e)

(2f)

(3)

(4)

(5)

positions Q and conjugate momenta P )

˙Q = G(P, Q)
˙P = F (P, Q) ,

∂P and F (P, Q) = − ∂H

where G(P, Q) = ∂H
∂Q . (For a seperable Hamiltonian G is only a function of P and F is only a
function of Q.) For such a nonseperable system, standard symplectic splitting methods, such as the Verlet/leapfrog
algorithm, are not directly applicable. However, symplectic methods speciﬁcally for nonseperable systems have been
developed[8]. One simple example that is second-order and time-reversible is the Generalized Leapfrog Algorithm
(GLA)

where h is the time step and Pn and Qn are the approximations to P (t) and Q(t) at t = tn = nh. (This method can
be obtained as the concatenation of the Symplectic Euler method,

Pn+1/2 = Pn + hF (Pn+1/2, Qn)/2

Qn+1 = Qn + h[G(Pn+1/2, Qn) + G(Pn+1/2, Qn+1)]/2
Pn+1 = Pn+1/2 + hF (Pn+1/2, Qn+1)/2 ,

Pn+1 = Pn + hF (Pn+1, Qn)
Qn+1 = Qn + hG(Pn+1, Qn) ,

with its adjoint[8]. The concatenation of a integrator with its adjoint guarantees a time-reversible method.) This
method is a simple example of a class of symplectic integrators for nonseperable Hamiltonians[13, 14, 15, 16].

Applying the GLA to the NPA equations of motion gives

h
2
h
2

h
2
h
2

h
2

h
2

pi,n+1/2 = pi,n −

snV 1/3

n ∇iU (V 1/3q)

πv,n+1/2 = πv,n +

sn[P(qn, pn+1/2, Vn, sn) − Pext]

πs,n+1/2 = πs,n +

h
2  

N

i=1
X

p2
i,n+1/2
2/3
n s2
n

miV

− gkBT

!

−

∆H(qn, pn+1/2, Vn, πv,n+1/2, sn, πs,n+1/2)

sn+1 = sn +

(sn + sn+1)

Vn+1 = Vn +

(sn + sn+1)

πs,n+1/2
Qs
πv,n+1/2
Qv

qi,n+1 = qi,n +

πs,n+1 = πs,n+1/2 +

h
2  

1

+

1

2/3
snV
n

h
2  

N

i=1
X

2/3
n+1 !

sn+1V
p2
i,n+1/2
2/3
n+1s2

miV

n+1

pi,n+1/2
mi

− gkBT

!

−

∆H(qn+1, pn+1/2, Vn+1, πv,n+1/2, sn+1, πs,n+1/2)

πv,n+1 = πv,n+1/2 +

sn+1[P(qn+1, pn+1/2, Vn+1, sn+1) − Pext]

pi,n+1 = pi,n+1/2 +

sn+1V

1/3
n+1 ∇iU (V

1/3
n+1qn+1)

h
2
h
2

(6)

(7)

(8)

(9a)

(9b)

(9c)

(9d)

(9e)

(9f)

(9g)

(9h)

(9i)

As in the case of the constant volume Nos´e-Poincare algorithm, the GLA for the NPA is explicit - this is not
necessarily the case for a general nonseperable Hamiltonian. Note that Eq. 9c requires the solution of a scalar
quadratic equation for πs,n+1/2. Details of how to solve this equation without involving subtractive cancellation can
be found in Ref. 12.

3

4 Test Simulation Results and Summary

In order to evaluate this method, simulations were performed using an embedded atom potential for aluminum[17].
We report test simulations on a system of 256 particles with periodic boundary conditions for an aluminum melt at
T = 1000K and P = 0. For this model mass is measured in amu, distance in ˚A and energy in eV, the natural time
unit of the simulation is then 10.181fs, that is, a simulation time step of 0.1 corresponds to an acutal time step of
1.0181fs.

First the stability of the method was tested. Fig. 1(a) shows the value of the NPA Hamiltonian (a conserved
quantity) as a function of time in a long run. The trajectory shown here was begun after initial equilibration at
1000K for 2×106 time steps (2.03ns). In this simulation, the values of Qv and Qs (in reduced units) were 10−4
and 2.5, respectively. The stability of the method is excellent, giving no noticeable drift in HNPA over the course
of a long trajectory. The pressure and temperature trajectories for this run are also shown in Figs. 1(b) and 1(c),
respectively.

3

(cid:23)

A
P
N

)

A
=
V
e
(
e
r
u
s
s
e
r
P

)

V
e
(

H

)

K
(
e
r
u
t
a
r
e
p
m
e
T

0.0060

0.0030

0.0000

−0.0030

−0.0060

0.030

0.015

0.000

−0.015

−0.030

1010

1005

1000

995

990

0

(a)

(b)

(c)

500

1000

1500

2000

time(ps)

Figure 1: (a) The value of the NPA Hamiltonian as a function of time for a long run (over 2ns) on a 256 particle aluminum system.
The starting conﬁguration had been equilibrated at T = 1000K and P = 0. The values of Qv and Qs (in reduced units) are 0.4 and
10−4, respectively. The pressure and temperature trajectories for this run are given in (b) and (c), respectively.

In Fig. 2(a)-(c), we show the ability of the method to regulate the pressure, temperature and density, respectively,
for three sets of extended variable masses. (The values for Qs were larger here than that used in Figure 1 because

4

small values of that variable lead to instabilities when the initial temperature is far from the target temperature.)
The system was initialized to an fcc lattice of initial density 0.06021˚A−3 with the individual velocity components
chosen from a Maxwell-Boltzmann distribution at 100K. The simulation was then run with the NPA with T = 1000K
and P = 0. In all cases, the instantaneous pressure, temperature and density evolve quickly and stabilize about their
desired values.

Qs =  500;  Qv = 0.0001
Qs =  500;  Qv = 0.0001
Qs = 5000;  Qv = 0.0010

(a)

(b)

(c)

3

3

(cid:23)

(cid:23)

)

K
(
e
r
u
t
a
r
e
p
m
e
T

)

A
=
V
e
(
e
r
u
s
s
e
r
P

)

A
=
s
m
o
t
a
(
y
t
i
s
n
e
D

0.20

0.15

0.10

0.05

0.00

−0.05
5000

4000

3000

2000

1000

0
0.070

0.065

0.060

0.055

0.050

0.045

0.040

0.00

1.00

2.00

3.00

4.00

5.00

time(ps)

Figure 2: Pressure (a), temperature (b) and density (c)trajectories for the 256 particle aluminum system using the NPA
algorithm with T = 1000K and P = 0 starting from an initial conﬁguration in an fcc lattice with density ρ = 0.06021˚A−3 and
initial velocities chosen from a Maxwell-Boltzmann distribution at 100K.

The GLA has a global error that is second-order in the time step. To demonstrate that this also is true in our
results, a series of simulations were performed using various values for the time step. The system was initialized in
an identical manner to that described in the last paragraph and then run for a total time of 2.0362 ps. Figure [3]
shows, for several combinations of extended variable masses, a log-log plot of the energy error, as estimated by the

5

−6.0

−8.0

A
P
N

−10.0

−12.0

−14.0

1.5

1.0

0.5

0.0

)

H
(
(cid:14)
n

l

)
t
(
C

standard deviation of HNPA (Eq. 3), versus the time step. One notes that here smaller values of Qv lead to smaller
ﬂuctuations in HNPA.

Qs=10; Qv=0.1; m=1.9978

Qs = 10; Qv = 0.0001; m = 2.0035

Qs = 0.4; Qv = 0.1; m=1.9942

Qs = 0.4; Qv = 0.0001; m=1.9786

−16.0

−6.0

−5.0

−4.0

ln h

−3.0

−2.0

Figure 3: Log-log plot of the energy error δHNP A versus the time step for a variety of piston and thermostat masses. The
order of the error is given by the slope of lines and is labeled as m in the legend.

NPT Simulation
NVE simulation

−0.5

0

100

200

300

400

500

time(fs)

Figure 4: The normalized velocity autocorrelation function, C(t), for the embedded-atom model for aluminum calculated for
a 256 particle system at T=1000K and P=0. The solid line is calculated using the NPA algorithm described herein. The
dotted line is a constant NVE simulation under similar conditions.

Finally, to demonstrate that the method yields relevant dynamical quantities, the normalized velocity autocor-
relation function, C(t) = hv(t) · v(0)i/hv(0) · v(0)i, was calculated using our constant NPT algorithm (with Qv and

6

Qs as in Fig. 1) and compared to the same quantity calculated using standard constant NVE molecular dynamics
(with a velocity-Verlet integrator[18]). The NVE simulations were run at an energy and density corresponding to
the average energy and density for the constant NPT simulations. This comparison is shown in Figure [4]. Both
systems were ﬁrst equilibrated at 1000K for 200,000 steps (203.6 ps) and run for 20,000 steps (20.36 ps) to collect
averages. C(t) for the Nos´e-Poincar´e-Andersen method for constant NPT molecular dynamics is indistinguishable in
this ﬁgure from that of the NVE simulation.

5 Acknowledgements

We gratefully acknowledge Steve Bond and Ben Leimkuhler for helpful conversations and invaluable advice, as well
as the Kansas Center for Advanced Scientiﬁc Computing for the use of their computer facilities. We also would like
to thank the National Science Foundation (under grants CHE-9500211 and DMS-9627330) as well as the University
of Kansas General Research Fund for their generous support of this research.

References

[1] [*] Author to whom correspondence should be addressed.

[2] M.A. Allen and D.J. Tildesley, Computer Simulation of Liquids, (Oxford Science Press, Oxford, 1987).

[3] D. Frenkel and B. Smit, Understanding Molecular Simulation, (Academic Press, New York, 1996).

[4] D. Brown and J. H. R. Clarke, Mol. Phys. 51, 1243–1252 (1984).

[5] H.C. Andersen, J. Chem. Phys 72, 2384–2393 (1980).

[6] S. Nose, Mol. Phys. 52, 255 (1984).

[7] S. Nose, J. Chem. Phys. 81, 511 (1984).

[8] J.M. Sanz-Serna and M.P Calvo, Numerical Hamiltonian Problems, (Chapman and Hall, New York, 1995).

[9] W.G. Hoover, Phys. Rev. A 31, 1695 (1985).

[10] D.J. Tobias G.J. Martyna and M.L. Klein, J. Chem. Phys. 101, 4177–4189 (1994).

[11] D.J. Tobias G.J. Martyna, M.E. Tuckerman and Michael L. Klein, Mol. Phys. 87, 1117–1157 (1996).

[12] S.D. Bond, B.J. Leimkuhler, and B.B. Laird, J. Comp. Phys. 151, xxxx (1999).

[13] J.M. Sanz-Serna, BIT 28, 877–883 (1991).

[14] F. Lasagni, ZAMP 39, 952–953 (1988).

[15] Y.B. Suris, U.S.S.R. Comput. Maths. Math. Phys. 29, 138–144 (1989).

[16] J.M. Sanz-Serna, Acta Numer. 1, 243–286 (1991).

[17] J. Mei and J.W. Davenport, Phys. Rev. B 46, 21–27 (1992).

[18] W.C. Swope, H.C. Andersen, P.H. Berens, and K.R. Wilson, J. Chem. Phys. 76, 637 (1982).

7

