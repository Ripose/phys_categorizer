7
9
9
1
 
r
a

M
 
2
1
 
 
]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[
 
 
1
v
9
1
0
3
0
7
9
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Quasi-Hamiltonian Equations of Motion for Internal Coordinate Molecular Dynamics
of Polymers

Alexey K. Mazur
Laboratoire de Biochimie Th´eorique, CNRS UPR9080 Institue de Biologie Physico-Chimique 13, rue Pierre et Marie Curie,
Paris,75005, France1
Paciﬁc Institute of Bioorganic Chemistry, Russian Academy of Sciences Vladivostok, 690022, Russia
(February 2, 2008)

1Present address. Email: alexey@ibpc.fr

Conventional molecular dynamics simulations macromolecules require long computational times
because the most interesting motions are very slow compared with the fast oscillations of bond
lengths and bond angles that limit the integration time step. Simulation of dynamics in the space of
internal coordinates, that is with bond lengths, bond angles and torsions as independent variables,
gives a theoretical possibility to eliminate all uninteresting fast degrees of freedom from the sys-
tem. This paper presents a new method for internal coordinate molecular dynamics simulations of
macromolecules. Equations of motion are derived which are applicable to branched chain molecules
with any number of internal degrees of freedom. Equations use the canonical variables and they are
much simpler than existing analogs. In the numerical tests the internal coordinate dynamics are
compared with the traditional Cartesian coordinate molecular dynamics in simulations a 56 residue
globular protein. For the ﬁrst time it has been possible to compare the two alternative methods
on identical molecular models in conventional quality tests. It is shown that the traditional and
internal coordinate dynamics require the same time step size for the same accuracy and that in the
standard geometry approximation of aminoacids, that is with ﬁxed bond lengths, bond angles and
rigid aromatic groups, the characteristic step size is 4 fsec, that is two times higher than with ﬁxed
bond lengths only. The step size can be increased up to 11 fsec when rotation of hydrogen atoms is
suppressed.

I. INTRODUCTION

Computer simulations of molecular dynamics (MD) have become an invaluable tool applied to numerous problems
in chemical physics1 and biophysics2. Normally molecular movements are simulated by the method of point particles3,
i.e. motion of each atom is computed by Newton’s equations while molecular structures are maintained by harmonic
potentials that keep bond lengths and bond angles close to their standard values. The maximum time step with which
Newton’s equations can be numerically integrated is limited to rather small values (1 fsec for systems containing explicit
hydrogen atoms), in order to reproduce bond-length oscillations accurately. This time step is annoyingly small for
simulations of macromolecules, notably biopolymers. The unique molecular properties of biopolymers result from
speciﬁc concerted atom movements, conformational transitions, which can occur over a very broad time range: from
picoseconds to seconds. Because of the necessarily small time step, interesting motions, for the most part, remain
beyond the reach of even the fastest computers. This presents the central problem in methodology in the ﬁeld.

Twenty years ago Ryckaert et al4 proposed an approach to this problem which is now called constraint dynamics.
They found a simple and eﬃcient way to impose holonomic constraints upon atom-atom distances in a system of point
particles governed by Newton’s equations. Their well-known algorithm, SHAKE, and a few other techniques based
upon the same idea5,6 are now often used to ﬁx bond lengths, increasing the time step limit to 2 fsec for systems
with explicit hydrogens. Constraint dynamics has been extensively reviewed1,7,8. These simple algorithms can be
applied to any molecules regardless of their size, chemical structure etc. However, although it seemed initially that
the method could ﬁx not only bond lengths but also, by triangulation, could constrain bond angles, dihedral angles,
rigid planar groups etc.4, this was found to be true only for very small molecules. In large complex polymers like
proteins even bond angles cannot be ﬁxed in this way9.

The intrinsic limitation of constraint dynamics can be qualitatively understood from the underlying physical model.
Imposing a distance constraint implies that a reaction force is introduced which is applied along a line joining two
atoms. Reactions must be calculated at each time step to balance all other forces in the system, which for large
molecules presents a diﬃcult problem because they are all coupled and form a system of algebraic equations solved by
iterations. With only bond lengths to hydrogens ﬁxed reactions are coupled in small groups and iterations converge
rapidly. With all bond lengths ﬁxed reactions are coupled globally and looping becomes possible. In general, in this
case, the convergence is not guaranteed10, but, in practice, it remains acceptable. When bond angles are triangulated
coupling is much stronger and convergence becomes too slow. Eﬀorts to overcome these limitations continue11; in

1

particular, it was shown that an exact non-iterative calculation of reactions is possible, in principle12, but, so far, this
is practical only for water molecules13 and for linear unbranched chains in which case the problem can be reduced to
inversion of a banded matrix6,14.

Despite these diﬃculties it remains desirable to model chain molecules within the so-called standard geometry
approximation15, that is with standard ﬁxed conformations of individual chemical groups and with rotations around
single bonds as the only motion considered. Rotatable torsion angles completely deﬁne molecular conformations and
present a convenient minimum set of generalized coordinates which are directly used in static conformational analysis
and Monte-Carlo simulations of polymers.
In principle, MD simulations in the space of generalized, rather than
Cartesian, coordinates are also possible by using one of the appropriate general formalisms of the classical mechanics.
In this way all limitations imposed by the fast vibrations of bond lengths, bond angles etc. would be eliminated
automatically. This approach was ﬁrst applied to liquid butane with one internal degree of freedom16 and soon after
Pear and Weiner pioneered simulations of linear chains of up to 15 bonds based upon the Newton-Euler equations
of rigid body dynamics17. Interest in this line of research next decreased because of its complexity and because it
initially appeared that constraint dynamics could solve all problems, but the diﬃculties encountered have led to a
revival of work.

To date several research groups have reported attempts to ﬁnd a suitable technique for MD simulations in generalized
coordinates17,18,19,20,21,22,23,24,25,26. Both methods of rigid body dynamics17,18,24,25,26 and the Lagrange-Hamilton
formalism19,20,21,22,23 were employed. These methods often have little in common in their analytical formulations,
but they all may be reasonably referred to as internal coordinate molecular dynamics (ICMD). The full set of internal
coordinates includes not only torsions, but also bond lengths and bond angles, and in some approaches these variables
may also be free, if desired. The term internal coordinate molecular dynamics underlines the main distinction of
these approaches from conventional MD, i.e. they all consider molecular motion in the space of generalized internal
coordinates rather than in the usual Cartesian coordinate space.

None of the ICMD techniques has yet been suﬃciently well developed to reach its main goal, that is, to compute
long-duration macromolecular trajectories with acceptable accuracy but at a lower cost than the classical MD with
bond length constraints. Compared with the pure Newtonian dynamics there are two obvious problems with ICMD.
The ﬁrst is the derivation of equations of motion for large molecules. This task seemed too complicated at the
beginning4, but several acceptable solutions have been proposed, which represent the main achievement of the early
reports on the subject17,18,19,21,26. The second problem is the cost of additional calculations to be performed in order
to obtain generalized accelerations. This must be low enough to be compensated by an increase in the step size.
Among these calculations the necessity to invert the mass matrix of the system is an evident obstacle. This matrix is
diagonal for the Newton’s equations but for internal coordinates it is a full positive deﬁnite matrix, therefore, a direct
inversion scales as O(n3) with the number of degrees of freedom and this quickly becomes impractical when n exceeds
100. Fortunately, a solution of this problem was found some time ago in robot mechanics27,28,29,30, namely, there
are several recursive techniques that allow one to compute exact generalized accelerations for O(n) calculations if the
system can be treated as a tree of articulated rigid bodies. Two such algorithms have been employed recently25,26 for
ICMD and it was shown that, as in Newtonian dynamics, the cost of the time step can be made close to that of the
evaluation of forces25.

In spite of this progress the capabilities of ICMD still are not obvious because it is unclear how much the time step
can be increased in practically interesting cases. The uncertainty is caused by two diﬀerent reasons. First, biopolymers
with only torsion degrees of freedom are very complex, heterogeneous and essentially unharmonic systems in which
it is usually impossible to distinguish the fastest motions a priori by intuition. For instance, in simulations of small
peptides time steps can be increased up to 15-20 fsec22,25,31,32 and one might expect that a considerable increase of
the step size should be possible for larger molecules as well. Surprisingly, the ﬁrst simulations of torsion dynamics of
proteins reported recently25,26 encountered a step size barrier of only 2 fsec, the same as in the constraint dynamics
with ﬁxed bond lengths. This unusual eﬀect of molecular size still have no clear explanation. Most of the uncertainty,
however, results from unresolved numerical problems involved in integration of ICMD equations of motion. Their
analytical form does not give a possibility to employ common symplectic MD integrators and that is why various
general-purpose predictor-corrector schemes were usually employed. It is well-known, however, that in MD applications
such algorithms tend to loose stability with lower step sizes. In addition, it was shown that they poorly conserve
momenta when applied to equations of motion in generalized coodrinates22.

This study presents an attempt to overcome the numerical diﬃculties in ICMD reported in ref. 22. These diﬃculties
originate from the general form of the equations of motion which depends only upon the choice of coordinates, and so
they could not be overcome by simple remedies. That is why an essentially new analytical formulation of ICMD has
been developed with new equations which are essentially Hamiltonian, but have a slightly diﬀerent form. Surprisingly,
they turned out to be much simpler than in other analytical ICMD formulations. Numerical integration in the space
of conjugate Hamiltonian variables eliminates all earlier problems associated with poor conservation of momenta22
and results in trajectories as stable as those obtained with Newtonian MD.

2

This paper principally presents an analytical background, but includes representative tests in order to obtain reliable
estimates of the step size in a few important simulation modes and to make sure that there are no hidden numerical
problems that can undermine the method. It turns out that for protein torsion dynamics with all explicit hydrogens
the optimal time step is 4 fsec, two times larger than with only bond lengths ﬁxed and the same as that for rigid
water simulations33. This value is probably determined by fast collisions and rotations of hydrogen atoms because
without explicit hydrogens or with weighted inertia of hydrogen-only rigid bodies the possible time step is beyond 10
fsec. The computer cost of a time step for the torsion dynamics is similar to that of usual constraint dynamics with
ﬁxed bond lengths. It is, therefore, a method of choice for long simulations in which the accuracy of the standard
geometry approximation is acceptable. It should be also stressed that ICMD qualitatively diﬀers from the constraint
dynamics in its eﬃciency with respect to the number of constraints: additional constraints in ICMD result in an
increased speed of calculations.

II. DERIVATION OF EQUATIONS

Let rα denote the position vector of atom α. The conformation of the molecule is speciﬁed by the set of N such

vectors {rα}. Kinetic energy

where overdot denotes time derivative; the potential energy

and the Lagrangian

Assuming that the set of generalized coordinates is deﬁned {θi} i = 1, ...n, so that

the Lagrangian equations of motion are

Now consider how molecular conformation is speciﬁed by bond lengths, bond angles and dihedrals. If in Fig.1 the
Cartesian coordinates are given for atoms α, β and γ, rδ is computed from rα, rβ and rγ given the values of dihedral
ω, planar angle ϕ and bond length l

Similarly, rε is computed from rβ, rγ and rδ, and so on. This procedure needs global coordinates of the ﬁrst three
atoms for initialization, but for the moment we skip this point to consider it later. The above process is not just an
algorithm for computing {rα} from {θi}, but also a deﬁnition of a speciﬁc ordering of atoms and internal coordinates
in the molecule. This ordering is indispensable for transformation of {θi} into {rα}; it is implicit in Eq.(4) but is
revealed when derivatives ∂rα/∂θi need to be computed. For example, when dihedral ω in Fig.1 is varied then by
deﬁnition rα, rβ and rγ are not aﬀected while rδ moves, as well as the following atoms. The inﬁnitesimal displacements
of atoms in response to variation of internal coordinates correspond to the motion of a tree: the very ﬁrst three atoms
form the base, internal coordinates close to the base move almost the whole molecule while variables in a speciﬁc
branch move only the upper part of that branch. Of course, there is no distinction between the base and the tip of the
tree in the real motion: when the base gets its six degrees of freedom it becomes equivalent to any of the branches.
Let Di denote the set of atoms in the molecule that move when internal coordinate θi is varied. Than we have

K =

N

Xα=1

mα ˙r2
α
2

U = U ({rα})

L = K − U

rα = rα ({θi})

d
dt

∂K
∂ ˙θi

−

∂K
∂θi

= −

∂U
∂θi

rδ = rδ(rα, rβ, rγ, ω, ϕ, l)

∂K
∂θi

=

Xα∈Di

mα ˙rα

∂ ˙rα
∂θi

3

(1)

(2)

(3)

(4)

(5)

(6)

(7)

∂K
∂ ˙θi

=

Xα∈Di

mα ˙rα

∂ ˙rα
∂ ˙θi

=

Xα∈Di

mα ˙rα

∂rα
∂θi

and Eq.(5) gives

mα¨rα

= −

∂rα
∂θi

∂U
∂θi

Xα∈Di

δrα = eiδθi

δrα = ei × (rα − ri) δθi

In order to make the following step it is necessary to assume that there are no loops in the molecule. Internal
coordinate description of ﬂexible loops is a separate problem which needs special treatment, but without loops the
whole set Di moves as a single rigid body if only θi is varied. If θi is a bond lengths Di is translated along the bond
so that for any atom

where ei is the unit vector of the bond. If on the other hand θi is an angle or a dihedral, rotation of Di occurs:

where the cross denotes a vector product, while the unit vector ei and the position vector ri specify the axis of
rotation.

For a translational variable Eq.(9) gives

mα¨rα

= ei

mα¨rα = ei ˙Pi = −

Xα∈Di

Xα∈Di

∂rα
∂θi

∂U
∂θi

where Pi is the total momentum of the set of atoms Di. It is straightforward to show that, in the case of a translational
variable, ∂U/∂θi equals to the sum of the forces applied to atoms of set Di projected upon vector ei, and so Eq. (12)
is nothing but the corresponding projection of the Newton equation. For a rotational variable we have

∂rα
∂θi

Xα∈Di

Xα∈Di

mα¨rα

= ei

(rα − ri) × (mα¨rα) = ei ˙Mi = −

∂U
∂θi

where Mi is the total angular momentum of atoms of set Di around the ﬁxed point in space given by the current
value of vector ri. Again it is easy to show that, for a rotational variable, ∂U/∂θi equals the projection upon ei of the
sum of the torques around point ri applied to atoms of set Di, and therefore Eq.(13) is a projection of the Newton
equations for the torques.

In order to shorten the notation let us introduce indicator si such that

Now we need to transform Eq.(15) so that a full time derivative appears on the left. We have

and unite Eqs.(12) and (13)

and

si =

(cid:26)

1 if θi − rotational
0 if θi − translational

siei

˙Mi + (1 − si) ei

˙Pi = −

∂U
∂θi

ei ˙Pi =

(eiPi) − ˙eiPi

d
dt

ei ˙Mi =

d
dt

(eiQi) − ˙eiQi + Pi (ei × ˙ri)

4

where Qi is the total angular momentum of set Di around moving point given by vector ri. Although Mi and Qi refer
to the same physical quantity distinction between them must be made because these are two diﬀerent time functions.
Mi is angular momentum around a ﬁxed node; it equals to Qi at the given moment of time but it has a diﬀerent time
derivative:

(8)

(9)

(10)

(11)

(12)

(13)

(14)

(15)

(16)

(17)

˙Mi =

∂
∂t

Qi ri = const

(18)

(19)

(20)

(21)

and, accordingly, the two values diverge immediately afterwards. The Newton equation (13) is valid for Mi but not
for Qi.

Substitution of Eqs.(16) and (17) into Eq.(15) gives

∂
∂t

∂U
∂θi

[sieiQi + (1 − si) eiPi] = −

+ si ˙eiQi − siPi (ei × ˙ri) + (1 − si) ˙eiPi

Now consider more carefully the term in the brackets on the left. By a simple transformation we get

sieiQi + (1 − si) eiPi =

mα ˙rα [siei × (rα − ri) + (1 − si) ei] =

∂K
∂ ˙θi

=

∂L
∂ ˙θi

i.e. this is nothing but the conjugate momentum corresponding to variable θi and Eq.(19) is just one of the Hamiltonian
equations. We have, therefore

Xα∈Di

n

Xk=1

aik ˙θi = sieiQi + (1 − si) eiPi

where {aik} are the coeﬃcients of the mass matrix of the system. Eqs.(19) and (21) present the resultant equations
of motion to be integrated by a computer. This is done in two steps. At ﬁrst the r.h.s. of Eq.(19) is evaluated and
the time step is made for momenta. At the same time momenta propagated from the previous step are substituted
into the r.h.s. of Eq.(21) and the linear system is solved by inverting the mass matrix, which is done by using the
recursive algorithm by Rodriguez et al29,30. This algorithm has been developed within the context of the Newton-
Euler approach to rigid body dynamics, where each its step has a physical interpretation and corresponds to a special
decomposition of reactions in hinges between rigid bodies. Here these interpretations are lost, but due to the same
structure of matrix {aik} it still can be applied just as a formal mathematical procedure. The generalized velocities
thus obtained are used to make the time step in generalized coordinates. A speciﬁc example of an integrator for Eqs.
(19) and (20) employed in the numerical tests reported below is detailed in the Appendix.

Eq.(19) is rather simple and presents no computational problems. All terms on the right are familiar functions of
atom coordinates and atom velocities. It is clear that in an unbranched chain molecule sets Di can be ordered so that

D1 ⊃ D2 ⊃ ... ⊃ Dn−1 ⊃ Dn

(22)

therefore all Pi can be computed starting from the tip of the chain, moving to the base and at the ith variable
adding only the contribution from subset Di/Di+1. In order to compute Qi angular momenta of sets Di are ﬁrst
computed with respect to the zero of global coordinates in the same way as momenta. After that Qi are computed
by moving the ith node of rotation to ri The total force applied to atoms of set Di is computed similarly to Pi and
the total torque - similarly to Qi. It can be noted that the recurrent calculations of derivatives of the conformational
energy used in this ﬁeld for a long time19,34,35 are nothing but the above summation of forces and torques. Due
to these algorithms computations of forces in ICMD is in fact similar to the classical MD, contrary to the common
oppinion24,25,26. Generalization of the above procedure for a branched chain is straightforward. These computations
present only technical diﬃculties and there is no need to detail them here. The computer time necessary to evaluate
the non-potential terms in Eq.(19) is negligible.

It seems reasonable to call Eqs.(19) and (21) Quasi-Hamiltonian because of the meaning of the parameters involved.
One should note that there is already some confusion in the classiﬁcation of equations of motion in internal coordinates.
It certainly has little sense to base such classiﬁcation upon the method used for the derivation of equations because
their ﬁnal form depends only upon the choice of coordinates. For example, by substituting Eq.
(21) into Eq.
(19) we can get the earlier equations for generalized accelerations19 which are equivalent to any other equations for
accelerations of internal coordinates24. Inversely, Eq. (19) may be obtained by separating a full time derivative in the
corresponding equations for generalized accelerations derived by any appropriate technique.

III. CONSERVATION OF MOMENTA

Let us consider now the generalized coordinates that position in space the ﬁrst three atoms in the molecule. These
coordinates may be called external and they aﬀect positions of all other atoms, therefore P1 and Q1 are the total

5

momentum and angular momentum around a node which is yet to be speciﬁed.
In the absence of external ﬁeld
∂U/∂θi = 0 therefore for external variables the r.h.s. of Eq.(19) includes only inertial terms. All these terms become
zero, however, if variable θi can be deﬁned so that the corresponding ei and ri are ﬁxed in space. For instance, if the
Cartesian coordinates of the ﬁrst atom are used as the ﬁrst three translational coordinates Eq.(19) gives

d
dt

Px =

Py =

Pz = 0

d
dt

d
dt

(23)

where P is the total momentum of the molecule. Thus, the conservation of the total momentum appears to be
explicitly present in equations of motion and, more importantly, in their ﬁnite-diﬀerence approximations. The same
property is implicit in the Newton equations. On the face of it, this might seem rather minor, but it appears to be
somehow related with the numerical stability with large step sizes. In the Newton’s case, among the principal ﬁrst
integrals of mechanics only the total energy is aﬀected by the numerical approximation errors, while the conservation of
momenta commonly is “ideal”, that is it depends only upon the length of the ﬂoating point numbers in the computer.
In contrast, in the numerical integration of standard ICMD equations for generalized accelerations all ﬁrst integrals
are similarly aﬀected by approximation errors. The importance of this qualitative diﬀerence has been recognized
in our earlier study22 where it was possible to signiﬁcantly improve the numerical stability with large step sizes by
enforcing conservation of momenta. By using Eqs. (19) and (20) ideal numerical conservation can be ensured with
an appropriate choice of the external coordinates, and we will see below that in this way one manages to obtain the
quality of numerical trajectories comparable to that of classical MD.

The above considerations dictate the following procedure for positioning the ﬁrst three atoms in a molecule. Fig.1
shows the global coordinate frame xyz and the local frame x′y′z′ that is bound with the molecule. The origin of the
local frame coincides with the ﬁrst atom (atom α in Fig.1). The second atom (β) always rests on axis O′x′ and the
third atom (γ) always rests in plane x′O′y′. The second atom moves along O′x′ axis if its bond lengths (bond α-β in
Fig.1) is not ﬁxed. Similarly, the third atom moves in x′O′y′ plane if bond β-γ and/or bond angle α-β-γ are variable.
With these conventions, the six rigid body degrees of freedom of frame x′y′z′ with respect to the global coordinates
xyz complement the internal degrees of freedom in the molecule to the full set required.

Frame x′y′z′ is considered to rotate around the zero of the global coordinates, with variations of the ﬁrst three
generalized coordinates, δθ1, δθ2 and δθ3, corresponding to rotations around axes x, y and z, respectively. In this case
˙θ1, ˙θ2 and ˙θ3 obtained from Eq.(21) are the components ωx ωy and ωz of the angular velocity of frame x′y′z′. They
are used to integrate the kinematic equations for the quaternion that controls orientation of frame x′y′z′36,37. Vector
Q = Q1 = Q2 = Q3 is the total angular momentum around the global coordinate origin therefore Eq.(19) guarantees
conservation of the angular momentum. One can note, however, that since the ﬁrst atom is moved by variations
δθ1, δθ2 and δθ3 the Cartesian coordinates of the ﬁrst atom can no longer be taken as independent. However, we
can still select the three global translational variables so that variations δθ4, δθ5 and δθ6 correspond to translations
of all atoms along global axes x, y and z. In this case ˙θ4,
˙θ5 and ˙θ6 obtained from Eq.(21) refer to υx, υy and υz
components of velocity of the point that is rigidly connected with x′y′z′ frame, but instantaneously coincides with
the zero of coordinates as the center of rotation. The velocity of the ﬁrst atom is then computed from its position
vector r1 and vectors υ and ω. It is clear that in this case vector P = P4 = P5 = P6 still is the total momentum of
the molecule.

IV. NUMERICAL TESTS

The formal validity of the analytical formulation of ICMD method described in the sections above has been checked
in numerous tests with biopolymers of diﬀerent size and chemical structure. These calculations clearly conﬁrmed
the expected superiority of this new method over our previous formulation19,20,21,22.
In particular, results of the
tests obtained with enforced conservation of momenta22 have been considerably improved, especially as regards the
magnitude of the total energy drift (data not shown). The results of a few representative calculations are shown in
Fig. 2. Following many previous methodological MD studies a single protein molecule in vacuum was considered
here, and the time step comparisons are made by using the conservation of the total energy to access the accuracy
of the numerical trajectory. The protein molecule chosen is the immunoglobulin binding domain of streptococcal
protein G38 (PGB, ﬁle 1pgb in the Protein Database39) which is a 56 residue α/β protein subunit. PGB is somewhat
larger than the commonly used test proteins, but it does not have neither S-S bridges nor proline residues, so that no
complications connected with the treatment of the ﬂexible rings are involved. Two indicators of the conservation of

6

the total energy are used: the module of the drift and the relative ﬂuctuation which is computed as

rD

δ =

2

(E − hEi)

E
2
(K − hKi)

E

rD

where hEi and hKi are the average total and kinetic energies, respectively. The value of the drift is calculated by a
linear regression during 1 psec intervals along the trajectory and averaged.

In Figs. 2(a-d) the ICMD simulations are compared with the classical MD. For the usual MD the popular pack-
age AMBER40 with force ﬁeld AMBER9441 was used, with distance dependent dielectric constant, ε = r, and no
truncation of non-bonded interactions. In calculations with ﬁxed bond lengths the SHAKE algorithm4 was employed
with a tolerance of 10−6. ICMD trajectories were computed by a new program (DY) with the same force ﬁled and
all internal coordinates as variables. Special care has been taken to ensure identity of the force ﬁled implementations
in the two programs and identity of the starting states. The equilibration was more or less standard and included
minimization of the crystal structure followed by a 12.5 psec run starting from Maxwell distribution at 300 K with
periodic temperature control and a step size of 0.5 fsec. After that the step size was reduced to 0.25 fsec and a short
trajectory of 150 fsec was calculated, with the ﬁnal part stored and used for generating initial data. The ﬁnal point
was used as the starting state for a test trajectory of 10 psec, with initial half-step velocities taken at appropriate
time intervals from coordinates. These last preparations were necessary to provide smooth starts of leapfrog integra-
tors used in AMBER and DY with diﬀerent time step sizes. The same starting states were imported from AMBER
to DY where internal coordinates and generalized velocities were computed from atomic coordinates and velocities.
The test trajectory was repeatedly computed with gradually growing step size ﬁrst in Cartesian and next in internal
coordinates.

Figures 2(a,b) present results obtained in calculations with completely free molecular models, i.e. with no con-
straints. The agreement between the two sets of simulations is close to ideal. Note that the commonly used value
of the time step (1 fsec) corresponds to a relative ﬂuctuation of δ =0.1, which can be reasonably used as a reference
level of acceptable accuracy. Results of analogous test with bond lengths constraints applied to hydrogen atoms are
shown in Figs. 2(c,d). Again one can note a remarkable agreement between the two diﬀerent methods. The relative
ﬂuctuation of 0.1 corresponds to the well-known time step size level of 2 fsec. A similar agreement was observed
in simulations with all bond lengths ﬁxed, and it should be added that absolute values of all energy components
were very close in all comparative tests (results not shown). These results demonstrate that ICMD simulations are
as accurate as traditional MD and that both techniques suﬀer from similar time step limitations. Figures 2(a- d),
therefore, give an appropriate reference to which standard geometry ICMD simulations may be compared.

The results of ICMD tests performed with the set of variables corresponding to the standard geometry approximation
are shown in Figs. 2(e,f). Compared to Figs. 2(c,d) both the relative ﬂuctuation and the drift of the total energy are
considerably reduced. The time step size corresponding to the relative ﬂuctuation of 0.1 is 4 fsec, that is two times
larger than for all- atom models with ﬁxed bond lengths. This value is close to the well-known step size limit for
dynamics of rigid water molecules33, suggesting that the limitation is probably due to the fast rotation of hydorgen
atoms in hydrogen-only rigid bodies like hydroxyl or methyl groups. One can note that the observed increase in the
step size is rather moderate compared to earlier estimates obtained in simulations with smaller molecules22. The
apparent reason is that these fast rotations should mainly occur in protein cores, and so the test molecule must be
suﬃciently large and must include a large number of hydrogen-only rigid bodies for these limitations to be detected.
Figures 2 (g,h) present an additional proof of the fact that, in the above ICMD tests, the time steps are limited
by rotation of hydrogens and illustrates one simple possibility to get rid of this limitation. It is clear that rigid body
rotation can be slowed down by artiﬁcially increasing its inertia. Imagine, for instance, that in ethane (CH3-CH3) both
carbon atoms are no longer point masses, but rather spheres that rotate together with the neighboring hydrogens.
Rotation of hydrogens will be slowed down but the overall motion of the molecule will be perturbed only slightly
because atom masses do not need to be changed. This rather general trick can be employed at all levels for balancing
the time scales of diﬀerent motions in any hamiltonian system. Note, for instance, that a similar approach is applied
to electron degrees of freedom in the Car-Parrinello method42 and that the so called weighted mass MD43,44 is also
based upon this idea. Results presented in Fig. 5 (g,h) were obtained with point masses of atoms in the rotation
nodes of hydrogen-only rigid bodies replaced by spheres with the same mass and ﬁxed moments of inertia equal to 15
(atom mass unit)· ˚A2. As a result, both the drift and the relative ﬂuctuation are signiﬁcantly reduced compared to
Fig. 2(e,f). The time step size that corresponds to the relative ﬂuctuation of 0.1 is about 11-12 fsec.

Some comparative data on the computer cost of simulations in AMBER and in DY in diﬀerent modes are given
in the Appendix. Overall Table 1A shows that ICMD is complementary to the traditional MD. As expected, for
unconstrained simulations and for the two usual modes of bond length constraints AMBER is somewhat faster than

7

DY. On the other hand, in the standard geometry simulations the cost of a time step in ICMD is roughly the same as
in constraint dynamics with ﬁxed bond length to hydrogens. Thus, the observed increase in the step size is obtained
essentially for no cost, and in terms of computer time per picosecond ICMD gives the best score.

V. CONCLUSIONS

In recent years there has been a slow but steady progress in the development of techniques for ICMD. As shown
here, improved ICMD methodology now makes possible simulations of torsion dynamics of biopolymers that fulﬁll
the same strict criteria upon accuracy and stability as classical MD. Overall ICMD simulations within the standard
geometry approximation are at least two times faster than constraint dynamics.

It should be kept in mind, however, that the numerical tests presented here mainly serve to conﬁrm the validity
of the proposed equations. They do not prove that the method can be freely used in calculations of the physical
properties of molecules. It is known that even constraints upon bond lengths can, in certain cases, cause signiﬁcant
perturbations45, and that ﬁxing bond angles may signiﬁcantly aﬀect the conformational statistics via the so-called
metric tensor46,47,48. Eﬀects of each type of constraint upon the measured properties should, therefore, be thoroughly
studied. These reservations, however, are not that important for many applications in structural reﬁnement of
biopolymers26, in conformational searches and in simulations of protein folding.

ACKNOWLEDGMENTS

This study was initially motivated and partially based upon unpublished results obtained in collaboration with V.
E. Dorofeyev49. I wish to thank Dr. R. Lavery for useful discussions, without his support this work could have not
be ﬁnished. I also would like to thank Dr. G. Rodriguez of the Jet Propulsion Laboratory for making the set of his
reprints available for me in Russia.

APPENDIX: IMPLICIT LEAPFROG INTEGRATOR

To simplify notation let us consider the case of a single variable. Let θ and p denote the generalized coordinate and

the corresponding conjugate momentum. Eq. (19) may be rewritten as

where g = dU/dθ and f denotes the inertial term. Calculation of g may be denoted as (θ) → g, calculation of f as
θ, ˙θ
2 , ..., etc.
(cid:16)
Then the sequence of steps in the leapfrog integrator is expressed as

→ f , etc. The on-step values are denoted as θn, θn+1, ..., etc. and the half-step values as θn− 1

2 , θn+ 1

(cid:17)

˙p = g + f

(θn) → gn

pn+ 1

2 = pn− 1

2 +

gn + fn− 1

2

h

(cid:16)

(cid:17)

θn+ 1

2 = θn− 1

2 + h ˙θn− 1

2

θn+ 1

2 , pn+ 1

2

→ ˙θn+ 1

2

(cid:16)

(cid:17)

2

2 = θn− 1
→ fn+ 1

θn+ 1
2 , ˙θn+ 1
(cid:17)
pn+ 1
2 = pn− 1
→ ˙θn+ 1

2 , pn+ 1

2

2

2

θn+ 1

θn+ 1

(cid:17)






(cid:16)

(cid:16)

2 +

˙θn− 1

2 + ˙θn+ 1

2

h
2

(cid:16)

(cid:17)

2 + gnh +

fn− 1

2 + fn+ 1

2

(cid:16)

h
2

(cid:17)

(a)

(b)

(c)

(d)

8

(A1)

(A2)

(A3)

(A4)

(A5)

(A6)

θn+1 = θn + ˙θn+ 1

2 h

(A7)

where h denotes the step size.

The steps enclosed in the brace are repeated iteratively until convergence of Eq. (6A). The iterative cycle involves
two stages with non-trivial calculations given by Eqs (7A) and (9A). The half-step coordinates are corrected in Eq.
(6A) therefore the inversion of the mass matrix is implicitly involved in Eq.(9A), which makes the algorithm relatively
costly and leaves some room for possible improvements.

Some estimates of the CPU time made in the course of the numerical tests are given in Table 1A. The measurements
were made on a Silicon Graphics Crimson R4000-50 work station. DY was complied by a standard C-compiler with
the lowest level of optimization. In all calculations a relative tolerance of 10−6 was used as the criterion of convergence
of Eq.(6A). The cost of the matrix inversion calculations scales roughly linearly with the number of variables therefore
it is much less expensive in the standard geometry calculations. The average number of iterations depends upon the
molecular model and also upon the step size. With the optimal time steps it was minimal in the standard geometry
simulations (3.9) and maximal in simulations with ﬁxed bond lengths to hydrogens (9.5). Thus the standard geometry
approximation is the cheapest both because of the reduced number of variables and faster convergence. Evaluation
of forces takes similar time in AMBER and in DY.

1 M. P. Allen and D. J. Tildesley, Computer Simulation of Liquids (Clarendon Press, Oxford, 1987).
2 C. L. Brooks, III, M. Karplus, and B. M. Pettitt, Adv. Chem. Phys. 71, 175 (1988).
3 R. W. Hockney and J. W. Eastwood, Computer Simulation Using Particles (McGraw-Hill, New-York, 1981).
4 J. P. Ryckaert, G. Ciccotti, and H. J. C. Berendsen, J. Comput. Phys. 23, 327 (1977).
5 H. C. Andersen, J. Comput. Phys. 52, 24 (1983).
6 R. Edberg, D. J. Evans, and G. P. Morris, J. Chem. Phys. 84, 6933 (1986).
7 G. Ciccotti and J. P. Ryckaert, Comput. Phys. Rep. 4, 345 (1986).
8 D. J. Tildesley, in Computer Simulation in Chamical Physics, edited by M. P. Allen and D. J. Tildesley (Kluwer Academic

Publishers, London, 1993), pp. 23–47.

9 W. F. van Gunsteren and M. Karplus, Macromolecules 15, 1528 (1982).
10 E. Barth, K. Kuczera, B. Leimkuhler, and R. D. Skeel, J. Comput. Chem. 16, 1192 (1995).
11 J. Durup, J. Phys. Chem. 95, 1817 (1991).
12 J. Turner et al., J. Comput. Chem. 16, 1271 (1995).
13 S. Miyamoto and P. A. Kollman, J. Comput. Chem. 13, 952 (1992).
14 N. Grønbech-Jensen and S. Doniach, J. Comput. Chem. 15, 997 (1994).
15 N. G¯o and H. A. Scheraga, J. Chem. Phys. 51, 4751 (1969).
16 J. P. Ryckaert and A. Bellemans, Chem. Phys. lett. 30, 123 (1975).
17 M. R. Pear and J. H. Weiner, J. Chem. Phys. 71, 212 (1979).
18 J. W. Perram and H. G. Petersen, Mol. Phys. 65, 861 (1988).
19 A. K. Mazur and R. A. Abagyan, J. Biomol. Struct. Dyn. 6, 815 (1989).
20 R. A. Abagyan and A. K. Mazur, J. Biomol. Struct. Dyn. 6, 833 (1989).
21 A. K. Mazur, V. E. Dorofeyev, and R. A. Abagyan, J. Comput. Phys. 92, 261 (1991).
22 V. E. Dorofeyev and A. K. Mazur, J. Comput. Phys. 107, 359 (1993).
23 K. D. Gibson and H. A. Scheraga, J. Comput. Chem. 11, 468 (1990).
24 A. Jain, N. Vaidehi, and G. Rodriguez, J. Comput. Phys. 106, 258 (1993).
25 A. M. Mathiowetz, A. Jain, N. Karasawa, and W. A. G. III, Proteins: Struct. Funct. Genet. 20, 227 (1994).
26 L. M. Rice and A. T. Br¨unger, Proteins: Struct. Funct. Genet. 19, 277 (1994).
27 A. F. Vereshchagin, Engineering Cybernetics 6, 1343 (1974).
28 R. Featherstone, Robot Dynamics Algorithms (Kluwer Academic Publishers, Boston, 1987).
29 G. Rodriguez, IEEE J. Robot. Automat. RA-3, 624 (1987).
30 G. Rodriguez and K. Kreutz-Delgado, IEEE Trans. Robot. Automat. 8, 65 (1992).
31 V. E. Dorofeyev and A. K. Mazur, J. Biomol. Struct. Dyn. 10, 143 (1993).
32 M. G. Petukhov, A. K. Mazur, and L. A. Elyakova, Carbohydr. Res. 279, 41 (1995).
33 D. Fincham, Mol. Simul. 8, 165 (1992).
34 T. Noguti and N. G¯o, J. Phys. Soc. Japan 52, 3685 (1983).
35 H. Abe, W. Braun, T. Noguti, and N. G¯o, Comput. & Chem. 8, 239 (1984).
36 V. N. Branets and I. P. Shmyglevskii, Application of Quaternions in Rigid Body Orientation Problems (Nauka, Moskow,

1973).

9

37 D. J. Evans, Mol. Phys. 34, 317 (1977).
38 T. Gallagher, P. Alexander, P. Bryan, and G. L. Gilliland, Biochemistry 33, 4721 (1994).
39 F. C. Bernstein et al., J. Mol. Biol 112, 535 (1977).
40 D. A. Pearlman et al., AMBER 4.1 (University of California, San Francisco, 1995).
41 W. D. Cornell et al., J. Amer. Chem. Soc. 117, 5179 (1995).
42 R. Car and M. Parrinello, Phys. Rev. Lett. 55, 2471 (1985).
43 R. Pomes and J. A. McCammon, Chem. Phys. Lett. 166, 425 (1990).
44 B. Mao, G. M. Maggiora, and K. C. Chou, Biopolymers 31, 1077 (1991).
45 M. Watanabe and M. Karplus, J. Phys. Chem. 99, 5680 (1995).
46 M. Fixman, Proc. Natl. Acad. Sci. USA 71, 3050 (1974).
47 M. Fixman, J. Chem. Phys. 69, 1527 (1978).
48 W. F. van Gunsteren, Mol. Phys. 40, 1015 (1980).
49 V. E. Dorofeyev, Ph.D. thesis, Pasiﬁc Institute of Bioorganic Chemistry, Vladivostok, 1991.

FIG. 1. Illustration of the deﬁnition of external and internal coordinates in the molecule: α, β, γ, δ and ε denote atom
denote the global and the local coordinate

numbers; ω, ϕ and l are internal coordinates used to position atom δ; xyz and x′y′z′
frames, respectively. Detailed explanations are given in the text.

FIG. 2. Time step dependencies of the total energy drift and the relative ﬂuctuation for four models of PGB: (a) and
(b) - without constraints, (c) and (d) - with ﬁxed bond lengths to hydrogen atoms, (e) and (f) - in the standard geometry
approximation, (g) and (h) - in the standard geometry approximation with inertia of hydrogen-only rigid bodies increased as
described in the text. Thinner line - Cartesian coordinate dynamics by AMBER. Thicker line - internal coordinate dynamics
by DY.

TABLE I. Timing Comparisons. CPU time in seconds per one step of dynamics.

AMBER
DY

Aa
1.10
1.60

Bb
1.12
2.33

Cc
1.20
1.97

Dd
-
1.12

aNo constraints. Time step 1 fsec.
bFixed bond lengths to hydrogen atoms. Time step 2 fsec.
cAll bond lengths ﬁxed. Time step 2 fsec.
dStandard geometry. Time step 4 fsec.

10

δ

β

ε

γ

ϕϕ

ωω

y'

z'

x'

z

α

y

x

(a)

(b)

0.5

1

1.5

2

0.5

1

1.5

2

Time step (fsec)

Time step (fsec)

1

2

3

4

1

2

3

4

Time step (fsec)

Time step (fsec)

2

4

6

8

2

4

6

8

Time step (fsec)

Time step (fsec)

1

0.5

0.1

0.05

0.01

n
o
i
t
a
u
t
c
u
l
f
 
e
v
i
t
a
e
R

l

n
o
i
t
a
u
t
c
u
l
f
 
e
v
i
t
a
e
R

l

0.1

0.05

0.01

1

0.5

(d)

1

(f)

0.5

0.1

0.05

0.01

(h)

0.1

0.05

n
o
i
t
a
u
t
c
u
l
f
 
e
v
i
t
a
e
R

l

n
o
i
t
a
u
t
c
u
l
f
 
e
v
i
t
a
e
R

l

)
c
e
s
p
/
l
a
c
k
(
 
t
f
i
r

D

1

0.5

0.1

0.05

1

(c)

0.5

)
c
e
s
p
/
l
a
c
k
(
 
t
f
i
r

D

0.1

0.05

(e)

)
c
e
s
p
/
l
a
c
k
(
 
t
f
i
r

D

1
0.5

0.1
0.05

0.01

(g)

)
c
e
s
p
/
l
a
c
k
(
 
t
f
i
r

D

0.1

0.05

6

8

10

12

6

8

10

12

Time step (fsec)

Time step (fsec)

