5
0
0
2
 
y
a
M
 
0
3
 
 
]
h
p
-
m
e
h
c
.
s
c
i
s
y
h
p
[
 
 
1
v
5
0
2
5
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Tracing the Minimum Energy Path on the Free Energy Surface

Paul Fleurat-Lessard
Laboratoire de Chimie, ENS Lyon, 46 alle d’Italie, 69364 Lyon Cedex 07, France.

Tom Ziegler∗
Department of Chemistry, University of Calgary,
University Drive 2500
Calgary, Alberta, Canada T2N 1N4

The free energy proﬁle of a reaction can be estimated in a molecular dynamic (MD) approach by
imposing a mechanical constraint along a reaction coordinate (RC). Many recent studies have shown
that the temperature can greatly inﬂuence the path followed by the reactants. Here, we propose a
practical way to construct the minimum energy path directly on the free energy surface (FES) at a
given temperature. First, we follow the blue-moon ensemble method to derive the expression of the
free energy gradient for a given RC. These derivatives are then used to ﬁnd the actual minimum
energy reaction path at ﬁnite temperature, in a way similar to the Intrinsic Reaction Path of Fukui
on the potential energy surface [J. Phys. Chem. 74, 4161 (1970)]. Once the path is know, one
can calculate the free energy proﬁle using thermodynamic integration. We also show that the mass-
metric correction cancels for many types of constraints, making the procedure easy to use. Finally,
the minimum free energy path at 300K for the reaction CCl2 + H2C CH2 −→
CCl2 is compared

.........................................................

..........................................
..........................................

with a path based on a simple 1D reaction coordinate. A comparison is also given with the reaction
path at 0K.

I.

INTRODUCTION

Being able to understand, or better to predict, the evolution of a complex system is of critical importance in all
areas of chemistry and biology. In turn, this understanding requires the knowledge of not only the mechanism at a
microscopic level but also of the free energy change associated with the reaction under investigation. In principle,
molecular dynamic simulation can give access to the free energy proﬁle of chemical processes, and indeed, free energy
simulations have become a key tool in the study of many chemical and biochemical problems.1

However, chemical reactions are usually rare events and it would require a much too long simulation time for a
process to occur without any bias. Thus, ﬁnding an eﬃcient way to accurately compute the free energy diﬀerence for
a given reaction is still a very active ﬁeld of research.2–6 Several methods have been proposed to evaluate the change
of the free energy along a given path: free energy perturbation,7 umbrella sampling,8 thermodynamic integration9
and, more recently, the Jarzynski equality.5,6 (See also ref. 10 for a review.)

Of particular importance is the understanding of the link between constrained and unconstrained simulation, which
was put on ﬁrm basis a decade ago by Carter et al. who introduced the Blue Moon relation.11 During the past few
years, this relations has been reﬁned so that many formula are now at hand to evaluate the derivative of the free
energy along a given reaction coordinate.12–14

The access to analytical gradients on the potential energy surface was a very important step forward in standard
it became possible to ﬁnd the optimum geometry of complex systems, optimizing transition
quantum chemistry:
states became easier, and frequencies could be obtained much faster with a higher accuracy. On the other hand,
despite the fact that the exact equations for the evaluation of gradients of the free energy surface have been available
for many years, their use has mainly been restricted to the evaluation of the free energy change along a predeﬁned
path. Evaluating such a free energy proﬁle is common in both chemistry and biology. However, it seems that the
potential of free energy gradients has not been fully appreciated.

In this study, we propose to use the available equations for the gradient to explore the free energy surface in much
the same way as gradients have been used to explore the potential energy surface. Special attention will be given to
ﬁnding the minimum free energy path.

The account of this investigation is organized as follows: In the next section (Sec. II) we ﬁrst review the main
equations employed to evaluate the derivative of the free energy along a reaction coordinate in a uniform way. In
Section III, the scope of these expressions is extended, and their actual use in a simulation is discussed. In Section
IV, they are then used to ﬁnd a minimum energy path on the free energy surface for the addition of dihalide carbene
to ethylene. Section V oﬀers the concluding remarks.

2

(1)

(2)

(3)

(4)

(5)

II. THEORY

A.

Intrinsic Reaction Path

=

· · ·

midxi
∂V
∂xi

=

mjdxj
∂V
∂xj

= . . .

x′
i = √mixi

i = 1, . . . , 3N

=

· · ·

dx′
i
∂V
∂x′
i

dx′
j
∂V
∂x′
j

=

= . . .

=

· · ·

dx′
i
∂A
∂x′
i

dx′
j
∂A
∂x′
j

=

= . . .

We consider a chemical system composed of N atoms of mass mi described by 3N cartesian coordinates xi with
i = 1, . . . , 3N . We want to construct the minimum energy path connecting the reactants to the products on the free
energy surface (FES). On the potential energy surface (PES), K. Fukui15,16 has deﬁned such a path: the Intrinsic
Reaction Path (IRP). On each point of this path, the atomic cartesian coordinates satisfy

where V is the potential energy and mi is the mass of the atom with coordinate xi.
This equation can be simpliﬁed by using mass-weighted cartesian coordinates:

In its simpliﬁed form, equation (1) reads

Thus, the IRP corresponds to a steepest descent path using mass-weighted coordinates.
In this work, we want to construct a similar path on the FES. Therefore, we have to ﬁnd a path satisfying

where A stands for the Helmholtz free energy.

In order to ﬁnd this path, we have to calculate the gradient of the free energy for each point of this path.
In
practice, this path will be discretized by a set of k points in the conﬁgurational space, i.e., by the set of k molecular
geometries:

x′j =

x′j
n

i ; i = 1, . . . , 3N

, j = 1, . . . , k

o

B. Generalized coordinates

Even though one can use the 3N cartesian coordinates to describe the system and its evolution, it is usually easier
to employ a set of 3N-6 generalized internal coordinates, as well as the overall rotation and translation of the molecule.
Further, chemical intuition tells us that most of the time only a few degrees of freedom (reaction coordinates)
are suﬃcient to describe the reaction path. Thus, it appears natural to split the generalized coordinates into two
sub-sets corresponding to the active coordinates, denoted by ξ = (ξ1, . . . , ξr) and the inactive coordinates, denoted
by q = (q1, . . . , qn). A more quantitative criterion for this separation will be discussed later. These two sets are
associated with two groups of generalized momenta pq and pξ, and a velocity vector:

vqξ =

˙q
˙ξ

(cid:18)

(cid:19)

The IRP will then be constructed in the subset of active coordinates ξ.
This separation is similar to the adiabatic separation used in quantum dynamics between the slow modes (corre-
sponding to our active set) and the fast modes (corresponding to our inactive set). One common point is that the
inactive coordinates can vary along the reaction path. In other words, being inactive does not mean being frozen:
an inactive coordinate is characterized by the fact that it does not contribute to the direction of the minimum free
energy path as the thermal motions along these coordinates are nearly harmonic. However, motion along the inactive
coordinates might contribute to the changes in the free energy as the curvature of the harmonic potential changes
along the free energy path. This point will be illustrated in the application section.

It is worth discussing here the meaning of a structure on the potential and on the free energy surfaces. On the
potential energy surface, a structure corresponds to a stationary point: for such a point, the derivatives of the potential
are zero for all coordinates. On the free energy surface, we can use a similar description: a structure corresponds to a
point in which the derivatives of the free energy are zero for all coordinates. By deﬁnition of the inactive coordinate,
they do not contribute to a change in the direction of the minimum free energy path. Therefore, the derivative of the
free energy along an inactive coordinate is zero: ∂A
= 0 for all inactive coordinates. As a consequence, a structure
∂qi
can be deﬁne as a point in which the derivatives of the free energy are zero for all active coordinates. To complete
the geometrical description, we will use the thermal average of the inactive coordinates during the molecular dynamic
simulation.

C. Notations

Many expressions have already been proposed to evaluate the derivative of the free energy in a predeﬁne
direction.12–14,17–19 In this section, we will recall the expressions that will be used throughout this work. For the
sake of simplicity, the expression will be given in the case where the active set contains only one coordinate ξ. It is
worth noting that once the reaction path has been constructed, only one coordinate is needed because the reaction
coordinate can be uniquely deﬁne as the mass weighted curvilinear distance from the reactants to the point of interest
along the path.

We denote by J the Jacobian matrix for the transformation from cartesian coordinates to generalized coordinates.

x

(q, ξ):

→

and by

J

|

|

(cid:19)
its determinant (that is the Jacobian). We also deﬁne J′: the Jacobian matrix for the transformation

(cid:18)

J =

∂x
∂q

∂x
∂ξ

from mass weighted cartesian coordinates to generalized coordinates.
We introduced the mass matrix Aqξ deﬁned by: Aqξ = JtMJ
where M is a 3N
The generalized momenta are related to the velocity vector by:

3N diagonal matrix containing all atomic masses.

×

(cid:19)
(cid:18)
For further convenience, we decompose Aqξ and its inverse A−1
qξ into blocks:

(cid:19)

(cid:18)

(cid:18)

pqξ =

= Aqξ

=

˙q
˙ξ

Aq ˙q + Bξ ˙ξ
ξ ˙q + Cξ ˙ξ
Bt

pq
pξ (cid:19)

Aqξ =

Aq Bξ
Bt
ξ Cξ

(cid:18)

(cid:19)

A−1

qξ =

Xq Yξ
Yt
ξ Zξ

(cid:18)

(cid:19)

Some properties of these matrices are given in Appendix A.
Last, let us write explicitly the form of Zξ and Yξ:

Zξ =

(Yξ)j =

1
mi

∂ξ
∂xi

∂ξ
∂xi

1
mi

∂qj
∂xi

∂ξ
∂xi

3N

i=1
X
3N

i=1
X

=

=

3N

i=1
X
3N

i=1
X

∂ξ
∂x′
i

∂ξ
∂x′
i

∂qj
∂x′
i

∂ξ
∂x′
i

D. Gradient of the Free Energy

Q(ξ∗) =

dq

dpqdpξ exp (

βH)

−

Z

Z

The free energy A(ξ∗) is related to the partition function Q(ξ∗) by A(ξ∗) =

kBT ln (Q(ξ∗)). Therefore, a prereq-

−

uisite to the determination of

is the evaluation of

∂A
∂ξ

∂Q
∂ξ

.

The partition functions is deﬁned by:

3

(6)

(7)

(8)

(9)

(10)

(11)

where H is the Hamiltonian associated with our system:
1
2

H(q, ξ, pqξ) =

qξA−1
pt

qξ pqξ + V (q, ξ)

However, in a molecular dynamic simulation, constraining the reaction coordinate ξ to remain constant and equal
to ξ∗ implies imposing the additional constraint ˙ξ = 0. Therefore, the ensemble average during the MD simulation is
not the one needed in equation (11) because pξ is not sampled. When the reaction coordinate ξ is constrained to a
speciﬁc value, ξ = ξ∗, the Hamiltonian associated with the system becomes:

In the following, we will denote by

Hc

ξ∗(q, pq) =

qA−1
pt

q pq + V (q, ξ∗)

1
2

dq

dpq

exp

hOiξ∗ =

R

R
dq

O
dpq exp

βHc
ξ∗

−
βHc
ξ∗

(cid:16)
−

(cid:17)

the average of a function

(cid:17)
over the constrained ensemble. The notation
along pq and q while ξ remains constant and equal to ξ∗. The average for an unconstrained simulation is:

hiξ∗ indicates that the sampling is done

O

(cid:16)

R

R

R
The ﬁrst step in evaluating the derivative of the free energy is to relate these two averages.
R

=

hOi

dpqξO
exp (
dpqξ exp (

βH)
−
βH)
−

dqdξ
dqdξ
R
R

1.

Blue Moon Correction

Following the work of Carter et al.,11 we can rewrite the kinetic part of the unconstrained Hamiltonian as

qξA−1
pt

qξ pqξ = pt

qA−1

q pq +

pξ + Z −1

ξ Yt

ξpq

pξ + Z −1

ξ Yt

ξpq

t

Zξ

We can then rewrite the average value of an operator

(cid:16)

(cid:17)
independent of pξ:

(cid:16)

(cid:17)

dq

Z

Z

dpqξO

exp (

βH) =

dq

−

Z

Z

dpqO

exp

β

−

(cid:18)

O
1
2

qA−1
pt

q pq + V (q, ξ∗)

(cid:20)
dpξ exp

1
2

β

−

×

(cid:21)(cid:19)
pξ + Z −1
ξ Yt

ξpq

t

Zξ

pξ + Z −1

ξ Yt

ξpq

(17)

Using the deﬁnition of Hc

(cid:17)(cid:21)
ξ∗ and the properties of Gaussian integrals (see eq. (B1) of Appendix B), it comes:

(cid:16)

(cid:17)

(cid:16)

Z

(cid:20)

dq

Z

Z

dpqξO

exp (

βH) =

dq

−

dpqO

exp

Z

Z

βHc
ξ∗

Z −1/2
ξ

−
(cid:0)

Thus, the relation between the constrained and unconstrained simulations reads
Z −1/2
ξ
O
Z −1/2
ξ

Z −1/2
ξ
O
Z −1/2
ξ

(cid:16)
dpq exp

(cid:17)
βHc
ξ∗

dpq exp

βHc
ξ∗

= D

hOi

R
dq

dq

−

=

R

(cid:1)

ξ∗

E
ξ∗

−

(cid:16)

(cid:17)

D

E

which corresponds to the standard Blue Moon correction.11
Using equation (18), the partition functions can now be written:

R

R

which leads to:

Q(ξ∗) =

dq

dpq exp

βHc
ξ∗

Z −1/2
ξ

Z

Z

−
(cid:0)

(cid:1)
∂Hc
ξ∗
∂ξ −

β

−

(cid:18)

1
2

Z −1
ξ

∂Zξ
∂ξ

(cid:19)

∂Q(ξ)
∂ξ

=

dq

(cid:19)ξ∗

Z

Z

dpqe−βHc

ξ∗ Z −1/2
ξ

Starting from this equation, two diﬀerent procedures have been proposed. In the ﬁrst one, this equation is expanded
using the properties of the mass matrix and of the Gaussian integrals. The second one follows more closely the
philosophy of a MD simulation and tries to relate the derivative of the partition function to the force λξ acting on
the reaction coordinate ξ. These two procedures will be detailed in the next sections.

4

(12)

(13)

(14)

(15)

(16)

(18)

(19)

(20)

(21)

From equation (13), we have:

2. Expanding the Hamiltonian

∂Hc
ξ∗
∂ξ

=

1
2

pt
q

∂A−1
q
∂ξ

pq +

∂V
∂ξ

Plugging equations (B2) of Appendix B and (22) into equation (21), one ﬁnds:

dpqe−βHc

ξ∗ Z −1/2
ξ

1
2

Tr

Aq

 

 −

∂A−1
q

∂ξ ! −

β

∂V
∂ξ −

1
2

Z −1
ξ

∂Zξ
∂ξ !

∂Q(ξ)
∂ξ

=

dq

(cid:19)ξ∗

Z

Z

∂A−1
q
∂ξ

∂ ln|Aq|
∂ξ

=

−

(cid:16)

(cid:17)

Using Tr

Aq

and equation (A7), one ﬁnally gets:

(cid:19)ξ∗
In the case of multiple constraints, the derivative along the constraint ξi reads:12,17

ξ∗

(cid:10)

(cid:11)

∂A(ξ)
∂ξ

−1/2

Zξ |

|

= D

∂V
∂ξ −
(cid:16)
Zξ |
|

−1/2

kT ∂ ln|J|

∂ξ

ξ∗

(cid:17)E

∂V
∂ξi −
(cid:16)
Zξ |
|
(cid:10)
Although these formulas are exact, they are not as useful as one might have expected because they require the
knowledge of the full Jacobian matrix. This in turns implies that the full set of generalized coordinates is known,
which is something usually not desirable for a big molecule.

∂A(ξ)
∂ξi (cid:19)ξ∗

Zξ |

= D

(25)

−1/2

(cid:17)E

ξ∗

ξ∗

(cid:11)

|

kT ∂ ln|J|
∂ξi

−1/2

3. Relation with the Lagrange multiplier

In cases where constructing the full set of generalized coordinates q is not desirable, one has to get rid of the
explicit dependence of the previous equations on the Jacobian. This is what is done in the second approach: instead
of relating the derivative of the constrained Hamiltonian Hc
ξ∗ to the Jacobian, we will relate it to the force acting on
the reaction coordinate during the simulation.

Indeed, during a MD simulation, one makes use of the ergodicity principle, and the averages are actually perform
over time and not directly over the phase space. Then, in order to ensure that the reaction coordinate ξ is constant
and equal to ξ∗, a modiﬁed Lagrangian is used:

∗ =

L

vqξ

tAqξvqξ −

1
2

V (q, ξ)

+λξ(ξ

ξ∗)

−

L

where

is the Lagrangian of the unconstrained system and vqξ is the velocity vector. λξ is the Lagrange multiplier
associated with the reaction coordinate ξ. Its value is adjusted at each step of the simulation so that ξ = ξ∗. In
practice, the SHAKE algorithm was used for our simulations.20 In this algorithm, λξ is adjusted to ensure that ¨ξ = 0.

{z

L

|

}

For an unconstrained simulation, the equation of motion of the reaction coordinate is:

d
dt

∂
L
∂ ˙ξ (cid:19)

(cid:18)

=

∂
L
∂ξ

which gives:

dCξ
dt
Taking into account that ˙ξ = 0 in a constrained simulation, one has:

∂
L
∂ξ −

Cξ ¨ξ =

d
dt

Bt

ξ ˙q

−

(cid:1)

(cid:0)

˙ξ

Cξ ¨ξ =

∗
∂
L
∂ξ −
∂
L
∂ξ −

d
dt
d
dt

=

Bt

ξ ˙q

(cid:0)
Bt

ξ ˙q

(cid:1)
+ λξ

(cid:0)

(cid:1)

5

(22)

(23)

(24)

(26)

(27)

(28)

(29)

(30)

Demanding that ¨ξ = 0 in a constrained simulation, we have:

Using the deﬁnition of the Lagrangian, it comes:

λξ =

−

(cid:26)

∂
L
∂ξ −

d
dt

Bt

ξ ˙q

(cid:0)

(cid:27)
(cid:1)

λξ =

˙qt ∂Aq
1
2
∂ξ
t ∂A−1
q
∂ξ
d
dt

+

−

(cid:26)

pq

1
2
∂Hc
ξ∗
∂ξ

=

=

˙q

−

∂V
∂ξ −

pq +

+

∂V
∂ξ

d
dt

d
dt

Bt

ξ ˙q

(cid:0)

(cid:27)
(cid:1)
ξ ˙q

Bt

(cid:0)

(cid:1)

Bt

ξ ˙q

(cid:0)

(cid:1)

Inserting equation (34) in the expression for the derivative of the partition function gives

∂Q
∂ξ

=

β

−

Z

dpqdqe−βHc

ξ∗ Z −1/2
ξ

d
dt

λξ −
(cid:18)

Bt

ξ ˙q

+

1
2β

Z −1
ξ

∂Zξ
∂ξ

(cid:19)

(cid:0)

(cid:1)

In order to obtain the ﬁnal formula we need, we have to integrate analytically the term d
dt

Bt
ξ ˙q

. This will be

done by following the work of den Otter et al.13 First, we use:

(cid:16)

(cid:17)

Z −1/2
ξ

d
dt

Bt

ξ ˙q

=

(cid:0)

(cid:1)

d
dt

(cid:16)

Z −1/2
ξ Bt
ξ ˙q

+

Bt

ξ ˙qZ −1/2

ξ Z −1

ξ

dZξ
dt

1
2

(cid:17)

Z −1/2
ξ Bt
ξ ˙q

= lim
τ →∞

(cid:17)

τ

dt

d
dt

1
τ

0

Z

Z −1/2
ξ Bt
ξ ˙q
(cid:16)

(cid:17)

= 0

Using the ergodicity principle, we have:21

dpqdqe−βHc

ξ∗ d
dt

Z
dt = ˙qt ∂Zξ

(cid:16)
∂q , and thus:

As ˙ξ = 0, we have dZξ

Using equations (B2) and (A3), we get:

dpqdqe−βHc

ξ∗ Bt

ξ ˙q

Z

dZξ
dt

=

Z

dpqdqe−βHc

ξ∗ Bt

ξ ˙q ˙qt ∂Zξ
∂q

dpqdqe−βHc

ξ∗ Bt

ξ ˙q

dZξ
dt

dpqdqe−βHc

Bt

ξA−1
q

ξ∗ 1
β

∂Zξ
∂q

Z

=

=

Z

Z

dpqdqe−βHc
ξ∗

1
β

−

(cid:18)

Z −1
ξ Yt

ξ

∂Zξ
∂q

(cid:19)

Last,

and then

∂Zξ
∂xi

=

∂Zξ
∂qj

∂qj
∂xi

+

∂Zξ
∂ξ

∂ξ
∂xi

j
X

Yt
ξ

∂Zξ
∂q

=

Zξ

−

∂Zξ
∂ξ

+

∂ξ
∂x′

∂Zξ
∂x′

Collecting equations (35-39), we have shown

dpqdqe−βHc

ξ∗ Z −1/2

ξ

Bt

ξ ˙q

=

dpqdqe−βHc

ξ∗ Z −1/2

ξ

d
dt

(cid:0)

(cid:1)

Z

Z

1
2β

Z −1
ξ

∂Zξ
∂ξ −

1
2βZ 2
ξ

∂ξ
∂x′

∂Zξ
∂x′

 

!

6

(31)

(32)

(33)

(34)

(35)

(36)

(37)

(38)

(39)

(40)

7

(41)

(42)

(24’)

(41’)

Using this last equation, we recover the general formula derived by Sprik et al.,12 den Otter et al.13 and Darve et

al.:14

∂A
∂ξ

=

1
Z −1/2
ξ

D

ξ∗

E

Z −1/2
ξ

*

 

λξ +

1
2βZ 2

ξ (

i=3N

i=1
X

∂ξ
∂x′
i

∂Zξ
∂x′

i )!+ξ∗

This equation is readily evaluated during a simulation because all the terms depend only on known quantities such

as ξ and Zξ.

When many coordinates are constrained, the derivative along ξk reads:17,18

∂A
∂ξk

=

1
−1/2
Zξ |

|
(cid:10)

ξ∗ *|
(cid:11)

−1/2

Zξ |

λξk +





kT
Zξ |

|

2

j=r

j=1
X

(cid:0)

−1

Zξ

i=3N

kj

(

(cid:1)

i=1
X

∂

∂ξj
∂x′
i

Zξ |
|
∂x′
i )


+

ξ∗

4. Comparing the two procedures

At ﬁrst glance equations (24) and (41) seem very diﬀerent and it is not obvious that they both refer to the same

quantity. The connection between these formulas is more clearly seen if one rewrite their numerator:

∂A
∂ξ

∂A
∂ξ

=

=

*

*

Z −1/2
ξ

Z −1/2
ξ

1
2

1
2

 "

 "

pq

t ∂A−1
q
∂ξ

pq +

pq

t ∂A−1
q
∂ξ

pq +

∂V
∂ξ #

+

∂V
∂ξ #

+

1
2β

d
dt

Z −1
ξ

∂Zξ
∂ξ !+ξ∗

Bt

ξ ˙q

+

(cid:0)

(cid:1)

1
2βZ 2

ξ (

i=3N

i=1
X

∂ξ
∂x′
i

∂Zξ
∂x′

i )!+ξ∗

Then, inserting equation (40) into (41’) leads to (24’).

III. PRACTICAL CONSIDERATIONS

The exact formulas for evaluating the free energy derivatives have been recalled in the previous section. However,
actually using them in a molecular dynamic simulation requires to tackle two problems. The ﬁrst one is related to the
chemical system under study: one has to choose the coordinates that belong to the active space, so that all the relevant
coordinates are considered. The second problem is more technical: the previous formulas look quite complicated to
evaluate and one might wonder how to compute them eﬃciently. We will ﬁrst propose a way to decide whether a
coordinate should be included into the active space. Then, we will show that in many cases, the previous formulas
can be greatly simpliﬁed.

A. Monitoring the active space

The ﬁrst step of a molecular dynamic simulation aiming at calculating the change in the free energy along a
minimum energy path is to divide the degrees of freedom into active and inactive coordinates. Of course, it is possible
to consider all coordinates active and to calculate the complete set of derivatives using the previous formulas. However,
that would require to launch essentially one MD simulation for each degree of freedom: such a procedure would be
quite expensive. More, in contrast to the reaction path on the potential energy surface, not all degrees of freedom
are required: many degrees of freedom will move in a nearly harmonic well. As a consequence, the derivative of the
free energy along these modes is small, and one can safely discard them. Such a case is observed in the forthcoming
application for the CH distances of the ethylene molecule: the CH bond length slightly increases as the cyclopropane
is formed, but at each point of the reaction path, they move in a quasi-harmonic well. Hence, their contribution to
the direction of the minimum free energy path can be neglected.

Therefore, one must select only a restricted set of coordinates. However, for complex systems undergoing a reaction,
chemical intuition might not be suﬃcient. We propose here a way to construct the active and the inactive sets, and
to monitor this separation along the construction of the path. The value of the derivative of the free energy will be
used as a quantitative criterion to discriminate between active and non-active coordinates. Ideally, this derivative
should be zero for an inactive coordinate. However in practice, the actual reaction coordinate has non zero component

on all coordinates, including inactive coordinates. The criterion will then be to compare the derivative of the free
energy along an inactive coordinate to a given threshold. If it is bigger than this threshold then one must consider
incorporating qn into the active set. More, we will show that one can use the data of a simulation to estimate the
derivative of the free energy along an unconstrained coordinate.

Let us consider a system for which the beginning of the minimum free energy path has already been constructed as
. The purpose of this section if to detail the procedure to ﬁnd the next point, k + 1, of
a set of k points
the path. By deﬁnition of the reaction path, this point can be obtained by following the gradient of the free energy
along a small distance ds:

ξ0, . . . , ξk

(cid:1)

(cid:0)

ξk+1 = ξk +

gradA
gradA

ds

|
The previous formulas can be applied to the data of the MD simulation conducted at point ξk to calculate the
derivatives of the free energy along the active coordinates:
. Before constructing the point k + 1, we

|

∂A
∂ξi

i=1,...,r

should update the active and inactive sets: if the derivative of the free energy along an active coordinate is zero, then
this coordinate should be taken out of the active set. The reciprocal question is then: shall we include any of the
inactive qi variable into the active set in order to better describe the rest of the path ? Let us consider the coordinate
qn as an example. We will now give the expression of the derivative of the free energy along this inactive coordinate qn.
The previous formulas cannot be used directly because they necessitate that the coordinate under study is constrained
during the simulation. Let us denote by qk
n the particular value of qn at which we want to calculate the derivate of
the free energy along qn: ∂A
n,ξ. In order to evaluate this quantity, one can follow the same procedure as before,
qk
∂qn
and ﬁnds:

n

o

(cid:1)

|

= D

Zξ |

∂A(qn, ξ)

qk
n)
(cid:16)
−1/2 δ(qn −
∂qn (cid:19)qn=qk
n,ξ
(cid:11)
qk
n) which ensures that the average corre-
In this expression, we have explicitly included the delta function δ(qn −
sponds to a conditional sampling of the phase space in which qn is equal to qk
n.
If we want to avoid calculating the full set of generalized coordinates, we have to derive an expression similar to
the equation (41) for the coordinate qn. An important point here is that, in contrast to ξ, qn was not constrained
during the simulation. Therefore, the simulation data contain the sampling over pqn that would have been missing in
a simulation where both ξ and qn would have been constrained.

−1/2 δ(qn −
Zξ |

∂V
∂qn −
qk
n)

kT ∂ ln|J|
∂qn

(43)

|
(cid:10)

(cid:17)E

ξ

ξ

The expression for the derivative of the free energy along this unconstrained coordinate qn will be done in two steps.
In the ﬁrst step, we will establish the expression for the derivative of the free energy along an unconstrained reaction
coordinate, that is during a simulation without the constraint ˙ξ = 0. Then, we will use the Blue Moon relation to
obtain the expression of the free energy along a non active, unconstrained, coordinate qn during a simulation with a
constrained reaction coordinate ξ.

First, using equation (6), we have:

(cid:18)
Using this equation and eq. (A3), we can rewrite pξ:

(cid:19)

(cid:18)

˙q
˙ξ

= A−1
qξ

pq
pξ

=

(cid:19)

(cid:26)

Xqpq + Yξpξ
Yt
ξpq + Zξpξ

pξ =

−

Z −1
ξ Yt

ξpq + Z −1

ξ

˙ξ = Bt

ξA−1

q pq + Z −1

ξ

˙ξ

Remembering

(pξ), one ﬁnds:

∂H
∂ξ

=

d
dt

−

∂Q
∂ξ

= β

dpqdqdpξe−βH d
dt

(cid:26)Z

Bt

ξA−1

q pq

+

(cid:0)

Z

(cid:1)

dpqdqdpξe−βH d
dt

Z −1
ξ
(cid:16)

˙ξ
(cid:17)(cid:27)

The ergodicity principle allows us to say that the ﬁrst integral is zero. Therefore, we have:

∂Q
∂ξ

= β

dpqdqdpξe−βH d
dt

= β

dpqdqdpξe−βH

Z

Z

Z −1
ξ

(cid:16)
Z −1
ξ

¨ξ

˙ξ
(cid:17)
Z −2
ξ

−

(cid:18)

˙ξ

dZξ
dt

(cid:19)

8

(44)

(45)

(46)

(47)

We shall now pursue the derivation following a procedure similar to that of Darve et al.14,18
The second term of equation (47) reads:

dpqdqdpξe−βHZ −2

˙ξ

ξ

dZξ
dt

Z

dpqdqdpξe−βHZ −2

˙ξ

px′

ξ

ξ

∂Zξ
∂x′
∂Zξ
∂x′

(cid:16)

dpqdqdpξe−βHZ −2

˙ξ

J′−1

ξ pξ + J′−1

q pq

(cid:17)

=

=

Z

Z

We now introduce a new set of generalized momenta (

pq,

pξ) deﬁned by:

pq = pq
pξ = Z −1
f

ξ

(

f

e
˙ξ = pξ + Z −1

ξ Yt

ξpq

1
2

pqξ

tA−1

qξ pqξ =

pq

tA−1
q

pq +

1
2

e
pξZξ

pξ

1
2

This transformation is valid as it is invertible. Moreover, the Jacobian
these new variables, equation (16) reads:

e

|

J

|

associated with it is equal to 1. With

Equation (48) then reads

f

f

e

e

dpqdqdpξe−βHZ −2

˙ξ

ξ

=

dqe−βV

pqe− 1
2 β
d

pq

tA−1
q

pq

dZξ
dt

Z

Z

As the Hamiltonian is even in

Z

×

f
J

f
e− 1
2 β

pξ |
d
e

|

Z
pξ, after integration over

e

e

pξZξ

pξ Z −1
ξ

pξ

f

f

∂Zξ
∂x′

h

J′−1
ξ

pξ +

J′−1
(cid:16)

q −

pξ, only even terms remain:
e
e

Z −1
ξ Yt

ξ

pq

(51)

(cid:17)

i

f

Making use of eq. (B2) to integrate over

e

e

e

dqdpqdpξe−βHZ −2

e

˙ξ

ξ

dZξ
dt

=

e
pqd
dqd

pξ |

e−βHZ −1

pξ

ξ

2 ∂Zξ
∂x′

J′−1
ξ

Z
pξ, it comes:

|

J

e

Z

Z

dqdpqdpξe−βHZ −2

˙ξ

e
ξ

dZξ
dt

J

qd

dqd

pξ |
dqdpqdpξe−βH 1
e
e
βZ 2
ξ

e−βH 1
βZ 2
ξ
∂Zξ
∂x′

e

|

∂Zξ
∂x′
∂ξ
∂x′

J′−1
ξ

=

=

Z

Z

∂A
∂ξ

=

1
Q

Z

dpqdqdpξe−βH

Zξ ¨ξ +

 −

1
βZ 2
ξ

∂Zξ
∂x′

∂ξ
∂x′

!

Collecting the previous equations leads to:

This equation is the same as the one obtained by Darve et al. (eq. (24) of ref. 18), but we arrived at it with

diﬀerent assumptions.

Moon relation (see eq. 19), one ﬁnds:14,18

We now apply this equation to the case of a simulation where ξ is constrained but qn is not. Applying the Blue

∂A(qn, ξ)

=

∂qn (cid:19)qk
n,ξ

1
−1/2 δqn

Zξ |

−1/2 δqn

Zξ |

 −

Z −1

qn ¨qn +

kT
Z 2

qn (

i=3N

∂qn
∂x′
i

∂Zqn
∂x′

i )!+ξ

i

1
mi

∂qn
∂xi

where δqn stands for δ(qn −

|
(cid:10)
qk
n), and Zqn is the part of the inverse mass matrix corresponding to qn: Zqn =
. As already noted,18 this expression is slightly diﬀerent from equation (41), despite the fact that
they both relate the derivative of the free energy along qn to the force acting on qn during the MD simulation.
P
The origin of this diﬀerence comes from the nature of the sampling used to estimate the two expressions: equation
(56) corresponds to a conditional average performed during a simulation in which qn was not constrained whereas
equation (41) corresponds to a simulation in which both ξ and qn were constrained. It is worth stressing here that

∂qn
∂xi

i=1
X

ξ *|
(cid:11)

9

(48)

(49)

(50)

(52)

(53)

(54)

(55)

(56)

both expressions are valid but correspond to diﬀerent contexts. More, as long as the sampling along qn is suﬃcient,
evaluating the derivative of the free energy along qn during a simulation in which only ξ is constrained using the
conditional averaging of equation (56) will lead to the same numerical result as equation (41) using a MD simulation
with both ξ and qn constrained.

Practical use of this equation is described in Appendix D.
To conclude this section, we detail one possible use of equations (41) and (56) for the construction of a reaction
path on the free energy surface. We suppose as before that the active set is known and denoted by ξ, and that the
path is partially constructed, up to the point k corresponding to the value ξk =
i=1,...,r of the active coordinates.
To ﬁnd the next point ξk+1, one should:

ξk
i

(cid:8)

(cid:9)

1. Launch a simulation while constraining each active coordinates ξi (i = 1, . . . , r) to be constant, and equal to ξk
i .

2. Use formula (41) (or 24) to compute the derivative of the free energy along the active coordinates: ∂A
∂ξ .

3. If one derivative along an active coordinate is zero, the corresponding coordinate is taken out of the active set.

4. Then, use the same simulation data and equation (56) to evaluate the derivative of the free energy along the
∂q . If one derivative is not zero, then include it into the active set.

inactive coordinates ∂A

5. Recollect all derivatives to obtain the full gradient: gradA =

6. Construct the next point of the path by following the gradient of the free energy along a small distance ds:

t

∂A
∂ξ

, ∂A
∂q

t

t

.

n

o

ξk+1 = ξk + ds

gradA
gradA

|

|

Such a procedure has been used to study the addition of CCl2 to ethylene, and is explained in the section IV.

B. Special types of constraints

The preceding equations (24, 25, 43 and 56) have been derived without considering the actual form of the constraints.
Therefore, they are general but they look quite diﬃcult to compute eﬃciently. Despite the fact that a general
procedure has already been given by Darve et al.,14, we would like to show here that many common constraints lead
to considerable simpliﬁcations of the previous expressions. Four cases are described here in which Zξ is a constant.
In those cases, the previous equations become:

If the reaction coordinate is chosen to be the bond distance between atoms i and j, we have:19

ξ = dij =

xj )2 + (xi+1

xj+1)2 + (xi+2

xj+2)2

−

−

(xi −
1
mj (cid:19)

q
+

1
mi

(cid:18)

Zξ =





Care must be taken when constraining many bond distances. In this case, Zξ might no longer be a constant, and the
above simpliﬁcations should not be applied blindly. Let us consider a simulation with two constrained bond distances.
Two cases can be met depending on whether these two bonds share a common atom or not.

We consider ﬁrst the case where the two bonds do not share a common atom: for example, bonds between atoms

i and j and between k and l. The matrix Zξ is:

∂A
∂ξ

∂A
∂qn

=

h

λξiξ∗
δqn (

= h

Zqn ¨qn)
−
δqn iξ∗
h

iξ∗

1. Bond distance

Zξ =

0
Zdij
0 Zdkl(cid:19)

(cid:18)

10

(57)

(58)

(59)

(60)

with, Zdij = 1/mi + 1/mj and Zdkl = 1/mk + 1/ml. As a consequence,
one can use simpliﬁed equations (57) and (58).

Zξ |

|

is equal to

Zdij ||

Zdkl |

|

and is a constant:

Let us consider now the case where the constrained bonds share a common atom: for example bonds between atoms

i and j and between atoms j and k. We also denote by α the angle between the three atoms:

The matrix Zξ reads:

Zξ |

|

As a consequence,

is no longer a constant and equations (42) and (56) must be used.

Another commonly used reaction coordinate is the diﬀerence of two distances. Once again, one has to consider the
case where the two distances share a common atom or not. When the two bonds are not sharing any atom, i.e when
they are involving atoms i, j, k and l, we have:

On the other hand, when the two distances share a common atom j, the previous equations become:

So that Zξ is not a constant and the correction terms should be evaluated explicitly.


Another quite common reaction coordinate is the mass-weighted distance between one reference geometry and the
the cartesian coordinates of the reference geometry.

current geometry of the system.19,22 We note
We have:

yi; i = 1, . . . , 3N
{

}

dij

djk

j

α

i

k

Zξ =

Zdij
cos α
mj

 

cos α
mj
Zdjk !

ξ = dij −
1
Zξ =
+
mi

dkl
1
mj




+

1
mk

+

1
ml


ξ = dij −
1
+
Zξ =
mi

djk
1
mk




2
mj

+

(1

cos α)

−

2. Generalized distance

mi(xi −

yi)2

ξ =

i

sX

Zξ = 1






3. Bond angle

Zξ = Zα =

1
mid2
ij

+

1
mkd2
jk

+

d2
ik
ijd2
mjd2
jk

Zα
sin α
mj djk
sin α
mj dij

−

sin α
mj djk −
Zdij
cos α
mj

sin α
mj dij
cos α
mj
Zdjk






Zξ = 

−
−




We now consider constraining the angle α between the atoms i, j and k, that is the angle between the bonds ij

and jk. We denote by dij , djk and dik the distances between these atoms. With these notations, Zξ Reads:23

Therefore, Zξ is not a constant and one must use the complete formulas. However, if the bond distances dij and
djk are also constrained, the formulas can be simpliﬁed. When considering a simulation with α, dij and djk all
constrained, Zξ reads23

11

(61)

(62)

(63)

(64)

(65)

(66)

Developing

, one ﬁnds:

Zξ |

|

Thus, the derivatives
equation (42) reads:

∂
∂xi

Zξ |

|

of

Zξ |

|

are not zero but

is constant during a simulation. Using this fact,

Zξ |

|

Zξ |

|

= Zα

(cid:18)

1
mimk

+

1
mimj

+

1
mjmk (cid:19)

∂A
∂ξk

=

1
Qc
ξ∗
j=r

j=1
X

+

λξk i
h
(cid:18)

k
T
i
h
2Zα

i=3N

Bk

(cid:19)
∂ξk
∂x′
i

kj

(

i=1
X

∂Zα
∂x′

i )

with Bk =

−1

Zξ

(cid:1)
As α, dij and djk are all constrained, Zα and thus Bk are easily computed during (or after) the simulation. We
conclude the discussion of this case by noting that despite the fact that one should take the corrective terms khT i
Bk
2Zα
into account, they are of the order of magnitude of some tenth of kT and thus one might wonder if they are negligible
or not. This point will be discussed in greater details in the next section.

(cid:0)

4. Linear Constraint

Linear constraint can be written as ξ =
This type of constraint has already been used in order to calculate the free energy change along a predeﬁned IRC.24
These constraints are of considerable practical importance. First, in a simulation, it is quite common to constrain
also the global rotation and the global translation of the molecule. Equations similar to the previous equations (24)
and (43) can be derived by replacing
. By construction, the global rotation and translation are
|
orthogonal to all internal coordinates. Therefore, we have =

i aixi and thus, Zξ =

i is a constant.

Zξ,T,R

Zξ |

by

P

P

|

|

ZT,R

i m−1

i a2

We show in appendix C that constraining the overall rotation and translation corresponds to applying six additional

Zξ ||

|

.
|

linear constraints on the system.
As a consequence, the term

energy, leading to the following formulas:

ZT,R

|

|

is a constant that can be ignored when calculating the derivatives of the free

∂A
∂ξ

(cid:19)ξ∗

= D

Z −1/2
ξ

kT ∂ ln|J|

∂ξ

∂V
∂ξ −
Z −1/2
ξ

(cid:16)

ξ∗,T,R

(cid:17)E

∂A
∂ξ

=

D

1
Z −1/2
ξ
D

ξ∗

E

ξ∗,T,R

E
Z −1/2

ξ

*

 

λξ +

1
2βZ 2

ξ (

i=3N

i=1
X

∂ξ
∂x′
i

∂Zξ
∂x′

i )!+ξ∗,T,R

Second, let us consider a simulation with many active coordinates, all described by linear constraints (which may
include the translation and rotation constraints). Let us denote by
the r linear constraints applied
during the simulation. We have

ξi; i = 1, . . . , r
{

}

ξi =

cijxj

j=3N

j=1
X

For i in1, . . . , r

The Lagrangian associated with this simulation is:

∗ =

˙xtM ˙x

V (x) +

L

−

1
2

λi (ξi −

∗)

ξi

r

i=1
X

The equations of motion are then:

mj ¨xj =

∂V
∂xj

−

+

λi

∂ξi
∂xj

i=r

i=1
X

For j in 1, . . . , 3N

(74)

12

(67)

(68)

(69)

(70)

(71)

(72)

(73)

13

(76)

(77)

(78)

(79)

(80)

(81)

(82)

(83)

Demanding that ¨ξi = 0 for all i in 1, . . . , r leads to a set of coupled linear equations:

1
mj

∂V
∂xj

−

3N

j=1
X

k=r

j=3N

cij +

λk

Xk=1

j=1
X

ckj cij
mj

= 0

For i in 1, . . . , r

(75)

To ﬁnd the forces acting on the constraints, i.e. to ﬁnd the values of all λk, we have to solve this linear system. We
deﬁne:

1
mj

∂V
∂xj

cij

Di =

j
X

For i in 1, . . . , r

Using the deﬁnition of Zξ, it is easily seen that the term
notation, equation (75) reads

j=3N
j=1

ckjcij
mj

corresponds to the element [Zξ]ik. In matrix

P
Zξλ = D

which is easily solved by inverting the matrix Zξ which depends only on the deﬁnition of the linear constraints
ξi. This last expression can be further simpliﬁed when the constraints are expressed in the mass-weighted cartesian
coordinates frame:

ξi =

j=3N

j=1
X

cij
√mj

x′
j

For i in 1, . . . , r

Requesting that the linear constraints form an orthonormal set in the mass weighted basis leads to:

j=1
X
Therefore, in the case of orthogonal constraints, the inverse of the mass matrix Zξ reduces to the identity matrix and
the previous equations (76-77) become

ξi |
h

ξki

=

j=3N

cijckj
mj

= δik

λi =

3N

j=1
X

1
mj

∂V
∂xj

cij

More, equation (42), that should be used to calculate the free energy derivatives in the case of multiple active
coordinates, reduces to its simplest form, similar to (57):

∂A
∂ξk

=

λξk iξ∗

h

For k in 1, . . . , r

This illustrates one convenient property of orthogonal linear constraints: they are all decoupled which leads to
considerable simpliﬁcation for the calculation of the free energy derivatives.

However, the most interesting aspect of these constraints appears when one consider that the full set of generalized

coordinates consists of linear coordinates:

For i in 1, . . . , r

For k in r + 1, . . . , 3N

ξi =

qk =

cij
√mj

x′
j

ckj
√mj

x′
j

j=3N

j=1
X
j=3N

j=1
X

j=3N

j=1
X

Fqk =

1
mj

∂V
∂xj

ckj

Using the previous equations, one ﬁnds that the force acting on an inactive coordinate qk during the MD simulation
is

For k in r + 1, . . . , 3N

(84)

Comparing equations (80) and (84) shows that the eﬀect of the Lagrange multiplier λi is to exactly compensate

the force acting on the active coordinate ξi during the MD simulation, thus ensuring that it remains constant.

These last equations show the advantage of linear constraints over other constraints: one can estimate the gradient
of the free energy for the full set of generalized coordinates by analyzing the data of one MD simulation. The only
condition is to have suﬃcient sampling along non active coordinates. Therefore, one can launch a simulation with a
small active set, ideally comprising only the reaction coordinate, without loosing any information.

IV. APPLICATION

It is worth noticing that once we have an expression from which to calculate the free energy derivatives, we can
apply the same algorithms as those used in quantum chemistry in connection with potential energy gradients. For
example, it is possible to optimize a structure directly on the free energy surface in the subset of the active coordinates.
It is further possible to ﬁnd a transition state along a path, to calculate the Hessian by ﬁnite diﬀerence, and thus
to characterize the structures anywhere on the path. This will be applied in this section to the addition of CCl2 to
CCl2. We will ﬁrst optimize the structure of the transition state and the product
ethylene: CCl2 + H2C CH2 −→
at 300K, and compare the geometrical parameters to those of the 0K geometries. We will then focus on constructing
the minimum free energy path at 0K and 300K.

...............................................
...............................................

This reaction has already theoretically been studied in our group,25 as well as in other groups.26,27 In particular,
possible deﬁciencies of the DFT methods to describe the long range interactions have already been stressed. However,
our goal here is to construct the reaction path on the free energy surface for this reaction and to compare it with
the path obtained with a predeﬁned reaction coordinate. In such a comparison, the accuracy of DFT is not the main
issue.

...............................................................

Previous studies have shown that the reaction proceeds in two steps: the ﬁrst phase corresponds to the electrophilic
addition of the carbene to one of the carbons making up the double bond. This phase proceeds through a transition
state that has been optimized. The ﬁnal phase is a nucleophilic attack on the second carbon of the double bond to
close the cycle. This phase proceeds without any barrier, directly after the ﬁrst one:

+

CCl2

CCl2

CCl2

CCl2

As already noticed,25 the distance between the center of the double bond and the carbon of the carbene is a good
reaction coordinate for the ﬁrst phase, but is not suﬃcient to accurately describe the second phase. Therefore, we
have decided to include three coordinates into the active set: dCC : the ethylene CC bond distance, dCG: the distance
between the carbon atom of the carbene and the center of the double bond denoted by G, and α the angle between
the double bond and this last distance. This is depicted on the following scheme:

C3

C
C
d

G

C1

dCG

α

C2Cl2

ZdCG
0
0

0
ZdCC
0

0
0
Zα





Zξ =





For further reference, the previous study using only the dCG distance as a reaction coordinate will be referred to
as the 1D study by opposition to the present study that uses a 3 coordinates active set and will thus be referred to
as the 3D scheme.

The Zξ matrix corresponding to the constraints dCG, dCC and α reads:

This form the the Zξ matrix is quite diﬀerent from that obtained in eq. (66) for a system of two bonds sharing a
common atom. This comes from the fact that the elements of this matrix are deﬁned with respect to the coordinates
of the atoms C1, C2 and C3 whereas α and dGC are deﬁned with respect to C1, C3 and G. As G is the center of mass
of C1C3, it plays a symmetric role in the expressions of the elements of the Zξ matrix, leading to compensating terms
which sum up to zero. As an example, let us consider the oﬀ diagonal term ZdCC dCG between the double bond C1C3

14

(85)

15

(86)

(87)

(88)

(90)

(91)

(92)

(93)

(94)
(95)

(96)

(97)

(98)

and the distance GC2. Simple algebra gives

which leads to

i=3

1
mi

ZdCC dCG =

∂dCC
∂x1 (cid:18)
Similar cancellations appear for the other non diagonal terms.
We will now give the expression of ZdCG, ZdCC and Zα. Even though in our case all three atoms have the same
mass, we will write the following formula for the general case where all three atoms have diﬀerent masses and G is
the center of mass of C1C3. Tedious but straightforward algebra leads to:

∂dCC
∂x3 (cid:19)

∂dCG
∂x1 −

∂dCG
∂xi

∂dCC
∂xi

1
m1

1
m3

i=1
X

(89)

= 0

=

=

∂dCC
∂x3

−

= 0

∂dCC
∂x1
∂dCC
∂x2
∂dCG
∂x1

1
m1

=

1
m3

∂dCG
∂x3

xG =

ZdCG =

ZdCC =

Zα =

m1x1 + m3x3
m1 + m3
1
m1 + m3
1
m3

+

+

1
m2
1
m1
ZdCG
d2
CG

+

ZdCC
d2
CC
= ZαZdGC ZdCC

Zξ |

|

Finally, derivatives of the free energy read:

λdCGi −
h

λdCC i −
h

k < T >
Zα
k < T >
Zα

ZdGC
d3
CG (cid:19)
ZdCC
d3
CC (cid:19)

∂A
∂dCG
∂A
∂dCC
∂A
∂α

=

=

=

(cid:18)

1
Q
1
Q
1
Q h

(cid:18)
λdCGi

A. Stationary points

1. Transition State

Optimization of the transition state structure was carried out by employing the quasi-Newton scheme28 using the
formula proposed by Boﬁll to update the Hessian.29 This procedure will be described in details elsewhere.30 This
quasi-Newton scheme is an iterative procedure that requires initial values of the three parameters dCG, dCC and α.
These values were taken from the previous 1D study,25 in which the transition state (TS) was located at dCG = 4.5
a0: this was taken as the initial value of dCG for our 3D optimization. The thermal average of the ethylene bond
length and of the angle during the previous 1D simulation with dCG = 4.5 a0 were taken as initial values for dCC
and for the angle α. The Hessian at this initial geometry was calculated employing ﬁnite diﬀerences of the gradients.
Diagonalization lead to only one negative eigenvalue proving the transition state nature of the starting point. The
Hessian matrix was also calculated and diagonalized for the ﬁnal geometry: we found only one negative eigenvalue,
corresponding to an eigenvector directed mainly along the dCG variable.

The resulting geometry is reported on ﬁgure 1, together with the geometry obtained at 300K when only dCG is

constrained, as well as the geometry obtained on the PES at 0K.

16

FIG. 1: Transition states geometries for the addition of dichlorocarbene CCl2 to ethylene, optimized at 0K, at 300K with only
the dCG distance constrained (1D), and at 300K with dCG, dCC and α all constrained (3D). G is the midpoint of the double
bond. Distances in ˚A, angles in deg.

2.405

2.405

2.487

115

°

1.364

116

°

1.362

300 K - 1D

300 K - 3D

116.5

°

1.356

0 K

dCG (˚A)

dCC (˚A) α (deg.)
1D 2.405(2)(a) 1.364(2)(b) 115(1)(b)
3D 2.405(2)
116(1)
116.5
0K

1.362(2)
1.356

2.487

TABLE I: Main geometrical parameters for the transition state geometries for the addition of the dichlorocarbene CCl2 on
ethylene, optimized at 0K, at 300K with one constraint (1D), and at 300K with three constraints (3D). (a) Estimate of the
uncertainty. The uncertainty for structures on the potential energy surface is much smaller, and thus not quoted. (b) Average
values.

All three structures are non symmetric: the α angle is approximately equal to 115° instead of 90°. This is in
agreement with the Woodward-Hoﬀman rules and with previous calculations27,31–34 and experimental results.34 More,
all geometries correspond to an early transition state in which the ethylene molecule is only slightly distorted. The
double bond length equals approximately 1.36 ˚A, close to the equilibrium distance in the free molecule: dCC = 1.33
˚A.

The two structures found at 300K are almost identical. This is not surprising: as already stated the distance dCG
between the middle of the double bond and the carbon atom of the carbene is a good reaction coordinate up to this
point.

The transition state geometry at 0K is in fairly good agreement with previous ab initio calculations27,31–33 except
for the dCG distance which is slightly overestimated here: dCG = 2.487 ˚A compared to dCG = 2.37 ˚A at the B3LYP/6-
31G* level,33 or dCG = 2.38 ˚A at the MP2/6-31G* level.27,32,33 This is due to the fact that this region of the potential
energy surface is shallow so that the location of the transition state depends strongly on the functional and on the
it equals 116.5° in our study, whereas it equals
basis set used. Similarly, the α angle is also a bit overestimated:
respectively 111.7° and 112.2° at the MP2/6-31G* and B3LYP/6-31G* levels of calculation.27,32,33

Going from the transition state structure found at 0K to that obtained at 300K leads to an increase of the double
bond length due to thermal vibrations. On the other hand, the dCG distance is smaller at hight temperature. This
comes from the fact that the barrier originates mainly from rotational entropy lost when the transition state is
formed. As the average rotational momentum increases with the temperature, we expect this barrier to move to
smaller distance as the temperature rises. This is in agreement with previous studies.25,30

2.

1,1’-dichlorocyclopropane

The main geometrical parameters for the 1,1’-dichlorocyclopropane are reported in Table II and the corresponding
structures are given in Figure 2. All three structures are very symmetric: α = 90° which means that the carbon atoms
form an isocel triangle, its base being the former ethylenic bond. All three carbon-carbon bond length are now close
to that of a single bond: dC 1C 3 = 1.53 ˚A, dC 1C 2 = dC 3C 2 = 1.50 ˚A.

Similarly to what was observed for the transition state structures, there are very little diﬀerence between the room
temperature 1D and 3D structures. This comes from the fact that the gradient is zero for a minimum, so that
the deﬁnition of the reaction coordinate does not matter anymore. To further assess this point, we have launched a
simulation with no constraints. The average values of dCG, dCC and α are in very good agreement with the constrained
simulations: dCG = 1.291

0.002 ˚A, dCC = 1.533

0.002 ˚A and α = 90.

1°.

The 0K structure is in good agreement with previous calculations: the diﬀerence in distances and angles is less

±

±

±

17

FIG. 2: Geometries of the 1,1’-dichloro cyclopropane optimized at 0K, at 300K with only the dCG distance constrained (1D),
and at 300K with dCG, dCC and α all three constrained (3D). G is the midpoint of the double bond. Distances in ˚A, angles in
deg.

1.500

61.3

1.499

61.4

1.497

61.3

1.535

1.532

300 K - 1D

300 K - 3D

1.527

0 K

dCG (˚A)

dCC (˚A) α (deg.)
1D 1.289(2)(b) 1.535(2)(b) 90(1)(b)
3D 1.289(2)
90(1)
90.1
0K

1.532(2)
1.527

1.288

TABLE II: Main geometrical parameters for the 1,1’-dichlorocyclopropane, optimized at 0K, at 300K with one constraint (1D),
and with three constraints (3D). (a) Estimate of the uncertainty. (b) Average values.

then 0.01 ˚A, and 1°, respectively.31 When going from 0K to 300K, the C-C bonds elongate, while dCG and α remain
constant. This comes from the fact that this molecule has a C2v symmetry which imposes that the average angle
should be close to its value on the potential energy surface.

B. Reaction Path

We focus now on the core of this application: the construction of the reaction path connecting the reactants to
the product, directly on the free energy surface. The aim of this part is dual: ﬁrst, we show how to use the previous
formula on a real example. Second, we compare the 3D path constructed here to the path obtained with only one
‘chemically intuitive’ reaction coordinate. Starting from the transition state, we have constructed the forward reaction
path leading to the product and the backward path leading to the reactants.

In this work, we have moved along the gradient employing a small step size: at each point xk of the path, a
simulation is launch while constraining all three active coordinates dCG, dCC and α. The previous formulas ((96),

(97) and (98)) are used to compute the free energy gradient: g =

into a normalized mass weighted gradient: gMW =
by following the gradient on a small distance ds:

N

Zξg, with

N

t

, ∂A
∂dCC

∂A
. We then convert this gradient
∂dCG
= (gtZξg)−1/2. The next point xk+1 is calculated
(cid:16)

, ∂A
∂α

(cid:17)

xk+1 = xk

ds

gMW

(99)

−
An alternative way is to employ the scheme derived by Gonzalez et al.35 which allows for the use of a much bigger
stepsize. The forward path corresponds to the closure of the cycle, that is to say to the formation of the second
carbon-carbon bond. The gradient along this path is large, and we used a stepsize of 0.5 a.u.43 The backward path
corresponds to the departure of the carbene, which is the reverse of the electrophilic addition. The change in free
energy is small in that direction, and we had to employ a smaller stepsize of 0.2 a.u. to minimize the statistical noise.

×

1. Free energy proﬁle

The resulting free energy proﬁle (FEP) is reported in Figure 3 together with the proﬁle generated with one
constraint.25 In order to compare them, both paths have been plotted using the dCG distance as an approximate
reaction coordinate. The FEP obtained in the present work is given as an inset in Figure 3. The two proﬁles are very
similar: ﬁrst, the free energy increases smoothly from the isolated reactants to the transition state. Then, it decreases
abruptly when the cyclopropane is formed.

On an energetic ground, in agreement with the fact that the free energy is a state function, both path lead to a
mol−1 in
mol−1 in this work, and ∆Acorr = -46.5 kcal
similar change in free energy equal to: ∆Acorr = -47.6 kcal
·
·
our previous work, when employing 40000 steps. More, as dCG is a good reaction coordinate for the ﬁrst phase, the
mol−1
barrier is also similar in both cases: ∆AT S
11.7 kcal
·
previously. These values are in good agreement with the previous studies.25,32

mol−1 in this work, compared to ∆AT S
11.5 kcal
·

corr ≈

corr ≈

18

)
l
o
m

/
l
a
c
k
(
 

A
∆

 0

−20

−40

)
l
o
m

/
l
a
c
k
(
 

A
∆

 0

−20

−40

1D
3D

3D

−8

−4

 0
s (a.u.)

 4

 1.5

 2

 2.5

 3.5

 4

 4.5

 5

 3
dCG (Å)

FIG. 3: Free Energy Proﬁle (FEP) for the addition of dichlorocarbene CCl2 to ethylene. The 1D proﬁle is calculated using
dCG as the predeﬁned reaction coordinate, whereas the 3D proﬁle uses an active set of three coordinates (dCG, dCC , α). The
inset shows the FEP plotted against the curvilinear distance from the transition state along the 3D path. G is the midpoint of
the double bond.

2. Geometrical parameters

≈

Even thought the two free energy proﬁles are similar, the two path are actually quite diﬀerent in terms of geometrical
parameters. We discuss here the variations of the structural parameters dCC and α for both path. The evolution of
the double bond distance dCC and of the α angle obtained in this study are reported on Figure 4 together with the
average values

obtained in the previous study using only dCG as a reaction coordinate.

and

The ﬁrst feature worth noting is that the forward path, corresponding to the the formation of the second C-C bond,
is not parallel to the dCG axis but acquires contributions along both dCC and α. This conﬁrms that an accurate
description of this step requires a more complex reaction coordinate than just the dCG distance. As a consequence,
despite the fact that dCG varies only from 2.40 ˚A to 1.29 ˚A for the second phase, the actual path length is of the
same order of magnitude as for the ﬁrst phase: s

10 a.u.

dCC i
h

α
i

h

The evolution of the two structural parameters dCC and α can be divided into three zones. The ﬁrst one corresponds
to dCG & 2.6 ˚A. In this zone, there is little interaction between the two reactants: dCC is constant and equal to 1.33 ˚A,
which is the standard double bond length, and α tends to 90°.44 This comes from the fact that, for the unconstrained
system, at large separation there is free rotation of the carbene around the ethylene molecule. As a consequence, α
should vary freely between 0° and 180°, with an average value of 90°.

The second zone corresponds to the electrophilic addition, that is the formation of the ﬁrst bond between the
carbene and the ethylene molecule. In this zone, dCG evolves from ca. 1.8 ˚A to ca. 2.6 ˚A. As the two molecules start
to interact the ethylenic bond elongates from 1.33 ˚A to ca. 1.48 ˚A. As expected, this last value is intermediate between
a single and a double carbon-carbon bond length. Simultaneously, α increases to 128°. This is a consequence of the
fact that the symmetric approach for which α = 90° is forbidden, and is thus associated with a very high barrier.34
During this phase, the C1C2 bond is formed: this distance decreases from 2.4 ˚A to 1.56 ˚A, which is close to a single
bond.

The last zone corresponds to dCG ≤

1.8 ˚A and represents the closure of the cyclopropane ring. The C1C3 bond
(formerly the double bond) length increases to its ﬁnals value of 1.538 ˚A, while α drops to 90°. Comparing the path
constructed using a 3 coordinates active space to the path previously obtained shows that α is a much better reaction
coordinate for this phase than dCG. Indeed, during this phase the C1C2 distance is almost constant and close to
1.54 ˚A, while the C3C2 distance decreases strongly from 2.3 ˚A to 1.54 ˚A. This illustrates that the second phase of
the reaction is actually the bending of the C1C2 bond towards the C3 carbon atom. For this type of movement α

1D
3D

A

1.55

 1.5

1.45

 1.4

1.35

 120

 110

 100

  90

)

Å

(
 
C
C
d

 
)
.
g
e
d
(
 
α

1.5

2

2.5
dCG (Å)

3

3.5

in the dCC − dCG and
FIG. 4: Reaction path for the addition of dichlorocarbene to ethylene. Two projections are show:
α − dCG subspace, G being the midpoint of the double bond. The 1D path is obtained using dCG as the reaction coordinate,
whereas the 3D path uses an active set of three coordinates (dCG, dCC , α).

is a good reaction coordinate whereas dCG is a poor one. As a consequence, when only dCG is used as a reaction
coordinate, α drops abruptly from 115° to 90° around dCG = 1.36 ˚A. On the other hand, the variations of α are much
smoother with our active set.

To conclude this section, we would like to point out that, as expected, both path are qualitatively similar, with
the same overall evolutions of the geometrical parameters. However, they diﬀer signiﬁcantly on a quantitative basis,
especially in the third zone. This is due to the fact that dCG is not a good approximation to the reaction coordinate
in this zone. To illustrate how this explains why the two path are diﬀerent, let us consider a force acting on the dCC
variable at the point A (Fig. 4) located in this zone. We denote the local coordinate set by (ξ, u, v), with ξ being the
reaction coordinate. From the deﬁnition of a reaction coordinate, we have:

∂A
∂ξ

= g

= 0

∂A
∂u
∂A
A
∂v

= 0

= 0

As dCG is not a good approximation to the reaction coordinate, ξ depends not only on dCG but also on dCC and

19

(100)

(101)

(102)

6
20

(103)

α. As a result, the derivative of the free energy along dCC is related to the gradient of the free energy:

∂A
∂dCC

=

=

∂A
∂ξ
∂A
∂ξ

∂ξ
∂dCC
∂ξ
∂dCC 6

= 0

+

∂A
∂u

∂u
∂dCC

+

∂A
∂v

∂v
∂dCC

Thus, if dCC is not constrained, the system will evolve in order to minimize the free energy in that direction, and

the two paths will not coincide.

C.

Importance of the correction to evaluate the gradients

It is worth analyzing the importance of the B terms in equations (96)-(98). They are reported on Figure 5 together
with the average value of the Lagrange multipliers. It appears that those terms are usually smaller than the Lagrange
multiplier by at least an order of magnitude. However, as the reaction path is following the free energy gradient,
these small diﬀerences are accumulated along the path, leading to a non-negligible correction. For example, for the
mol−1. The larger correction for the
studied reaction, the free energy correction along the path can reach 1 kcal
·
0.01 ˚A. However, the
geometrical parameters is observed for the evolution of the double bond length: ∆(dCC )
structural diﬀerences for the product and the transition state are much smaller: ∆(d)
0.5°.
mol−1.
The correction for the total free energy diﬀerence is only ∆(∆Acorr) = 0.1 kcal
·

We would like to draw attention to the fact that, even thought those terms are generally not negligible, one should
not forget that we are using classical mechanics, and that all quantum eﬀects are missing for the description of the
nuclei motion. In particular, ZPE and tunneling are completely neglected.

0.005 ˚A and ∆(α)

≈

≤

≤

D. Eﬀect of the temperature

Following the procedure of Gonzalez et al.,35 we have constructed the reaction path at 0K. As the diﬀerences
between the potential energy proﬁle and the free energy proﬁle have already been discussed,25 we shall focus here on
the diﬀerences between the path at 0K and 300K. The two path are reported on ﬁgure 6.

At large separation, that is for the electrophilic addition, dCG is a good reaction coordinate at both temperatures.
More, as long as the two reactants interact only weakly, the thermal motions are mainly vibrations of the two molecules.
As the potential energy surface is almost harmonic for such vibrations, the evolutions of the double bond distance
and of the angle α are similar at 300K and at 0K. On the potential energy surface, as the distance between the two
fragments increases, the interaction depends less and less on the angle, leading to some spurious evolutions. On the
free energy surface, this independence of the interaction on the angle leads to an average value of 90° instead.

When the interaction starts to be stronger, these oscillations of the angle disappear and both path are qualitatively

similar. However, due to the vibrational thermal energy, at 300K the parameters changes are larger.

E. Computational details

The Car-Parrinello projector augmented-wave (CP-PAW)36,37 program by Bl¨ochl was used for all AIMD calcula-
tions. In the CP-PAW calculations, periodic boundary conditions were used in all examples with an orthorhombic
unit cell described by the lattice vectors ([0, 14.74, 14.74], [14.74, 0, 14.74], [14.74, 14.74, 0]) (bohr, 7.8 ˚A). The energy
cutoﬀ used to deﬁne the basis set was 30 Ry (15 a.u.) in all cases. Because the systems of interest are all isolated
molecules, only the Γ-point in k-space was included and the interaction between images was removed by the method
proposed by Bl¨ochl.37 The approximate density-functional theory (DFT) used here consisted of the combination of the
Perdew-Wang parametrization of the electron gas38 in combination with the exchange gradient correction presented
by Becke39 and the correlation correction of Perdew.40 The SHAKE algorithm20 was employed in order to impose the
constraints. The mass of the hydrogen atoms was taken to be that of deuterium, and normal masses were taken for
all other elements.

Room temperature CP-PAW calculations were performed at a target temperature of 300 K. The Andersen
thermostat41 was applied to the nuclear motion by reassigning the velocity of N randomly chosen nuclei every n
steps where N and n are chosen to maintain the desired temperature.
In our case this amounted to one velocity
reassignment every 20 steps. Thermostat settings were monitored and adjusted if necessary during the equilibration
10
stage, with the main criteria for adequate thermostating being the mean temperature lying within a range of 300

±

21

<λ
CG>
100*BCG

<λ
CC>
10*BCC

     0

 −0.02

 −0.04

 −0.06

 0.008

 0.004

     0

−0.004

1.5

2

2.5
dCG (Å)

3

3.5

FIG. 5: Importance of the correction terms in the evaluation of the free energy derivative. hλX i is the average of the Lagrange
multiplier. BCG = −kT ZdCG
and BCC = −kT ZdCC
are the correction to the derivative of the free energy along dCG and
Zαd3
Zαd3
dCC respectively. G is the midpoint of the double bond.

CG

CC

K and a temperature drift lower than 1 K/ps. In combination with the Andersen thermostat, a constant friction
was applied to the wave function with a value of 0.001. Following the conclusions of the previous study, for each
simulation, we performed between 35000 and 50000 steps in order to ensure that the system was fully equilibrated
and that the temperature and the free energy gradient were fully converged.

The free energy proﬁles were obtained by numerical integration of the gradient along the path, using a procedure
similar to the pointwise thermodynamic integration (PTI) method.9 As the overall rotation and translation of the
molecule are frozen during a simulation, one has to correct the free energy obtained from a simulation. We have used
the procedure of Kelly et al.25 To summarize, the overall correction for the entropy is the sum of the translational
and rotational entropy:

∆SAB

corr(s) = SAB

R (s) + SAB

T (s)

SA
T (

)
∞

−

SB
T (

)
∞

−

(104)

R (s) is the rotational entropy at RC = s which is geometry dependent, and SAB

Where SAB
T (s) is the translational
entropy at RC =s. The last two terms represent the translational entropy of the isolated species A and B. These terms
are calculated using standard formula for the partition functions. Finally, the total free energy change ∆AAB
corr(s) is
obtained from a CP-PAW simulation with the constraints described above as

−
where ∆AAB
P AW (s) is the change in free energy obtained directly from the simulation, and CM (classical mechanics)
refers to the fact that the motion of the nuclei is described using classical mechanics. It should be mentioned that the

∆AAB

CM (s) = ∆AAB

P AW (s)

T ∆SAB

corr(s)

22

300 K
0 K

1.55

 1.5

1.45

 1.4

1.35

 120

 110

 100

  90

)

Å

(
 
C
C
d

 
)
.
g
e
d
(
 
α

1.5

2

2.5
dCG (Å)

3

3.5

FIG. 6: Reaction path for the addition of the dichlorocarbene to ethylene at 0K and 300K. Two projections are show: in the
dCC − dCG and α − dCG subspace, G being the midpoint of the double bond.

zero-point energy (ZPE) correction is not included in our simulations. This should not seriously hamper our objective
which is to analyze the qualitative diﬀerences between the path obtained with one and three constraints.

V. CONCLUSION

In this work, we have proposed a new look at the standard formulas for evaluating the derivatives of the free energy

along a reaction coordinate.

First, we recollected the diﬀerent formulas available in a uniform approach. These formulas allow one to compute
accurately and eﬃciently the gradient of the free energy for an unconstrained system using a constrained molecular
dynamic simulation.

The main ﬁnding of this investigation is a set of equations that makes it possible to construct a minimum free
energy reaction path instead of calculating the free energy changes along a predeﬁned path. Indeed, we believe that
one can use the free energy gradients in the same way potential energy gradients have been used in the past 20 years
in quantum chemistry calculations.

Addition of the dichlorocarbene to ethylene was studied as a numerical example. It was shown that a simulation
using only one constraint is not suﬃcient to describe the whole path. Using the free energy gradient in a subset of
three active coordinates lead to a smoother path, reﬁning the understanding of this process.

23

(A1)
(A2)

(A3)

(A4)

(A5)

(A6)

(A7)

(B1)

(B2)

Acknowledgments

The authors would like to thank Dr. Michael Seth and Dr. Shengyong Yang for helpful and fruitful discussions. This
work was supported by the National Sciences and Engineering Research Council of Canada (NSERC). Calculations
were performed in part on the Westgrid cluster and the MACI Alpha cluster located at the University of Calgary.
One of us (TZ) thanks the Canadian government for a Canada Research Chair.

APPENDIX A: PROPERTIES OF THE MASS MATRIX

Using A−1

qξ Aqξ = I, one readily ﬁnds:

t = I3N−1

XqAq + YξBξ
XqBξ + YξCξ = 0
Yt
ξAq + ZξBt
ξ = 0
Yt
ξBξ + ZξCξ = 1

A−1
q = Xq −

YξZ −1

ξ Yt

ξ

Plugging equation (A3) into equation (A1) leads to

The last relation we need derives from:

Aq 0
Bt

ξ 1 !

 

= AqξA−1
qξ

Aq 0
Bt

ξ 1 !

 

= Aqξ

I3N −1 Yξ

 

0

Zξ !

Equating the determinant of the ﬁrst and last term, we get:

Aqξ |
=

|

Aq ||

Zξ |

|

−1=

JtMJ

|

J

=
|

|

2
|

|

M

|

APPENDIX B: PROPERTIES OF GAUSSIAN INTEGRALS

We recall here the main properties of Gaussian integrals:

due(−utAu)

A

−1/2
|

∝|

Z

due(−utAu)utBu

Tr

A−1B

due(−utAu)

1
2

∝

(cid:0)

Z

(cid:1)

Z

APPENDIX C: CONSTRAINING THE OVERALL ROTATION AND TRANSLATION

In this section, we derive the expressions used to constrain the overall translation and rotation of the system. For
this, we start from a reference geometry x0 and we seek the conditions that should be satisﬁed by the new geometry
x. The Center of Mass G is deﬁned by:

xG =

N
i=1 mixi
N
i=1 mi

P

P
where mi is the mass of the atom i with coordinate xi. In the following, the notation
xG will be used. Let
us denote by ˆx, ˆy and ˆz the unit vectors of our laboratory coordinate system. For the sake of clarity, the component
of xi along the ˆx, ˆy and ˆz axis will be denoted by xi,1, xi,2 and xi,3 respectively.

xi = xi

−

e

Constraining the translation is equivalent to freeze the movement of the center of mass, i.e. to apply the following

linear constraints:

Constraining the rotation can be done by using the second Eckart conditions.42 These conditions minimize the
angular momentum due to small displacements: they provide an approximate way to constrain the global rotation
during a molecular dynamic simulation:

σ1 =

σ2 =

σ3 =

mi
M

mi
M

mi
M

N

i=1
X
N

i=1
X
N

i=1
X

(cid:0)

(cid:0)

(cid:0)

xi,1

x0
i,1

= 0

xi,2

x0
i,2

= 0

xi,3

x0
i,3

= 0

−

−

−

(cid:1)

(cid:1)

(cid:1)

σ4 = ˆx

σ5 = ˆy

σ6 = ˆz

N

· "

i=1
X
N

· "

i=1
X
N

· "

i=1
X

= 0

= 0

= 0

mi

x0
i ×

xi

mi

mi

(cid:16)

(cid:16)

f
x0
i ×

f
x0
i ×

(cid:16)

f

#

(cid:17)

#

(cid:17)

#

(cid:17)

e
xi

e
xi

e

σ4 =

mi

x0
i,2

xi,3

xi,2

x0
i,3

= 0

N

i=1
X
N

i=1
X
N

i=1
X

σ5 =

mi

σ6 =

mi

(cid:0)
e
x0
i,3

(cid:0)
e
x0
i,1

e
xi,1

e
xi,2

−

−

−

e
xi,3

e
x0
i,1

= 0

e
xi,1

e
x0
i,2

= 0

(cid:1)

(cid:1)

(cid:1)

(cid:0)

mj
M

x0
j,2

−

xi,2

x0
i,3 −





e
x0
j,3

mj
M



e
x0
j,1

mj
M

xi,3

−

xi,1

−

e
x0
i,1 −



e
x0
i,2 −



that is:

e
These last equations can be written as linear constraints:

e

e

e

σ4 =

σ5 =

σ6 =

xi,3

x0
i,2 −



e
x0
i,3 −



e
x0
i,1 −



xi,1

xi,2

N

j=1
X
N

j=1
X
N

j=1
X

N

i=1
X
N

i=1
X
N

i=1
X

mi 



mi 



mi 




= 0

= 0

= 0

N

j=1
X
N

j=1
X
N

j=1
X

mj
M

x0
j,3



e
x0
j,1

mj
M



e
x0
j,2

mj
M

e
















e

e



e

APPENDIX D: ACTUALLY CALCULATING EQ. 56

In this appendix, we propose one way to calculate the derivatives of the free energy A along qn, using a simulation
1

in which only ξ is constrained. As an example, we consider that the coordinates qi to qn were inactive at step k
and become active at step k.

−

The ﬁrst step is to use the expressions for the generalized coordinates to obtain the values for Zξ, Zqn , ∂Zqn

∂x′ and

∂qn
∂x′ .

24

(C1a)

(C1b)

(C1c)

(C2a)

(C2b)

(C2c)

(C3a)

(C3b)

(C3c)

(C4a)

(C4b)

(C4c)

25

The main diﬃculty in using equation (56) is that one must ensure that the sampling of qn around qk

n is suﬃcient.
In practice, this imposes to have long MD simulations, with approximately 100000 steps for each considered inactive
coordinate. One way to circumvent this problem is to use a Taylor expansion of the derivative of the potential around
i , . . . , qk
qk
n:

∂V
∂qn

=

∂V
∂qk

n (cid:19)qk

i ,...,qk

n,ξ∗

+

j=n

j=i
X

∂2V
∂qn∂qj (cid:19)qk

(qj −

qk
j )

i ,...,qk

n,ξ∗

The simulation data is then used to ﬁt the coeﬃcients of this expression. The resulting equation is then plugged

into equation (56).

+

1
2

j=n

l=n

∂3V

∂qn∂qj∂ql 

j=i
X

Xl=i

qk
i ,...,qk

n,ξ∗



(qj −

qk
j )(ql −

qk
l )

(D1)

∗

Electronic address: ziegler@ucalgary.ca

1 M. P. Allen and D. J. Tildesley, Computer Simulation of Liquids (Clarendon, Oxford, England, 1987).
2 C. Chipot and D. A. Pearlman, Mol. Simul. 28, 1 (2002), and references therein.
3 S. Park and K. Schulten, J. Chem. Phys. 120, 5946 (2004).
4 F. M. Ytreberg and D. M. Zuckerman, J. Chem. Phys. 120, 10876 (2004).
5 C. Jarzynski, Phys. Rev. Let. 78, 2690 (1997).
6 C. Jarzynski, Phys. Rev. E 56, 5018 (1997).
7 R. W. Zwanzig, J. Chem. Phys. 22, 1420 (1954).
8 G. M. Torrie and J. P. Valleau, J. Comput. Phy. 23, 187 (1977).
9 T. P. Straatsma and J. A. McCammon, J. Chem. Phys. 95, 1175 (1991).
10 W. F. van Gunsteren, in Computer Simulations of Biomolecular Systems: Theoretical and Experimental Applications, edited

by W. F. van Gunsteren and P. K. Weiner, vol. 1, page 27 (ESCOM, Leiden, The Netherlands, 1989).

11 E. A. Carter, G. Ciccotti, J. T. Hynes, and R. Kapral, Chem. Phys. Letters 156, 472 (1989).
12 M. Sprik and G. Ciccotti, J. Chem. Phys. 109, 7737 (1998).
13 W. K. den Otter and W. J. Briels, J. Chem. Phys. 109, 4139 (1998).
14 E. Darve and A. Pohorille, J. Chem. Phys. 115, 9169 (2001).
15 K. Fukui, J. Phys. Chem. 74, 4161 (1970).
16 K. Fukui, Acc. Chem. Res. 14, 363 (1981).
17 W. K. den Otter and W. J. Briels, Mol. Phys. 98, 773 (2000).
18 E. Darve, M. A. Wilson, and A. Pohorille, Mol. Simul. 28, 113 (2002).
19 J. Schlitter and M. Kl¨ahn, Mol. Phys. 101, 3439 (2003).
20 J.-P. Ryckaert, G. Ciccotti, and H. J. C. Berendsen, J. Comput. Phys. 23, 327 (1977).
21 G. Vilasi, Hamiltonian Dynamics, chap. 2, page 45 (World Scientiﬁc Publishing Co. Pte. Ltd., London, England, 2001).
22 J. Schlitter, W. Swegat, and T. M¨ulders, J. Mol. Model. 7, 171 (2001).
23 E. B. Wilson, Jr., J. C. Decius, and P. C. Cross, Molecular Vibrations (McGraw Hill Book Company, 1955).
24 A. Michalak and T. Ziegler, J. Phys. Chem. A 105, 4333 (2001).
25 E. Kelly, M. Seth, and T. Ziegler, J. Phys. Chem. A 108, 2167 (2004).
26 N. G. Rondam, K. N. Houk, and R. A. Moss, J. Am. Chem. Soc. 102, 1770 (1980).
27 K. Krogh-Jespersen, S. Yan, and R. A. Moss, J. Am. Chem. Soc. 121, 6269 (1999).
28 H. B. Schlegel, in Encyclopedia of Computational Chemistry, edited by P. v. R. Schleyer, N. L. Allinger, T. Clark, J. Gasteiger,

P. A. Kollman, H. F. S. III, and P. R. Schreiner, page 1136 (Wiley, Chichester, 1998), and references therein.

29 J. M. Boﬁll, J. Comput. Chem. 15, 1 (1994).
30 S. Yang, I. Hristov, P. Fleurat-Lessard, and T. Ziegler, J. Phys. Chem. A 109, 197 (2005).
31 K. N. Houk, N. G. Rondam, and J. Mareda, J. Am. Chem. Soc. 106, 4291 (1984).
32 J. F. Blake, , S. G. Wiershke, and W. L. Jorgensen, J. Am. Chem. Soc. 111, 1919 (1989).
33 J. J. Blavins, D. L. Cooper, and P. B. Karadakov, Int. J. Quantum Chem. 98, 465 (2004).
34 A. E. Keating, S. R. Merrigan, D. A. Singleton, and K. N. Houk, J. Am. Chem. Soc. 121, 3933 (1999).
35 C. Gonzalez and H. B. Schlegel, J. Chem. Phys. 90, 2154 (1989).
36 P. E. Bl¨ochl, Phys. Rev. B: Solid State 50, 17953 (1994).
37 P. E. Bl¨ochl, J. Phys. Chem. 99, 7422 (1995).
38 J. P. Perdew and Y. Wang, Phys. ReV. B: Solid State page 13244 (1992).
39 A. Becke, Phys. ReV. A: At., Mol., Opt. Phys. 38, 3098 (1988).
40 J. P. Perdew, Phys. ReV. B: Solid State 33, 8822 (1986).
41 H. C. Andersen, J. Chem. Phys. 72, 2384 (1980).

42 C. Eckart, Phys. Rev. page 552 (1935).
43 Even thought this value might seem quite large, because of the two heavy chlorine atoms, a step of 0.5 a.u. corresponds to

a decrease of the dCG distance by approximately 0.005 ˚A only.

44 The convergence is slow, and is not shown on the ﬁgure.

26

