7
0
0
2
 
r
a

M
 
5
1
 
 
]
h
p
-
c
o
s
.
s
c
i
s
y
h
p
[
 
 
1
v
9
5
1
3
0
7
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

INSTITUT NATIONAL DE RECHERCHE EN INFORMATIQUE ET EN AUTOMATIQUE

Belief Propagation and Bethe approximation for
Trafﬁc Prediction

Cyril Furtlehner — Jean-Marc Lasgouttes — Arnaud de La Fortelle

N° ????

Mars 2007

Thèmes NUM et COG

a p p o r t  (cid:13)
(cid:13) d e  r e c h e r c h e (cid:13)

G
N
E
+
R
F
-
-
?
?
?
?
-
-

/

R
R
A
R
N

I

I

N
R
S

I

9
9
3
6
-
9
4
2
0
N
S
S

I

Belief Propagation and Bethe approximation for Traﬃc
Prediction

Cyril Furtlehner∗, Jean-Marc Lasgouttes†, Arnaud de La Fortelle‡†

Th`emes NUM et COG — Syst`emes num´eriques et Syst`emes cognitifs
Projets Imara et Tao

Rapport de recherche n° ???? — Mars 2007 — 29 pages

Abstract: We deﬁne and study an inference algorithm based on “belief propagation”
(BP) and the Bethe approximation. The idea is to encode into a graph an a priori
information composed of correlations or marginal probabilities of variables, and to
use a message passing procedure to estimate the actual state from some extra real-
time information. This method is originally designed for traﬃc prediction and is
particularly suitable in settings where the only information available is ﬂoating car
data. We propose a discretized traﬃc description, based on the Ising model of
statistical physics, in order to both reconstruct and predict the traﬃc in real time.
In particular, a detailed
General properties of BP are addressed in this context.
study of stability is proposed with respect to the a priori data and the graph topology.
The behavior of the algorithm is illustrated by numerical studies on a simple traﬃc
toy model. How this approach can be generalized to encode superposition of many
traﬃc patterns is discussed.

Key-words: belief propagation algorithm, Bethe approximation, traﬃc prediction,
intelligent transport systems, ﬂoating car data

∗ INRIA Futurs – LRI, Bat. 490, Universit´e Paris-Sud – 91405 Orsay cedex (France)
† INRIA Rocquencourt – Domaine de Voluceau B.P. 105 – 78153 Le Chesnay cedex (France)
‡ ´Ecole des Mines de Paris – CAOR research centre – 60, boulevard Saint-Michel – 75272 Paris

cedex 06 (France)

Unité de recherche INRIA Rocquencourt
Domaine de Voluceau, Rocquencourt, BP 105, 78153 Le Chesnay Cedex (France)
Téléphone : +33 1 39 63 55 11 — Télécopie : +33 1 39 63 53 30

Propagation de croyances et approximation de Bethe
pour la pr´ediction de traﬁc

R´esum´e : On d´eﬁnit et ´etudie un algorithme de reconstruction utilisant l’algorithme
« Belief Propagation » (propagation de croyances, BP) et l’approximation de Bethe.
L’id´ee est d’encoder dans un graphe des donn´ees a priori compos´ees de corr´ela-
tions ou de lois marginales et d’utiliser une proc´edure de passage de messages pour
estimer l’´etat r´eel `a partir d’informations temps-r´eel. Cette m´ethode, d´evelopp´ee
pour des besoins de pr´ediction de traﬁc, est particuli`erement adapt´ee au cas o`u la
seule information disponible provient de v´ehicules sonde (Floating Car Data). Nous
proposons une discr´etisation binaire du traﬁc s’appuyant sur le mod`ele d’Ising de
physique statistique, permettant de reconstruire et de pr´edire le traﬁc en temps
r´eel. Des propri´et´es g´en´erales de l’algorithme BP sont discut´ees dans ce contexte.
En particulier une ´etude d´etaill´ee des propri´et´es de stabilit´e fonction des donn´ees a
priori et de la topologie du graphe est fournie. Une ´etude num´erique sur un mod`ele
de traﬁc simpliﬁ´e permet d’illustrer le fonctionnement de l’algorithme. La fa¸con
de g´en´eraliser cette approche pour encoder une superposition de plusieurs ´etats de
traﬁc est discut´ee.

Mots-cl´es : propagation de croyances, approximation de Bethe, reconstruction de
traﬁc, pr´ediction, syst`emes de transport intelligent, v´ehicules traceurs

Belief Propagation and Bethe approximation for Traﬃc Prediction

3

1 Introduction

With an estimated 1% GDP cost in the European Union (i.e. more than hundred
billions euros), congestion is not only a time waste for drivers and an environmental
challenge, but also an economic issue. This is why the European commission ﬁnanced
the REACT project, where new traﬃc prediction models have been developed. These
predictions are to be used to inform the public and possibly to regulate the traﬃc.
Today, some urban and inter-urban areas have traﬃc management and advice
systems that collect data from stationary sensors, analyze them, and post notices
about road conditions ahead and recommended speed limits on display signs located
at various points along speciﬁc routes. However, these systems are not available
everywhere and they are virtually non-existent on rural areas. With rural road
crashes accounting for more than 60% of all road fatalities in OECD (Organization
for Economic Cooperation and Development) countries, the need for a system that
can cover these roads is compelling if a signiﬁcant reduction in traﬃc deaths is to
be achievable.

The REACT project combines a traditional traﬃc prediction approach on equipped

motorways with an innovative approach on non-equipped roads. The idea is to obtain
ﬂoating car data from a ﬂeet of probe vehicles and reconstruct the traﬃc conditions
from this partial information. To understand why it is not possible to fuse these two
parts, we have to go a bit more into prediction algorithms details.

Two types of approaches are usually distinguished, namely data driven (applica-
tion of statistical models to a large amount of data, for example regression analysis)
and model based (simulation or mathematical models explaining the traﬃc patterns).
As we stated before, the choice is largely led by the availability of data. In our case,
since little data is available on non-equipped roads (only the equipped vehicles driv-
ing along the observed roads), the model driven approach is the only feasible one. For
more information about traﬃc prediction methods, we refer the reader to [1, 13, 14].
Most current traﬃc models are deterministic, described either at a macroscopic
level by a set of diﬀerential equations linking variables such as ﬂow and density,
or by Newton’s law at a microscopic level where each individual car is considered.
Intermediate descriptions are essentially kinetic models, like for example cellular
automata [11], which are very well adapted to freeway traﬃc modeling and adapted
to some extent to urban traﬃc modeling [4]. Traﬃc ﬂow models are quite adapted
and eﬃcient on motorways where ﬂuid approximation of the traﬃc is reasonable;
they tend to fail for cities or rural roads. The reason is that the velocity ﬂow
ﬁeld is subject to much greater ﬂuctuations induced by the nature of the network
(presence of intersections and short distance between two intersections) than by the

RR n° 0123456789

4

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

traﬃc itself. These ﬂuctuations are both spatial and temporal (a red or green traﬃc
light at a cross-road, a road-work, etc). There is no local stationary regime for the
velocity, the dynamics are dominated by the ﬂuctuations.

We propose in this paper a hybrid approach in the continuation of [5], by taking
full advantage of the statistical nature of the information, in combination with a
stochastic modeling of traﬃc patterns. In order to reconstruct the traﬃc and make
predictions, we propose a model—the Bethe approximation (BA)—to encode the
statistical ﬂuctuations and stochastic evolution of the traﬃc and an algorithm—the
belief propagation (BP) algorithm—to decode the information. Those concepts are
familiar to the computer science and statistical physics communities since it was
shown [16] that the output of BP is in general the Bethe approximation [3].

The paper is organized as follows: Section 2 describes the model and its rela-
tionship to the Ising model and the Bethe approximation. The inference problem
and our strategy to tackle it using the Belief Propagation algorithm are stated in
Section 3. The implementation of these ideas requires some new results about the
BP algorithm, which are the subject of Section 4; this concerns in particular the
eﬀect of the normalization of the messages, the parameterization of the model and
the stability of the ﬁxed points. Section 5 is devoted to implementation details of the
decoding algorithm and to some numerical results illustrating the method. Finally,
some new research directions are proposed in Section 6.

2 Traﬃc description and statistical physics

The graph onto which we apply the belief propagation procedure is made of space-
time vertices that encode both a location (road link) and a time (discretized on a
few minutes scale). More precisely, the set of vertices is V = L ⊗ Z+, where L
corresponds to the links of the network and Z+ to the time discretization. To each
point α = (ℓ, t) ∈ V, we attach an information τα ∈ {0, 1} indicating the state of
the traﬃc (1 if congested, 0 otherwise). Each cell is correlated to its neighbors (in
time and space) and the evaluation of this local correlation determines the model.
def
= {τα, α ∈
In other words, we assume that the joint probability distribution of τV
V} ∈ {0, 1}V is of the form

p({τα, α ∈ V}) =

φα(τα)

ψαβ(τα, τβ)

(2.1)

Yα∈V

Y(α,β)∈E

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

5

(a)

(b)

Fig. 2.1: Traﬃc network (a) and Ising model (b) on a random graph

where E ⊂ V 2 is the set of edges, and the local correlations are encoded in the
functions ψ and φ. V together with E describe the space-time graph G and V(α) ⊂ V
denotes the set of neighbors of vertex α.

The model described by (2.1) is actually equivalent to an Ising model [8] on G,
with arbitrary coupling between adjacent spins, the up or down orientation of each
spin indicating the status of the corresponding link (Figure 2.1).

The homogeneous Ising model (uniform coupling constants) is a well-studied
model of ferro (positive coupling) or anti-ferro (negative coupling) material in sta-
tistical physics. It displays a phase transition phenomenon with respect to the value
of the coupling. At weak coupling, only one disordered state occurs, where spins
are randomly distributed around a mean-zero value. Conversely, when the coupling
is strong, there are two equally probable states that correspond to the onset of a
macroscopic magnetization either in the up or down direction: each spin has a larger
probability to be oriented in the privileged direction than in the opposite one.

From the point of view of a traﬃc network, this means that such a model is able
to describe three possible traﬃc regimes: ﬂuid (most of the spins up), congested
(most of the spins down) and dense (roughly half of the links are congested). For
real situations, we expect other types of congestion patterns, and we seek to associate
them either to the p-state Potts model if we extend the binary to p-ary description,
or to the possible states of an inhomogeneous Ising model with frustration (i.e.
with possibly negative coupling parameters), referred as spin glasses in statistical

RR n° 0123456789

6

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

physics [10]. When such a system is frustrated because some negative couplings,
leading to a certain number of contradictions, a proliferation of meta-stable states
occurs, which eventually scales exponentially with the size of the system.

On a simply connected graph, the knowledge of the one-vertex and two-vertices

marginal probabilities is suﬃcient [12] to fully determine the measure (2.1).

p(τV ) = Q

(α,β)∈E ˆpαβ(τα, τβ)
α∈V ˆp(τα)qα−1 =

ˆpα(τα)

Yα∈V

Y(α,β)∈E

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)

,

(2.2)

Q

where qα denotes the number of neighbors of α. Since our space time graph G is
multi-connected, this relationship between local marginals and the full joint prob-
ability measure can only be an approximation, which in the context of statistical
physics is referred to as the Bethe approximation. This approximation is provided
by the minimum of the so-called Bethe free energy, which, based on the form (2.2),
is an approximate form of the Kullback-Leibler distance,

D(b(τV )kp(τV ))

def
=

b(τV ) ln

XτV

b(τV )
p(τV )

,

and which rewrites in terms of a free energy as

D(b(τV )kp(τV )) = F(b(τV )) − F(p(τV )),

where

F(b(τV ))

def
= U(b(τV )) − S(b(τV )),

(2.3)

with the respective deﬁnitions of the energy U and of the entropy S

U(b(τV ))

def
= −

S(b(τV ))

def
= −

X(α,β)∈E

X(α,β)∈E

bαβ(τα, τβ) log ψαβ(τα, τβ) −

bα(τα) log φα(τα),

bαβ(τα, τβ) log bαβ(τα, τβ) −

bα(τα) log bα(τα).

Xα∈V

Xα∈V

In practice, what we retain from an Ising description is the possibility to encode
a certain number of traﬃc patterns in a statistical physics model. This property is
actually shared also by the Bethe Approximation (BA) and this is the reason for us
to directly encode the traﬃc patterns in a BA rather than the inhomogeneous Ising
model itself, based on historical data, and to avoid therefore an intermediate approx-
imation step. BA simply provides us with a set of marginals probabilities that we

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

7

try to match with the historical data. But this set, which is the result of an iterative
procedure, is not necessarily unique (see for example [9]) and the proliferation of
possible solutions depends on the frustration induced by the historical correlations
used to deﬁne the ψ’s of (2.1). The setting of our model consists therefore into an
optimization procedure of the matching between the set of historical values obtained
from probe vehicles and the set of marginal probabilities of the BA.

The data collected from the probe vehicles is used in two diﬀerent ways. The
most evident one is that the data of the current day directly inﬂuences the prediction.
In parallel, this data is collected over long periods (weeks or months) in order to
estimate the model (2.1). Typical historical data that is accumulated is

• ˆpα(τα): the probability that vertex α is congested (τα = 1) or not (τα = 0);

• ˆpαβ(τα, τβ): the probability that a probe vehicle going from α to β ∈ V(α)

ﬁnds α with state τα and β with state τβ.

The edges (α, β) of the space time graph G are constructed based on the presence of a
measured mutual information between α and β, which is the case when ˆpαβ(τα, τβ) 6=
ˆpα(τα)ˆpβ(τβ).

3 The reconstruction and prediction algorithm

3.1 Statement of the inference problem

We turn now to our present work concerning an inference problem, which we set
in general terms as follows: a set of observables τV = {τα, α ∈ V}, which are
stochastic variables are attached to the set V of vertices of a graph. For each edge
(α, β) ∈ E of the graph, an accumulation of repetitive observations allows to build
the empirical marginal probabilities {ˆpαβ}. The question is then: given the values
of a subset τV ∗ = {τα∗, α∗ ∈ V ∗}, what prediction can be made concerning V ∗, the
complementary set of V ∗ in V?
There are two main issues:

• how to encode the historical observations (inverse problem) in an Ising model,

such that its marginal probabilities on the edges coincide with the ˆpαβ?

• how to decode in the most eﬃcient manner—typically in real time—this infor-

mation, in terms of conditional probabilities P (τα|τV ∗)?

The answer to the second question will somehow give a hint to the ﬁrst one.

RR n° 0123456789

8

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

3.2 The belief propagation algorithm

BP is a message passing procedure, which output is a set of estimated marginal prob-
abilities, the beliefs bαβ [12]. The idea of the BP algorithm is to factor the marginal
probability at a given site in a product of contributions coming from neighboring
sites, which are the messages. The messages sent by a vertex α to β ∈ V(α) depends
on the messages it received previously from other vertices:

mα→β(τβ) ←

nα→β(τα)φα(τα)ψαβ(τα, τβ),

(3.1)

Xτα∈{0,1}

where

nα→β(τα)

def
=

mγ→α(τα).

Yγ∈V(α)\{β}

In practice, the messages will be normalized so that

mα→β(τβ) = 1.

Xτβ ∈{0,1}

(3.2)

(3.3)

We will come back to the eﬀects of this in Section 4.2.

The output of the algorithm is a set of beliefs, which are an approximation of
the one-vertex and two-vertices marginals of p(τV ). The beliefs bα are reconstructed
according to

bα(τα) ∝ φα(τα)

mβ→α(τα),

(3.4)

Yβ∈V(α)

and, similarly, the belief bαβ of the joint probability of (τα, τβ) is given by

bαβ(τα, τβ) ∝ nα→β(τα)nβ→α(τβ) × φα(τα)φβ(τβ)ψαβ(τα, τβ).

(3.5)

In the formulas above and in the remainder of this paper, the proportionality symbol
∝ indicates that one must normalize the beliefs so that they sum to 1.

A simple computation shows that equations (3.4) and (3.5) are compatible, since

(3.1)–(3.2) imply that

bαβ(τα, τβ) = bβ(τβ).

Xτα∈{0,1}

It has been realized a few years ago [15] that the ﬁxed points of the BP algorithm
coincide with local minima of the Bethe free energy (2.3). This justiﬁes that we can
use this algorithm to approximate our Ising model.

We propose to use the BP algorithm for two purposes: estimation of the model
parameters (the functions φ and ψ) from historical data and reconstruction of traﬃc
from current data.

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

9

3.3 Setting the model with Belief Propagation

The ﬁxed points of the BP algorithm (and therefore the Bethe approximation) allow
to approximate the joint marginal probability pαβ when the functions ψαβ and φα
are known. Conversely, it can provide good candidates for ψαβ and φα from the
historical values ˆpαβ and ˆpα.

To set up our model, we are looking for a ﬁxed point of the BP algorithm
satisfying (3.1)–(3.2) and such that bαβ(τα, τβ) = ˆpαβ(τα, τβ) and therefore bα(τα) =
ˆpα(τα).

It is easy to check that the following choice of φ and ψ,

ψαβ(τα, τβ) =

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)

,

φα(τα) = ˆpα(τα),

(3.6)

(3.7)

leads (2.1) to coincide with (2.2). They correspond to a normalized BP ﬁxed point
for which all messages are equal to 1/2. There is however no guarantee that this
ﬁxed point is a stable ﬁxed point; actually, for an Ising-type system below the
critical temperature, we often observe that this point is unstable (see Section 5 for
the simulation results). It will be shown however in Section 4.1 that this form of φ
and ψ is in some sense canonical.

3.4 Traﬃc reconstruction and prediction

Let V ∗ be the set of vertices that have been visited by probe vehicles. Reconstruct-
ing traﬃc from the data gathered by those vehicles is equivalent to evaluating the
conditional probability

pα(τα|τV ∗) =

pα,V ∗(τα, τV ∗)
pV ∗(τV ∗)

,

where τV ∗ is a shorthand notation for the set {τα∗}α∗∈V ∗.

The BP algorithm applies to this case if a speciﬁc rule is deﬁned for vertices
α∗ ∈ V ∗: since the value of τα∗ is known, there is no need to sum over possible
values and (3.1) becomes

mα∗→β(τβ) ← nα∗→β(τα∗ )φα∗ (τα∗)ψα∗β(τα∗ , τβ).

The resulting algorithm is supposed to be run in real time, over a graph which
corresponds to a time window (typically a few hours) centered around present time,

RR n° 0123456789

10

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

with probe vehicle data added as it is available. In this perspective, the reconstruc-
tion and prediction operations are done simultaneously on an equal footing, the
distinction being simply the time-stamp (past for reconstruction or future for pre-
diction) of a given computed belief. The output of the previous run can be used as
initial messages for a new run, in order to speedup convergence. Full re-initialization
(typically a random set of initial messages) has to be performed within a time interval
of the order but smaller than the time-scale of typical traﬃc ﬂuctuations.

4 Some general properties of the Belief Propagation algorithm

This section contains several theoretical results on the BP algorithm. Although they
are stated in the context of Section 2, most of these results can be trivially extended
to a general factor graph and variables taking more than two values (transforming
the Ising model into a Potts model), except possibly for Section 4.3.

4.1 Building the model from its ﬁxed points

The particular use that we make of the Bethe approximation, as outlined in Sec-
tion 3.3, means that the output of the algorithm takes precedence over the underlying
Ising model, which is an unusual situation. The following propositions shows how
to estimate φα and ψαβ from the historical values ˆpα and ˆpαβ.

Let us start with a direct consequence of the BP ﬁxed point equations. The fol-
lowing straightforward proposition extends (2.2) to the case of a non-tree structure.

Proposition 4.1. A set of beliefs {bα, bαβ} corresponding to a BP ﬁxed point of (3.1)–
(3.5) always satisﬁes

p(τV ) =

α,β bαβ(τα, τβ)
α bqα−1

(τα)

α

Q

Q

=

bα(τα)

Yα∈V

Y(α,β)∈E

bαβ(τα, τβ)
bα(τα)bβ(τβ)

.

Proof. This is a simple consequence of (3.4)–(3.5).

What this proposition means is that diﬀerent BP ﬁxed points correspond to
diﬀerent factorizations of the joint measure (2.1). The knowledge of a set of beliefs
is thus suﬃcient to determine the underlying Ising model and consequently the other
ﬁxed points of the algorithm.

The following proposition gives more insight on how the diﬀerent components

of (2.1) can be written in terms of the BP ﬁxed points.

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

11

Proposition 4.2. Assume that there exists a ﬁxed point of the BP algorithm satisfying
(3.1)–(3.5) and such that

bαβ(τα, τβ) = ˆpαβ(τα, τβ), and therefore bα(τα) = ˆpα(τα).

(4.1)

Then the following equalities hold

ψαβ(τα, τβ) =

mα→β(τβ)mβ→α(τα),

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)
ˆpα(τα)
β∈V(α) mβ→α(τα)

.

Q

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)

ˆpα(τα)
β∈V(α) µβα(τα)

.

φα(τα) =

φα(τα) =

Conversely, assume that there exist boolean functions µαβ(τβ) such that

ψαβ(τα, τβ) =

µαβ(τβ)µβα(τα),

Q
Then mα→β = µαβ is a ﬁxed point of the BP algorithm and (4.1) holds.

Proof. Relation (4.2) is obtained by rewriting (3.4) and (3.5) as

ψαβ(τα, τβ) =

bαβ(τα, τβ)
φα(τα)nα→β(τα)nβ→α(τβ)φβ(τβ)
bαβ(τα, τβ)
bα(τα)bβ(τβ)

mα→β(τβ)mβ→α(τα).

=

To prove the second assertion, the ﬁrst step is to show that µαβ is a BP ﬁxed

point:

(4.2)

(4.3)

(4.4)

(4.5)

(4.6)

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

µγα(τα)
(cid:21)

φα(τα)ψαβ(τα, τβ)

ˆpα(τα)
µβα(τα)

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)

µαβ(τβ)µβα(τα)

Xτα∈{0,1}

=

=

Xτα∈{0,1}
= µαβ(τβ).

ˆpαβ(τα, τβ)
ˆpβ(τβ)

µαβ(τβ)

For this ﬁxed point, (3.5) reduces to (4.1), which concludes the proof of the propo-
sition.

RR n° 0123456789

12

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

While Proposition 4.2 seems to indicate that there is some leeway in choosing
ψαβ, a proper change of variables shows that all the choices are equivalent. Let us
deﬁne the following new set of messages

xα→β(τβ)

def
=

mα→β(τβ)
µαβ(τβ)

.

Equation (3.1) then becomes

xα→β(τβ)µαβ(τβ)

=

=

=

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

φα(τα)ψαβ (τα, τβ)
xγ→α(τα)µγα(τα)
(cid:21)

xγ→α(τα)
(cid:21)

ˆpα(τα)
µβα(τα)

ˆpαβ(τα, τβ)
ˆpα(τα)ˆpβ(τβ)

µαβ(τβ)µβα(τα)

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

xγ→α(τα)
(cid:21)

ˆpαβ(τα, τβ)
ˆpβ(τβ)

µαβ(τβ),

and therefore

xα→β(τβ) =

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

xγ→α(τα)
(cid:21)

ˆpαβ(τα, τβ)
ˆpβ(τβ)

.

This version of the BP algorithm is thus equivalent to the heuristic choice (3.6)–

(3.7), which corresponds to the trivial ﬁxed point xα→β(τβ) ≡ 1.

Since it is equivalent in terms of convergence to the original choice of ψαβ and
φα, this can be seen as the canonical choice of functions to deﬁne our Ising model.
The freedom we have in the deﬁnition of φ and ψ yields the following possibility:

Proposition 4.3. Assume that the schema (3.1)–(3.2) admits a set {mi}, i ∈ I, of
ﬁxed points with corresponding beliefs {bi}. For any i0 ∈ I, choosing i0 as a reference
state by changing φ and ψ according to

ψi0

αβ(τα, τβ) =

bi0
αβ(τα, τβ)
bi0
α (τα)bi0
β (τβ)

,

φi0
α (τα) = bi0

α (τα),

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

13

yields a new BP scheme, with unchanged beliefs {bi}, but with a new set of ﬁxed
points

m(i/i0)

α→β (τβ) =

m(i)
m(i0)

α→β(τβ)
α→β(τβ)

.

In particular, the new reference ﬁxed point {m(i0/i0)} has all its components identi-
cally equal to 1.

4.2 Normalization and ﬁxed points

We discuss here a feature of the algorithm which did not get that much atten-
tion in the literature, which is the possibility of normalizing the messages and its
consequences on the results. In most studies, it is assumed that the messages are
normalized so that (3.3) holds. The update rule (3.1) indeed indicates that there
is an important risk to see the messages converge to 0 or diverge to inﬁnity. It is
however not immediate to check that the normalized version of the algorithm has
the same ﬁxed points as the original one (and therefore the Bethe approximation).
In order to make the deﬁnition of normalization clear, deﬁne the mapping

Θαβ(m)(τβ)

def
=

Xτα∈{0,1}

(cid:20) Yγ∈V(α)\{β}

φα(τα)ψαβ(τα, τβ),
mγ→α(τα)
(cid:21)

Then the normalized version of BP is deﬁned by the following update rule

˜mα→β(τβ) ←

Θαβ( ˜m)(τβ)
Θαβ( ˜m)(0) + Θαβ( ˜m)(1)

.

(4.7)

The relation between the ﬁxed points of BP and normalized BP can be described

as follows.

Proposition 4.4. Any normalized ﬁxed point (except 0) of the BP algorithm is a ﬁxed
point of the version of BP algorithm with normalized messages.

Conversely, a ﬁxed point of the BP algorithm with normalized messages corre-
sponds (through multiplication by a proper constant) to an unique ﬁxed point of the
basic BP algorithm, except possibly when the graph G has exactly one cycle.

Proof. Let m be a non-null ﬁxed point of the BP algorithm, that is

mα→β(τβ) = Θαβ(m)(τβ),

∀(α, β) ∈ E

RR n° 0123456789

14

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

and let

˜mα→β(τβ) =

mα→β(τβ)
mα→β(0) + mα→β(1)

= kαβ mα→β(τβ).

From its deﬁnition, Θαβ is multilinear and

Θαβ( ˜m)(τβ) =

(cid:20) Yγ∈V(α)\{β}

kγα(cid:21)

Θαβ(m)(τβ),

and therefore ˜m is a ﬁxed point of the schema (4.7).

Conversely, let ˜m be a ﬁxed point of (4.7). Then there exists a set of constants

Kαβ satisfying

Θαβ( ˜m)(τβ) = Kαβ ˜mα→β(τβ).

Let us ﬁnd a set of constants cαβ such that

mα→β(τβ) = cαβ ˜mα→β(τβ),

be a non-zero ﬁxed point of (3.1). We have

Θαβ(m)(τβ) =

(cid:20) Yγ∈V(α)\{β}

cγα(cid:21)

Θαβ( ˜m)(τβ)

=

=

cγα(cid:21)

(cid:20) Yγ∈V(α)\{β}
1
cαβ (cid:20) Yγ∈V(α)\{β}

Kαβ ˜mα→β(τβ)

cγα(cid:21)

Kαβ mα→β(τβ),

and therefore

log cαβ −

log cγα = log Kαβ.

(4.8)

Xγ∈V(α)\{β}

Solving this equation amounts to invert a matrix I − A where A is an incidence
matrix on the dual factor graph (the graph which connects oriented pairs (α, β) ∈ E,
see Figure 5.1). Let vαβ = log cαβ. The homogeneous equation rewrites

vαβ + vβα =

vγα.

Xγ∈V(α)

(4.9)

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

15

When a non-zero solution exists, then a simple symmetry argument shows that the
right-hand side does not depend on either α or β and therefore can be set to 1
without loss of generality. Therefore, summing over all oriented edges,

2|E| = 2

(vαβ + vβα)

X(α,β)∈E

=

vαβ +

vβα

Xα∈V Xβ∈V(α)

Xβ∈V Xα∈V(β)

= 2|V|,

with |E| and |V| respectively the number of edges and vertices. Since G has only
one component, by the well-known formula [2], the number of cycles in the graph
is |E| − |V| + 1, only graphs with one cycle give possibly rise to a non-zero solution
to (4.9). Conversely, when a graph has one unique cycle, it is possible to provide an
partial ordering of vertices such that each vertex has exactly one neighbor greater
than itself, and vαβ = 11{α>β} is a solution to (4.9).

This proposition does not describe what happens when G has exactly one cycle.
The existence of a solution to (4.8) actually depends on the value of log K, which
itself depends on the ﬁxed point ˜m. However, since BP is known to converge in a
ﬁnite number of steps for graphs with at most 1 cycle, normalization is not useful
in this situation.

From now on reference to the BP algorithm is to be understood as its normalized

version.

4.3 Stability of BP ﬁxed points

The next issue to tackle regarding the ﬁxed points of BP is their stability. The
following deﬁnition of conditional belief will be useful

bαβ(τα|τβ)

def
=

bαβ(τα, τβ)
bβ(τβ)

.

For the general case we have the following

Proposition 4.5. The stability of any ﬁxed point of the BP algorithm is determined
by the set of beliefs {b} of that ﬁxed point: the ﬁxed point is stable if, and only if,
the matrix deﬁned, for any pair of oriented edges (α, β) ∈ E, (α′, β′) ∈ E, by the

RR n° 0123456789

16

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

elements

J α′β′
αβ =
=

bαβ(1|1) − bαβ(1|0)
(cid:1)

1 − bαβ(0|1) − bαβ(1|0)
(cid:1)

(cid:0)

(cid:0)

11{α′∈V(α)\{β}, β′=α}

11{α′∈V(α)\{β}, β′=α},

(4.10)

has a spectral radius smaller than 1.

A suﬃcient condition for this stability is therefore

bαβ(1|1) − bαβ(1|0)
(cid:12)
(cid:12)

(cid:12)
(cid:12)

<

1
qα − 1

, for all α ∈ V, β ∈ V(α).

Proof. Since we are dealing with binary variables, messages are vectors with two
components, and it is easier to set

ηα→β

def
=

mα→β(1)
mα→β(0)

.

This normalization is equivalent to the one proposed in Section 4.2, according to

the change of variables

˜mα→β(0) =

and

˜mα→β(1) =

1
1 + ηα→β

ηα→β
1 + ηα→β

,

and the scaled BP algorithm update rule (4.7) can be rewritten as

ηα→β ←

bαβ(0|1) +
bαβ(0|0) +

γ∈V(α)\{β} ηγ→α
γ∈V(α)\{β} ηγ→α

bαβ(1|1)
bαβ(1|0)

,

(cid:2)Q

(cid:2)Q

(cid:3)

(cid:3)

(4.11)

after performing the change of referential of Proposition 4.3 with reference point
{b}. We look for small perturbations around the ﬁxed point ηα→β ≡ 1 for all (α, β).
The Jacobian at the point η = 1 reads:

∂ηαβ
∂ηα′β′ (cid:12)
η=1
(cid:12)
(cid:12)

=

bαβ(1|1) − bαβ(1|0)
(cid:1)

(cid:0)

11{α′∈V(α)\{β}, β′=α},

which proves (4.10). The rest of the proposition is a consequence of basic inequalities
on the spectral radius of a matrix.

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

17

)
η
(
f

 1

 2

 1.5

 0.5

 0

 0

)
η
(
f

 1

 2

 1.5

 0.5

 0

 0

)
η
(
f

 1

 2

 1.5

 0.5

 0

 0

 0.5

 1.5

 2

 0.5

 1.5

 2

 0.5

 1.5

 2

 1
η

 1
η

 1
η

a) (q − 1)κ < −1

b) (q − 1)κ ∈ (−1, 0) and
(q − 1)κ ∈ (0, 1)

c) (q − 1)κ > 1

Fig. 4.1: Diﬀerent possible graphs of f (η) versus η depending on the value of κ =
b(1|1) − b(1|0): (a) one unstable ﬁxed point, (b) one stable ﬁxed point and
(c) one unstable and two stable ﬁxed points.

Remark For a totally symmetric graph with connectivity q, (4.11) reduces to

η ← f (η)

def
=

b(0|1) + ηq−1b(1|1)
b(0|0) + ηq−1b(1|0)

,

and the classiﬁcation in terms of b(1|1) − b(1|0) is pictured in Figure 4.1. Note that
b(1|1)−b(1|0) > 0 (resp. < 0) corresponds a ferromagnetic (resp. anti-ferromagnetic)
system.

If one considers the dual graph formed by function nodes, where links relate
pairs of function nodes having a variable in common, then on this graph the Ja-
cobian matrix has the structure of the incidence matrix A already encountered in
the preceding section. This matrix is not symmetric, but eigenvalues greater than 1
in modulus indicate anyway an instability. These are obtained by forming the new
def
= J − λI with I the identity matrix and ﬁnding roots of
matrix J(λ)

det J(λ) = 0.

The expansion of det J(λ) involves permutations which are compatible with circuits
of the dual graph, where each vertex is visited once. Each permutation is uniquely
represented by a product of permutation cycles (orbits) with disjoint support and
is attached to a sub-graph of the dual graph. Let us call maximal permutation, a
permutation such that the complementary graph of its associated sub-graph is cycle
free. Adapting results of [6], det J(λ) may be expanded according to the following,

det J(λ) =

(det ωi + (−λ)|ωi|),

(4.12)

Xσ∈C Yωi⊂σ

Proposition 4.6.

RR n° 0123456789

18

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

where the sum runs over all possible maximal permutations σ, each one being ex-
pressed as a product of n ≥ 1 circular permutations (cycles) ωi, i = 1 . . . n, of size
|ωi|, with determinant given by

det ω = −(−1)|ω|

bαβ(1|1) − bαβ(1|0)
(cid:1)

.

Y(α,β)∈ω(cid:0)

On a tree, as expected, zero is the only eigenvalue, in fact J is a nilpotent matrix
of index the size of the longest directed path in the graph. If there is only one cycle
ω, (4.12) reduces to

det J(λ) = λN −|ω|(det ω + (−λ)|ω|),

which yields the eigenvalues

λk =

(cid:18) Y(α,β)∈ω(cid:0)

bαβ(1|0) − bαβ(1|1)
(cid:1)

(cid:19)

1
ω

e(2k+1)iπ/|ω|,

with modulus obviously smaller than one. As a consequence, the following proposi-
tion holds.

Proposition 4.7. BP ﬁxed points for a graph containing at most one oriented loop
are stable.

This has been remarked by diﬀerent means in [7]. Unstable modes correspond
to eigenvalues larger than 1, and might reveal vertices or cycles mostly responsi-
ble for the instabilities. An interesting case occurs when cycles of the dual graph
have disjoint supports, because then only one maximal permutation σ exists and
expansion (4.12) reduces to one term,

det J(λ) =

(det ωi + (−λ)|ωi|).

Yωi⊂σ

As a result, since the modulus of the Jacobian coeﬃcients are always smaller than
1, to each cycle is associated an eigenvalue smaller than 1 and the state is stable.

On a graph which is locally a tree (Bethe lattice), a mean-ﬁeld equation can
be used to evaluate the stability of a given ﬁxed point. The idea is to consider
the iterated Jacobian matrix in a statistical manner, by looking at the distribution
P (n)(v) of components v of an iterated vector starting from a non-degenerate initial
condition,

V (n) = J nV (0).

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

19

The mean-ﬁeld stability equation then simply reads (after assuming the usual inde-
pendence property of parent messages)

P n+1(v) =

Q(c)

P n(vi)R(κi)δ(v −

viκi),

(4.13)

c−1

Xc>1

X{vi},{κi}

Yi=1

c−1

Xi=1

with Q the connectivity distribution in the dual graph and R the Jacobian coef-
ﬁcient distribution (see Figure 5.3 for example). The instability is therefore fully
characterized by the statistical properties of the considered BP ﬁxed point and by
the statistical properties of the graph (connectivity), which sometimes can be an
adjustable parameter.

5 Toy Model simulations

5.1 From theory to practice

We illustrate these ideas on a simulated traﬃc system which has the advantage to
yield exact empirical data correlations. For real data, problems may arise because of
noise in the historical information used to build the model. This additional diﬃculty
will be treated in a separate work.

The model consists of a queueing network system. Each queue represents a link
of the traﬃc network (a single-way lane) and has a ﬁnite capacity; to each link we
attach a variable ρ ∈ [0, 1], the car density, which is represented by a color code in
the picture (Figure 5.2 on page 23).

As already stated in Section 2, the physical traﬃc network is replicated, to form
a space time graph, in which each vertex α = (ℓ, t) corresponds to a link ℓ at a
given time t of the traﬃc graph. To any space-time vertex α, we associate a binary
congestion variable τα ∈ {0, 1}.

The statistical physics description amounts to relating the probability of satu-
ration P (τα = 1) to the density ρα. For the sake of simplicity, we consider a linear

RR n° 0123456789

20

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

γ1

β

α

γ2

γ3

γ4

γ1 → α

γ2 → α

α → β

γ3 → α

γ4 → α

Fig. 5.1: Structure of the factor graph (left), 3 time-layers portions are represented,
black circles correspond to crossroads and blue squares to factor-vertices.
Corresponding graph for the Jacobian matrix (right).

relation and build our historical ˆp according to the rules

ˆpα(1) = µ∞(ρℓ),

ˆpα(0) = µ∞(1 − ρℓ),

ˆpαβ(1, 1) = µ∞(ρℓρℓ′),

ˆpαβ(1, 0) = µ∞(ρℓ(1 − ρℓ′)),

. . .

where µ∞ is simply a frequency estimator. Note that, to follow some realistic sta-
tistical constraints, we use here only data aggregated in time. More realistic data
collection and modeling would work the same way.

The structure of the factor-graph on which we propagate the information is

depicted in Figure 5.1.

Some ﬁne tuning is required to let the algorithm work correctly. First, from
Proposition 4.5, we know that the stability of the reference point ˆp encoded in
(3.6)–(3.7) is not guaranteed; this may be evaluated on the basis of distributions
depicted in Figure 5.3, using equation (4.13). In absence of negative correlations, it
is likely that our system is either a paramagnetic-like (in the Ising-model terminol-
ogy) system, with small ﬂuctuations around average values, or a ferromagnetic-like
system, in the sense that positive correlation drive the system to a state where links
are in a similar state, i.e. mostly ﬂuid (low state) or congested (high state). This

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

21

scenario corresponds to the regimes pictured on Figure 4.1 where case (c) is the
usual ferromagnetic phase transition in the Ising model. It is also a well-known fact
that this transition is driven by the temperature. To introduce the equivalent of a
temperature in our equations, since its eﬀect is essentially to reduce correlations, let
us consider modiﬁed pairwise marginal laws

˜pαβ(ǫ) = ǫˆpαβ + (1 − ǫ)ˆpα ˆpβ.

The high temperature regime corresponds here to ǫ → 0 and the vanishing of the cor-
def
= bαβ(1|1)−bαβ (1|0) are modiﬁed according
relations. The Jacobian coeﬃcients καβ
to

ˆκαβ(ǫ) = ǫκαβ,

which means that eigenvalues are rescaled by a factor ǫ. For our purpose, this
provides us with an adjustable mean-ﬁeld parameter, to correct some artiﬁcial am-
pliﬁcation of correlations caused by closed loops in the graph. We expect that there
exists a critical value of ǫc corresponding to the ferromagnetic phase transition point
(high temperature means here small ǫ). In addition, since for small ǫ we recover in
one sweep the bare mean results, this parameter can be used for a simulated anneal-
ing procedure, by letting it converge from zero to the desired value during the BP
iterations.

The second adjustment concerns the encoding of real-time information. The
probe vehicle is assumed to send an information for some space-time vertex α∗,
typically in the form of an instantaneous velocity, from which is estimated the prob-
ability pα∗ of saturation. Instead of projecting this information on one of the two
states (τα∗ = 0 or τα∗ = 1), which turns out in practice to be too coarse, we use
a procedure which amounts to bias the messages sent by α∗ in proportion to the
observed belief pα∗. In the statistical physics language, this amounts to impose an
external local ﬁeld on the observed variable.

The last issue concerns the situation where the system is below the transition
point, in which case we have two separate states, and it is always possible that BP
converges towards the wrong ﬁxed-point. In this simple ferromagnetic situation, it is
in fact easy to enforce the convergence of the algorithm to a speciﬁed ﬁxed point by
applying a slowly decaying external ﬁeld, enforcing either the ﬂuid or the congested
state. As a result of this procedure, we obtain two sets of beliefs {b0} and {b1},
with corresponding free energies F 0 and F 1, from which we build the superposition
belief,

bα =

e−F 0

α + e−F 1
b0
e−F 0
+ e−F 1

b1
α

.

RR n° 0123456789

22

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

which in practice, for suﬃciently large systems, because F is extensive, turns out to
be the set of beliefs corresponding to the lowest free energy.

In the following we refer the sets of belief {b0

α} and {bα} respectively to the
low, the high and the combined inference state. Accordingly the set {ˆpα} is referred
to as the historical state. In addition, the combination of observations with historical
data (by replacing the historical value with the last observation in the window time)
yields the actual state. To estimate the quality of the traﬃc restoration we use the
following estimator:

α}, {b1

reconstruction rate

11{|bα−ρα|<0.2},

def
=

1
|V| Xα∈V

which computes the fraction of space-time nodes α for which the belief bα does not
diﬀer by more than an arbitrary threshold of 0.2 from ρα.

5.2 Numerical results

We have tested the algorithm on the toy traﬃc network shown on the program’s
screen-shot of Figure 5.2. The characteristics of this network are summarized in
Table 5.1. Two types of traﬃc conditions have been used, that both correspond
to periodic oscillation superimposed with noise (see blue curve of Figure 5.4); they
simply diﬀer by the level of the noise.

The two values of ǫc in Table 5.1 that have been computed for the two diﬀerent
traﬃc regimes using (4.13) are close to the observed values, which indicates that
the space-time graph on which BP is run is close to the conditions of a dilute graph
(Bethe lattice).

The simulation run of Figure 5.4 compares the policies of using only the low
state (green), the high state (red) or the combined state w.r.t. the free energy in
the low-noise case. Abrupt changes of the combined state prediction correspond to
the crossing of the Bethe free energies. In the transition regimes, which correspond
to out-of-equilibrium situations, the free energy criteria sometimes select the wrong
state. The reason for this is that the present design of our algorithm encodes only
statistical information at equilibrium. Time correlations should be incorporated in
some way, to encode transition rates between the macro-states (here the low and
high traﬃc density).

Distributions of performance errors shown in Figure 5.5 are based on a simula-
tion run of 10000 traﬃc time units where a belief propagation is run every 3 units of
time for both low and high inference states, to reconstruct the traﬃc. Varying the

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

23

Fig. 5.2: Traﬃc network as produced by the simulator. The continuous color code

represents the traﬃc index from 0 (full green) to 1 (full red).

connectivity
5

10

0,4

0

connectivity
5

connectivity

correlations
jacobian values

connectivity

correlations
jacobian values

0,3

0,2

0,1

n
o
i
t
u
b
i
r
t
s
i
d
 
y
t
i
v
i
t
c
e
n
n
o
c

s
t
n
e
i
c
i
f
e
o
c
 
n
o
i
t
u
b
i
r
t
s
i
d

0,1

0,05

10

0,4

0,3

0,2

0,1

n
o
i
t
u
b
i
r
t
s
i
d
 
y
t
i
v
i
t
c
e
n
n
o
c

0

0,14

0,12

0,1

0,08

0,06

0,04

0,02

s
t
n
e
i
c
i
f
e
o
c
 
n
o
i
t
u
b
i
r
t
s
i
d

0
-1

-0,8

-0,6

-0,4

0,4

0,6

0,8

0
1

0
-1

-0,8

-0,6

-0,4

0,4

0,6

0,8

0
1

-0,2

0
correlations/ jacobian values

0,2

-0,2

0
correlations/ jacobian values

0,2

Fig. 5.3: Connectivity (black), correlation coeﬃcients (red) and Jacobian coeﬃcients

(blue) histograms for low (top) and high (bottom) noise level.

nodes

links

time steps

graph size

ǫc1(oscillating)

ǫc2 (noisy)

35

122

43

5246

0.67

1.29

Tab. 5.1: Toy model characteristics

RR n° 0123456789

24

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

1

0,8

0,6

0,4

0,2

0

-0,2

-0,4

y
g
r
e
n
e
 
/
x
e
d
n
i
 
c
i
f
f
a
r
t
 
/
e
t
a
r
 
n
o
i
t
c
i
d
e
r
p

0,2

0,15

n
o
i
t
u
b
i
r
t
s
i
d

0,1

0,05

combined state prediction
low state prediction
high state prediction
traffic level
low Bethe free energy
high Bethe free energy

3000

4000

time

5000

Fig. 5.4: Reconstruction rates for the various possible inference states as a function
of time with corresponding free energies, with 10 probe vehicles and ǫ =
0.75.

combined state, 10 probes
low state, 10 probes
high state, 10 probes
actual state, 10 probes
historical state

0

0

0,2

0,4
0,6
reconstruction error

0,8

1

Fig. 5.5: Distribution of reconstruction errors for the various possible inference

states for ǫ = 0.75.

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

25

combined state 1,5,10 probes
low state 1,5,10 probes 
high state 1,5,10 probes
historical state

e
t
a
r
 
n
o
i
t
c
i
d
e
r
p

1

0,9

0,8

0,7

0,6

0,5

0,4

0,3

e
c
n
a
i
r
a
v
 
e
t
a
r
 
n
o
i
t
c
i
d
e
r
p

0,2

0,1

0

0,8

0,7

0,6

0,5

0,4

e
t
a
r
 
n
o
i
t
c
i
d
e
r
p

0,6

0,8

epsilon

1

(a)

combined state, 10 probes
low state, 10 probes
high state, 10 probes
historical state

0,6

0,8

epsilon

1

(b)

combined state, 10 probes
low state, 10 probes
high state, 10 probes
historical state

0,6

0,8

1

1,2

epsilon

(c)

Fig. 5.6:

(a) Reconstruction rates obtained with 0, 1, 5 and 10 probe vehicles and
various possible inference states; (b) variance of the reconstruction rate
obtained with 10 vehicles also for the various possible states; (c) recon-
struction rates obtained for the noisy network, again with 10 probes.

RR n° 0123456789

26

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

1

0,8

0,6

0,4

e
t
a
r
 
n
o
i
t
c
i
d
e
r
p

0,2

0

0,5

0,4

0,3

0,2

0,1

.
f
r
e
p
 
n
a
e
m

10

20

30
number of probe vehicles

40

50

60

(a)

combined state
low state
high state
actual state
historical state

combined state
high state
low state
actual state
historical state

0

0

10

20

30
number of probe vehicles

40

50

60

(b)

Fig. 5.7:

(a) reconstruction rates with various possible inference states when the
number of probe vehicles is varied; (b) corresponding average prediction
error.

parameters (either ǫ or the number of probe vehicles) and integrating the distribu-
tions up to 0.2 yields curves of Figures 5.6 and 5.7. They indicate that the optimal
value of ǫ for traﬃc prediction is slightly above the critical value for the traﬃc oscil-

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

27

lating network and below the critical value for the noisy network, as expected. The
fact that the prediction rate saturates at 0.8 when the number of probe vehicles is
increased in Figure 5.7 is again due to the traﬃc transition regimes.

6 Conclusion and perspectives

We have presented a novel methodology for reconstruction and prediction of traﬃc
using the Belief Propagation algorithm on Floating Car Data. We have shown how
the underlying Ising model can be determined in a straightforward manner and
that it is unique up to some change of variables. In addition, the eﬀect of message
normalization and the stability properties can be asserted from the original data.
The unfortunate fact that the BP ﬁxed point corresponding to the historical data
may be unstable can be circumvented by rescaling of the correlations. The algorithm
has been implemented and illustrated using a toy traﬃc model.
Several generalizations are considered for future work:

• ﬁrstly, the binary description corresponding to the underlying Ising model is
arbitrary. Traﬃc patterns could be represented in terms of p diﬀerent inference
states. A Potts model with p-states variables would leave the belief propagation
algorithm and its stability properties structurally unchanged. Actually this
number p should be subject to an optimization procedure.

• secondly, our way of encoding traﬃc network information might need to be
augmented to cope with real world situations. This would simply amount to
redeﬁne the factor-graph used to propagate this information. In particular it
is likely that a great deal of information is contained in the correlations of
local congestion with aggregate traﬃc indexes, corresponding to sub-regions
of the traﬃc network. Taking these correlations into account would result in
the introduction of speciﬁc variables and function nodes associated to these
aggregate traﬃc indexes. These aggregate variables would naturally lead to a
hierarchical representation of the factor graph, which is necessary for inferring
the traﬃc on large scale network. Additionally, time dependent correlations
which are needed for the description of traﬃc, which by essence is an out of
equilibrium phenomenon, could be conveniently encoded in these traﬃc index
variables.

Ultimately, for the elaboration of a powerful prediction system, the structure
of the information content of a traﬃc-road network has to be elucidated through a

RR n° 0123456789

28

Cyril Furtlehner, Jean-Marc Lasgouttes, Arnaud de La Fortelle

speciﬁc statistical analysis. The use of probe vehicles, based on modern communi-
cations devices, combined with a belief propagation approach, is in this respect a
very promising approach.

References

[1] T. Benz et al., Information supply for intelligent routing services – the INVENT
traﬃc network equalizer approach, Proceedings of the ITS World Congress,
2003.

[2] C. Berge, Th´eorie des graphes et ses applications, 2`eme ed., Collection Univer-

sitaire des Math´ematiques, vol. II, Dunod, 1967.

[3] H. A. Bethe, Statistical theory of superlattices, Proc. Roy. Soc. London A (1935),

552.

[4] J. Essen and M. Schreckenberg, Microscopic simulation of urban traﬃc based

on cellular automata, Int. J. Mod. Phys. (1997), C8:1025–1036.

[5] C. Furtlehner, A. de La Fortelle, and J.-M. Lasgouttes, Belief-propagation algo-
rithm for a traﬃc prediction system based on probe vehicles, Tech. Report 5807,
Inria, 2006.

[6] F. Harary, The determinant of the adjacency matrix of a graph, Siam Review

Vol. 4 (1962), no. No. 3, pp. 202–210.

[7] T. Heskes, On the uniqueness of loopy belief propagation ﬁxed points, Neural

Computation 16 (2004), 2379–2413.

[8] E. Ising, Beitrag zur Theorie des Ferromagnetismus, Zeitschr. f. Phys. 31

(1925), 253–258.

[9] J. M. Mooij and H. J. Kappen, On the properties of the Bethe approximation
and loopy belief propagation on binary network, J. Stat. Mech. (2005), P11012.

[10] M. M´ezard, G. Parisi, and M.A. Virasoro, Spin glass theory and beyond, World

Scientiﬁc, Singapore, 1987.

[11] K. Nagel and M. Schreckenberg, A cellular automaton model for freeway traﬃc,

J. Phys. I,2 (1992), 2221–2229.

INRIA

Belief Propagation and Bethe approximation for Traﬃc Prediction

29

[12] J. Pearl, Probabilistic reasoning in intelligent systems: Network of plausible

inference, Morgan Kaufmann, 1988.

[13] PRIME project, Technology assessment and expected targets, Deliverable D3.2,

2000.

[14] H. H. Versteegt and C. M. J. Tamp`ere, PredicTime - state of the art and func-

tional architecture, Tech. Report 2003-07, TNO Inro, 2003.

[15] J. S. Yedidia, W. T. Freeman, and Y. Weiss, Generalized belief propagation,

Advances in Neural Information Processing Systems (2001), 689–695.

[16]

, Constructing free-energy approximations and generalized belief propa-

gation algorithms, IEEE Trans. Inform. Theory. 51 (2005), no. 7, 2282–2312.

RR n° 0123456789

Unité de recherche INRIA Rocquencourt
Domaine de Voluceau - Rocquencourt - BP 105 - 78153 Le Chesnay Cedex (France)

Unité de recherche INRIA Futurs : Parc Club Orsay Université - ZAC des Vignes
4, rue Jacques Monod - 91893 ORSAY Cedex (France)
Unité de recherche INRIA Lorraine : LORIA, Technopôle de Nancy-Brabois - Campus scientiﬁque
615, rue du Jardin Botanique - BP 101 - 54602 Villers-lès-Nancy Cedex (France)
Unité de recherche INRIA Rennes : IRISA, Campus universitaire de Beaulieu - 35042 Rennes Cedex (France)
Unité de recherche INRIA Rhône-Alpes : 655, avenue de l’Europe - 38334 Montbonnot Saint-Ismier (France)
Unité de recherche INRIA Sophia Antipolis : 2004, route des Lucioles - BP 93 - 06902 Sophia Antipolis Cedex (France)

Éditeur
INRIA - Domaine de Voluceau - Rocquencourt, BP 105 - 78153 Le Chesnay Cedex (France)
http://www.inria.fr
ISSN 0249-6399

