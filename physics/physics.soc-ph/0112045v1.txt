1
0
0
2
 
c
e
D
 
6
1
 
 
]
h
p
-
c
o
s
.
s
c
i
s
y
h
p
[
 
 
1
v
5
4
0
2
1
1
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Dynamics of market indices, Markov chains,

and random walking problem

Institute for Theoretical and Experimental Physics, B. Cheremushkinskaya 25

Institut f¨ur Theoretische Physik, Universit¨at T¨ubingen, Auf der Morgenstelle 14

M. I. Krivoruchenko

117259 Moscow, Russia

D-72076 T¨ubingen, Germany

Abstract

Dynamics of the major USA market indices DJIA, S&P, Nasdaq, and NYSE is ana-

lyzed from the point of view of the random walking problem with two-step correlations

of the market moves. The parameters characterizing the stochastic dynamics are deter-

mined empirically from the historical quotes for the daily, weekly, and monthly series.

The results show existence of statistically signiﬁcant correlations between the subse-

quent market moves. The weekly and monthly parameters are calculated in terms of

the daily parameters, assuming that the Markov chains with two-step correlations give

a complete description of the market stochastic dynamics. We show that the macro-

and micro-parameters obey the renorm group equation. The comparison of the param-

eters determined from the renorm group equation with the historical values shows that

the Markov chains approach gives reasonable predictions for the weekly quotes and un-

derestimates the probability for continuation of the down trend in the monthly quotes.

The return and its dispersion for the ”buy-and-hold” and ”follow-trend” strategies are

calculated. The problem of how to combine these two strategies to reduce the disper-

sion is discussed and its analytical solution is proposed. The results of the constructing

a ”computer-based” strategy which combines the series analysis with the candlesticks

charting techniques are reported.

1

1 Introduction

At present, the economic data are easily accessible through Internet. The economic data

are renewed on the monthly, weekly, and daily basis. During the sessions the data are renewed

in the interactive regime, i.e.

instantaneously. It is not a problem to get an access to the

economic data anymore. The problem is to make sense of the available information.

During the last years, the possibilities for analyzing the data have been improved very

much. Now, the memory of personal computers is suﬃcient to keep huge databases. The

speed of the personal computers is high enough to work with these databases and run com-

plicated codes. Also, the connection with Internet is fast enough to get within a reasonable

time interval any desirable information. This situation is completely new one, as compared

The progress in the personal computers and in the Internet services improved the possi-

bilities of single programmers. One can expect that some of them will attempt to understand

with the very recent past.

the economic data, too.

The description of stochastic process requires the knowledge of the probability theory and

mathematical statistics. These mathematical tools are useful not only in the exact sciences

[1], but also in the social sciences [2, 3].

This work represents an attempt to apply methods of the probability theory and math-

ematical statistics for the analysis of the market dynamics. We are interested in ﬁnding

statistically signiﬁcant deviations from the purely stochastic market behavior. In particular,

we are looking in historical quotes for signatures which allow to predict market moves with

suﬃciently high probabilities. We use these signatures further to develop a computer-based

strategy of the market behavior.

We start in the next Sect. from description of the random walking problem in presence

of a trend. This is an evident extension of the symmetric random walking discussed by

Chandrasekhar [1]. We calculate return and dispersion for the ”buy-and-hold” (BH) strategy

in terms of a trend parameter w which represents a probability of moving an index up for a

day (week, month). Then, we determine from the historical quotes empirical values of the

trend parameters for the daily, weekly, and monthly quotes of the four basic market indices

of USA: Dow Jones Industrial Average (DJIA, analyzed years 1930 - 2000), Standard and

Poor (S&P, analyzed years 1950 - 2000), Nasdaq (analyzed years 1985 - 2000), and New York

Stock Exchange (NYSE, analyzed years 1965 - 2000).

2

In Sect. 3, we propose a more detailed model for dynamics of the market indices by taking

into account two-step correlations of the subsequent market moves. Such a model represents a

particular case of the Markov chains that have many useful applications in diﬀerent ﬁelds. The

model has two free correlation parameters, p and q, which are probabilities for a continuation

of the market moves, respectively, up and down. We determine empirical values of these

parameters from the historical quotes for the daily, weekly, and monthly data of the four

basic market indices. These two-step correlations are found to be statistically signiﬁcant.

We calculate further return and dispersion for the BH and ”follow-trend” (FT) strategies

and compare their eﬃciency in the past. The problem of how to combine these two strategies

to ensure the minimum of the dispersion (a minimum risk strategy) has an analytical solution.

We found it using the theory of series [2].

In Sect. 4, we calculate within the framework of the Markov chains approach the weekly

and monthly correlation parameters P and Q in terms of the daily correlation parameters

p and q. The results are compared with the empirical values. There are deviations of the

calculated values from the empirical values, which indicate that the large-scale dynamics of

the market indices is not fully determined by the short-scale dynamics. The renorm group

relations are established between the correlation parameters at diﬀerent time scales.

In Sect. 5, backtesting principles are discussed. We show that misuse of the backtesting

can lead to systematic overestimates of the returns and give an example of such a misuse. We

propose a special type of the backtesting, which is more realistic with respect to the estimate

of the future performance. In this Sect., speciﬁc features of the market dynamics are used

to construct a computer-based (CB) strategy based on a combination of the theory of series

and Japanese candlesticks charting techniques. The CB strategy is backtested.

The results obtained in this work are discussed in Conclusion.

2 Random walking with trend

An excellent introduction to the random walking problem can be found in the Chan-

drasekhar’s lectures [1].

We consider random walking of a particle on a vertical inﬁnite line. On each step, the

particle makes a move up with a probability w or a move down with a probability 1

w.

−

The length of the jumps is everywhere the same and set equal to unity.

3

In order to arrive after N steps into a point with a coordinate

the particle should make n+ = N

n− steps up and n− steps down. The probability of ﬁnding

the particle with a coordinate z after N steps is described by the binomial distribution

z = n+

n−,

−

−

W (n+, n−) =

N!
n+!n−!

wn+(1

w)n

−.

−

N

X
=0
n

−

W (N

n−, n−) = 1.

−

(2.1)

(2.2)

(2.3)

This distribution is normalized to unity:

The dynamics of the market indices can be treated from the point of view of the random

walking problem. If a market index is closed up for a day (week, month, ...), we say that

the ”particle” made a step up. If a market index is closed down, we say that the ”particle”

made a step down.

We analyzed the following data: DJIA (1930 - 2000 years), S&P (1950 - 2000), Nasdaq

(1985 - 2000), and NYSE (1965 - 2000).

In Table 1, the values of w are shown for the

daily (W1), weekly (W5), and monthly (W21) quotes of these indices. The meaning of other

parameters in Table 1 is explained in the next Sects. In the meantime notice that the values

of w everywhere are quite close to 1/2. This case of the random walking is discussed by

Chandrasekhar [1].

As compared to his lectures, we discuss more general case and introduce a trend parameter

w that can be diﬀerent from 1/2. The deviation of the daily parameter w from the symmetric

value 1/2 is statistically signiﬁcant. Indeed, the accuracy of the numbers given in Table 1

is determined for the daily quotes by the value of 1/√ND where ND = (the number of the

working days per year)

(the number of years analyzed). For DJIA index, the statistical

×

error equals 0.7%. The deviation of the daily parameter w = 0.5339 from the symmetric

value w = 1/2 is 6.78% i.e. 10 times greater. It is safe to conclude therefore that the trend

does exist. The statistical errors are shown in Table 1 for all indices for the daily, weekly,

and monthly quotes. Notice that according to the estimate of ref. [4], p. 141, based on the

analysis of the 1952 - 1983 years, the DJIA daily trend parameter equals w = 0.521. This

result is close to ours.

We analyze ﬁnite samples of the data, and so an attempt to ﬁnd a statistical law can

always result in ﬁnding a statistical ﬂuctuation. Such an unwanted possibility always exists

4

Table 1: Trend parameters Wk and correlation parameters Pk and Qk for the daily, k = 1,

weekly, k = 5, and monthly, k = 21, data for the four major USA market indices. The

empirical values of the parameters are determined by ﬁtting the distributions of the number of

the series with the growing and decreasing moves assuming the homogeneous condition (3.2)

is fulﬁlled for the daily, weekly, and monthly data. The statistical errors of the parameters

are shown. The calculated values of the parameters are found assuming that the large-scale

dynamics is determined by the short-scale dynamics as described in Sect. 5. For k = 1, the

parameters w = W1, p = P1, and q = Q1 are used as an input.

Parameters

DJIA

S&P

Nasdaq

NYSE

calculated

empirical

calculated

empirical

calculated

empirical

calculated

empirical

W1

P1

Q1

W5

P5

Q5

W21

P21

Q21

input

input

input

0.5596

0.5644

0.4465

0.6150

0.6159

0.3364

0.5339

0.0037

0.5698

0.0045

0.5073

0.0040

0.5623

0.0082

0.5784

0.0099

0.4585

0.0079

0.5815

0.0170

0.6012

0.0218

0.4458

0.0162

±

±

±

±

±

±

±

±

±

input

input

input

0.5650

0.5722

0.4443

0.6244

0.6257

0.3778

0.5382

0.0044

0.5918

0.0059

0.5244

0.0052

0.5726

0.0097

0.5893

0.0120

0.4499

0.0092

0.5929

0.0200

0.6379

0.0293

0.4727

0.0217

±

±

±

±

±

±

±

±

±

input

input

input

0.6331

0.6425

0.3832

0.7423

0.7436

0.2614

0.5829

0.0080

0.6579

0.0129

0.5220

0.0102

0.6018

0.0175

0.6417

0.0255

0.4585

0.0182

0.6589

0.0353

0.6604

0.0497

0.3439

0.0259

±

±

±

±

±

±

±

±

±

input

input

input

0.5513

0.5593

0.4585

0.5984

0.6000

0.4039

0.5302

0.0054

0.5886

0.0072

0.5357

0.0066

0.5579

0.0118

0.5800

0.0145

0.4699

0.0117

0.5821

0.0244

0.6288

0.0350

0.4830

0.0269

±

±

±

±

±

±

±

±

±

and cannot be excluded. Maximum what can be done is to reduce risk of the misinterpreting

the data. In addition, we deal with an alive system. Even if it is described by a statistical

law, parameters of the corresponding distribution can be time dependent.

If the rate of

accumulation of the data (day-by-day, week-by-week, ...), which we clearly cannot inﬂuence,

is lower than the rate of variation of the system parameters, the system parameters cannot

be determined from the observations. There always exists an uncertainty.

The statistical methods are, however, widely used in the social sciences, despite they are

less reliable than in the exact sciences. In this work, we want to reach some clarity concerning

a few basic features of the market behavior in the past. We do not discuss if these feature

will remain in the future markets.

The very important characteristics of a market index is its return. In our simpliﬁed model,

return is nothing but the number of the moves up minus the number of the moves down.

This quantity looks like

R1/N = 2w

1.

−

(2.4)

We have here the diﬀerence of the steps up (w) and down (1

w). This is, equivalently, the

−

average value of the parameter z = n−

n+ in the binomial distribution (2.2).

−

5

We refer this passive strategy as ”buy-and-hold” strategy. Notice that

and so the dispersion of the value z = n−

n+ equals

< n− >= (1

w)N,

−
− >= w(1

< n2

w)N + (1

w)2N 2,

−

−

−

σ2
1 = 4w(1

w)N.

−

3 Random walking with two-step correlations

In order to reveal less trivial statistical features of the market dynamics, we should con-

sider a possibility for existence of correlations between the subsequent moves. In other words,

we want to check if there is a memory about past when an index makes a move.

In the simplest case, the memory eﬀect is described by four conventional probabilities

which depend on two independent parameters p and q. We refer these parameters as corre-

lation parameters. The signs

and

denote moves up and down.

↑

↓

We would like to deal with a homogeneous system with respect to the time translations.

It means that any particular sample of the data should give identical results for the trend

parameter w and the correlation parameters p and q. The homogeneous condition looks like

It shows that the value of w remains invariant under the time translations. It becomes evident

w = pw + (1

q)(1

w).

−

−

(3.2)

if eq.(3.2) is rewritten in the form

Here, w(

) = w and w(

) = 1

w, while the conventional probabilities are from eqs.(3.1).

↑

↓

Therefore, as long as the parameters p and q are known, the trend parameter is ﬁxed:

w(

) = w(

)w(

) + w(

↑ | ↑

↑

)w(

).

↓

↑ | ↓

↑

−

w(

w(

w(

w(

↑ | ↑

↓ | ↑

↑ | ↓

↓ | ↓

) = p,

) = 1

) = 1

p,

q,

−

−

) = q,

w =

2

−
p

q

−

.

q

1

−

6

(2.5)

(2.6)

(2.7)

(3.1)

(3.3)

If the homogeneous condition (3.2) is not fulﬁlled, the problem makes sense, too. The

diﬀerence is only that the parameters p and q determined from the ﬁrst half of the data could

be diﬀerent from the same parameters determined from the second half of the data. Such a

possibility is not discussed here.

In Table 1, the trend parameters Wk and the correlation parameters Pk and Qk are shown

for k = 1 (daily data), 5 (weekly data), and 21 (monthly data) for the four major USA

market indices. The empirical values are determined by ﬁtting the distribution of number of

the sequential series for the up- and down-moves under the imposed homogeneity condition

(3.2). The statistical errors are also shown. The meaning of the ”calculated values” Wk, Pk,

and Qk is explained in Sect. 4. The weekly and monthly data are discussed in the details in

Sect. 4.

The main observation that can be made at the moment is the existence of the correlations

between two consequent steps of the market indices in the daily data. These correlations are

not strong, but statistically signiﬁcant. The lack of the correlations would mean p + q = 1

and w = p. To the ﬁrst approximation, the market dynamics can be treated as the random

walking without trend (w = 1/2). To the next approximation, it can be treated as the

random walking with a trend (w

= 1/2). The next approximation takes into account the

two-step correlations, and these correlations are also statistically signiﬁcant.

In Table 2, we compare χ2 for the ratios between the empirical number of the up- and

down-series and the number of the analogous series for the random walking in three models:

The symmetric random walking w = 1/2, the random walking with trend (w

= 1/2), and

the random walking with trend and correlations. It is seen that for the daily quotes the χ2

for the third model is 5 to 15 times less than for the ﬁrst two models for the up-series and is

comparable with the ﬁrst two models for the down-series. We consider it as a clear evidence

for the existence of the two-step correlations. The equation p + q = 1 can also be treated

as a criterion for the existence of the two-step correlations. For the daily quotes, it is not

fulﬁlled, as one sees from the Table 1. The similar check can also be made for the equation

w = p which is an equivalent criterion for the existence of the correlations.

There are deviations from the geometrical distribution of the number of the series of a

ﬁxed length. In Tables 3, 4, and 5, we show the daily (D), weekly (W), and monthly (M)
empirical values p∗

k together with the statistical errors for probabilities of continuation of the

7

6
6
Table 2: Comparison of the χ2 for the models without trend (w = 1/2, No. 1), with a trend

(w

= 1/2, No. 2), and with the correlation for the up- and down-events (No. 3), respectively,

for the daily (D), weekly (W), and monthly (M) quotes of the four major USA market indices.

Type No.

DJIA

S&P

Nasdaq

NYSE

up

down

up

down

up

down

up

down

196.7

80.02

192.2

23.51

137.9

4.59

118.7

79.40

D

78.87

83.21

79.49

87.41

42.04

50.5

59.53

53.81

40.32

96.47

13.36

14.90

12.30

3.07

11.59

20.60

37.95

27.9

W

10.74

8.96

12.64

9.32

34.3

8.14

8.69

18.2

2.77

2.05

5.83

18.46

11.9

3.45

12.70

2.56

2.10

16.77

3.91

11.61

23.4

26.26

20.3

2.02

13.47

6.44

M

14.28

5.95

41.72

7.13

0.84

12.53

3.66

18.48

9.38

59.46

14.6

0.90

25.02

5.30

20.9

9.04

9.78

6.95

3.19

3.20

1

2

3

1

2

3

1

2

3

series

p∗
k =

nk + nk+1 + ...
nk−1 + nk + ...

,

(3.4)

with nk being the number of the up-series of the length k. So, if we have k
probability to have the next move up is p∗
q∗
k that describe the probability for continuation of the series down. The results are shown

k. The similar expression holds true for the values

1 moves up, the

−

for the four basic market indices of USA. The numbers typed in boldface deviate more than

others from the symmetric values p = q = 1/2. They approach 1, signaling continuation of

the series with a high probability, or approach 0, signaling the end of the series with a high

probability.

Notice that Nasdaq during the 1985 - 2000 years did not fall oﬀ more than 6 weeks in

raw in the weekly quotes and more than 4 month in raw in the monthly quotes. Last time

Nasdaq was down 4 months in raw in the period September 2000 - December 2000. Using the

results of Table 5, one could predict with certainty (with unit probability) a positive move

of Nasdaq for January 2001. Such a prediction would be the correct one.

Let us calculate return of the follow-trend (FT) strategy: We buy an index the next day

when it is closed up for the ﬁrst time after one or several days down and sell it the next day

8

6
6

±

±

±

±

±

±

±

±

6

±

±

±

±

±

±

±

±

7

±

±

±

±

±

±

±

±

7

±

±

±

±

±

±

±

Table 3: Empirical values of p∗

k and q∗

k for daily quotes.

0.5947

.0148

0.5570

0.0184

0.5196

0.0235

0.5708

0.0347

0.5224

0.0433

0.5022

0.0584

0.5198

0.0135

0.4986

0.0182

0.4892

0.0255

0.4816

0.0361

0.4106

0.0469

0.4166

0.0739

S&P

0.6087

0.0186

0.5882

0.0234

0.5553

0.0293

0.5691

0.0400

0.5930

0.0545

0.5585

0.0680

0.5421

0.0172

0.5075

0.0224

0.4928

0.0308

0.5131

0.0452

0.5025

0.0622

0.4183

0.0778

Nasdaq

0.6532

0.0373

0.6831

0.0477

0.6144

0.0536

0.6179

0.0686

0.6183

0.0873

0.7160

0.1231

0.5271

0.0322

0.5122

0.0435

0.4928

0.0593

0.4563

0.0803

0.4680

0.1209

0.5454

0.1957

NYSE

0.5984

0.0225

0.6028

0.0292

0.5485

0.0353

0.5683

0.0488

0.5566

0.0639

0.5254

0.0824

0.5323

0.0207

0.5418

0.0288

0.5238

0.0383

0.5298

0.0533

0.5364

0.0738

0.4320

0.0874

Table 4: Empirical values of p∗

k and q∗

k for weekly quotes.

0.5688

0.0318

0.5920

0.0434

0.5709

0.0550

0.5562

0.0715

0.4574

0.0842

0.6046

0.1502

0.4323

0.0265

0.4973

0.0442

0.4391

0.0578

0.4939

0.0942

0.4634

0.1286

0.2105

0.1158

S&P

0.5852

0.0386

0.5631

0.0491

0.6097

0.0691

0.6320

0.0908

0.4936

0.0966

0.6153

0.1596

0.4356

0.0317

0.4575

0.0496

0.4758

0.0752

0.3898

0.0958

0.4347

0.1646

0.3000

0.1974

Nasdaq

0.5872

0.0736

0.6732

0.1056

0.5735

0.1152

0.7435

0.1823

0.6896

0.2004

0.7000

0.2439

0.4277

0.0594

0.4864

0.0988

0.4444

0.1335

0.3125

0.1601

0.2000

0.2190

NYSE

0.5454

0.0443

0.5769

0.0623

0.6148

0.0857

0.6144

0.1093

0.3725

0.1001

0.6842

0.2462

0.4465

0.0387

0.4635

0.0594

0.4943

0.0911

0.3863

0.1103

0.4117

0.1849

0.2857

0.2290

Index

DJIA

Index

DJIA

k

∗

∗

∗

∗

∗

∗

∗

∗

p

q

p

q

p

q

p

q

k

∗

∗

∗

∗

∗

∗

∗

∗

p

q

p

q

p

q

p

q

2

±

±

±

±

±

±

±

±

2

±

±

±

±

±

±

±

±

2

±

±

±

±

±

±

±

±

3

±

±

±

±

±

±

±

±

3

±

±

±

±

±

±

±

±

3

±

±

±

±

±

±

±

±

5

±

±

±

±

±

±

±

±

5

±

±

±

±

±

±

±

±

5

±

±

±

±

±

±

±

4

±

±

±

±

±

±

±

±

4

±

±

±

±

±

±

±

±

4

±

±

±

±

±

±

±

±

9

Table 5: Empirical values of p∗

k and q∗

k for monthly quotes.

Index

DJIA

k

∗

∗

∗

∗

∗

∗

∗

∗

p

q

p

q

p

q

p

q

0.5741

0.0657

0.5333

0.0825

0.4843

0.1059

0.5806

0.1720

0.7777

0.2771

0.6428

0.2746

0.3666

0.0488

0.4545

0.0926

0.3714

0.1206

0.5384

0.2524

0.5714

0.3581

0.2500

0.2795

S&P

0.6187

0.0848

0.5116

0.0948

0.6136

0.1500

0.5925

0.1869

0.9375

0.3369

0.6666

0.2721

0.3785

0.0610

0.4905

0.1174

0.3461

0.1338

0.6666

0.3513

0.6666

0.4303

0.2500

0.2795

Nasdaq

0.5853

0.1504

0.7083

0.2245

0.7058

0.2661

0.6666

0.3042

0.5000

0.3061

0.7500

0.5728

0.3095

0.0982

0.2307

0.1478

0.3333

0.3849

NYSE

0.6063

0.1017

0.5087

0.1160

0.5862

0.1790

0.7058

0.2661

0.9166

0.3826

0.6363

0.3076

0.3936

0.0763

0.5405

0.1500

0.4000

0.1673

0.5000

0.3061

0.5000

0.4330

0.5000

0.6123

7

±

±

±

±

±

±

±

6

±

±

±

±

±

±

±

when it is closed down for the ﬁrst time after one or several days up. The return equals

R2/N = (2p

1)w + (2q

1)(1

w).

−

−

−

(3.5)

In order to derive eq.(3.5), one should consider the problem in more details:

In the sample of all events, there are r+j series of the length j, in which all j events are
moves up. Similarly, there exist r−j series of the length j, in which all j events represent

moves down. In the both cases, the value of j varies from 1 to +

, in the limit of N

+

.

∞
. The ﬁnite values of N if appear imply the leading order

∞

→

In what follows, we set N = +

∞

at N

+

.

∞

→

described by the geometrical distribution

The probability of ﬁnding up-series of the length j in the set of all up-series is apparently

This distribution is normalized to unity. The same distribution is valid for description of the

down-series of the length j in the set of all down-series

The average number of events in the series can easily be found to be

w+j = (1

p)pj−1.

−

w−j = (1

q)qj−1.

−

< j+ >=

jw+j =

< j− >=

jw−j =

∞

X
j=1
∞

X
j=1

1

−
1

−

1

1

,

p

.

q

It is evident that the number of series r±j of the length j in a suﬃciently large sample is

proportional to the probability of ﬁnding the same series, so one can write

Since the number of all up- and down-moves is known,

< n+ >=

jr+j =

= wN,

< n− >=

jr−j =

= (1

w)N,

−

r±j = C±w±j.

∞

X
j=1
∞

X
j=1

C+
1

−
C+
1

−

p

q

10

(3.6)

(3.7)

(3.8)

(3.9)

(3.10)

(3.11)

(3.12)

(3.13)

(3.14)

(3.15)

where < n+ > + < n+ >= N, the coeﬃcients C± appear to be determined. The average

number of the series of the ﬁrst and second kind equals

< r+ >=

r+j =

wN
< j+ >

= (1

p)wN,

−

< r− >=

r−j =

(1

w)N
< j− >

−

= (1

q)(1

w)N.

−

−

∞

X
j=1
∞

X
j=1

Notice that due to the homogeneity condition (3.2),

< r+j >=< r−j > .

The return for the FT strategy represents a sum of the number of the series r+j multiplied

by the return j

2 of the j-th series plus the analogous term for the down-series:

−

∞

R2 =

(j

−

X
j=1

∞

(j

−

X
j=1

−

2)r+j +

2)r−j = N

2(< r+ > + < r− >).

(3.16)

With the help of eqs.(3.13) and (3.14) we obtain eq.(3.5).

In order to ﬁnd the dispersion of the value R2, it is necessary to perform additional con-

structions in the spirit of the theory of series encountered in the mathematical statistics (see

e.g. [2]). A part of the necessary constructions is already done above. The additional eﬀorts

are justiﬁed since the dispersion represents an important characteristics of every strategy.

The value of N is assumed to be large and ﬁnite. The probability of ﬁnding a sample

characterized by the values r+j and r−j can be written as follows

W (r+j, r−j, N) = CN

r+!r−!
r+1!r−2! ... r−1!r−2! ...

pn+qn

−(

1

−
p

q

1

)r+(

p

)r
−.

−
q

(3.17)

The combinatorial factor is the number of diﬀerent ways to order r+ up- and r− down-series
in the sample characterized by the sets of the numbers r+j and r−j. The combinatorial factor

is multiplied further to a probability of ﬁnding the one concrete conﬁguration.

Each sample contains n+ up- and n− down-moves. The value pn+ is, in principle, a

probability of ﬁnding n+ up-moves. However, the ﬁrst moves of the series appear every
q. There are r+ such moves, one move per one series. The
q)r+ and similarly for the

time with probability of 1
correct probability to have n+ up-moves is therefore pn+ − r+(1

−

−

down-moves. In this way, the rest terms in eq.(3.17) are reproduced.

The very ﬁrst and the very last elements of the whole sample play a special role, so we

should separately discuss the boundary conditions.

11

First of all, it is evident that the r+ can diﬀer from the r− at most by one unit. For
r+ = r− + 1, the sample starts and ends up with up-moves. We set for r+ = r− + 1 the
probability of ﬁnding the ﬁrst move up equal to zero. For r+ = r−
−
ends up with down-moves. For r+ = r−
1, the probability of ﬁnding the ﬁrst move down
is set equal to zero either. For r+ = r−, there are two samples, the one of which starts with

1, the sample starts and

−

an up-move, and another one starts from a down-move. The probabilities of ﬁnding the ﬁrst

elements in these two conﬁgurations are selected as would the problem is formulated for a

periodic chain: In the ﬁrst case the probability of the ﬁrst element equals 1

q, while in

−

p. Now, the problem is well

the second case the probability of the ﬁrst element equals 1
formulated. In what follows we denote r = r+ = r−.

−

The boundary conditions are, clearly, not unique. We are interested, however, by the

limit of large N where the eﬀects of the boundary conditions are not important. The above

description is needed to formulate unambiguously the problem.

Now, we are in a position to ﬁnd the dispersion of the return R2. Let us sum up the
probability W (r+j, r−j, N) over the numbers r+j and r−j keeping, however, the values r+, r−,

n+, and n− ﬁxed. It can be done with the use of the method described in ref. [2]. We obtain

W (r+j, r−j, N) = CN





n+

1

r

−
1

−









n−

1

r

−
1

−





pn+qn

−(

1

q

1

−
p

p

)r.

−
q

(3.18)

The asymptotic form at r, n+, and n− >> 1 of the ln W (r+j, r−j, N) is given by

ln W (r+j, r−j, N) =

(r

−

< r >)2
2Σ2
11

−

−

(n+

−

< n+ >)2
2Σ2
22

−

(r

−

< r >)(n+
Σ2
12

−

< n+ >)

+... (3.19)

A simple calculation shows that < r >=< r+ >=< r− >, in agreement with eqs.(3.13) and

(3.14), < n+ > and < n− > are deﬁned by eqs.(3.11) and (3.12), and

The dispersion of the value R1 = 2n+

N is determined by the dispersion σ2

1 of the value

n+, that equals

(3.20)

(3.21)

Σ2

11/N =

Σ2

22/N =

Σ2

11/N =

pq(1
(p + q)(2

,

q)
q)
p)(1

−

p)(1
−
p
−
−
pq(1
−
p)2 + (1
pq
p)(2

p

−

−

−

.

q)

((1

−

(q

−

−

q)
−
q)2)(2

,

q)

p

−

−

σ2
1 =

1/(Σ2

11Σ2

1/Σ2
11
22)

−

.

1/Σ4
12

12

Table 6: Comparison of the BH strategy (α = 1), FT strategy (α = 0), and the minimal

risk strategy for the daily (D), weekly (W), and monthly (M) quotes for the four major USA

market indices. The parameter α is a mixing parameter for the combined strategy, N is the

number of events (the number of the working days for the daily quotes, the number of weeks

and months for the weekly and monthly quotes). Return increases linearly with N, while the

dispersion increases as √N .

Type

DJIA

S&P

Nasdaq

NYSE

α

1

0

1

0

1

0

D

W

M

Return

dispersion

0.0678N

0.7880√N

0.0834N

0.9932√N

Return

dispersion

±

0.0763N

0.8334√N

0.1214N

0.9887√N

Return

dispersion

±

0.1658N

0.8909√N

0.2024N

0.9642√N

Return

dispersion

±

0.0605N

0.8456√N

0.1275N

0.9894√N

0.6216

0.0731N

0.6114√N

0.5830

0.0952N

0.6310√N

0.5381

0.1827N

0.6429√N

0.5767

0.0889N

0.6379√N

0.1245N

0.7313√N

0.0529N

0.9856√N

0.1452N

0.7281√N

0.0595N

0.9806√N

0.2637N

0.7769√N

0.1375N

0.9618√N

0.1159N

0.7479√N

0.0628N

0.9872√N

0.6397

0.0984N

0.5762√N

0.6387

0.1142N

0.5718√N

0.6060

0.1772N

0.5887√N

0.6309

0.0963N

0.5859√N

0.1631N

0.7312√N

0.0724N

0.9757√N

0.1853N

0.7953√N

0.1413N

0.9667√N

0.3179N

0.6130√N

0.1049N

0.9038√N

0.1641N

0.8057√N

0.1358N

0.9726√N

0.6340

0.1298N

0.5711√N

0.5915

0.1676N

0.6003√N

0.6698

0.2476N

0.4841√N

0.5893

0.1525N

0.6076√N

α

1

0

1

0

1

0

α

1

0

1

0

1

0

α

1

0

1

0

1

0

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

±

Notice that this value diﬀers from the value of eq.(2.7) where the two-step correlations are

not taken into account. Respectively,

The dispersion of the value R2 = N

4r is determined by the dispersion σ2

2 of the value

r:

Respectively,

∆R2

1 = 4σ2
1.

σ2
2 =

1/(Σ2

11Σ2

1/Σ2
22
22)

−

.

1/Σ4
12

∆R2

2 = 16σ2
2.

(3.22)

(3.23)

(3.24)

The problem is solved. It remains to compare the relative eﬃciency of these two strategies.

The results are placed in Table 6.

By comparing the values given in Table 6, one can conclude that in the daily regime for

all the indices the FT strategy is more eﬃcient, since it has better return with dispersion

close to the one of the alternative BH strategy. Here, however, transaction costs are not

taken into account.

One can expect that combining two strategies decreases the dispersion. This is not always

the case. Let us assume that funds invested to two strategies are in the ratio α : β, with

±

±

±

±

±

±

±

±

±

−

13

α + β = 1. The return of the combined strategy equals

R3 = αR1 + βR2.

(3.25)

In order to calculate dispersion, one should take into account the correlation between the

values R1 and R2. We obtain

∆R2

3 =

4α2/Σ2

11 + 16β2/Σ2
11Σ2
1/(Σ2

22)

22 + 16αβ/Σ2
12

.

1/Σ4
12

−

(3.26)

The minimum of ∆R2

3 is achieved either at the boundaries α = 1 (BH strategy), α = 0

(FT strategy), or at that value of α where the ﬁrst derivative of ∆R2

3 with respect to the α

vanishes. In the last case, one should require (i) 0 < α < 1 and (ii) the second derivative is

positive. In the case of a boundary minimum, the combination of the two strategies does not

result in a decrease of the dispersion. In the second case, the dispersion can be decreased.

The combination of the BH and FT strategies appears to be constructive: The conditions

(i) and (ii) are satisﬁed. In Table 6, we give values of the mixing parameter α, the return

R3, and the dispersion of the combined strategy with the lowest possible dispersion. The

minimum of the dispersion is not an obligatory requirement. The value of α is selected

as a compromise between the highest possible return and the minimum possible risk. The

above estimates show the limits within which these parameters (return and dispersion) can

4 Is large-scale dynamics determined by short-scale dy-

be changed.

namics?

We can combine successive moves in pairs, triplets, and so on. The each group of k events

(k = 1, 2, ...) corresponds to a move up or down, according as the total displacement of the

index is the positive one or the negative one. We wish to ﬁnd parameters Wk, Pk, and Qk

which describe the probability of ﬁnding a group of the k events in the state ”up”, and,

respectively, the conventional probabilities to ﬁnd two such successive groups in the states

”up” and two successive groups in the states ”down”.

The problem is motivated by the fact that participants of the market make transactions

with diﬀerent frequencies: once per minute, once per hour, ...

, up to once per month and

once per year. In the last case e.g. the change of the index during one month can be treated

14

as an elementary move. The problem of ﬁnding parameters Wk, Pk, and Qk with k > 1

in terms of the parameters w, p, and q of the smallest time interval, has a unique formal

solution, as long as the model is clearly formulated. In the view of the speciﬁc feature of the

market, it is absolutely not apparent, however, that the large-scale dynamics is determined

by the short-scale dynamics. The short-term traders take into account the behavior of the

long-term traders, since the long-term traders are usually the institutional ones. From other

side, the long-term investors take into account the short-term behavior of the market.

Here, our purpose is to check to what extent the large-scale dynamics is determined by

the short-scale dynamics. It can be done as follows: We calculate parameters Wk, Pk, and

Qk in terms of the parameters w, p, and q, determine parameters Wk, Pk, and Qk from the

historical quotes, and compare the two groups of the values.

4.1 Weekly and monthly parameters in terms of daily parameters

Let k be the number of moves (days) in the group. The probability of ﬁnding the group of

k moves ”up” is given by

W (p, q, k) =

W (r+, r−, n+, n−)γ(r+, r−)

(4.1)

Xr+,r

X
n+>n

−

−

W (r+, r−, n+, n−) = 


n+
r+

1

1

−

−









n−

r−

1

1

−

−





pn+qn

−(

1

−
p

q

1

)r+(

p

)r
−.

−
q

(4.2)

The additional factor γ(r+, r−), as compared to eq.(3.17), appears because of new boundary

conditions. The ﬁrst up event comes with a probability w, the ﬁrst event down comes with

a probability 1

w, r+ coincides with r− or diﬀers from r− by one unit. The factor

−

γ(r+, r−) = wχ+(r+, r−) + (1

w)χ−(r+, r−)

−

where

where

χ+(r+, r−) = 



χ−(r+, r−) = 


1

1−q , if r+ = r− + 1 or r+ = r−
0,

if r+ = r−

1

if r+ = r− + 1

0,
1−p , if r+ = r−

1

−

−



1 or r+ = r−

,

.

The ﬁrst term in eq.(4.3) corresponds to the case when in the group of k events the ﬁrst

move is an up-move, while the second term corresponds to the case of a down-move.

In

15

(4.3)

(4.4)

(4.5)

eq.(4.1), respectively, n+ and n− are the numbers of the moves up and down in the group.
Apparently, n+ + n− = k. The values r+ and r− give the number of the series up and down

in the considered group.

For an even k, a situation is possible when total displacement is equal to zero, n+ = n−.

In such a case, it is necessary to specify separately the meaning of the up and down moves

for groups of the k events. We assign the probability of 1/2 for interpreting neutral move as

a move up and the probability of 1/2 for interpreting neutral move as a move down. For even

k, the summation in eq.(4.1) extends to n+ = n− with the weight of 1/2. The normalization

factor in eq.(4.1) should be equal to unity according to the construction.

The probability that the second group of k events has the value ”up”, provided that the

P (p, q, k) =

ﬁrst group has the value ”up” also, can be found from equation
W ++(p, q, k)
W (p, q, k) Xr+,r
W +−(p, q, k)
W (p, q, k) Xr+,r

X
n+>n

X
n+>n

+

−

−

−

−

W (r+, r−, n+, n−)χ+(r+, r−)

W (r+, r−, n+, n−)χ−(r+, r−)

(4.6)

where the ratios W ++(p, q, k)/W (p, q, k) and W +−(p, q, k)/W (p, q, k) are the probabilities

that the last events in the up-groups are, respectively, moves up and down. The values
W ++(p, q, k) and W +−(p, q, k) are calculated as follows:

W ++(p, q, k) =

W (r+, r−, n+, n−)η+(r+, r−),

W +−(p, q, k) =

W (r+, r−, n+, n−)η−(r+, r−)

Xr+,r

X
n+>n

−

−

Xr+,r

X
n+>n

−

−

where

η+(r+, r−) =

η−(r+, r−) =

w

1−q , if r+ = r− + 1
1−w
1−p , if r+ = r−
if r+ = r−
0,

1

−

if r+ = r− + 1

w

0,
1−q , if r+ = r−
1−w
1−p , if r+ = r−

1

−

,

.








Eq.(4.7) can be explained in the following way: The last move in the group of k moves is a
move up provided that r+ = r− + 1. Else, it is a move up also at r+ = r− provided that the

ﬁrst move in the group is a move down. In the ﬁrst case, the ﬁrst move is a move up, and
so the probability W (r+, r−, n+, n−) should be divided by 1

q and multiplied by w. In the

second case, respectively, the probability should be divided by 1

p and multiplied by 1

w.

−

−

−

16

(4.7)

(4.8)

(4.9)

(4.10)

The value Q(p, q, k) can be found in the similar way:

Q(p, q, k) =

W (r+, r−, n+, n−)χ+(r+, r−)

W −+(p, q, k)
1

−

W (p, q, k) Xr+,r
W −−(p, q, k)
1

W (p, q, k) Xr+,r

−

+

−

X
n+<n

−

X
n+<n

−

−

W (r+, r−, n+, n−)χ−(r+, r−)

(4.11)

where

It is evident that

W −+(p, q, k) =

W (r+, r−, n+, n−)η+(r+, r−),

W −−(p, q, k) =

W (r+, r−, n+, n−)η−(r+, r−).

Xr+,r

X
n+<n

−

−

Xr+,r

X
n+<n

−

−

W ++(p, q, k) + W +−(p, q, k) = W (p, q, k),

W −+(p, q, k) + W −−(p, q, k) = 1

W (p, q, k).

−

(4.12)

(4.13)

(4.14)

(4.15)

One can show that the homogeneous condition (3.2) is satisﬁed for the values W , P , and Q.

Since the algorithm for construction of the quantities W , P , and Q is simple, the numerical

solution can be found quite easily.

In Table 1, we place the calculated values W , P , and Q for k = 5 (weekly quotes) and

21 (monthly quotes), the values w, p, and q are determined from ﬁtting the daily quotes.

We show also the empirical values of W , P , and Q determined from the historical weekly

and monthly quotes. In Table 2, the values of the χ2 are shown for the empirical weekly

and monthly quotes for three models of the random walking, discussed in the previous Sect.

These quotes are analyzed in the same way as the daily quotes.

The comparison of the calculated and empirical values W , P , and Q shows quite good

agreement for the weekly quotes. A noticeable deviation exists only for Nasdaq in the value

Q5. When the index falls down, a stronger than expected correlation exists: The probability

of the continuation of the down-moves exceeds the calculated value. The system easily evolves

from ”bad state to worse state” (Parkinson Law).

In all other cases, the agreement of the weekly parameters W , P , and Q with the calcu-

lated values is satisfactory. One can conclude that at the daily-weekly scale, the short-scale

dynamics (daily behavior of the indices) determines the large-scale dynamics (the weekly

data).

17

Let us compare now the calculated monthly parameters W , P , and Q with the empirical

values. We see that the values Q21’s are essentially underestimated for all indices. We

observed such an eﬀect already for the weekly quotes of Nasdaq. In the monthly quotes, the

eﬀect is much more pronounced. At the same time, the calculated values W and P coincide

within one-two standard deviations with the empirical values.

We conclude that the large-scale dynamics (monthly behavior) is determined by the short-

scale dynamics (daily behavior) only partially.

It is quite diﬀerent from what we have in

physics. On the monthly scale, there are substantial deviations from the random walking if

the memory on the past is, as we assumed, restricted by the previous day only. It is also

interesting that the values W and P calculated within the framework of such a simple model

are in reasonable agreement with the empirical values.

4.2 Renorm group in random walking problem

There is a renorm group relation between parameters W , P , and Q:

P (P (p, q, l), Q(p, q, l), k) = P (p, q, kl),

Q(P (p, q, l), Q(p, q, l), k) = Q(p, q, kl).

These relations can be used to establish the form of the functions P and Q with the help of

the boundary conditions

(4.16)

(4.17)

(4.18)

(4.19)

The algorithm described in the previous Sect. can be used to construct functions P and Q

for positive integer k. In the renorm group equations, we can set k = 1/l and ﬁnd functions

P and Q for k = 1/l. We set afterwards k = 1/m where m is an arbitrary integer number

and obtain the functions P and Q for all rational values of the arguments.

5 Combining Series Analysis with Candlesticks Chart-

ing Techniques

P (p, q, 1) = p,

Q(p, q, 1) = q.

18

The BH and FT strategies have comparable dispersions for the analyzed indices. These

strategies are, however, very diﬀerent. This is why the returns do not correlate strongly. It

means that combining these two strategies is eﬀective to reduce the dispersion.

In this Sect., we attempt to develop a computer-based strategy which is distinct from the

previous ones. This strategy uses new technical tools. Due to this reason, we expect that its

return does not correlate strongly with the BH and FT returns, so that by combining these

strategies the dispersion can further be reduced.

The candlesticks charting techniques is believed to be useful for understanding the major

market moves and its turning points [5]. It is the most useful when it is supplemented with

general analysis of the market. The series analysis which we discussed in the previous Sects.

provides useful hints in this respect. Long series e.g.

result into overbought or oversold

states, in which the candlesticks patterns work diﬀerently. We perform a backtest of the

candlesticks patterns separately for the up- and down-series of each length. One can expect

that combining the series analysis with the candlesticks techniques can improve the record

of the single methods.

5.1 Use and misuse of computer backtesting

Backtesting means the following: Suppose we have a well ﬁxed strategy, i.e. a ﬁxed set of

prescriptions when to buy and sell an index. If we have historical quotes, the performance

of the strategy can be tested. Such a procedure is called backtesting. It gives an idea on the

possible future performance.

We make distinction between causal backtesting and non-causal backtesting. To explain

the diﬀerence, consider an example: Let we work with a moving average which has just one

free parameter, the number of days to be averaged. This parameter can be treated as a ﬁtting

parameter. It can be determined by requiring that the return during the backtested period

be the greatest one.

The return obtained this way is, however, not the one to be expected from the future

performance. Since the ﬁtted parameter depends on the whole backtested set of the histor-

ical quotes, the return e.g. in the year 1975 depends e.g. on the year 1995, in the apparent

contradiction with the causality. The non-causal backtesting gives an idea on the reason-

able values of the ﬁtting parameters, but the return is always overestimated. The example

described above illustrates the possible misuse of the computer backtesting.

19

Table 7: The year-by-year performance of the BH strategy, FT strategy, and the mini-

mum risk strategy (MR) for the daily DJIA index. We show also the performance of the

computer-based strategy (CB) described in this Sect. In the last two columns, the number

of transactions per year (TR) and the win-to-loss ratio (W/L) are given for the CB strategy.

Year

BH

FT MR

CB

TR

W/L

Year

BH

FT MR

CB

TR

W/L

1936

1937

1938

1939

1940

1941

1942

1943

1944

1945

1946

1947

1948

1949

1950

1951

1952

1953

1954

1955

1956

1957

1958

1959

1960

1961

1962

1963

1964

1965

1966

1967

34

-1

4

2

15

-18

30

33

48

40

-4

15

18

18

53

11

23

7

67

58

2

-3

42

38

-15

23

-12

25

39

30

-27

13

-13

12

-10

-13

9

44

37

53

25

58

58

20

14

17

27

26

44

38

47

45

40

19

35

34

53

17

31

2

36

26

59

46

15

4

-1

-4

12

6

32

41

38

47

20

17

16

17

42

17

31

19

59

52

17

5

39

36

12

20

5

15

37

28

7

26

-4

3

-1

4

-2

4

2

-4

1

-3

18

20

16

27

27

19

15

24

28

21

16

14

28

20

13

11

-5

5

15

13

9

19

19

23

57

26

23

19

10

35

11

31

87

73

75

90

84

89

84

70

75

91

93

74

74

89

98

71

64

55

69

107

102

0.6522

1.3000

0.9655

1.3636

0.8400

1.5333

1.5000

0.7949

1.2000

0.8235

1.5217

1.7547

1.5424

1.8571

1.9474

1.5429

1.4348

2.0435

1.7778

1.4267

1.3544

2.2174

1.4598

1.2921

1.3492

0.8936

1.1075

1.5357

1.5098

1.3913

1.7600

103

1.7467

1968

1969

1970

1971

1972

1973

1974

1975

1976

1977

1978

1979

1980

1981

1982

1983

1984

1985

1986

1987

1988

1989

1990

1991

1992

1993

1994

1995

1996

1997

1998

1999

9

-20

1

12

-6

-29

-34

17

8

-7

2

16

27

-16

-16

19

-26

19

22

34

15

31

15

-3

3

39

5

33

39

23

21

-2

35

37

42

46

36

53

50

33

0

19

25

-10

-2

8

4

4

12

-7

-10

20

-22

7

-6

30

-29

-26

9

7

11

0

23

-17

19

2

17

25

10

23

3

0

4

3

11

5

15

-6

-8

13

8

9

28

0

21

6

10

-9

13

6

22

27

13

21

-8

-10

8

5

14

22

8

10

-1

0

8

-2

20

-8

-1

3

0

5

2

5

6

7

14

11

12

9

18

0

11

9

0

3

-1

-14

114

1.1923

95

72

61

67

83

73

12

82

85

114

109

91

80

67

108

102

93

72

58

73

64

95

76

70

68

0

67

60

4

11

68

1.1839

1.1493

1.5957

1.9778

1.2133

0.9730

1.0000

1.2162

0.9540

1.4255

0.8632

1.0682

1.0000

0.9706

1.0971

1.0400

1.3544

1.1493

1.2308

1.2121

1.4151

1.2892

1.2687

0.6667

1.7200

0.0000

1.3929

1.3529

1.0000

1.7500

0.9710

20

Table 8: The year-by-year performance of the BH strategy, FT strategy, and the mini-

mum risk strategy (MR) for the daily S&P index. We show also the performance of the

computer-based strategy (CB) described in this Sect. In the last two columns, the number

of transactions per year (TR) and the win-to-loss ratio (W/L) are given for the CB strategy.

Year

BH

FT MR

CB

TR

W/L

Year

BH

FT MR

CB

TR

W/L

1955

1956

1957

1958

1959

1960

1961

1962

1963

1964

1965

1966

1967

1968

1969

1970

1971

1972

1973

1974

1975

1976

1977

-2

-15

-9

63

23

-3

49

39

44

36

-13

-10

35

9

-4

2

23

26

-26

-41

18

19

-14

-17

23

44

47

16

49

27

39

22

42

41

69

44

43

63

45

56

58

47

48

34

14

29

-8

0

12

56

20

17

40

7

32

43

38

21

38

22

22

19

36

38

3

-5

24

17

3

-1

-10

1

28

10

7

18

7

0

0

0

0

5

6

1

5

4

4

6

5

-1

30

10

68

62

79

68

52

47

50

55

0

0

0

0

13

20

11

10

13

55

51

118

58

129

92

0.9710

0.7222

1.0256

2.4000

1.4762

1.3500

2.1250

1.2917

0.0000

0.0000

0.0000

0.0000

2.2500

1.8571

1.2000

0.8182

2.2500

1.1569

1.1702

1.6818

1.2308

1.0806

1.2439

-11

-10

1978

1979

1980

1981

1982

1983

1984

1985

1986

1987

1988

1989

1990

1991

1992

1993

1994

1995

1996

1997

1998

1999

9

32

29

-11

-25

23

-27

22

29

33

25

48

17

-5

7

7

14

60

22

28

28

6

43

25

38

28

8

10

15

-4

18

-12

-14

13

4

6

-9

24

-13

21

27

8

9

1

22

29

32

4

9

-12

19

15

27

9

34

11

0

0

13

3

44

24

20

20

4

28

16

8

5

7

-3

-2

9

-3

-1

1

4

0

4

2

2

18

13

6

-6

11

145

128

102

162

139

102

41

27

33

31

19

30

37

38

28

32

28

58

60

64

81

81

1.4786

1.2857

1.1702

1.0637

0.8658

1.1474

0.8636

0.8621

1.7500

0.8235

1.1111

1.3077

0.9474

1.0000

1.3333

1.1333

1.1538

1.9000

1.5532

1.2069

0.8621

1.3143

21

Causal backtesting means the following: In the year 1975, we calculate from the historical

quotes an optimal value of the days for a moving average. Using this optimal value, we

calculate then the return in the year 1976. After that, we calculate an optimal value of the

days by adding the year 1976 to the set of the historical quotes, which we used earlier to ﬁx

the ﬁtting parameter. This new optimal value is used to calculate the return in the year 1977.

The procedure is repeated every year. The total return is a sum of the returns calculated

for all the years. Such a calculation is essentially equivalent to a real-time testing. The

causality, clearly, is not violated, since the calculated return e.g. in the year 1977 depends on

the historical quotes from the previous years only. The return from the causal backtesting

gives more realistic idea on the future performance. It is always lower than the return form

the non-causal backtesting. In what follows, we speak on the causal backtesting only.

5.2 Analytic images of candlesticks charting patterns for comput-

ers

The characteristic candlesticks patterns are described in the literature in an intuitive fashion

[5]. In order to implement the candlesticks charting techniques into a computer code, one

needs to formulate in a language clear for every programmer how to distinguish the special

informative patterns from the common ones. We include into our code about 30 analytic

images which correspond to about 20 typical candlesticks patterns. Since clear prescriptions

on how to construct the analytic images do not exist, several analytic images are usually

probed. The code by analyzing the past performance decides which analytic images work

Example 1: The one-line ”hammer” pattern is expected to be bullish in the downtrend.

This pattern does work in down-series. Several analytic images can be proposed to distinguish

better.

the hammer pattern:

ξ =

ξ =

O, H
10 min(H
−
H
L
−
C) +

10(H

−

O

C
|

, etc

H
L
C) + max(H

−

O, H

−

−

,

C)

(5.1)

(5.2)

|
where H, L, O, C are the high, low, open, and close of the index. For the hammer pattern,

−

−

the value of ξ is large positive. The code uses this signature to recognize the hammer pattern

between the others. How large ξ should be is decided by computer from the analysis of the

22

Table 9: The year-by-year performance of the BH strategy, FT strategy, and the mini-

mum risk strategy (MR) for the daily Nasdaq index. We show also the performance of the

computer-based strategy (CB) described in this Sect. In the last two columns, the number

of transactions per year (TR) and the win-to-loss ratio (W/L) are given for the CB strategy.

Year

BH

FT MR

CB

NT

W/L

1990

1991

1992

1993

1994

1995

1996

1997

1998

1999

6

45

12

57

13

44

48

37

38

40

1

58

37

50

39

37

37

46

19

7

4

50

22

54

23

41

43

40

30

26

11

50

31

43

26

40

40

57

11

28

81

183

177

146

164

151

167

178

174

137

1.3143

1.7519

1.4247

1.8350

1.3768

1.7207

1.6299

1.9421

1.1350

1.5138

historical performance of the considered image. The critical value of ξ depends on the length

of the down-series in which the bullish pattern appears.

Example 2: Two-line candlesticks pattern ”bullish engulﬁng lines”. The following ana-

lytic image can be proposed

ξ =

H
< H

−
−

L
L >

H

C
|
L

O
C

−
− |

|
−

O

|

C
|

O
−
< H

| − |
−

−

C ′
−
L >

O′

|

,

(5.3)

if (C ′

O′)(C

O) < 0 and ξ = 0 otherwise. Here, C ′ and O′ are the close and open of

−

−

the analyzed index from the previous day. The values of ξ should be large when the bullish

engulﬁng lines pattern is formed. How large the value of ξ should be is decided by the

computer from analysis of the past pattern performance. The critical value of ξ are diﬀerent

for the down-series of the diﬀerent lengths, in which the bullish pattern appears.

The similar formulae can also be written for other patterns. Notice again that there is no

a unique prescription how to construct the analytic images. The similar situation exists in

the mathematical statistics where the so-called ”statistics”, which play an important role in

the decision theory, are not uniquely deﬁned. Nevertheless, they are widely used in the data

analysis (see e.g. [2, 3, 6] and references therein).

The analytic images work in the code as follows: We consider the ﬁrst 5 to 10 years

of the historical quotes to ﬁx conﬁdence intervals for the analytic images. We list and keep

information on the all up- and down-series of a ﬁxed length. For each series and each pattern,

a distribution function of ξ is constructed. We compare the number of points in the conﬁdence

interval ξ

(

, a) which are accompanied by continuation and reversal of the series. The

∈

−∞

23

Table 10: The year-by-year performance of the BH strategy, FT strategy, and the mini-

mum risk strategy (MR) for the daily NYSE index. We show also the performance of the

computer-based strategy (CB) described in this Sect. In the last two columns, the number

of transactions per year (TR) and the win-to-loss ratio (W/L) are given for the CB strategy.

Year

BH

FT MR

CB

NT

W/L

-10

-12

1971

1972

1973

1974

1975

1976

1977

1978

1979

1980

1981

1982

1983

1984

1985

1986

1987

1988

1989

1990

1991

1992

1993

1994

1995

1996

1997

1998

1999

40

24

-28

-41

10

18

-13

12

42

30

-2

-28

18

-19

26

35

32

28

46

23

4

9

14

10

61

20

26

28

-14

7

60

53

52

34

22

23

57

34

42

28

16

18

25

0

20

-2

13

20

12

9

24

-1

27

31

0

19

13

-15

15

28

50

50

35

25

24

16

40

33

34

28

12

6

-4

-3

5

-7

14

8

-1

15

2

5

22

15

11

9

137

195

189

190

215

234

196

180

216

196

202

186

160

109

127

194

91

135

81

131

147

74

115

115

109

143

166

116

128

1.5138

1.6897

1.7194

1.4516

1.2632

1.2286

1.1778

1.5714

1.3607

1.4198

1.3218

1.1379

0.8286

1.3191

1.0992

0.9596

0.9362

1.0769

0.8409

1.2393

1.1151

0.9733

1.3000

1.0354

1.0962

1.3636

1.1987

1.2095

1.1513

26

38

4

-3

19

19

1

30

38

34

10

6

-4

25

21

27

16

32

21

7

9

18

5

47

24

15

24

-3

24

value of a is varied. We are looking for those values of a which give the best chance of the

continuation or the reversal of the series. We pay attention to an image if and only if the

conﬁdence interval provides a chance better than 3 : 1 (win-to-loss ratio). There are many

conﬁdence intervals providing such chances and containing many data points. The win-to-loss

ratio at this stage refers, however, to the non-causal backtesting. It should be overestimated,

as we discussed above. Indeed, the causal backtesting of the years, following the ﬁrst ones,

shows that the actual win-to-loss (W/L) ratio is about 4:3, as shown in Tables 7 - 10. The

conﬁdence intervals ξ

(b, +

) are constructed in the same way and the common results

are the similar.

∈

∞

The backtest results reported in Tables 7, 8, 9, and 10 for the computer-based strategy

are mixed at present. There are extended time periods in the S&P and NYSE indices where

the computer-based strategy worked well. Nasdaq gives also good record. There are periods

at DJIA, S&P, and NYSE indices, however, where the records are quite poor. The available

code will be improved.

6 Conclusion

In this paper, a statistical analysis of the major USA market indices DJIA, S&P, Nasdaq,

and NYSE is made. We veriﬁed that the market behavior is very close to the stochastic one

and that the market dynamics is quite similar to the random walking.

The Markov chains approach was applied to study two-step correlations in the daily,

weekly, and monthly historical quotes. The correlation parameters are determined empiri-

cally. The correlations are found to be statistically signiﬁcant for the daily quotes, whereas

the weekly and monthly quotes do not display clear eﬀect.

There are deviations from the geometrical distribution of the number of series of the ﬁxed

length. The empirical probabilities are collected in Tables 3, 4, and 5. There are exceptional

deviations: Nasdaq during the years 1985 - 2000 did not fall oﬀ more than 6 weeks in raw in

the weekly quotes and more than 4 month in raw in the monthly quotes.

We calculated the return and the dispersion of the buy-and-hold and follow-trend strate-

gies. These strategies are combined to decrease the dispersion. The optimal ratio between

investments into these two strategies, providing a minimal risk, is found analytically.

The weekly and monthly correlation parameters are calculated in terms of the daily

25

parameters. The results show reasonable agreement with the empirical data for the weekly

quotes. There are, however, evident deviations in the monthly quotes for the down-series.

The empirical probabilities for continuation of the down-trend are noticeably greater than the

calculated probabilities (Parkinson Law?). It can be interpreted to mean that the large-scale

market dynamics is not fully determined by the short-scale dynamics.

It was shown that the correlation parameters at diﬀerent scales obey the renorm group

equations.

This work reported also the intermediate results of the constructing a computer-based

strategy that combines the series analysis with the candlesticks charting techniques.

Acknowledgments

The results of the statistical analysis of the historical quotes for the four major USA mar-

ket indices DJIA, S&P, Nasdaq, and NYSE are reported from the permission of Commodity

Systems, Inc. (CSI), the copyright owner of these quotes (web-site http://www.csidata.com).

The author wishes to thank also the Dow Jones Indexes, the owner of the Dow Jones In-

dustrial Average, for providing him with the DJIA historical quotes and the permission to

use these quotes for the present publication. The author is grateful to European Physical

Society for a grant which made possible his participation at the Conference ”Application

of Physics in Financial Analysis” (5 - 7 December 2001, London). The author is indebted

to the Institute for Theoretical Physics of University of Tuebingen for kind hospitality and

providing an opportunity to bring this paper into the ﬁnal form.

26

References

Moscow, 1947.

[1] S. Chandrasekhar, Stochastic Problems in Physics and Astronomy, International Lit.,

[2] C. Wilks, Mathematical Statistics, Nauka, Moscow, 1967.

[3] V. S. Korolyuk, N. I. Portenko, A. V. Skorokhod, A. F. Turbin, Handbook on Probability

Theory and Mathematical Statistics, Nauka, Moscow, 1985.

[4] R. W. Colby and Th. A. Meyers, The Encyclopedia of Technical Market Indicators,

McGraw-Hill, New York e. a., 1988.

Sons, Inc., New York e. a., 1994.

[5] S. Nison, Beyond Candlesticks, New Japanese Charting Techniques, John Wiley &

[6] M. I. Krivoruchenko, Statistical Analysis of the Angular Distribution of Neutrino Events

Observed in Kamiokande II and IMB Detectors from Supernova SN 1987 A, Z. Phys.

C44, 633 (1989).

27

