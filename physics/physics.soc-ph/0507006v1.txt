5
0
0
2
 
l
u
J
 
1
 
 
]
h
p
-
c
o
s
.
s
c
i
s
y
h
p
[
 
 
1
v
6
0
0
7
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Cluster analysis for portfolio optimization

Vincenzo Tola∗,1, 2 Fabrizio Lillo,3, 4 Mauro Gallegati,1 and Rosario N. Mantegna3
1Dipartimento di Economia, Universit`a Politecnica delle Marche, Piazza Martelli 8, I-60121 Ancona, Italia
2Banca d’Italia, Rome, Italy
3Dipartimento di Fisica e Tecnologie Relative, Universit`a di Palermo, viale delle Scienze, I-90128 Palermo, Italia
and
INFN, Sezione di Catania, Catania, Italy
4Santa Fe Institute, 1399 Hyde Park Road, Santa Fe NM 87501, USA

We consider the problem of the statistical uncertainty of the correlation matrix in the optimization
of a ﬁnancial portfolio. We show that the use of clustering algorithms can improve the reliability of
the portfolio in terms of the ratio between predicted and realized risk. Bootstrap analysis indicates
that this improvement is obtained in a wide range of the parameters N (number of assets) and T
(investment horizon). The predicted and realized risk level and the relative portfolio composition of
the selected portfolio for a given value of the portfolio return are also investigated for each considered
ﬁltering method.

Key words: Portfolio optimization, Clustering meth-

ods, Correlation matrices, Random Matrix Theory.

JEL Classiﬁcation: G11;C30;C15.

perfect forecasting of future returns and volatilities the
distance between the predicted optimal portfolio and the
realized one is smaller for the ﬁltered correlation matrix
than for the original one at a given level of the portfolio
return.

I.

INTRODUCTION

The problem of portfolio optimization is one of the
most important issue in asset management [1]. Since the
seminal work of Markowitz [2], which solved the problem
under a certain number of simplifying assumptions (see
also Section II), many other studies have been devoted
to consider several aspects of portfolio optimization both
from a theoretical and from an applied point of view.
Here we focus our attention on the role of correlation
coeﬃcient matrix in portfolio optimization. The estima-
tion of the correlation matrix has unavoidably associated
a statistical uncertainty, which is due to the ﬁnite length
of the asset return time series. Recently, there have been
several contributions in the econophysics literature de-
voted to quantify the degree of statistical uncertainty
present in a correlation matrix. The results of these in-
vestigations have been obtained by using concepts and
tools of random matrix theory (RMT) [3]. The RMT
quantiﬁcation of the statistical uncertainty associated
with the estimation of the correlation coeﬃcient matrix
of a ﬁnite multivariate time series has been recently used
to device a procedure to ﬁlter the information present
in the correlation coeﬃcient matrix which is robust with
respect to the unavoidable statistical uncertainty (in the
econophysics literature it has been used the term of noise
dressing) [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18].
The correlation matrices obtained by this ﬁltering pro-
cedure has been used in portfolio optimization. Some
studies [7, 10] have shown that under the assumption of

∗Opinions expressed in this paper are exclusively by the authors
and do not necessarily reﬂect those of Banca d’Italia

In recent years, other ﬁltering procedures of the cor-
relation coeﬃcient matrix performed using correlation
based clustering procedures has also been proposed in
the econophysics literature [19, 20, 21, 22, 23, 24, 25,
26, 27, 28, 29, 30, 31, 32, 33, 34, 35]. These methods
also select information of the correlation coeﬃcient ma-
trix which is representative of the entire matrix and it
is often less aﬀected by the statistical uncertainty and
therefore more stable than the entire matrix during the
time evolution of the system.

In this paper we investigate how the portfolio optimiza-
tion procedure is sensitive to diﬀerent ﬁltering procedures
applied to the correlation coeﬃcient matrix. Speciﬁcally
we consider ﬁltering procedures based on RMT and on
correlation based clustering procedures. The paper is or-
ganized as follows. In Section II we describe brieﬂy the
mean variance optimization problem, we deﬁne the nota-
tion and we summarize the problem of the estimation of
the correlation matrix. In Section III we review the ap-
proach recently introduced [7, 10] which makes use of the
RMT to improve the portfolio optimization in the pres-
ence of estimation errors due to the ﬁniteness of sample
data. In Section IV we describe the clustering algorithms
used to perform the portfolio optimization. These algo-
rithms are average linkage and single linkage.
In Sec-
tion V we describe two methods based on these cluster-
ing algorithms to build asset portfolios which are robust
and reliable. Finally in Section VI we summarize our
results and indicate future work extending and possibly
improving our method.

II. PORTFOLIO OPTIMIZATION

A. Markowitz’s solution

In this section we brieﬂy discuss the basic aspects of
Markowitz portfolio optimization. This is also useful to
set the notation and to state the assumption made and
the methods used. Given N risky assets the portfolio
composition is determined by the weights pi (i = 1, ..., N )
giving the fraction of wealth invested in asset i. The
N
i=1 pi = 1. The average
weights are normalized as P
return and the variance of the portfolio are

N

rp

≡

X
i=1

pimi

σ2
p ≡

N

N

X
i=1

X
j=1

pipjσij ,

(1)

(2)

where mi is the mean return of asset i and σij is the
covariance between returns of asset i and j. The opti-
mization problem consists in ﬁnding the vector p which
minimizes σp for a given value of rp. We assume that
short selling is allowed, i.e. pi can assume negative val-
ues. As known the solution of this optimization problem
has been found by Markowitz [2] and it is

p∗

= λΣ−11 + γΣ−1m

(3)

where Σ is the covariance matrix, 1T = (1, ..., 1) and m
is the vector of the mean returns of the N assets. The
other parameters are

C

rpB

λ =

−
∆
A = 1T Σ−11
C = mT Σ−1m

rpA

B

−
∆

γ =
B = 1T Σ−1m
B2
∆ = AC

−

B. Curse of dimensionality and adopted method

The Markowitz’s solution to the optimization problem
relies upon a series of assumptions that are rarely ob-
served in practice. First of all the asset returns are as-
sumed to be Gaussian variables whereas fat tails in price
return distribution are observed. Second the parameters
used in the optimization, i.e. the mean values m and the
covariance matrix Σ, are assumed constant. Finally even
if these quantity are really constant in the time horizon
relevant for the problem, their statistical estimation over
ﬁnite time intervals T leads to the problem known as
curse of dimensionality. Since the covariance matrix has
N 2/2 distinct entries whereas the num-
N (N
ber of records used in the estimation is N T , one needs
time series of length T >> N in order to have small er-
ror on the covariance. But for long T non stationarity
becomes more and more important. For these reasons it

1)/2

−

∼

2

is important to develop methods able to ﬁlter the part of
the covariance matrix which is less likely to be aﬀected
by statistical uncertainty, and use (when possible) the
ﬁltered information to build portfolios.

≡

In this paper we are mainly concerned with the prob-
lems in the portfolio optimization due to the estimation
of the correlation matrix, i.e the matrix whose entries
are the correlation coeﬃcient between returns of dif-
ferent assets. The correlation coeﬃcient is deﬁned as
σij/√σiiσjj . Therefore we will use the following
ρij
procedure [7, 10] to assess the eﬀectiveness of the ﬁltering
procedure of the correlation coeﬃcient matrix based on
RMT. Given N assets, a portfolio horizon of T trading
days and a time t0 when the optimization is supposed
to take place, we compute the correlation matrix in the
T days preceding t0 but we compute the mean returns
mi and the volatilities σi
√σii in the T days following
t0. We use these data to compute the covariance matrix
and the predicted optimal portfolio at time t0. We then
compare the predicted risk-return curve with the realized
risk-return curve obtained by computing

≡

ˆσ2
p ≡

N

N

X
i=1

X
j=1

∗
i p

∗
j ˆσij ,

p

(4)

where p∗
i are the weights obtained in the optimization
and ˆσij is the covariance matrix observed between t0 and
t0 + T . By using this procedure we are able to decou-
ple the problem of estimating cross correlations from the
problem of estimating mean returns and volatilities. In
other words we will assume that the investor has a per-
fect forecast of mi and σi and all her uncertainty is in
the estimation of the cross correlation matrix.

In order to quantify and compare the goodness of dif-
ferent ﬁltering methods we make use of three measures.
The ﬁrst quantity measuring the reliability of the portfo-
lio is obtained by comparing, for a given value of expected
return, the risk σp predicted by using the past correlation
matrix with the realized risk ˆσp of Eq. 4. A portfolio is
more reliable when

ˆσp
|

−
σp

σp

|

R ≡

(5)

−

σp

ˆσp
|

is small. We have also used diﬀerent measures of the
reliability, such as

, obtaining similar results.
|

The second quantity used to compare diﬀerent meth-
ods is simply the realized risk ˆσp. Clearly a portfolio is
less risky of another one when its realized risk is smaller.
Note that in general a portfolio with a small risk is not
necessarily better than a more risky portfolio. In fact if
the uncertainty on the risk of the safe portfolio is very
large, an investor could face large ﬂuctuations and there-
fore a larger loss.

The third characteristic for evaluating portfolio opti-
mization methods is the degree of reduction in the ef-
fective dimension of the portfolio. Dealing with a large
portfolio can be very costly because of the transaction
costs that the investor has to face any time she wants to

rebalance the weights. Even if we do not consider here
the problem of portfolio rebalancing and benchmarking,
we wish to quantify the “eﬀective” number of stocks with
a signiﬁcant amount of money invested in. We quantify
this number as

(ef f ) =

N

1
N
i=1 p2
i

P

(6)

This quantity is equal to 1 when all the wealth is in-
vested in only one asset, whereas it is equal to N when
the wealth is divided equally among the N assets, i.e.
It may be worth noting that the quantity
pi = 1/N .
(ef f ) does not give the number of assets where a non
N
vanishing amount of wealth is invested in. It simply gives
a rough estimate of the number of assets that could ef-
fectively be used to build a smaller portfolio with risk-
returns properties not too far from the original N asset
portfolio.

In the next sections, the diﬀerent ﬁltering procedures
considered in this paper are investigated by using the set
of data of 1071 stocks continuosly traded at New York
Stock Exchange (NYSE) during the period 1988-1998. In
this study, we consider daily returns.

III. RANDOM MATRIX THEORY APPROACH

Recently [5, 6] it has been shown that the RMT can
be useful to investigate the properties of return corre-
lation matrices of ﬁnancial assets. The simpler random
matrix is a matrix of given type and size whose entries
consist of random numbers from some speciﬁed distribu-
tion [3]. RMT was developed originally in nuclear physics
and then applied to many diﬀerent ﬁelds. In the context
of asset portfolios RMT is useful because allows to com-
pute the eﬀect of statistical uncertainty in the estimation
of the correlation matrix. Suppose that the N assets are
described by N time series of length T and that the re-
turns are independent Gaussian random variables with
zero mean and variance σ2. The correlation matrix of
is simply the
this set of variables in the limit T
identity matrix. When T is ﬁnite the correlation ma-
trix will in general be diﬀerent from the identity matrix.
RMT allows to prove that in the limit T, N
, with a
ﬁxed ratio Q = T /N
1, the eigenvalue spectral density
of the covariance matrix is given by

→ ∞

→ ∞

≥

T

ρ(λ) =

2πσ2λ p(λmax

−

−

λ)(λ

λmin),

(7)

min = σ2(1 + 1/Q

where λmax
2p1/Q). The spectral den-
±
sity is diﬀerent from zero in the interval ]λmin, λmax[. In
the case of a correlation matrix σ2 = 1. The spectrum
described by Eq. (7) is diﬀerent from N δ(λ
1) which
is expected by an identity correlation matrix. In other
words RMT quantiﬁes the role of the ﬁniteness of the
length of the time series on the spectral properties of the
correlation matrix.

−

3

FIG. 1: The continuous lines are the predicted risk
and the dashed lines are the realized risk. The cir-
cles refer to the Markowitz portfolio optimization,
whereas the squares are the predicted and realized
risk curves obtained by ﬁltering the correlation ma-
trix with the Random Matrix Theory approach. We
assume that the only uncertainty of the investor is
on the correlation matrix. The dataset is composed
by the 150 most capitalized stocks at NYSE in the
period 1989 − 1992. The ﬁrst two years are used
for the estimation of the correlation matrix and the
other two years are the investment period.

RMT has been applied to correlation matrices of re-
turns of ﬁnancial assets [5, 6] and it has been shown that
the spectrum of a typical portfolio can be divided in three
classes of eigenvalues. The largest eigenvalue is totally
incompatible with Eq. (7) and describes the common be-
havior of the stocks composing the portfolio. A fraction
of the order of 5% of the eigenvalues are also incompati-
ble with the RMT because they fall outside the interval
]λmin, λmax[. These eigenvalues probably describe eco-
nomic information stored in the correlation matrix. The
remaining large part of the eigenvalues is between λmin
and λmax and thus one cannot say whether any informa-
tion is contained in the corresponding eigenspace.

The fact that by using RMT it is possible, under cer-
tain assumptions, to identify the noisy part of the cor-
relation matrix suggested several authors [7, 10] to use
RMT in the optimization of ﬁnancial portfolios. Speciﬁ-
cally the suggested method [10] is the following.

One computes the correlation matrix and ﬁnds the
spectrum ranking the eigenvalues such that λk < λk+1.
One then computes the variance of the part not explained
by the highest eigenvalue as σ2 = 1
λ1/N and uses this
value in Eq. 7 to compute λmin and λmax. One then
constructs a ﬁltered diagonal matrix obtained by setting
to zero all the eigenvalues smaller than λmax and leav-
ing unaltered the remaining ones. Finally one obtains the
ﬁltered correlation matrix by transforming the ﬁltered di-
agonal matrix in the original basis. In order to obtain a
meaningful correlation matrix we set to one the diagonal
elements of the ﬁltered correlation matrix. This matrix

−

R

preserve only the information of the original correlation
matrix that the RMT recognize as signal. It has been
shown that the portfolio obtained by using the ﬁltered
correlation matrix has a smaller value of
than a portfo-
lio with weights obtained with the Markowitz’s procedure
and by using the whole correlation matrix. As an exam-
ple we show in Figure 1 the predicted and realized risk
for a portfolio of the 150 most capitalized stocks traded
at NYSE in a period of T = 500 trading days. In this and
in the other ﬁgures the risk and return are computed on a
yearly time horizon. We have estimated the correlation
matrix in the two year period 1989-1990 and the real-
ized risk is computed in the two year period 1991-1992.
The ﬁgure shows the risk-return curve for the Markowitz
portfolio and for a portfolio obtained by ﬁltering the cor-
relation matrix with the RMT method outlined above.
We note that for all the value of the expected return rp
the parameter
for the RMT portfolio is signiﬁcantly
smaller than for the Markowitz portfolio. For this portfo-
lio the realized risk of the RMT portfolio is smaller than
the realized risk of the Markowitz portfolio. This is in
agreement with what, for example, Rosenow et al.
[10]
ﬁnd for another set of data. We wish to point out that
the behavior of Fig. 1 is rather common in diﬀerent port-
folios. However, we have found that for some portfolios
the realized risk proﬁle obtained with the RMT ﬁlter-
ing is larger than the one obtained with the Markowitz
approach.

R

IV. CLUSTERING ALGORITHMS

In this paper, we introduce a new portfolio optimiza-
tion technique which is based on clustering algorithms.
Clustering is a common practice in multivariate data
analysis [36]. The purpose of clustering analysis is to
obtain a meaningful partition of a set of N variables
in groups according to their characteristics. For exam-
ple in correlation based clustering algorithms (adopted
here) the correlation coeﬃcient between two time se-
ries is assumed as a measure of the similarity between
the two time series. Correlation based clustering has
been recently used to infer the hierarchical structure of a
portfolio of stocks from its correlation coeﬃcient matrix
[19, 23, 31]. Correlation based clustering may be seen
as a ﬁltering procedure, i.e. a matrix transformation re-
taining a smaller number of distinct elements. After its
application one usually retain a subset of the distinct el-
ements composing the correlation coeﬃcient matrix. For
example, in the clustering algorithm of the single link-
age [37] the number of distinct elements present in the
1 whereas the number of distinct
ﬁltered matrix is n
elements present in the original matrix is n(n
1)/2.
The selection of these n
1 elements is done according
to some widespread algorithm [38]. A possible concep-
tual description of the algorithm is the following. Let us
assume that a similarity measure S between pairs of ele-
ments is deﬁned, e.g. the correlation coeﬃcient between

−

−

−

4

pairs of elements of the system. An ordered list Sord of
pair of elements can be constructed by arranging them
in a descending order accordingly with the value of the
similarity sij between element i and element j. Diﬀerent
elements are iteratively included in clusters starting from
the ﬁrst two elements of the similatity measure ordered
list. At each step, when two elements or one element and
a cluster or two clusters p and q merge in a wider sin-
gle cluster t, the similarity or distance between the new
cluster t and cluster r is determined as follows: if sij is
a correlation-like measure

str = max

spr, sqr

(8)

{
indicating that the similarity between any element of
cluster t and any element of cluster r is the similarity
between the two most similar entities in clusters t and r.
Conversely, if sij is a distance-like measure

}

str = min
{

spr, sqr

.

}

(9)

−

−

By applying iterarively this procedure n

1 of the
n(n
1)/2 distinct elements of the correlation coeﬃcient
matrix are selected. When a distance-like measure is used
as, for example, dij = p2(1
ρij) [39], the distance ma-
−
trix obtained by applying the single linkage procedure is
an ultrametric matrix comprising the n
1 distinct se-
−
lected elements. Ultrametric distances d<
ij are distances
ab, d<
d<
satisfying a inequality d<
stronger than
bc}
the customary triangular inequality dac
dab + dbc [40].
≤
In particular, the single linkage clustering procedure has
associated an ultrametric correlation coeﬃcient matrix
which is the subdominant ultrametric matrix of the orig-
inal correlation coeﬃcient matrix. For a didactic descrip-
tion of the method used to obtain the ultrametric matrix
one can consult Ref. [41].

max
{

ac ≤

In Ref.

[42] it is proved that the ultrametric corre-
lation matrix obtained by the single linkage clustering
procedure of the correlation coeﬃcient matrix is always
positive deﬁnite when all the elements of the obtained
ultrametric correlation matrix are positive. This condi-
tion is rather common in ﬁnancial data of stock portfolio
and it has always been observed for all the investigations
we have performed so far. The eﬀectiveness of the single
linkage clustering procedure in pointing out the hierarchi-
cal structure of the investigated portfolio has been shown
by several studies [19, 21, 23, 26, 27, 29, 31, 32, 33].
However, the single linkage is just one possible correla-
tion based ﬁltering methods. Other methods have also
been applied to ﬁnancial portfolios [20, 22, 24, 25, 26,
27, 28, 30, 34, 35]. Each method puts a speciﬁc empha-
sis on some aspects of the original matrix and is usually
able to point out a series of aspects that might not be
elucidated by diﬀerent ﬁltering procedure. The choice
of the ﬁltering method must therefore be guided by the
speciﬁc goals that one pursues. In the present study, we
decide to consider the average linkage procedure in ad-
dition to the single linkage procedure. The average link-
age is another widespread clustering algorithm [43]. The

diﬀerence with the single linkage algorithm is that the
similarity measure between an element and the closest
cluster is given by the mean similarity measure between
the considered element and each element of the closest
cluster. In other words, if sij is a similarity-like measure,
at each stage one obtains str between clusters t and r de-
ﬁned as above, as the average distance between all pairs
of links of the elements belonging to the two clusters.
For a detailed discussion of the average linkage cluster
algorithm see, for example Ref.
[43]. Also in the case
of the average linkage the ﬁltered correlation coeﬃcient
matrix is a ultrametric distance. In Ref. [42] it is proved
that the ultrametric correlation coeﬃcient matrix asso-
ciated with the average linkage clustering procedure is
positive deﬁnite under the same general conditions valid
for the case of the single linkage. However, this property
is not generic to all clustering procedures. We have veri-
ﬁed that it does not apply for the cases of the complete
linkage and for the Ward clustering method.

V. PORTFOLIO OPTIMIZATION WITH
CLUSTERING ALGORITHMS

The portfolio optimization method we propose here is
based on the use of the ultrametric matrix associated to
a given clustering method as a meaningful and robust ﬁl-
tration of the original correlation matrix. In other words
we construct the portfolio by solving the Markowitz opti-
mization problem by using the ultrametric matrix rather
than the original correlation matrix or the RMT ﬁltered
matrix. The reasons for this choice are (i) it is known
that clustering algorithms are able to ﬁlter the relevant
information in a multivariate set of data (ii) other stud-
ies indicate that clustering algorithms are quite robust
with respect to measurement noise due to the ﬁniteness
of sample size. This is particularly true for set of vari-
ables hierarchically organized [42].

From the ﬁltered (ultrametric) correlation matrix we
build the portfolio by using the Markowitz result (Eq. 3)
and for each value of the portfolio return rp we ﬁnd the
predicted risk σp. We note that in order to consider the
ultrametric matrix as a meaningful correlation matrix
it is important that the matrix is positive deﬁnite (or
semideﬁnite). We have performed a very large number
of portfolio optimization using real data and we have not
found a single case in which the ultrametric matrix is
not positive deﬁnite. We used the weights obtained from
the optimization to compute the realized risk by using
Eq. 4 where ˆσij is the original covariance matrix. In other
words we use the ﬁltered matrix only for obtaining the
weights pi, whereas the realized risk is clearly determined
by the whole correlation matrix.

5

FIG. 2: The continuous lines are the predicted risk
and the dashed lines are the realized risk. The ﬁlled
blue circles refer to the portfolio obtained with the
average linkage method. The empty circles refer to
the Markowitz portfolio optimization, whereas the
squares are the predicted and realized risk curves
obtained by ﬁltering the correlation matrix with the
Random Matrix Theory approach (same data as in
Fig. 1). We assume that the only uncertainty of the
investor is on the correlation matrix. The dataset
is composed by the 150 most capitalized stocks at
NYSE in the period 1989−1992. The ﬁrst two years
are used for estimate the correlation matrix and the
other two years are the investment period.

A. Average linkage

We consider ﬁrst portfolio built by using correlation
matrices ﬁltered with the average linkage cluster algo-
rithm.

1. Reliability

Figure 2 shows the predicted and realized risk for the
portfolio obtained with the average linkage considering
the same set of stocks and the same time period as in
Fig. 1. The distance between predicted and realized risk
for the portfolio obtained with average linkage is signif-
icantly smaller than the distance for the portfolio ob-
tained with the RMT. This result indicates clearly that
the use of clustering methods to build ﬁnancial portfolio
is able to provide portfolios more reliable (in terms of the
error in the forecasted risk) than the ones obtained with
RMT and with Markowitz optimization. We also note
that for this set of data the realized risk of the portfo-
lio obtained with the clustering method is almost always
smaller than the realized risk of the RMT portfolio.

In order to verify the robustness of these results we
have performed an extensive bootstrap experiment. We
have considered many diﬀerent values of the portfolio size
N and of the investment horizon T and for each couple
(N, T ) we have randomly sampled 50 portfolio composed

6

≃

around N
50 where it is possible to build portfolio
with average linkage which are reliable and not too risky.
It is important to stress that, as for Figure 3, the above
result on riskiness is obtained by putting together all the
values of portfolio expected return rp. On the other hand
we ﬁnd that the riskiness of average linkage portfolio
compared to RMT portfolio strongly depends on rp espe-
cially for large portfolios. Speciﬁcally when we consider
large portfolios (50 < N < 500) we ﬁnd that for small
rp only in
25% of the cases the average linkage port-
folio is less risky than RMT portfolio. When rp is large
45%. In other words for
this fraction is of the order of
portfolios with large rp the average linkage portfolios is
approximately as risky as the RMT portfolios.

∼

∼

3. Eﬀective size

N

N

Finally we consider the eﬀective size

(ef f ) of the
portfolio as quantiﬁed by Eq. 6. We consider three port-
folio sizes, i.e. N = 50, 300, and 500, and we select two
values of the portfolio expected return rp, i.e. the mini-
mum value (corresponding to the minimum risk) and an
intermediate value between the minimum and the max-
(ef f ) as a function of the in-
imum. Figure 4 shows
vestment horizon T . Similar results are observed for high
values of expected return, but in this case the dimension-
ality of the portfolio becomes smaller and smaller and the
wealth is more and more concentrated in the asset with
highest return. We note that for small portfolio (N = 50)
the eﬀective size of RMT portfolios is slightly smaller
than the eﬀective size for average linkage portfolios. On
the other hand for larger portfolios the eﬀective size of
average linkage portfolios is signiﬁcantly smaller than the
eﬀective size of RMT portfolios. This result shows that
portfolios built with average linkage have a smaller ef-
fective dimensionality, i.e. the maintenance cost of these
portfolios is smaller than for the one of RMT portfolios.

B. Single linkage

1. Reliability

We performed the same analysis by using a diﬀerent
clustering algorithm, speciﬁcally the single linkage clus-
ter analysis. By using the same data as in Figures 1 and
2 we compute the curves for predicted and realized risk
for a portfolio built by using the ultrametric matrix asso-
ciated with the single linkage algorithm. The result is in
Fig. 5. Also in this case the predicted and realized risk
for single linkage portfolio are signiﬁcantly closer than
the corresponding quantities for Markowitz and for RMT
portfolios. In this case it is more evident that the real-
ized risk of the single linkage portfolio is larger than the
other two realized risks. Thus the single linkage portfolio
is riskier but more reliable when compared with RMT
portfolio.

FIG. 3: Density plot showing the percentage of
success of the average linkage portfolio optimiza-
tion technique over the Random Matrix Theory ap-
proach as a function of the number of asset N and
the investment period T . The white area corre-
sponding to cases where T < N + 50 is not consid-
ered in our investigation.

by N stocks and we have selected randomly 50 initial
times t0. For each portfolio we have considered 10 values
of the expected portfolio return rp. Speciﬁcally we have
taken ten equispaced values of rp between the value of
rp associated with the absolute minimum risk and the
highest expected return among the N stocks of the port-
folio. For each expected return and for each portfolio we
and we have counted the
have computed the parameter
R
RMT , i.e. the percent-
av.link <
fraction of times that
age of cases in which the portfolio obtained with average
linkage is more reliable than the portfolio obtained with
Random Matrix Theory. The result of this analysis is
shown in Figure 3. The ﬁgure indicates that the average
linkage portfolio outperforms the RMT portfolio almost
for any value of N and T . For N
500 the
average linkage portfolio is more reliable than the RMT
portfolio more than 85% of the times. The reliability of
average linkage portfolio is higher when the number of
stocks is large, For small size (N < 50) portfolios the
two methods are statistically equally reliable.

350 and T

R

R

≃

≃

2. Riskiness

We now compare the realized risk of the portfolios ob-
tained with the two methods, i.e. RMT and average link-
age. The realized risk is a measure of the riskiness of the
portfolio. We observe that small size portfolio tends to
be less risky when obtained with the average linkage,
whereas as N increases the RMT portfolios become less
risky. The boundary between the two regions is approxi-
mately for N
75. By comparing this result with ﬁgure
3 we see that when the average linkage is more reliable
it is also riskier and vice-versa. There is a small region

∼

7

FIG. 4: Eﬀective size N (ef f ) of the porfolio as de-
ﬁned in Eq. 6 as a function of investment horizon T .
The black circles refer to RMT portfolio and the red
squares to average linkage portfolio. The portfolio
size is N = 50 (panels (a) and (b)), N = 300 (pan-
els (c) and (d)) and N = 500 (panels (e) and (f)).
The left panels (a,c, and e) refer to the minimum
value of portfolio expected return rp and the right
panels (b,d, and f) refer to an intermediate value of
rp. Every point is the average over 50 realizations
obtained by bootstrapping and the error bars are
standard errors.

FIG. 6: Density plot showing the percentage of
success of the single linkage portfolio optimiza-
tion technique over the Random Matrix Theory ap-
proach as a function of the number of asset N and
the investment period T . The white area corre-
sponding to cases where T < N + 50 is not consid-
ered in our investigation.

Also for the single linkage method we perform a boot-
strap analysis similar to the one described above for the
average linkage method in order to compare the reliability
of single linkage method as compared to RMT method.
The result is the density plot shown in Fig. 6. We ﬁnd
that the single linkage method is able to provide more
reliable portfolios in wide ranges of the parameters N
and T . This is more and more evident for portfolios with
T
N , i.e. portfolios for which the investment hori-
zon (in trading days) is comparable with the portfolio
size N . It is interesting to note that for these portfolio
the eﬀect of the measurement noise (“noise dressing”) is
particularly high.

≃

FIG. 5: The continuous lines are the predicted
risk and the dashed lines are the realized risk. The
ﬁlled green diamonds refer to the portfolio obtained
with the single linkage method. The empty cir-
cles refer to the Markowitz portfolio optimization,
whereas the squares are the predicted and real-
ized risk curves obtained by ﬁltering the correla-
tion matrix with the Random Matrix Theory ap-
proach (same data as in ﬁg. 1). We assume that
the only uncertainty of the investor is on the cor-
relation matrix. The dataset is composed by the
150 most capitalized stocks at NYSE in the period
1989 − 1992. The ﬁrst two years are used for esti-
mate the correlation matrix and the other two years
are the investment period.

2. Riskiness

The analysis of the riskiness, i.e. the realized risk, of
single linkage portfolios shows that these portfolio are
systematically riskier than RMT portfolios. This is also
seen in the example shown in ﬁgure 5. Only for very small
size (N < 15) the single linkage portfolios are less risky
than RMT portfolios. As for the average linkage portfolio
this eﬀect strongly depends on the portfolio expected re-
turn. When we consider large portfolios (50 < N < 500)
we ﬁnd that for small rp only in
0.3% of the cases the
single linkage portfolio is less risky than RMT portfolio.
When rp is large this fraction is of the order of
10%. In
any case these ﬁgures indicate that single linkage portfo-
lios are risky, even if they can be quite reliable.

∼

∼

8

the average linkage and single linkage clustering proce-
dures. The optimal portfolios obtained with these two
new methods have been compared with the one based on
RMT recently proposed in Refs [7, 10].

A large set of simulations has shown that clustering
methods are outperforming RMT ﬁltering when we con-
sider the reliability of the estimation of the realized port-
folio with respect to the predicted one for portfolios with
a number of assets
500. Hence, for rel-
50 < N <
atively large portfolios the clustering ﬁltering methods
provide a more reliable estimation of the predicted risk-
return proﬁle both with respect to the Markowitz basic
estimation and with respect to the determination of the
correlation coeﬃcient done with the RMT ﬁltering

≈

≈

The portfolios obtained with the average linkage shows
a predicted and realized risk return proﬁle which is of-
ten inside the corresponding proﬁles obtained both with
the Markowitz basic estimation and after the RMT ﬁlter-
ing. In the case of the single linkage clustering method
the risk-return proﬁle shows risk levels which are sys-
tematically higher than the ones obtained both with the
Markowitz basic estimation and after the RMT ﬁltering.
Therefore with respect to the aspect of the level of risk
associated to the selected portfolios the most successful
methods are the average linkage and the RMT ﬁltering.
Another aspect investigated in our study refers to the
composition of the portfolios selected. We have quanti-
ﬁed the degree of homogeneity of the distribution of the
wealth across the stocks of the portfolio through what
we have called the ”eﬀective size” of the portfolio. A
small number of this parameter indicates an uneven dis-
tribution of the portfolio wealth suggesting that during
portfolio re-balancing only a subset of stocks will be sig-
niﬁcantly involved. The investigation of the ”eﬀective
size” of the portfolio has shown that the average link-
age and the RMT are characterized by not too diﬀerent
In fact for small portfo-
values of the ”eﬀective size”.
lios (e.g. N = 50) the RMT has for most values of T a
smaller value of the ”eﬀective size” whereas the pattern
is reversed for medium (N = 300) and large portfolios
(N = 500) both for the minimum and intermediate value
of rp. The pattern is clearly diﬀerent for the case of the
single linkage ﬁltering. In this case the ”eﬀective size”
is always signiﬁcantly less than the one observed in the
cases of RMT ﬁltering.

The above discussion shows that the diﬀerent ﬁlter-
ing procedures provide diﬀerent portfolio optimization
results that are characterized by speciﬁc strengths or
weaknesses.
In other words, for each value of N and
T , the most useful ﬁltered correlation coeﬃcient matrix
can be diﬀerent depending on the strongest constraint
the investor has among the risk level of the portfolio,
the reliability of the estimation and the portfolio ”eﬀec-
tive size”. We believe that the two clustering methods we
have proposed here and the RMT are not exhaustive with
respect to all potential aspects of portfolio optimization
and, probably, other ﬁltering methods could also provide
very interesting results in speciﬁc regimes of the diﬀerent

FIG. 7: Eﬀective size N (ef f ) of the porfolio as de-
ﬁned in Eq. 6 as a function of investment horizon
T . The black circles refer to RMT portfolio and the
red squares to single linkage portfolio. The portfolio
size is N = 50 (panels (a) and (b)), N = 300 (pan-
els (c) and (d)) and N = 500 (panels (e) and (f)).
The left panels (a,c, and e) refer to the minimum
value of portfolio expected return rp and the right
panels (b,d, and f) refer to an intermediate value of
rp. Every point is the average over 50 realizations
obtained by bootstrapping and the error bars are
standard errors.

3. Eﬀective size

N

The eﬀective size

(ef f ) of the portfolio as quantiﬁed
by Eq. 6 for the single linkage portfolio shows interesting
properties. Figure 7 shows the eﬀective size for diﬀerent
portfolio conditions and should be compared with ﬁg-
ure 4. We see that for any value of the portfolio size N
the eﬀective size of the single linkage portfolio is signiﬁ-
cantly smaller than the one of the RMT portfolio. This
eﬀect is observed also for small size portfolios, in con-
trast with what we observe for average linkage portfolios.
Even more important, for large portfolios (where the size
reduction is an important issue) the single linkage portfo-
lios have an eﬀective size which is roughly half the eﬀec-
tive size of RMT portfolio. This result suggest that single
linkage portfolios could be used to detect a small subset of
stocks which is representative of the whole portfolio, and
thus to replace the original portfolio with another one of
signiﬁcantly smaller size with reduced maintenance costs.
This possibility will be explored in a future work.

VI. CONCLUSIONS

In this paper we have performed portfolio optimization
by using ﬁltered correlation coeﬃcient matrices. These
matrices have been obtained by applying diﬀerent ﬁlter-
ing methods to the original correlation coeﬃcient ma-
trix. We have proposed two ﬁltering methods based on

control parameters.

The diﬀerent results of the diﬀerent ﬁltering methods
raise the scientiﬁc question of which is the reason for the
diﬀerence between the various ﬁltering procedures. A
precise quantiﬁcation of the information retained by the
diﬀerent ﬁltered matrices would be very useful. This goal
is left for future research.

ﬁnancial markets” .
F.L. and R.N.M acknowl-
edge support also from the research project MIUR-
FIRB RBNE01CW3M “Cellular Self-Organizing nets
and chaotic nonlinear dynamics to model and control
complex system” and from the European Union STREP
project n. 012911 “Human behavior through dynamics of
complex social networks: an interdisciplinary approach.”.

9

Acknowledgments

Authors acknowledge support

from the research
project MIUR 449/97 “High frequency dynamics in

[1] E. J. Elton and M. J. Gruber, Modern Portfolio Theory
and Investment Analysis (J. Wiley and Sons, New York,
1995).

381 (2002).

[24] S. Maslov, Physica A 301, 397 (2001).
[25] M. Bernaschi, L. Grilli and D. Vergni, Physica A 308,

[2] H. Markowitz, Portfolio Selection: Eﬃcient Diversiﬁca-

[26] L. Kullmann, J. Kertesz and K. Kaski, Phys. Rev. E 66,

tion of Investment (J. Wiley, New York, 1959).

026125 (2002).

[3] M.L. Metha, Random Matrices (Academic Press, New

[27] J.P. Onnela, A. Chakraborti, K. Kaski and J. Kertesz,

[4] S. Galluccio, J.-P. Bouchaud, and M. Potters, Physica A

[28] R.V. Mendes, T. Araujo and F. Louca, Physica A 323,

Eur. Phys. J. B, 30 285 (2002).

635 (2003).

York, 1990).

259, 449 (1998).

[5] L. Laloux, P. Cizeau, J.-P. Bouchaud, and M. Potters,

[29] S. Micciche, G. Bonanno, F. Lillo and R.N. Mantegna,

Phys. Rev. Lett. 83, 1468 (1999).

Physica A 324, 66 (2003).

[6] V. Plerou, P. Gopikrishnan, B. Rosenow, L. A. N. Ama-
ral, and H. E. Stanley, Phys. Rev. Lett. 83, 1471 (1999).
[7] L. Laloux, P. Cizeau, M. Potters, and J.-P. Bouchaud

Int. J. Theor. Appl. Fin. 3, 391 (2000).

[8] P. Gopikrishnan, B. Rosenow, V. Plerou, and H. E. Stan-

ley, Phys. Rev. E 64, 035106 (2001).

[30] J. Maskawa, Physica A 324, 317 (2003).
[31] G. Bonanno, G. Caldarelli, F. Lillo and R.N. Mantegna

Phys. Rev. E 68, 046130 (2003).

[32] G. Bonanno, G. Caldarelli, F. Lillo, S. Micciche, N. Van-
dewalle and R.N. Mantegna Eur. Phys. J. B, 38 363
(2004).

[9] S. Drozdz, J. Kwapien, F. Grummer, F. Ruf and J. Speth,

[33] T. Di Matteo, T. Aste and R.N. Mantegna, Physica A

Physica A 299, 144 (2001).

339, 181 (2004).

[10] B. Rosenow, V. Plerou, P. Gopikrishnan and H.E. Stan-

[34] N. Basalto, R. Bellotti, F. De Carlo, P. Facchi and S.

ley Europhys. Lett. 59, 500 (2002).

Pascazio, Physica A 345, 196 (2005).

[11] V. Plerou, P. Gopikrishnan, B. Rosenow, L.A.N. Ama-
ral, T. Guhr and H.E. Stanley Phys. Rev. E 65, 066126
(2002).

[12] S. Pafka and I. Kondor, Physica A 319, 487 (2003).
[13] B. Rosenow, P. Gopikrishnan, V. Plerou and H.E. Stan-

ley Physica A 324, 241 (2003).

[35] M. Tumminello, T. Aste, T. Di Matteo and R.N. Man-
tegna, A new tool for ﬁltering information in complex
systems, cond-mat/0501335

[36] K.V. Mardia, J.T. Kent and J.M. Bibby, Multivariate

Analysis (Academic Press, San Diego, 1979).

[37] J. C. Gower and G.J.S. Ross, Applied Statistics 18, 54

[14] T. Guhr and B. Kalber, J. Phys. A 36, 3009 (2003).
[15] Y. Malevergne and D. Sornette, Physica A 331, 660

(1969).

[16] S. Shariﬁ, M. Crane, A. Shamaie and H. Ruskin, Physica

(2004).

A 335, 629 (2004).

[17] S. Pafka and I. Kondor, Physica A 343, 623 (2004).
[18] Z. Burda and J. Jurkiewicz, Physica A 344, 67 (2004).
[19] R. N. Mantegna, Eur. Phys. J. B, 11 193 (1999).
[20] L. Kullmann, J. Kertesz and R.N. Mantegna, Physica A

287, 412 (2000).

[38] C.H. Papadimitriou, and K. Steiglitz, Combinatorial Op-
timization (Prentice-Hall, Englewood Cliﬀs, 1982).

[39] J. C. Gower, Biometrika 53, 325 (1966).
[40] R. Rammal, G. Toulouse, and M.A. Virasoro, Rev. Mod.

Phys. 58, 765 (1986).

[41] R.N. Mantegna and H.E. Stanley, An Introduction to
Econophysics: Correlations and Complexity in Finance,
(Cambridge University Press, Cambridge, 2000), pp. 120-
128.

[21] G. Bonanno, N. Vandewalle and R.N. Mantegna Phys.

[42] M. Tumminello, F. Lillo and R.N. Mantegna, manuscript

Rev. E 62, R7615 (2000).

in preparation.

[22] L. Giada and M. Marsili, Phys. Rev. E 63, 061101 (2001).
[23] G. Bonanno, F. Lillo e R.N. Mantegna, Quantitative Fi-

[43] M.R. Anderberg, Cluster Analysis for Applications (Aca-

demic Press, New York, 1973).

nance, 1 (2001) 96.

