5
0
0
2
 
r
a

M
 
7
 
 
]
h
p
-
s
s
a
l
c
.
s
c
i
s
y
h
p
[
 
 
1
v
7
4
0
3
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Typeset by REVTEX 4 for JASA

Contribution to harmonic balance calculations of periodic oscillation for
self-sustained musical instruments with focus on single-reed instruments

Snorre Farner
Department of Electronics and Telecommunications, NTNU, O. S. Bragstads pl. 2, 7491 Trondheim,
Norway

Christophe Vergez and Jean Kergomard and Aude Liz ´ee
Laboratoire de M´ecanique et d’Acoustique, CNRS UPR 7051, 31 chemin Joseph Aiguier, 13402 Marseille Cedex 20,
France

(Dated: February 2, 2008)

The harmonic balance method (HBM) was originally developed for ﬁnding periodic solutions
of electronical and mechanical systems under a periodic force, but has later been adapted
to self-sustained musical instruments. Unlike time-domain methods, this frequency-domain
method does not capture transients and so is not adapted for sound synthesis. However,
its independence of time makes it very useful for studying every periodic solution of the
model, whether stable or unstable without care of initial conditions. A computer program
for solving general problems involving nonlinearly coupled exciter and resonator, “Harmbal”,
has been developed based on the HBM. The method as well as convergence improvements
and continuations facilities are thorougly presented and discussed in the present paper. Ap-
plication of the method is demonstrated on various problems related to a common model
of the clarinet: a reed modelled as a simple spring with and without mass and damping, a
nonlinear coupling and a cubic simpliﬁcation of it, and a cylindrical bore with or without
dissipation and dispersion as well as a bore formed as a stepped cone.

PACS numbers: 43.75.Pq, 43.58.Ta

I.

INTRODUCTION

Since Helmholtz,? it has become natural to describe a
self-sustained1 musical instrument as an exciter coupled
to a resonator. More recently, McIntyre et al.? have
highlighted that simple models are able to describe the
main functioning of most self-sustained musical instru-
ments. These models rely on few equations whose im-
plementation is not cpu-demanding, mainly because the
nonlinearity is spatially localized in an area small com-
pared to the wavelength. This makes them well adapted
for real-time computation (including both transient and
steady states). These models are particularly popular in
the framework of sound synthesis.

On the other hand, calculation in the frequency do-
main is suitable for determining periodic solutions of the
model (the values of the harmonics as well as the playing
frequency) for a given set of parameters. Such infor-
mation can be provided by an iterative method named
the harmonic balance method (HBM). Though the name
“harmonic balance” seems to date back to 1936,? the
method was popularized nearly forty years ago for electri-
cal and mechanical engineering purposes, ﬁrst for forced
vibrations,?
later for auto-oscillating systems.? The
modern version was presented rather shortly after by
Nakhla and Vlach.? In 1978, Schumacher was the ﬁrst
one to use the HBM for musical acoustics purposes with
a focus on the clarinet.? However in this paper, the play-
ing frequency is not determined by the HBM. This short-

coming is the major improvement brought by Gilbert et
al.? eleven years later, who proposed a full study of the
clarinet including the playing frequency as an unknown
of the problem.

The fact that the HBM can only calculate periodic so-
lutions, may seem as a drawback. Certainly, transients
such as the attack are impossible to calculate, and the pe-
riodic result is boring to listen to and does not represent
the musicality of the instrument. Therefore the HBM
is deﬁnitely not intended for sound synthesis. Neverthe-
less, self-sustained musical instruments are usually used
to generate harmonic sounds, which are periodic by def-
inition. The HBM is thus very useful to investigate the
behavior of a physical model of an instrument, depend-
ing on its parameter values. This is possible for both
stable and unstable solutions, without care of precise ini-
tial conditions. Moreover, HBM results can be compared
to approximate analytical calculations (like the variable
truncation method (VTM)),? in order to check the va-
lidity of the approximate model considered.

The present paper is based on the work of Gilbert et
al.? Our main contributions are: extension of the diver-
sity of equations managed, improved convergence of the
method, introduction of basic continuation facilities, and
from a practical point of view, faster calculations.

While the main idea is already described by Gilbert
et al.,? Section II details the principle of the HBM, in
particular the discretization of the problem, both in time

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

1

and frequency.

Section III is devoted to the various contributions of
the current work, which are applied in a computer pro-
gram called Harmbal.? The framework is deﬁned to in-
clude models with three equations: two linear diﬀerential
equations, written in the frequency domain, and a nonlin-
ear coupling equation in the time domain (see Sec. III A).
As usual in the HBM, this system of three equations is
solved iteratively. The solving method chosen (Newton-
Raphson, Sec. III B) has been investigated and its conver-
gence has been improved through a backtracking scheme
(Secs. III C and III D).

To illustrate the advantages of the HBM and the im-
provements, a few case studies were performed and are
presented in Section IV. They are based on a classi-
cal model of single reed instruments which is presented
in Section IV A. In Sections IV B and further, simpliﬁca-
tions to each of the three equations are introduced so that
the results could be compared to analytical calculations,
both for cylindrical and stepped-cones bores. Finally the
full model is compared to time-domain simulations. This
also shows the modularity of Harmbal. The comparison
is achieved through the investigation of bifurcation dia-
grams as the dimensionless blowing pressure is altered.
The derivation of a branch of solution is obtained thanks
to basic continuation with an auto-adaptative parameter
step.

Finally, various questions are tackled through practi-
cal experience from using Harmbal. Section V discusses
multiplicity of solutions and poor robustness in the fre-
quency estimation.

II. NUMERICAL METHOD

A. The harmonic balance method

The harmonic balance method is a numerical method
to calculate the steady-state spectrum of periodic solu-
tions of a nonlinear dynamical system. In this paper we
are only concerned with periodic solutions. The following
provides a detailed and general description of the method
for a nonlinearly coupled exciter-resonator system.

≤

Let X(ωk), k = 0, . . . , Nt −

1 be the Discrete Fourier
transform (DFT) of one period x(t), 0
t < T , of a
T -periodic solution of a mathematical system to be de-
ﬁned. X(ωk) will have a number of complex components
Nt, which depends on the sampling frequency fs = 1/Ts
with which we discretize x(t) into Nt = T /Ts equidistant
samples. Furthermore, ωk=2πfpTsk is the angular fre-
quency of each harmonic of the fundamental frequency
fp of the oscillation, referred to as the playing frequency.
Note that the sampling frequency fs = Ntfp is automati-
cally adjusted to the current playing frequency so that we
always consider one period of the oscillation while keep-
ing Nt constant. Note also that Nt should be suﬃciently
large to avoid aliasing. Moreover, if it is chosen a power
of two, the Fast Fourier transform (FFT) may be used.
Assuming that Np < Nt/2 harmonics is suﬃcient to de-

scribe the solution, we deﬁne ~X
∈
ﬁrst real components (denoted by
by their imaginary components (

R2Np+2 as the Np + 1
) of X(ωk) followed

~X =

(X(ω0)) , . . . ,

X(ωNp)

,

(1)

ℜ

(cid:2)

ℑ

(X(ω0)) , . . . ,
(cid:0)

X(ωNp)
(cid:1)

.

Note that the components X0 and XNp+1 are the real and
imaginary DC components respectively (and that XNp+1
is always zero). Our mathematical system can thus be
R2Np+2:
deﬁned by the nonlinear function F : R2Np+3

(cid:1)(cid:3)

→

ℜ
):

ℑ

ℑ

(cid:0)

ℜ

~X = ~F ( ~X, fp).

(2)

Until now, the playing frequency has silently been as-
sumed to be a known quantity. In autonomous systems,
however, the frequency is an additional unknown, so that
the Np-harmonic solution seeked is deﬁned by 2Np+3 un-
knowns linked through the 2Np+2 equations (2). How-
ever, it is well known that as ~X is a periodic solution of
a dynamical system, any ~X ′ deduced from ~X by a phase
rotation (i.e. a shift in the time domain) is also a solution.
Thus an additional constraint has to be added in order
to select a single periodic solution among the inﬁnity of
phase-rotated solutions. A common choice (see Ref.? )
is to consider the solution for which the ﬁrst harmonic
is real (i.e. its imaginary part, XNp+2, is zero). This ad-
ditional constraint decreases the number of unknowns to
2Np+2 for an Np-harmonic periodic solution. Thus we
get ~F : R2N +2
R2N +2, and it is now possible to ﬁnd
→
periodic solutions, if they exist.

Finally, a simple way of avoiding trivial solutions to
equation (2) is to look for roots of the function ~G :
R2Np+2

R2Np+2, deﬁned by

→

~G( ~X, fp) =

~X

−

~F ( ~X, fp)
X1

,

(3)

i.e. ~G( ~X, fp) = 0. This equation is usually solved numer-
ically through an iteration process, for instance by the
Newton-Raphson method as in our case. How to handle
the playing frequency fp will be discussed in the following
section.

B.

Iteration by Newton-Raphson

The equation ~G( ~X, f ) = 0, ~G being deﬁned by equa-
tion (3), is nonlinear and has usually no analytical so-
lution. (For readability we leave out the index p on the
playing frequency until end of Sec. III.) This section de-
scribes the common, iterative Newton-Raphson method.
This is the method used in the program Harmbal (see
Section III) although it had to be reﬁned with a back-
tracking procedure to improve its convergence, as dis-
cussed in Section III D.

For the sake of later reference, it is useful to recollect
the principles of Newton’s method for a one-dimensional

2

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

f x( )

III.

IMPLEMENTATION AND HARMBAL

x2

x0

x1

x

FIG. 1. The iteration process of Newton’s method

problem g(x) = 0. Starting with an estimate x0 of the
solution, the next estimate x1 is deﬁned as the intersec-
tion point between the tangent to g at x0 and the x-axis.
The method can be summarized as

xi+1 = xi

g(xi)
g′(xi)

.

−

(4)

Ji
G

−1

·

−

(cid:0)

(cid:1)

This is repeated, as shown in Figure 1, while increasing
the iteration index i until g(xi) < ε, where ε is a user-
deﬁned threshold value.

In our 2Np+2-dimensional case, we have a vector prob-
lem: we search ( ~X, f ) for which ~G( ~X, f ) = 0. Newton’s
method is generalized to the Newton-Raphson method,
which may be written? :

( ~X i+1, f i+1) = ( ~X i, f i)

~G( ~X i, f i),

(5)

,

∇

G( ~X i, f i) is the Jacobian matrix of ~G at
where Ji
G
( ~X i, f i). Note that all derivatives by XNp+2, which was
chosen to be zero, are ignored. The column Np+2 in
the Jacobian is thus replaced by the derivatives with re-
spect to the playing frequency f . Ji
G is thus a (2Np+2)-
square matrix. This means that line number Np+2
in equation (5) gives the new frequency f instead of
XNp+2. We deﬁne the Newton step ∆ ~X= ~X i+1
~X i
(where ∆f =f i+1
f i replaces ∆XNp+2), which follows
−
the local steepest descent direction.

−

The Jacobian may be found analytically if ~G is given
analytically, but it is usually suﬃcient to use the ﬁrst-
order approximation

Jjk =

∂Gj
∂Xk ≃

Gj ( ~X + δ ~Xk, f )
δX

−

Gj( ~X, f )

,

(6)

except for k = Np + 2, in which case we use

Jj,N +2 =

∂Gj
∂f ≃

Gj( ~X, f + δf )
δf

−

Gj( ~X, f )

.

(7)

The components of δ ~Xk are zero except for the kth one,
which is the tiny perturbation δX. The iteration has
~G( ~X i, f i)
converged when
< ε. We found ε =
|
|
10−5 to be a good compromize between computation time
and solution accuracy.

~Gi
|

,
|

A. Equations for self-sustained musical
instruments

Though, to the authors’ knowledge, the harmonic bal-
ance method in the context of musical acoustics with un-
known playing frequency has only been applied to study
models of clarinet-like instruments, it should be possible
to consider many diﬀerent classes of self-sustained instru-
ments. It is well accepted that sound production by a
musical instrument results from the interaction between
an exciter and a resonator through a nonlinear coupling.
Moreover, in most playing conditions, linear modelling of
both the exciter and the resonator is a good approxima-
tion.

Therefore, within these hypotheses, any musical in-
strument could be modelled by the following three equa-
tions:

Ze(ω)Xe(ω) = Xc(ω)

Xc(ω) = Zr(ω)Xr(ω)

(xc(t), xe(t), xr(t)) = 0

(a)
(b)
(c)




F

(8)



where Ze is the dynamic stiﬀness and Zr is the input
impedance of the exciter and the resonator, respectively,
and Xe and Xr are the spectra describing the dynamics of
the exciter and the resonator during the steady state (pe-
riodicity assumption). Xc is the spectrum of the coupling
variable. All these quantities, and thus equations (8a–
b), are deﬁned in the Fourier domain. Equation (8c) is
written in the time domain, where
is a nonlinear func-
tional of xc, xe, and xr, which are the inverse Fourier
transforms of Xc, Xe, and Xr, respectively. We apply
the discretization as described in Section II A, implying
that equations (8a–b) become vector equations where the
impedances must be written as real (2Np+2)
(2Np+2)-
matrices to accommodate the rules of complex multipli-
cation:

×

F

Z(f ) =

( ˜Z(f ))
( ˜Z(f ))

ℜ
ℑ

(cid:18)

( ˜Z(f ))
( ˜Z(f ))

−ℑ
ℜ

(cid:19)

where

Z(0)
0
...
0

0
Z(ω1)

0

0
0
...
Z(ωNp)

· · ·
. . .

· · ·








˜Z(f ) = 




ℜ

( ˜Z) and

( ˜Z) are the real and imag-
is complex, and
ℑ
inary components of ˜Z. The system (8) is solved itera-
tively by Harmbal according to the scheme illustrated in
Figure 2.

In Harmbal, these equations are easily deﬁned by writ-
ing new C functions. Only superﬁcial knowledge of the
C language is necessary to do this.

Three cases related to models of single reed instru-
ments with cylindrical or stepped-conical bores are stud-
ied in particular in Section IV in order to validate the
code and to illustrate the modularity of Harmbal.

(9)

(10)

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

3

~Xc, f

(cid:18)

-DFT−1

xc(t)

Eq.(8a)

@

@R
~Xe, f

-DFT−1

-Eq.(8c)

xr(t)

xe(t)




(cid:19)(cid:16)
(cid:27)-
=?

?DFT

~Xr, f

?Eq.(8b)

~F ( ~Xc, f )

∆ ~Xc, ∆f

(cid:27)

N-R

(cid:18)(cid:17)

FIG. 2. The iteration loop of the harmonic balance method
for a musical instrument (notations deﬁned in the text)

B. Practical characteristics of Harmbal

Both fast calculation, good portability, and indepen-
dence of commercial software are easily achieved by pro-
gramming in C, whose compiler is freely available for
most computer platforms. It is, however, somewhat dif-
ﬁcult to combine portability with easy usage, because an
intuitive usage normally means a graphical and interac-
tive user interface, while the handling of graphics varies
a lot between the diﬀerent platforms.

We have chosen to write Harmbal with a nongraphical
and non-interactive2 user interface. The major advantage
of this is that independent user interfaces may be further
developed depending on need.

Our concept is to save both the parameters and the
solution in a single ﬁle. This ﬁle also serves as input
to Harmbal while individual parameters can be changed
through start-up arguments. The solution provided by
the ﬁle works as the initial condition for the harmonic
balance method. Thus the lack of a simple user interface
is compensated by a simple way of re-using an existing
solution to solve the system for a slightly diﬀerent set of
parameters. Solutions for a range of a parameter values
may thereby be calculated by changing the parameter
stepwise and providing the previous solution as an ini-
tial condition for the next run. The Perl script hbmap
provides such zeroth-order continuation facilities. This
procedure may also be used when searching for a solu-
tion where it is diﬃcult to provide a suﬃciently good
initial condition, for instance by successively increasing
Np when wanting many harmonics.

C. Convergence of Newton-Raphson

When merely employing the Newton-Raphson method
to determine the solution of the system at a given set
of parameters, we have found that it is impossible to
ﬁnd a solution at particular combinations of the param-
eters. Indeed, for the clarinet model of Section IV B 1,
no convergence was obtained for particular values of the
parameter γ (the dimensionless blowing pressure) and its
neighborhood. This is seen as discontinuities, or holes,
in the curves in Figure 3 (see Section IV for the under-
lying equations and parameters). Note that the solu-

Np = 13
Np = 11
Np =  9
Np =  7

Np = 5

Np = 3
Np = 1

 0.4

 0.42

 0.44

 0.46

 0.48

 0.5

γ

Solution holes: ﬁrst pressure harmonic P1 versus
FIG. 3.
blowing pressure γ for diﬀerent Np with Nt = 128, ζ = 0.5,
−3. (Even Np give the same as Np−1.) Equations
and η = 10
and parameters are deﬁned in section IV.

γ = 0.4194
γ = 0.4195
γ = 0.4196
γ = 0.4197
γ = 0.4198

1
P

 0.32

 0.3

 0.28

 0.26

 0.24

 0.22

 0.2

 0.18

0.003

0.002

1
P

/
)

1
F
 
−
 

1
P
(
=
1
G

0

 

-0.002

-0.003

0.2096

0.2097

0.2098

0.2099

0.2101

0.2102

0.2103

0.2104

0.21
P1

FIG. 4. G1 as P1 varies around the solution G1 = 0 for
various γ around a hole at γ ≃ 0.4196. Nt = 128 and Np = 1.

tions seem to go continuously through this hole and that
the positions of the holes and their extent vary with the
number of harmonics Np taken into account. The curves
were calculated by the program hbmap. In this case we
have decreased γ from 0.5 downward in steps of 10−4
and drawn a line between them except across γ values
where solution failed. In the holes, the Newton-Raphson
method did not converge, either by alternating between
two values of ~P (i.e. ~Xc) or by starting to diverge.

To study the problem, we simpliﬁed the system to a
one-dimensional problem by setting Np = 1, thus leaving
P1 as the only nonzero value. G1 thus became the only
~G
contributor to
, and a simple graph of G1 around the
|
|
solution G1 = 0 could illustrate the problem, as shown
in Figure 4. We see that the curve of G1(P1) has in-
ﬂection points (visible as “soft steps” on the curve) at
rather regular distances. At the centre of a convergence
hole, i.e. for γ
0.4196, an inﬂection point is located at
the intersection with the horizontal axis. This is a school

≃

4

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

example of a situation where Newton’s method does not
converge because the Newton step ∆P1 brings us alter-
natingly from one side of the solution to the other, but
not closer.

In fact, the existence of inﬂection points is linked with
the digital sampling of the continuous signal. If the sam-
pling rate is increased, i.e. if Nt is increased, the steps
become smaller but occur more frequently, as shown for
Nt = 32, 128, and 1024 in Figures 5a–c. The derivative
dG1/dP1 is included in the ﬁgures to quantify the impor-
tance of the steps. According to the Figures 5a–c it seems
reasonable to increase Nt to avoid convergence problems.
However, this would signiﬁcantly increase the computa-
tional cost. Another solution is therefore suggested in
the following.

D. Backtracking

When the Newton-Raphson scheme fails to converge,
it often happens because the Newton step ∆ ~X leads
~G( ~X, f )
to a point where
is larger than in the pre-
|
|
vious step. However, acknowledging that the Newton
step points in the direction of the steepest descent, there
must be a point along ∆ ~X where
is smaller
than in the previous iteration of the HBM. A backtrack-
ing algorithm described in Numerical Recipes? (Sec.9.7)
solves the problem elegantly by shortening the Newton
step as described here. The principle is illustrated in the
simple one-dimensional case in Figure 6, where g(x) re-
~G( ~X, f )
places
, although we use the multidimensional
|
|
notation in the following. Deﬁning the λ axis along the
Newton step, we simply take a step λ∆ ~X in the same
direction, where 0 < λ < 1. The optimal value for λ is
the one that minimizes the function h(λ):

~G( ~X, f )
|
|

h(λ) = 1
2 |

~G( ~X i + λ∆ ~X)
2
|

(11)

with derivative

h′(λ) =

~G

JG ·
(cid:16)

~X i+λ∆ ~X ·

∆ ~X.

(12)

(cid:17) (cid:12)
(cid:12)
During the calculation of the failing Newton step, we
computed ~G( ~X i) and ~G( ~X i+1), so now it is possible
to calculate with nearly no additional computational ef-
2, h′(0) =
fort h(0) = 1
~G( ~X i)
~G( ~X i)
2, and h(1) =
2 |
|
|
~G( ~X i+1)
~G( ~X i + ∆ ~X)
1
2 = 1
2. This allows to propose
2 |
2 |
|
|
a quadratic approximation of h for λ between 0 and 1,
for which the minimum is located at

−|

λ1 =

−

h(1)

1

2 h′(0)
h(0)

.

h′(0)

(13)

−
It can be shown that λ1 should not exceed 0.5, and in
0.1 is required to avoid a too short step at
practice λ1
this stage.

−

If

~G( ~X i)
, h(λ) is
|
|
then modelled as a cubic function (using h(λ1) which

still is larger than

≥
~G( ~X i + λ1∆ ~X)
|
|

~G( ~X i + λ2∆ ~X)
|
|

has just been calculated). The minimum of this cu-
bic function gives a new value λ2, again restricted to
0.1λ1 < λ2 < 0.5λ1. This calculation requires solving
a system of two equations, so if also λ2 is not accepted
because
is still too large, we do not en-
hance to a fourth-order model of h, which would increase
the computational cost much more. Instead, subsequent
cubic modellings are performed using the most two recent
values of λ. In practice, however, not many repetitions
should be necessary before ﬁnding a better solution, if
possible.

IV. CASE STUDIES

A. The equations for the clarinet

The three equations (8a–c) may be constructed by
physical modelling. In the case of the clarinet, a com-
mon simple model is described below. We limit the de-
scription in the following to a brief presentation based on
dimensionless quantities, dimensional variables being de-
noted by a hat (ˆ) hereafter (see Fritz et al.? for further
details).

The exciter is an oscillating reed which may be mod-

elled as a spring with mass and damping:

¨ˆy + ge ˙ˆy + ω2

e ˆy =

1
µe

(ˆp

pm),

−

(14)

where ˆy is the dynamic reed displacement, and ˆp and pm
are the dynamic pressure in the mouthpiece, i.e. the in-
ternal pressure, and the static blowing pressure in the
player’s mouth, respectively. The constants µe, ge, and
ωe represent the mass per area, the damping factor, and
the angular resonance frequency of the exciter (the reed).
The dots over ˆy denote the time derivative. In dimension-
less form, equation (14) becomes

M ¨x + R ˙x + Kx = p,

(15)

where p = ˆp/pM and x = ˆy/H + γ/K with γ = pm/pM .
The equilibrium reed opening is H as shown in Figure 7.
In the static regime, when blowing harder than a maxi-
1), the reed blocks
mum pressure pM , i.e. pm ≥
the opening, i.e. ˆy =
H, so we get ˆp = 0 and can con-
−
clude that K = 1 for the current reed model.

Like Fritz et al.? we relate the dimensionless time to
the resonance angular frequency ωr of the resonator (the
bore), i.e. t = ωrˆt, so that the values of the dimensionless
mass M , damping R, and spring constant K become

pM (γ

≥

e/pM = 1,

K = µeHω2
R = Kgeωr/ω2
M = Kω2

r/ω2

e = geωr/ω2
e,
r /ω2
e .

e = ω2

(16)

(17)

(18)

In the Fourier domain, Equation (15) thus takes the form
of equation (8a), Ze(ω)X(ω) = P (ω), where

Ze(ω) = 1

M

+ iR

(19)

−

2

ω
2π

(cid:16)

(cid:17)

ω
2π

,

(cid:16)

(cid:17)

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

5

1
G

 50

 200

 150

 100

 0

-50

-100

G1
dG1/dP1

G1
dG1/dP1

G1
dG1/dP1

)
s
t
i
n
u
 
y
r
a
r
t
i
b
r
a
(
 

/

1
P
d
1
G
d

P1

as

 0

 0.1

 0.2

 0.3

 0.4

 0.5

 0

 0.1

 0.2

 0.3

 0.4

 0.5

 0

 0.1

 0.2

 0.3

 0.4

 0.5

P1

P1

FIG. 5. The eﬀect of sampling rate on the “smoothness” of G1(P1): (a) Nt = 32, (b) 128, and (c) 1024. The derivative
dG1/dP1 exhibits the “roughness”.

(1)h

h(0)
(  ))h λ

min( 

h λ
(  )

(  )xg

x

λ

x+∆ x

1

x+λ ∆
1  x

1λ

x

0

FIG. 6. The principle of backtracking in one dimension. Ob-
jective is to estimate the root of g(x) (solid curve). Broken
lines with arrows show how the Newton step ∆x from x leads
to divergence. h(λ) (dot-dashed curve) is a 2nd order expan-
sion of g(x) along the Newton step, i.e. the λ axis. Minimum
of h(λ) should be closer to the root of g(x) than g(x + ∆x).

Pipe

p
m
y+H

Lips

p

u

Reed

FIG. 7.

Illustration of the mouthpiece

for i = √
less angular frequency in the Fourier domain.

1 and ω = 2π ˆω/ωr = ˆω/fr is the dimension-

−

A common minimum model for the clarinet assumes a
simple reed with no mass or damping, thus M = R = 0.
Equation (15) reduces to x = p.

The resonator (i.e. the air column in the bore of the
instrument) is commonly described by its frequency re-
sponse ˆZr(ˆω). For a simple cylindrical bore of length l
with a closed and an ideal open end, the resonance fre-
quencies are odd multiples of fr = c/4l, c being the sound
speed in the air column.? The input impedance of the
bore may thus be expressed in dimensionless quantities

Zr(ω) =

= i tan

+ (1

i)α(ω)

,

(20)

ˆZr(ˆω)
Z0

ω
4

−

(cid:16)

≃

p

ω/2π with ψ

(cid:17)
where α(ω) , ψη
1.3 for common con-
ditions in air and η being the dimensionless loss param-
eter, which depends on the tube length, typically 0.02
for a normal clarinet with all holes closed. Z0 , ρc/S is
the characteristic impedance of the cylidrical resonator,
S being its cross section, and ρ the density of air. The
last term in the argument of equation (20) includes the
dispersion as the real part and viscous losses as the imag-
inary part.

Equation (8b) becomes

P (ω) = Zr(ω)U (ω),

(21)

where P (ω) and U (ω) , ˆU(ω)Z0/pM are the dimension-
less internal pressure and volume ﬂow of air through the
mouthpiece in the Fourier domain.

The coupling equation (8c), is given by the Bernoulli
theorem with some supplementary hypotheses applied
between the mouth and the outlet of the reed chan-
nel. The coupling equation is nonlinear and must be
calculated in the time domain. This leads to the follow-
ing expression for the dimensionless airﬂow through the
mouthpiece? :

u(p, x) = ζ (1 + x

γ)

p

sign(γ

p)

(22)

γ
|
p

−
|
1, and u = 0 otherwise.

−

−

−

ζ =
as long as x > γ
Z0wH
2/ρpM is a dimensionless embouchure parame-
ter roughly describing the mouthpiece and the position
of the player’s mouth, w being the width of the open-
ing and ρ the density of the air. ζ is also related to the
maximum volume velocity entering the tube.?

p

If the reed dynamics were not taken into account, we

had x = p and thus

u(p) = ζ (1 + p

γ)

γ
|
p
1, and, as before, u = 0 otherwise.

sign(γ

−

−

−

p)

p

|

for p > γ

(23)

−

6

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

B. Veriﬁcation of method and models

In the following we want to verify that the HBM (and
its implementation in Harmbal) gives correct results. By
using very low losses in the resonator (small η) we can
compare the results of the HBM with analytical results.
Rising the attenuation in the resonator and including
mass and damping for the exciter, we compare with nu-
merical results from real-time synthesis of the same sys-
tem. This also gives us the opportunity to illustrate the
modularity of Harmbal as we change the models of the
resonator and the nonlinear coupling.

1. Helmholtz oscillation for cylindrical tubes

To compare the HBM results with analytical results,
we assume a nondissipative, nondispersive air column,
i.e. setting η = 0 and thus α = 0 in equation (20).
Furthermore, we assume that the reed has neither mass
nor damping and thus use equation (23). The resulting
square-wave amplitude (the Helmholtz motion)? may be
found by solving u(p) = u(
p), which results from the
−
fact that the internal pressure p(t) and the power p(t)u(t)
averaged over a period are zero according to the lossless
hypothesis.? This leads to the square oscillation with
amplitude

p(γ) =

3γ2 + 4γ

1.

−

−

p

This result is compared with the results calculated by
Harmbal (for the same set of equations, but η = 10−5
instead of η = 0 to avoid inﬁnite impedance peaks) for 3,
9, 49, and 299 harmonics close to the oscillation threshold
in Figure 8, and at γ = 0.4 in Figure 9, which is far from
the threshold.

As expected, the solution using the HBM shows good
convergence towards the Helmholtz motion as the num-
ber of harmonics increases. Note the deviation for higher
harmonics close to the threshold, even for 299 harmon-
ics. Dissipation in the resonator (η = 10−5
= 0) causes
higher harmonics to be damped more in this area of γ
than for higher blowing pressures (as explained e.g. in
Ref.? ). The deviation from a square-wave signal is thus
more noticeable close to the threshold, and as the HBM
calculations imposed a nonzero dissipation, this is prob-
ably the reason for the small deviation in Figure 8. The
deviation is not visible in the time domain.

A popular simpliﬁcation of the nonlinear function (23)
is a cubic expansion for small oscillations (e.g. Ref.)? ? ? :

˜u(p) = u00 + Ap + Bp2 + Cp3,

(25)

where u00, A, B, and C are easily found by expanding
equation (23). Its Helmholtz solution is easily calculated
like above, yielding

p(γ) =

r−

A
C

=

s

8γ2(3γ

−
γ + 1

1)

.

(26)

Helmholtz
Np = 299
Np = 49
Np = 9  
Np = 3

 10

 20

 30

 40

 50

k (harmonic no.)

Helmholtz
Np = 3
Np = 9  
Np = 49
Np = 299

−30

−40

−50

−60

)

B
d
(
 

k
P

−70

 0

 0.05

 0.04

 0.03

 0.02

 0.01

 0

−0.01

−0.02

−0.03

−0.04

−0.05

)
s
s
e
l
n
o
i
s
n
e
m
i
d
(
 
p

(24)

 0

 256  512  768  1024  1280  1536  1792  2048

t (time samples)

FIG. 8. The Helmholtz solution, eq. (24) compared with the
HBM truncated to 3, 9, 49, and 299 harmonics close to the
oscillation threshold (γ = 0.334, ζ = 0.5, η = 10
(a)
frequency domain. (b) time domain.

−5).

The inﬂuence of the diﬀerence between the two versions
of the nonlinear function is investigated in Figure 10 for
the lossless case. Close to the oscillation threshold, Fig-
ure 10a, we see that there is no signiﬁcant diﬀerence
between the two versions of the nonlinear equation, as
expected. The fact that the HBM is lower for higher
harmonics is as before due to the small attenuation we
had to include to perform the numerical calculations. Far
from the threshold, however, Figure 10b, we see that the
cubic expansion fails to approximate the nonlinear equa-
tion. For lower harmonics this error is larger than the
attenuation eﬀect in the HBM calculations. This is fur-
ther discussed by Fritz et al.?

In Figure 11 we have completed some of the curves
that we failed to make in Figure 3, and even increased the
number of harmonics, owing to the backtracking mecha-
nism. Admittedly, at Np = 49, a few holes can still be
seen, but the convergence is signiﬁcantly improved.

Here the amplitude of the ﬁrst harmonic is plotted
for diﬀerent numbers of harmonics as a function of the
blowing pressure γ together with ﬁrst harmonic of the
Helmholtz solution, deduced from equation (24). In prac-
tice, the solution at γ = 0.4 was found and then hbmap

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

7

6
−10

−20

)

B
d
(
 

k
P

−30

−40

−50

−60

 0

)

B
d
(
 

k
P

)

B
d
(
 

k
P

−30

−40

−50

−60

−70

−80

−90

−10

−20

−30

−40

−50

−60

−70

Helmholtz
Np = 299
Np = 49
Np = 9  
Np = 3

Helmholtz
HBM Np = 49
HBM Np = 9
HBM Np = 3
HBM Np = 1

 0.7

 0.6

 0.5

 0.4

 0.3

 0.2

 0.1

|
1
P
|

 10

 20

 30

 40

 50

k (harmonic no.)

 0
 0.32  0.34  0.36  0.38  0.4  0.42  0.44  0.46  0.48  0.5
γ

FIG. 9. The Helmholtz solution, eq. (24) compared with the
HBM truncated to 3, 9, 49, and 299 harmonics far from the
−5) in the
oscillation threshold (γ = 0.40, ζ = 0.5, η = 10
frequency domain.

FIG. 11. Amplitude of ﬁrst harmonic as the blowing pres-
sure increases for the Helmholtz solution (24) and the HBM
truncated to 1, 3, 9, and 49 harmonics, the last coinciding
with Helmholtz (ζ = 0.5, η = 10

−5)

Helmholtz cubic
Helmholtz
HBM cubic Np = 299
HBM Np = 299

 0

 50

 100

 150
k (harmonic no.)

 200

 250

 300

Helmholtz cubic
Helmholtz
HBM cubic Np = 299
HBM Np = 299

 0

 50

 100

 150
k (harmonic no.)

 200

 250

 300

FIG. 10. The (lossless) Helmholtz motion and the (almost
lossless) HBM for 299 harmonics using the full nonlinear-
ity (23) and the cubic expansion (25) (a) close to the os-
cillation threshold (γ = 0.334) and (b) far from it (γ = 0.40)
for ζ = 0.5, η = 10−5. Above the 11th harmonic only every
10th harmonic is shown.

−

was used to make Harmbal calculate solution for each of a
large number of subsequent values of γ down to the oscil-
lation threshold by using the previous solution as initial
value. The procedure was repeated from γ = 0.4 up to
the point where the reed started to beat, i.e. for p < γ
1
in equation (23). Without losses (Helmholtz solution)
the beating threshold does not arrive before γ = 0.5,
and this should be expected for the nearly lossless case
studied with the HBM also. However, the number of har-
monics Np taken into account in the HBM calculations is
too small to follow the sharp edges of the square signal.
The resulting overshoots in p(t), as seen in Figure 8b,
cause p to prematurely exceed the criterion for beating.
The beating threshold converges to 0.5 as Np increases
(see also Ref.? ). Note that, for the chosen value of ζ,
it can be calculated following Hirschberg? (eq.(45)) that
0.45, the Helmholtz solution loses its stabil-
above γ
ity through a subharmonic bifurcation (a period-doubling
occuring).

≃

By Figure 11 we can also verify that the model expe-
riences a direct Hopf bifurcation (which is known since
the work of Grand et al.).? Thus, a single harmonic is
enough to study the solution around the threshold. Far
from the threshold, more harmonics have to be taken
into account for P1 to converge toward the Helmholtz so-
lution. This is not obvious and for example contradictory
with the hypothesis made for the VTM.? Thus Harmbal
appears as an interesting tool to evaluate the relevance of
approximate methods according to the parameter values.

2. Helmholtz oscillation for a stepped conical tube

The saxophone works similarly to the clarinet, but the
bore has a conic form. In this section we compare the
HBM calculations with analytical results, and in order to
calculate the Helmholtz motion when losses are ignored,
we need to simplify the cone by assuming that it consists

8

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

,

(27)

)

B
d
(
 

P

i

Helmholtz
Np = 180
Np = 101
Np = 63
Np = 20
Np = 8
Np = 5

 0

 5

 15

 20

 10
i

-10

-20

-30

-40

-50

 0.4

 0.2

 0

-0.2

-0.4

-0.6

)
t
(
p

 0.3

 0.2

 0.1

|
1
P
|

of a sequence of N sylinders of length l and cross section
Si = 1
2 i(i + 1)S1, S1 = S being the cross section of the
smallest cylinder, and i = 1, . . . , N (see Ref.? ). The
total length of the instrument is thus L = N l. The input
impedance of such a stepped cone may be written as

Zr(ω) =

cot

ω′
4 −

iα(ω′)

2i
+ cot

ω′
4N −
(cid:0)

iα( ω′
N )
(cid:1)

(cid:0)

(cid:1)
where ω′ , 2ω/(N +1) when ω = 2π ˆf /fr, where fr is the
ﬁrst eigenfrequency of this resonator. We have ignored
the dispersion term here. Equation (27) is used instead
of equation (20), and the damping α(ω) = ψη
ω/2π
is zero in the analytic Helmholtz case and very small
10−5 below which convergence became diﬃcult)
(η = 2
for the calculations with the HBM.

p

·

As before, the pressure amplitude of the ideal lossless
N p), and two

case is calculated by solving u(p) = u(
solutions are possible:3

−

p±(γ) =

(N
−
2(N 2
(N

−

1)(2

3γ)
N + 1)
−
1)2 + (N +1)2(
−

2(N 2

−
N + 1)

± p

3γ2+4γ

1)

−

(28)

−
as long as γ < 1/(N + 1) for the standard Helmholtz
motion (p+) and γ < N/(N + 1) for the inverted one
(p−), which is unstable. Above these limits p+ = γ and
p− =
γ/N . The magnitude of the ﬁrst harmonic of a
square or rectangular wave is then given by

−

±
1 (γ) =

P

sin π
N +1
π
N +1

±

p

(γ).

For N = 1, equation (28) reduces to equation (24). For
higher N , the pressure oscillation becomes asymmetric.

We take the case N = 2 and get

p±(γ) =

2

3γ

−

±

−

1
6

(cid:16)

27γ2 + 36γ

8

.

(30)

−

(cid:17)

p
This result is compared with HBM calculations in Fig-
ure 12 for γ = 0.31. Theoretically, the spectrum of the
Helmholtz solution, Figure 12a, shows that every third
component is missing (actually zero) while the remain-
ing components decrease in magnitude thus forming the
asymmetric pressure oscillation as shown in Figure 12a.
The HBM, on the other hand, suggests that the ﬁrst
component in each pair be smaller than the second com-
ponent. This results in a dip at the middle of the long,
positive part of the period (i.e. on both extremities t = 0
and t = 1024 of the curve in Figure 12). The same was
observed for N = 3 and N = 4, where the long part of
the period was divided by similar dips into three and
four parts, respectively (not shown). The number of
time samples, Nt did not change this fact, but as Fig-
ure 12 indicates, the dips gradually become narrower as
the number of harmonics Np increases. This indicates

Np= 5
Np= 8
Np= 20
Np= 63
Np= 180

 0

 128

 256

 384

 512

 640

 768

 896

 1024

time samples

FIG. 12. Comparison between the standartd Helmholtz mo-
tion of a stepped cone (N = 2) and the HBM for various Np
−5. (a) The magnitude of
at γ = 0.31, ζ = 0.2, and η = 2 · 10
the harmonics and (b) one oscillation period. Nt varies from
128 for Np=5 to 1024 for Np=180.

(29)

Helmholtz
HBM, Np=63
HBM, Np=20
HBM, Np=8
HBM, Np=5
HBM, Np=2

Standard Helmholtz

Inverted Helmholtz

 0
 0.28

 0.3

 0.32

 0.36

 0.38

 0.4

 0.34
γ

FIG. 13. Amplitude of ﬁrst harmonic P1 as a function of
the blowing pressure γ for the Helmholtz solution (30) for
2-stepped cone and the HBM truncated to 2, 5,. . . , and 63
harmonics, the last coinciding with Helmholtz (ζ = 0.2, η =
2 · 10

−5). Only nonbeating regimes are shown.

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

9

that the HBM approaches the Helmholtz solution as Np
approaches inﬁnity.

A bifurcation diagram is plotted in Figure 13. Sim-
ilarly to Figure 11 for the cylindrical bore, the ampli-
tude of the ﬁrst harmonic is plotted for diﬀerent num-
ber of harmonics as a function of the blowing pressure
γ. The Helmholtz solution (equation (29) with N = 2)
is also plotted. As shown by Ollivier et al.,? the lower
part of the upper branch and the branch of the inverted
Helmholtz motion are unstable.

In practice, these curves are more diﬃcult to obtain
with hbmap than for the cylindrical bore, especially close
to the subcritical oscillation threshold around γ = 0.28,
where computation was not possible at this low losses.
More sophisticated continuation schemes should be con-
sidered to obtain complete curves. However, it is obvi-
ous from the diagram that the model experiences a sub-
critical Hopf bifurcation, which agrees with the conclu-
sion of Grand et al..? This means that a single-harmonic
approximation is not enough to study the solution around
this threshold, since the small-amplitude hypothesis does
not hold. Further from the threshold, convergence to-
ward the Helmholtz motion is ensured as the number of
harmonics Np is increased.

Only the nonbeating reed regime is considered in the
ﬁgure and, similarly to Figure 11, it can be noted that
the beating threshold for the model with Np harmon-
ics depends on Np but converges toward the Helmholtz
threshold γ = 1/3 (corresponding to the lossless, contin-
uous system) as Np is increased.

3. Validation with time-domain model

When adding a mass and damping to the reed or vis-
cous losses and dispersion to the pipe, it is more diﬃ-
cult to compare Harmbal results with analytic solutions.
This has been done by Fritz et al.? as far as the play-
ing frequency is concerned, by comparison with approxi-
mate analytical formula. Here, we propose to confront
both the playing frequency and the amplitude of the
ﬁrst partial with numerical results obtained with a time-
domain method. We use a newly developed (real-time)
time-domain method (here called TDM) by Guillemain et
al..? It is based on the same set of equations as presented
in Section IV A except that the impedance of the bore is
slightly modiﬁed to be expressed as an inﬁnite impulse
response. In the Fourier domain, it can be expressed as

Zr(˜ω) =

a1e−i˜ω
b0e−i˜ωD
a1e−i˜ω + b0e−i˜ωD .
−

1
1

−
−

(31)

where ˜ω = ˆω/fs, fs being the sampling frequency, and
the integer D = round(fs/2fr) the time delay in samples
for the sound wave to propagate to the end of the bore
and back. The constants a1 and b0 are to be adjusted
so that the two ﬁrst peaks of resonance have the same
amplitude as the two ﬁrst peaks of equation (20).

To express equation (31) using our terminology, we

TABLE I. The values of M and R for three strengths of
reed interaction. The bore parameters are D = 247 (fr =
103.4 Hz), a1 = 0.899, and b0 = 0.0946 for sampling frequency
fs = 51100 Hz.

Reed
Weak
Normal

M

ωe/Hz qe
10000 0.1 1.070·10
2500 0.2 1.712·10

R

−4 1.034·10
−3 8.28·10

−3

−3

remember that ω = 2π ˆf /fr and obtain

Zr(ω) =

a1e

a1e

−iω fr
fs

−iω fr

b0e−iω/2
fs + b0e−iω/2

−

.

1

1

−

−

(32)

In this section, we also include the mass and damp-
ing of the reed, so M and R are no longer zero. The
TDM does not work for M = R = 0, or even for values
close to this, so we have used a reed with weak interac-
tion with the pipe resonance as well as one with close to
normal reed impedance. The corresponding values for ωe
and qe , ge/ωe are shown in Table I. Figure 14a shows
the bifurcation diagram for two values of ζ and for weak
and normal reed impedance, while Figure 14b shows the
corresponding variation in the dimensionless playing fre-
quency fp/fr. The lines represent the continuous solu-
tions of the HBM, and the symbols show a set of results
derived from the steady-state part of the TDM signal.
The TDM symbols fall well on the lines of the HBM, ex-
cept for ζ = 0.50 when γ approaches 0.5. Then the TDM
experiences period doubling, i.e. two subsequent periods
of the signal diﬀer. At the same time, not being able to
show subharmonics, the HBM shows signs of a beating
reed, possibly a solution that is unstable and thus not
attainable by time-domain methods.

Note that three points have to be veriﬁed before com-

paring results from the HBM and the TDM:

The numerical scheme used in the TDM to approxi-
mate the time derivatives in the reed equation (15) re-
quires discretization. Depending on the sampling fre-
quency fs, the peak of resonance of the reed deviates
more or less from the one given by the continuous equa-
tion. For normal reed interaction (fe=2500 Hz), the de-
viation is negligible, but it may become signiﬁcant in
the case of weak reed interaction, where the peak is at
10000 Hz. However, the fact that the reed and the bore
interact weakly in the latter case, implies that the exact
position of the peak has little importance. Therefore,
at the used sampling frequency, the discretization in the
TDM is not compensated for in the HBM calculations.

Then there should be agreement between the sampling
frequency fs in the TDM and the number of samples Nt
per period in the HBM. Their relation is given by

Nt =

fs
fp

.

(33)

In order to have a suﬃciently high sampling rate, we have
chosen Nt = 512. The playing frequency fp is plotted in

10

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

 0.3

 0.2

 0.1

 0
 0.36

 0.972

 0.97

 0.968

 0.966

 0.964

 0.962

|
1
P
|

)
y
c
n
e
u
q
e
r
f
 
g
n
i
y
a
l
p
(
 

f
/
f

r

HBM ζ=0.50, normal reed
HBM ζ=0.50, weak reed
TDM ζ=0.50, normal reed
TDM ζ=0.50, weak reed
HBM ζ=0.35, normal reed
HBM ζ=0.35, weak reed
TDM ζ=0.35, normal reed
TDM ζ=0.35, weak reed

 0.38

 0.4

 0.42

 0.44

 0.46

 0.48

 0.5

HBM ζ=0.50, normal reed
HBM ζ=0.50, weak reed
TDM ζ=0.50, normal reed
TDM ζ=0.50, weak reed
HBM ζ=0.35, normal reed
HBM ζ=0.35, weak reed
TDM ζ=0.35, normal reed
TDM ζ=0.35, weak reed

γ

γ

i

l

)
s
s
e
n
o
s
n
e
m
d
(
 
p

i

l

i

)
s
s
e
n
o
s
n
e
m
d
(
 
u

i

0.4

0.3

0.2

0.1

0

−0.1

−0.2

−0.3

−0.4

0

0.2

0.18

0.16

0.14

0.12

0.1

0.08

0

Stable solution
Unstable solution

Stable solution
Unstable solution

500

1000

1500

2000

2500

3000

3500

4000

4500

t (time samples)

 0.36

 0.38

 0.4

 0.42

 0.44

 0.46

 0.48

 0.5

FIG. 14. Comparison between HBM and TDM of the am-
plitude of (a) the ﬁrst harmonic P1 and (b) the dimensionless
playing frequency fp/fr as the blowing pressure γ increases for
a clarinet-like system with viscous losses and weak and normal
reed interaction. TDM values for ζ = 0.50 and γ > 0.48 are
omitted due to period doubling. So are the beating regimes of
HBM calculations. (fs = 51100Hz, Nt = 512, fr = 103.4 Hz,
Np = 15)

500

1000

1500

2000

2500

3000

3500

4000

4500

t (time samples)

FIG. 15. The pressure (a) and volume-ﬂow (b) wave form of
the Helmholtz solution and a 3-level sister solution calculated
by the HBM employing the simple clarinet model with ζ =
−5.
0.5, γ = 0.4, Np = 99, η = 10

Figure 14b, and we used an average fs = 51100 Hz for
both the HBM and the TDM.

Finally, it seems also necessary that Np and Nt are

chosen so that

Np + 1 =

Nt
2

.

(34)

In practice, however, when comparing bifurcation dia-
grams of the ﬁrst harmonic P1, as in Figure 14, rather
low values of Np give good results. Nevertheless, more
harmonics are obviously needed to compare waveforms
in the time domain, especially far from the oscillation
threshold.

V. PRACTICAL EXPERIENCES

A. Multiple solutions

As we consider a nonlinear problem, we cannot antici-
pate the number of solutions. Therefore, it should not be

surprising that it is possible to obtain multiple solutions
for a given set of parameter values. When searching for
a particular solution, this may be a practical problem.
Fritz et al.? have discovered that some solutions seem
to disappear when increasing the number of harmonics
Np, implying that solutions may arise from the trunca-
tion to a ﬁnite Np. We have now discovered alternative
solutions that persist even at very high Np.

Let us illustrate this with the simple model of the clar-
inet used in Section IV B 1, where the reed is a spring
without mass or damping, the nonlinearity is given by
equation (23), and the bore is an ideal cylinder with
nearly lossless propagation and no dispersion. Figure 15
shows a three-level sister solution together with the re-
lated Helmholtz solution for a large number of harmonics,
Np = 2000.

A solution of the lossless problem should satisfy the

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

11

l

i

)
s
s
e
n
o
s
n
e
m
d
(
 
p

i

l

i

)
s
s
e
n
o
s
n
e
m
d
(
 
p

i

l

i

)
s
s
e
n
o
s
n
e
m
d
(
 
p

i

0.5

0

0.5

0

0.5

0

−0.5

0

−0.5

0

−0.5

0

l

i

)
s
s
e
n
o
s
n
e
m
d
(
 
p

i

0.4

0.3

0.2

0.1

0

−0.1

−0.2

−0.3

−0.4

0

criteria?

p(t + π) =
u(t + π) = u(t)

−

p(t)

(cid:26)

(35)

(the dimensionless period being 2π), as well as the
conditions stated before equation (24), noting that
It is eas-
p(t) = u(t) = 0 for all t is the static solution.
ily veriﬁed graphically that both of the solutions in Fig-
ure 15 satisfy these conditions. Moreover, since they also
satisfy equation (23), the three-level solution is a solution
of the lossless model.

Whereas the system of time-domain equations (35) has
an inﬁnity of solutions, truncation in frequency-domain
limits the number of solutions. The unique solution of
the HBM with only one harmonic is obviously a sine.
Let us analyse the situation in the simplest nontrivial
case of the lossless problem with two odd harmonics and
a cubic expansion for nonlinear coupling. Ignoring even
harmonics, the HBM gives a system of two equations (see
Kergomard et al.)? :

α = 3P12(1 + x + 2

2)
(a)
x
|
|
2 + 6x), (b)
x
αx = P12(1 + 3x
|
|

(cid:26)
A/C and x = P3/P1. As equation (36a)
where α =
imposes P3 to be real, solving this system amounts to
solving

−

(36)

x3 + x2

x = 1/3.

−

(37)

−

≃ ±

≃ −

This equation has three real solutions x

1.5151,
0.2776 and 0.7926. All of them are found by Harm-
−
bal for negligible losses (η = 10−5), and the correspond-
ing waveforms are presented in Figure 16. We note that
the second solution leads to the Helmholtz motion when
increasing the number of harmonics (with the theoret-
ical value known to be x =
1/3) whereas the third
one corresponds to the three-level solution in Figure 15.
We can also easily imagine that these three solutions of
the truncated problem are three-harmonic approxima-
tions of square waves that are distributed on three levels:
p±
0.5 and p = 0. Respectively, they have two, zero,
and one steps at the zero-level. It should be noted that
the conditions (35) for the continuous problem do not
constrain the duration of each step. Figure 17 shows two
such twin solutions for Np = 99 corresponding to the
three-level solution in Figure 16. This has to be kept in
mind when increasing Np using the HBM.

While the Helmholtz motion is known to be stable,?
the two three-level solutions can be considered as a com-
bination of the static solution (the zero level) and the
square wave (two levels with opposite values). Since we
know from Kergomard? that in the case of ideal propaga-
tion (neither losses nor dispersion), the stability domain
of these two solutions are mutually exclusive, it can be
concluded that the three-level solutions are unstable.

Taking into account losses in the propagation does not
make the three-level solutions vanish. But a simple rea-
soning to determine the stability of this solution is not

100

200

300

400

500

600

700

800

x=−1.5151

100

200

300

400

500

600

700

800

x=−0.2776, Helmholtz solution

100

200

300

400
t (time samples)

500

x=0.7926, Three−level solution

600

700

800

FIG. 16. The pressure waveform of the three solutions found
by the HBM with Np = 3 employing the simple clarinet model
−5.
with ζ = 0.5, γ = 0.4, η = 10

500

1000

1500

2000

2500

3000

3500

4000

4500

t (time samples)

FIG. 17. The pressure waveform of two solutions that diﬀer
by the duration of their steps, found by the HBM employing
−5,
the simple clarinet model with ζ = 0.5, γ = 0.4, η = 10
Np = 99.

possible in this case. To the authors knowledge, however,
such a solution has never been observed experimentally
at low level of excitation.

B.

Initial value of the playing frequency

A practical diﬃculty encountered is the convergence of
the playing frequency fp. If its initial value is not close
enough to the solution, divergence is almost inevitable.
This occurs because the resonator impedance Zr tends
to vanish outside the immediate surroundings of the res-
onance peaks of the resonator, rendering ~F ( ~P , fp) very
small and thereby ~G
~P /P1 nearly constant with re-
spect to fp. The slope ∂ ~G/∂fp thus becomes close to

≃

12

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

zero, the Newton step leads far away from the solution,
and convergence fails. Dissipation widens the resonance
peaks and thus also the convergence range.

For a simple system where the playing frequency is
known to correspond to a resonance peak of the tube,
initializing fp is easy. However, with dispersion or other
inharmonic eﬀects, choosing an initial value for fp may
be diﬃcult. In Harmbal the problem may to some extent
be avoided by the possibility of gradually adding the dis-
persion (or other inharmonic eﬀects), so that the play-
ing frequency can be followed quasi-continuously from a
known solution without dispersion, for instance by using
hbmap.

VI. CONCLUSIONS

The harmonic balance method (HBM) is suited for
studies of self-sustained oscillations of musical instru-
ments, and the computer program Harmbal has been de-
veloped for this application. It is available with its source
code,? has a free licence, and is already in use by sev-
eral researchers. It is programmed in C, runs fast, and is
easily used by other application, such as for continuation
purposes.

Some diﬃculties are related to the digital sampling of
the signal and can be solved by introducing a backtrack-
ing mechanism. When using a large number of harmon-
ics, the extreme case of the (lossless) Helmholtz motion
can be solved for diﬀerent shapes of resonators. Never-
theless, the value of the ﬁrst harmonic P1 seems to be
well predicted by lower values of Np, in particular close
to the threshold of a direct bifurcation. For the saxo-
phone we used a stepped-cone bore and observed one or
more dips during the longest part of the period, depend-

ing on the number of steps. These dips approach pure
impulses as Np increases. The number of samples Nt in
a period showed to be insigniﬁcant for these dips.

The HBM can lead to some alternative solutions for a
unique set of parameters. The nondissipative versions of
these solutions satisfy the continuous model equations,
but they are not stable and thus cannot be attained by
ab initio time-domain calculations. Another problem is
the great sensitivity to the guessed playing frequency.

As a consequence, a certain expertise is needed in order
to use the method, but, thanks to an automatic contin-
uation procedure, the calculation is easy. We note that
also experimental results can be used for the impedance
of the resonator.

ACKNOWLEDGMENTS

The Europeen Union through the MOSART project
is acknowledged for ﬁnancial support. We would also
like to thank Claudia Fritz at IRCAM in Paris for thor-
ough testing and valuable feedback, Jo¨el Gilbert at Lab-
oratoire d’Acoustique de l’Universit´e du Maine (LAUM)
in Le Mans, and Philippe Guillemain at the Labora-
toire de M´ecanique et d’Acoustique at CNRS in Mar-
seille for fruitful discussions during the work, and the
latter also for kindly providing some Matlab code for the
time-domain model.

1Self-sustained is a term indicating oscillation driven by a constant
energy input.
2The term non-interactive means that the user has no inﬂuence on
the program while it is running.
3This result corrects equation (14) in ref.?

J. Acoust. Soc. Am.

S. Farner et al.: Harmonic balance calculations for musical instruments

13

