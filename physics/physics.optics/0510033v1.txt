5
0
0
2
 
t
c
O
 
5
 
 
]
s
c
i
t
p
o
.
s
c
i
s
y
h
p
[
 
 
1
v
3
3
0
0
1
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

UCRL-PROC-215873

Phase Aberrations in Diﬀraction Microscopy

S. Marchesini,1, 2, ∗ H. N. Chapman,1, 2 A. Barty,1 C. Cui,3
M. R. Howells,3 J. C. H. Spence,4 U. Weierstall,4 and A. M. Minor5
1University of California, Lawrence Livermore National Laboratory, 7000 East Ave., Livermore, CA 94550, USA
2Center for Biophotonics Science and Technology, UC Davis,
2700 Stockton Blvd., Ste 1400, Sacramento CA, USA
3Advanced Light Source, Lawrence Berkeley National Laboratory, 1 Cyclotron Road, Berkeley, CA 94720, USA
4Department of Physics and Astronomy, Arizona State University, Tempe, AZ 85287-1504, USA
5National Center for Electron Microscopy, Lawrence Berkeley National Laboratory, 1 Cyclotron Rd, Berkeley, CA 94720, USA

In coherent X-ray diﬀraction microscopy the diﬀraction pattern generated by a sample illuminated
with coherent x-rays is recorded, and a computer algorithm recovers the unmeasured phases to
synthesize an image. By avoiding the use of a lens the resolution is limited, in principle, only by
the largest scattering angles recorded. However, the imaging task is shifted from the experiment to
the computer, and the algorithm’s ability to recover meaningful images in the presence of noise and
limited prior knowledge may produce aberrations in the reconstructed image. We analyze the low
order aberrations produced by our phase retrieval algorithms. We present two methods to improve
the accuracy and stability of reconstructions.

Keywords: Coherent diﬀraction, X-ray microscopy, Phase retrieval, Lensless Imaging

I.

INTRODUCTION

II. COHERENT X-RAY DIFFRACTION

A new imaging technique has emerged in recent years
that can overcome many limitations of light, electron,
and X-ray microscopy. Coherent X-ray Diﬀraction Mi-
croscopy (CXDM)1 promises to enable the study of thick
objects at high resolution. In this technique one records
the 3D diﬀraction pattern generated by a sample illu-
minated with coherent x-rays, and as in x-ray crystal-
lography a computer recovers the unmeasured phases.
This is done by alternately applying constraints such as
the measured intensity in reciprocal space and the ob-
ject support—the region where the object is assumed to
be diﬀerent from 0—in real space. This corresponds to
deﬁning the envelope of a molecule in crystallography. In
our implementation the support is periodically updated
based on the current object estimate2.

By avoiding the use of a lens, the experimental re-
quirements are greatly reduced, and the resolution be-
comes limited only by the radiation damage3,4. However
the imaging task is shifted from the experiment to the
computer, and the technique may be limited by our un-
derstanding of the phase recovery process as well as the
algorithm’s ability to recover meaningful images in the
presence of noise and limited prior knowledge.

Recently we have presented experimental results of
high-resolution 3D X-ray diﬀraction imaging of a well-
characterized test object to demonstrate the practical
application of these advances5,6. Here we extend the
analyis of image reconstruction and determine low-order
phase errors (essentially image aberrations) that can oc-
cur when reconstructing general complex-valued images.
We present two methods to improve the accuracy and
stability of reconstructions.

FIG. 1: (a) SEM image of the 3D test object. Scalebar is 1
micron. (b) Inﬁnite depth-of-focus image reconstructed from
a central section of the 3D coherent X-ray diﬀraction data.

Three-dimensional coherent X-ray diﬀraction data
were collected at the Advanced Light Source7,8 from a
test object that consisted of 50-nm diameter gold spheres
located on a 2.5-µm-wide silicon nitride pyramid5 (Fig.
1a). A bare CCD lo,cated in the far ﬁeld recorded the
diﬀraction patterns with a pixel sampling that was more
than 4 times the Shannon sampling rate for the (phased)
complex amplitudes. Diﬀraction patterns were collected
for many sample orientations over an angular range of
129˚. These were interpolated onto a 3D grid. We re-
constructed a full 3D image by performing phase retrieval
on the entire 3D diﬀraction dataset (i.e. the iterations
involved three-dimensional FFTs). The resulting volume
image reveals the structure of the object in all three di-
mensions and can be visualized in many ways including
projections through the data, slices (tomographs), or iso-
surface rendering of the data.

In addition to 3D images, we perform much anal-
ysis and algorithm development on 2D datasets. For
the work in this paper we choose central plane sec-

tions extracted from the 3D diﬀraction pattern. By the
Fourier projection theorem, the image formed from a cen-
tral section is an inﬁnite depth-of-focus projection im-
1b). We carry out ab initio image recon-
age (Fig.
structions using the Relaxed Averaged Alternating Re-
ﬂections (RAAR) algorithm9 with the “Shrinkwrap” dy-
namic support constraint2. Details of the algorithm pa-
rameters used are given in Chapman5.

III. RESOLUTION ANALYSIS

The phase retrieval process recovers the diﬀraction
phases with limited accuracy, due to factors including
SNR of the diﬀraction amplitudes, missing data, the in-
consistency of constraints, and systematic errors in the
data (such as errors in interpolation). These errors in
phase reduce the resolution of the synthesized image.
With a complex image a loose support constraint will
lead to unconstrained low-order aberrations. As is well
known an object could be shifted by a few pixels each
time we reconstruct, which is equivalent to a varying
linear phase ramp in reciprocal space.
In addition to
this shift low order phase variations, such as defocus and
astigmatism can also be unconstrained if the aberrated
object ﬁts inside the support. One way to quantify the
eﬀect of these phase variations is to determine the vari-
ation in retrieved phases as a function of resolution10
10). Given a reconstructed image g(x) obtained by phase
retrieval starting from random phases, and its Fourier
transform G =
, we deﬁne the phase re-
iϕ(q)
}
trieval transfer function by

G
|
|

exp

{

P RT F (q) =

exp

iϕ(q)

=

|h

{

}i|

G (q)
G (q)
|
|

(cid:29)(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:28)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(1)

G
i
h

the average over the complex diﬀraction ampli-
with
tudes of many reconstructed images starting from ran-
dom phases. Where the phases are random and com-
pletely uncorrelated, the average will approach zero.
Thus, the ratio is eﬀectively a transfer function for
the phase retrieval process, and the average image (the
Fourier tranform of
) is the best estimate of the im-
age: spatial frequencies are weighted by the conﬁdence
in which their phases are known.

G
i
h

In our case when reconstructing complex 2D images,
with low frequencies missing due to the beamstop, we
have observed that phase retrieval from independent ran-
dom starts may diﬀer by a phase vortex (right or left
handed), centered at the zero spatial frequency (Fig. 2).
We ﬁnd that we can improve the estimate of the image
by separating out the vortex modes5. These phase vor-
tices are due to stagnation of the phase retrieval process.
Other phase vortices can appear near local minima of the
measured intensities, and our method of separating so-
lutions will fail to detect vortices not centered near the
beamstop. In order to remove these vortex aberrations
we modiﬁed the reconstruction algorithm as follows: (i)

2

FIG. 2: Phase diﬀerence between two reconstructions in re-
ciprocal space, showing a phase vortex between two solutions
in the far ﬁeld. The center of the vortex is at q = 0, and the
half-width of the phase map is q = 0.048 nm

−1.

Average n independent reconstructions which will likely
average out the phase vortex modes but will also smooth
the resulting image, reducing the resolution. (ii) Reﬁne
this averaged image by inputting it to the RAAR9 algo-
rithm and carrying out 200 iterations. Using this “av-
eraged RAAR” algorithm we reduced the probability of
recovering an image with phase vortex mode from 40% to
15%, resulting in an improvement of the PRTF by almost
a factor of two.

half period (nm)

50 

25 

17 

13 

10 

8.3

F
T
R
P

0.5

F
T
R
P

0.5

   

1

0
1

0

0

RAAR

Averaged RAAR

RAAR

Averag ed RAAR

0.01

0.02

0.05

0.06

0.04

0.03
 q (1/nm )

FIG. 3: Top: Phase retrieval transfer function of the two al-
gorithms. PRTF=1 represents stable phases. The averaged
RAAR algorithm signiﬁcantly improves the stability of the
reconstructions. Bottom: PRTF after removing the vortices
centered at q = 0. The averaged RAAR shows marked im-
provements at high frequencies.

We compute the ﬁnal image, and the PRTF, by av-
eraging 1000 such reconstructions (Fig. 3). Before av-
eraging many images we make sure that they are not
shifted with respect to one another by ﬁnding the linear
phase ramp that minimizes the diﬀerence between their

3

(6)

(7)

Fourier transforms. Fluctuations of the linear phase term
indicate ﬂuctuations in positions. Fluctuations in higher
order polynomial phase terms indicate that phase aber-
rations are present in the reconstructions.

To quantify the instabilities of these low order phase
modes, we ﬁnd the low order phase modes (focus, astig-
matism, coma, up to a polynomial of order np) that min-
imize the diﬀerence between each new reconstruction Gn
and the ﬁrst recovered image G0. This is done by mini-
mizing

χ =

G0 (q)

Gn (q) exp

Xq |

−

ip(q)
{

2
}|

with the 2D polynomial deﬁned by coeﬃcients pi,j as

p (q) =

pi,j ¯qi

x ¯qj
y

i+j6np

Xi,j=0

with ¯qx,y = qx,y/2 max (qx,y). The linear terms repre-
senting shifts in real space are found using the method
described by Fienup11, while higher order terms are ob-
tained by ﬁtting the phase diﬀerence, arg(G†
0Gn), to the
higher order 2D polynomial terms and iterating until the
correction is less than 1˚. The ﬂuctuations of the second
order polynomial coeﬃcients are obtained by calculat-
ing their standard deviation among 1000 reconstructions,
and we ﬁnd that

p0,0 p1,0 p2,0
p0,1 p1,1 p2,1
p0,2 p1,2 p2,2

std 





= 





2.26 0.31 0.15
0.53 0.61 0
0
0.14 0

(4)





The linear terms (p1,0 p0,1) represent a shift of
[0.31, 0.53]/2π = [0.049, 0.085] pixels in real space corre-
sponding to 0.5 and 0.8 nm shifts in x and y. The degree
of defocus phase variation depends on (p2,0 +p0,2)/2, and
the real-space defocus variation is given by:

δ z =

λ
4πN A2 std

p2,0 + p0,2}

{

(5)

We have NA=0.084 and λ=1.65 nm, giving δ z = 11.3
nm. Note that this defocus variation represents an in-
stability of the phase retrieval process and does not cor-
respond to an optical eﬀect of focusing through a thick
object. In this case all voxels of the 3D images or pixels
of the 2D projection images are equally aberrated by this
eﬀect.

An additional method to further reduce these instabil-
ities is to use a small reference point near the specimen.
During the retrieval process the image of the reference
point is forced to be small with a tight support. This con-
strains the aberrations at this image point, and hence at
all image points. The reference point has the additional

(2)

(3)

FIG. 4: Demonstration of reference-enhanced diﬀraction
imaging. A Pt dot was deposited near the sample (a coccolith)
with a focused ion beam instrument. The Fourier transform
of the diﬀraction intensities (right) can be used to determine
the support which can constrain the low-order phase aberra-
tions.

advantage of providing a hologram of the specimen (Fig.
4) which can be used to provide the object support, or
even the desired image.

To quantify our ability to recover unmeasured intensi-
ties (for example behind the beamstop) we use the nor-
malized standard deviation

σ2 (q) =

G (q)

¯G (q)

2

G (q)

2.

−
We deﬁne a transfer function, based on σ2 as:

E.|h

D(cid:12)
(cid:12)

i|

(cid:12)
(cid:12)

T F (q) =

1
1 + σ2 (q)

p

= |h

G (q)

i|
2
G (q)
|

E

rD|

G
|
|

which has the desired properties that transfer function is
unity for σ2 = 0 and zero for σ2 =
. Eqn. (7) reduces
∞
to the PRTF in the regions of q where
is measured.
An algorithm that always recovers the same phases
does not necessarily recover the correct ones. Another
requirement is that the recovered image is constrained
in the region called support: g (x) = 0, x /
If
∈
this condition is satisﬁed the Fourier modulus condition
= I 1/2) is unlikely to be satisﬁed in the presence
(
G
|
|
of noise. We can quantify deviations from the mea-
sured values by an R-factor (similar to that used in
crystallography12) by

S.

G (q)
|
σ2
RF (q) = (cid:12)
(cid:12)
(cid:12)

| −
√I (q)

2

√I (q)

2

(cid:12)
(cid:12)
(cid:12)

(8)

related transfer

(cid:12)
(cid:12)
function RF T F (q) =
(cid:12)
, which is plotted in Fig. 5 for a re-

(cid:12)
(cid:12)
(cid:12)

and its
1 + σ2
RF (q)
constructed image.
(cid:2)

−1/2

(cid:3)

IV. CONCLUSION

We have performed a characterization of high-
resolution imaging of an isolated 3D object by ab ini-

   
1

F
T
F
R

0.95

0.9

0.85

0.8

0

half period (nm)

50 

25 

17 

13 

10 

8.3

RAAR

Averaged RAAR

0.01

0.02

0.05

0.06

0.04

0.03
q (1/nm)

4

ing of more than one material (such as biological samples)
the object cannot be considered positive and we must re-
duce the eﬀects of aberrations. We have proposed two
methods of overcoming limitations of computer recon-
struction: in order to improve the stability of the recon-
structions we average several reconstructed images and
use the result to feed a new round of phase retrieval.
From an experimental point of view, the use of a refer-
ence point, or other well-deﬁned object, should enable us
to greatly reduce low order phase aberrations.

FIG. 5: The R-Factor Transfer Function (RFTF) of a recon-
structed image, showing excellent agreement with the mea-
sured diﬀraction intensities.

Acknowledgments

tio phase retrieval of the coherent X-ray diﬀraction, and
examined metrics to allow the quality of image recon-
structions to be assessed.

The phase retrieval process does not produce unique
images, in that varying low-order phase modes arise, akin
to aberrations in an imaging system. Other than the tilt
terms, the low-order phase aberrations discussed here will
be reduced in case of a real object (for which only an-
tisymmetric terms are allowed) and will not be present
when a real-space positivity constraint can be imposed,
since defocusing or otherwise aberrating an image causes
it to be complex. However, in the case of samples consist-

Coccolith samples were provided by J. Young from
the Natural History Museum, London. This work was
performed under the auspices of the U.S. Department of
Energy by University of California, Lawrence Livermore
National Laboratory under Contract W-7405-Eng-48 and
the Director, Oﬃce of Energy Research, Oﬃce of Basics
Energy Sciences, Materials Sciences Division of the U. S.
Department of Energy, under Contract No. DE-AC03-
76SF00098. This work has been supported by funding
from the National Science Foundation. The Center for
Biophotonics, an NSF Science and Technology Center, is
managed by the University of California, Davis, under
Cooperative Agreement No. PHY 0120999.

∗ Electronic address: smarchesini@llnl.gov
1 J. Miao, P. Charalambous, J. Kirz, D. Sayre, Nature 400,

(1999) 342.

2 S. Marchesini et al. Phys. Rev. B 68, (2003) 140101(R),

6 S. Marchesini et al: these proceedings, IT23.
7 Beetz, et al. Nucl. Instrum. Meth. A 545, (2005) 459.
8 M. R. Howells et al, Proc. SPIE 4783, (2002) 65.
9 D. R. Luke,

Inverse Problems

21,(2005),

37,

(arXiv:physics/0306174).

(arXiv:math.OC/0405208).

3 S. Marchesini et al. Optics Express 11, (2003) 2344,

10 D. Shapiro et al.: to be published in Proc. Nat. Acad. Sci.

(arXiv:physics/0308064).

4 M. R. Howells, et al. J. Elect. Spect. and Rel. Phen. (2004),

(2005).

11 J. R. Fienup, J. Opt. Soc. Am A 36 (1997), 8352.
12 C. Giacovazzo et al Fundamentals of Crystallography

al.:

submitted

(2005),

(OUP, 2002), 2nd ed., p. 739.

5 H. N. Chapman

(arXiv:physics/0502059).
et
(arXiv:physics/0509066).

