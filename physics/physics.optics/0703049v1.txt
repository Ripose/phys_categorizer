7
0
0
2
 
r
a

M
 
5
 
 
]
s
c
i
t
p
o
.
s
c
i
s
y
h
p
[
 
 
1
v
9
4
0
3
0
7
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

DEUTSCHES ELEKTRONEN-SYNCHROTRON

in der HELMHOLTZ-GEMEINSCHAFT

DESY 07-031

March 2007

Undulator Radiation in a Waveguide

Gianluca Geloni, Evgeni Saldin, Evgeni Schneidmiller and
Mikhail Yurkov
DeutschesElektronen-Synchrotron DESY,Hamburg

ISSN 0418-9833

NOTKESTRASSE 85 - 22607 HAMBURG

Undulator Radiation in a Waveguide

Gianluca Geloni, Evgeni Saldin, Evgeni Schneidmiller
and Mikhail Yurkov

Deutsches Elektronen-Synchrotron (DESY), Hamburg, Germany

Abstract

We propose an analytical approach to characterize undulator radiation near reso-
nance, when the presence of the vacuum-pipe considerably aﬀects radiation prop-
erties. This is the case of the far-infrared undulator beamline at the Free-electron
LASer (FEL) in Hamburg (FLASH), that will be capable of delivering pulses in
the TeraHertz (THz) range. This undulator will allow pump-probe experiments
where THz pulses are naturally synchronized to the VUV pulse from the FEL, as
well as the development of novel electron-beam diagnostics techniques. Since the
THz radiation diﬀraction-size exceeds the vacuum-chamber dimensions, charac-
terization of infrared radiation must be performed accounting for the presence of
a waveguide. We developed a theory of undulator radiation in a waveguide based
on paraxial and resonance approximation. We solved the ﬁeld equation with a
tensor Green’s function technique, and extracted ﬁgure of merits describing in a
simple way the inﬂuence of the vacuum-pipe on the radiation pulse as a function
of the problem parameters. Our theory, that makes consistent use of dimensionless
analysis, allows treatment and physical understanding of many asymptotes of the
parameter space, together with their region of applicability.

Key words:
Synchrotron Radiation, Near Field, Passive Waveguide, Tensor Green’s Function,
Undulator Radiation
PACS: 41.60.Ap, 41.60.-m, 41.20.-q

Preprintsubmittedto

2February2008

1

Introduction

At the start of this century we have seen a revolution in synchrotron source
intensities. This revolution stemmed from the technique of Free-Electron
Lasers (FELs), combined with recent progress in accelerator technology,
developed in connection with high-energy linear colliders.

A new era of Synchrotron Radiation research has begun with ﬁrst user
experiments on VUV-FEL, based on Self-Ampliﬁed Spontaneous Emission
(SASE) [1, 2]. These results have been obtained at the TESLA (Tera Electron-
volt Superconducting Linear Accelerator) Test Facility (TTF) at Deutsches
Elektronen-SYnchrotron (DESY) at Hamburg, Germany. Radiation pulses
with a wavelength of 98 nm, 40 fs duration and 1.5 GW peak power where
used at TTF, phase 1 [3, 4].

This facility is now called FLASH (Free-Electron LAser in Hamburg), and
operates as a user facility since August 2005 [5, 6]. Currently FLASH pro-
duces GW-level, laser-like VUV (Vacuum Ultra-Violet) to EUV (Extreme
Ultra-Violet) radiation pulses in the wavelength range between λ = 13 nm
and λ = 50 nm, with a duration between 10 fs and 50 fs. Eﬀective operation
of an FEL in the VUV range requires high peak-current electron bunches (in
the kA-range). Electrons are initially produced in a laser-driven RF-gun and
subsequently compressed in magnetic chicanes to reach speciﬁcations. The
accelerator complex at FLASH produces ultra-short bunches approaching
sub-100 fs duration.

It is natural to take advantage of these ultra-short bunches in order to
provide coherent far-infrared (FIR) radiation. In fact, intense, coherent FIR
radiation pulses can be produced from sub-100 fs electron bunches at a
wavelength longer than, or comparable with the bunch length. For coher-
ently radiating electrons, radiated energy is proportional to the square of
the electron number, in contrast to the incoherent case when energy in the
radiation pulse scales linearly with the number of electrons involved in the
process. The result is an enhancement in the radiation intensity of many
orders of magnitude. Reference [7] describes a proposal for a FIR coherent
source, integrated in the FLASH user facility. In [7] installation of an addi-
tional electromagnetic undulator after the VUV FEL is proposed. The FIR
source will use the spent electron beam coming from the FEL process, and
will allow to signiﬁcantly extend the scientiﬁc potential of FLASH without
interfering with the main (VUV) option in the FLASH operation.

Coherent FIR pulses will be intrinsically synchronized with the VUV pulses.
A ﬁrst, natural application of this kind of photon beams is for pump-probe
experiments. Another application concerns electron beam diagnostics. The

3

femtosecond time-scale of electron bunches at FLASH is beyond the range
of standard electronic-display instrumentation, and the development of
non-destructive methods for the measurement of longitudinal beam cur-
rent distribution is undoubtedly a challenging problem. In [8] a diagnostics
technique is proposed, based on the measurement of FIR coherent radiation
from electron bunches passing through an undulator. This technique is non-
destructive, and characterization of bunches with strongly non-Gaussian
shapes (as in the FLASH case) is possible [9, 10].

FLASH will soon be coupled with a FIR electromagnetic undulator [11].
At the time of writing, the project is entering into the realization phase.
Funding has been secured, and the undulator has been built and delivered
[12]. Undulator radiation around the fundamental harmonic will always be
used. The fundamental harmonic will be tuned by adjusting the magnetic
ﬁeld strength. The wavelength range (λ = 60
200 µm) provided by this
powerful radiation source (up to 10 MW peak power) will overlap with
a large part of the THz-gap, extending between 60 µm and 600 µm. This
will allow both applications for pump-probe experiments combining FIR
and VUV radiation [13], and for non-destructive electron beam diagnostics.
In fact, measurements of the modulus of the electron bunch form factor
200 µm is suﬃcient to provide a precise
in the spectral range λ = 10
reconstruction of the electron bunch proﬁle [10].

÷

÷

In the case of the FIR undulator beamline at FLASH the electron beam geo-
metrical emittance is much smaller than the radiation diﬀraction size. This
means that, as pertains the characterization of the THz pulses, the electron
beam can safely be modelled as a ﬁlament beam. Computer codes like SRW
[14] and SPECTRA [15] can be used, in the space-frequency domain, to study
undulator radiation (UR) from ﬁlament electron beams up to a wavelength
when the inﬂuence of the vacuum chamber is negligible. Alternatively, an
analytical formalism for describing near-zone Synchrotron Radiation (SR)
ﬁelds from undulators in terms of Fourier optics, was developed in [16],
also working in the free-space limit and in the space-frequency domain.
These methods help designing beamlines and experiments. However, in the
case of the FIR undulator beamline at FLASH, wavelengths in the order of
200 µm and a 4 m-long undulator yield a radiation diﬀraction size of order of
a centimeter. This rough estimate indicates that vacuum chamber eﬀects are
expected to play an important role, since a circular vacuum chamber with
radius R = 1.8 cm is foreseen. In this case, conventional computer codes and
analytical methods fail to predict the correct radiation characteristics.

Summing up, in view of the practical application to the infrared undula-
tor line at FLASH, there is a need to develop a comprehensive theory of
undulator radiation in the presence of a waveguide.

4

Optimization of the radiation transport system calls for a precise character-
ization of THz pulses along the photon beamline. In the present work we
focus on the characterization of undulator radiation in presence of a waveg-
uide, extending the study presented in [16] to include the inﬂuence of a
vacuum chamber in our consideration. Our work is, therefore, propaedeu-
tical to the problem of optimizing the radiation transport system after the
undulator, but it does not directly deal with it.

The task that one has to solve diﬀers from the free-space case only in the
formulation of boundary conditions. As we will discuss in Section 3, the
paraxial approximation applies as in free-space but, on a perfectly conduc-
tive boundary, the electric ﬁeld must be orthogonal to the pipe surface. As in
the free-space case one can use a Green’s function approach to solve the ﬁeld
equations. The presence of diﬀerent boundary conditions complicates the
solution of the paraxial equation for the ﬁeld, which can anyway be found
explicitly, by accounting for the tensorial nature of the Green’s function.
Our consideration is quite general, and can be applied to UR sources as well
as to other long-wavelength radiation setups, like edge-radiation setups.
In both cases the paraxial approximation can be used. In the UR case, the
resonance approximation can be exploited too, in addition to the paraxial
approximation. Our theory is developed under both paraxial and resonance
approximation. We thus consider a large number of undulator periods and
a frequency range of interest close to the fundamental harmonic, where the
free-space ﬁeld exhibits horizontal polarization (for undulator ﬁeld in the
vertical direction) and azimuthal symmetry. The simultaneous application
of paraxial and resonance approximation makes the UR case richer and
more diﬃcult to be studied from a theoretical viewpoint when compared
with the edge-radiation case. In particular, the region of applicability of both
approximations must be discussed and speciﬁed.

In this paper we will focus on UR only, leaving the study of the edge-
radiation case to a future, dedicated publication. In free-space and under
resonance approximation UR is horizontally polarized. This is actually a
replica of the undulator polarization properties. Moreover, the ﬁeld exhibits
azimuthal symmetry. These properties are lost when metallic boundaries
are introduced. It is worth mentioning that application of similarity tech-
niques helps to give a clear physical interpretation of numerical results. In
this paper we continue to use these techniques, that we already applied to
SR theory in free-space (see e.g. [16]). Despite the fact that equations for the
undulator source are signiﬁcantly complicated by the presence of a waveg-
uide, we ﬁnd that these complications result in the appearance of a single
dimensionless extra-parameter, namely the waveguide diﬀraction parame-
ter Ω = R2/(ŻLw), where Ż = λ/(2π) is the reduced radiation wavelength,
Lw is the undulator length and, as already said, R is the waveguide radius.
The physical interpretation of Ω is the squared ratio between the waveguide

5

radius and the radiation diﬀraction size of UR in free-space.

Since we are practically interested in the FIR undulator beamline at FLASH
we put particular emphasis on planar undulators in the presence of a pipe
with circularly symmetric cross-section. An explicit expression for the ﬁeld
is calculated as a superposition of Transverse Electric (TE) and Transverse
Magnetic (TM) modes. Some ﬁgure of merit should be extracted from the full
information carried by the expression for the ﬁeld about how the metallic
pipe inﬂuences radiation properties. We separately studied, for horizontal
and vertical polarization components, two-dimensional intensity distribu-
tions on a transverse plane at arbitrary distance from the undulator, for
diﬀerent choices of the problem parameter. Also, we analyzed the total
power as a function of the waveguide diﬀraction parameter at perfect res-
onance. Conversely, once the waveguide diﬀraction parameter is ﬁxed, one
can investigate how the total power changes as a function of the detuning
from resonance. Finally, a comparison between the magnitude of the hori-
zontally and vertically polarized ﬁelds is also proposed as a measure of the
waveguide inﬂuence.

To the best of our knowledge, only a few articles [17, 18, 19] deal with the
problem of radiation from a wiggled electron in a waveguide. This problem
is also discussed at advanced textbook level in [20]. In reference [19] one
may ﬁnd the following words: ”Motz and Nakamura [17] (...) considered
an inﬁnitely long wiggler. As a consequence, the outcome did not possess
a realistic bandwidth. (...). In a (...) article by Haus and Islam [18] (...) it is
shown that in the limit of a highly over-moded guide, a result similar to
the free-space expression is produced”. Reference [18] considers a rectan-
gular waveguide, and focuses on ”similarities between the emission into
the free and the bounded space” (cited from [19]). However, we should say
that reference [18] solves the equations for the ﬁeld in the rectangular case
in all generality, and with no restrictions on the undulator parameter K.
Reference [19] deals with diﬀerences with respect to free-space emission, in
the case of a planar waveguide and planar undulator with small undulator
parameter K
1. These restrictions limit the practical scope of that work.
In particular, extending the theory in [19] from the case of a planar waveg-
uide to other geometries is not straightforward, since the explicit expression
for the paraxial Green’s function given in [19] is only valid for the planar-
waveguide case. The planar-waveguide case has clear advantages from an
educational viewpoint, as it allows to reduce complexities to a minimum. In
particular, no restriction is made on the wiggling amplitude of the electron
motion. In fact, the electron oscillates in the unbounded region between the
parallel conducting plates. A transparent physical picture arises, in terms of
reﬂection on the two metallic plates. However, such transparency comes at
the cost of a limited region of applicability of the theory in practical cases of
interest. In reference [19], the resonance approximation is exploited, and a

≪

6

spectral region for large detuning from the ﬁrst harmonic can be considered
due to simpliﬁcations intrinsic in the planar-waveguide geometry. In the
case of the FLASH infrared undulator a circular waveguide is going to be
used. The FLASH infrared undulator will operate for large values of K, and
radiation will be used near the resonance with the ﬁrst harmonic. We devel-
oped a theory to deal with this situation by restricting our attention around
resonance. Thus, we eliminated restrictions for the waveguide geometry
(and for the undulator parameter K), but we introduced a condition about
the spectral range of interest, coinciding with the spectral range of interest at
the FLASH infrared undulator line. The wiggling amplitude of the electron
in the undulator is taken to be small with respect to the dimension of the
waveguide. This greatly simpliﬁes analytical calculations, and describes our
practical case of interest. As it will be seen in Section 5, within the region
of parameter space where these conditions apply, one may consider both
cases when the waveguide inﬂuence is weak (up to the free-space limit)
or strong. Finally, the case of radiation of an electron in a helical wiggler
with a circular waveguide is discussed in Section 9.3 of reference [20]. TM
modes are neglected (see Appendix A for details). Excluding TM modes
from consideration is held by us to be a misconception. In contrast to this,
we will demonstrate throughout the text that the wiggler-induced motion
couples with both TE and TM modes in a circular (cylindrical) waveguide.

Our work is organized as follows. Besides this Introduction, in the next
Section 2 we review basic theory of undulator radiation in free-space. Such
a review is necessary, because delicate physical assumptions used in the
free-space case continue to be exploited when a waveguide is present as
well. In the following Section 3 we pose our problem, discussing Maxwell’s
equations for a single electron moving in the presence of metallic boundaries
and within the paraxial approximation. We derive a closed expression for
the ﬁeld with the help of a tensor Green’s function technique. At this stage
the geometry of the vacuum pipe is generic, as well as the trajectory of
the electron. In Section 4 we ﬁx the vacuum pipe geometry, specializing our
equations to the case of a vacuum pipe with circular cross-section. We verify
the correctness of our results by deriving the free-space limit, studied in [16].
Then, in the following Sections 5 we consider the cases of a planar undulator,
while we refer the interested reader to Appendix A for the case of a helical
undulator. Results obtained in Section 5 for the planar undulator case are
the main results in our paper, as they allow a complete characterization
of the ﬁeld in the FIR undulator beamline at FLASH. As said before, such
characterization is indispensable for any further analysis of the radiation
transport system. We analyze our results further in Section 6, where we
propose a study of ﬁgure of merits, that will help designers and beamline
scientists to estimate the inﬂuence of the vacuum pipe on the radiation
characteristics. In Section 7 we discuss the inﬂuence of wall-resistance on
our ﬁndings, demonstrating their relevance. Finally, in Section 8, we come

7

to conclusions.

2 Undulator radiation in free-space

2.1 Green’s function technique in free-space

⊥

−

) exp[

, t) = ~¯E(z, ~r

For any SR setup we can represent the electric ﬁeld in time domain ~E(~r, t)
as a time-dependent function of an observation point located at position
~r = ~r
+ z~ez = x~ex + y~ey + z~ez, where ~ex, ~ey and ~ez are deﬁned as (dimen-
⊥
sionless) unit vectors along horizontal, vertical and longitudinal direction
in a given reference frame. For monochromatic waves of angular frequency
ω, the wave amplitude has the form ~E(z, ~r
iωt] + C.C.,
⊥
where ”C.C.” indicates the complex conjugate of the preceding term and ~¯E
describes the variation of the wave amplitude. The vector ~¯E actually rep-
resents the amplitude of the electric ﬁeld in the space-frequency domain.
Accounting for electromagnetic sources, i.e. in a region of space where cur-
rent and charge densities are present, the ﬁeld in the space-frequency obeys
4πiω~¯j, where ¯ρ(~r, ω) and
2~¯E + ω2~¯E = 4πc2~
Helmholtz’s equation, i.e. c2
∇
~¯j(~r, ω) are the Fourier transforms of the charge density, ρ(~r, t), and of the
current density, ~j(~r, t), while c is the speed of light. We will consider a single
~r′(t))
electron. Using the Dirac delta distribution, we can write ρ(~r, t) =
and ~j(~r, t) = ~v(t)ρ(~r, t), where (
e) is the negative electron charge, ~r′(t) and ~v(t)
are, respectively, the position and the velocity of the particle at a given time
t, and vz its longitudinal velocity. After calculation of the Fourier transform
of these quantities and substitution into Helmholtz’s equation we obtain

eδ(~r

∇

−

−

−

−

¯ρ

!

e

2 +

2iω
c

∂
∂z

~
E =

4πe
vz(z)

∇
 

exp

iω
"

 

s(z)
v −

z
c

iω
c2 ~v(z)

−

!# (cid:20)

δ

~r
⊥ −

~r′

⊥

(z)

,(1)

~
∇
(cid:21)

(cid:16)

(cid:17)

−

z/c2)−
v2

s(z) being the curvilinear abscissa measured along the electron trajectory,
where we conventionally set s(0) = 0. When the longitudinal velocity of
the electron, vz, is close to the speed of light c (i.e. γ2
1, where γz(z) =
1/2 is the longitudinal Lorentz factor), the Fourier components of
(1
the source are almost synchronized with the electromagnetic wave travelling
z/c) is a slow function of
at the speed of light. In this case the phase ω(s(z)/v
z compared to the wavelength. For example, in the particular case of motion
on a straight section, one has s(z) = z/vz, so that ω(s(z)/v
zc),
and if γ2
1 such phase grows slowly in z with respect to the wavelength.

z/c) = ωz/(2γ2

z ≫

−

−

z ≫

8

For a more generic motion, one similarly obtains:

s(z2)

s(z1)

−
v

z1

z2 −
c

−

ω

 

z2

=

!

Zz1

d¯z

ω
2γ2
z(¯z)c

.

(2)

(3)

(4)

−

Mathematically, the phase in Eq. (2) enters in the Green’s function solution
of Eq. (1) as a factor in the integrand. As we integrate along z′, the factor
ω(s(z′)/v
z′/c) leads to an oscillatory behavior of the integrand over a
certain integration range in z′. Such range can be identiﬁed with the value
z1 for which the right hand side of Eq. (2) is of order unity, and
of z2 −
it is naturally deﬁned as the radiation formation length L f of the system
at frequency ω. Of course there exists some freedom in the choice of such
deﬁnition: ”order of unity” is not a precise number, and reﬂects the fact that
there is no abrupt threshold between ”oscillatory” and ”non-oscillatory”
behavior of the integrand in the solution of Eq. (1). In the following we
deﬁne the formation length L f as the interval z2 −
z1 such that the right hand
side of Eq. (2) is strictly equal to unity. It is easy to see by inspection of
c
Eq. (2) that if vz is sensibly smaller than c (but still of order c), i.e. vz ∼
Ż, where we introduced the reduced wavelength
but 1/γ2
z ∼
Ż = λ/(2π), and λ = 2πc/ω. On the contrary, when vz is very close to c, i.e.
Ż.
1/γ2
1, the right hand side of Eq. (2) is of order unity for L f = z2 −
When the radiation formation length is much longer than Ż, the electric ﬁeld
~
= ~¯E
iωz/c] does not vary much along z on the scale of
E
exp [
envelope
⊥
Ż, that is
ω/c
Ex,y |
Ex,y |≪
. Therefore, the second order derivative with
∂z
|
2 operator on the left hand side of Eq. (1) is negligible
respect to z in the
e
∇
with respect to the ﬁrst order derivative with respect to z. As a result, Eq.
(1) can be simpliﬁed as

1, then L f ∼

z1 ≫

z ≪

−
|

e

e

⊥

The diﬀerential operator

in Eq. (3) is deﬁned by

(z, ~r
⊥

)

⊥

= ~f (z, ~r
⊥

) .

(cid:21)

D

~
E

(cid:20)

e

D

2 +

2iω
c

∂
∂z

,

!

D ≡

∇⊥
 

where
∇⊥
The vector ~f (z, ~r
⊥
and is written as

2 is the Laplacian operator over transverse cartesian coordinates.
(z),

) is speciﬁed by the trajectory of the source electron, ~r′

⊥

9

~f =

4πe
c

exp

d¯z

ω
2γ2
z(¯z)c 

iω
c2 ~v

⊥

(z)

~
∇⊥

−

δ

~r
⊥ −

~r′

⊥

(z)

.

(cid:21)

(cid:16)

(cid:17)

z

Z0

i




(cid:20)



(5)

Here we considered transverse components of
vz(z) with c, based on the fact that 1/γ2
in paraxial approximation.

z ≪

e

~
E only and we substituted
1. Eq. (3) is Maxwell’s equation

In the following, with some abuse of language, we will refer to the slowly
varying envelope of ~¯E

, simply as the ﬁeld.

, i.e. to

~
E

⊥

⊥

The Green’s function for Eq. (3), namely the solution corresponding to a
unit point source, depends on boundary conditions. In free-space it must
obey

e

G(z

z′; ~r

−

⊥ −

) =

~r′

⊥

1
4π(z

−

exp

z′)

iω|
"

~r
⊥ −
2c(z

~r′

2
⊥ |
z′)

,

−

−

−

−

z′ > 0. When z

#
assuming z
z′ < 0 the paraxial approximation does
not hold, and the paraxial wave equation, Eq. (3), should be substituted,
in the space-frequency domain, by the more general Helmholtz’s equation.
However, the radiation formation length for z
z′ < 0 is very short with
−
z′ > 0, i.e. there is eﬀectively no radiation for observer
respect to the case z
positions z
z′ > 0.
It follows that the observer is located downstream of the sources. This leads
to the ﬁnal result:

z′ < 0. As a result, in this paper we will consider only z

−

−

−

(6)

(z, ~r
⊥

⊥

, ω) =

iωe
c2

−

dz′

z

1

−

~v(z′)

c −

~r
⊥ −
z

(z′)
⊥
z′

~r′

−

#

~
E

e

exp

iω

×

|

~r
⊥ −
2c(z

2
⊥ |
z′)

z′ "
~r′

−

z

Z
−∞









+

d¯z

z′

Z0

.

1
2γ2
z(¯z)c 





Eq. (7) is valid at any observation position z such that the paraxial approx-
imation is valid, i.e. up to distances between the observer and the elec-
tromagnetic sources comparable with the radiation wavelength. One may
recognize two terms in Eq. (7). The ﬁrst in ~v(z′) can be traced back to the
current term in Eq. (1), while the second, in ~r
(z′), corresponds to the
gradient term in Eq. (1).

⊥ −

~r′

⊥

The far zone is deﬁned as the region of observation where the direction from
any trajectory point to the observer can be considered constant. In the far

(7)

10

zone, Eq. (7) reduces to

z

Z
−∞
z′

Z0





(z, ~θ, ω) =

iωe
c2z

−

~v(z′)

c −

~θ
!

dz′

 

~
E

⊥

e

(cid:17)





~θ
≡ |

.
|

exp

i

d¯z

×

ω
2γ2
z(¯z)c

+

iω
2c

z θ2

2~θ

~r′

⊥

·

−

(z′) + z′θ2

,

(8)

(cid:16)

where ~θ = ~r
⊥

/z deﬁnes the observation direction, and θ

An ultra-relativistic electron radiates non-negligibly, in the far-zone, up
to observation angles of order θ2 . Ż/L f (see [16]). Moreover, for ultra-
relativistic electrons, L f ≫
1 formally
coincides with the region of applicability of the paraxial approximation.
However, since radiation is negligible elsewhere, it follows that paraxial
approximation can be applied to describe radiation from an ultra-relativistic
electron at any observation angle of interest.

Ż. The angular region θ2 . Ż/L f ≪

and the longitudinal wave number kz, that is ~k

If we now decompose the electric ﬁeld distribution in the far zone as a
superposition of plane waves (angular spectrum), the angle of propagation
of each plane wave is represented by the ratio between the transverse wave
vector ~k
/kz. Note that in
⊥
free-space, ~k
and kz are allowed to vary continuously across the reciprocal
⊥
space. Non-negligible plane wave components of the angular spectrum are
those seen at angles θ2 . Ż/L f ≪
1.
Now, since kz ≃
1.
This result will be useful in Section 3.

k = 1/Ż this may also be stated by requiring k2
⊥

1, i.e. propagating at angles k2
/k2
⊥
c2/ω2

z ≪
≪

⊥

2.2 Undulator radiation in paraxial approximation. Far zone

Let us apply the method outlined in Section 2.1 to the case of planar undula-
tor. In general, the term undulator radiation ﬁeld means only a part of the total
ﬁeld seen by an observer from a realistic setup, because one should account
for contributions from the entire trajectory of the particle. We may follow
any textbook like [26] in deriving well-known relations in the far-zone. For
the electron transverse velocity we assume

vx(z′) =

cθs sin(kwz′) =

−

cθs
2i

−

exp(ikwz′)

exp(

ikwz′)

.

−

−

(9)

(cid:2)

11

(cid:3)

(10)

(11)

(12)

Here kw = 2π/λw, and λw is the undulator period. Moreover, θs = K/γ, where
K is the deﬂection parameter deﬁned as

K =

eλwHw
2πmec2 ,

me being the electron mass at rest and Hw being the maximal magnetic ﬁeld
of the undulator on axis.

The longitudinal Lorentz factor γz(z) is a function of the position down the
undulator, so that the phase in Eq. (2) calculated at z1 = 0 and z2 = z gives:

z

Z0

ω
2cγ2
z(¯z)

d¯z =

ω
2c ¯γ2
z

z

−

ωθ2
s
8kwc

sin(2kwz) ,

where the average longitudinal Lorentz factor ¯γz is deﬁned as

¯γz =

γ
√1 + K2/2

.

We write the undulator length as Lw = Nwλw, where Nw is the number of
undulator periods. With the help of Eq. (8) we obtain an expression, valid
in the far zone:

~
E

⊥

=

iωe
c2z

Lw/2

Z
Lw/2

−

e

Here

dz′exp [iΦT] exp

ωθ2z
2c

i
"

# "

K
γ

sin (kwz′) ~ex + ~θ
#

.

(13)

ΦT =

 

ω
2c ¯γ2
z

+

ωθ2
2c

Kθx
γ

ω
kwc

z′

−

!

cos(kwz′)

sin(2kwz′) .

(14)

K2
8γ2

ω
kwc

−

The choice of the integration limits in Eq. (13) implies that the reference
system has its origin in the center of the undulator as in Fig. 1. As for Eq. (7)
and Eq. (8), one recognizes two terms in Eq. (13). The ﬁrst in sin(kwz′) can
be traced back to the ﬁrst (current) term in Eq. (7), while the second, in ~θ,
corresponds to the second (gradient) term in Eq. (7).

Eq. (13) has been derived under the paraxial approximation, that can always
be applied for ultrarelativistic systems characterized by a large parameter
γ2

1.

≫

12

x

y

-Nw

w/2

Nw

w/2

z

Screen

Fig. 1. Geometry for undulator radiation.

2.3 Resonant approximation in the far zone

Usually, it does not make sense to calculate the intensity distribution from
Eq. (13) alone, without extra-terms (both interfering and not) from the other
parts of the electron trajectory. This means that one should have complete
information about the electron trajectory and calculate extra-terms to be
added to Eq. (13) in order to have the total ﬁeld from a given setup. Yet,
we can ﬁnd particular situations for which the contribution from Eq. (13) is
dominant with respect to others. In this case Eq. (13), alone, has independent
physical meaning.

One of these situations is when the resonance approximation is valid. This
approximation does not replace the paraxial one, based on γ2
1, but it is
used together with it. It takes advantage of another parameter that is usually
large, i.e. the number of undulator periods Nw ≫
1. In this case, the integral
in dz′ in Eq. (13) exhibits simpliﬁcations, independently of the frequency of
interest due to the long integration range with respect to the scale of the
undulator period.

≫

In the particular case when the frequency of interest is near the fundamental
resonance frequency

ωr = 2kwc ¯γ2
z ,

(15)

or other harmonics odd multiples of ωr, extra-simpliﬁcations can be ex-
ploited, allowing one to neglect the gradient term in ~θ in Eq. (13), as well as
the constrained particle motion in the Green’s function, i.e. the second term
in cos(kwz′) in the phase Eq. (14), that corresponds to the term in ~θ
(z′)
in Eq. (8). This leads to horizontally polarized radiation and to azimuthal
symmetry of the ﬁeld. It should be stressed that odd harmonics constitute a
particular case. Neglecting the gradient term and the constrained particle’s
motion in the Green’s function does not coincide with the application of the

~r′

⊥

·

13

l
l
resonance approximation, understood as exploitation of the large parame-
ter Nw ≫
1. For example, resonance approximation can be used to study
even harmonics but, as shown in [23], in that case the gradient term and the
constrained particle’s motion in the Green’s function must be retained.

In this paper we will be interested in frequencies near the ﬁrst (funda-
mental) harmonic ωr, so that the above mentioned extra-simpliﬁcations can
be exploited. Let us show how this can be done, and let us discuss how
radiation characteristics (polarization and symmetry) are related to the pos-
sibility of neglecting gradient term and constrained particle’s motion in the
Green’s function. First, we can specify ”how near” ω is to ωr by introducing
a detuning parameter C, deﬁned as

C =

ω
2 ¯γ2
zc −

kw =

kw .

∆ω
ωr

Here ω = ωr + ∆ω. Eq. (14) can thus be written as

ΦT =

kw + C +
 

ωθ2
2c

!

Kθx
γ

ω
kwc

z′

−

cos(kwz′)

sin(2kwz′) ,

(17)

K2
8γ2

ω
kwc

−

so that, in all generality, the ﬁeld in Eq. (13) can be written as

Lw/2

~
E

⊥

e

×

= exp

ωθ2z
2c

iωe
c2z

i
"

#
ωθ2
2c

z′

!

exp

i
"

C +
 

Z
Lw/2
Kθx
γ

−

−

(

ω
kwc

dz′

exp (2ikwz′)

K
2iγ

1

−

~ex + ~θ exp (ikwz′)
)

(cid:2)
cos(kwz′)

K2
8γ2

ω
kwc

−

(cid:3)
sin(2kwz′)
#

.

As ﬁrst proposed in [25] one may use the Anger-Jacobi expansion:

(16)

(18)

(19)

exp

ia sin(ψ)

=

Jp(a) exp

ipψ

,

(cid:2)

(cid:3)

(cid:2)

(cid:3)

∞

p=
X
−∞

where Jp(
·
the integral in Eq. (18) in a diﬀerent way:

) indicates the Bessel function of the ﬁrst kind of order p, to write

= exp

ωθ2z
2c

iωe
c2z

#

i
"

∞

m,n=
X

−∞

~
E

⊥

e

Jm(u)Jn(v) exp

iπn
2

(cid:20)

(cid:21)

14

Lw/2

i
"

C +
 

ωθ2
2c

K
2iγ

z′

!

# (

(cid:2)

dz′ exp

×

Z
Lw/2
−
exp [i(n + 2m)kwz′] ,
×
where

u =

K2ω
8γ2kwc

−

and v =

Kθxω
γkwc

.

−

exp (2ikwz′)

1

−

~ex + ~θ exp (ikwz′)
)
(20)

(cid:3)

Up to now we just re-wrote Eq. (13) in a diﬀerent way. Eq. (13) and Eq. (20)
are equivalent. Of course, deﬁnition of C in Eq. (16) is suited to investigate
frequencies around the fundamental harmonic but no approximation is
taken besides the paraxial approximation.

Whenever

C +

ωθ2
2c ≪

kw ,

the ﬁrst phase term in z′ under the integral sign in Eq. (20) is varying slowly
on the scale of the undulator period λw. As a result, simpliﬁcations arise
1, because fast oscillating terms in powers of exp[ikwz′] ef-
when Nw ≫
fectively average to zero. When these simpliﬁcations are taken, resonance
approximation is applied, in the sense that one exploits the large parameter
Nw ≫
1. This is possible under condition (22). Note that (22) restricts the
range of frequencies for positive values of C independently of the obser-
vation angle θ, but for any value C < 0 (i.e. for wavelengths longer than
Żr = c/ωr) there is always some range of θ such that Eq. (22) can be ap-
plied. Altogether, application of the resonance approximation is possible
for frequencies around ωr and lower than ωr. Once any frequency is ﬁxed,
(22) poses constraints on the observation region where the resonance ap-
proximation applies. Similar reasonings can be done for frequencies around
higher harmonics with a more convenient deﬁnition of the detuning param-
eter C.

Within the resonance approximation we further select frequencies such that

∆ω
|
|
ωr ≪

1 ,

i.e.

C
|

| ≪

kw .

Note that this condition on frequencies automatically selects observation
angles of interest θ2
z. In fact, if one considers observation angles
outside the range θ2
z, condition (22) is not fulﬁlled, and the inte-
grand in Eq. (20) exhibits fast oscillations on the integration scale Lw. As a

1/γ2
1/γ2

≪
≪

15

(21)

(22)

(23)

= 0, with accuracy 1/Nw. Under
result, one obtains zero transverse ﬁeld,
the constraint imposed by (23), independently of the value of K and for
1/γ2
observation angles of interest θ2

⊥

z, we have
e

~
E

≪

=

v
|

|

K

θx|
|
γ

ω
kwc

=

1 +

(cid:18)

∆ω
ωr

(cid:19)

2 √2K
√2 + K2

¯γz|

θx|

. ¯γz|

θx| ≪

1 .

(24)

This means that, independently of K,
Eq. (20) according to Jn(v)
function

v
|
| ≪
n/Γ(1 + n)] vn, Γ(
·

[2−

≃

1 and we may expand Jn(v) in
) being the Euler gamma

Γ(z) =

dt tz
1 exp[
−

t] .

−

∞

Z0

(25)

Similar reasonings can be done for frequencies around higher harmonics
with a diﬀerent deﬁnition of the detuning parameter C. However, around
odd harmonics, the before-mentioned expansion, together with the appli-
cation of the resonance approximation for Nw ≫
1 (fast oscillating terms in
powers of exp[ikwz′] eﬀectively average to zero), yields extra-simpliﬁcations.

∼

v
|

| ≪

vn, with

Here we are dealing speciﬁcally with the ﬁrst harmonic. Therefore, these
extra-simpliﬁcations apply. They enforce a stronger version of the resonance
approximation allowing one to neglect both the constrained motion in the
Green’s function and the gradient term in the expression for the ﬁeld (re-
spectively, the term in cos(kwz′) in the phase of Eq. (18) and the term in ~θ
in Eq. (18)). First, non-negligible terms in the expansion of Jn(v) are those
1. The value n = 0 gives
for small values of n, since Jn(v)
∼
1. Then, since the integration in dz′ is
a non-negligible contribution J0(v)
performed over a large number of undulator periods Nw ≫
1, all terms of
the expansion in Eq. (20) but those for m =
1 and m = 0 average to zero
due to resonance approximation. Note that surviving contributions are pro-
portional to K/γ, and can be traced back to the current term in ~ex only, while
the gradient term in ~θ in Eq. (20) averages to zero for n = 0. Values n =
1
already give negligible contributions. In fact, J
v. Then, the term in
1(v)
±
~ex in Eq. (20) is v times the term with n = 0 and is immediately negligible,
regardless of the values of m. The gradient term in ~θ would survive aver-
aging when n = 1, m =
1, m = 0. However, it scales as
~θv. Now, using condition (23) we see that, for observation angles of interest
θ2
K/γ. Therefore, the gradient
term is negligible with respect to the current term in ~ex for n = 0, that scales
as K/γ. All terms corresponding to larger values of

( √2 K / √2 + K2 ) ¯γzθ2

1 and when n =

are negligible.

~θ
v
| |
|

1/γ2
z,

| ∼

≪

≪

−

−

−

∼

±

n
|
|

16

Summing up, all terms of the expansion in Eq. (19) but those for n = 0 and
m =

1 or m = 0 give negligible contribution. After deﬁnition of

−

e

~
E

⊥

e

AJJ = J0

ωK2
8kwcγ2

 

J1

 

−

!

ωK2
8kwcγ2

,

!

that can be calculated at ω = ωr since

C
|

| ≪

kw, we have

~
E

⊥

=

KωeAJJ
2γc2z

−

exp

ωθ2z
2c

i
"

dz′ exp

i
"

C +
 

ωθ2
2c

z′

~ex ,

!

#

Lw/2

Z
Lw/2

#
−

yielding the well-known free-space ﬁeld distribution:

(z, ~θ) =

KωeLwAJJ
2γc2z

−

exp

ωθ2z
2c

i
"

#

sinc

Lw
2

"

C +
 

ωθ2
2c

!#

~ex ,

(26)

(27)

(28)

)

≡

sin(
·

where sinc(
). Therefore, the ﬁeld is horizontally polarized and
·
azimuthal symmetric. It should be clear that result in Eq. (28) is valid for
arbitrary values of K, that may assume values much larger than unity, as in
the long-wavelength range of the FIR undulator line at FLASH.

)/(
·

Condition (22) deﬁnes the applicability region of the resonance approxima-
tion in free-space in terms of the detuning parameter C and the observation
angle ~θ. Condition (23) deﬁnes the range of the detuning parameter C where
a stronger version of the resonance approximation applies for odd harmon-
ics. It imposes a stronger constraint on the detuning parameter C but it
eliminates constraints on the observation angles because, as said before,
observation angles outside the region of interest θ2
z simply return
zero ﬁeld. Thus, Eq. (28) can be used without restrictions on θ. Sometimes
we will say that (23) enforces the ”strong” resonance approximation, when
the extra-simpliﬁcations we just discussed apply.

1/γ2

≪

The constrained motion term in the Green’s function and the gradient term
in the equation for the ﬁeld are strictly related to polarization and azimuthal
symmetry of the ﬁeld. When the constrained motion in the Green’s function
can be neglected, also the gradient term can be neglected and the ﬁeld
is horizontally polarized and azimuthal symmetric. There are situations
when this cannot be done. For example, when studying the long-wavelength
region when (23) is not valid, the ﬁeld looses these properties. However, if
(22) holds, resonance approximation can still be applied, in the sense that the
1 can be exploited to simplify the integration in dz′.
large parameter Nw ≫

17

In the case of even harmonics, that has been studied in reference [23], one
can use restrictions (23) and expand the Bessel function similarly to what
has been done here. However, in this case, both constrained motion term in
the Green’s function and gradient term in the equation for the ﬁeld are not
negligible. Therefore, the ﬁeld is not horizontally polarized, nor azimuthal
symmetric.

2.4 Undulator radiation in the near zone

As has been described in [16], SR ﬁelds can be treated in terms of Fourier
optics. In particular, radiation from an ultra-relativistic particle in an un-
dulator can be interpreted as radiation from a virtual source placed in the
undulator center, i.e. at z = 0, which produces a laser-like beam. The con-
cept of virtual source has already been proposed (see [27], [28] and [29]).
In [16] we developed this concept up to an analytical description of the
virtual source that is similar, in many aspects, to the waist of a laser beam.
In the case of undulator radiation in free-space it exhibits a plane wave-
front. It is completely speciﬁed, for any given polarization component, by
a real-valued ﬁeld amplitude distribution and can be determined from the
knowledge of the far-zone distribution in Eq. (28) through the relation (see
[16]):

E

(0, ~r
⊥

⊥

) =

iωz
2πc

Z

d~θ exp

~θ
2
iω
|
|
2c

−


z
E


⊥

(~θ) exp

iω
c

~r
⊥ ·

(cid:20)

,

~θ
(cid:21)

e


where the integration in d~θ is understood to be performed over the entire
plane spanned by ~θ. The integral in Eq. (29) can be calculated analytically
at perfect resonance (C = 0) yielding the ﬁeld distribution at the source:



e

(29)

E

(0, ~r
⊥

⊥

) =

iAJJeθsω
2c2

−

π

2Si

−

"

r2
ω
⊥
Lwc

 

!#

,

e
where Si(
·

) indicates the sin integral function

Si(z) =

dt

sin(t)
t

.

z

Z0

(30)

(31)

The quantity in Eq. (30) is a scalar because, as we have seen, the ﬁeld is
horizontally polarized. Numerical investigations are possible oﬀ-resonance,

18

for C , 0. Once the ﬁeld at the virtual source is known, the ﬁeld at other
longitudinal positions, both in the far and in the near zone, up to distances
to the sources comparable with the radiation wavelength, can be obtained
with the help of the Fresnel propagation formula:

(32)

(33)

(34)

(35)

E

(z, ~r
⊥

⊥

) =

d~r′

E

(0, ~r′

⊥

⊥

⊥

) exp

iω
2πcz

Z

e

e

iω

~r
⊥ −
2cz
(cid:12)(cid:12)(cid:12)





2

~r′
⊥

,

(cid:12)(cid:12)(cid:12)





yielding, at any position z

E

(z, r

) =

⊥

⊥

KωeAJJ
2c2γ

iωr2
⊥
Lwc

−

2zc

Ei
"

 

Ei

 

−

!

iωr2
⊥
2zc + Lwc

.

!#

e
Here Ei(
·

) indicates the exponential integral function

∞

dt

t]

exp[
t

−

,

Ei(z) =

−

Z
z
−

where the principal value of the integral is taken. The far-zone limit of this
Lw and reads
expression is reached for z

≫

E

(z, θ) =

⊥

KωeLwAJJ
2γc2z

−

exp

ωθ2z
2c

i
"

sinc

#

"

Lwωθ2
4c

,

#

that coincides with Eq. (28) at C = 0.

e

3

Paraxial Green’s function with boundary conditions

In the previous Section 2 we considered the problem of characterizing radi-
ation from an ultrarelativistic electron moving on an arbitrary trajectory in
free-space using Paraxial Maxwell’s equations.

We now wish to generalize that treatment, to describe radiation from an
ultrarelativistic electron moving on a given trajectory inside a metallic pipe
of arbitrary cross-section. An example is depicted in Fig. 2, where ~n is a
= 1. At any
vector ﬁeld deﬁned on the boundary surface S, such that
point, ~n is orthogonal to S and points outwards.

~n
|

|

19

metallic boundary surface
S

z

Electron moving 
inside the pipe

Waveguide 
cross-section
y

x

r
n

Fig. 2. Geometry of the problem. The electron is moving inside the pipe.

≪

≪

≪

c2/ω2

obeys k2
⊥

As we have discussed at the end of Section 2.1 by expanding the far-zone
ﬁeld distribution in free-space in terms of plane waves, the paraxial approx-
imation applies when the transverse wave number k
1.
⊥
This is no restriction for ultra-relativistic systems with 1/γ2
1. In fact, non-
c2/ω2
negligible components of the angular spectrum are those for k2
1.
⊥
We can take advantage of this relation also in case a waveguide of typical
geometrical dimension R is present (for a circular waveguide R indicates
the radius). The diﬀerence with respect to the free-space case is in a discrete
number of modes, corresponding to a discrete range of values that k
may
⊥
assume. The concept of radiation formation length must be ascribed to each
Ż holds for each
propagating mode, but for ultra-relativistic electrons L f ≫
c2/ω2
mode. One concludes that paraxial approximation holds when k2
1
⊥
for each mode. The same conclusion can be drawn by remembering that the
paraxial approximation is based on the fact that the electron velocity must
be close to the phase velocity of light. In the waveguide, the phase velocity
c2k2
1/2. As a result, in order for the
of light is larger than c, i.e. vph = c(1
⊥
electron velocity to be near to vph one must require that the electron velocity
is close to c and additionally that k2
c2/ω2
1. This means that the paraxial
⊥
approximation is applicable for frequencies well above the cutoﬀ frequency
of a given mode, ω
ωcutoﬀ the waveguide is said
to be overmoded. Thus, the paraxial approximation is applicable when the
waveguide is overmoded. Since the smallest cutoﬀ frequency (that for the
c/R, it also follows that the waveg-
fundamental mode) is about ωcutoﬀ
uide is overmoded for Ż
R. We assume that the last condition is veriﬁed
through this paper.

. When ω

/ω2)−

ωcutoﬀ

ck
⊥

≫

≪

≪

≫

≪

≃

−

∼

Since Ż
R the paraxial approximation can be applied and is convenient to
introduce, as for the free-space case in Section 2, the slowly varying envelope

≪

).
of the Fourier transform of the transverse electric ﬁeld, ”the ﬁeld”
Here (z, ~r
) indicates a point inside the waveguide, as shown in Fig. 2. The
⊥
paraxial equation for the ﬁeld is identical to that for the free-space problem,

(z, ~r
⊥

⊥

~
E

e

20

Eq. (3), where the diﬀerential operator
Eq. (5).

D

is deﬁned in Eq. (4), and ~f (z, ~r
⊥

) in

We only need to account for the presence of the vacuum pipe by specifying
proper boundary conditions. In the case of perfect metal (we will treat wall
resistance eﬀects in Section 6), the electric ﬁeld must be orthogonal to the
boundary surface S, i.e.

(36)

(37)

(38)

(39)

nx

Ey −

ny

Ex

(cid:16)

e

=

~n

(cid:18)

×

⊥

~
E

e

S

(cid:19)

(cid:12)(cid:12)(cid:12)

S

(cid:17)
(cid:12)(cid:12)(cid:12)

e

= 0

and

Ez

= 0 .

(cid:16)

e

S

(cid:17)
(cid:12)(cid:12)(cid:12)

= 0 .

~
H

~
∇ ×

z
(cid:19)

(cid:20)(cid:18)

S

e

(cid:21)
(cid:12)(cid:12)(cid:12)
~
H, analogously to

Maxwell’s equation for the curl of the magnetic ﬁeld implies that Eq. (37) is
equivalent to

~
E, is the slowly varying envelope of the magnetic
Here
ﬁeld in the space-frequency domain, and will be referred to as the ”magnetic
ﬁeld” . Since paraxial approximation applies, the transverse components of
Hy and
the magnetic ﬁeld
Ey ≃ −

e
Hx and
Hx so that Eq. (38) ﬁnally yields

Hy are related to the electric ﬁeld by

Ex ≃

e

e

e

e

e
Ex
∂
∂x
e

+

Ey
∂
∂y
e





S



(cid:12)(cid:12)(cid:12)

e

=

~
∇⊥ ·

(cid:18)

e

~
E

e

⊥

S

(cid:19)
(cid:12)(cid:12)(cid:12)

= 0

Eq. (36) and Eq. (39) are boundary conditions in the paraxial approximation.
To the best of our knowledge, they are only discussed in [21]. At ﬁrst glance
the second condition, Eq. (39), is not obvious. In paraxial approximation Eq.
(37) looks automatically satisﬁed, so that one might be led to use Eq. (36)
only. Actually, Eq. (36) poses conditions on the ﬁeld amplitude while Eq.
(39) poses conditions on the ﬁeld derivatives, so they are both necessary.

21

(40)

(41)

(42)

Summing up, we should ﬁnd solution to the problem

= ~f (z, ~r
⊥

)

)

(z, ~r
⊥
(cid:21)
= 0

~
E

⊥
~
(cid:20)
E
e
×

D
~n

~
∇⊥ ·






(cid:18)

(cid:18)

(cid:19)

⊥
~
E
e
⊥

e

(cid:12)(cid:12)(cid:12)
(cid:19)

S

(cid:12)(cid:12)(cid:12)

S

= 0 ,

and the vector function ~f are deﬁned in Eq. (4) and
where the operator
Eq. (5) respectively. We proceed by using a Laplace transform technique,
that allows one to dispose of the partial derivative with respect to z in
in
the ﬁrst equation in (40).

D

D

First we deﬁne Laplace
g(z, ~r
⊥

) as

L

and inverse Laplace

1 transform of a function
−

L

−

(cid:2)

(cid:3)

g(p, ~r
⊥

)

≡ L

g(z, ~r
⊥

)

(p) =

g(z, ~r
⊥

) exp

pz

dz

∞

Z0

b

(cid:2)

(cid:3)

with Re[p] > 0, and

g(z, ~r
⊥

)

≡ L

1
−

g(p, ~r
⊥

)

(z) =

g(p, ~r
⊥

) exp

pz

dp ,

(cid:2)
b

(cid:3)

(cid:2)

(cid:3)

δ+i

∞

Zδ
i
∞
−

b

where δ is a real number larger than all the real parts of the singularities of
g(p).

Consistently applying a Laplace transformation to the equation set (40) we
b
obtain a redeﬁnition of the problem in terms of the Laplace transform of the

ﬁeld

(p, ~r
⊥

)

⊥

≡ L

(z, ~r
⊥

)

⊥

(p):

~
E

(cid:20)
(cid:21)
e
= (2iω/c)

~
E

(0, ~r
⊥

⊥

) +

~
f (p, ~r
⊥

)

e

b

(43)

~
E

⊥
~
(cid:20)
E
b
×

)

(p, ~r
⊥
(cid:21)
= 0

D
~n
b
(cid:18)

(cid:18)

~
∇⊥ ·

(cid:19)

⊥
~
E
b
⊥

b

(cid:12)(cid:12)(cid:12)
(cid:19)

S

(cid:12)(cid:12)(cid:12)

S

= 0 ,

~
E

b






b

where

~
f is the Laplace transform of ~f and

22

2 +

2iωp
c

.

!

D ≡

∇⊥
 

b

(44)

(45)

(46)

(47)

) in Eq. (43) refers
Note that the presence of the initial condition
to the possibility of introducing an external ﬁeld into the system. In what

(0, ~r
⊥

⊥

follows we set

(0, ~r
⊥

⊥

) = 0.

~
E

e

Now, suppose that we ﬁnd a tensor of components

Gα

β such that

~
E

e

b

Eα =

Gα

β(~r
⊥

, ~r′

⊥

, p)

f β(~r′

, p) d~r′

⊥

,

⊥

Z

b

b

b

where we indicated tensor and vector components with Greek indexes 1 . In
β, that will be written as Gα
β,
this case, the inverse Laplace transform of
is the tensor Green’s function for the problem (40), inclusive of the proper
boundary conditions. As a result 2

Gα

b

z

dz′

Z
−∞

Z

Eα(~r
⊥

, z) =

e

d~r′

⊥

Gα
β

, ~r′

~r
⊥

⊥

, z

−

z′

f β

~r′

, z′

,

⊥

(cid:16)

(cid:17)

(cid:16)

(cid:17)

where, as in Section 2.1, we integrate up to z′ = z because the radiation
z′ >
formation length for z
G, then to apply a Laplace inverse
0. Summing up, we ﬁrst have to ﬁnd
transform in order to get G and, ﬁnally, to solve for

z′ < 0 is very short with respect to the case z

Eα.

−

−

We start by specifying the eigenvalue problem associated with the problem
set (43), that is

e

b

~Fj(~r
⊥
~Fj

)

= Λ j~Fj(~r
⊥
= 0
i

)

S

h
×

D
~n
b
(cid:16)
~
∇⊥ ·






S

(cid:16)

= 0 .

(cid:17)
~Fj
(cid:12)(cid:12)(cid:12)
(cid:17)
(cid:12)(cid:12)(cid:12)
Here the index j is understood to identify any possible vector solving the
Λ j yields an equivalent eigenvalue
equations set in (47). Posing λ j ≡
1 Note that high and low indexes are interchangeable, as the metric tensor is
represented by the identity matrix.
2 Formally we are translating the initial point z = 0, where

) = 0, at z

2iωp/c

~
E

−

(0, ~r
⊥

⊥

e

−→

.

−∞

23

problem involving Helmholtz’s equation:

(48)

(49)

(50)

(51)

(52)

) + λ j~Fj(~r
⊥

) = 0

2

∇
⊥
~n

~Fj(~r
⊥
~Fj

×

~
∇⊥ ·

(cid:16)

(cid:16)

S

(cid:17)
~Fj
(cid:12)(cid:12)(cid:12)
(cid:17)
(cid:12)(cid:12)(cid:12)

S






= 0

= 0 .

~f , ~g

≡

ZS

E

~f ∗

~g d~r
⊥

.

·

~f ,

2

~g

∇

⊥

∗ =

~g ,

2

~f

∇

⊥

E

D

,

E

D

D

It can be veriﬁed that boundary conditions are homogeneous, so that the
domain of the Laplacian operator is, in our case, the vector space of twice
diﬀerentiable (square integrable) functions obeying boundary conditions
in (48). The Laplacian operator deﬁned in this way can be shown to be
self-adjoint with respect to the inner product deﬁned as

This means that for any chosen ~f and ~g in the domain of the Laplacian
operator we have

where asterisks indicate complex conjugation. As a result, eigenvalues λ j are
real. Eigenvectors ~Fj referring to diﬀerent eigenvalues are orthogonal and
span over the entire domain. The spectrum is discrete, and eigenvectors can
be chosen real. We normalize the eigenvectors ~Fj so that

~Fj, ~Fj

= 1 .

D

E

As a result we can write the decomposition

F α
j F ∗j β

,

2iωp/c

λ j

−

j
X

Gα

β =

b

that is analogous to the approach for solution of a Sturm-Liouville problem.
Since eigenvectors can be chosen real we will do so, and from now on we
will avoid complex conjugation everywhere.

Helmholtz’s theorem (also named the fundamental theorem of vector calcu-
lus) states that any vector ﬁeld (in our case, the two-dimensional vector ﬁeld

24

~Fj) that is twice continuously diﬀerentiable and vanishing rapidly enough
at inﬁnity, can be split in the sum of two vector ﬁelds; the ﬁrst, ~Vi, irrota-
tional, i.e. ~
~Vd = 0.
Considering two independent scalar (and real) functions ψTE
, we
take ~Vi = ∂xψTM
j ~ey. We thus obtain the
following representation of ~Fj in terms of scalar functions ψTE

~Vi = 0 and the second, ~Vd, divergenceless, i.e. ~

j ~ey and ~Vd = ∂yψTE

∇ ·
j and ψTM

j ~ex + ∂yψTM

j ~ex −

∂xψTE

∇ ×

:

j and ψTM

j

j

−
(cid:16)

(cid:17)

~Fj =

~ex

∂yψTE

j + ∂xψTM

j

+ ~ey

∂xψTE

j + ∂yψTM

j

.

(53)

h

(cid:16)

In the following it will be clear that ψTE
are physically related,
respectively, to transverse electric and transverse magnetic ﬁeld modes. At
the present time, however, these functions are only introduced for mathe-
matical convenience. In fact, by substitution in (48), the vectorial eigenvalue
problem for ~Fj can be reformulated in terms of the following scalar problem

(cid:17)i
j and ψTM
j

(54)

(55)

) + λTE,TM
j

ψTE,TM
j

(~r
⊥

) = 0

(~r
⊥

∇
~n

2

⊥

ψTE,TM
j
~
∇⊥
·
(cid:16)
ψTM
j

ψTE
j

S

(cid:17)
= 0 .
(cid:12)(cid:12)(cid:12)

= 0






(cid:16)

S

(cid:17)
(cid:12)(cid:12)(cid:12)

Boundary conditions in Eq. (54) do not allow for hybrid TE-TM modes, as
in the case of walls with ﬁnite resistance (see Section 7). In other words,
solutions ψTE
are not degenerate. This can be seen by inspection of
Eq. (54) 3 .

j and ψTM

j

It follows that the particular choice of boundary conditions allows a choice
of eigenvectors ~Fj diﬀerent from that in Eq. (53), that gives the same results
but allows separation of TE and TM modes:

~FTE
j
~FTM
j

= ~ex∂yψTE

j −
= ~ex∂xψTM

j

~ey∂xψTE
j

+ ~ey∂yψTM

j

.





3 In fact, suppose there exist two non-zero solutions ψTE
mon eigenvalue λ. One would have
2

sharing a com-
= 0
= 0. For this to be in agreement with Helmholtz’s equation
2
= 0 everywhere inside
= 0 on S it also must be zero everywhere, and

j
) = 0. However, on S, ψTM

and thus, on S,
⊥
in (54), one must have λ = 0, hence
the waveguide. Then, since ψTM
degeneracy is impossible.

j and ψTM

= 0 and

ψTM
j

ψTM
j

ψTE
j

ψTE
j

(ψTE

j −

∇

∇

∇

∇

⊥

⊥

⊥

2

2

j

j

25

We formally adopt this new eigenvector set, because this is compatible with
the following normalization condition for ψTE,TM

:

j

d~r
⊥

ψTE,TM
j

~
∇

= 1 .

ZS

(cid:12)(cid:12)(cid:12)(cid:12)

2

(cid:12)(cid:12)(cid:12)(cid:12)

The reason why the eigenvector set (55) and the normalization condition Eq.
(56) are desirable is only formal: this choice yields traditional results known
in literature for the eigenvalue problem (54) when a particular geometry of
the waveguide is ﬁxed, as in the next Section 4.

Solution of the problem (54) depends on the setup geometry and cannot be
further speciﬁed unless the surface S is given. Later on we will consider the
case of a circular waveguide. At this time we assume that the problem is
are ﬁxed. As a result ~Fj
solved in some particular geometry, and that ψTE,TM
Gαβ is completely speciﬁed. In
are known through Eq. (53) and the tensor
order to ﬁnd the tensor Green’s function, we should ﬁnd the inverse Laplace
transform of

Gαβ, that is

b

j

Gαβ(z, ~r
⊥

b
)

≡ L

δ+i

∞
Gαβ(p, ~r
⊥

1
−

Gαβ(p, ~r
⊥

)

(z) =

h

b

i

Zδ
i
∞ b
−

(cid:2)

(cid:3)

) exp

pz

dp .

(57)

Here δ is a real number positioned, on the complex plane, on the right-hand
side of all poles p j . These are located at

p j =

i

cλ j
2ω

,

−

as it can be seen by inspecting Eq. (52).

), we see that the dependence
G on p is only in the denominator of the right hand side of Eq. (52). As a
. It follows that Jordan’s lemma applies

From Eq. (52), and from the fact that ~Fj = ~Fj(~r
⊥
of
G
result,
b
and we obtain
b

0 uniformly as p

−→ ∞

−→

(56)

(58)

(59)

Gαβ =

Res

G exp(p jz)

j
X

n

h

b

where

αβ

io

26

Res

G exp[p jz]

αβ

=

(cid:16)

h

b

i(cid:17)

p

=

lim
icλj/(2ω)
→−
c
2iω

Fα

( 
~r
⊥

p +

icλ j
2ω

Fβ

~r′

⊥

(cid:17)

(cid:16)

Gαβ(p) exp[p jz]
)

!
b
exp

icλ j
2ω

z
#

−
"

(cid:1)
Substituting Eq. (53) in Eq. (60), and Eq. (60) in Eq. (59) we obtain the
following explicit expression for the tensor Green’s function

(cid:0)

(60)

G

, ~r′

~r
⊥

⊥

, z

=

(cid:16)

(cid:17)

c
2iω

j (
X
~ex ∂y′ψTE

j

exp

~r′

⊥

(cid:17)

(cid:16)
exp

icλTE
j
2ω

z


h

~ey ∂x′ψTE

j

−




−
icλTM
j
2ω

−


z


~r′

⊥

)
(cid:16)
~ex ∂xψTM

(cid:17)i

j

j (
X
~ex ∂x′ψTM

j



⊥

~r′

h


+ ~ey ∂y′ψTM

j

~r′

⊥

h

c
2iω

⊗

+

⊗

~ex ∂y ψTE
j

~r
⊥

−

~ey ∂xψTE
j

~r
⊥

(cid:0)

(cid:1)

(cid:0)

(cid:1)i

+ ~ey ∂y ψTM

j

~r
⊥

(cid:0)

(cid:1)i
(61)

~r
⊥

(cid:1)

(cid:0)

,

)

(cid:16)

(cid:16)
h
where notation
indicates the tensor product. It should be noted that the
result in Eq. (61) coincides with that obtained in [21] 4 . Once the tensor
Green’s function G is known, the slowly varying envelope of the electric
ﬁeld is given by

(cid:17)i

⊗

(cid:17)

Eα =

4πe
c

dz′

iω
c2 vβ

⊥

(z′)Gα
β

, ~r′

~r
⊥

⊥

(z′), z

−

z′

+ ∂′βGα

β

, ~r′

~r
⊥

⊥

(z′), z

z′

−

(cid:16)

(cid:17)

(cid:16)

(cid:17)(cid:27)

(62)

e

exp

×

iω
2c

d¯z
γ2
z(¯z)

,

(cid:26)
z′

Z0



Z
−∞

z





⊥

where we made explicit use of Eq. (2), and derivatives ∂′β are taken with
respect to ~r′

.

4 Numerical factor and sign diﬀerences are due to diﬀerent deﬁnitions for the
Green’s function used in [21] compared to the present paper. In that reference a
Green’s function is ﬁrst calculated starting with the rigorous solution for the eigen-
functions of the waveguide, without applying paraxial approximation. Only in
a second step such approximation is applied. In this paper instead, we directly
derive the paraxial Green’s function for an overmoded waveguide using approx-
imate boundary conditions on the waveguide walls (obtained by application of
the paraxial approximation) and a Laplace-transform technique. We thus directly
solve the initial value problem in paraxial approximation. The present derivation
is shorter and more straightforward than that in [21].

27

4 Green’s function for a circular waveguide

We now restrict our analysis to a particular geometry of the waveguide.
Namely, we select a circular cross-section of radius R. In order to explicitly
compute the tensor Green’s function in Eq. (61) we need to solve the problem
in (54) with this particular choice of geometry.

For both TE and TM modes, we need to solve Helmholtz’s equation. Be-
cause of the particular symmetry in the case of a circular waveguide, it is
convenient to use transverse polar coordinates so that ~r
is identiﬁed by
⊥
radial distance r =
x2 + y2 and angle φ = arctan(y/x). The equation set in
(54) yields

p

∂2
∂r2

+

1
r

∂
∂r

+

1
r2

∂2
∂φ2

"

#
with boundary conditions

ψTE,TM
j

+ λTE,TM
j

ψTE,TM
j

= 0 ,

= 0

and

ψTM
j

= 0 .

(cid:16)

r=R

(cid:17)
(cid:12)(cid:12)(cid:12)

Solutions of Eq. (63) are

= ATE,TM
mk

Jm

λTE,TM
mk

r

(cid:18) q

sin(mφ)

cos(mφ) 

,



(cid:19)





where the eigenvalues λTE,TM
speciﬁed by the TE and TM boundary conditions in (54).

and the normalization coeﬃcients ATE,TM

mk

mk

are

Switching to notation µmk ≡
νmk respectively as the roots of equations

λTE
mk R and νmk ≡

q

q

λTM
mk R one deﬁnes µmk and

∂ψTE
j
∂r 

r=R

(cid:12)(cid:12)(cid:12)

ψTE,TM
mk1
ψTE,TM
mk2













J′m

µmk

= 0

and equations
(cid:0)

(cid:1)

Jm (νmk) = 0 .

(63)

(64)

(65)

(66)

(67)

The correspondent normalization coeﬃcients for the TE and for the TM
modes are given by

28

This means that ﬁxing an eigenfunction Fj corresponds to the speciﬁcation
of two positive integers m
)
solution.

0 and k > 0, and either a sin(
·

) or a cos(
·

≥

We should now substitute Eq. (65) in the expression for the Green’s function,
Eq. (61). Before doing so, however, we need to express partial derivatives of
functions ψTE,TM
with respect to x and y in terms of partial derivatives with
j
respect to r =
x2 + y2 and φ = arctan(y/x). This can be done with the help
of relations

ATE

mk =

am
π

r

1

µ2

mk −

m2Jm(µmk)

q

and

ATM
mk

=

am
π

1
νmk Jm

r
with a0 = 1 and am = 2 for m

1(νmk)
−

1.

≥

∂
∂x

∂
∂y

and

and

p

∂
∂r −

= cos(φ)

sin(φ)

1
r

∂
∂φ

= sin(φ)

+ cos(φ)

∂
∂r

1
r

∂
∂φ

.

Jm (ξ) =

[Jm

1 (ξ) + Jm+1 (ξ)]
−

ξ
2m

dJm (ξ)
dξ

=

1
2

[Jm

1 (ξ)
−

−

Jm+1 (ξ)]

Using Eq. (70) and Eq. (71) and taking advantage of:

(68)

(69)

(70)

(71)

(72)

(73)

we obtain, from Eq. (61), the following expression for the tensor Green’s
function in the case of a circular waveguide:

29

G

, ~r′

~r
⊥

⊥

, z

−

z′

=

c
2iω

∞

∞

(cid:16)

Xk=1

−

(cid:17)

Jm

m=0
X
1(µmkr/R) cos[(m
−
Jm

1(µmkr/R) sin[(m
−
1(µmkr′/R) cos[(m
−
Jm

1(µmkr′/R) sin[(m
−
Jm

1(µmkr/R) sin[(m
−
1(µmkr/R) cos[(m
−
Jm

1(µmkr′/R) sin[(m
−
1(µmkr′/R) cos[(m
−
∞

Jm

Jm

∞

2

−

−

−

−

−

−
2

ATM
mk

νmk
2R

−
Jm

+

× 




⊗ 




⊗ 

+



−

−

−

−

−
c
2iω

(cid:19)

−

−

Jm

Jm

(cid:17)

(cid:16)

(cid:18)

Jm

m=0
X
Jm

Xk=1
1(νmkr/R) sin[(m
−
1(νmkr/R) cos[(m
−
1(νmkr′/R) sin[(m
−
1(νmkr′/R) cos[(m
−
Jm

1(νmkr/R) cos[(m
−
Jm

1(νmkr/R) sin[(m
−
1(νmkr′/R) cos[(m
−
Jm

1(νmkr′/R) sin[(m
−

−
Jm

−

−

−

−

−

−

−

+

× 




⊗ 




⊗ 



#







2

ATE
mk

2

µmk
2R

exp

ic(z
z′)
2ωR2 µ2
−

mk

(cid:18)

(cid:19)

(cid:17)

(cid:16)
1)φ] + Jm+1(µmkr/R) cos[(m + 1)φ]

−

"

1)φ] + Jm+1(µmkr/R) sin[(m + 1)φ] 

−
1)φ′] + Jm+1(µmkr′/R) cos[(m + 1)φ′]

1)φ′] + Jm+1(µmkr′/R) sin[(m + 1)φ′] 

1)φ]

Jm+1(µmkr/R) sin[(m + 1)φ]

1)φ] + Jm+1(µmkr/R) cos[(m + 1)φ] 

−

−

−
"

−

−

−

−

−

−

1)φ′]

Jm+1(µmkr′/R) sin[(m + 1)φ′]


1)φ′] + Jm+1(µmkr′/R) cos[(m + 1)φ′] 




ic(z
z′)
2ωR2 ν2
−

mk

exp

#
Jm+1(νmkr/R) sin[(m + 1)φ]

1)φ]

1)φ] + Jm+1(νmkr/R) cos[(m + 1)φ] 

1)φ′]

Jm+1(νmkr′/R) sin[(m + 1)φ′]

1)φ′] + Jm+1(νmkr′/R) cos[(m + 1)φ′] 

1)φ]

Jm+1(νmkr/R) cos[(m + 1)φ]

1)φ]

Jm+1(νmkr/R) sin[(m + 1)φ] 

1)φ′]

Jm+1(νmkr′/R) cos[(m + 1)φ′]

1)φ′]

Jm+1(νmkr′/R) sin[(m + 1)φ′] 







In order to verify the correctness of Eq. (74) we study the free-space limit, that
corresponds to the limit for large values of the waveguide radius R
.
−→ ∞

Since we are interested in characterizing the ﬁelds over a ﬁnite transverse
direction, and since sources have a ﬁnite transverse size, the limit R

−→
allows one to substitute Bessel functions in Eq. (68) and Eq. (69) with

∞
asymptotic expressions for k

1. First remember that

≫

.(74)







(75)

Jm(ξ)

2
πξ

cos

ξ

(cid:18)

≈

r

πm
2 −

π
4

−

(cid:19)

,

ξ

1 .

≫

One sees that Eq. (66) and Eq. (67) are satisﬁed by

30

(76)

(77)

(78)

(79)

(80)

µmk = π

+ k +

, νmk = π

+ k +

m
2

(cid:18)

1
4

(cid:19)

m
2

(cid:18)

,

3
4

(cid:19)

yielding

J2
m(µmk)

2
πµmk

,

≃

J2
m

1(νmk)
−

≃

2
πνmk

.

As a result we obtain

2

=

ATE
mk

am
2µmk

,

ATM
mk

2

=

am
2νmk

.

(cid:16)

(cid:17)

(cid:16)

(cid:17)

Substituting Eq. (78) in Eq. (74), posing ξ = πk/R and replacing the sum
over k in Eq. (74) with an integral over dξ we obtain, after cumbersome but
straightforward calculations:

G

r, r′, φ

φ′, z

z′

=

−

−

c
4iωπ

∞

∞

dξξ exp

ic(z

z′)

−
2ω

ξ2

#

−
"

Jm(ξr)Jm(ξr′)

(cid:17)
cos[m(φ

Z0

m=
X
−∞
φ′)]

sin[m(φ

φ′)]

sin[m(φ

φ′)]

cos[m(φ

φ′)] 

−

−

−

−

.



−





Eq. (79) can also be written as

G

r, r′, φ

φ′, z

z′

=

−

−

J0(ξr)J0(ξr′)

Jm(ξr)Jm(ξr′)

c
4iωπ

∞

Z0

+

c
2iωπ

(cid:17)
1 0



0 1 



cos[m(φ

Z0

m=1
X
φ′)]

−

0






dξξ exp

ic(z

z′)

−
2ω

ξ2

#

−
"

∞

∞

dξξ exp

ic(z

z′)

−
2ω

ξ2

#

−
"

0

cos[m(φ

φ′)] 

−

.



As before, z > z′. The integrals in dξ can be performed yielding

(cid:16)

×

(cid:16)

×

×

G

r, r′, φ

φ′, z

z′

=

−

−

(cid:16)

×

exp

i(r2 + r′
2c(z

2)ω
z′)

−

"

1
4π(z

−

1 0

0 1 

−

J0

∞

z′)

−
1
2π

m=1
X

ωrr′

c(z

 

−

z′)

i−

mJm

!
ωrr′

c(z

 

z′)

!

−

(cid:17)

# 




31

exp

×

i(r2 + r′
2c(z

2)ω
z′)

−

"

cos[m(φ

φ′)]

0

−

0

cos[m(φ

φ′)] 

−

(81)

Using the Anger-Jacobi expansion

# 


.



J0(ζ) + 2

i−

mJm(ζ) cos[m(φ

φ′)] = exp[

iζ cos(φ

φ′)]

−

−

−

(82)

∞

m=1
X

we ﬁnd that in free-space the tensor Green’s function Eq. (74) reduces, for
both vertical and horizontal polarization components, to the scalar Green’s
function in Eq. (6):

G =

1
4π(z

−

exp

~r
⊥ −
2c(z

~r′

2
⊥ |
z′)

−

,

#

iω|
"

z′)

−

as it must be.

(83)

5 Radiation of wiggled electron in circular waveguide

We now want to apply Eq. (74) and Eq. (62) to study the case of an undulator
in presence of a circular waveguide in the case of a planar undulator. As
we have seen before, the transverse electron velocity is taken along the hor-
izontal axis and is speciﬁed in Eq. (9). The longitudinal Lorentz factor γz(z)
is not constant, due to oscillatory motion of electrons along the longitudinal
axis. As a result, Eq. (11) holds. One must substitute Eq. (9) and Eq. (11) in
Eq. (62) to calculate the ﬁeld components with the help of Eq. (74).

≪

Eq. (62) has been derived under the paraxial approximation. In Section 2
we discussed the region of applicability of the paraxial approximation in
free-space, concluding that it can always be applied for ultra-relativistic
systems when 1/γ2
1. In Section 3 we extended our consideration to
the case when a waveguide is present. We concluded that, for an ultra-
relativistic system, the paraxial approximation holds when the waveguide
Ż. In the case of radiation of wiggled electrons this
is overmoded, i.e. R
condition is necessary but not suﬃcient. This can be seen straightforwardly
for our practical case of interest K & 1, with the help of a geometrical
argument. From Eq. (9) it may be seen that electrons wiggle with a wiggling
amplitude

≫

32

rw =

Żw =

K
γ

2KŻ ¯γz
√1 + K2/2

.

(84)

≫

≪

≫

1, leading to a similar conclusion. Namely, for K

Ż we can still discuss in
Ż. In fact, when R
We require R > rw & ¯γzŻ
general about an overmoded waveguide and, thus, about paraxial approx-
imation, but in order to discuss about radiation from a wiggled electron we
must impose that the waveguide radius is larger than the amplitude of the
wiggling motion. It is interesting to note that a diﬀerent reasoning holds for
K
1 we can deﬁne
an inertial frame moving with the same average longitudinal velocity of the
electron, characterized by the average longitudinal Lorentz factor ¯γz. In this
frame, the wiggling motion is non-relativistical and the undulator ﬁeld is
similar to that of an incoming plane wave with wavelength λw/γ. We are
actually dealing with a Thompson-scattering problem, where the electron
radiates as a dipole at frequency ω = cγ/Żw. Such frequency must be higher
c/R so that R & Żw/γ. For frequencies near
than the cutoﬀ frequency ωcutoﬀ
resonance this requirement translates to R & γŻ. As a result we may state,
Ż.
independently of K, that it makes sense to deal with the case R & ¯γzŻ

≪

∼

≫

As has been seen in Section 2 in the case of undulator radiation in free-space,
the resonance approximation constitutes a further approximation that can
be applied together with the paraxial one. We concluded that resonance
approximation allows simpliﬁcations by exploitation of the large parameter
Nw ≫
1. We also discussed how, for odd harmonics and when condition (23)
holds, further simpliﬁcations take place, allowing one to neglect gradient
term in the ﬁeld equation and constrained motion in the Green’s function,
giving a stronger type of resonance approximation. This strong resonance
approximation can be applied not only in free-space but also in the presence
of a waveguide, exactly as the paraxial approximation can. In the case of a
circular waveguide with radius R Eq. (74) must be taken as Green’s function
instead of the free-space Green’s function, Eq. (83). In the limit for Nw ≫
1
and when certain constraints on the parameter space are veriﬁed, similarly
as for the free-space case, one may neglect the gradient term in Eq. (62), as
well as the constrained particle motion in the Green’s function Eq. (74).

Let us discuss these simpliﬁcations in detail. We may use Anger-Jacobi
expansion to obtain from Eq. (62) a representation of the ﬁeld that is the
analogous of Eq. (20) in free-space. Namely, for any value k, the current
terms in the integrand in dz′ in Eq. (62) are proportional to

Fc(z′) =

exp[i(2p + 1

1)kwz′] exp

±

K
γ

cζ2
2ωR2

i
"

C +
 

z′

Jp (u)

!

#

Jm

1
±

×

 

ζr′(z′)
R

!

1(z′)
±

Sm

33

(85)

(86)

while the gradient terms are proportional to

Fg(z′) =

exp[i(2p + 1)kwz′] exp

cζ
ωR

cζ2
2ωR2

i
"

C +
 

z′

Jp (u)

!

#

Jm

×

 

ζr′(z′)
R

!

Sm(z′) ,

where ζ = µmk or ζ = νmk,
Sl can be either cos[lφ′(z′)] or sin[lφ′(z′)] and
parameter u has been deﬁned in Eq. (21). As one may see by inspection, the
role of the index p in Eq. (85) and Eq. (86) is the same as the role of m in Eq.
(20), while the role of the index m in Eq. (85) and Eq. (86) is similar to the
role of n in Eq. (20).

Comparison between Eq. (85) or Eq. (86) and the integrand in Eq. (20) shows
a striking similarity between the role of the observation angle θ in free-space
and, for each mode, of the quantity cζ/(ωR). This relation should not be
surprising. As we have seen at the beginning of Section 2.1, after expanding
the far-zone ﬁeld distribution in free-space in terms of plane waves one
sees that the transverse wave numbers of interest k
1, i.e.
⊥
the paraxial approximation can always be applied. In fact, the plane wave
components of the angular spectrum for which paraxial approximation is
applicable, are also the only relevant components of the spectrum, and are
those that can be seen at observation angles θ2
1. The quantity cζ/(ωR)
is the analogous of the free-space propagation angle of a spacial Fourier
component,~k
c/ω, that is allowed to vary continuously across the reciprocal
⊥
space. The diﬀerence with respect to the free-space case is in the presence
of a discrete number of modes, corresponding to a discrete range of values
that cζ/(ωR) may assume. All we have to do to show the applicability of the
resonance approximation is to rely on the analogy between θ and cζ/(ωR),
and to follow the same derivation for the free-space case.

obey k2
⊥

c2/ω2

≪

≪

First, as already said, Eq. (85) and Eq. (86) are analogous to the integrand of
Eq. (20).

Second, condition (22) can be stated, for each mode, as

C +

cζ2
2ωR2 ≪

kw ,

(87)

that allows to exploit the large parameter Nw ≫
exp[ikwz′] over a large number of undulator periods.

1 by averaging powers of

34

Third, condition (23) allowed to neglect constrained motion in the Green’s
function and gradient term in the ﬁeld equation in free-space. This enforced
the strong resonance approximation around the fundamental (and other
odd) harmonic. In the presence of a waveguide condition (23) remains un-
varied:

∆ω
|
|
ωr ≪

1 ,

i.e.

C
|

| ≪

kw .

(88)

(89)

(90)

≪

1/ ¯γ2

Note that this condition on frequencies automatically selects propagation
angles of interest c2ζ2/(2ωR2)
z. In fact, one can consider propagation
angles outside the range cζ2/(2ωR2)
z, but in this case Eq. (85) and Eq.
≪
(86) exhibit fast oscillations on the integration scale Lw because condition
(87) is no more fulﬁlled. As a result, with accuracy 1/Nw, one obtains zero
= 0. These remarks are analogous to the free-space case,
transverse ﬁeld,
discussed in Section 2.3. Also similarly to the free-space case, the argument
in the Bessel functions Jm
) in Eq. (85) and Eq. (86) is small for
propagation angles of interest cζ2/(2ωR2)

) and Jm(
·

1(
·
±

1/ ¯γ2

~
E

e

⊥

1/ ¯γ2
z :

≪

ζr′(z′)
R

.

ζrw
R

=

2 √2K
√2 + K2

cζ
Rω

¯γz ≪

1 .

1(
·
±

) and Jm(
·

This means that, independently of K, we may expand the Bessel functions
Jm
) in Eq. (85) and (86), exactly as we did in Section 2.3 with
Eq. (20). As for the free-space case, this expansion can be performed also
around even harmonics. However, for the ﬁrst (and odd) harmonic extra-
simpliﬁcations hold. Using the same kind of reasonings as in Section 2.3
and making explicit use of condition (88) we see that, after integration in
dz′ along a large number of undulator periods Nw ≫
1, the only surviving
contributions are of current type for m = 1 and either p =
1 or p = 0. It
reads:

−

Fc(z′) =

Jp(u) exp

i

C +

K
γ

c
2ωR2 ζ2

z′

.

(cid:20)

(cid:21)

(cid:18)

(cid:19)
kw, we can neglect, for the ﬁrst
C
When condition (88) is valid, i.e.
|
harmonic, gradient term and constrained motion in the Green’s function,
exactly as in the free-space case. Note that Eq. (90) is valid also for propa-
gation angles outside the region of interest cζ2/(2ωR2)
z. In this case
in fact, once the integration in dz′ is performed, one obtains a negligible
contribution to the ﬁeld, with accuracy 1/Nw.

1/ ¯γ2

| ≪

≪

Let us consider the propagation direction of interest cζ2/(2ωR2)
1/ ¯γ2
z.
It can be seen that, in order to obtain non-zero contributions, we may

≪

35

≫

≫

1 5 . Thus, our condition on the propagation directions of inter-
take ζ
∼
( ¯γzŻ)2. This condition should be stated together with
est becomes R2
the previously found constraint R2 & ( ¯γzŻ)2
Ż2, meaning that parax-
ial approximation can be applied and that we can discuss about wig-
gled electron motion. Note that we always deal with the small parame-
ter (Ż ¯γz)2/(ŻLw)
1, where ŻLw is the squared radiation diﬀrac-
1/Nw ≪
∼
tion size. It follows that we can discuss about both strong (R2 . ŻLw)
ŻLw) waveguide inﬂuence within the required condition
and weak (R2
≫
Ż2. It is also interesting to remind that in cases of practical
R2
interest (this is the case for the undulator beamline at FLASH) we have
K & 1, so that rw ≃
Summing up, Eq. (62) gives

(Ż ¯γz)2

2Ż ¯γz.

≫

≫

Eα =

2πeωθsAJJ
c2

dz′ exp[iCz′]Gα
1

Lw/2

Z
Lw/2

−

r′(z′)=0 ,
(cid:12)(cid:12)(cid:12)

where AJJ is deﬁned in Eq. (26), and G is given in Eq. (74). We obtain

(91)

Ex(r, φ, z) =

iωeθsAJJ
c2

−

∞

Xk=1 (cid:26)

µ
k (z)
A

ν
k(z)
A

Jo

µ1k

+ J2

µ1k

cos(2φ)

+

r
R

r
R

(cid:20)
Jo

(cid:18)
ν1k

(cid:20)

(cid:18)

(cid:19)

−

r
R

(cid:19)

J2

(cid:18)
ν1k

r
R

(cid:18)

(cid:19)

(cid:19)
cos(2φ)

(cid:21)

(92)

(cid:21)(cid:27)

e

e

and

Ey(r, φ, z) =

iωeθsAJJ
c2

−

∞

sin(2φ)

µ
k (z)J2
A

µ1k

ν
k(z)J2
− A

r
R

(cid:19)

ν1k

r
R

(cid:18)

(cid:19)(cid:27)

.(93)

Xk=1 (cid:26)

(cid:18)

e
where

µ
k (z) and
A

ν
k(z) are given by
A

5 From the phase factor in Eq. (62) we see that there is a maximal integration length
of interest, characteristic of any system, after which the integrand of Eq. (62) exhibits
oscillatory behavior. This length is the formation length for the system in free space,
L f . Once L f is known, from the phase factor in (z
z′) in Eq. (74) follows that there is
an upper limit to the values of ζ giving non-negligible contributions (with a certain
ﬁxed accuracy) to the ﬁeld. In fact, above a certain value of ζ the exponential
functions in (z
z′) in Eq. (74) show strongly oscillating behavior in the integration
variable z′. This upper value is estimated as the ratio between the pipe radius R
ŻL f . We conclude that values
ŻL f , that is R/
and the radiation diﬀraction size
ŻL f . This also mean that, in calculations, the
of interest for ζ are up to order R/
p
ŻL f .
maximal number kmax of modes of interest should be taken as as kmax ≫
p

R/

p

−

−

36

p

(94)

(95)

(96)

(98)

µ
A

k (z) =

k exp[

Cµ
(µ2

iCµ
k z]
−
1)J2
1(µ1k)

1k −

Lwsinc

Cµ
k

+ C

Lw
2

(cid:20)

(cid:16)

(cid:17)(cid:21)

k(z) =

ν
A

Cν

k exp[
1kJ2
ν2

iCν
−
0(ν1k)

kz]

Lwsinc

Cν
k

+ C

,

Lw
2

(cid:20)

(cid:16)

(cid:17)(cid:21)

and

where

Cµ
k

=

µ2
1kc
2ωR2 , Cν

k

=

ν2
1kc
2ωR2 .

Note that each mode propagates according to an exponential law in z, as
speciﬁed in Eq. (94) and Eq. (95). The ﬁeld can be propagated forwards
or backwards, changing the sign of z. The ﬁeld at position z = 0 can be
interpreted as radiation from a virtual source placed in the undulator center
and producing a laser-like beam, similarly as in the free-space case.

As before, it is instructive to study the free-space limit. Proceeding as in the
previous Section 4, i.e. using asymptotic expressions for J2
0(ν1k),
and substituting the summation over k with an integral in dξ, with ξ = πk/R,
we obtain the following free-space limit for the horizontal ﬁeld component:

1(µ1k) and J2

Ex(z, r, C) =

dξ ξsinc

Jo(rξ) exp

iAJJeθsLw
2c

−

∞

Z0

Lw
2

"

C +
 

ξ2c
2ω

!#

e

iξ2cz
2ω

−
"

.

#
(97)

The integral in Eq. (97) can be solved analytically at perfect resonance (C = 0)
and for z = 0:

Ex(0, r, 0) =

iAJJeθsω
2c2

−

2Si

π
"

−

r2ω
Lwc

 

!#

.

e

Position z = 0 is in the center of the undulator. The meaning of Eq. (98) is,
in fact, that of the ﬁeld distribution of a virtual source located in the middle
of the setup discussed in Eq. (30) of Section 2.4. Similar reasoning applied
to the vertical component gives back zero, that is in agreement with the fact
that the free-space ﬁeld from a planar undulator (with vertical magnetic
ﬁeld) is horizontally polarized.

In free-space, under the applicability of the strong resonance approxima-
tion (condition (23)), one obtains a horizontally polarized ﬁeld that is also

37

azimuthal symmetric. This is not the case when one is working under the
applicability of analogous approximation in the presence of a waveguide
(condition (88)). The presence of a waveguide alters boundary conditions of
the problem, that are now formulated mixing horizontal and vertical polar-
ization components (see Eq. (36)), thus destroying horizontal polarization
and azimuthal symmetry.

To conclude this Section we mention that in Appendix A we present a
derivation of the ﬁeld in the case of a helical undulator. Comparison with
the planar undulator case, that we just treated, yields immediately

Eα =

AJJ
2

Eα

+ +

Eα
−

,

(cid:16)

(cid:17)

e

e

Eα
±

e
where
are the ﬁelds from electrons rotating in opposite directions in a
helical undulator, as deﬁned in Appendix A. Eq. (99) means that the ﬁeld
from a planar undulator can be seen as a superposition of ﬁelds from two
helical undulators where electrons follow clockwise and counterclockwise
trajectories.

e

6 Analysis of results (Exempliﬁcations)

We now analyze our main results, Eq. (92) and Eq. (93). To this purpose, it
is convenient to introduce the following normalized units:

⊥

=

~ˆE

c2
AJJωeθs !
−
 
ˆC = CLw = 2πNw

~
E

⊥
∆ω
e
ωr

z
Lw

ˆz =

ˆr =

Ω =

r
√LwŻ
R2
LwŻ
= Cµ

ˆCµ
k

k Lw =

ˆCν
k

= Cν

kLw =

µ2
1k
2Ω
ν2
1k
2Ω

.

We may write Eq. (92) and Eq. (93) in normalized units as

38

(99)

(100)

ˆEx(ˆr, φ, ˆz) = i

∞

Xk=1 (
+

µ
k (ˆz)
A

ν
k(ˆz)
A

µ1k ˆr
√Ω
ν1k ˆr
√Ω

!

Jo

"

 

Jo

"

 

+ J2

J2

−

!

µ1k ˆr
√Ω
ν1k ˆr
√Ω

 

 

!

cos(2φ)
#

!

cos(2φ)

#)

(101)

(103)

(104)

and

and

ˆEy(ˆr, φ, ˆz) = i

∞

µ
k (ˆz)J2
A

µ1k ˆr
√Ω

 

!

ν
k(ˆz)J2
− A

ν1k ˆr
√Ω

 

!)

Xk=1 (

µ
k (z) and
A

ν
k(z) can similarly be expressed as
A

sin(2φ) .

(102)

µ
A

k (ˆz) =

k exp[

ˆCµ
(µ2

i ˆCµ
k ˆz]
−
1)J2
1(µ1k)

1k −

sinc

ˆCµ
k

+ ˆC

1
2

(cid:20)

(cid:16)

(cid:17)(cid:21)

k(ˆz) =

ν
A

ˆCν

k exp[
ν2
1kJ2

i ˆCν
−
0(ν1k)

k ˆz]

sinc

ˆCν
k

+ ˆC

.

1
2

(cid:20)

(cid:16)

(cid:17)(cid:21)

µ,ν
k
A

+ ˆC or ˆCν
k

) functions in the expressions for

is a direct conse-
Note that the sinc(
·
quence of our model of the undulator, where the magnetic ﬁeld is instanta-
neously switched on and oﬀ, at positions ˆz =
1/2 and ˆz = 1/2 respectively.
−
In fact, the sinc(
) functions are Fourier transforms of a rectangular function
·
with respect to ˆCµ
+ ˆC, modelling the instantaneous switch on and
k
switch oﬀ of the undulator ﬁeld. The presence of high frequency compo-
nents in the rectangular function implies the presence of contributions with
high values of k. In its turn, the sum over k in Eq. (74) can be interpreted as
a superposition of plane waves propagating at angles µ1k/ √Ω (or ν1k/ √Ω)
in units of the diﬀraction angle √Ż/Lw. Thus, higher values of k correspond
to the introduction of high spatial frequency components in the expressions
for the ﬁeld, Eq. (101) and Eq. (102).

However, we should account for the fact that our theory applies with a ﬁnite
accuracy related to the use of the resonance approximation. When using
this approximation we neglect contributions to the ﬁeld with an accuracy
of order 1/Nw. The instantaneous switch on and switch oﬀ is also valid with
this accuracy. This means that, in the analysis of our results, it does not
make sense to consider high spatial frequency contributions due to abrupt
switching of the undulator ﬁelds on a scale shorter than the undulator period
λw, because these are outside of the accuracy of the paraxial approximation.

39

We may introduce a spatial frequency ﬁlter in our expression for the ﬁeld
by replacing Eq. (91) with

Eα =

2πeωθsAJJ
c2

∞

Z
−∞

e

(cid:12)(cid:12)(cid:12)

dz′ exp[iCz′]S(z′)Gα
1

,

r′(z′)=0

(105)

where the function S(z′) introduces some smoothing of the rectangular un-
dulator proﬁle on a scale of λw. In normalized units Eq. (105) reads

∞

−

2π

ˆEα =

dz′ exp[i ˆCˆz′]S(ˆz′)Gα
1

ˆr′(ˆz′)=0 .
(cid:12)(cid:12)(cid:12)
We model S(ˆz′) as a constant function along the undulator length with
exponentially decaying edges on a typical distance ∆:

(106)

Z
−∞

exp

(ˆz′ + 1/2)2/(2∆2)

for ˆz′ <

1/2

−

1

(cid:3)
1/2)2/(2∆2)

−
for ˆz′ > 1/2

for

1/2 < ˆz′ < 1/2

.

(107)

S(ˆz′) = 

−

(cid:2)

(cid:2)




exp

(ˆz′

−

−

It follows that Eq. (103) and Eq. (104) should be replaced by

(cid:3)

µ
A

k (ˆz) =

k exp[

ˆCµ
(µ2

i ˆCµ
k ˆz]
−
1)J2
1(µ1k)F

1k −

S(ˆz′),

ˆCµ
k

+ ˆC

n

(cid:16)

(cid:17)o

and

k(ˆz) =

ν
A

ˆCν

k exp[
ν2
1kJ2

k ˆz]

i ˆCν
−
0(ν1k) F

S(ˆz′),

ˆCν
k

+ ˆC

,

n

(cid:16)

(cid:17)o

(108)

(109)

S(ˆz′), ( ˆCµ,ν
k

+ ˆC)
}

is the Fourier transform of the function S with
where
F {
respect to ( ˆCµ,ν
+ ˆC). The introduction of the function S(ˆz′) introduces a sup-
k
S
, and corresponds to a
pression of higher frequency components of
}
suppression of higher spacial frequencies in the ﬁeld distribution, i.e. to a
smoother ﬁeld distribution. For a ﬁxed value of Ω and ˆz we qualitatively
expect a smoother ﬁeld distribution for ﬁnite values of ∆ compared to the
hard-edge limit for ∆
1. Note that the level of high spacial frequencies
depends in a complicated way on Ω, because the perfectly metallic waveg-
uide eﬀectively acts as a mirror. The value of ∆ should be actually chosen to

F {

≪

40

S

1,0

S

1,0

0,8

0,8

0,6

0,6

0,4

0,4

0,2

0,2

0,0

0,0

0,9

0,9

0,6

0,6

0,3

0,3

0,0

0,0

-1,0

-0,5

0,0

0,5

1,0

-1,0

-0,5

0,0

0,5

1,0

^

z’

(a)

(b)

^

z’

 

F

{S}

 

F

{S}

1,2

1,2

-0,3

-0,3

-30

-15

0

15

30

-30

-15

0

15

30

(c)

(d)

Fig. 3. Comparison between hard-edge undulator case and high-frequency ﬁltering.
Function S(ˆz′) in the hard-edge case with ∆ = 0 (a) and in the case when ﬁltering is
+ ˆC
applied with ∆ = 0.1 (b). Their Fourier transforms
are plot in (c) for the hard edge case and in (d) when ﬁltering is present.

with respect to ξ = ˆCµ,ν
k

F {

S

}

cut oﬀ high spatial frequencies that are outside the region of applicability
of the resonance approximation, i.e. ∆
1/Nw. Thus, the correct value of ∆
depends, case by case, on the type of setup considered. The Fourier trans-
form of the function S(ˆz′) in Eq. (107) to be inserted into Eq. (108) and into
Eq. (109) reads

∼

F

S(ˆz′),

ˆCν,µ
k

+ ˆC

= sinc

ˆCν,µ
k

+ ˆC

+ √2π ∆ exp

(cid:17)o
+ ˆC

ˆCν,µ
k

n

×

(cid:16)
cos

1
2

(

(cid:20)

(cid:16)

−

(cid:17)(cid:21)

(cid:16)
1
2

(cid:20)

(cid:16)

(cid:17)(cid:21)
+ ˆC

ˆCν,µ
k

erﬁ

(cid:17)(cid:21)

∆
√2

"

(cid:16)

1
2

(cid:20)
sin

∆2
2

(cid:16)
+ ˆC

−
"
ˆCν,µ
k

2

ˆCν,µ
k

+ ˆC

#
(cid:17)
(110)

.

#)
(cid:17)

where the imaginary error function erﬁ(
·

) is deﬁned as

erﬁ (z) =

erf(iz) =

1
i

2
i √π

iz

Z0

exp [

t2]dt .

−

(111)

for ∆ = 0.1 and
Fig. 3 presents a comparison between functions S and
∆ = 0, the latter case describing an undulator with hard edges. A ﬁltering
eﬀect can be clearly seen, suppressing higher frequency components of
S
.
}

S
}

F {

F {

41

Hard-Edge Case

X-polarization

Y-polarization

Iˆ

2

1

0

Iˆ

1

2

0.75
0.5
0.25

0

-2
-2

-2
-2

0

yˆ

-2

0
0

xˆ

2
2

0
0

xˆ

-2

2
2

2

0

yˆ

Fig. 4. Three-dimensional view of the virtual source in the free-space limit for ∆ = 0
(hard-edge case) and ˆC = 0 (perfect resonance) .

≫

Eq. (101) and Eq. (102) completely describe radiation from a planar undu-
lator in the presence of a circular waveguide. The limit for Ω
1 can be
taken as free-space limit, and allows one to compute the free-space case as
a ﬁnite sum of modes, that is in an alternative way with respect to the cal-
culation of integrals in [16]. Position ˆz = 0 corresponds to the virtual source
discussed at the end of Section 2.4. The concept of laser-like radiation beam
can in fact be naturally extended to the case a waveguide is present. Only,
diﬀerent boundary conditions have to be accounted for. Mathematically this
means that propagation of the laser-like source must be performed with the
2iω/c,
proper Green’s function, Eq. (74) multiplied by the numerical factor
rather than with the free-space Green’s function, Eq. (83) (also multiplied
2iω/c). As said before one must carefully select the number of modes
by
√Ω. In Fig. 4 we show a three-
used for computation, according to k
dimensional view of the virtual source in the free-space limit for ∆ = 0 and
ˆC = 0. We plot ˆI =
2 for both horizontal (x) and vertical (y) polarization
|
components as a function of ˆx and ˆy, deﬁned by ~ˆr = ˆx ~ex + ˆy ~ey.

ˆE
|

≫

−

−

We set ˆC = 0 (perfect resonance). In Fig. 5 we show a comparison between
the analytic expression for the intensity distribution ˆI at the virtual source
position, that is obtained from a the normalized version of Eq. (30), and
numerical expressions obtained through Eq. (101) for diﬀerent values of
∆ at Ω = 1000 and Ω = 100. A 2D plot is obtained by cutting the 3D
intensity proﬁle at ˆy = 0 (i.e. at φ = 0). Only the horizontal polarization
component is important in this case. The importance of high-frequency
ﬁltering becomes clear in the case for Ω = 100 and ∆ = 0 or ∆ = 0.001.
In general, the smaller the value of Ω, the more ﬁltering becomes relevant.
Diﬀerences between results for ∆ = 0 and ∆ = 0.001 should be taken as

42

^^
^^

I
I

x
x

^^

I

x

2,5

2,5

=0

=0.001

2,0

2,0

1,5

1,5

1,0

1,0

0,5

0,5

0,0

r

0,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

2,5

2,5

=0.01

=0.1

2,0

2,0

1,5

1,5

1,0

1,0

0,5

0,5

0,0

r

0,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

^^
^^

I
I

x
x

^^

I

x

^

r

^

r

 

 

 

 

 

 

 

 

r

^

r

r

^

r

Fig. 5. Intensity proﬁles of the virtual source (ˆz = 0) at large values of Ω = R2/(ŻLw)
for diﬀerent values of ∆ and ˆC = 0 (perfect resonance). This 2D plot is obtained
cutting the 3D intensity proﬁle at ˆy = 0 (i.e. at φ = 0). The solid line is obtained
with the help of Eq. (30).

exempliﬁcation of the ﬁltering process. However, they are irrelevant from
a practical viewpoint. For example, if the number of undulator periods is
of order 100, high frequency components for ∆ = 0.001 or ∆ = 0 will not be
distinguishable and, in fact, fall outside of the region of applicability of the
resonance approximation.

ˆE
|

The behavior of the intensity proﬁle is shown in Fig. 6 for ∆ = 0.1 and in
Fig. 7 for ∆ = 0.001, where ˆI =
2 is plot for both the horizontal (Eq. (101))
|
and vertical (Eq. (102)) polarization components at ˆz = 0. The number of
modes used in all plots are in all cases much larger than √Ω. Furthermore,
we veriﬁed that results do not change by changing the number of modes
√Ω is fulﬁlled.
used in the computation, provided that condition kmax ≫
Comparison of Fig. 6 and Fig. 7 clearly shows the eﬀect of diﬀerent edge
dimensions. Note that in the free-space case, the horizontally polarized ﬁeld
is azimuthal symmetric. The situation becomes more complicated when the
inﬂuence of the waveguide begins to be important, i.e. for values of Ω
comparable with unity. In this case the ﬁeld presents both horizontal and
vertical polarization components, and azimuthal symmetry is lost, as is easy
to see from ﬁgures and by inspection of Eq. (101) and Eq. (102).

The knowledge of Eq. (101) and Eq. (102) solves the problem of charac-

43

Fig. 6. Intensity proﬁles of the virtual source (ˆz = 0) at diﬀerent values of
Ω = R2/(ŻLw) for ∆ = 0.1 and ˆC = 0 (perfect resonance).

terizing planar undulator radiation in the presence of a circular vacuum
pipe. Depending on the application one may use these equations in diﬀer-
ent ways. For example, one can propagate radiation in the presence of a
vacuum pipe with a certain radius up to a given distance down the beam-
line and subsequently propagate the electric ﬁeld distribution in free-space
with the help of Eq. (83) (or with the help of Fourier codes like ZEMAX
[22]). One may also account for changes of the waveguide radius by further

44

Fig. 7. Intensity proﬁles of the virtual source (ˆz = 0) at diﬀerent values of
Ω = R2/(ŻLw) for ∆ = 0.001 and ˆC = 0 (perfect resonance).

solving the initial value problem for the ﬁeld with the help of the proper
Green’s function, that will be proportional to Eq. (74). In principle one may
even account for diﬀerent geometries of the pipe, passing from a section
of the beamline to another one, by investigating diﬀerent eigenvalue prob-
lems with respect to that for a circular pipe considered here. Many are the
possibility of application of our theory. However, due to loss of azimuthal
symmetry it is not easy to directly investigate the ﬁeld distribution, because

45

plots of the ﬁeld forcefully become three-dimensional, as we have just seen.

It is thus worth to focus on ﬁnding ﬁgure of merits describing the inﬂuence
of the pipe, that can give designers and scientists some measure of the
inﬂuence of the waveguide in the stage of beamline design or planning of
experiments.

One ﬁgure of merit of interest is the ratio between the power density for
a speciﬁc value of Ω integrated over the waveguide cross-section and the
angle-integrated power density in free space:

(112)

ˆW =

d~ˆr
⊥

(Ω)

⊥

Z

,  Z

~ˆE
(cid:12)(cid:12)(cid:12)(cid:12)

2

(cid:12)(cid:12)(cid:12)(cid:12)

d~ˆr
⊥

lim
Ω
→∞

2

~ˆE

⊥

.

!

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

When calculating the denominator in Eq. (112) we should introduce the
same high-frequency cutoﬀ, ∆, introduced for the numerator. This means
that we substitute Eq. (108) and Eq. (109) (with S(ˆz′) deﬁned in Eq. (107)) in
and we integrate in d~ˆr
Eq. (101) and Eq. (102), we take the limit for Ω
⊥
on a transverse plane at any ﬁxed position ˆz, the result being independent
of ˆz. In particular we choose to integrate the far-zone distribution and we
make use of the deﬁnition ~ˆθ
we obtain:

/ˆz. Calling D the denominator in Eq. (112)

−→ ∞

~ˆr
⊥

≡

D =

d~ˆr
⊥

~ˆE

⊥

lim
Ω
→∞

∞

2

=

π
2

d ˆθ ˆθ

sinc

ˆθ2
4

Z

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

Z0

!
ˆθ2∆
2 √2 !
The case for ∆ = 0 can be calculated analytically as:

+ √2π∆ exp

∆2 ˆθ4
8

(
ˆθ2
4

−
"

erﬁ

cos

# "

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

−

!

 

 

 

2

.

sin

ˆθ2
4

 

!#)

D =

d ˆθ ˆθsinc2

π
2

∞

Z0

ˆθ2
4

 

!

=

π2
2

,

that also follows from a normalized version of Eq. (35). Numerical integra-
5.81 for ∆ = 0.1, that are cases
tion gives D
considered in this paper. It remains to calculate

5.02 for ∆ = 0.01 and D

≃

≃

(113)

(114)

(115)

2

(Ω)

=

2π

√Ω

dφ

dˆrˆr

Z0

Z0

d~ˆr
⊥

Z

⊥

~ˆE
(cid:12)(cid:12)(cid:12)(cid:12)

(cid:12)(cid:12)(cid:12)(cid:12)

2

+

2

!

~ˆEy(Ω)
(cid:12)(cid:12)(cid:12)(cid:12)
(cid:12)(cid:12)(cid:12)(cid:12)

~ˆEx(Ω)
 (cid:12)(cid:12)(cid:12)(cid:12)
(cid:12)(cid:12)(cid:12)(cid:12)

46

In order to calculate the square modulus in Eq. (115) one has to compute the
square modulus of an inﬁnite sum in k. It can be shown that cross terms of
this sum involving both TE and TM modes or diﬀerent values of k vanish.
One thus ﬁnds the result

(Ω)

= 2π

d~ˆr
⊥

Z

⊥

~ˆE
(cid:12)(cid:12)(cid:12)(cid:12)

2

(cid:12)(cid:12)(cid:12)(cid:12)

k=

∞

(cid:12)(cid:12)(cid:12)



Xk=1
k=



Xk=1

∞

+2π

√Ω

2

µ
k
A

(cid:12)(cid:12)(cid:12)

Z0

2

√Ω

ν
k
A
(cid:12)(cid:12)(cid:12)

(cid:12)(cid:12)(cid:12)






dˆrˆr

J2
o

µ1k ˆr
√Ω

+ J2
2

µ1k ˆr
√Ω

"

 

!

 

!#

dˆrˆr

J2
o

ν1k ˆr
√Ω

+ J2
2

ν1k ˆr
√Ω

Z0

"

 

!

 

(116)






!#






Integrals in Eq. (116) can be calculated analytically. Further using the fact
that ν1k is the k-th root of the Bessel function J1(
·

) we obtain

2

µ
k
A

h
2

(cid:12)(cid:12)(cid:12)
ν
k
A

ˆW =

∞

πΩ
D

∞

k=

+

πΩ
D

Xk=1 (cid:26)(cid:12)(cid:12)(cid:12)
Xk=1 (cid:26)(cid:12)(cid:12)(cid:12)
µ
k (z) and
A

J2
o (µ1k) + J1(µ1k)

J1(µ1k)

J3(µ1k)

+ J2

2(µ1k)

−

(cid:3)

i(cid:27)

(117)

o (ν1k) + J2
J2

(cid:2)
2(ν1k)

,

i(cid:27)

h

where
deﬁned in Eq. (113). One may now study, for a given value ∆
∼
for a certain number of undulator periods, the dependence of
waveguide parameter Ω or on the detuning parameter ˆC.

(cid:12)(cid:12)(cid:12)
ν
k(z) are given in Eq. (108) and Eq. (109), while D is
A
1/Nw, i.e.
ˆW on the

2

µ,ν
k
A

First we set ˆC = 0 and we plot, in Fig. 8, the function ˆW(Ω) for diﬀerent
values of ∆ ranging from 0 to 0.1. It is seen that edge eﬀects, that are very
important in the intensity distribution, can be seen as a translation in Ω
ˆW(Ω). Note that the dependence on
when it comes to the ﬁgure of merit
is of the form sin2
ν2
1k/(4Ω)
Ω in the coeﬃcients
for ˆC = 0, ∆ = 0 and ˆz = 0. This expression is then multiplied by Ω in Eq.
i
(117). Thus ˆW must go to zero as Ω
0. However, for small values of
Ω, only a few waveguide modes are excited. One thus expects oscillations
in ˆW(Ω). In particular when µ2
11/(4Ω) = π, i.e. at Ω = 0.27 (µ11 = 1.84), we
expect a value of ˆW close to zero (not shown in Fig. 8). The ﬁrst maximum
of Ω sin2
, for values Ω > 0.27 corresponds to Ω = 0.73. The shift
at higher values of Ω in Fig. 8 is ascribed to contributions from other modes.

µ2
1k/(4Ω)
i

or sin2

−→

(cid:12)(cid:12)(cid:12)

(cid:12)(cid:12)(cid:12)

h

h

µ2
11/(4Ω)
i

h

Another possibility is to set a certain value for Ω and to plot the function
ˆW( ˆC) for diﬀerent values of ∆. Since ∆
1/Nw it does not make sense to
consider values ˆC & 1/∆, because they are outside of the region of appli-

∼

47

 

 

 

^

W

1,2

1,0

0,8

0,6

0,4

0,2

0,0

0

1

2

3

4

5

6

7

8

^

C=0

Fig. 8. Plot of
resonance) at diﬀerent values of ∆.

ˆW as in Eq. (117) as a function of Ω = R2/(ŻLw) for ˆC = 0 (perfect

cability of the resonance approximation. This explains the range of ˆC in
Fig. 9 and Fig. 10. In particular we ﬁxed Ω = 2.0 and we plot the case for
∆ = 0.1 in Fig. 9 and values for ∆ = 0.01 and ∆ = 0 in Fig. 10. It is interesting
to remark the characteristic behavior in Fig. 10, where one can distinguish
peaks at certain values of ˆC. These peaks correspond to those values of ˆC
such that ˆCµ,ν
+ ˆC = 0. At these values, the k-th TE or TM mode is at reso-
k
ˆC
increases, because diﬀerent
nance. Contrast of peaks becomes better as
|
|
resonances are further away and peaks overlap less. For larger values of Ω,
as the number of excited modes increases, overlapping between diﬀerent
resonances hides the peaks, and one has the free-space limit (also shown for
comparison in Fig. 10). Note that by deﬁnition of ˆW, the integrated power
density is normalized to the angle-integrated power density in free-space at
resonance, i.e. at ˆC = 0. This explains why ˆW = 1 at ˆC = 0 in Fig. 10.

Finally, we may asses the inﬂuence of the waveguide on the output radiation
by comparing the modulus of the vertical electric ﬁeld for diﬀerent values
of Ω with the modulus of the horizontally polarized ﬁeld in free-space. In
fact, as has been said before, the presence of boundary conditions diﬀerent
from those of free-space destroy the horizontal polarization as well as the

48

^

W

2

1

0

-4

-2

0

2

4

^

C

=2.0,  =0.1

Fig. 9. Plot of
∆ = 0.1.

ˆW as in Eq. (117) as a function of ˆC = 2πNw∆ω/ωr for Ω = 2.0 at

azimuthal symmetry of the undulator radiation. Vertical and horizontal
ﬁeld are to be considered as functions of the distance from the z axis. Since
the modulus of the vertical electric ﬁeld is not azimuthal symmetric we take
a cut in the direction where it is maximal, i.e. at φ = π/4, as it can be seen
inspecting Eq. (102). As done before we limit our analysis for exempliﬁcation
purposes to the case z = 0. We are thus interested in the functions Px and Py
respectively deﬁned as

Px(ˆr) = Abs

ˆEx (ˆr, 0, 0)

.

Ω

−→∞

and

h

Py(ˆr, Ω) = Abs

ˆr,

, 0

.

i

(cid:12)(cid:12)(cid:12)

π
4

ˆEy
(cid:20)

(cid:18)

Ω

(cid:19)(cid:21)
(cid:12)(cid:12)(cid:12)

We studied Py as a function of ˆr for diﬀerent values of Ω and diﬀerent values
of ∆. We set ˆC = 0. Comparisons with Px (studied at Ω = 1000) as a function
of ˆr at diﬀerent values of ∆ are presented in Fig. 11 for ∆ = 0.1, Fig. 12 for

49

(118)

(119)

 

 

 Free-space, 

^

W

4

3

2

1

0

-60

-40

-20

0

20

^

C

Fig. 10. Plot of
diﬀerent values of ∆ = 0.01 and ∆ = 0. The far-ﬁeld limit (Ω
for comparison (dotted line).

ˆW as in Eq. (117) as a function of ˆC = 2πNw∆ω/ωr for Ω = 2.0 at
) is also shown

−→ ∞

∆ = 0.01 and Fig. 13 for ∆ = 0 at diﬀerent values of Ω. Note that the maximal
value of ˆr is √Ω, and is due to the fact that the pipe poses a geometrical
limit to the transverse region of interest. Figures underline the role of the
vertical polarization component of the ﬁeld for values of Ω around unity.
Thus, the level of the vertical polarization component of the ﬁeld compared
with that of the horizontal polarization gives a measure of the waveguide
inﬂuence.

As it is clear by inspection of Eq. (92) and Eq. (93), our method allows
straightforwardly to study the evolution of the radiation pulse after the
undulator, provided that the pipe section remains unvaried. In Fig. 14 we
show the evolution of the intensity proﬁle as a function of the normalized
distance from the center of the undulator ˆz. We take Ω = 2.0, ˆC = 0 and
∆ = 0.1.

To conclude this Section we estimate the range of parameters of interest
in the case of the infrared undulator beamline at FLASH. The wavelength
range is between 50 µm and 200 µm. The radius of the vacuum pipe is
R = 1.8 cm, the number of undulator periods Nw = 9 with a period length
λw = 40 cm, yielding Lw = 3.6 m. Note that the K parameter is always
much larger than unity, increasing when the wavelength is increased by

50

 P

y

 P

x

^

r

^

r

^

r

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

0,0

0,1

0,2

0,3

0,4

0,5

0,6

0,7

0,0

0,2

0,4

0,6

0,8

1,0

=0.5

=1

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

0,0

0,5

1,0

1,5

2,0

=2

=5

0,0

0,5

1,0

1,5

2,0

2,5

3,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

3,5

4,0

=10

=100

Fig. 11. Comparison of Px as deﬁned in Eq. (118) (dotted line) and Py as deﬁned
in Eq. (119) (solid line) for ∆ = 0.1 at diﬀerent values of Ω = R2/(ŻLw) and ˆC = 0
(perfect resonance). Plots refer to the virtual source position (ˆz = 0).

ramping up the magnetic ﬁeld in the undulator (K = 20
40 in the THz-
÷
gap operation range). This set of parameters means ∆
1/Nw ∼
0.1 and
3 . Ω . 10. As it can be seen in Fig. 6 and 11, for ∆ = 0.1 in the short
wavelength limit (Ω
10) the vacuum chamber has a small inﬂuence on
the ﬁeld distribution and polarization. A strong inﬂuence is visible, instead,
in the long wavelength range (Ω
3). Finally, from Fig. 8 we see that the
total power at perfect resonance ( ˆC = 0) is practically independent of the
wavelength in our range of interest.

≃

∼

≃

7 Wall-resistance eﬀects

Up to now we studied the problem of undulator radiation in a waveguide
.
assuming perfectly conducting walls, i.e. inﬁnite conductivity σ
−→ ∞

CASE 

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

^

r

^

r

^

r

51

 P

y

 P

x

^

r

^

r

^

r

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

0,0

0,1

0,2

0,3

0,4

0,5

0,6

0,7

0,0

0,2

0,4

0,6

0,8

1,0

=0.5

=1

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

0,0

0,5

1,0

1,5

2,0

=2

=5

0,0

0,5

1,0

1,5

2,0

2,5

3,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

3,5

4,0

=10

=100

Fig. 12. Comparison of Px as deﬁned in Eq. (118) (dotted line) and Py as deﬁned
in Eq. (119) (solid line) for ∆ = 0.01 at diﬀerent values of Ω = R2/(ŻLw) and ˆC = 0
(perfect resonance). Plots refer to the virtual source position (ˆz = 0).

In this Section we follow the approach proposed in [21] to describe the
case when the refractive index of the walls is still mainly deﬁned by the
conductivity σ (i.e. we are still dealing with a metal), but σ has a ﬁnite value.
We will conclude that in practical situations of interest, the presence of wall-
resistance eﬀects introduce important changes to the theory for perfectly
conductive walls.

Let us start our investigations with Maxwell’s equations in the time do-
main, written in all generality for a medium having conductivity σ and
permittivity ǫ:

~H =

4πσ
c

~E +

∂~E
∂t

ǫ
c

~H = 0 ,

~
∇ ×
~
∇ ·

, ~

~E =

−
~E = 0 .

∇ ×
~
∇ ·

∂ ~H
∂t

1
c

(120)

CASE 

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

^

r

^

r

^

r

52

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

0,0

0,1

0,2

0,3

0,4

0,5

0,6

0,7

0,0

0,2

0,4

0,6

0,8

1,0

=0.5

=1

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

0,0

0,5

1,0

1,5

2,0

=2

=5

0,0

0,5

1,0

1,5

2,0

2,5

3,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

3,5

4,0

=10

=100

Fig. 13. Comparison of Px as deﬁned in Eq. (118) (dotted line) and Py as deﬁned in
Eq. (119) (solid line) for ∆ = 0 (hard-edge) at diﬀerent values of Ω = R2/(ŻLw) and
ˆC = 0 (perfect resonance). Plots refer to the virtual source position (ˆz = 0).

For a monochromatic wave of angular frequency ω we have

i

ω
c

~¯H =
−
~¯E = 0 ,

~
∇ ×
~
∇ ·

(n′)2~¯E , ~

~¯H

ω
~¯E = i
c
~¯H = 0 ,

∇ ×
~
∇ ·

where

n′ =

ǫ + i

r

4πσ
ω

is the complex refractive index of the medium. A single equation for ~¯E can
be written as

CASE 

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

1,5

1,2

0,9

0,6

0,3

0,0

^

r

^

r

^

r

53

 P

y

 P

x

^

r

^

r

^

r

(121)

(122)

Fig. 14. Intensity proﬁles at diﬀerent values of ˆz = z/Lw (ˆz = 0 at the undulator
center) for Ω = 2, ˆC = 0 (perfect resonance) and ∆ = 0.1.

54

2~¯E + (n′)2 ω2
c2

∇

~¯E = 0 .

A solution of Eq. (123) is a plane wave speciﬁed by:

~¯E exp(
iωt) + C.C. = ~Eo exp[i(~k′
−
c
~¯H =
(~k′
ω

~¯E) ,

×

ωt)] + C.C.

~r

·

−

where ~k′ = k′x~ex + k′y~ey + k′z~ez is the (complex) wave vector inside the metal,
with (k′)2 = (k′x)2 + (k′y)2 + (k′z)2 = (n′)2ω2/c2 a complex number.

Let us consider a plane wave at the interface between vacuum (with unitary
refraction index) and a medium described by Eq. (122), and let~k be the wave
vector of the incident wave in vacuum with k =
= ω/c. We indicate with
subscripts t and n the tangential and normal components wave vectors to
the metallic surface. Continuity of the tangential component of the wave
vector on the boundary (i.e. k′t = kt) implies:

~k
|

|

n′

=

k′t
k′

kt
k

.

As a result one obtains

k′n =

2
k′

−

(k′t)2 = k′

1

s

−

= k′

1
s

−

q

2

k′t
k′ !

 

1
(n′)2

2

.

kt
k

 

!

In a metal, the refractive index is mainly deﬁned by the conductivity σ
according to

Since σ

1, also

1, and Eq. (126) yields

i

4πσ
ω

.

4πσ
ω ≃ r
n′
|

| ≫

n′ =

ǫ + i

r

≫

k′ .

k′n ≃

Thus, the propagation direction of the wave in the metal is almost per-
pendicular to the surface, independently of the direction of the incident
wave. This means that electric and magnetic ﬁeld into the metal have only
tangential components, ¯Et and ¯Ht. Moreover, these components must be

55

(123)

(124)

(125)

(126)

(127)

(128)

continuous on the surface, as follows from Maxwell’s equations. Using Eq.
(124) one obtains

¯Et
¯Ht

=

1
n′

.

(129)

(130)

Eq. (129) can be considered as an approximate boundary condition. Note that
this is valid not only for plane waves. In fact, any wave can be decomposed
in terms of a linear superposition of plane waves. Since Eq. (129) is valid for
each component, it must be valid for their linear superposition. Eq. (129)
can also be extended for any shape of the boundary surface, provided that
typical value of the curvature radius is much larger than the wavelength.
Eq. (129) is named after Leontovich, who ﬁrst derived it, and can be written
in vector form as

~¯E)

=

(~n

×

1
n′

~n

(~n

×

×

~¯H)

,

S

(cid:12)(cid:12)(cid:12)

S

(cid:12)(cid:12)(cid:12)

where the vector ~n, as deﬁned as in Section 3 and shown in Fig. 2, is pointing
inwards. Using Leontovich boundary condition gives a good approximation
in the case of a metallic waveguide, and drastically simpliﬁes the solution of
the electrodynamical problem. Namely, the problem of mode excitation in a
waveguide with resistive walls can be solved following the same approach
in Section 3 and Section 4, where boundary conditions are now substituted
by Eq. (130).

Since we are applying the paraxial approximation, we assume that the ﬁeld
amplitude does not change much along the z direction within a wavelength
Ex
and we are interested about the (main) transverse components of the ﬁeld
Ey. Using Eq. (130) and Maxwell’s equations, Eq. (121), it is possible to
and
ﬁnd boundary conditions involving the transverse ﬁeld components only.
e

e

First, using Eq. (121) in terms of slowly varying envelopes
Eq. (130) as

~
E

~n

×

=

ic
ωn′

−

~n

×

~n

×

~
E

~
∇ ×

.

S

(cid:20)

(cid:18)

(cid:19)
e
(cid:12)(cid:12)(cid:12)
nent along ~ez only involves

S

(cid:18)

e

(cid:19)(cid:21)
(cid:12)(cid:12)(cid:12)
. We may thus write

e

The transverse components of Eq. (131) only involve

Ez, while the compo-

~
E

⊥

e

56

~
E, we can write

e

(131)

~n

(cid:18)

×

⊥

~
E

e

S

(cid:19)

(cid:12)(cid:12)(cid:12)

=

ic
ωn′

−

~n

×

~n

×

(cid:20)

~
∇⊥ ×
(cid:18)

.

~
E

⊥

e

S

(cid:19)(cid:21)
(cid:12)(cid:12)(cid:12)

Eq. (132) will substitute the ﬁrst boundary condition in (40).

(132)

Second, from Eq. (130) we see that, on S, the projections of ~¯H and ~¯E on the
plane orthogonal to ~n, i.e. ~¯Ht and ~¯Et, are orthogonal and their modulus are
related by Eq. (129). As a result, we have ¯Ez = ~¯Et ·
~n). Now,
(~ez ×
ω/(n′c)~¯Ht·
(ω/c) ¯Ez. Therefore ~
Eq. (121) implies ~
~n) =
(~ez ×
∇⊥ ·
~¯E. We then obtain
~n). But Eq. (121) also yields ~¯H =
ω/(n′c)~¯H

~ez = (1/n′)~¯Ht ·
~¯E
=
−
⊥
ic/ω~

∇⊥ ·

~¯E

=

−

⊥

−

(~ez ×

·

−

∇ ×

~¯E

⊥

~
∇⊥ ·
(cid:18)

S

(cid:19)

=

i
n′

~¯E

~
∇ ×

(cid:18)

S

(cid:19)

(~ez ×

·

~n) =

i
n′

~n

·

~¯E

~
∇ ×

(cid:18)

S

(cid:19)

×

~ez

.



(cid:12)(cid:12)(cid:12)
If we now calculate the expression in [
·
for the fact that, in paraxial approximation, ∂z ¯Ex,y ≃
can re-write Eq. (133) in terms of slowly varying ﬁeld amplitudes as

] brackets in Eq. (133) and we account
∂x,y ¯Ez we

(cid:12)(cid:12)(cid:12)


(cid:12)(cid:12)(cid:12)
(ω/c) ¯Ex,y ≫



(133)

~
E

⊥

~
∇⊥ ·
(cid:18)

=

iω
cn′

~n

~
E

·

⊥

,

S

(cid:19)

(cid:19)
(cid:12)(cid:12)(cid:12)
that will substitute the second boundary condition in Eq. (40).

e

e

(cid:12)(cid:12)(cid:12)

(cid:18)

S

Thus, the problem in (40) should be substituted with

We may now follow the same method used in Section 3 to solve (135).
Namely, after consistent application of Laplace transformations, we ﬁnd an
eigenvalue problem analogous to (48):

(z, ~r
⊥

)

= ~f (z, ~r
⊥

)

(cid:21)
=

−

ic/(ωn′)

= iω/(cn′)

~
E

(cid:20)

⊥
~
e
E
×

D

~n

⊥

S

(cid:19)

~
∇⊥ ·

~
e
E
⊥

(cid:12)(cid:12)(cid:12)
(cid:19)

S

(cid:12)(cid:12)(cid:12)

e






(cid:18)

(cid:18)

~n


~n

·

×
~
E

⊥

~n

(cid:20)

×

.

(cid:18)

e

S

(cid:19)

(cid:12)(cid:12)(cid:12)

~
∇⊥ ×
(cid:18)

~
E

⊥

e

S



(cid:19)(cid:21)
(cid:12)(cid:12)(cid:12)

) + λ j~Fj(~r
⊥

) = 0

=

ic/(ωn′)

~n

−

= iω/(cn′)

2

∇
⊥
~n

~Fj(~r
⊥
~Fj

×

~
∇⊥ ·

(cid:16)

(cid:16)

S

(cid:17)
~Fj
(cid:12)(cid:12)(cid:12)
(cid:17)
(cid:12)(cid:12)(cid:12)

S






~Fj

~
∇⊥ ×
(cid:16)

(cid:17)i

S)
(cid:12)(cid:12)(cid:12)

×
~Fj

(
~n

·

~n

×

.

h

S

(cid:16)

(cid:17)
(cid:12)(cid:12)(cid:12)

57

(134)

(135)

(136)

As for the case of perfectly metallic walls, boundary conditions are homo-
geneous, so that the domain of the Laplacian operator is the vector space of
twice diﬀerentiable (square integrable) functions obeying boundary condi-
tions in (136). However, the Laplacian operator deﬁned in this way is not
self-adjoint with respect to the inner product deﬁned in Eq. (49). This is a
result of the fact that vectors ~Fj in Eq. (136), at the boundary, are not orthog-
onal to the surface S. Then, eigenvalues are not real, nor eigenfunctions are
orthogonal with respect to the inner product in Eq. (49). In general we do
not know wether the spectrum is discrete, completeness is not granted and
we cannot prove the existence of a set of eigenfunctions either. Yet, direct
calculations in [21] show that

~F∗j, ~Fi

=

D

E

ZS

~Fj ·

~Fi d~r
⊥

= δ ji .

It follows that functions ~Fj form a bi-orthogonal set of eigenfunctions. Bi-
orthogonality is often exploited in diﬀerent problems (see e.g. [30, 31, 32]).
In particular we will take advantage, without proving it, of completeness
Gα
and discreteness of the bi-orthogonal set. This allows us to decompose
β
as

F α
j Fj β

,

2iωp/c

λ j

−

j
X

Gα

β =

b

λ j = λ′j + iλ′′j

.

exactly as for the case of perfectly conducting walls. Note that now eigenval-
ues and eigenfunctions are complex. In particular, we write the eigenvalues
as

(137)

b

(138)

(139)

We want to study the problem of wall-resistance in the framework of a per-
turbation theory. If λ0
j is an unperturbed eigenvalue (perfectly conductive
λ0
walls) we require that
δλ j|
j |
|

for any value of k , j.

λ j −
|

j | ≪ |

k −

λ0

λ0

=

In this case we may still formulate an eigenvalue problem for the two scalar
(and complex) functions ψTE
j with complex eigenvalues λ j, using a

j and ψTM

58

deﬁnition analogous to Eq. (53). We get:

2

∇
⊥
~n

(~r
⊥
+

ψTE,TM
j
~
∇⊥
2

ψTE
j

·

kTM
⊥

ψTM
j

) + λTE,TM
ψTE,TM
j
j
~
ψTM
~ez ×
j
∇⊥
(cid:1)
(cid:0)
= iω/(cn′)

~n

~n

·

) = 0

(~r
⊥
=

S

i
~
(cid:12)(cid:12)(cid:12)
∇⊥

·

ic

−

kTE
⊥

ψTM

(cid:20)(cid:16)
(cid:17)
~ez ×
j −
(cid:0)

h

2

ψTE

j /(ωn′)
(cid:21)

~
∇⊥

·

ψTE
j

~n

(cid:1)

S

,

S

(cid:12)(cid:12)(cid:12)
(cid:12)(cid:12)(cid:12)

i






h

(cid:20)(cid:16)

ZS

where

(cid:17)

(cid:12)(cid:12)(cid:12)(cid:12)

S

(cid:21)

(cid:12)(cid:12)(cid:12)

2

(cid:12)(cid:12)(cid:12)(cid:12)

d~r
⊥

ψTE,TM
j

~
∇

= 1 .

(140)

(141)

It should be noted that (140) is valid only within the framework of a pertur-
bation theory. In fact, according to (140), functions ψTE,TM
separately obey
Helmholtz’s equation, but boundary conditions in (140) are not consistent
with independency of ψTE,TM

required by Eq. (53).

j

j

In the framework of a perturbation theory though, we may still use (140)
and formally obtain the same tensor Green’s function in Eq. (61). As said
above, we want to work in the framework of perturbation theory. We base
n′k
such theory on the small parameter ω/((
1. Within this theory, the
|
problem in (140) can be written as

≪

⊥|

c)

2

∇
⊥
~n

ψTE,TM
j
~
∇⊥
2

ψTE
j

·

kTM
⊥

h

(cid:20)(cid:16)

(cid:17)

S

i
ψTM
(cid:12)(cid:12)(cid:12)
j
(cid:21)
(cid:12)(cid:12)(cid:12)

S






) + λTE,TM
j

(~r
⊥

ψTE,TM
j
2

(~r
⊥

) = 0

=

ic

−

kTE
⊥

(cid:26)
(cid:17)
(cid:16)
= iω/(cn′)

ψTE

j /(ωn′) + iω/

n′c

2

kTE
⊥

~n

~ez ×

~
∇⊥

·

2

ψTE
j

(cid:20)

(cid:16)

(cid:17)

(cid:21) h(cid:0)

(cid:1)

i

~n

~
∇⊥

·

ψTM
j

,

h

S

i

(cid:12)(cid:12)(cid:12)

where TE and TM modes are now decoupled. If we restrict our analysis to a
circular waveguide radius R, we obtain the following expression for ψTE,TM
n′k
at the ﬁrst order in ω/((
|

c):

⊥|

j

S

(cid:27)

(cid:12)(cid:12)(cid:12)
(142)

(143)

ψTE
mk1
ψTE
mk2 






and

= ATE

mkJm

µmk + δµmk

(cid:20)
(cid:0)

sin(mφ)

cos(mφ) 



r
R

(cid:1)

(cid:21)





59

ψTM
mk1
ψTM
mk2 






= ATM

mk Jm

(νmk + δνmk)
(cid:20)

r
R

sin(mφ)

cos(mφ) 

(cid:21)





,



where ATE,TM
boundary conditions in (142) allow to obtain

mk

should now be calculated with the help of Eq. (141), while

δµmk
µmk

=

ic
n′ωR

−

µ2
mk

+ ω2m2R2/(c2µ2

mk)

µ2

mk −

m2

and

δνmk
νmk

=

iωR
cn′ν2
mk

−

.

ν, µ

n′
|

Note that Eq. (145) and Eq. (146) can be written in terms of our small
n′k1k
parameter, since Rω/(c
), where the concept of trans-
|
⊥ |
verse wave number is now applied to each mode k. Actually condition
n′k
ω/((
1. Thus, we
δνmk| ≪
|
|
may give an estimation of wall resistance eﬀects retaining our main results,
Eq. (101) and Eq. (102), and substituting µmk with µmk + δµmk and νmk + δνmk.
In our case of interest, m = 1 so that

1 can be presented as

}1k) = ω/(c

δµmk| ≪
|

1 and

≪

⊥|

c)

|{

Addition of δµ1k and δν1k implies an exponential damping of each mode,
µ,ν
i ˆCµ,ν
k (z), Eq.
due to the propagation factor exp[
k
(103) and Eq. (104). We can estimate the damping exponent as

ˆz] in the expressions for

A

−

δµ1k
µ1k

=

ic
n′ωR

−

µ2
1k

+ ω2R2/(c2µ2

1k)

µ2

1k −

1

and

δν1k
ν1k

=

iωR
cn′ν2
1k

−

.

Dµ =

δµ1k|
µ1k|
Ω

ˆz =

1

µ2

1k −

1

√2

ˆz

Lw
R
n′|
|

for TE modes, where we used (Ż/R)2

1 and

Dν =

δν1k|
ν1k|
Ω

ˆz =

Lw
√2
R
n′|
|

ˆz

≪

60

(144)

(145)

(146)

(147)

(148)

(149)

(150)

for TM modes. Expressions for the damping exponents Dµ and Dν, Eq. (149)
and Eq. (150), are known in literature and may be found, for example, in [33].
Note that the diﬀerence between Dµ and Dν is only in the factor (µ2
1
1)−
in Eq. (149). Dµ depends on the mode number, k, while Dν is independent
of it.

1k −

Let us study a practical case for copper. We know that the skin depth for
1.2 µm and δs = √cλ/(2π √σ), where
copper at wavelength λ = 10 cm is δs ≃
σ is the conductivity. It follows that for λ = 200 µm, that is in the range of
interest for the FLASH infrared beamline we obtain δs ≃

54 nm yielding

=

n′
|

|

√2λ
2πδs ≃

840 .

(151)

≃

)
|

n′
|

1.84), and ωR/(ν11c

Let us consider R = 1.8 cm and Lw = 3.6 m (corresponding to Ω = 2.8), and
substitute these values in Eq. (149) and Eq. (150). The perturbation parameter
is smaller than unity: ωR/(µ11c
0.37 (µ11 ≃
≃
3.83). Therefore, we may apply the perturbation approach for
0.18 (ν11 ≃
estimations. It should be noted here that the accuracy of the ﬁrst-order
perturbation approach becomes better and better for higher modes, because
µ1k and ν1k increase while k increases. For the transverse magnetic modes
0.17ˆz. For transverse
we have a damping factor common to all modes Dν ≃
electric modes we should specify the mode number. For the ﬁrst mode
0.07 ˆz. For second mode (k = 2) we have
(k = 1), and we obtain Dµ ≃
0.006 ˆz, that gives a negligible eﬀect. All TM modes
5.3 and thus Dµ ≃
µ12 ≃
are visibly damped. At ˆz = 1, i.e. half undulator length after the exit of the
device, one has a damping factor exp(
0.84, i.e. modes are dumped
by about 16%. TE modes instead, are left almost unaﬀected.

0.17)

n′
|

)
|

−

≃

We conclude that propagation through the pipe is strongly aﬀected by wall-
resistance eﬀects even for relatively large values of Ω. Note that this eﬀect
strongly depends on the material considered. For example steel has a skin
depth three times thicker than copper. Strictly speaking we could not apply
a perturbation approach, since now the perturbation parameter is larger
than unity (although comparable with unity). However, if we still use the
perturbation approach to get a rough estimation, we obtain that TM modes
present a dumping exponent Dν that is about three times larger than copper.
This means that TM modes are dumped by about 40%. These estimations
allow us to formulate the following recommendation: the internal part of
the vacuum pipe for the infrared undulator line at FLASH should be copper-
coated 6 .

6 We underline the fact that these remarks are only valid in the case of undulator
radiation. In particular, as said before, we will treat edge-radiation setups in a
separate work.

61

8 Conclusions

In this article we presented the ﬁrst exhaustive theory of undulator radia-
tion within a waveguide and we exempliﬁed it in the case of the infrared
undulator beamline at FLASH. In the relatively simpler free-space case,
paraxial Maxwell’s equations can be solved in terms of a scalar paraxial
Green’s function. In that case, the solution for the ﬁeld, written in reduced
form within the resonance approximation is identical (aside for polariza-
tion properties) for planar and helical undulator conﬁgurations. When a
waveguide is present, the relation between current sources and electromag-
netic ﬁeld is more complicated. The analysis of the problem is performed
by introducing a tensor Green’s function technique, thus complicating the
structure of equations that, in contrast to the free-space case, now depends
on the undulator type and on the waveguide geometry. First we outlined a
solution for a homogeneous waveguide with arbitrary cross-section. Then
we specialized our consideration to the case of a circular waveguide, and
we implemented the planar undulator case 7 within the applicability region
of the resonance approximation. The electric ﬁeld was found as a super-
position of the waveguide modes, and was studied for diﬀerent values of
parameters. The main parameter involved in the problem is the waveg-
uide parameter Ω, that can be interpreted as the squared ratio between the
waveguide radius and the radiation diﬀraction size, and is a purely geomet-
rical parameter. When Ω is comparable, or smaller than unity, waveguide
eﬀects become important, under the assumption of a perfect conductor.
Moreover, we found that wall-resistance eﬀects play a signiﬁcant role even
for relatively large values of Ω. To minimize this eﬀect, it is desirable to coat
the internal part of the waveguide with copper.

9 Acknowledgements

The authors are grateful to Martin Dohlus, Michael Gensch and Oliver
Grimm (DESY) for many useful discussions and to Massimo Altarelli and
Jochen Schneider (DESY) for their interest in this work.

7 We treated the helical case in Appendix A.

62

Appendix A: Helical undulator

We deﬁne in all generality the horizontal and vertical velocity of an electron
as a function of the longitudinal position z′ along the undulator as

vx(z′) =

cθs sin(kwz′) =

vy(z′) =

cθs cos(kwz′) =

−

∓

exp[ikwz′]

exp[

ikwz′]

−

−
exp[ikwz′] + exp[

(cid:9)
ikwz′]

.

−

cθs
2i
cθs
2

−

∓

(cid:8)

(cid:8)

(cid:9)

(152)

sign in the second equation in (152) indicates an electron rotating
The
∓
sign) or counterclockwise (+ sign) in the judgement of an
clockwise (
observer located after the undulator and looking towards the device. The
longitudinal Lorentz factor γz is now constant. We can write the phase factor
in Eq. (62) as

−

z

Z0

ω
2cγ2
z

d¯z =

z
2Żγ2
z

= kwz + Cz .

(153)

The next step is to substitute Eq. (152) and Eq. (153) in Eq. (62) to calculate
the ﬁeld components. We can do that within the region of applicability of the
resonance approximation, as in the case of a planar undulator. Within the
region of applicability of the resonance approximation, condition (88), and
neglecting negligible terms in Eq. (62) as speciﬁed in Section 5 we obtain the
ﬁeld components in cartesian coordinates for the case of a helical undulator:

=

Eα
∓

2πeωθs
c2

Lw/2

Z
Lw/2

dz′

Gα

iGα
2

1 ∓

exp[iCz′] .

r′(z′)=0

(154)

−

(cid:16)

e

(cid:17) (cid:12)(cid:12)(cid:12)
By inspection of Eq. (74), under the resonance approximation only the terms
with m = 1 survive. With the help of Eq. (74) and neglecting negligible terms
we ﬁnd for the horizontal ﬁeld (α = 1) and for the vertical ﬁeld (α = 2)
respectively:

(r, φ, z) =

∞

iωeθs
c2

−

µ
k (z)
A

Xk=1 (cid:26)

Ex
∓

e

Jo

µ1k

+ J2

µ1k

exp[

2iφ]

+

r
R

r
R

ν
k(z)
A

(cid:20)
Jo

(cid:18)
ν1k

(cid:19)

−

r
R

(cid:19)

J2

(cid:18)
ν1k

r
R

(cid:18)

(cid:19)

(cid:19)
exp[

∓

2iφ]

∓

(cid:21)

(cid:21)(cid:27)

(155)

(cid:20)

(cid:18)

63

and

and

Er

∓

e

e

(r, φ, z) =

Ey
∓

e

∞

ωeθs
c2

∓

µ
k (z)
A

Xk=1 (cid:26)

ν
k(z)
A

r
R

Jo

µ1k

(cid:20)
Jo

(cid:18)
ν1k

r
R

−

(cid:19)
+ J2

r
R

J2

µ1k

exp[

2iφ]

+

(cid:18)
ν1k

r
R

(cid:19)
exp[

∓

∓

(cid:21)

2iφ]

.

(156)

(cid:18)
One can also write the expressions for the components in polar coordinates
Er and

Eφ, that are related to

Ey through

Ex and

(cid:21)(cid:27)

(cid:19)

(cid:19)

(cid:18)

(cid:20)

e

e
Er =

Ex cos(φ) +

e
Ey sin(φ)

e

Eφ =
e




We thus obtain
e
e

−
e

Ex sin(φ) +
e

Ey cos(φ) .

e

∞

(r, φ, z) =

i

ωeθs
c2

−

(157)

Xk=1 (cid:26)

µ
k (z)
A

ν
k(z)
A

Jo

µ1k

+ J2

µ1k

exp[

iφ]+

r
R

∓

r
R

(cid:20)
Jo

(cid:18)
ν1k

(cid:20)

(cid:18)

(cid:19)

−

r
R

(cid:19)

J2

(cid:18)
ν1k

r
R

(cid:18)

(cid:19)(cid:21)

(cid:19)(cid:21)
exp[

iφ]

∓

(cid:27)

(158)

(r, φ, z) =

Eφ
∓

∞

ωeθs
c2

∓

µ
k (z)
A

r
R

Jo

µ1k

(cid:20)
Jo

(cid:18)
ν1k

r
R

−

(cid:19)
+ J2

J2

µ1k

r
R

exp[

iφ]+

∓

(cid:18)
ν1k

r
R

(cid:19)(cid:21)
exp[

∓

iφ]

.

(159)

Xk=1 (cid:26)

ν
k(z)
A

(cid:20)

(cid:19)

(cid:18)

(cid:27)

(cid:19)(cid:21)

(cid:18)
Note that both TM and TE modes are present in the expression for the ﬁeld.
It is interesting to compare this fact with what can be found in literature.
As already remarked in Section 1, TM modes are neglected in [20]. For the
readers’ commodity we report here words from Section 9.3 of reference
[20]. There one may ﬁnd: ”It is easily seen that in the case of a spatially
extended charge propagating in a helical wiggler, the TE modes (...) couple
to the wiggler-induced motion, as the current components (...) By contrast,
the TM modes (...) are driven by the uniform motion of the space-charge
distribution in the cylindrical waveguide. Therefore, in the remainder of
this derivation, we will focus on the TE modes”.

Neglecting TM modes is held by us as a misconception. If it was correct,
also undulator radiation produced by planar undulators should exhibit
only TE modes. In fact, as already discussed in Section 5, the ﬁeld from a
planar undulator can be seen as superposition of ﬁelds from two helical

64

trajectories. Without TM modes we could not even recover the free-space
limit for R
as studied in Section 5 for a planar undulator. In particular,
we would loose both horizontal polarization and azimuthal symmetry of
the ﬁeld.

−→ ∞

Similarly, one can study the limit R
for the helical case, following a
procedure analogous to that in Section 5 for a planar undulator. In analogy
with the planar case, one can show that if TM modes are neglected, both
circular polarization and azimuthal symmetry of the ﬁeld are lost.

−→ ∞

Neglecting TM modes in [20] is the result of a more general misconception
introduced when Maxwell’s equations are solved with the Green’s func-
tion approach. Namely, the misconception is introduced in the eigenmode
decomposition of the four-current (see paragraph 5.6.4 of [20]), where TM
modes are not coupled with the transverse current density as they must be.

65

References

[1] H. Wabnitz et al., Nature, 420, 482-485 (2002)
[2] L. Juha et al. Nucl. Instrum. Meth. Phys. Res. A, 507, 577-581 (2003)
[3] V. Ayvazyan et al., Phys. Rev. Lett, 88, 104802 (2002)
[4] V. Ayvazyan et al., Eur. Phys. J. D, 20, 149-156 (2002)
[5] V. Ayvazyan et al., Eur. Phys. J. D, 37, 297-303 (2006)
[6] G. Gehrke and J. Feldhaus, Synch. Rad. News, 19, 20-24 (2006)
[7] B. Faatz et al, Nucl. Instrum. Meth. Phys. Res A, 475, 363-367 (2001)
[8] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, Nucl. Instrum.

Meth. Phys. Res. A, 528, 184-188 (2004)

[9] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, Nucl. Instrum.

Meth. Phys. Res. A, 528, 330-334 (2004)

[10] O. Grimm, P. Schmueser, ”Principles of longitudinal beam diagnostics

with coherent radiation”, TESLA-FEL 2006-03 (2006)

[11] V. Borisov et al., in Proc. of the 10th European Particle Accelerator

Conference EPAC’06, Edinburgh, UK, 2595-2595 (2006)

[12] O. Grimm, private communication
[13] M. Gensch, private communication
[14] O. Chubar and P. Elleaume, in Proc. of the 6th European Particle Ac-

celerator Conference EPAC’98, Stockholm, Sweden, 1177-1179 (1998)

[15] T. Tanaka and H. Kitamura, J. Synch. Rad. 8, 1221 (2001)
[16] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, ”Fourier Op-
tics Treatment of Classical Relativistic Electrodynamics”, DESY 06-127
(2006)

[17] H. Motz and M. Nakamura, Ann. Phys. 7, 84 (1959)
[18] H.A. Haus and N. Islam, J. Appl. Phys. 54, 9 (1983)
[19] A. Amir, I. Boscolo and L. R. Elias, Phys. Rev A, 32, 5 (1985)
[20] F.V. Hartemann, ”High Field Electrodynamics”, CRC Press (2002)
[21] E. Saldin, E. Schneidmiller and M. Yurkov, ”The Physics of Free Electron

Lasers”, Springer, Berlin, 2000, ISBN 3-540-66266-9

[22] ZEMAX code, at http://www.zemax.com/
[23] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, Opt. Comm., 271,

1, 207 (2007)

1336 (1974)

[24] B. Kinkcaid, J. Appl. Phys, 48, 7, 2684 (1977)
[25] D. Alferov, Y. Bashmakov and E. Bessonov, Sov. phys. - Tech. Phys. 18,

[26] H. Wiedemann, Particle accelerator physics, Springer-Verlag (1993)
[27] A. Gover, Phys. Rev. ST Accel. Beams 8, 030701 (2005)
[28] A. Gover, Phys. Rev. ST Accel. Beams 8, 030702 (2005)
[29] S. Krinsky, IEEE Trans. Nucl. Sci. 30, 3078 (1983); G. K. Green,

Brookhaven National Laboratory Report No. 50522 (1976)

[30] S. Krinsky and L.H. Yu. Phys. Rev. A 35, 3406 (1987)
[31] A.E. Siegman, Phys. Rev. A 39, 1253 (1989)
[32] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, Nucl. Instrum.

66

Meth. Phys. Res. A, 554, 1, 20 (2005)

[33] L. Lewin, ”Theory of waveguides”, London, Newnes-Butterworths and

Co. (1975)

67

