 

 

A modal model for diffraction gratings 

1

Mark P. Davidson 
Spectel Research Corporation 
807 Rorke Way 
Palo Alto, CA 94303 
mdavid@spectelresearch.com 
www.spectelresearch.com 
 
January 6, 2002 
 

ABSTRACT 
 
A description of an algorithm for a rather general modal grating calculation is presented.  
Arbitrary profiles, depth, and permittivity are allowed.  Gratings built up from sub-
gratings are allowed, as are coatings on the sidewalls of lines, and arbitrary complex 
structure.  Conical angles and good conductors are supported. 
 
 
1.  INTRODUCTION 
 
The modal approach to diffraction grating analysis has an extensive history partially 
represented by references [1-17].  In the present work a modal algorithm is presented 
which is exceptionally flexible and general.  The method described allows sub-periods, 
sidewall coatings on grating lines, and in fact any complex geometry one may wish to 
consider so long as the geometry repeats itself periodically and has one axis of 
translational invariance.   The grating can consist of any number of layers, any number of 
different materials in each layer, and any number of cells per layer.  All materials can be 
dielectric or conducting, and the angles of incidence can be conical.  The only limitations 
are of a practical numerical nature.   Modal models have only recently been extended to 
handle more than two regions in a given horizontal layer [18].  The approach of [18] 
utilizes an equivalent electrical network technique in which each individual layer is 
described by a transmission-line unit.  The present work does not use this method, but 
similar generality is achieved. 
 
The main advantages of the modal method are that it is in theory more accurate than other 
methods and by careful study of the eigenfunctions it can aid in physical intuition.   
Another advantage is that the shapes of multilayer gratings can be modified without 
necessarily redoing all of the calculation.  The main disadvantages are complexity and 
problems with numerical precision.  In the current work it was found that for larger pitch 
values and for strong conductors it was necessary to work in 128 bit floating point or 
higher precision.   The algorithm was implemented in several languages including 
Matlab, Mathematica, and C++ with double, double-double, and quad-double precision 
arithmetic.  Mathematica's arbitrary precision arithmetic features were very attractive, but 
the run times were very long.   A good compromise between speed and precision was 
found by running a preliminary calculation of the eigenvalues using double precision 

 

2

arithmetic, and then touching up these values by running a double-double or quad-double 
precision algorithm.    
 
The application of grating simulation to metrology problems in the semiconductor 
industry has a long history [19-25].  The modal method has been applied in this context 
in  [26-29], although the author was not aware of the earlier work at that time, and so the 
method was referred to as the Analytic Waveguide Method with the tradename 
Metrologia.  Recent interest in grating simulation has increased because of the use of 
diffraction grating scatterometry for measuring linewidths and cross-sections in 
semiconductor manufacturing. 
 
In the present paper only non-magnetic materials are considered as these are the most 
important in semiconductor manufacturing, although it seems straightforward 
theoretically at least to include magnetic materials. 
 
2.  MATHEMATICAL FORMULATION 
 
Start with the fixed frequency complex form of Maxwell's equations which may be taken 
to be in appropriate units 
 

E
−×∇

B

=

0

 

  

   

B
+×∇

2

n

E

=

;0

2

n

ε
+=

i

 

 

σ
ω

 

i
ω
c
ω
i
c

 

 

 

 

 

 

 

 

 

 

(1) 

(2) 

 
The object is to solve these equations given that a plane wave is incident on the grating of 
Fig. 1 from above 
 
Notation:  
 
 p = pitch or period  
 
ki = the incident wave vector before any scattering 
 

3

 

 

Figure 1 

 
 
The scattering object is assumed to be periodic in the x direction and to be invariant in 
the y direction.  The Floquet condition and the wave equation must be satisfied by all of 
the field components 
 
xF
(
 
 

p
xFe
)(

ik=

(3) 

   

+

p

)

 

 

 

 

 

 

 

i
x

∆ +

n

( )
x




2

2

k

0




F

( )
x

=

0;

k

0

=

ω 2π
=
c
λ

 

 

 

 

 

 

(4) 

 
Distinguish two polarization states denoted by TE and TM.  These are defined by the 
conditions that for TE the x component of the electric field vanishes, and for TM the x 
component of the magnetic field vanishes.   
 
TE:   Ex=0       
 
TM:  Bx=0 
 
It can be shown that for a plane wave these states have polarization vectors which are 
orthogonal. 
 

(5) 

(6) 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

4

Barring exceptional circumstances a general field can be written as a superposition of a 
TE field and a TM field.   The only case where this isn't possible is a plane wave 
travelling exactly in the x direction in some region.  For such a plane, the x component of 
E and B are both zero because plane waves are transverse.   Should one of the 
eigenmodes have behave this way, then by making a very small change to the wavelength 
or to the index of refraction one can make the z component of the wavevector k nonzero 
and thus eliminate this rare problem in practice. 
 
Now consider an object consisting of  vertical slab layers as in Figure 2.  Both the 
superstrate and the substrate are assumed to be infinite in extent in the y and z directions. 
 

 

Figure 2 
 
Only one period of the object is shown in the cross-section Figure 2, but the calculation 
assumes that the object repeats in the x direction.  Each layer may have a different 
number of regions.   For example, in figure 2 there are 4 regions in layer 1 and 3 regions 
in layer 2.   The complex indexes of refraction can be different for each region.   The 
method presented here works for any number of regions, for any number of layers, and 
for any number of different indexes of refraction. 
 
 
Because of the invariance of the object in the y direction, one may factor out the y 
dependence of the field 
 
F x y z
, )
( ,
 
A solution within a given layer is found by the classical separation of variables method 
 
F x z
( , )

F x z

k = k

( , ),

(8) 

(7) 

x
( )

Φ

=

=

yik

e

i
y

ik

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

z,n

z

y

y

⋅

⋅

A e
n

∑

n

n

 
The kz,n are the eigenvalues, they come in pairs with opposite sign, and the Φ's are the 
eigenfunctions.   The condition which determines the eigenvalues is derived by imposing 
boundary conditions on Ex and Bx.    
 
The eigenvalues transform in a simply way as a function of ky. 
 

 

5

k

z n
,

(

k

y

)

=

k

z n
,

2

(0)

2

−

k

y

 

 

 

 

 

 

 

 

(9) 

 
To see why this is so, imagine extending the layer under consideration to infinity above 
and below.  This obviously won't affect the eigenvalues or eigenfunctions.   But the 
infinite slab waveguide is now invariant under rotations about the x axis.  A whole family 
yk =  by exploiting 
of eigensolutions with different 

yk  can be generated from one with 

0

i

i

this rotational invariance.   Eq.  (9) is simply a rotation about the x axis. 
 
2.1  THE CONDITION DETERMINING THE EIGENVALUES 
 
Let the primary field functions be Ex and Bx.  The other field quantities are derived from 
these using Maxwell's equations.  In a given layer one starts with the boundary conditions 
for Ex, Bx and their x derivatives.  As one moves across the layer in the x direction, the 
following functions are continuous at the region boundaries (these are the vertical walls 
between regions in figure 2) 
 

2

BEn
x

,

x

,

,

and

E
∂
x
x
∂

B
∂
x
x
∂

 

 

 

 

 

 

 

 

(10) 

 
The eigencondition is found by continuing Ex or Bx an entire period in the x direction, 
and then imposing the Floquet condition on the field.  For TM  mode one continues Ex 
and for TE mode  Bx. 
 
Consider a single eigenmode.   In each region l a given eigenmode has at most two plane 
waves whose kx,l values have opposite sign.   This follows simply from the wave 
equation,  the kx,l value being determined from the eigenvalue kz,l by the equation 
 

k

,
x l

x
( )

= ±

2

n x k
( )

2

0

−

k

2

2

−

k

y

,
z l

 

 

 

 

 

 

 

(11) 

 
There are only two values of kx,l because ky is unchanged by the scattering which follows 
from the translational invariance of the scattering object in the y direction.  As a 
consequence kx,l is determined up to a sign by kz alone.  In the general 3 dimensional case 
there would be an infinite number of kx,l values allowed in a given eigenmode thus 
complicating the problem considerably.     
 
So in each region of a layer one can describe each eigenfunction in terms of a two-
element complex vector representing the coefficients for the two allowed values of kx.  In 
each region one can write for each eigenfunction 
 
Φ
 
 where Φ is equal to Bx for the TE mode and to Ex for the TM mode, and where kx,l 
denotes the positive square root in (11).  The center of the region in question is xc.  The 
constants a and b will depend on the region. 

(12) 

l x
( )

= ⋅

+ ⋅

a e

b e

x x
c

x x
c

(
⋅ −

(
⋅ −

 

 

 

 

 

 

 

ik

ik

x l
,

x l
,

−

)

)

 
So the eigenfield in each region is described by a two element vector (a,b) for each 
region.  The boundary conditions relate the vectors in each region, and the Floquet 
condition imposes the final eigenvalue condition.  Starting with the leftmost region, one 
can derive a matrix M which gives the a and b values 1 pitch to the right of the starting 
region. 
 

 
(
pa
(
pb

⋅

b

a

)
)

)0(
)0(

M

   










=





 
where M is a product of matrices which couple neighboring regions 
 

 

 

 

 

 

 

M

=

nm

 

 

N

∏

n 1
=

 

 

 

 

 

 

 

(14) 

 
where mn links the vector in region n+1 and region n.  N is the number of regions in a 
single pitch or period.  Figure 3 illustrates the situation 
 
 

(13) 

 

 

 
Figure 3 

6

 

 

 

7

 (15) 

(16) 






































 

 
 
 

TE

m

=

1

2

TM

m

=

1

2





























The matrices mi are different for TE and TM modes.  After some algebra the boundary 
conditions reveal the following expressions for mi in the two modes: 
 

(1

+

k

exp(

/

k

) *

xR

xL
*
ik WL

xL





) exp(

*
ik WR

)

xR





(1

−

k

exp(

/

k

) *

xL
xR
*
ik WL
−

xL





) exp(

*
ik WR

)

xR

(1

−

k

exp(

/

k

) *

xR
xL
*
ik WL

xL





) exp(

−

*
ik WR

)

xR

) exp(

−

*
ik WR

)

xR





(1

+

k

exp(

/

k

) *

xL
xR
*
ik WL
−

xL





((

/
nL nR

)

2

+

k

exp(

*
ik WL

xL

/

k

) *

xL
) exp(

xR
*
ik WR

)

xR





((

/
nL nR

)

−

k

/

k

) *

2

exp(

−

*
ik WL

xL

xR
xL
*
) exp(
ik WR

)

xR






((

/
nL nR

)

−

k

/

k

) *

2

exp(

*
ik WL

xL

xL
) exp(

xR
*
ik WR
−

)

xR











((

/
nL nR

)

+

k

2

exp(

−

*
ik WL

xL

) *

/

k

xR
xL
) exp(
−

ik

xR

*

)WR

 
Note that m couples two different regions, denoted by left (L) and right (R).  The 
quantities in 15 and 16 have the following meanings: 
 
kxL = x component of the k vector in the leftside region. 
kxR = x component of the k vector in the rightside region. 
WL = Half the width of the leftside region. 
WR = Half the width of the rightside region. 
NL = complex index of refraction in the leftside region 
NR = complex index of refraction in the rightside region. 
 
The eigenvalue condition is derived from Floquet's relation which states that 
 

M





a

b





=

exp(

i
ik p
x

)





a

b





 

 

 

 

 

 

 

 

(17) 

i

−

M

exp(

 
where p is the period or pitch.  In order for a non-trivial solution to this equation, the 
following determinant must vanish: 
 
det(
 
It follows easily from the definitions of M that 
 
det(
 

xik p

=M

1)

1
) )

=

0

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

(18) 

(19) 

 

8

i

1

2

2

2

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

)

  

0

0

=

=

−

+

−

=

−

   

φ)

1
=  

exp(

φ)(λ

(22) 

(21) 

(20) 

xik p

φφ)λ

Since M is dimension 2, a more useful form for the eigenvalue relation can be obtained.  
The problem with (18) is that the elements of M can be very large in some cases.  For 
example when good conductors are being modeled or when kx is imaginary in some of 
the regions making up the layer.   The following derivation gives a more useful form 
which does not require as much numerical precision.  Since M has nonzero determinant, 
it can be diagonalized with a similarity transformation without changing (18).   In terms 
of the eigenvalues of M, (18) becomes 
 
(λ
1
 
where λ1 and λ2 are the eigenvalues of M and  
 
φ
 
λλ 21
 
And therefore (20) becomes 
 
(λ-1
 
But the trace of M is invariant under a similarity transformation also, and therefore one 
has 
 
-1
 
The eigenvalue condition expressed in the form (24) is superior to (18) for numerical 
reasons because the trace is first order in the elements of M and therefore when the 
elements of M are large, the precision required is less for (24) than for (18).   The 
eigenvalue condition is satisfied by finding those kx values which satisfy (24).  Once a kx 
is found then kz follows from the wave equation. 
 
2.2  MORPHING TO FIND NEW EIGENVALUES FROM KNOWN ONES 
 
There is no general algorithm for finding all the complex zeros of an analytic function in 
the complex plane.  Solving the eigenvalue problem is therefore nontrivial.  Moreover, 
the presence of exponentials in eqns. 15 and 16 make numerical precision a problem in 
some cases.   In [9, 30] an approach was presented which was based on contour integral 
theorems for analytic functions.  The approach used here is a generalization of the Tayeb-
Petit method [11] which was also used successfully in [12, 13, 26-29].  In order to solve 
the general eigenvalue problem one starts with a known solution and then varies the 
parameters of the problem slowly and continuously to change the object from the known 
one to the desired case, all the while tracking the continuous motion of the eigenvalues.  
A fictitious time variable t is introduced, with  all parameters of the problem linear 
functions of this variable as follows: 
 

)φ
−M

trace(

(23) 

(24) 

2 =

φ

0

  

 

 

 

 

 

 

 

 

 

 

9

 

 

P(t) = P(0) + t*(P(1)-P(0)) 
 
The parameter t varies from 0 to 1.  A convenient starting case for which the solutions are 
known is simply a homogeneous layer for which there is only one region.   In the 
homogeneous case, it is easy to show that the allowed eigenvalues for kx are 
 

(25) 

 

 

 

 

 

k

x

=

k

i
x

+

N

N

=

integer

 

2
π
p

,

 
Some of these eigenvalues will have the same kz (ie. will be degnerate) if kx is any 
multiple of 
 

 

 

 

 

 

 

 

 

 

 

 

 

(26) 

(27) 

k i
x

=

π
p

  

 

 

 

i

 
These degenerate cases cause a problem for the morphing algorithm, and so one choose a 
xk  which is not a multiple of (27).   The determinant to be zeroed can 
starting value for 
be thought of as a function of kx in the leftmost region of the layer and of t.  As t varies 
from 0 to 1 a given eigenvalue kx will move on some trajectory.  Let 
 
F(k
 
From this equation one can derive the trajectory equation: 
 
 

trace(

(28) 

t),

M

)φ

-1

φ

=

=

−

0

 

 

 

 

 

 

 

2

x

 

 

 

 

 

 

 

 

(29) 

dk
x
dt

=

−

F
∂
t
∂
F
∂
k
∂

x

kx

 

t

 
A procedure that works well for solving this equation is to use (29) computed 
numerically to integrate a certain number of time steps, and then to periodically interrupt 
the integration in order to refine the accuracy of kx by using a Newton's method to 
minimize F as a function of kx for fixed t.  It is important to choose the time steps to be 
small enough so that nearly degenerate eigenvalues can be resolved numerically.  
Degenerate cases are hard to avoid though, and some means for removing degenerate 
eigenvalues is very helpful. 
 
2.3  FIXING DEGENERACY PROBLEMS 
 
F in (28) will always have an infinite number of zeros as a function of kx.  No theorems 
are known which prove that degenerate eigenvalues cannot occur in the general case.  
Degeneracy certainly occurs for homogeneous layers when 
Certainly cases can arise when eigenvalues can come close together, and this can cause 

xk  is a multiple of (27).  

i

 

10

numerical difficulty.   It appears that true degeneracy does occur for sub periodic 
gratings, like the one pictured in Figure 1 if the lines are all identical and equally spaced 
in groups.  The degeneracy can be split in this case by choosing the lines and spaces to be 
very slightly different.  One way to deal with near collisions of eigenvalues is to choose a 
very small time step when integrating (29).  This can be quite time consuming in the 
general case however.  It has proved more efficient to allow some degeneracy and then 
remove it using the following technique. 
 
Suppose that two nearby eigenvalues have been confused by the integration procedure 
(29) together with Newton's method.  So two eigenvalues are incorrectly thought to be 
the same.   It is to be expected that actually only one of the eigenvalues is the value that 
has been calculated for both, and the other one is different and somewhere nearby.  Then 
F will have a simple zero at the point found.  And therefore the following function 
 
kFF
/(
1

(30) 

−

=

k

)

 

 

 

 

 

 

 

 

 

x

x
1

 
will have a zero at the eigenvalue which was missed, but not at kx1 anymore.  If there are 
several zeros which have been identified in the neighborhood of kx1, then these can be 
divided out also to make the chance of finding the correct zero better.  In this case one 
uses a function of the form 
 

 

 

 

 

 

 

 

 

 

(31) 

F
1

=

∏

n

F
k

x

(

−

k

)

nx

 
This method is not completely foolproof, but if there are only a few degeneracies it will 
often remove them.  If not, then the other alternative is to choose the time step to be 
smaller. 
 
2.4  DETERMINING THE ELECTRIC AND MAGNETIC FIELD VECTORS 
FOR A GIVEN EIGENFUNCTION 
 
In TE mode work with Bx.  Normalize the plane wave in each region such that Bx = 1. 

TE

:

BxkE

×=

,ˆ

=

Ek
 ,
normalize
×

 this

 vector 

so

 that 

B

=

1

   

x

(32) 

 
In TM mode work with Ex, and normalize the plane waves in each region so that Ex = 1.   
 

TM

:

ExkB

×=

,ˆ

−=

Bk
×

 ,
normalize

 this

 vector 

so

 that 

E

=

1

 

x

(33) 

 
The amplitudes or functional forms for Ex and Bx as functions of x are found after solving 
the eigenvalue condition.  Then these eigenfunctions are multiplied by the above vectors 
in each region and for each plane wave making up the eigenfunction to get the full 
complement of fields. 

1
k

0

1
2
kn

0

 

 

 

11

 
2.5 DETERMINING THE EIGENFUNCTIONS 
 
Finding the eigenfunctions amounts to finding the two numbers a and b in each region 
and using equation 12 to get the functional behavior.  One starts by finding this vector in 
the leftmost region of a layer.  The eigenfunction is determined up to a muliplicative 
constant, and so without loss of generality (provided that M01 is not zero) one can set a = 
1 in the leftmost region. 
 

M

a
1
b
1






=




φ


a
1
b
1


−=⇒
b
1


(
M

−

φ

)

00
M

01

a
1

  

 

 

 

 

(34) 

2

2

2

 

 

 

 

 

m

   













m1

etc
.



,




,


(35) 

a
1
b
1

a
b
2

a
b
2

a
3
b
3


=



=


 
So with this relation the eigenfunction in region 1 is determined.   If it so happens that 
M01 is zero, then either only a or b can be nonzero, or if ϕ=1 then a and b can both be non 
zero but are independent of one another.  This happens in homogeneous layers.  To find 
the vector in region 2 simply multiply this vector by m1 
 



 
where of course one must use the appropriate form (TE or TM) for M and mi.  In this way 
the eigenfunctions are found for all the regions, and then the field quantities are found by 
multiplying these eigenfunctions by the basis vectors derived in section 2.4. 
 
2.6 ADJOINT EIGENFUNCTIONS AND THE HILBERT SPACE NORM 
 
As discussed by previous authors  [8, 12], one must use the theory of non self-adjoint 
operators in order to proceed with the scattering calculation for cases where the index of 
refraction is complex.  A different Hilbert space norm is used here from all of the 
previous papers on modal models and it involves only the x components of the fields.  
This is the most natural choice for inner product since for the TE and TM modes, one of 
the basis fields (Ex or Bx) always vanishes.  Using Maxwell's equation, one can derive the 
following equations for the x components of the fields in a layer. 
 



 



 
A suitable inner product is  
 

1
∂
xnx
)(
∂

kxn
)(

kxn
)(

∂
x
∂

∂
y
∂

∂
x
∂

∂
y
∂

∂
z
∂

∂
z
∂

(36) 

(37) 

xn
)(

xE









xB

   

+

+

=

+

+

+

+

=

0

0

 

 

 

 

 

 

 

 

 

 

2

2

2

0

2

2

2

2

2

2

2

0

2

2

2

2

2

2

12

 

 

 

pitch

u v
,

=

∫

0

†
u
B B
x

v

x

+

2
n x E E

( )

†

u

v

x







x

dx

   

 

 

 

 

(38) 

 
This equation expresses a major difference between the current algorithm and all the 
previous modal algorithms which work with the field components parallel to the lines.  
The advantage of the inner product (38) is that it is immediately obvious that the TE and 
TM eigenfunctions are orthogonal with respect to this norm since for TE mode Ex is zero 
and for TM mode Bx is zero.   Moreover it is simpler to calculate than the norm used for 
example in [12].  It is easy to show that the following differential operators are self 
adjoint with respect to this inner product provided that n(x) is real 
 

LB

=

2)(
kxn

2

0

+

2

∂
x
∂

2

   

 

LE

=

2

)(
kxn

2

0

+

1
∂
)(
xnx
∂

2

∂
x
∂

)(
xn

2

 

 

 

 

 

 

 

 

 

 
When n(x) is not purely real, the operators LB and LE are no longer self adjoint.  To be 
able to proceed with a modal expansion for the total field, the adjoint operators and 
eigenfunctions must be considered.   The adjoint operators are  

†

BL

=

(

*
( )
n x

2

)

2

k

0

+

 

 

 

 

 

 

      (41)

†

EL

=

(

*
n x
( )

2

)

2

k

0

+

∂
x
∂

(

*
n x
( )

2

)

   

(

( )
n x

2*
)

 
The adjoint eigenfunctions for Bx (TE mode) satisfies the equation 
 
†
L B
B
x

*2
k B
)
z
x

   

=

+

k

(

 

 

 

 

 

2

y

 

 

(42) 

 
along with the Floquet condition 17.   The adjoint eigenfunction for Ex (TM mode) 
satisfies 
 
†
L E
E

*2
k E
)
z

   

=

+

k

(

 

 

 

 

 

 

 

2

x

x

y

(44) 

 
again with the Floquet condition. 
 
The adjoint eigenfunctions are generated by using the matrix functions (15) and (16) but 
using the conjugate values for the k's and n's. 
 
The eigensolutions come in pairs corresponding to opposite signs of kz.   The fields 
within a given layer can be expanded in the eigenfunctions of that layer 

 

 

 

 

 

 

 

 

(39) 

(40) 

 

(43) 

 
 
  
 

1

2

∂
x
∂

2

∂
x
∂

13

 

 
 
F

=

∑

n

b
n

TE
F
n

n
x B x e
( )
( )
x

ik y ik

+

y

z n
,

z

e
n

TM
F
n

n
x E x e
( )
( )
x

ik y ik

+

y

z n
,

z

  

 

 

(45) 

+

∑

n

n

n

TE

TM

nF

nF

( )x

( )x

 and 

xE x and 
( )

 
In this expression, F is a 6 dimensional vector (Ex,Ey,Ez,Bx,By,Bz) containing both fields.  
 are the (6d) polarization basis vectors for TE and TM 
The quantities 
modes calculated in section 2.4.  They depend in a stepwise way on the region which is 
determined by the value of x.  The functions 
eigenfunctions for Ex and Bx of section 2.5.  The complex numbers bn and en are the 
amplitudes of the nth TE and TM mode respectively.  The index n refers to which mode 
is being considered.   The modes come in pairs which have opposite signs for kz. 
 
 
The eigenfields for the two signs of kz for a given pair are not orthogonal.  However, they 
can be distinguised by considering z derivatives of F.   For such a pair the functions 
nF differ.  A projection operation can be 

and 
defined which projects out the positive kz and negative kz contributions as follows 
 

xE are the same, but the vector fields 

xB x are the normalized 

xB  

( )

TE

n

n

ik

z n
,

φ

n

F

±

φ

n

F
∂

/

dz

φ

n

F
±

=

2
ik

z n
,

   

 

 

 

 

 

(46) 

 
In general kz can be complex, and so deciding whether to group a given kz with the plus 
or minus set is possibly ambiguous.   The only layers where the choice makes a 
difference is in the superstrate and the substrate.  In the substrate one makes a distinction 
between causally allowed waves (downward traveling or exponentially decaying) and 
forbidden waves (upward traveling or exponentially growing).    In the substrate therefore 
one can group all forbidden waves together and all allowed waves together and label 
them + and - respectively. 
 
2.7  BOUNDARY CONDITIONS AT LAYER INTERFACES 
 
All components of B are continuous at the boundary.  The tangential components of E are 
continuous and n2Ez is continuous.  The object is to be able to calculate the fields just 
below the layer interface given the fields just above the layer interface.  The following 
relations follow from the basic boundary conditions together with Maxwell's equations 
 
 
 
E

(47) 

E

=

 

 

 

 

 

 

 

 

 

x

lower

x

upper

 

E
∂
x
z
∂

=

lower

n

2
upper
n

2
lower

E
∂
x
z
∂



i
ω



n

2
upper
n

2
lower



1



−

upper

−

B

y

upper

 

 

 

 

 

(48) 

 

 
B

 

B
∂
x
z
∂

 
B
∂

y
z
∂

14

(49) 

(50) 

(51) 

x

lower

x

upper

=

B

 

 

 

 

 

=

1

−

lower






n
n

2
lower
2
upper

B
∂
z
x
∂






+

upper

n
n

2
lower
2
upper

B
∂
x
z
∂

 

upper

=

lower

+

ik

yin

1(

−

upper

)

B

z

upper

  

n
n

2
lower
2
upper

B
∂

y
z
∂

n
n

2
lower
2
upper
 

 

 

 

 

 

 

 

 

 

 

 

 

 

 
 
2.8  LAYER TO LAYER OVERLAP INTEGRALS 
 
The scattering calculation boils down to calculating the overlap integral between a single 
eigenfield in the upper layer and the eigenfields in the lower layer.   Once this matrix is 
known for each layer interface it is easy to solve the scattering problem.   
 
Start with a single eigenmode in the upper layer.  Apply (47-51) to the eigenfield to 
calculate the fields in the lower layer.  The continued fields will no long be a single 
eigenmode, but will be a superposition of the eigenmodes in that layer.   The lower layer 
will in general contain upward traveling and downward traveling waves (both signs of 
kz).   The components of the various eigenmodes in the lower layer are calculated using 
(46).   
 
There is a complication to this procedure.  The following class of integrals must be 
calculated: 
 

I

= ∫

2
n
lower

†φ
n

dE
z
dx

lower

dx

 

 

 

 

 

 

 

 

(52) 

The problem is that 

dEz  has singularities at the region boundaries which complicate the 
dx

integral.  The following artifice facilitates the calculation of (52).   Notice that 
 
dE
x
dz

dE
z
dx

0=

Bik

−

 

 

 

 

 

 

 

 

 

y

 
But By is continuous at all boundaries.   Substituting into (52) one obtains 
 
 

(53) 

I

=

∫

2
n
lower

†
φ (
n

dE
z
dx

+

ik B
z
0

)

dx

 

 

lower

 

 

 

 

 

(54) 

 

 

 

15

Now comes the trick.  Integrate the first term by parts to eliminate the singular behavior.   
 

I

=

∫

2
n
lower

φ

n

†

ik B dx
y

0

−

†

φ

n

dn

2
lower
dx

∫

E

z lower

dx

  

 

 

 

 

(55) 

 
In this form the integral is easy to evaluate numerically.   Without this technique it is 
quite difficult to get the algorithm to work properly using the norm (38). 
 
2.9  SOLUTION TO THE SCATTERING PROBLEM 
 
The Field in a given layer is described by a state vector of amplitudes for the various 
eigenmodes.  Once the state vector is known in a given layer, it can be inferred for all 
other layers.  Upward traveling and downward traveling modes with opposite signs for kz 
may be considered as distinct modes for the purpose of this discussion.  Practical 
considerations require that the infinite series be approximated by a finite size vector of 
dimension N.  For simplicity let's assume that the dimension at each layer is the same, 
although this isn't strictly necessary.  Then the overlap matrix is always an N by N 
matrix.  What is desired is a matrix - called the T matrix - which couples a state vector in 
the superstrate with a state vector in the substrate.  It can be calculated from the following 
formula: 
 

T

=

O
N

+

1,

N

L

L

exp(

ik h O
j

)

j
z

 

j

,

j

1
−

 

 

 

 

 

 

(56) 

N

L

⋅∏

j

1
=

 
where O is the N by N overlap matrix and vector array notation is used for the 
exponentiation and where kz is an N dimensional vector signifying the kz values for the N 
eigenmodes and hj is the vertical thickness of the layer j.  There are NL layers between the 
superstrate and the substrate. 
 
In order to solve the scattering problem one must break T up into 4 submatrices 
corresponding to coupling between upward and downward traveling waves in the 
substrate and in the superstrate.  Let an up arrow denote an upward traveling wave and a 
down arrow a downward traveling wave.   An exponentially decaying wave which decays 
in the upward direction will also have an up arrow and one that decays in the downward 
direction will have a down arrow.  Consistency requires that for a complex index of 
refraction in the substrate that the real and imaginary part of kz have the same sign.  This 
turns out always to be the case in our experience with the software.  So the T matrix may 
be written: 
 

 

 

 

 

 

 

 

 

(57) 

T

=

T


T


↑↑

↓↑

T
T

↑↓

↓↓





 

 
The dimension of each sub matrix is N/2 by N/2.   The scattering equation is 
 

16

−

−

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

↑↑

↑↓

↑↓

↑↑

↑↓

e

e

0

T

=

T

↓

   

1
T

1T

















↓=

+↑

↑
↓

↑
↓

0↑=

(60) 

(59) 

(58) 

−↑=

T
↑↓
T
↓↓

T

↑↑

T

↓↑

T
↑↑−=

substrate

superstrat

superstrat

superstrat
e

substrate
substrate

superstrate
superstrate

 and therefore one may derive that 




 
but causality requires 
 
T
 
Solving for the unknown reflected wave one obtains 
 
superstrat
e
 
So the reflecting S matrix is 
 
S ref
 
Likewise the transmission S matrix is 
 
S
 
The result of one calculation gives a multitude of diffraction orders corresponding to the 
incoming and outgoing kx value taking values of 
p/2π  
 
2.10  CALCULATION OF DIFFRACTION EFFICIENCIES 
 
Whenever ky is zero, the TE and TM modes decouple.  That is, if the incoming wave is 
purely TE (TM) then the outgoing wave is purely TE (TM) also.  When ky is not zero the 
two polarization modes are coupled. Let us consider a purely dielectric superstrate for 
reflection, and a purely dielectric superstrate and substrate for transmission.  Also or 
transmission, let the superstrate and substrate be the same material.  The formulas for the 
diffraction efficiency matrix are  
 
For reflection: 
 

xk  plus a integer multiples of 

ST
↓↑

(61) 

(62) 

tran

T

=

+

↓↓

ref

 

 

 

 

 

 

 

 

 

 

 

 

 

 

i

 

D

ref

[

out

,

in

]

=

 
For transmission: 
 

D

tran

[

out

,

in

]

=

k

k

zout
2

zin

2

+

k

+

k

y

2
y
2

k
k

zin

zout

S

ref

[

out

,

in

]

   

2

k

k

zout
2

zin

2

+

k

+

k

y

2
y
2

k
k

zin

zout

S

tran

[

out

,

in

]

2

  

 

 

 

 

 

 

 

 

(63) 

(64) 

 

 

 

17

The reciprocity property of Maxwell's equations requires that in many cases D is a 
symmetrical matrix.  This is more usually the case for reflection mode, but is also true in 
transmission if the scattering object is invariant under a parity transformation in the z 
coordinate. 
 
2.11  DISCUSSION OF NUMERICAL RESULTS 
 
The algorithm has been coded in C++ in three different versions using double precision, 
double-double precision and quad-double precision arithmetic [31].  It was found that 
double-double precision arithmetic was required for all but the simplest of problems.   
Comparisons with the results tabulated in Table 1 of  [29] are shown in figure 4.   The 
IESMP and Metrologia models are described in [29].   Only TM results are shown since 
the TE case is not particularly challenging, and the agreement is several orders of 
magnitude better for TE than for TM.  The reciprocity error for TE is also a much smaller 
value of 1.65e-07 (averaged over the range of heights in figure 4).   
 

 

18

TM Polarization Diffraction Efficiencies, zero order and normal incidence,
Aluminum/Aluminum reflection grating at 436 nm, pitch fixed = 1000 nm, height varies,
width=space, (n,k)=(0.47,4.8)

Standard Deviation of This Model - IESMP = 0.0027
Standard Deviation of This Model - Metrologia = 0.0015
Standard Deviation of Metrologia - IESMP = 0.0018
Average Reciprocity error of This Model = 0.00157

This Model

IESMP Metrologia

1

0.9

0.8

0.7

0.6

0.5

0.4

0.3

0.2

0.1

y
c
n
e

i

c

i
f
f

 

E
n
o
i
t
c
a
r
f
f
i

D

0
0.00

0.20

0.40

0.60

0.80

1.00

1.20

height/pitch

Figure 4 

 

 
 
 
 
Figure 5 shows a comparison of calculations of the glass transmission grating of Figure 7 
in [29]. 
 
 
 
 
 
 

 

i

)

(
 
y
c
n
e
c
i
f
f
e
 
n
o
i
t
c
a
r
f
f
i

 
 
 
 
 
 
 
%
 
 
 
 
 
 
 
D
 
 
 
 
 
 
 
 
 
%
 
 
 
 
 
 
 
D
 
 
 
 

(
 
y
c
n
e
c
i
f
f
e
 
n
o
i
t
c
a
r
f
f
i

)

i

41
39

37
35
33
31
29
27
25

41
39
37
35
33
31
29
27
25

SiO2 on SiO2  transmission grating wavelength = 633nm, 1st order, Normal Incidence
width = space, height = 633 nm.
TE Polarization

1000

1190.5

1666.7

2000

2500

5000

19

IESMP
Metrologia
Current Model

IESMP
Metrologia
Current Model

pitch d [nm]

TM Polarization

pitch d [nm]

Figure 5 
 

1000

1190.5

1666.7

2000

2500

5000

In Figures 6 and 7 a comparison is made between the current model and a commercial 
code which will be described here as Model X where the incident angles varies from 0 to 
75 degrees.    
 

 

 

0.60

0.50

0.40

0.30

0.20

0.10

0.00

y
c
n
e

i

c
i
f
f
e
 
n
o
i
t
c
a
r
f
f
i

D

Etched Silicon, zero order
wavelength = 6328 nm
(n,k)=(3.872923,0.031331)
pitch = height =1000 nm, width = space

TE Model X
TE Current Model

TM Model X
TM Current Model

0.00

20.00

40.00

60.00

80.00

Incident angle (degrees)

Figure 6 
 

20

 

 

21

Etched SiO2, zero order
wavelength = 6328 nm
(n,k)=(1.465,0.0)
pitch = height =1000 nm, width = space

TE Model X

TM Mode Xl

TE Current Model

TM Current Model

0.20

0.15

0.10

0.05

0.00

y
c
n
e
i
c
i
f
f
e
 
n
o
i
t
c
a
r
f
f
i

D

0.00

20.00

40.00

60.00

80.00

Incident angle (degrees)

Figure 7 

 

 
 
Table 1 shows a comparison between the current model and the Metrologia model for a 
mulitlayered structure. 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

22

 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

Description of Object 
 
 
 
 
 
     
 
 
 
 
Diffraction Order 
0 
1 
 
 
0 
1 

 
 
 

 
 
 

 
 

 
 

 

Normal Incidence Illumination 
Wavelength = 6328 nm; pitch = 1000 nm; 5 layer object, etched SiO2 
(n,k)=(1.465,0.0) 
Layer #1: width of SiO2 = 300 nm,  height = 100 nm 
Layer #2: width of SiO2 = 350 nm,  height = 100 nm 
Layer #3: width of SiO2 = 400 nm,  height = 100 nm 
Layer #4: width of SiO2 = 450 nm,  height = 100 nm 
Layer #5: width of SiO2 = 500 nm,  height = 100 nm 

TE Metrologia  
 
0.0008208 
 
0.0131281 

TE Current Model 
0.0008125 
0.0131348 

 

TM Metrologia 
 
0.0004078 
 
0.0106176 

TM Current Model 
0.0004104 
0.0106099 

Table 1 

 
Reciprocity of the solutions was calculated when relevent, and used as a sanity check on 
numerical solutions.    Large pitches, large numbers of regions, and highly conductive 
materials all posed challenges for the algorithm.    The principle problems encountered 
were: 
 
1.  Eigenvalue degeneracies that couldn't be removed by the techniques in 2.3.  This 
problem can be addressed by choosing larger number of morphing steps and by adding 
small random dimensions to repeating lines in a sub-periodic array. 
 
2.  Insufficient numerical precision in calculating the eigenfunctions.  This can be 
addressed by moving to quad or higher precision. 
 
Despite these problems, many non-trivial problems showed good reciprocity.  For 
example the data in table 2 shows results for a 5 line sub periodic structure similar to the 
one shown in Figure 1.  The results are presented without a comparison since none was 
available. 
 
 
 
 
 
 
 
 

Description of Object 

23

Wavelength = 248nm, pitch=3000nm, materials: SiO2 over Si. 
For SiO2 (n,k)=(1.508, 0.0)  
For Si      (n,k)=(1.68,3.58) 
Linewidths = 100nm, spaces = 100nm, height=100nm 
Target consists of sets of 5 equally spaced lines separated by 2100 nm gaps. 
Calculation results for reflection at normal incidence. 
Calculated TE reciprocity (worst off diagonal difference of the diffraction 
efficiency matrix) = 1.3e-4 
Calculated TM reciprocity= 1.0e-5 
 
Diffraction Efficiencies 
Order  TE Result 
0  
1  
2  
3  
4  
5  
6  
7  
8  
9  
10 
11 
12 

TM Result 
 
0.25843067 
0.13456641 
 
0.034869257   
6.5723882e-005 
0.0082766007  
0.0048356392  
0.00023264319 
0.0048731602  
0.0022670613  
0.00098247656 
0.0055509911  
0.00065724551 
0.0050951529  

0.46136406 
0.05222133 
0.013221011 
6.0562931e-005 
Table 2 
0.0039986665 
0.0027805878 
6.4767116e-006 
0.0015477937 
0.0015721377 
5.5515111e-005 
0.0010660416 
0.002499388 
0.0011042975 

 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

 
 
 
 
 
 
 
 
 

 
Table 2 

 
3.0 CONCLUSION 
 
The modal method can be extended in the way presented here to quite general grating 
structures.  The main difficulty with the implementation is the apparent need to use 
higher precision arithmetic for larger structures or for strong conductors.  Nevertheless, 
the technique offers promise as a tool for complex grating analysis.  The model could 
benefit from an improved method for calculating the eigenvalues, perhaps replacing some 
of the numerical estimates of derivatives with analytic expressions. 
 
ACKNOWLEDGEMENTS 
 
The author acknowledges valuable discussions with Yiping Xu, Ron Herschel, Gordon 
Kino, Bob Larrabbee, Rick Silver, and Egon Marx during the long course of this work.  
He also acknowledges the helpful and diligent suggestions made by the reviewers and 
implemented in the final version. 

REFERENCES 
 
1. 
2. 

 

3. 

4. 

5. 

6. 
7. 

8. 

9. 

10. 

11. 

12. 

13. 

14. 

15. 

16. 

17. 

18. 

19. 

20. 

24

Collin, R.E., J. Phys., 1956. 34: p. 398. 
Burckhardt, C.B., Diffraction of a plane wave at a sinusoidally stratified 
dielectric grating. J. opt. Soc. Am., 1966. 56: p. 1502-1509. 
Wirgin, A. and R. Deleuil, Theoretical and experimental investigation of a new 
type of blazed grating. J. opt. Soc. Am., 1969. 59: p. 1348. 
Maystre, D. and R. Petit, Diffraction par un reseau lamellaire infinement 
conducteur. Opt. Commun., 1972. 5: p. 90-93. 
Peng, S.T., T. Tamir, and H.L. Bertoni, Theory of periodic dielectric waveguides. 
IEEE Trans. Microwave Theory Tech., 1975. 23: p. 123-133. 
Knop, K., J. opt. Soc. Am., 1978. 68: p. 1206. 
Botten, L.C., et al., The dielectric lamellar diffraction grating. Opt. Acta, 1981. 
28: p. 413-428. 
Botten, L.C., et al., The finitely conducting lamellar diffraction grating. Opt. 
Acta, 1981. 28: p. 1087-1102. 
Botten, L.C., M.S. Craig, and R.C. McPhedran, Highly conductive lamellar 
diffraction gratings. Opt. Acta, 1981. 28: p. 1103-1106. 
Suratteau, J.Y., M. Cadillhac, and R. Petit, Sur la determination numerique des 
efficacites de certains reseaux dielectriques profonds. J. Opt. (Paris), 1983. 14: p. 
273-288. 
Tayeb, G. and R. Petit, On the numerical study of deep conducting lamellar 
diffraction gratings. Opt. Acta, 1984. 31: p. 1361-1365. 
Li, L., A modal analysis of lamellar diffraction gratings in conical mountings. J. 
Mod. Opt., 1993. 40: p. 553-573. 
Li, L., Multilayer modal method for diffraction gratings of arbitrary profile, 
depth, and permittivity. J. Opt. Soc. Am. A, 1993. 10(2): p. 2581-2591. 
Tamir, T. and S. Zhang, Modal Transmission-Line Theory of Multilayered 
Grating Structures. Journal of Lightwave Technology, 1996. 14(5): p. 914-927. 
Chernov, V.A., et al., X-ray performance of multilayer gratings: recent advances 
at SSRC. Nuclear Instruments and Methods in Physics Research A, 1998. 405: p. 
310-318. 
Chernov, V.A., V.I. Erofeev, and N.V. Kovalenko, Multilayer grating as a SR 
monochromator for Mossbauer spectroscopy. Nuclear Instruments and Methods 
in Physics Research A, 1998. 405: p. 337-340. 
Krastev, K., J.-M. Andre, and R. Barchewitz, Theoretical and experimental 
analysis of diffraction by a lamellar amplitude multilayer grating, in conical 
mountings, for the X-ray domain. J. Mod. Opt., 1997. 44(6): p. 1141-1154. 
Jiang, M., T. Tamir, and S. Zhang, Modal theory of diffraction by multilayered 
gratings containing dielectric and metallic components. J. Opt. Soc. Am. A., 
2001. 18(4): p. 807-820. 
Nyyssonen, D., Theory of Optical edge detection and imaging of thick layers. J. 
Opt. Soc. Am., 1982. 72: p. 1425-1436. 
Kirk, C.P., Precision Measurement of Microscope Images, in Electrical and 
Electronic Engineering. 1985, University of Leeds. p. 171. 

25

 

21. 

22. 

24. 

25. 

26. 

27. 

28. 

29. 

30. 

31. 

 

Yuan, C. and A.J. Strojwas. Modelling of  optical alignment and metrology 
schemes used in integrated circuit manufacturing. in Optical/Laser 
Microlithography III. 1990. SPIE. Vol. 1264. p. 203-218. 
Bishop, K.P., et al. Grating line shape characterization using scaterometry. in 
International Conference on the application and Theory of periodic structures. 
1991. San Diego. SPIE. Vol. 1545. p. 64-73. 

23.  McNeil, J.R., et al., scatterometry applied to microelectronics processing, in Solid 

State Technology. 1993. p. 29-30. 
Tadros, K., A.R. Neureuther, and R. Guerrieri. Understanding metrology of 
polysilicon gates through reflectance measurements and simulation. in Integrated 
Circuit Metrology, Inspection, and Process Control V. 1991. San Jose. SPIE. Vol. 
1464. p. 177-186. 
Jakatdar, N., et al. Characterization of a positive chemically amplified photoresist 
for process control. in Metrology, Inspection, and Process Control for 
Microlithography XII. 1998. San Jose. SPIE. Vol. 3332. p. 586-593. 
Davidson, M. Analytic Waveguide Solutions and the Coherence Probe 
Microscope. in International Conference on Microlithography. 1990. Leuven, 
Belgium. Elsevier, Amsterdam. MicroCircuit Engineering 90. Vol. ME90. p. 523-
526. 
Davidson, M., K. Monahan, and R. Monteverde. Linearity of Coherence Probe 
Metrology: Simulation and Experiment. in Integrated Circuit Metrology, 
Inspection, and Process Control V. 1991. San Jose. SPIE. Vol. 1464. p. 155-176. 
Davidson, M. and K. Monahan. Simulation of Linearity in Optical Microscopes. 
in Integrated Circuit Metrology, Inspection, and Process Control VI. 1992. San 
Jose. SPIE. Vol. 1673. p. 117-132. 
Davidson, M., B.H. Kleemann, and J. Bischoff. A comparison between rigorous 
light scattering methods. in Optical Microlithography X. 1997. San Jose. SPIE. 
Vol. 3051. p. 606-619. 
Botten, L.C., M.S. Craig, and R.C. McPhedran, Complex zeros of analytic 
functions. Comput. Phys. Comm., 1983. 29: p. 245-259. 
Hida, Y., X.S. Li, and D.H. Bailey. Algorithms for Quad-Double Precision 
Floating Point Arithmetic. in 15th IEEE Symposium on Computer Arithmetic 
(Arith-15 2001). 2001. Vail. IEEE. Vol. p.  

