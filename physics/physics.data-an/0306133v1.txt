3
0
0
2
 
n
u
J
 
7
1
 
 
]
n
a
-
a
t
a
d
.
s
c
i
s
y
h
p
[
 
 
1
v
3
3
1
6
0
3
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

CHEP03, La Jolla, California, March 24-28, 2003

1

Data compression using correlations and stochastic processes in the
ALICE Time Projection chamber

M.Ivanov
CERN, Switzerland
A.Nicolaucig
Ecole Polytechnique Federale Lausanne, Switzerland
A.Krechtchouk
Lomonosov Moscow State University, Russia

In this paper lossless and a quasi lossless algorithms for the online compression of the data generated by the
Time Projection Chamber (TPC) detector of the ALICE experiment at CERN are described.
The ﬁrst algorithm is based on a lossless source code modelling technique, i.e. the original TPC signal informa-
tion can be reconstructed without errors at the decompression stage. The source model exploits the temporal
correlation that is present in the TPC data to reduce the entropy of the source.
The second algorithm is based on a lossy source code modelling technique, i.e. it is lossy if samples of the TPC
signal are considered one by one. Nevertheless, the source model is quasi-lossless from the point of view of some
physical quantities that are of main interest for the experiment. These quantities are the shape, the location of
the center of gravity as well as the total charge of the signal.
In order to evaluate the consequences of the error introduced by the lossy compression, the results of the
trajectory tracking algorithms that process data oﬄine are analyzed, in particular, with respect to the noise
introduced by the compression. The oﬄine analysis has two steps: cluster ﬁnder and track ﬁnder. The results
on how these algorithms are aﬀected by the lossy compression are reported.
In both compression technique entropy coding is applied to the set of events deﬁned by the source model to
reduce the bit rate to the corresponding source entropy. Using TPC simulated data, the lossless and the lossy
compression achieve a data reduction to 49.2% of the original data rate and respectively in the range of 35%
down to 30% depending on the desired precision.
In this study we have focused on methods which are easy to implement in the frontend TPC electronics.

1. Introduction

ALICE (A Large Ion Collider Experiment) is an
experiment that will start in 2007 at the LHC (Large
Hadron Collider) at CERN [1, 2]. The experiment
will study collisions between heavy ions with energies
around 5.5 TeV per nucleon. The collisions will take
place at the center of a set of several detectors, which
are designed to track and identify the produced par-
ticles.

One of the main detectors of the ALICE experiment
is the Time Projection Chamber (TPC). Its task is
track ﬁnding, momentum measurement and particle
identiﬁcation by dE/dx. Good two-track resolution,
required for correlation studies, is one of the main
design goals.

The TPC is a large horizontal cylinder, ﬁlled with
gas, where a suitable axial electric ﬁeld is present.
When particles pass through, they ionize the gas
atoms, and the resulting electrons drift in the electric
ﬁeld. By measuring the arrival of electrons at the end
of the chamber, the TPC can reconstruct the path
of the original charged particles. The electrons are
collected by more than 570 000 sensitive pads where
they create signals. These signals are ampliﬁed by a
preampliﬁer–shaper and digitalized by a 10-bit A/D
converter at a sampling frequency of 5.66 MHz. The
digitalized signal is processed and formatted by an
Application Speciﬁc Integrated Circuit (ASIC) called
ALTRO (ALICE TPC Read-Out) [3]. At this stage,

THLT002

the overall throughput of the 570 000 channels is
around 8.4 GByte/s.

The total amount of the TPC data is expected to be
about 1 PBy per year. In order to keep the complex-
ity and cost of the data storage equipment as low as
possible, we have to reduce the volume of data using
suitable data compression methods. The cost reduc-
tion of the data storage system is roughly proportional
to the data compression factor. Furthermore, it is bet-
ter to implement the compression system in the front-
end electronics at the output of the ALTRO circuit,
so that the cost for the optical links, which carry data
out of the chamber to the following stages of the acqui-
sition chain, could be also reduced.More sophisticated
methods for TPC data compression based on online
tracking, which will be used further in data acquisition
chain are developed in Bergen and Heidelberg [4].

The use of a lossy source model, justiﬁed by the fact
that generally it can provide signiﬁcantly higher com-
pression ratios compared to lossless models, has the
drawback that some deterioration in the reconstruc-
tion of data must be accepted. Lossy source models
have become very popular in the last decade in the
ﬁeld of audio and video compression for their remark-
able performance. Lossy models have been carefully
designed so that reconstruction distortions are not
perceived using psychovisual or psychoacoustic mod-
els or they remain comparable with the intrinsic signal
noise.

2

CHEP03, La Jolla, California, March 24-28, 2003

Figure 1: Schematic view of the detection process in TPC (upper part - perspective view, lower part - side view).

Obviously, for physical data, psychovisual or psy-
choacoustic tests are meaningless or even not applica-
ble since the TPC signal is not to be observed by the
human eye or ear. In [5], the compression noise intro-
duced on the sample values by the described lossy or
quasi lossless techniques has been evaluated in terms
of RMS of the introduced Error (RMSE).

However, in this case, the RMSE, despite being a
simple and well known distortion measure, is not very
useful. The fundamental information that has to be
extracted from TPC data are not sample values them-
selves but the physical quantities that enable the re-
construction of particle trajectories. Therefore, the
correct way to evaluate the importance of the dis-
tortion introduced by the compression–decompression
process has to be related to the high level information
that is carried by the data. In particular, TPC data
are collected with the objective of measuring particle
energy and trajectory.

Therefore, the most eﬀective way to estimate the
consequences of the compression distortion error, is
to observe how the extraction of energy and trajec-
tories are aﬀected by the compression–decompression
process. A simple way to obtain these estimates
is to apply the cluster ﬁnding and tracking algo-
rithms on both simulated data and their compressed–
decompressed version and compare the results.

This article is arranged in the following way.
In
section 2, all stochastic processes relevant for particle
detection in ALICE TPC are brieﬂy described.
In
section 3, TPC data format is speciﬁed. In section 4,
diﬀerent lossless compression techniques are described
and their eﬃciencies are compared. In section 5, the
fast one dimensional lossy compression technique is
shown and the impact of compression–decompression
to the distortion of most important physical quantities
is demonstrated.

THLT002

CHEP03, La Jolla, California, March 24-28, 2003

3

2. Stochastic processes in TPC

2.3. Diffusion of electrons

2.1. Ionization in gas

A charged particle that traverses the gas of the
chamber leaves a track of ionization along its trajec-
tory. The collisions with the gas atoms are purely
random. They are characterized by a mean free path
λ between ionizing encounters, which is given by the
ionization cross-section per electron σion and the den-
sity N of electrons:

λ = 1/(N σion).

Therefore, the number of encounters along the length
L has the mean of L/λ, and the frequency distribution
is given by Poisson distribution

P (L/λ, k) =

(L/λ)k
k!

exp(

L/λ).

−

The mean free path λ is given by the properties of the
gas and by charged particle characteristics:

λ =

Nprim

f (βγ)

,

1

×

where Nprim is the number of primary electrons per
cm produced by a Minimum Ionizing Particle (MIP),
and f (βγ) is Bethe–Bloch curve.

2.2. Generation of secondary electrons

The energy loss Etot released in primary ionization
to atomic electrons is a random variable. It can be de-
scribed by Photo-Absorbtion Ionization model (PAI).
In most cases, if one neglects the atomic shell struc-
ture, at suﬃciently high Etot (the energy where the
atomic shell structure is not more important) it obeys
1/E2

tot rule.

If the electron produced by the charged particle
has suﬃcient kinetic energy Etot, it will produce sec-
ondary electrons creating thus electron cluster. The
mean total number of electrons in such cluster is given
by:

Ntot =

Etot

Ipot

−
Wion

+ 1,

where Etot is the energy loss in a primary collision,
Wion is the eﬀective energy required to produce an
electron–ion pair and Ipot is the ﬁrst ionization po-
tential. The random character of the secondary ion-
ization process smears out structures in Etot spectra,
atomic shell structure behavior is suppressed. For ex-
−2.2
ample in the gas mixture 90% Ne, 10 % CO2 the E
tot
eﬀective parametrization at lower Etot can be used.

THLT002

Produced electrons drift through the gas with an
eﬀective constant drift velocity in the direction given
by the electric ﬁeld E and magnetic ﬁeld B (which we
assume are parallel to z-direction). Drifting electrons
are scattered on the gas molecules so that their direc-
tion of motion is randomized in each collision. The
position of the electron, after drifting over a distance
Ldrift, can be described by 3-D Gaussian distribution:

P (x, y, z) =

1
√2πσT
1
√2πσT
1
√2πσL

exp

exp

(cid:20)−

exp

(cid:20)−

(cid:20)−
(z

−

(x

(y

x0)2

−
2σ2
T
y0)2

−
2σ2
T
Ldrift)2
2σ2
L

(cid:21)

(cid:21)

,

(cid:21)

(1)

{

x0, y0, z0

is the electron creation point and
where
transversal diﬀusion σT respectively longitudinal dif-
fusion σL are given by drift length Ldrift and gas co-
eﬃcient DT and DL

}

σT = DT

Ldrift,

σL = DL

Ldrift.

p

p

B and unisochronity effect near

2.4. E
the anode wires

×

It has been assumed that the electric and magnetic
ﬁelds in the drift volume are uniform and parallel.
This, however, is not true close to the anode wires,
where the electric ﬁeld becomes radial. Thus the elec-
trons experience a shift along the wire direction (due
to the Lorentz force). If an electron enters the read-
out chamber at the point (xe, ye), it is displaced in the
x-direction (assuming that the wires are placed along
y-axis). The new y-position of the electron is then
given by

y = ye + ωτ

(x

xe) ,

·

−

where x is the coordinate of the wire on which an elec-
tron is collected, and ωτ is the tangent of Lorentz an-
gle (E
B eﬀect). The drift length which determines
z coordinate will be also aﬀected, because of change
in the path to the anode wire (unisochronity eﬀect).

×

2.5. Signal generation

Inside the readout chamber, as an electron drifts
towards the anode wire, it travels in an increasing
electric ﬁeld. Once the electric ﬁeld is strong enough
that between collisions with the gas molecules the
electron can pick up suﬃcient energy for ionization,

4

CHEP03, La Jolla, California, March 24-28, 2003

another electron is created and the avalanche starts.
As the number of electrons multiplies in successive
generations, the avalanche continues to grow until all
the electrons are collected on the wire. The resulting
number of electrons created in the avalanche, can be
described by an exponential probability distribution

P (q) =

exp

1
q ·

q
q

,

−

where q is the average avalanche amplitude.

An electron avalanche collected on the anode wire
induces a charge on the pad plane. This charge is inte-
grated over the pad area. The time signal is obtained
by folding the pad response to the avalanche with the
shaping function of the preampampliﬁer–shaper. This
signal is then sampled with a constant frequency. On
the top of sampled signal a random electronic noise is
superimposed.

As a result a charged particle interacting with gas
generates a cluster of amplitudes. This cluster is used
for later estimation of local track position and of local
energy deposition. The shape of the cluster is used
as additional information for the estimation of posi-
tion uncertainties and for the estimation of the overlap
factor between two tracks.

2.6. Accuracy of local coordinate
measurement

The accuracy of the coordinate measurement is lim-
ited by a track angle which spreads ionization and by
diﬀusion which ampliﬁes this spread.

The track direction with respect to pad plane is
given by two angles α and β (see ﬁg. 1). For the
measurement along the pad-row, the angle α between
the track projected onto the pad plane and pad-row is
relevant. For the measurement of the the drift coordi-
nate (z–direction) it is the angle β between the track
and z axis.

The ionization electrons are randomly distributed
along the particle trajectory. Fixing the reference x
position of a electron at the middle of pad-row, the y
(resp. z) position of the electron is random variable
characterized by uniform distribution with the width
La, where La is given by the pad length Lpad and the
angle α (resp. β):

La = Lpad tan α

The diﬀusion smears out the position of the electron
with gaussian probability distribution with σD. Con-
tribution of the E
B and unisochronity eﬀect is in
the case of Alice TPC negligible.

×

The accuracy of the position measurement can be

expressed as:

σz of cluster center in z (time) direction:

σ2
zCOG =

D2

LLdrift
Nch

Gg +

tan2 α L2

padGLfactor(Nprim)
12Nchprim

+ σ2

noise

(2)

and σy of cluster center in y(pad) direction:

D2

σ2
yCOG =

tan2 β L2

Gg +

TLdrift
Nch
padGLfactor(Nprim)
12Nchprim

+ σ2

noise

(3)

where Nch is the total number of electrons in cluster,
Nchprim is the number of primary electrons in cluster,
Gg is the gas gain ﬂuctuation factor parametrization,
GLfactor is the secondary ionization ﬂuctuation factor
and σnoise describe the contribution of the electronic
noise and ADC quantization to the resulting sigma of
the COG.

The typical resolution in the case of ALICE TPC is
1.0mm integrat-
0.8mm and σz

on the level of σy
ing over all clusters in the TPC.

∼

∼

2.7. Accuracy of the total amplitude
measurement

The total charge deposited in the clusters can be
used for particle identiﬁcation. The important value,
which is speciﬁc for diﬀerent particle types and dif-
ferent particle momenta, is the number of primary
collision per unit length, Nchprim. Nchprim is a ran-
dom variable described by Poisson distribution. Due
to the secondary ionization and gas gain ﬂuctuations
the total charge is described by very broad Landau
distribution.

3. The ALICE TPC read-out data format

Before describing the compression algorithm, it is
necessary to spend a few words on the format of data
at the output of ALTRO circuit, in order to under-
stand how the compression algorithms are applied.
Such data are indeed the input of the compression
system [1, 3].

In the ALTRO data format only the samples over
a given threshold are considered, while the others are
discarded. This means that, if we call bunch a group
of adjacent over-threshold samples coming from one
pad, the signal can be represented “bunch by bunch”.
More precisely, a bunch is described by three ﬁelds:
temporal information (temporal position of the last
sample in the bunch), one 10-bit word, bunch length
(i.e.
the number of samples in the bunch, one 10-
bit word), and sample amplitude values (few 10-bit
words).

THLT002

CHEP03, La Jolla, California, March 24-28, 2003

5

4. Lossless compression of TPC signals

Bunch length freq 0

1

2

3

4

The lossless techniques of the data compression are
based on the fact that TPC sample values (ADC
and temporal) are not equally probable. A theoret-
ical lower limit on the average word size using Huﬀ-
man codding, or arithmetic coding lossless technique
is given by entropy of the data source:

E(p) =

p(A) log2 p(A)

(4)

X

The lossless techniques described in this paper are
based mainly on an appropriate probability model for
each data ﬁeld of the ALTRO data format. Speciﬁc
probability models for each sample in a bunch were
developed. These models intend to capture both tem-
poral correlation among samples and the characteris-
tic shape of TPC electrical pulses.

4.1. Time information

As already mentioned, in the ALTRO data format
time information is represented as the 10-bit num-
ber of the time-bin of the last sample of the bunch.
The probability distribution of this variable is roughly
uniform. In order to achieve better compression ra-
tio this variable is substituted by the distance be-
tween two consecutive bunches. The probability of
this variable is described by exponential distribution
with much lower entropy factor. The entropy of tem-
poral information is given by mean distance between
two bunches.
It depends on the event multiplicity,
noise level and local occupancy, which is known func-
tion of the pad-row radius. In order to optimize en-
tropy coding, it will be necessary to investigate prob-
ability distribution as a function of track multiplicity.
This information will be known from other faster AL-
ICE detectors.

The mean number of bits used for the coding of time
information is roughly 4.9 bits for the full event with
maximal track density. Using diﬀerent codes in diﬀer-
ent places inside TPC, an additional 6% reduction in
time information can be achieved.

4.2. Bunch length

In the ALTRO data format, the bunch length is
represented as a 10-bit code number of samples in
the bunch. The bunch length depends on the diﬀu-
sion, the angular eﬀect and the total deposited energy.
There is no apparent correlation with data coded be-
fore. Small diﬀusion for short drift length is compen-
sated by big angular eﬀect. The total deposited en-
ergy is known only after coding of the bunch length.
Since no apparent correlation with other data (e.g.
length of adjacent bunches) exists and no better model

THLT002

1
2
3
4
5

136 2.21
279 4.04 4.04
422 4.64 5.5 4.64
241 4.18 6.67 6.02 4.18
53 3.83 6.1 7.15 6.1 3.83

Table I Entropy of the sample data as a function of the
sample position in the bunch. Frequency of the sample
length is given in arbitrary units.

(i.e. a model of events with lower entropy) could be
found, this information is coded directly.

4.3. Sample values coding

Sample values are the main contribution to the re-
sulting data volume. This subsection describes, ﬁrst a
basic model, and then introduces a more sophisticated
one, that can provide higher performances in terms of
compression eﬃciency.

Data compression can be obtained by directly ap-
plying entropy coding to the sample values without
any modelling of the information source. This method
will be referred bellow (in table II) as Entropy Coding
(EC).

4.4. Coding model based on the sample
position

Improvements in compression performance can be
obtained by appropriate modelling. A ﬁrst improve-
ment has been achieved by the fact that the statistics
of the signal sample values depend on the position of
the sample itself in the bunch.

Due to the pseudo Gaussian shape of most of the
bunches, the ﬁrst and the last sample of each bunch
are likely to have a smaller value with respect to those
in central positions. Similarly, small values are also
expected for isolated samples, i.e. belonging to one-
sample bunches (see table I).

Therefore, a classiﬁcation of the samples into three
classes was chosen: one class for isolated samples, one
for samples at the beginning and at the end of mul-
tiple sample bunches, and the last for samples in the
central positions of a bunch. Using three diﬀerent
probability distributions for entropy coding the sam-
ple values can be coded more eﬃciently than using
only one probability distribution. This coding scheme
will be referred in table II as coding using Sample
Position (SP).

6

CHEP03, La Jolla, California, March 24-28, 2003

Time Length Samples

Total

Altro 10 bits 10 bits 38.1 bits 58.1 bits(100%)
EC 4.9 bits 3.1 bits 22.4 bits 30.3 bits (52.5%)
SP
4.9 bits 3.1 bits 21.3 bits 29.2 bits (50.3%)
TC 4.9 bits 3.1 bits 20.7 bits 28.6 bits (49.2%)

Table II Performance of several lossless techniques
compared to the zero suppressed ALTRO data format.
ALTRO: original ALTRO data; EC: entropy coding of
sample values, bunch length, and time information; SP:
classiﬁcation of samples according to their position (3
code tables used); TC: coding technique that exploits
temporal correlation (20 code tables used). Numbers in
the columns represent the number of bits per bunch
dedicated to each ﬁeld; numbers in the right column
represent the overall number of bits per bunch, and, in
parenthesis, the size with respect to the original ALTRO
data format.

4.5. Source models exploiting temporal
correlation

Improvement on compression performances can be
expected by exploiting temporal correlation, i.e. the
correlation between consecutive samples; this can be
done by implementing a suitable prediction scheme.

This approach is explained on the example, where
a three-sample bunch is considered. Let us assume
that the ﬁrst two samples have already been coded
and that the third one has to be coded. The code to
be used for sample No. 3 may be chosen among eight
possible codes according to the value of sample No. 2.
In particular, this is done by subdividing the range of
sample No. 2 (i.e. 0. . . 1023) into diﬀerent intervals,
and associating a diﬀerent code (for the third sample)
to each of these intervals.

This conditioned probability model can be extended
to all the samples that are not in the ﬁrst position
in the bunch and for any bunch length. However,
if the real-time implementation constraints are taken
into account, and, in particular, the need to reduce
the memory size of the model, it is not good to have
an exceedingly large number of codes. Consequently,
samples are partitioned into four classes only, to keep
the complexity of the model low. This limitation does
reduce the eﬃciency of the model but the reduction
is only of the order of 0.6%. This coding scheme will
be referred in table II as coding using Temporal Cor-
relation (TC).

4.6. Comparison of different lossless
technique

The results of diﬀerent lossless approaches on sim-
ulated TPC data are shown in table II. It may be no-
ticed that the latter TC technique provides a compres-

sion of data down to 49.2% of the original size. Even
this best technique provides reduction factor only by
3% better then direct EC technique.

Additional attempt tried to use predicted mean
cluster shape information. Knowing the position of
the bunch, the diﬀusion given by drift length (Ldrift)
and inclination angle for primary particles are known.
However, due to the ﬂuctuation of cluster shape and
due to the large amount of secondary particles with
unknown angles, this prediction is not very good, and
the entropy of the samples is reduced only by addi-
tional factor 2%.

4.7. Space correlation

In the trial to exploit space correlation, three loss-
less models have been considered. The ﬁrst is based on
spatially conditioned probability, the second on a pre-
dictive model, third on 2-dimensional cluster ﬁnder,
with residual saving.

The ﬁrst one is the equivalent, in the spatial do-
main, to what has been done for time correlation. Dif-
ferent codes are available to code the samples; for each
sample, the appropriate code is selected according to
the value of the samples in the same time-bin but
in adjacent pads. This method provides poorer per-
formance when compared with the one which exploits
time correlation (the comparison being done using the
same model complexity, i.e. number of probability dis-
tributions available in memory). Moreover, these two
techniques cannot be easily combined, i.e.
it is diﬃ-
cult to exploit both temporal and spatial correlations
at the same time, because this would require a very
large number of probability distributions (i.e. code
tables).

The second method that has been investigated uses
the prediction of the sample values from the samples in
adjacent pads and coding the error of this prediction.
Unfortunately, also for this model, the performance is
not very good.

Pulses in one pad-row often resemble temporally
shifted versions of those in the adjacent pad-row. The
two methods described above have been modiﬁed by
adding the ﬁrst stage which shifts pulses so as to in-
crease spatial correlation with adjacent. Although
the performance has slightly improved, the increase
of the compression eﬃciency was lower than expected.
The correlations are relatively small. The main prob-
lems here are in the big amount of secondary particles
crossing TPC with unknown β angle (not pointing
to the primary vertex), big spread of the particle mo-
menta (unknown α angle) and the Landau ﬂuctuation
of deposited energy on diﬀerent pad rows, which is al-
most uncorrelated. Moreover, the position of the orig-
inal track relative to the pad, aﬀects the correlation
by a large factor. The signal amplitude in adjacent
pads and adjacent pad-rows are very weakly corre-

THLT002

CHEP03, La Jolla, California, March 24-28, 2003

7

lated, unless the position and direction of the track is
known.

In order to get better knowledge of the track posi-
tion, two-dimensional cluster ﬁnding can be done be-
fore. The entropy of the stored residuals is by 30%
lower than entropy of the original samples but there
are problems with the track overlaps and with descrip-
tion of the cluster topology (i.e. where to store resid-
uals).

Based on these results we conclude that it is not
simple to exploit spatial correlation (i.e. correlations
between adjacent channels). There might be more so-
phisticated and complex lossless models able to exploit
it, but relatively simple models seem to fail.

5. Lossy compression of TPC signals

5.1. Fluctuation and accuracy of the
amplitude measurement

The number of primary ionization electrons pro-
duced by the charged particle in the gas is the ran-
dom variable described by Poisson distribution with
the mean value 14.35 cm−1 for minimum ionizing
particle in the gas of Alice TPC. The secondary elec-
tron production (described by E−2.2 probability dis-
tribution) increases the number of produced electrons.
Maximum probable value is 25 cm−1 of total electrons.
This eﬀect also smears probability distribution to the
relatively broader Landau distribution.

Due to the angular eﬀect and diﬀusion, electrons are
distributed among several time-bins and pads. The
number of electrons which contributes to the given
pad and time-bin is described roughly by Poisson dis-
tribution. Each of the registered electrons is subject of
gas multiplication which is described by exponential
probability distribution. Over this, additional elec-
tronic noise is superimposed to each signal.

If we ﬁx the track position and the number of pri-
mary electrons, the remaining sample uncertainties
can be in the ﬁrst approximation estimated as:

σS =

σ2
noise + G

A

×

q

(5)

where σnoise is given by electronic noise and sampling
imprecision, and G is the gain conversion factor.

The situation is more complicated, data samples are
correlated through the time response function and the
pad response function. The relative correlation be-
tween the samples depends on the ratio of the width of
the response functions to the width given by stochas-
tic processes.

5.2. Dynamic precision of the digitization

In the following study, dynamic precision of sample
quantization was investigated. The quantization was

THLT002

no

0..1024
5.7
1.000
1.000
0.069
0.079

0..62

0..33

Koﬀ =1 Koﬀ =1.5 Koﬀ =1
Kcor=1 Kcor=1.5 Kcor=2
0..42
3.89(3.39) 3.34(2.84) 2.92(2.45)
1.006
1.015
0.071
0.081

1.000
1.005
0.070
0.079

1.030
1.04
0.074
0.083

range
entropy
σP
σT
σPRF
σTRF

Gain

4.61±0.69 4.63±0.70 4.64±0.71 4.66±0.72

Table III The inﬂuence of the lossy compression with
diﬀerent lossy parameters to the cluster characteristic. In
row 1 eﬀective range mapping shown. Entropy of the
samples are shown in row 2. Numbers in parenthesis
represent eﬀective entropy od data sample, using
diﬀerent code table for diﬀerent sample position in the
bunch. In row number 3 and 4 (σP and σT) the inﬂuence
of the lossy compression to the cluster space resolution in
pad respectively in time direction is shown. Row number
5 and 6 shows the relative inﬂuence of compression to the
shape of cluster in time and pad directions. Gain row
show the reconstructed ratio between total deposited
energy and numbers of contributing electrons to the
cluster.

chosen to correspond to the sample deviation, modi-
fying formula (5) to:

δd =

K 2

oﬀ + K 2

A

cor×

q

(6)

where Koﬀ and Kcor factors were chosen as free pa-
rameters. Koﬀ is proportional to the electronic noise
and Kcor is given by statistics of the stochastic pro-
cesses and by correlations. Diﬀerent combinations of
these factors were investigated.

In table III the inﬂuence of diﬀerent quantization
on the precision of the cluster characteristic determi-
nation is shown.

The gain factor G = At/Nel (At is the total charge
in cluster, Nel is the number of electrons contribut-
ing to the cluster) measures the precision of the local
deposited energy determination. This factor is im-
portant for dEdx measurement and consequently for
particle identiﬁcation (PID). The inﬂuence of the com-
pression on the cluster position determination varies
between 0 to 4%, depending on the compression fac-
tor, as can be expected. The shape of the cluster
(σPRF and σTRF), important for cluster quality deter-
mination, varies between 1 to 6%.

In table IV the inﬂuence of the compression on the
tracking is shown. Reported distortions in pt and an-
gular resolution are slightly smaller than in the case
of the cluster position(0% up to 3.5%) . This is due
to the other stochastic processes which contribute to
the track parameters e.g. the multiple scattering. For
high-momentum particles, where the inﬂuence of mul-
tiple scattering is not so important, the expected dis-

8

CHEP03, La Jolla, California, March 24-28, 2003

no

Koﬀ =1
Kcor=1

Koﬀ =1.5
Kcor=1.5

Koﬀ =1
Kcor=2

σφ[mrad]
σΘ[mrad]
σpt [%]
σdE/dx[r.u] 2.96±0.11

1.399±0.030 1.378±0.030 1.406±0.030 1.403±0.03
0.997±0.018 0.992±0.018 1.002±0.018 0.989±0.018
0.881±0.011 0.885±0.011 0.886±0.011 0.905±0.011
3.20±0.11

2.98±0.11

3.06±0.11

Table IV The inﬂuence of the lossy compression with diﬀerent lossy parameters on the track characteristics.

tortion will be determined by the cluster position dis-
tortions.

Reducing the number of the possible sample values,
vector quantization of bunches were also investigated.
Additional reduction factor of
6% was achieved on
top of the results reported in table III.

∼

ical quantities, particle momenta and dEdx is min-
imal. This approach achieves compression rates in
the range from 35% down to 30%, depending on the
desired precision. In this study we have focused on
methods which are easy to implement in the frontend
TPC electronics.

6. Conlusions

References

Several methods of lossless TPC data compression
was investigated (sec. 4.6). The best one dimensional
methods provide compression factor down to 49.2%.
A lossy compression approach for the data gener-
ated by the TPC chamber in the ALICE experiment
has been also investigated. The main idea was to
preserve, on the level intrinsic noise, the three more
important local quantities: the cluster position, the
deposited energy and the shape of the cluster. Keep-
ing the distortions of the local quantities at a reason-
able level, the impact on the most interesting phys-

[1] ALICE Collaboration, ALICE Technical Design

Report of the Time Projection Chamber

[2] ALICE

–

A

Large

Ion

Collider

Experiment,http://na49info.cern.ch/alice/html/detector

[3] L. Musa and R. E. Bosch, Alice TPC Readout chip,

Internal Note,2000

[4] TPC data compression, NIM A 489(2002),406-421
[5] A. Nicolaucig,Compressione dei dati generati dalla
Time Projection Chamber nell’esperimento AL-
ICE presso il CERN,2000

THLT002

CHEP03, La Jol la, California, Marh 24-28, 2003

1

Data compression using correlations and stochastic processes in the
ALICE Time Projection chamber

M.Ivanov
CERN, Switzerland
A.Nicolaucig
Ecole Polytechnique Federale Lausanne, Switzerland
A.Krechtchouk
Lomonosov Moscow State University, Russia

In this paper lossless and a quasi lossless algorithms for the online ompression of the data generated by the

Time Pro jetion Chamber (TPC) detetor of the ALICE experiment at CERN are desribed.

The (cid:12)rst algorithm is based on a lossless soure ode modelling tehnique, i.e. the original TPC signal informa-

tion an be reonstruted without errors at the deompression stage. The soure model exploits the temporal

orrelation that is present in the TPC data to redue the entropy of the soure.

The seond algorithm is based on a lossy soure ode modelling tehnique, i.e. it is lossy if samples of the TPC

signal are onsidered one by one. Nevertheless, the soure model is quasi-lossless from the point of view of some

physial quantities that are of main interest for the experiment. These quantities are the shape, the loation of

the enter of gravity as well as the total harge of the signal.

In order to evaluate the onsequenes of the error introdued by the lossy ompression, the results of the

tra jetory traking algorithms that proess data o(cid:15)ine are analyzed, in partiular, with respet to the noise

introdued by the ompression. The o(cid:15)ine analysis has two steps: luster (cid:12)nder and trak (cid:12)nder. The results

on how these algorithms are a(cid:11)eted by the lossy ompression are reported.

In both ompression tehnique entropy oding is applied to the set of events de(cid:12)ned by the soure model to

redue the bit rate to the orresponding soure entropy. Using TPC simulated data, the lossless and the lossy

ompression ahieve a data redution to 49.2% of the original data rate and respetively in the range of 35%

down to 30% depending on the desired preision.

In this study we have foused on methods whih are easy to implement in the frontend TPC eletronis.

1. Introduction

the overall throughput of the 570 000 hannels is

around 8.4 GByte/s.

ALICE (A Large Ion Collider Experiment) is an

experiment that will start in 2007 at the LHC (Large

The total amount of the TPC data is expeted to be

Hadron Collider) at CERN [1, 2℄. The experiment

about 1 PBy per year. In order to keep the omplex-

will study ollisions between heavy ions with energies

ity and ost of the data storage equipment as low as

around 5.5 TeV per nuleon. The ollisions will take

possible, we have to redue the volume of data using

plae at the enter of a set of several detetors, whih

suitable data ompression methods. The ost redu-

are designed to trak and identify the produed par-

tion of the data storage system is roughly proportional

tiles.

to the data ompression fator. Furthermore, it is bet-

One of the main detetors of the ALICE experiment

ter to implement the ompression system in the front-

is the Time Pro jetion Chamber (TPC). Its task is

end eletronis at the output of the ALTRO iruit,

trak (cid:12)nding, momentum measurement and partile

so that the ost for the optial links, whih arry data

identi(cid:12)ation by dE /dx. Good two-trak resolution,

out of the hamber to the following stages of the aqui-

required for orrelation studies, is one of the main

sition hain, ould be also redued.More sophistiated

design goals.

methods for TPC data ompression based on online

The TPC is a large horizontal ylinder, (cid:12)lled with

traking, whih will be used further in data aquisition

gas, where a suitable axial eletri (cid:12)eld is present.

hain are developed in Bergen and Heidelberg [4℄.

When partiles pass through, they ionize the gas

The use of a lossy soure model, justi(cid:12)ed by the fat

atoms, and the resulting eletrons drift in the eletri

that generally it an provide signi(cid:12)antly higher om-

(cid:12)eld. By measuring the arrival of eletrons at the end

pression ratios ompared to lossless models, has the

of the hamber, the TPC an reonstrut the path

drawbak that some deterioration in the reonstru-

of the original harged partiles. The eletrons are

tion of data must be aepted. Lossy soure models

olleted by more than 570 000 sensitive pads where

have beome very popular in the last deade in the

they reate signals. These signals are ampli(cid:12)ed by a

(cid:12)eld of audio and video ompression for their remark-

preampli(cid:12)er{shaper and digitalized by a 10-bit A/D

able performane. Lossy models have been arefully

onverter at a sampling frequeny of 5.66 MHz. The

designed so that reonstrution distortions are not

digitalized signal is proessed and formatted by an

pereived using psyhovisual or psyhoaousti mod-

Appliation Spei(cid:12) Integrated Ciruit (ASIC) alled

els or they remain omparable with the intrinsi signal

ALTRO (ALICE TPC Read-Out) [3℄. At this stage,

noise.

THLT002

2

CHEP03, La Jol la, California, Marh 24-28, 2003

Figure 1: Shemati view of the detetion proess in TPC (upper part - perspetive view, lower part - side view).

Obviously, for physial data, psyhovisual or psy-

Therefore, the most e(cid:11)etive way to estimate the

hoaousti tests are meaningless or even not applia-

onsequenes of the ompression distortion error, is

ble sine the TPC signal is not to be observed by the

to observe how the extration of energy and tra je-

human eye or ear. In [5℄, the ompression noise intro-

tories are a(cid:11)eted by the ompression{deompression

dued on the sample values by the desribed lossy or

proess. A simple way to obtain these estimates

quasi lossless tehniques has been evaluated in terms

is to apply the luster (cid:12)nding and traking algo-

of RMS of the introdued Error (RMSE).

rithms on both simulated data and their ompressed{

deompressed version and ompare the results.

However, in this ase, the RMSE, despite being a

simple and well known distortion measure, is not very

useful. The fundamental information that has to be

This artile is arranged in the following way.

In

extrated from TPC data are not sample values them-

setion 2, all stohasti proesses relevant for partile

selves but the physial quantities that enable the re-

detetion in ALICE TPC are brie(cid:13)y desribed.

In

onstrution of partile tra jetories. Therefore, the

setion 3, TPC data format is spei(cid:12)ed. In setion 4,

orret way to evaluate the importane of the dis-

di(cid:11)erent lossless ompression tehniques are desribed

tortion introdued by the ompression{deompression

and their eÆienies are ompared. In setion 5, the

proess has to be related to the high level information

fast one dimensional lossy ompression tehnique is

that is arried by the data. In partiular, TPC data

shown and the impat of ompression{deompression

are olleted with the ob jetive of measuring partile

to the distortion of most important physial quantities

energy and tra jetory.

is demonstrated.

THLT002

CHEP03, La Jol la, California, Marh 24-28, 2003

3

2. Stochastic processes in TPC

2.3. Diffusion of electrons

2.1. Ionization in gas

Produed eletrons drift through the gas with an

e(cid:11)etive onstant drift veloity in the diretion given

by the eletri (cid:12)eld E and magneti (cid:12)eld B (whih we

A harged partile that traverses the gas of the

assume are parallel to z-diretion). Drifting eletrons

hamber leaves a trak of ionization along its tra je-

are sattered on the gas moleules so that their dire-

tory. The ollisions with the gas atoms are purely

tion of motion is randomized in eah ollision. The

random. They are haraterized by a mean free path

position of the eletron, after drifting over a distane

(cid:21) between ionizing enounters, whih is given by the

L

, an be desribed by 3-D Gaussian distribution:

drift

ionization ross-setion per eletron (cid:27)

and the den-

ion

sity N of eletrons:

1

(x (cid:0) x

)

P (x; y ; z ) =

exp

(cid:0)

p

(cid:20)

(cid:21)

2(cid:25)(cid:27)

T

T

2

2(cid:27)

(cid:20)

(cid:21)

1

(y (cid:0) y

)

p

exp

(cid:0)

2(cid:25)(cid:27)

T

T

(cid:20)

(cid:21)

2

0

2

0

2

2(cid:27)

2

drift

(cid:21) = 1=(N (cid:27)

):

ion

Therefore, the number of enounters along the length

L has the mean of L=(cid:21), and the frequeny distribution

1

(z (cid:0) L

)

is given by Poisson distribution

p

exp

(cid:0)

;

(1)

2(cid:25)(cid:27)

L

2(cid:27)

2

L

P (L=(cid:21); k) =

exp((cid:0)L=(cid:21)):

(L=(cid:21))

k

where fx

; y

; z

g is the eletron reation point and

0

0

0

k !

T

transversal di(cid:11)usion (cid:27)

respetively longitudinal dif-

fusion (cid:27)

are given by drift length L

and gas o-

L

drift

The mean free path (cid:21) is given by the properties of the

eÆient D

and D

T

L

gas and by harged partile harateristis:

(cid:21) =

;

1

N

(cid:2)f ((cid:12)(cid:13) )

prim

(cid:27)

= D

L

;

T

T

drift

p

p

(cid:27)

= D

L

:

L

L

drift

where N

is the number of primary eletrons per

prim

m produed by a Minimum Ionizing Partile (MIP),

and f ((cid:12)(cid:13) ) is Bethe{Bloh urve.

2.4. E(cid:2)B and unisochronity effect near
the anode wires

2.2. Generation of secondary electrons

It has been assumed that the eletri and magneti

(cid:12)elds in the drift volume are uniform and parallel.

The energy loss E

released in primary ionization

tot

This, however, is not true lose to the anode wires,

to atomi eletrons is a random variable. It an be de-

where the eletri (cid:12)eld beomes radial. Thus the ele-

sribed by Photo-Absorbtion Ionization model (PAI).

trons experiene a shift along the wire diretion (due

In most ases, if one neglets the atomi shell stru-

to the Lorentz fore). If an eletron enters the read-

ture, at suÆiently high E

(the energy where the

tot

out hamber at the point (x

; y

), it is displaed in the

e

e

atomi shell struture is not more important) it obeys

x-diretion (assuming that the wires are plaed along

1=E

rule.

2

tot

y-axis). The new y-position of the eletron is then

If the eletron produed by the harged partile

given by

has suÆient kineti energy E

, it will produe se-

tot

ondary eletrons reating thus eletron luster. The

y = y

+ !(cid:28) (cid:1) (x (cid:0) x

) ;

e

e

mean total number of eletrons in suh luster is given

where x is the oordinate of the wire on whih an ele-

by:

tron is olleted, and !(cid:28) is the tangent of Lorentz an-

N

=

+ 1;

tot

z oordinate will be also a(cid:11)eted, beause of hange

in the path to the anode wire (unisohronity e(cid:11)et).

E

(cid:0) I

tot

pot

W

ion

gle (E(cid:2)B e(cid:11)et). The drift length whih determines

where E

is the energy loss in a primary ollision,

tot

W

is the e(cid:11)etive energy required to produe an

ion

2.5. Signal generation

eletron{ion pair and I

is the (cid:12)rst ionization po-

pot

tential. The random harater of the seondary ion-

Inside the readout hamber, as an eletron drifts

ization proess smears out strutures in E

spetra,

towards the anode wire, it travels in an inreasing

tot

atomi shell struture behavior is suppressed. For ex-

eletri (cid:12)eld. One the eletri (cid:12)eld is strong enough

ample in the gas mixture 90% Ne, 10 % CO

the E

that between ollisions with the gas moleules the

(cid:0)2:2

2

tot

e(cid:11)etive parametrization at lower E

an be used.

eletron an pik up suÆient energy for ionization,

tot

THLT002

4

CHEP03, La Jol la, California, Marh 24-28, 2003

another eletron is reated and the avalanhe starts.

2

2

tan

(cid:11) L

G

(N

)

pad

Lfator

prim

+ (cid:27)

(2)

2

noise

As the number of eletrons multiplies in suessive

12N

hprim

generations, the avalanhe ontinues to grow until all

the eletrons are olleted on the wire. The resulting

and (cid:27)

of luster enter in y(pad) diretion:

y

number of eletrons reated in the avalanhe, an be

desribed by an exponential probability distribution

1

q

P (q) =

(cid:1) exp (cid:0)

;

q

q

2

2

2

T

2

D

L

drift

(cid:27)

=

G

+

g

y

COG

N

h

where q is the average avalanhe amplitude.

12N

hprim

An eletron avalanhe olleted on the anode wire

tan

(cid:12) L

G

(N

)

pad

Lfator

prim

+ (cid:27)

(3)

2

noise

indues a harge on the pad plane. This harge is inte-

where N

is the total number of eletrons in luster,

h

grated over the pad area. The time signal is obtained

N

is the number of primary eletrons in luster,

by folding the pad response to the avalanhe with the

G

is the gas gain (cid:13)utuation fator parametrization,

shaping funtion of the preampampli(cid:12)er{shaper. This

G

is the seondary ionization (cid:13)utuation fator

signal is then sampled with a onstant frequeny. On

and (cid:27)

desribe the ontribution of the eletroni

noise

the top of sampled signal a random eletroni noise is

noise and ADC quantization to the resulting sigma of

hprim

g

Lfator

superimposed.

the COG.

As a result a harged partile interating with gas

The typial resolution in the ase of ALICE TPC is

generates a luster of amplitudes. This luster is used

on the level of (cid:27)

(cid:24) 0.8mm and (cid:27)

(cid:24) 1.0mm integrat-

y

z

for later estimation of loal trak position and of loal

ing over all lusters in the TPC.

energy deposition. The shape of the luster is used

as additional information for the estimation of posi-

tion unertainties and for the estimation of the overlap

fator between two traks.

2.6. Accuracy of local coordinate
measurement

2.7. Accuracy of the total amplitude
measurement

The total harge deposited in the lusters an be

used for partile identi(cid:12)ation. The important value,

whih is spei(cid:12) for di(cid:11)erent partile types and dif-

The auray of the oordinate measurement is lim-

ferent partile momenta, is the number of primary

ited by a trak angle whih spreads ionization and by

ollision per unit length, N

. N

is a ran-

hprim

hprim

di(cid:11)usion whih ampli(cid:12)es this spread.

dom variable desribed by Poisson distribution. Due

The trak diretion with respet to pad plane is

to the seondary ionization and gas gain (cid:13)utuations

given by two angles (cid:11) and (cid:12) (see (cid:12)g. 1). For the

the total harge is desribed by very broad Landau

measurement along the pad-row, the angle (cid:11) between

distribution.

the trak pro jeted onto the pad plane and pad-row is

relevant. For the measurement of the the drift oordi-

nate (z{diretion) it is the angle (cid:12) between the trak

and z axis.

The ionization eletrons are randomly distributed

along the partile tra jetory. Fixing the referene x

3. The ALICE TPC read-out data format

position of a eletron at the middle of pad-row, the y

Before desribing the ompression algorithm, it is

(resp. z) position of the eletron is random variable

neessary to spend a few words on the format of data

haraterized by uniform distribution with the width

at the output of ALTRO iruit, in order to under-

L

, where L

is given by the pad length L

and the

a

a

pad

stand how the ompression algorithms are applied.

Suh data are indeed the input of the ompression

angle (cid:11) (resp. (cid:12) ):

system [1, 3℄.

L

= L

tan (cid:11)

a

pad

In the ALTRO data format only the samples over

The di(cid:11)usion smears out the position of the eletron

a given threshold are onsidered, while the others are

with gaussian probability distribution with (cid:27)

. Con-

D

tribution of the E(cid:2)B and unisohronity e(cid:11)et is in

disarded. This means that, if we all bunh a group

of adjaent over-threshold samples oming from one

the ase of Alie TPC negligible.

pad, the signal an be represented \bunh by bunh".

The auray of the position measurement an be

More preisely, a bunh is desribed by three (cid:12)elds:

expressed as:

(cid:27)

of luster enter in z (time) diretion:

z

2

L

2

D

L

drift

(cid:27)

=

G

+

g

z

COG

N

h

temporal information (temporal position of the last

sample in the bunh), one 10-bit word, bunh length

(i.e.

the number of samples in the bunh, one 10-

bit word), and sample amplitude values (few 10-bit

words).

THLT002

CHEP03, La Jol la, California, Marh 24-28, 2003

5

4. Lossless compression of TPC signals

Bunh length freq 0

1

2

3

4

1

136 2.21

The lossless tehniques of the data ompression are

2

279 4.04 4.04

based on the fat that TPC sample values (ADC

3

422 4.64 5.5 4.64

and temporal) are not equally probable. A theoret-

ial lower limit on the average word size using Hu(cid:11)-

4

241 4.18 6.67 6.02 4.18

man odding, or arithmeti oding lossless tehnique

5

53 3.83 6.1 7.15 6.1 3.83

is given by entropy of the data soure:

X

length is given in arbitrary units.

E (p) =

p(A) log

p(A)

(4)

2

Table I Entropy of the sample data as a funtion of the

sample position in the bunh. Frequeny of the sample

The lossless tehniques desribed in this paper are

based mainly on an appropriate probability model for

(i.e. a model of events with lower entropy) ould be

eah data (cid:12)eld of the ALTRO data format. Spei(cid:12)

found, this information is oded diretly.

probability models for eah sample in a bunh were

developed. These models intend to apture both tem-

poral orrelation among samples and the harateris-

ti shape of TPC eletrial pulses.

4.3. Sample values coding

4.1. Time information

Sample values are the main ontribution to the re-

sulting data volume. This subsetion desribes, (cid:12)rst a

As already mentioned, in the ALTRO data format

basi model, and then introdues a more sophistiated

time information is represented as the 10-bit num-

one, that an provide higher performanes in terms of

ber of the time-bin of the last sample of the bunh.

ompression eÆieny.

The probability distribution of this variable is roughly

Data ompression an be obtained by diretly ap-

uniform. In order to ahieve better ompression ra-

plying entropy oding to the sample values without

tio this variable is substituted by the distane be-

any modelling of the information soure. This method

tween two onseutive bunhes. The probability of

will be referred bellow (in table II) as Entropy Coding

this variable is desribed by exponential distribution

(EC).

with muh lower entropy fator. The entropy of tem-

poral information is given by mean distane between

two bunhes.

It depends on the event multipliity,

noise level and loal oupany, whih is known fun-

tion of the pad-row radius. In order to optimize en-

tropy oding, it will be neessary to investigate prob-

4.4. Coding model based on the sample
position

ability distribution as a funtion of trak multipliity.

Improvements in ompression performane an be

This information will be known from other faster AL-

obtained by appropriate modelling. A (cid:12)rst improve-

ICE detetors.

ment has been ahieved by the fat that the statistis

The mean number of bits used for the oding of time

of the signal sample values depend on the position of

information is roughly 4.9 bits for the full event with

the sample itself in the bunh.

maximal trak density. Using di(cid:11)erent odes in di(cid:11)er-

Due to the pseudo Gaussian shape of most of the

ent plaes inside TPC, an additional 6% redution in

bunhes, the (cid:12)rst and the last sample of eah bunh

time information an be ahieved.

are likely to have a smaller value with respet to those

4.2. Bunch length

in entral positions. Similarly, small values are also

expeted for isolated samples, i.e. belonging to one-

sample bunhes (see table I).

In the ALTRO data format, the bunh length is

Therefore, a lassi(cid:12)ation of the samples into three

represented as a 10-bit ode number of samples in

lasses was hosen: one lass for isolated samples, one

the bunh. The bunh length depends on the di(cid:11)u-

for samples at the beginning and at the end of mul-

sion, the angular e(cid:11)et and the total deposited energy.

tiple sample bunhes, and the last for samples in the

There is no apparent orrelation with data oded be-

entral positions of a bunh. Using three di(cid:11)erent

fore. Small di(cid:11)usion for short drift length is ompen-

probability distributions for entropy oding the sam-

sated by big angular e(cid:11)et. The total deposited en-

ple values an be oded more eÆiently than using

ergy is known only after oding of the bunh length.

only one probability distribution. This oding sheme

Sine no apparent orrelation with other data (e.g.

will be referred in table II as oding using Sample

length of adjaent bunhes) exists and no better model

Position (SP).

THLT002

6

CHEP03, La Jol la, California, Marh 24-28, 2003

Time Length Samples

Total

sion of data down to 49.2% of the original size. Even

Altro 10 bits 10 bits 38.1 bits 58.1 bits(100%)

this best tehnique provides redution fator only by

EC 4.9 bits 3.1 bits 22.4 bits 30.3 bits (52.5%)

3% better then diret EC tehnique.

SP

4.9 bits 3.1 bits 21.3 bits 29.2 bits (50.3%)

Additional attempt tried to use predited mean

TC 4.9 bits 3.1 bits 20.7 bits 28.6 bits (49.2%)

luster shape information. Knowing the position of

the bunh, the di(cid:11)usion given by drift length (L

)

drift

Table II Performane of several lossless tehniques

and inlination angle for primary partiles are known.

ompared to the zero suppressed ALTRO data format.

However, due to the (cid:13)utuation of luster shape and

ALTRO: original ALTRO data; EC: entropy oding of

due to the large amount of seondary partiles with

sample values, bunh length, and time information; SP:

unknown angles, this predition is not very good, and

lassi(cid:12)ation of samples aording to their position (3

the entropy of the samples is redued only by addi-

ode tables used); TC: oding tehnique that exploits

tional fator 2%.

temporal orrelation (20 ode tables used). Numbers in

the olumns represent the number of bits per bunh

dediated to eah (cid:12)eld; numbers in the right olumn

represent the overall number of bits per bunh, and, in

parenthesis, the size with respet to the original ALTRO

4.7. Space correlation

data format.

In the trial to exploit spae orrelation, three loss-

4.5. Source models exploiting temporal
correlation

less models have been onsidered. The (cid:12)rst is based on

spatially onditioned probability, the seond on a pre-

ditive model, third on 2-dimensional luster (cid:12)nder,

with residual saving.

The (cid:12)rst one is the equivalent, in the spatial do-

main, to what has been done for time orrelation. Dif-

Improvement on ompression performanes an be

ferent odes are available to ode the samples; for eah

expeted by exploiting temporal orrelation, i.e. the

sample, the appropriate ode is seleted aording to

orrelation between onseutive samples; this an be

the value of the samples in the same time-bin but

done by implementing a suitable predition sheme.

in adjaent pads. This method provides poorer per-

This approah is explained on the example, where

formane when ompared with the one whih exploits

a three-sample bunh is onsidered. Let us assume

time orrelation (the omparison being done using the

that the (cid:12)rst two samples have already been oded

same model omplexity, i.e. number of probability dis-

and that the third one has to be oded. The ode to

tributions available in memory). Moreover, these two

be used for sample No. 3 may be hosen among eight

tehniques annot be easily ombined, i.e.

it is diÆ-

possible odes aording to the value of sample No. 2.

ult to exploit both temporal and spatial orrelations

In partiular, this is done by subdividing the range of

at the same time, beause this would require a very

sample No. 2 (i.e. 0. . . 1023) into di(cid:11)erent intervals,

large number of probability distributions (i.e. ode

and assoiating a di(cid:11)erent ode (for the third sample)

tables).

to eah of these intervals.

The seond method that has been investigated uses

This onditioned probability model an be extended

the predition of the sample values from the samples in

to all the samples that are not in the (cid:12)rst position

adjaent pads and oding the error of this predition.

in the bunh and for any bunh length. However,

Unfortunately, also for this model, the performane is

if the real-time implementation onstraints are taken

not very good.

into aount, and, in partiular, the need to redue

Pulses in one pad-row often resemble temporally

the memory size of the model, it is not good to have

shifted versions of those in the adjaent pad-row. The

an exeedingly large number of odes. Consequently,

two methods desribed above have been modi(cid:12)ed by

samples are partitioned into four lasses only, to keep

adding the (cid:12)rst stage whih shifts pulses so as to in-

the omplexity of the model low. This limitation does

rease spatial orrelation with adjaent. Although

redue the eÆieny of the model but the redution

the performane has slightly improved, the inrease

is only of the order of 0.6%. This oding sheme will

of the ompression eÆieny was lower than expeted.

be referred in table II as oding using Temporal Cor-

The orrelations are relatively small. The main prob-

relation (TC).

lems here are in the big amount of seondary partiles

4.6. Comparison of different lossless
technique

rossing TPC with unknown (cid:12) angle (not pointing

to the primary vertex), big spread of the partile mo-

menta (unknown (cid:11) angle) and the Landau (cid:13)utuation

of deposited energy on di(cid:11)erent pad rows, whih is al-

most unorrelated. Moreover, the position of the orig-

The results of di(cid:11)erent lossless approahes on sim-

inal trak relative to the pad, a(cid:11)ets the orrelation

ulated TPC data are shown in table II. It may be no-

by a large fator. The signal amplitude in adjaent

tied that the latter TC tehnique provides a ompres-

pads and adjaent pad-rows are very weakly orre-

THLT002

CHEP03, La Jol la, California, Marh 24-28, 2003

7

lated, unless the position and diretion of the trak is

no

K

=1 K

=1.5 K

=1

o(cid:11)

o(cid:11)

o(cid:11)

known.

K

=1 K

=1.5 K

=2

or

or

or

In order to get better knowledge of the trak posi-

range

0..1024

0..62

0..42

0..33

tion, two-dimensional luster (cid:12)nding an be done be-

entropy

5.7

3.89(3.39) 3.34(2.84) 2.92(2.45)

fore. The entropy of the stored residuals is by 30%

lower than entropy of the original samples but there

(cid:27)

1.000

1.000

1.006

1.030

are problems with the trak overlaps and with desrip-

(cid:27)

1.000

1.005

1.015

1.04

P

T

tion of the luster topology (i.e. where to store resid-

PRF

(cid:27)

0.069

0.070

0.071

0.074

uals).

(cid:27)

0.079

0.079

0.081

0.083

TRF

Based on these results we onlude that it is not

Gain

4.61(cid:6)0.69 4.63(cid:6)0.70 4.64(cid:6)0.71 4.66(cid:6)0.72

simple to exploit spatial orrelation (i.e. orrelations

between adjaent hannels). There might be more so-

Table III The in(cid:13)uene of the lossy ompression with

phistiated and omplex lossless models able to exploit

di(cid:11)erent lossy parameters to the luster harateristi. In

it, but relatively simple models seem to fail.

row 1 e(cid:11)etive range mapping shown. Entropy of the

5. Lossy compression of TPC signals

5.1. Fluctuation and accuracy of the
amplitude measurement

samples are shown in row 2. Numbers in parenthesis

represent e(cid:11)etive entropy od data sample, using

di(cid:11)erent ode table for di(cid:11)erent sample position in the

bunh. In row number 3 and 4 ((cid:27)

and (cid:27)

) the in(cid:13)uene

P

T

of the lossy ompression to the luster spae resolution in

pad respetively in time diretion is shown. Row number

5 and 6 shows the relative in(cid:13)uene of ompression to the

shape of luster in time and pad diretions. Gain row

The number of primary ionization eletrons pro-

show the reonstruted ratio between total deposited

dued by the harged partile in the gas is the ran-

energy and numbers of ontributing eletrons to the

dom variable desribed by Poisson distribution with

luster.

the mean value 14.35 m

for minimum ionizing

(cid:0)1

partile in the gas of Alie TPC. The seondary ele-

tron prodution (desribed by E

probability dis-

hosen to orrespond to the sample deviation, modi-

tribution) inreases the number of produed eletrons.

fying formula (5) to:

Maximum probable value is 25 m

of total eletrons.

q

(cid:0)2:2

(cid:0)1

This e(cid:11)et also smears probability distribution to the

Æ

=

K

+ K

(cid:2)A

(6)

d

o(cid:11)

or

2

2

relatively broader Landau distribution.

Due to the angular e(cid:11)et and di(cid:11)usion, eletrons are

where K

and K

fators were hosen as free pa-

o(cid:11)

or

distributed among several time-bins and pads. The

rameters. K

is proportional to the eletroni noise

o(cid:11)

number of eletrons whih ontributes to the given

and K

is given by statistis of the stohasti pro-

or

pad and time-bin is desribed roughly by Poisson dis-

esses and by orrelations. Di(cid:11)erent ombinations of

tribution. Eah of the registered eletrons is sub jet of

these fators were investigated.

gas multipliation whih is desribed by exponential

In table III the in(cid:13)uene of di(cid:11)erent quantization

probability distribution. Over this, additional ele-

on the preision of the luster harateristi determi-

troni noise is superimposed to eah signal.

nation is shown.

If we (cid:12)x the trak position and the number of pri-

The gain fator G = A

=N

(A

is the total harge

t

el

t

mary eletrons, the remaining sample unertainties

in luster, N

is the number of eletrons ontribut-

el

an be in the (cid:12)rst approximation estimated as:

ing to the luster) measures the preision of the loal

q

2

deposited energy determination. This fator is im-

(cid:27)

=

(cid:27)

+ G(cid:2)A

(5)

S

noise

portant for dE dx measurement and onsequently for

where (cid:27)

is given by eletroni noise and sampling

noise

pression on the luster position determination varies

partile identi(cid:12)ation (PID). The in(cid:13)uene of the om-

impreision, and G is the gain onversion fator.

between 0 to 4%, depending on the ompression fa-

The situation is more ompliated, data samples are

tor, as an be expeted. The shape of the luster

orrelated through the time response funtion and the

((cid:27)

and (cid:27)

), important for luster quality deter-

PRF

TRF

pad response funtion. The relative orrelation be-

mination, varies between 1 to 6%.

tween the samples depends on the ratio of the width of

In table IV the in(cid:13)uene of the ompression on the

the response funtions to the width given by stohas-

traking is shown. Reported distortions in p

and an-

t

ti proesses.

gular resolution are slightly smaller than in the ase

5.2. Dynamic precision of the digitization

of the luster position(0% up to 3.5%) . This is due

to the other stohasti proesses whih ontribute to

the trak parameters e.g. the multiple sattering. For

In the following study, dynami preision of sample

high-momentum partiles, where the in(cid:13)uene of mul-

quantization was investigated. The quantization was

tiple sattering is not so important, the expeted dis-

THLT002

8

CHEP03, La Jol la, California, Marh 24-28, 2003

no

K

=1

K

=1.5

K

=1

o(cid:11)

o(cid:11)

o(cid:11)

K

=1

K

=1.5

K

=2

or

or

or

(cid:27)

[mrad℄

1.399(cid:6)0.030 1.378(cid:6)0.030 1.406(cid:6)0.030 1.403(cid:6)0.03

(cid:27)

[mrad℄

0.997(cid:6)0.018 0.992(cid:6)0.018 1.002(cid:6)0.018 0.989(cid:6)0.018

(cid:27)

[%℄

0.881(cid:6)0.011 0.885(cid:6)0.011 0.886(cid:6)0.011 0.905(cid:6)0.011

(cid:30)

(cid:2)

p

t

(cid:27)

[r.u℄ 2.96(cid:6)0.11

2.98(cid:6)0.11

3.06(cid:6)0.11

3.20(cid:6)0.11

dE=dx

Table IV The in(cid:13)uene of the lossy ompression with di(cid:11)erent lossy parameters on the trak harateristis.

tortion will be determined by the luster position dis-

ial quantities, partile momenta and dE dx is min-

tortions.

imal. This approah ahieves ompression rates in

Reduing the number of the possible sample values,

the range from 35% down to 30%, depending on the

vetor quantization of bunhes were also investigated.

desired preision.

In this study we have foused on

Additional redution fator of (cid:24)6% was ahieved on

methods whih are easy to implement in the frontend

top of the results reported in table III.

TPC eletronis.

6. Conlusions

References

Several methods of lossless TPC data ompression

was investigated (se. 4.6). The best one dimensional

[1℄ ALICE Collaboration, ALICE Tehnial Design

methods provide ompression fator down to 49.2%.

Report of the Time Pro jetion Chamber

A lossy ompression approah for the data gener-

[2℄ ALICE { A Large

Ion Collider Experi-

ated by the TPC hamber in the ALICE experiment

ment,http://na49info.ern.h/alie/html/detetor

has been also investigated. The main idea was to

[3℄ L. Musa and R. E. Bosh, Alie TPC Readout hip,

preserve, on the level intrinsi noise, the three more

Internal Note,2000

important loal quantities: the luster position, the

[4℄ TPC data ompression, NIM A 489(2002),406-421

deposited energy and the shape of the luster. Keep-

[5℄ A. Niolauig,Compressione dei dati generati dalla

ing the distortions of the loal quantities at a reason-

Time Pro jetion Chamber nell'esperimento AL-

able level, the impat on the most interesting phys-

ICE presso il CERN,2000

THLT002

