5
0
0
2
 
y
a
M
 
5
2
 
 
]
n
a
-
a
t
a
d
.
s
c
i
s
y
h
p
[
 
 
1
v
4
7
1
5
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Reconstruction of an object from its symmetry-averaged
diﬀraction pattern

1

Department of Physics, Cornell University, Ithaca, NY 14853-2501 USA. E-mail:

(Received 0 XXXXXXX 0000; accepted 0 XXXXXXX 0000)

Veit Elser *

ve10@cornell.edu

Abstract

By suitably generalizing the Fourier constraint projection in the diﬀerence map phas-

ing algorithm, an object can be reconstructed from its diﬀraction pattern even when

the latter has been incoherently averaged over a discrete group of symmetries. This

resolves an ambiguity in the recent proposal for aligning molecules by means of their

anisotropic dielectric interaction with an intense light ﬁeld. The algorithm is demon-

strated with simulated data in two and three dimensions.

1.

Introduction

If one is primarily interested in molecules, then crystals are merely a convenient align-

ment mechanism for improving the signal in a diﬀraction experiment. The near perfect

alignment of molecules within a crystal, however, comes at a cost. In a crystal, align-

ment is achieved by introducing translational periodicity as well, and this restricts the

sampling of the diﬀraction pattern to the crystal’s reciprocal lattice. A more complete

sampling of the diﬀraction pattern, also called oversampling, is desirable when retriev-

ing the phases in the pattern. This has led to the suggestion of alternate alignment

mechanisms (Spence & Doak, 2004), where not only would the molecules lack transla-

tional periodicity, but by arranging the molecular separations to be outside the range

PREPRINT: Acta Crystallographica Section A

A Journal of the International Union of Crystallography

2

of coherence of the illuminating radiation, all inter-molecular interference would be

eliminated. If such an “incoherent alignment” mechanism were realized, the scattered

radiation would form the diﬀraction pattern of an individual molecule and be signal

enhanced in proportion to the number of molecules in the illuminating beam.

One of the leading candidates for an incoherent alignment mechanism is the interac-

tion of an elliptically polarized light ﬁeld with the anisotropic molecular polarizability

(Larsen et al. , 2000). As already noted (Spence et al. , 2005), this scheme suﬀers from

the ﬂaw that the energetics of the molecular orientation is degenerate with respect

to a discrete symmetry group of order four generated by π-rotations about the prin-

cipal axes of the polarizability tensor. The scattered radiation from many molecules

will therefore be an average of four, generally distinct diﬀraction patterns, all related

by symmetry. An incoherently averaged pattern will have no simple (linear) relation-

ship to the scattering density: in particular, it does not correspond to the symmetry

average of the scattering density. Incoherence proves to be a blessing here as well, how-

ever. As we show below, the molecule’s scattering density can be reconstructed from

a symmetry-averaged diﬀraction pattern by a relatively straightforward modiﬁcation

of a projection-based phase retrieval algorithm.

Not surprisingly, reconstruction from a symmetry-averaged diﬀraction pattern places

greater demands on the degree of oversampling of the data. This should not pose a

problem for the proposed alignment mechanism when applied to molecules, however,

since the oversampling is then not limited by the transverse coherence of the illumi-

nating beam, but rather, the time needed to acquire the signal.

2. Diﬀerence map algorithm

We use the diﬀerence map algorithm (Elser, 2003a & 2003b), a general purpose itera-

tive method for ﬁnding a point in a Euclidean space that lies in the intersection of two

IUCr macros version 2.0β5: 2001/06/20

constraint sets. The key components of the algorithm are the two projections, that

given an arbitrary input, return as outputs the nearest points on the corresponding

constraint sets. For the reconstructions considered here, the ﬁrst projection imple-

ments the support and positivity constraint:

ΠS+ : ρr 7→ ρr

′ =

0 if r /∈ S or ρr < 0,
ρr otherwise.

(

Here ρr is the density at the direct space point r and S is the known or estimated

support of the scattering density.

The second projection implements the constraint provided by the diﬀraction data

and is most easily expressed in terms of the density in Fourier space, ρq. Since we

have a discrete group G that averages the diﬀraction pattern, we consider the action

of this projection on an orbit of densities {ρgq}g∈G :

The constraint is given by

ΠF : ρgq 7→ ρgq

′ .

|ρgq

′|2 = IGq ,

Xg∈G

where IGq is the diﬀraction intensity associated with the orbit Gq. The output of ΠF

satisﬁes (3) while also minimizing the distance

kρ − ρ′k2 =

|ρgq − ρgq

′|2 .

XGq Xg∈G

The derivation of a formula for the projection ΠF proceeds in two steps. First,

consider the nonnegative amplitudes

fgq = |ρgq|

fgq

′ = |ρgq

′| .

ρgq

′ =

′

fgq
fgq !

 

ρgq .

For any value of fgq

′ (to be determined later), the complex Fourier amplitude ρgq

′

that minimizes (4) subject to (6) is given by the projection to the circle:

IUCr macros version 2.0β5: 2001/06/20

3

(1)

(2)

(3)

(4)

(5)

(6)

(7)

The distance (4) can now be expressed in terms of the amplitudes:

kρ − ρ′k2 =

(fgq − fgq

′)2 .

XGq Xg∈G

In the second step of the derivation we minimize (8) with respect to fgq

′ subject to

the constraint (3) written as

(fgq

′)2 = IGq .

Xg∈G

This is solved by projecting to the sphere, in analogy to the circle projection in the

complex plane, only now the dimension of the sphere is one less the cardinality of the

orbit Gq (a divisor of the order of G):

fgq

′ =

IGq
g∈G(fgq)2
p

1/2 fgq .

Combining this with (7) we obtain the formula

(cid:16)P

(cid:17)

Below we use the diﬀerence map with β = 1, for which it reduces to a generalization

of Fienup’s input-output map (Fienup, 1982):

ΠF (ρgq) =

IGq
g∈G |ρgq|2
p

1/2 ρgq .

(cid:16)P

(cid:17)

D : ρ 7→ ρ′ = ρ + ∆(ρ)

∆(ρ) = ΠS+ (2 ΠF (ρ) − ρ) − ΠF (ρ) .

4

(8)

(9)

(10)

(11)

(12)

(13)

When the diﬀraction pattern is not symmetry-averaged, the limiting oversampling

ratio for real-valued objects is σ > 2 (Miao et al. , 1998). With symmetry-averaging,

the number of Fourier constraints is reduced by the order of the group and the limit

becomes σ > 2|G|. For the alignment scheme considered above, |G| = 4.

3. Numerical experiments

The diﬀraction pattern of a real-valued object in two dimensions has inversion sym-

metry and results in a two-fold ambiguity in the reconstructed object. When the

IUCr macros version 2.0β5: 2001/06/20

5

diﬀraction pattern is averaged with respect to a mirror, the ambiguity becomes four-

fold and is generated by two orthogonal mirrors. We demonstrate this for the object

“R”, one of the least symmetrical letters in the alphabet. Figure 1 shows the object in

a 27 × 27 pixel support, the diﬀraction pattern when expanded into a 128 × 128 ﬁeld

of view, and the diﬀraction pattern averaged with respect to a vertical (or horizontal)

mirror. The algorithm used a slightly enlarged, 30 × 30, support constraint to recover

the object. Figure 2 shows the time series of the diﬀerence map error metric k∆k given

by (13). When k∆k vanishes, the density

ρsol = ΠS+ (2 ΠF (ρ) − ρ)

(14)

satisﬁes the support/positivity constraint but also the symmetry-averaged Fourier

ΠS+ (2 ΠF (ρ) − ρ) = ΠF (ρ) .

(15)

Also shown in Figure 2 is the reconstructed object; in this case the mirror of the

constraint, since

original.

Our three dimensional reconstruction experiment reproduced the symmetry am-

biguity of the proposed molecular alignment mechanism (Spence et al. , 2005). A

real-valued density was generated by applying a rectiﬁer (positivity projection) to a

random, low-pass ﬁltered density on a 12 × 12 × 12 support. The diﬀraction pattern

was computed for a 32 × 32 × 32 ﬁeld of view and averaged with respect to the four

element group generated by π-rotations about axes along the sampling grid. When

combined with the Friedel symmetry of the non-averaged diﬀraction pattern, the input

to the reconstruction algorithm thus has an eight element symmetry group generated

by the three coordinate reﬂections.

Figure 3 shows the times series of the diﬀerence map error metric for ten successive

reconstructions from diﬀerent random starts. The corresponding densities are shown

IUCr macros version 2.0β5: 2001/06/20

row-wise in Figure 4. Of the eight possible symmetry related reconstructions, the ten

6

This work was supported by Department of Energy grant DE-FG02-05ER46198.

trials produced six.

Acknowledgement

References

Elser, V. (2003a). J. Opt. Soc. Am. A20, 40-55.

Elser, V. (2003b). Acta Cryst. A59, 201-209.

Fienup, J. R. (1982). Appl. Opt. 21, 2758-2769.

Larsen, J. J., Hald, K., Bjerre, N., Stapelfeldt, H. & Seideman, T. (2000), Phys. Rev. Lett. 85,

2470-2473.

Miao, J., Sayre, D. & Chapman, H. N. (1998). J. Opt. Soc. Am. A15, 1662-1669.

Spence, J. C. H. & Doak, R. B. (2004). Phys. Rev. Lett. 92, 198102-198104.

Spence, J. C. H., Schmidt, K., Wu, J. S., Hembree, G., Weierstall, U., Doak, B. & Fromme,

P. (2005). Acta Cryst. A61, 237-245.

IUCr macros version 2.0β5: 2001/06/20

7

Fig. 1. Left: object of study in a 2D reconstruction experiment. Center : diﬀraction

pattern, right: diﬀraction pattern averaged with its mirror.

0.6

0.5

0.4

0.3

0.2

0.1

20

40

60

80

100 120

Fig. 2. Left: Time series of the diﬀerence map error metric k∆k vs. iteration number;

right: reconstructed object.

IUCr macros version 2.0β5: 2001/06/20

8

Fig. 3. Error metric time series for the ten 3D reconstructions shown in Figure 4. All

solutions required fewer than 300 iterations.

IUCr macros version 2.0β5: 2001/06/20

9

Fig. 4. Each horizontal row of twelve, 12 × 12 pixel arrays, represents one 3D recon-
struction from symmetry averaged data. Of the eight symmetry related reconstruc-
tions possible, the ten experiments shown realize six of these (rows resorted to ease
comparison).

Synopsis

An object can be reconstructed from its diﬀraction pattern even if the latter is incoherently
averaged with respect to a discrete group of symmetries.

IUCr macros version 2.0β5: 2001/06/20

