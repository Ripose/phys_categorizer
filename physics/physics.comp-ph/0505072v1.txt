5
0
0
2
 
y
a
M
 
0
1
 
 
]
h
p
-
p
m
o
c
.
s
c
i
s
y
h
p
[
 
 
1
v
2
7
0
5
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

A variance-minimization scheme for optimizing Jastrow factors

N. D. Drummond and R. J. Needs
TCM Group, Cavendish Laboratory, University of Cambridge,
Madingley Road, Cambridge CB3 0HE, United Kingdom
(Dated: December 30, 2013)

We describe a new scheme for optimizing many-electron trial wave functions by minimizing the
unreweighted variance of the energy using stochastic integration and correlated-sampling techniques.
The scheme is restricted to parameters that are linear in the exponent of a Jastrow correlation factor,
which are the most important parameters in the wave functions we use. The scheme is highly eﬃcient
and allows us to investigate the parameter space more closely than has been possible before. We
search for multiple minima of the variance in the parameter space and compare the wave functions
obtained using reweighted and unreweighted variance minimization.

PACS numbers: 02.70.Ss, 31.25.-v, 71.15.Dx

I.

INTRODUCTION

Accurate many-body wave functions are essential to the variational and diﬀusion quantum Monte Carlo (VMC and
DMC) methods, as the wave function controls both the statistical eﬃciency and the accuracy of these techniques.1
Optimizing many-body wave functions is perhaps the most important technical issue facing practitioners of these
quantum Monte Carlo (QMC) techniques today, and it consumes large quantities of human and computing resources.
Wave-function optimization schemes have usually involved minimizing either the variational energy or its variance.
Although it is generally believed that wave functions corresponding to the minimum energy have more desirable
properties, variance minimization has been very widely used because it has proved easier to design robust minimization
techniques for this purpose.2,3 The scheme introduced in this article involves minimizing the unreweighted variance.
We describe a new method for evaluating this quantity, which greatly accelerates the optimization of parameters that
occur in a linear fashion in the exponent of a Jastrow factor. These are, in general, the most important parameters in
QMC trial wave functions. The optimization step does not involve a sum over electron conﬁgurations, which means
that we can use very large numbers of conﬁgurations. The unreweighted variance is in fact a quartic function of the
linear parameters in the Jastrow factor, and the minima of multidimensional quartic functions can be located very
rapidly. The eﬃciency of our scheme has enabled us to explore the minimization procedure and the parameter space
in detail, and to investigate the possible existence of multiple minima.

The distinction between the reweighted or true variance and the unreweighted variance is explained in Sec. II. In
Sec. III we describe our accelerated scheme for calculating the unreweighted variance. In Sec. IV we use our new
method to study the unreweighted variance in parameter space. The minima of the reweighted and unreweighted
variance need not coincide, and in Sec. V we investigate which minimum corresponds to the lower energy. We discuss
the sampling of conﬁguration space and the ﬂexibility of the trial wave function in Secs. VI and VII. In Secs. IX and
X we compare the eﬃciency of the “standard” and accelerated variance-minimization methods, both in theory and
practice. Finally, we draw our conclusions in Sec. XI.

Hartree atomic units (a.u.) are used throughout, in which the Dirac constant, the magnitude of the electronic
charge, the electronic mass, and 4π times the permittivity of free space are unity: ~ = |e| = me = 4πǫ0 = 1. All of
our QMC calculations were carried out using the casino package.4

II. THE ENERGY AND ITS VARIANCE

Consider a real trial wave function Ψ(R), where R is a point in the electron conﬁguration space. In VMC the

energy is written as

where the local energy, EL, is

Ψ(R)2EL(R) dR
Ψ(R)2 dR ,

E =

R

R

EL(R) = Ψ(R)−1 ˆH(R)Ψ(R),

(1)

(2)

2

(3)

(4)

(5)

(6)

(7)

(8)

(9)

and ˆH is the Hamiltonian. The variance of the energy is

Ψ(R)2(EL(R) − E)2 dR
Ψ(R)2 dR

.

σ2 =

R

We write the trial wave function as Ψ{α}(R), to denote that it depends on a set of free parameters, {α}. Throughout
this article, we conﬁne our attention to the optimization of parameters in the Jastrow factor. The nodal surface of the
trial wave function is independent of such parameters. Consider a set of NC conﬁgurations {R} distributed according
for some ﬁxed parameter set {α0}. The variance σ2 is then estimated for any given parameter set
to
{α} using a correlated-sampling procedure, which gives rise to the reweighted variance,
T {α}
{α0}

Ψ{α0}(R)

R

(cid:1)

(cid:0)

2

2

σ2
w =

T {α}
{α0}

2

−

R

W {α}
(cid:16)

{α0}(R)
(cid:17)

2

R (cid:16)
X

E{α}

L (R) − ¯Ew

W {α}

{α0}(R),

(cid:17)

(cid:16)
where the reweighted energy is

(cid:17)

P

which is an estimate of E, and the total weight is

and the weights W are

¯Ew =

1
T {α}
R
{α0} X

L (R)W {α}
E{α}

{α0}(R),

T {α}
{α0} =

W {α}

{α0}(R),

R
X

W {α}

{α0}(R) =

Ψ{α}(R)
Ψ{α0}(R)

2

.

(cid:19)

(cid:18)

σ2
u =

1
NC − 1

E{α}

L (R) − ¯Eu

2

,

(cid:17)

R (cid:16)
X

¯Eu =

1
NC

E{α}

L (R).

The unreweighted variance as a function of parameter set {α} is deﬁned to be

where the unreweighted energy is

R
X
The reweighted and unreweighted variances are identical when the same set of conﬁgurations is used and {α} = {α0}.
However, for any given {α0} they are diﬀerent functions of {α}, and there is no reason to expect that their minima
coincide with each other, or that either minimum should coincide with that of the (reweighted) energy.

Both σ2

w and σ2

u are non-negative, but are zero when Ψ{α} is an eigenstate of ˆH. The reweighted and unreweighted
variances are therefore reasonable cost functions for wave-function optimizations. The reweighted energy is also a
reasonable cost function. However, the problem with the reweighted energy and variance is that the weights W
may vary rapidly as the parameters change, especially for large systems, which leads to instabilities in optimization
procedures.3 It can be shown that the wave function used to generate the conﬁguration set corresponds to a stationary
point of ¯Eu (for perfect sampling). In what follows we will mainly be interested in optimizing linear parameters in
the Jastrow factor, and in this case we have proved that the wave function used to generate the conﬁguration set
corresponds to the global maximum of the unreweighted energy5. The unreweighted energy is clearly not a suitable
cost function. From these considerations we conclude that the cost function with the most suitable mathematical
properties for the stable optimization of wave functions within the correlated-sampling approach is the unreweighted
variance.

Ψ{α0}(R)

The usual variance-minimization procedure is to generate a set of electron conﬁgurations {R} distributed according
to
using VMC, and then to minimize the reweighted or unreweighted energy variance over this set. Since
the variance landscape depends on the distribution of conﬁgurations, several cycles of conﬁguration generation and
optimization are normally carried out, with the optimized wave function from the previous cycle being used in each
VMC conﬁguration-generation phase. We usually iterate several times and choose the wave function that gives the
lowest variational energy. In the limit of perfect sampling, the reweighted variance is equal to the actual variance, and
is therefore independent of the conﬁguration distribution, so that the optimized parameters would not change over
successive cycles of reweighted variance minimization. This is not the case for unreweighted variance minimization;
nevertheless, by carrying out a number of cycles, a “self-consistent” parameter set may be obtained.

(cid:0)

(cid:1)

2

III. ACCELERATED EVALUATION OF THE UNREWEIGHTED VARIANCE

A. The Slater-Jastrow wave function

Let Ψ be a Slater-Jastrow wave function for a many-body system:

Ψ(R) = exp[J(R)]S(R),

where exp[J] is the Jastrow factor, which contains free parameters to be determined by an optimization method, and
S is the Slater wave function, which may be an expansion in several determinants of single-particle orbitals.

Suppose that J contains linear parameters α1, . . . , αP , that is,

J(R) =

fi(R)αi + J0(R),

P

i=1
X

where f1, . . . , fP and J0 are known functions of R, which depend upon the particular form of Jastrow factor used and
do not contain any free parameters. We use the form of Jastrow factor described in detail in Ref.6, which contains
linear parameters. However, some of the terms have a ﬁnite extent in space and the associated cutoﬀ lengths must
appear nonlinearly in the Jastrow factor. These cutoﬀ lengths can be set on physical grounds or optimized using
small numbers of parameters and conﬁgurations and the standard variance-minimization procedure, but their values
cannot be obtained using the accelerated scheme described here.

B. Derivation of the quartic polynomial

The local energy for the Slater-Jastrow wave function of Eq. (10) is

EL(R) = −

1
2

P

P

i=1
X

j=1
X

g(2)
ij (R)αiαj −

g(1)
i

(R)αi −

g(0)(R) + V (R),

1
2

P

1
2

i=1
X

where V is the potential energy and
g(2)
ij (R) = ∇fi · ∇fj

g(1)
i

(R) = 2∇fi · ∇J0 + ∇2fi + 2

∇S
S

· ∇fi

g(0)(R) = |∇J0|2 + ∇2J0 + 2

· ∇J0 +

∇S
S

∇2S
S

,

and we note that g(2)

ij = g(2)

ji . The square of the local energy is given by

P

P

P

P

P

P

P

E2

L(R) =

G(4)

ijkl(R)αiαjαkαl +

G(3)

ijk(R)αiαjαk

i=1
X

j=1
X
P

k=1
X
P

+

l=1
X
G(2)
ij (R)αiαj +

i=1
X

j=1
X

k=1
X

G(1)
i

(R)αi + G(0)(R),

P

i=1
X

i=1
X

j=1
X

where

G(4)

ijkl(R) =

G(3)

ijk(R) =

G(2)

ij (R) =

kl (R)

ij (R)g(2)
g(2)
4
ij (R)g(1)
g(2)
2
(R)g(1)
4

g(1)
i

k (R)

j (R)

G(1)
i

(R) = −g(1)

(R)

i

V (R) −

G(0)(R) =

V (R) −

(cid:18)

(cid:18)
g(0)(R)
2

2

.

(cid:19)

− g(2)

ij (R)

V (R) −

g(0)(R)
2

(cid:19)

(cid:18)
g(0)(R)
2

(cid:19)

3

(10)

(11)

(12)

(13)

(14)

(15)

(16)

(17)

(18)

(19)

(20)

(21)

4

(22)

(23)

(24)

(25)

(26)

(27)

(28)

(Note that G(4)

ijkl = G(4)

jikl = G(4)

ijlk = G(4)

klij , G(3)

ijk = G(3)

jik, and G(2)

ij = G(2)
ji .)

Suppose the VMC method is used to generate a set of NC points in conﬁguration space, {R}, which are distributed

according to the square of an approximate trial wave function. For any quantity A(R), let

be the average of A(R) over the set of NC conﬁgurations. The unreweighted variance may be written as

¯A =

1
NC

A(R)

R
X

σ2
u =

NC
NC − 1

L − ¯EL

2

¯E2
(cid:16)

P

(cid:17)
P

P

P

NC

≡

NC − 1 

i=1
X

j=1
X

k=1
X

P


P

i=1
X

j=1
X

l=1
X
P

i=1
X

+

K (2)

ij αiαj +

K (1)

i αi + K (0)

,





K (4)

ijklαiαjαkαl +

K (3)

ijkαiαjαk

P

P

P

i=1
X

j=1
X

k=1
X

where

K (4)

ijkl = ¯G(4)

ijkl −

K (3)

ijk = ¯G(3)

ijk −

kl

ij ¯g(2)
¯g(2)
4
ij ¯g(1)
¯g(2)
2
i ¯g(1)
¯g(1)
4

k

j

K (2)

ij = ¯G(2)

ij −

+ ¯g(2)
ij

¯V −

K (1)

i = ¯G(1)

i + ¯g(1)

i

¯V −

K (0) = ¯G(0) −

(cid:18)

(cid:19)

¯g(0)
2
2

.

(cid:18)
¯V −

¯g(0)
2

(cid:19)

(cid:18)
jik, and K (2)

¯g(0)
2

(cid:19)

ijkl = K (4)

(Note that K (4)
ji .) The unreweighted variance is quartic
in the set of free parameters. Once the values of K (n) have been computed, there is no need to perform any further
summations over the set of conﬁgurations during the optimization of the parameters.

ijlk = K (4)

jikl = K (4)

ijk = K (3)

ij = K (2)

klij , K (3)

Throughout this article the potential energy is assumed to be a local operator, so the local potential energy
is independent of the wave-function parameters. When the variance-minimization algorithm is applied to systems
containing pseudoatoms, the change in the local potential energy due to the nonlocal part of the pseudopotential is
neglected. Not only does this greatly improve the speed of the variance-minimization process, but it also appears to
improve the stability of the algorithm.

C. Evaluating the least-squares function during an optimization

1. Accumulating ¯G and ¯g

The values of ¯g, ¯G, and ¯V are accumulated during a VMC simulation by keeping a running total of the values of g(R),
G(R), and V (R) encountered at each step of the random walk; there is no need to store data for each conﬁguration.
The accumulated elements of G are stored in a one-dimensional array and, furthermore, the symmetries of G are
exploited in order to minimize the length of this vector. The numbers of G(4), G(3), G(2), G(1), and G(0) elements to

be calculated and stored are

P (P +1)
2

P (P +1)
2

+ 1

(cid:17)

N (4)

G =

N (3)

G =

N (2)

G =

(cid:16)
(cid:17) (cid:16)
2
P 2(P + 1)
2
P (P + 1)
2

N (1)
N (0)

G = P
G = 1,

respectively. G(4)
ijkl is symmetric with respect to i and j, and is also symmetric with respect to k and l. In order to
label the independent elements of G(4), one can replace (i, j) by a single index I that takes P (P + 1)/2 diﬀerent values.
Likewise, (k, l) can be replaced by a single index J that takes P (P + 1)/2 diﬀerent values. G(4)
IJ is still symmetric
with respect to I and J; hence (I, J) can be replaced by a single index K which takes N (4)
G diﬀerent values, where
N (4)
G is given in Eq. (29). This is the method by which the elements of G(4) are indexed in practice. Counting and
indexing the elements of G(3), G(2), and G(1) are relatively straightforward. The total number of G elements grows
as O(P 4). Storing these coeﬃcients represents the memory bottleneck for the accelerated optimization procedure.
With P = 30 parameters (a typical number), 122,791 G elements must be stored. With P = 100 parameters (a large
number), 13,263,926 elements must be stored. Alternatively, the number of elements to be stored could be reduced
by using the same strategy as that suggested in Sec. III C 2 for evaluating the unreweighted variance. This would not
aﬀect the number of elements that have to be evaluated, however, and it may slow down the VMC calculation even
further. The saving in memory would typically be a factor of between 2.5 and 3, which is insigniﬁcant, given the
O(P 4) scaling of the method.

2. Evaluating the least-squares function

Before the start of the optimization, the coeﬃcient of each diﬀerent product of parameters is computed and the
coeﬃcients are stored in a one-dimensional array. This allows the unreweighted variance to be evaluated extremely
rapidly. The set of possible products of four of the parameters is {αiαjαkαl
: i ≤ j ≤ k ≤ l}, and similarly for the
products of three and two parameters. So the unreweighted variance can be written as

NC

σ2
u =

NC − 1 

Γ(0) +

P

i=1
X

P

j=i
X

Γ(1)
i +

αi



Γ(2)
ij +

αj



αk

Γ(3)
ijk +

αlΓ(4)
ijkl

 

P

k=j
X

P

l=k
X

,





!



where the Γ(n) are deﬁned in terms of K (n) (see below) and are stored as one-dimensional arrays. The number of
elements of Γ(n) is given by the number of distinct products of n parameters, which can be shown to be









while the total number of elements of the Γ arrays is

N (n)

T =

P + n − 1
n

,
(cid:19)

(cid:18)

NT =

P + 4
4

,
(cid:19)

(cid:18)
which increases as O(P 4). For P = 30 parameters, the number of terms that must be summed over to obtain the
unreweighted variance is 46,376, while for P = 100 parameters, the number of terms is 4,598,126.

For each {i, j, k, l} with i ≤ j ≤ k ≤ l, Γ(4)

ijkl is equal to the sum of K (4)

ijkl over all distinct permutations of {i, j, k, l}.

Γ(3), Γ(2), Γ(1), and Γ(0) are constructed in a similar fashion.

5

(29)

(30)

(31)

(32)

(33)

(34)

(35)

(36)

6

(38)

(39)

(40)

(41)

(42)

(43)

3. Derivatives of the least-squares function

Derivatives of the unreweighted variance are given by

∂σ2
u
∂αn

=

NC

NC − 1 

P

P

P

i=1
X

j=1
X

k=1
X



where

M (3)

ijk (n)αiαjαk +

M (2)

ij (n)αiαj +

M (1)
i

(n)αi + M (0)(n)

,

(37)

P

P

i=1
X

j=1
X

P

i=1
X





ijnk + K (4)

ijkn

injk + K (4)
inj + K (3)

ijn

nijk + K (4)
ijk (n) = K (4)
M (3)
nij + K (3)
ij (n) = K (3)
M (2)
ni + K (2)
(n) = K (2)
M (1)
i
M (0)(n) = K (1)
n .

in

In practice, derivatives are evaluated as

∂σ2
u
∂αn

=

NC

NC − 1 



Λ(0)(n) +

αi

Λ(1)
i

(n) +

αj

Λ(2)

ij (n) +

αkΛ(3)

ijk(n)

P

i=1
X





P

j=i
X





P

k=j
X

,













where the Λ(n) are deﬁned in terms of the M (n) in an analogous fashion to the deﬁnition of Γ in terms of K in
Sec. III C 2. The total number of elements of Λ is

(cid:18)
which grows as O(P 4). The Λ arrays used to evaluate the gradient of the unreweighted variance may be somewhat
larger than the G arrays.

N ′

T = P

P + 3
3

,
(cid:19)

D. Minimizing the variance

Ideally, one would like to use an optimization method that enables one to ﬁnd the global minimum of the variance
with respect to the wave-function parameters. Unfortunately, existing variance-minimization algorithms generally use
numerical optimization methods which, if started close to a particular local minimum, will always converge to that
minimum. However, in the case of the quartic unreweighted variance in the space of linear Jastrow parameters, it is
relatively easy to carry out an extensive search for the global minimum.

Standard methods for minimizing a function of many variables include the method of steepest descents, the
conjugate-gradients method, and the BFGS method.7 Of these three methods, we have found the BFGS algorithm to
converge most rapidly for a wide variety of test systems.

Along any given line in the space of linear Jastrow parameters the unreweighted variance is a quartic polynomial of
a single variable. The method by which the variance along a line can be re-expressed as a quartic polynomial is given
in Appendix A. A quartic polynomial of a single variable has at most two minima on the real axis. The gradient of a
quartic function is a cubic, whose three roots can be obtained analytically;7 hence it is straightforward to locate the
global minimum of the unreweighted variance along the line.

In order to search the parameter space for the global minimum of the variance with respect to the linear Jastrow
parameters, we ﬁrst perform a BFGS minimization. Starting from this minimum we choose directions at random
and use the analytic line-minimization technique to search for a second minimum, lower than the ﬁrst. If a second
minimum is found then BFGS is used to converge to the new minimum, and the process is repeated.

IV. THE NATURE OF THE UNREWEIGHTED VARIANCE

A. Linear Jastrow parameters

We used the method described in Sec. III D to search for minima when optimizing the linear Jastrow parameters in
the SiH4 molecule, the all-electron neon atom, a 16-atom cell of diamond-structure pseudosilicon subject to periodic

7

10 configs
2
 configs
10
3
 configs
10
4
 configs
10
5
 configs
10
6
 configs
10

)
.
u
.
a
(
 
e
c
n
a
i
r
a
v
 
d
e
t
h
g
i
e
w
e
r
n
U

70

60

50

40

30

20

10

0

-0.06

-0.04

-0.02
Linear Jastrow parameter α

0.02

0

0.04

1

0.06

0.08

FIG. 1: The unreweighted variance σ2
u for an all-electron neon atom plotted against one of the linear Jastrow parameters. All
of the other linear parameters are set to zero. Diﬀerent numbers of conﬁgurations were used to calculate the quartic coeﬃcients
of the unreweighted variance. In each case the conﬁgurations were distributed according to the square of the Hartree-Fock
wave function. The Jastrow factor contained a total of 24 linear parameters. The curves for 105 and 106 conﬁgurations are
indistinguishable in the ﬁgure.

boundary conditions, and an electron-hole gas. However, even sampling up to 107 random directions, multiple minima
were only found when the conﬁguration space was deliberately sampled extremely poorly.

Plots of the unreweighted variance against the value of one of the linear parameters are shown for an all-electron
neon atom in Fig. 1. It can be seen that the unreweighted variance converges to a limit as the number of conﬁgurations
is increased. There is only one minimum in every case.

Plots of the unreweighted variance for an all-electron neon atom against the value of a parameter for an extremely
poor sampling of conﬁguration space are shown in Fig. 2. When few conﬁgurations were used (NC = 40), it was
possible to ﬁnd two minima of the variance along lines in parameter space, proving that nonglobal minima can exist.
However, it was also found that increasing the number of conﬁgurations tended to prevent the occurrence of two
minima along lines in parameter space.

B. Nonlinear Jastrow parameters

Plots of the unreweighted variance of the SiH4 molecule against a nonlinear Jastrow parameter—the cutoﬀ length for
the electron-electron correlation term6—are shown in Figs. 3 and 4. The behavior of the unreweighted variance is far
worse when the cutoﬀ length is varied than when a linear parameter is varied: the variance has multiple minima along
lines in parameter space and there is some noise in the variance, especially for poor samplings of conﬁguration space.
It can be seen in Fig. 4 that the optimized cutoﬀ lengths obtained using 102 or 103 conﬁgurations are considerably
shorter than the cutoﬀ lengths obtained using 104 or 105 conﬁgurations. In the former case the cutoﬀ lengths are
trapped in the nonglobal minimum that can be seen in Fig. 3, while the deeper minimum is reached in the latter case.
The Jastrow factor used to produce Figs. 3 and 4 is such that the local energy is continuous when an electron-electron
separation passes through the cutoﬀ length. If a Jastrow factor that gives rise to a discontinuous local energy at the
cutoﬀ length were to be used, the variance would be an extremely noisy function of the cutoﬀ length, especially for
thin samplings of conﬁguration space. Optimization of the cutoﬀ lengths for such Jastrow factors has been found
to be very diﬃcult.6 The existence of multiple minima when cutoﬀ lengths are optimized suggests that it may be
worthwhile performing variance-minimization calculations using several diﬀerent initial cutoﬀ lengths.

8

40 configurations

2

3

4

4×10

 configurations

4×10

 configurations

4×10

 configurations

6
3×10

6

2.5×10

6
2×10

6

1.5×10

6
10

5

5×10

)
.
u
.
a
(
 
e
c
n
a
i
r
a
v
 
d
e
t
h
g
i
e
w
e
r
n
U

1.5

1

0.5

)
.
u
.
a
(
 
e
c
n
a
i
r
a
v
 
d
e
t
h
g
i
e
w
e
r
n
U

0
0

0
-0.1

-0.05

0

0.05

0.1

0.15

0.2

0.25

Change in linear Jastrow parameter α

5

FIG. 2: The unreweighted variance σ2
u for an all-electron neon atom plotted against the change in one of the linear Jastrow
parameters. All the parameters in the Jastrow parameter are set to large, random values. Diﬀerent numbers of VMC-generated
conﬁgurations were used to calculate the quartic coeﬃcients of the unreweighted variance.
In each case the conﬁgurations
were distributed according to the square of a Slater-Jastrow wave function, where the Jastrow factor contained the random
parameters, so that the resulting distribution was very unlike the ground-state distribution. The Jastrow factor contained a
total of 72 linear parameters. The Slater wave function contained Hartree-Fock orbitals.

2
10
3
10
4
10
5
10

 configurations

 configurations

 configurations

 configurations

5

10

15

Cutoff length Lu (a.u.)

FIG. 3: The unreweighted variance σ2
u for an SiH4 molecule (with a Hartree-Fock silicon pseudopotential8) plotted against
the cutoﬀ length for the electron-electron terms in the Jastrow factor, Lu. The Jastrow factor is such that the local energy
is continuous when an electron-electron separation passes through the cutoﬀ length.6 Diﬀerent numbers of VMC-generated
In
conﬁgurations were used to calculate the unreweighted variance. All of the linear Jastrow parameters are set to zero.
each case the conﬁgurations were distributed according to the square of the Hartree-Fock wave function. The Jastrow factor
contained a total of 56 linear parameters, plus three cutoﬀ lengths.

9

2
10
3
10
4
10
5
10

 configs
 configs
 configs
 configs

1.5

1

0.5

)
.
u
.
a
(
 
e
c
n
a
i
r
a
v
 
d
e
t
h
g
i
e
w
e
r
n
U

0
0

2

4

6

Cutoff length Lu (a.u.)

8

FIG. 4: This ﬁgure is the same as Fig. 3, except that all of the parameters in the Jastrow factor (including the cutoﬀ lengths)
have been optimized.

V. MINIMA OF THE VARIANCE AND THE ENERGY

A. The reweighted and unreweighted variance

1. Plots of the reweighted and unreweighted variance

Plots of the reweighted and unreweighted variances for an all-electron neon atom against one of the linear Jastrow
parameters are shown in Figs. 5 and 6 for small and large numbers of conﬁgurations. The reweighted and unreweighted
variances have their minima in diﬀerent places, with their values at the minima being diﬀerent from one another.
The variance is a smooth function of the linear Jastrow parameter in each case, but there are multiple minima of the
reweighted variance along lines in parameter space, demonstrating that nonglobal minima can exist. Furthermore,
the minima of the reweighted variance are not as sharply deﬁned as those of the unreweighted variance. Minimization
of the unreweighted variance is therefore more likely to be rapid and stable.

2. Quality of variance-minimization results

The outcomes of reweighted and unreweighted variance-minimization calculations are shown in Table I. For a
relatively sparse sampling of conﬁguration space, reweighted variance minimization is pathologically unstable, while
unreweighted variance minimization is perfectly well-behaved. For a dense sampling of conﬁguration space the two
methods give very similar results, and there is no evidence that the reweighted variance-minimization algorithm
performs any better than the unreweighted algorithm, or vice versa.

B. Coincidence of the minima of the energy and the variance

As is clearly demonstrated in Fig. 7, the self-consistent minimum of the unreweighted variance does not necessarily
coincide with the minimum of the VMC energy. On the other hand, for a high-quality Jastrow factor, the minima of
the unreweighted variance and energy are generally in close agreement, as is shown in Fig. 8. We have no evidence, for
all-electron atoms at least, that any signiﬁcant advantage could be obtained by optimizing linear Jastrow parameters
in a good Jastrow factor using an energy-minimization method. It can also be seen in Fig. 8 that the reweighted
energy follows the actual VMC energy data closely (the statistical error in the reweighted energy at the optimal

10

Unrewt.; All params zero
Unrewt.; Opt. params
Rewt.; All params zero
Rewt.; Opt. params

)
.
u
.
a
(
 
e
c
n
a
i
r
a
V

600

500

400

300

200

100

0

400

300

200

100

)
.
u
.
a
(
 
e
c
n
a
i
r
a
V

-0.4

-0.2

0
Change in linear Jastrow parameter α

0.2

0.4

1

FIG. 5: The reweighted and unreweighted variance for an all-electron neon atom plotted against the change in the value of a
linear Jastrow parameter, α1. Plots are shown for the case in which all the parameters are set to zero and the case in which all
the parameters have been optimized. The set of 100 conﬁgurations used to calculate the variance were distributed according
to the square of the Hartree-Fock wave function. The Jastrow factor contained a total of 27 linear parameters.

Unrewt.; All params zero
Unrewt.; Opt. params
Rewt.; All params zero
Rewt.; Opt. params

0
-0.4

-0.3

-0.2

-0.1

0

0.1

0.2

Change in linear Jastrow parameter α

1

FIG. 6: This ﬁgure is the same as Figure 5 except that 104 conﬁgurations were used to calculate the variance.

wave function is 0.001 a.u.). This implies that, provided enough conﬁgurations are used, the wave function could be
optimized by reweighted energy minimization.

A plot of the VMC energy variance against the change in a linear Jastrow parameter from its optimal value in an
all-electron neon atom is shown in Fig. 9. As one would expect, the reweighted variance matches the actual variance,
unlike the unreweighted variance; however, there is no signiﬁcant diﬀerence between the minima of the variance and
the unreweighted variance (and hence the energy).

11

VMC
Quadratic fit to VMC

)
.
u
.
a
(
 
y
g
r
e
n
e
 
C
M
V

-126.4

-126.6

-126.8

-127.0

-127.2

-127.4

-127.6

)
.
u
.
a
(
 
y
g
r
e
n
E

-128.84

-128.86

-128.88

-128.90

-128.92

-128.94

-0.02

-0.01

Change in linear Jastrow parameter α

0

1

FIG. 7: The VMC energy against the change in the value of a linear Jastrow parameter α1 from the value determined by
self-consistent unreweighted variance minimization. The Jastrow factor was chosen to be poor, with no electron-nucleus or
electron-electron-nucleus terms, and the same electron-electron terms were used for both parallel and antiparallel spins. There
is only one optimizable parameter: α1.

Separate VMC simulations
Quadratic fit to VMC
Unreweighted energy
Reweighted energy

-0.005

0
Change in linear Jastrow parameter α

0.005

1

FIG. 8: The VMC energy of an all-electron neon atom against the change in the value of a linear Jastrow parameter α1
from the value determined by self-consistent unreweighted variance minimization. Speciﬁcally, the Jastrow factor was the
best all-electron neon Jastrow factor described in Ref.6. The reweighted and unreweighted energies calculated using 8 × 105
conﬁgurations distributed according to the square of the optimized wave function are also plotted. The statistical error bars in
the VMC data are smaller than the symbols.

12

P

NC Cycle

VMC energy (a.u.)
Rew.

Unrew.

Unrew.

Variance (a.u.)
Rew.
29.3(1)

500
500
500
500

1
1
1
1
1 5 × 105
1 5 × 105
1 5 × 105
72
72
72
72 5 × 105
72 5 × 105
72 5 × 105

500
500
500

1 −128.5469(5) −128.5469(5) 29.3(1)
2 −128.5424(3) −128.5858(3)
3 −128.6178(3) −128.6129(3)
4 −128.6267(3) −86.508(3)
2 −128.6170(3) −128.6248(3)
3 −128.6226(3) −128.6261(3)
4 −128.6201(3) −128.6260(3)
2 −128.87184(9) −128.86664(9) 1.4178(7)
3 −128.88040(9) −50.00(9)
4 −128.8749(1)
258.83(1)
2 −128.89760(7) −128.89622(7) 1.136(1)
3 −128.89742(7) −128.89677(7) 1.1343(7)
4 −128.89752(7) −128.89655(7) 1.137(2)

6.220(2)
6.207(1)

6.3786(7)
6.310(1)
6.1564(7) 1501.1(2)
6.116(2)
6.096(1)
6.103(1)

6.0848(9)
6.0844(8)
6.0834(9)
1.3733(8)

420.7(86)

1.358(1)
1.421(2) 13599.1(4816)
1.1330(9)
1.132(1)
1.1326(9)

TABLE I: Results of reweighted and unreweighted variance-minimization calculations for an all-electron neon atom. P is the
number of linear parameters in the Jastrow factor and NC is the number of conﬁgurations used to perform the optimization.
(Long VMC runs were used to obtain the energies and variances shown in the table.) Only linear Jastrow parameters were
optimized. The VMC energy and variance for cycle 1 are estimates of the Hartree-Fock energy and variance, and are the same
for each P and NC .

We have also studied the question of the coincidence of the minima of the energy, the variance, and the self-consistent
unreweighted variance using a variety of model systems, for which the integrals could be performed exactly. The
models consisted of one-dimensional potential wells and various trial wave functions with a single variable parameter.
We studied several examples for a single particle and an example for two identical, interacting fermions. These
examples showed that the global minima of the energy, the variance and the self-consistent unreweighted variance
can be diﬀerent. In all cases studied the parameters optimized by self-consistent unreweighted variance minimization
gave lower energies than the parameters optimized by reweighted or “true” variance minimization. Furthermore,
in many cases, the parameters from the self-consistent unreweighted variance minimum coincided exactly with the
energy-minimized parameters, suggesting that some underlying principle was at work.

VI. THE SAMPLING OF CONFIGURATION SPACE

A. The number of conﬁgurations

The VMC energy for a neon-atom Slater-Jastrow wave function is plotted against the number of conﬁgurations
used to optimize the Jastrow factor in Fig. 10. It can be seen that the wave-function quality improves very rapidly,
then saturates at between 5 × 102 and 104 conﬁgurations, for both small and large numbers of parameters. For very
small numbers of conﬁgurations, the optimizations give pathological results, especially when the more ﬂexible Jastrow
factor is used.

Results obtained using reweighted variance minimization are also shown in Fig. 10. The reweighted variance-
minimization process was pathologically unstable for fewer than about 103 conﬁgurations. For larger numbers of
conﬁgurations the energies obtained are in good agreement with the results of unreweighted variance minimization.

B. The distribution of conﬁgurations

The unreweighted variance for an all-electron neon atom is plotted against a linear Jastrow parameter for three
diﬀerent conﬁguration distributions in Fig. 11. The conﬁgurations were distributed according to (i) the square of
the Hartree-Fock wave function, as is usually the case in the ﬁrst cycle of a variance-minimization calculation; (ii)
the square of an optimized Slater-Jastrow wave function, as is usually the case in the second and subsequent cycles;
and (iii) the square of a Slater-Jastrow wave function in which the Jastrow factor was chosen to be poor. Although
the variance looks diﬀerent in each case, the positions of the minima coincide almost exactly for the Slater and

13

Separate VMC simulations
Quadratic fit to VMC
Unreweighted variance
Reweighted variance

1.6

1.5

1.4

1.3

)
.
u
.
a
(
 
e
c
n
a
i
r
a
V

1.2

-128.82

-128.84

-128.86

-128.88

)
.
u
.
a
(
 
y
g
r
e
n
e
 
C
M
V

-0.005

0
Change in linear Jastrow parameter α

0.005

1

FIG. 9: The VMC variance for an all-electron neon atom against the change in the value of a linear Jastrow parameter
α1 from its value determined by self-consistent unreweighted variance minimization. Speciﬁcally, the Jastrow factor was the
best all-electron neon Jastrow factor described in Ref.6 The reweighted and unreweighted variances calculated using 8 × 105
conﬁgurations distributed according to the square of the optimized wave function are also plotted. Where the error bars in the
VMC data cannot be seen, they are smaller than the symbols.

48-parameter Jastrow; Unreweighted
80-parameter Jastrow; Unreweighted
48-parameter Jastrow; Reweighted

2
10

3
10

4
10
Number of configurations in optimization

5
10

6
10

FIG. 10: The VMC energy of an all-electron neon atom against the number of conﬁgurations used to optimize the linear
Jastrow parameters in an unreweighted variance minimization. Eight optimization cycles were performed for each number of
conﬁgurations in order to ensure that self-consistency was achieved. The Slater wave function contained Hartree-Fock orbitals.
The error bars in the VMC data are smaller than the symbols.

14

H-F wave function
Optimized S-J wave function
Poor S-J wave function

35

30

25

)
.
u
.
a
(
 
e
c
n
a
i
r
a
v
 
d
e
t
h
g
i
e
w
e
r
n
U

20
-0.02

-0.01

0
Linear Jastrow parameter α

0.02

0.01

0.03

1

0.04

0.05

FIG. 11: The unreweighted variance for an all-electron neon atom plotted against the value of the linear Jastrow parameter
α1 for three diﬀerent conﬁguration distributions: the square of the Hartree-Fock wave function, the square of an optimized
Slater-Jastrow wave function and the square of a poor Slater-Jastrow wave function. 106 conﬁgurations were used to calculate
the unreweighted variance. The Jastrow factor contained a total of 36 linear parameters. The Slater wave function contained
Hartree-Fock orbitals.

optimized Slater-Jastrow distributions. Even for the poor wave function, the minimum of the variance is reasonably
close to the more accurately determined optimum. This is consistent with our observation that, in general, the only
signiﬁcant improvement to the quality of a Jastrow factor occurs in the ﬁrst cycle of a series of unreweighted variance-
minimization calculations: starting from the Hartree-Fock wave function, the self-consistent solution is usually reached
in the ﬁrst cycle.

VII. THE FLEXIBILITY OF THE JASTROW FACTOR

The VMC energy of neon is plotted against the number of linear parameters used in the Jastrow factor in Fig. 12.
The results illustrate the futility of attempting to optimize too many parameters. The quality of the optimized wave
function depends on the number of conﬁgurations used to perform the optimization, especially when the number
of parameters in the wave function is either very small or very large. However, there would only appear to be an
advantage to be gained by using more than 104 conﬁgurations when a very large number of parameters are to be
optimized.

It should be reemphasized that the problems which occur when large numbers of parameters are optimized are
caused by mismatches between the minima of the unreweighted variance and the energy, and not by the introduction
of local minima into the variance landscape.

VIII. LIMITING OF CONFIGURATION WEIGHTS

It has been suggested that variance-minimization calculations are disproportionately aﬀected by “outlying” conﬁg-
urations, whose energies deviate substantially from the mean energy.3 In particular, the local energy diverges in the
vicinity of the nodal surface of the trial wave function, so conﬁgurations in this region are especially problematic.
Such conﬁgurations are relatively rare when the nodes are ﬁxed, as is the case when only Jastrow parameters are
optimized, but the problem can be far more serious when parameters that aﬀect the nodal surface are optimized using
a ﬁxed sampling of conﬁguration space.

We have studied a smooth scheme for removing outlying conﬁgurations from the optimization process. Let us deﬁne

15

(44)

-configuration optimization

-configuration optimization

2
2×10
4
10

5

6.4×10

-configuration optimization

-128.5

)
.
u
.
a
(
 
y
g
r
e
n
e
 
C
M
V

-128.6

-128.7

-128.8

-128.9

20

40

60

80

100

120

Number of linear parameters in Jastrow factor

FIG. 12: The VMC energy of an all-electron neon atom against the number of parameters in the Jastrow factor. Diﬀerent
numbers of conﬁgurations were used to carry out the unreweighted variance-minimization calculations. Six optimization cycles
were performed in order to guarantee self-consistency. Very long VMC simulations were carried out using the optimized Jastrow
factors in order to obtain the energies plotted in the graph. The VMC error bars are smaller than the symbols. The Slater
wave function contained Hartree-Fock orbitals.

the conﬁguration “eﬀective weight” to be

W ′(R) =

1 − tanh 

1
2 






E{α}
(cid:16)

L (R) − ¯Eu
B2σ2
u

(cid:17)

2

− A2σ2
u

,











where ¯Eu and σ2
u are the unreweighted energy and variance of the set of conﬁgurations. W ′(R) ≈ 1 for conﬁgurations
such that E{α}
L (R) ≈ ¯Eu, but W ′(R) → 0 for conﬁgurations whose local energies are far from the mean. The
parameter A is the number of standard deviations of the energy beyond which conﬁgurations are excluded, while B is
the width of the region in which the eﬀective weights fall oﬀ to zero (in terms of standard deviations of the energy).
We typically chose A to lie between 2 and 3 and B to lie between 1/2 and 1. The eﬀective weights W ′ are used in
place of the weights W in Eq. (4), and the reweighted variance σ2

w is minimized.

We have found that this weight-limiting scheme is capable of improving the stability of Jastrow-factor optimization
when very small numbers of conﬁgurations are used. However, the energies of the resulting wave functions are not
generally as good as the energies obtained using the same forms of wave function optimized with an adequate number
of conﬁgurations. For large numbers of conﬁgurations, the limiting scheme has very little eﬀect on the optimization
of Jastrow factors. We conclude that the weight-limiting scheme is not of much practical beneﬁt when a Jastrow
factor is to be optimized; however the scheme has been found to be very useful when parameters that aﬀect the nodal
surface are optimized.9

Other limiting schemes have been devised to improve the stability of the variance-minimization algorithms. For
example, it is possible to combine the reweighted and unreweighted variance-minimization algorithms by limiting the
values that the weights W can take.10 Alternatively, the local energies themselves can be limited.3 The latter approach
has been found to be problematic, as it can result in spurious minima in the variance corresponding to parameter sets
for which a large number of local energies are limited.

IX. SCALING OF THE VARIANCE-MINIMIZATION METHODS

A. CPU time required for the optimization phase

16

Let N be the total number of electrons in a system, P be the number of Jastrow parameters to be optimized, and
NC be the number of conﬁgurations used to calculate the variance. Although the Jastrow factor of Ref.6 is considered
in this work, the conclusions reached should be valid for most other forms of Jastrow factor in current use.

The computational eﬀort required to evaluate the unreweighted variance using the accelerated method is indepen-
dent of N and NC, but scales as O(P 4). The time taken to compute the gradient of the variance is also O(P 4). It
may be assumed that the number of optimization steps required is independent of P , N , and NC . The O(P 4) scaling
of the memory requirements of the accelerated method limits the number of parameters that can be optimized in a
single calculation to between 100 and 200, depending on the available memory.

The time taken to recompute the Jastrow factor and its derivatives after all of the parameters have changed is
generally O(N ) for electron-nucleus and electron-electron-nucleus terms and O(N 2) for electron-electron terms.6 The
CPU time required to evaluate the variance (reweighted or unreweighted) using the standard procedure therefore
increases as O(N 2). The time taken to calculate the Jastrow factor is, in general, O(P ), and hence the time taken
to calculate the variance using the standard method is also O(P ). Furthermore, each minimization step requires the
gradient of the variance with respect to the parameters, which has P components The time taken to perform each
iteration is therefore O(P 2). The CPU time for the standard method clearly scales as O(NC ).

Putting this together, the CPU time for the optimization phase scales as O(P 4) for the accelerated method and
O(N 2P 2NC ) for the standard method. It should be noted that the time required by the optimization phase in the
accelerated scheme is completely negligible in comparison with the time required by the VMC coeﬃcient-gathering
phase, whereas the CPU time required by the optimization phase in the standard method is usually rather greater
than the CPU time required by the VMC phase.

B. The CPU time required for the gathering of the quartic coeﬃcients in the accelerated scheme

In the standard variance-minimization method, the CPU time required to generate the set of conﬁgurations used
to compute the variance does not diﬀer appreciably from the time taken to perform an ordinary VMC simulation.
For the accelerated optimization method, however, the time taken to compute the quartic expansion coeﬃcients can
be a signiﬁcant fraction of the total CPU time.

The gathering of the quartic coeﬃcients can be divided into two stages: (i) the evaluation of the Jastrow “basis
functions” fi(R) for each conﬁguration R (see Eq. (11)), and (ii) the calculation of the corresponding contributions
to the ¯g and ¯G arrays. Stage (ii) scales as O(P 4), but is independent of system size. By contrast, stage (i) scales
as O(P ), because there are P basis functions, but the scaling with system size is the same as that of evaluating the
Jastrow factor: roughly O(N 2).

The CPU time for an ordinary VMC calculation is generally determined by the time taken to evaluate the orbitals
in the Slater wave function. The computational eﬀort required to carry out a ﬁxed number of conﬁguration moves
grows as O(N 2) if extended orbitals represented in a localized basis are used. The use of localized orbitals can improve
this scaling to O(N ).11 In principle the time taken for stage (i) of the coeﬃcient gathering will take up an increasingly
large fraction of the CPU time, but in practice the prefactor is so small that the time required is negligible even for
the largest systems that we have studied. The time taken for stage (ii) can be the largest contribution to the CPU
time for VMC simulations of small molecules, but the eﬀort required is independent of system size, and so, overall,
the coeﬃcient-gathering phase of the accelerated scheme is more eﬃcient for large systems than small systems.

X. EFFICIENCY OF THE ACCELERATED OPTIMIZATION METHOD

Timing results for the optimization of the linear Jastrow parameters for an H2O molecule (10 electrons) and a
C26H32 molecule (136 electrons) are shown in Tables II and III respectively. The calculations are fairly typical in
terms of the number of parameters and number of conﬁgurations. In both cases the use of the accelerated optimization
scheme essentially eliminates the cost of the optimization phase. In the standard method the cost of the optimization
phase exceeds that of the VMC conﬁguration-generation phase by an order of magnitude for H2O and by a less
signiﬁcant proportion for C26H32. The cost of the VMC phase in the accelerated scheme is increased substantially for
H2O although, overall, it is still much faster to use the accelerated scheme. For C26H32 the increase in the CPU time

TABLE II: Timing results for ten cycles of a 6 × 104-conﬁguration unreweighted variance minimization of a 38-linear-parameter
Jastrow factor for an all-electron H2O molecule. The system contains a total of 10 electrons. The Slater wave function contained
Hartree-Fock orbitals. The runs were carried out on a 1.7 GHz Pentium processor in a Sony Vaio laptop.

17

Method Stage CPU time (s)

VMC
Standard Opt.
Total
VMC
Opt.
Total

Accel.

5669.43
58740.65
64410.08
14378.90
39.69
14418.59

Method Stage CPU time (s)

VMC
Standard Opt.
Total
VMC
Opt.
Total

Accel.

6526.77
9323.53
15850.30
6828.47
28.14
6856.61

TABLE III: Timing results for four cycles of a 1.6 × 104-conﬁguration unreweighted variance minimization of a 12-linear-
parameter Jastrow factor for a C26H32 molecule with Troullier-Martins carbon and hydrogen pseudopotentials. The system
contains a total of 136 electrons. The Slater wave function contained DFT-PBE orbitals. The runs were carried out on a cluster
of eight 2.1 GHz Opteron processors.

for conﬁguration generation is negligible. Overall, the accelerated optimization scheme is 4.5 times faster for H2O
and 2.3 times faster for C26H32.

The actual time taken to compute the variance in the accelerated scheme is minute: On a 2.7 GHz Pentium 4
processor, it takes an average of 83.6 µs to compute the variance with 25 parameters, while it takes 13.98 ms to
compute the variance with 100 parameters.

XI. CONCLUSIONS

We have introduced a new scheme for evaluating the unreweighted variance of the VMC energy, which greatly
accelerates the optimization of parameters that occur in a linear fashion in the exponent of a Jastrow factor. This
scheme is very eﬃcient because it uses the property that the unreweighted variance is a quartic function of such
parameters. We studied a wide range of systems and found that the unreweighted variance almost invariably has a
single minimum in the space of the linear parameters. The only exceptions to this that we could ﬁnd occurred when
the conﬁguration space was very poorly sampled. For other wave-function parameters, however, the unreweighted
variance often has more than one minimum.

It is easy to use very large numbers of conﬁgurations to perform optimizations using our accelerated scheme. We
have investigated the eﬀect of varying the number of conﬁgurations on the wave-function quality, and we have found
that there is, in general, no signiﬁcant beneﬁt to be obtained from using more than about 104 conﬁgurations when
optimizing linear Jastrow parameters.

We have considered various wave-function optimization schemes using correlated-sampling approaches for mini-
mizing the energy and the variance of the energy. Reweighted energy and variance minimization using correlated
sampling suﬀer from numerical instabilities due to ﬂuctuations in the values of the weights, which are severe for large
systems. The unreweighted energy always has a stationary point at the wave function used to generate the conﬁgu-
ration set, and for parameters which occur linearly in the Jastrow factor this stationary point is the global maximum
in the energy. The unreweighted energy is therefore not a suitable cost function for wave-function optimization. The
minima of the variance, the unreweighted variance (iterated to self-consistency), and the energy are generally distinct.
In various model systems that we have studied, the self-consistent minimum in the unreweighted variance always gave
lower energies than the minimum in the reweighted variance.

XII. ACKNOWLEDGMENTS

Financial support was provided by the Engineering and Physical Sciences Research Council (EPSRC), UK. Com-

puting resources have been provided by the Cambridge-Cranﬁeld High Performance Computing Facility.

APPENDIX A: CONSTRUCTING THE QUARTIC POLYNOMIAL CORRESPONDING TO A LINE IN
PARAMETER SPACE

Consider the expression for the quartic unreweighted variance as a function of the linear parameters (Eq. (34)),

and consider a line in parameter space

where α = (α1, . . . , αP ) and A and B are constant vectors. The unreweighted variance along the line is given by

α(t) = A + Bt,

σ2
u(t) =

NC
NC − 1

(cid:0)

Ω4t4 + Ω3t3 + Ω2t2 + Ω1t + Ω0

,

(cid:1)

where

P

P

P

P

Ω4 =

Bi

Bj

Bk

BlΓ(4)
ijkl

k=j
X
P

l=k
X
P

i=1
X
P

i=1
X

+

P

i=1
X

+

j=i
X
P

j=i
X

Bi

j=i
X

Ai

i=1
X
P

i=1
X
P

j=i
X
P

j=i
X
P

i=1
X

j=i
X




Ai

P

P

i=1
X
P

j=i
X
P

+

P

i=1
X

+

Ω3 =

Ai

Bj

Bk

BlΓ(4)

ijkl +

P

P

P

P

Bi

Aj

Bk

BlΓ(4)
ijkl

k=j
X

l=k
X

i=1
X

k=j
X

l=k
X

P

P

P

P

P

P

P

Bj

Ak

BlΓ(4)

ijkl +

Bj

Bk

Γ(3)
ijk +

AlΓ(4)
ijkl

(A4)

 

!

i=1
X

Ai

j=i
X

Aj

k=j
X

Bk

l=k
X
BlΓ(4)

ijkl +

i=1
X

Ai

j=i
X

Bj

k=j
X

Ak

P

P

P

P

P

P

P

BlΓ(4)
ijkl

Ω2 =

P

l=k
X

k=j
X

l=k
X

P

P

P

i=1
X
P

j=i
X

k=j
X
P

l=k
X
P

P

P

Bj

Bk

Γ(3)
ijk +

AlΓ(4)
ijkl

+

Bi

Aj

Ak

BlΓ(4)
ijkl

i=1
X

j=i
X

k=j
X

l=k
X

+

Bi

Aj

Bk

Γ(3)
ijk +

AlΓ(4)
ijkl

Bi

Bj

Γ(2)
ij +

Ak

Γ(3)
ijk +

AlΓ(4)
ijkl

Ω1 =

Bi

Γ(1)
i +

Γ(2)
ij +

Aj



Ak

Γ(3)
ijk +

 

Ak

Γ(3)
ijk +

AlΓ(4)
ijkl

 

 

P

k=j
X

k=j
X
P

k=j
X




P

j=i
X


Γ(2)
ij +

P

k=j
X

Bj




P

l=k
X
P

l=k
X

 

P

k=j
X

 

P

l=k
X

!






!

AlΓ(4)
ijkl

P

l=k
X

P

i=1
X

!

P

j=i
X
P

l=k
X

+

Ai

Aj

Bk

Γ(3)
ijk +

AlΓ(4)
ijkl

+

Ai

Aj

Ak

BlΓ(4)
ijkl

Ω0 = Γ(0) +

Ai

Γ(1)
i +

Aj

Γ(2)
ij +

Ak

Γ(3)
ijk +

AlΓ(4)
ijkl

i=1
X

j=i
X

k=j
X

P

i=1
X





 

P

j=i
X





P

k=j
X

 

P

P

k=j
X

l=k
X

.

!






j=i
X

Bi

!

!

P

l=k
X

P

l=k
X

!

18

(A1)

(A2)

(A3)

(A5)

(A6)

(A7)

All the terms that appear in Eqs. (A3)–(A7) can be evaluated within a single loop over i, j, k, and l.

19

1 W. M. C. Foulkes, L. Mitas, R. J. Needs, and G. Rajagopal, Rev. Mod. Phys. 73, 33 (2001).
2 C. J. Umrigar, K. G. Wilson, and J. W. Wilkins, Phys. Rev. Lett. 60, 1719 (1988).
3 P. R. C. Kent, R. J. Needs, and G. Rajagopal, Phys. Rev. B 59, 12344 (1999).
4 R. J. Needs, M. D. Towler, N. D. Drummond, and P. R. C. Kent, casino version 1.7 User Manual, University of Cambridge,

Cambridge (2003).

5 In Ref.3 it was stated that the unreweighted energy could have a maximum, minimum, or saddle point at the parameter

values {α0}, but this is incorrect; we have proved that it is always a maximum.
6 N. D. Drummond, M. D. Towler, and R. J. Needs, Phys. Rev. B 70, 235119 (2004).
7 W. H. Press, S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery, Numerical Recipes in Fortran 77 (2nd ed.), Cambridge

University Press (1992).

8 Y. Lee, PhD Thesis, University of Cambridge, Cambridge (2002).
9 P. Lopez Rios, Personal communication (2005).
10 C. Filippi and C. J. Umrigar, J. Chem. Phys. 105, 213 (1996).
11 A. J. Williamson, R. Q. Hood, and J. C. Grossman, Phys. Rev. Lett. 87, 246406 (2001).

