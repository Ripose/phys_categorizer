Fast convergence of white noise cross-correlation measurement

archived by vector average in both frequency and time domain

Jian WEI∗

Department of Physics and Astronomy,

Rutgers University, Piscataway, NJ 08854

(Dated: December 2, 2013)

Abstract

White noise measurement can provide very useful information in addition to normal transport

measurements. For example thermal noise measurement can be used at sub Kelvin tempera-

ture to determine the absolute electron temperature without applying any heating current. And

shot noise measurements helped to understand the properties of nano and mesoscopic normal

metal/superconductor structures. But at low temperature and for relatively small resistance it is

diﬃcult to measure the sample’s noise magnitude because the background thermal noise can be

much larger and usually there are other pick-up noises. Cross correlation technique is one way to

solve this problem. This article describes an improved cross correlation algorithm that averages

in both frequency and time domain, and the realization of a simple instrument set-up with PC

and sound card. With this set-up it is shown even with much larger background noise and pickup

noises, 100pV/√Hz white noise level can be easily measured in seconds. Compared to the normally

used cross-correlation methods, it is several orders of magnitude faster.

4
0
0
2
 
y
a
M
 
0
1
 
 
]
t
e
d
-
s
n
i
.
s
c
i
s
y
h
p
[
 
 
1
v
1
4
0
5
0
4
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

∗Electronic address: weijian@physics.rutgers.edu

1

I.

INTRODUCTION

Recently a lot of attention has been paid on the properties of S/N/S and N/N/N micro-

bridge structures, and noise measurement (shot noise [2, 7] as well as thermal noise [3]) was

used as an additional technique besides transport measurements. But to measure the noise

at cryogenic temperature is diﬃcult since the sample noise usually is much smaller than the

thermal noise of the components in the test circuit. Noise thermometry for electrons at low

temperature was previously performed by current noise measurement with SQUID [4], which

is very sensitive and has very low noise level. However it is limited for small resistance and

not for voltage noise measurement, also it can not be used when magnetic ﬁeld is applied.

Cross-correlation technique [1, 2, 3] provides an alternative method to measure the sample

noise at low temperature. One bottleneck for this technique is that it requires a lot of time

to do cross-correlation to converge and achieve the required sensitivity, and the trade oﬀ

between sensitivity and the time needed to converge makes it diﬃcult to use for low level

noise experiments.

In this article we present an improved cross-correlation algorithm as well as the test

instrument set-up for measurement of thermal noise. This algorithm does a vector average

over both time and speciﬁc frequency range. It is worth noting that for commercial spectrum

analyzer usually only average over time is used, and it is impossible to realize this algorithm

within the instrument because of limitations like memory and computation speed. As shown

in the following sections, much faster convergence can be achieved with the new algorithm.

II. CROSS CORRELATION PRINCIPLE

It is well known 4-probe resistance measurement eliminates contact resistance by mea-

suring the voltage signal across the sample that was stimulated by the current though the

sample. It can be also considered as measuring the ”in phase” signal between current and

voltage across the sample. Cross-correlation is similar in a sense it eliminates the channel’s

noise by measuring the ”similarity” or ”in phase” signal between two diﬀerent voltage chan-

nels. To better illustrate it, let consider the voltage signals from two channels. The Fourier

2

 

20 ohm  

20 ohm 

v1 

v2 

R sample 

FIG. 1: Schematic of the set-up. The sample resistor is 10 Ω and 1.5Ω. The thermal noise is 20

Ω resistor along the channel is much bigger than the sample thermal noise.

components at particular frequency ω are:

~v1 = AeiθA + N1eiθ1

~v2 = AeiθA + N2eiθ2

(1)

(2)

Here A is the amplitude of the noise signal from our sample at frequency ω and N1, N2

are the amplitude of unwanted noise at ω generated in those two channels, for example, the

thermal noise generated by the 20Ω lead resistor as shown in Fig. 1.

To do cross-correlation we calculate the product of the two vectors:

~v = ~v1 ·

~v2

= A2 + N1N2ei(θ2−θ1) + AN1ei(θA−θ1) + AN2ei(θ2−θA)

(3)

For the last three terms in Eq.3, since all those phases θ1, θ2 are random for white noise,

and A, N1 and N2 does not change over time, when we do the average of ~v over enough long

time, the random phase terms will cancel each other and will give negligible contribution

to the total amplitude. So the real part of the ~v will converge at A2, and the imaginary

part will converge at 0. Ideally if we do the average over inﬁnite time the amplitude will

converge at A2. But in practical situation, the measurement time should be limited to some

reasonable extent.

To estimate the time needed to approach convergence limit, we need to ﬁnd when the

deviation of the random phase term is much smaller than the A2 term. First in order to

identify the signals ~v1, ~v2 at frequency ω, the sampling time ∆T should be much longer than

1/ω to get an accurate Fourier component. Then ~v1, ~v2 at diﬀerent times are acquired to

3

do the vector average to eliminate the random phase terms. If N1, N2 ≫
when the sample is at low temperature and the sample signal amplitude A is very small,

A, which happens

it will take very long time to approach the convergence limit, which requires large n in the

following equation:

N1N2 Pn ei(θ2−θ1)
ei(∆θ) = Pn ei(θ2−θ1)

n

n

A2

≪

1

≪

(4)

∝

From standard textbook[6] we know for iid (independent identical distributed) random

sequence, n times average gives n times smaller variance. Assuming our channel noises are

iid, we can expect that the variance of the averaged random phase term V ar(ei(∆θ))

1/n,

similarly for the averaged correlation the variance V ar(~v)
noise magnitude A, we need the variance of root square of real part ~v, V ar(pℜ
is proportional to 1/√n, and ﬁnally what need standard deviation to compare with A.

1/n, since our goal is to ﬁnd

~v) which

∝

The standard deviation σ√ℜ~v
= qV ar(pℜ
exponent is indeed observed in our experiment as shown in Sec.IV. This

~v) should be proportional to n−1/4. The

1/4 exponent

1/4

−

−

might also be used as a criteria to decide if the channel noise in diﬀerent time steps can be

ﬁtted as iid random sequence, i.e. whether there is some correlation in time domain.

As indicated above by the

1/4 exponent, it is not very eﬀective to eliminate the channel

−

noise by increasing the measurement time steps. To accelerate the convergence process, a

new algorithm is described below. Consider cross-correlation results at two diﬀerent fre-

quencies ωm and ωn:

~vm = A2 + Nmeiθm

~vn = A2 + Nneiθn

(5)

(6)

here the last vector term Nmeiθm represents the vector sum of the last three terms in Eq.3.

For ”white” noise, the amplitude A is the same for diﬀerent frequencies but the phases θm,

θn are random. This means a vector average over frequency domain is equivalent to the

vector average over time domain. Since in practice we usually acquire a series of data points

in one sampling time ∆T and then do a FFT transform, we could compute all the points

in the frequency domain and use them to do vector average. For example the commercial

spectrum analyzer usually takes 1024 scaler voltage points in ∆T (can’t take more because

4

of limited memory) and give 512 vector points in the frequency domain. If we do vector

average of the 512 points, according to the above statement it is similar to the result of

average over 512 time steps for one particular frequency, which means the convergence at A

can be achieved 512 times faster. To test this we built some simple experimental set-up as

described in the following section.

III.

INSTRUMENT SET-UP

A schematic plot of the test set up is shown in Fig. 1. Since people usually use resistive

stainless steel coax cable to connect the sample in the low temperature stage, here a 20Ω

resistor is used along each channel to simulate the channel resistor. The sample resistors

used here are 10Ω and 1.5Ω to simulate the low noise level from real sample. In this case

the amplitude of the sample noise A is much smaller than that of channel noise N, so it can

only be retrieved by cross-correlation technique.

The output of the two channels feeds separately to two PAR116 preampliﬁer (transformer

mode) and PAR124 lock-in ampliﬁer(only as an additional cascade ampliﬁer, the Monitor

output is used). The transformer is used to match the impedance. Two transformers need

to be similar because otherwise if may change the phase and amplitude and aﬀect the

convergence. For example if there is a ﬁxed phase diﬀerence ∆θ between two transformer,

the amplitude A will be reduced to cos(∆θ)A. After ampliﬁcation the signals are fed to

left/right channel input of a standard PCI sound card installed in a PII PC. The sound

card then digitize the signal with 16 bit resolution and 44.1kHz sampling rates. After that

the data is acquired by a program written in Labview to the computer memory. Then the

program calculates Fourier spectra and and performs correlation and vector average etc.,

and shows all results on the screen in real time. A PC is much better than a commercial

analyzer when considering the memory size and computation speed.

IV. EXPERIMENTAL RESULTS

In Fig. 2, for the 10Ω sample resistor three curves are shown to demonstrate the result of

conventional cross-correlation algorithm and to compare it with the new algorithm. Curve

A shows that the standard deviation of the average over time, σ√ℜ~v

decreases as the time

5

10 ohm sample, 20 ohm channel resistance
100 times average

 A  deviation of average over time
 B  average over time
 C  average over frequency and time

1E-9

5E-10

/

)
2
/
1
z
H
V
(
e
s
o
N

i

2E-10

1.5E-10

1E-10

5E-11

1

10

100

Time steps (delta T)

FIG. 2: For a 10Ω sample resistor with 20Ω channel resistor, the cross-correlation results are

shown. Curve A shows standard deviation of the average over time. The slope is proportional to
n−1/4. Curve B shows vector average over time. Curve C shows vector average over both frequency

and time domain. With this new algorithm the convergence is achieved almost from the ﬁrst point,

much faster than the conventional cross-correlation result shown by curve B.

elapse[8]. As shown in Sec.II it is proportional to n−1/4, which can be ﬁnd easily from the

log-log plot. Curve B shows the average over time approaches slowly to A, which is around

0.3nV/√Hz, after more than 100 times average. Curve C shows that when using the new

algorithm, the average over frequency and time almost converge at A from the ﬁrst point! In

fact, curve A is proportional to the diﬀerence between curve B and curve C. The measured

amplitude of A is close to expected amplitude of A, which is √4kBT R = 0.4nV/√Hz for 10Ω

sample resistor. This result is not bad when considering there may be aﬀects from non ideal

phase and amplitude properties of transformers and ampliﬁers, and uncertain pre-factors

that came in from the data processing like the use of windows when doing FFT.

FFT spectrum after 100 times average is shown in Fig. 3. Curve B shows the result of the

conventional cross-correlation vector average over 100 time steps. For comparison, curves

C, D shows separately the noise spectrum of left/right channel measured in ∆T . The vector

average over both frequency and time domain is just a number, so it can not be shown in

this frequency spectrum ﬁgure. From curve B, despite of those pick up noise peaks, we

6

10 ohm sample, 20 ohm channel resistor,100 times average

 B vector average over time
 C left channel 
 D right channel 

2E-8

2E-9

2E-10

/

)
2
/
1
z
H
V
(
e
s
o
N

i

10

100

1000

10000

frequency (Hz)

FIG. 3: FFT spectrum after 100 times average. Curve B shows the cross-correlation vector average

over 100 time steps, curve C, D shows the noise spectrum of left/right channel in ∆T . The noise

ﬂoor level of curve B is close to 0.3nV/√Hz as shown in Fig. 2. The decrease of amplitude below

60Hz and the dip near 8kHz is due to the amplitude and phase properties of transformers. The

cut-oﬀ near 22kHz is due to the Shannon limit, i.e., half of 44.1kHz sampling frequency.

can still ”see” the real noise level that is around 0.3nV/√Hz, which was also found by the

program and shown as the last point of curve B in Fig. 2. The program actually average

scalarly the spectrum amplitude from 1kHz to 2kHz where the spectrum is almost ﬂat and

the aﬀect of power line noise peaks is smaller. And those points close to power line noise

peaks were abandoned. It is worth noting this scalarly average of amplitude over frequency

is diﬀerent with the vector average over frequency.

With the presence of huge noise peaks as shown in Fig. 3, to observe the sample noise level

it is required that the spectrum leakage and sidelobe background of the unwanted power

line noise peaks shouldn’t mask the real white noise ﬂoor. This is usually achieved by using

special window function when doing FFT and by increasing the frequency resolution[5].

Since Hann window has a fast decreasing sidelobe magnitude, it is preferred in this situation

than uniform window which is conventionally used for ﬂat noise spectrum measurement.

And by increasing the frequency resolution the peaks’ mainlobe can be narrowed and their

7

sidelobes can be attenuated. In our case the sampling rate is 44.1kHz, sampling number is

chosen to be 32768 (215) points for each step, so the sampling time ∆T is 32768/44100 =

0.743 second for each step, and frequency resolution ∆f is 1/0.743 = 1.346Hz. It is possible

to increase the sampling number to increase ∆T and decrease ∆f . This will require only

larger PC memory and higher speed CPU which is inexpensive. A simple algorithm is used

here to eliminate 3 points from both sides of those power line peaks frequency when doing

the average. This is already good enough to ﬁnd the real noise ﬂoor of curve B in Fig. 3.

More complex ways using adaptive ﬁlter program to remove the noise peak and extract the

ﬂoor level is also possible.

As shown in Sec. II, the number of points used for vector average over frequency domain

decides how much times faster of this new algorithm compared to conventional algorithm.

Here since we used the range from 1kHz to 2kHz, with resolution 1.364Hz, we get 733

points. After subtracting the number of those points that are too close to noise peaks, we

have around 600 points. So in principle we should get 600 times faster. To test this we

measured room temperature noise for 1.5Ω sample resistor with same 20Ω channel resistors.

The result is shown in Fig. 4. The start point of curve A and B are mostly determined by

the 20Ω resistor. There is a ratio about 3 between those two curves around the start point.

To detect the noise level from 1.5Ω sample resistor, we can assume the required standard

deviation σ to be 5 times smaller than the convergence limit A, which is √4kBT R1.5Ω, we

would need σ decrease to magnitude √4kBT R1.5Ω/5. The time needed for conventional

cross-correlation methods can be estimated by:

(

√4kBT R20Ω/3
√4kBT R1.5Ω/5

)4

≈

1372

(7)

For the new algorithm, we expect 1372/600

2 steps.

As shown in Fig. 4 the convergence limit is about 0.126 nV/√Hz.

It is close to the

estimated value of thermal noise level of a 1.5Ω resistor at room temperature, which is 0.158

nV/√Hz. And 0.126/0.158

0.8 is consistent with the 10Ω case. At 1000th time step, the

last point of curve A in Fig. 4 has the value 25.6 pV/√Hz. The ratio between convergence

≈

limit and standard deviation is 126/25.6 = 4.9, which is close to our estimation that is 5

for 1372 steps. As for curve C, it approaches the convergence limit from the ﬁrst point in

the 100 time step case, in the 1000 time steps case, despite of some ﬂuctuations that may

caused by some broad band noise or data processing, it also approaches the convergence

≈

8

1.5 Ohm sample, 20 Ohm channel resistance
100 averages and 1000 averages

 A  deviation of vector average over time
 B  vector average over time
 C  vector average over frequency and time

2E-10

/

)
2
/
1
z
H
V
(
e
s
o
N

i

2E-11

1

10

100

1000

Time steps( delta T)

FIG. 4: Two Cross-correlation test results for 1.5 Ω sample with 20Ω channel resistor, one stopped

after 100 time steps, the other stopped after 1000 time steps. Curve B shows that using conventional

average over time methods, it approaches convergence limit after 1000 averages. Curve C shows

that using vector average over both frequency and time, the convergence was approached within a

few time steps.

limit from the ﬁrst a few points. So it is proved that with the algorithm of vector average

over frequency and time, convergence limit can be approached hundreds of times faster than

conventional cross-correlation algorithm with this simple setup. If there are less noise peaks

and if large frequency band is available, this algorithm could give even faster result.

V. CONCLUSION

For white noise measurement, an improved cross-correlation algorithm using vector av-

erage over both frequency and time domain is presented. With consideration of low tem-

perature noise measurement, a simple test set-up using PC and sound card is built and

tested. It is proved that this algorithm can achieve convergence hundreds of times faster

than the conventional cross-correlation algorithm. Even with much bigger channel noise and

huge pick up noises, 100 pV/√Hz noise level and 25pV/√Hz sensitivity can be achieved

in seconds. With a broader frequency band width, better A/D card and larger PC memory

9

the convergence can be reached even faster. In principle this algorithm could be used for

other type of noises as long as the shape of the spectrum is known and phase in frequency

domain is random(for example 1/f noise).

10

[1] M. Sampietro, L. Fasoli and G. Ferrari, Rev. Sci. Instrum. 70, 2520 (1999).

[2] A. Kumar, L. Saminadayar, D. C. Glattli, Y. Jin and B. Etienne, Phys. Rev. Lett. 76, 2778

[3] M. Henny, S. Oberholzer, C. Strunk and C. Schonenberger, Phys. Rev. B 59, 2871 (1999).

[4] M. L. Roukes, M. R. Freeman, R. S. Germain, R. C. Richardson and M. B. Ketchen, Phys.

(1996).

Rev. Lett. 55, 422 (1985).

[5] Dimitris G. Manolakis, Vinay K. Ingle and Stephen M. Kogon, Statistical and adaptive sig-

nal processing : spectral estimation, signal modeling, adaptive ﬁltering, and array process-

ing(McGraw-Hill, Boston, 2000).

[6] Roy D. Yates and David J. Goodman, Probability and stochastic processes : a friendly intro-

duction for electrical andcomputer engineers(Wiley, New York, 1999).

[7] B. Reulet, A. A. Kozhevnikov, D. E. Prober, W. Belzig and Yu. V. Nazarov, Phys. Rev. Lett.

[8] Curve A and B is smooth because in fact it is result of scalarly averaged of amplitude over a

frequency range for every time step, and then vector average over time is conducted. This is

90, 066601 (2003).

further explained by Fig. 3.

11

