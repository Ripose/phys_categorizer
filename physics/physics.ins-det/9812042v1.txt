DESY 98-054
May 1998
Revised December 1998

ISSN 0418-9833

8
9
9
1
 
c
e
D
 
3
2
 
 
]
t
e
d
-
s
n
i
.
s
c
i
s
y
h
p
[
 
 
1
v
2
4
0
2
1
8
9
/
s
c
i
s
y
h
p
:
v
i
X
r
a

The Electronics of the H1 Lead/Scintillating-Fibre
Calorimeters

H1 SpaCal Group

Abstract:

The electronic system developed for the SpaCal lead/scintillating-ﬁbre
calorimeters of the H1 detector in operation at the HERA ep collider is de-
scribed in detail and the performance achieved during H1 data-taking is pre-
sented. The 10 MHz bunch crossing rate of HERA puts severe constraints
on the requirements of the electronics. The energy and time readout are
performed respectively with a 14-bit dynamic range and with a resolution of
0.4 ns. The trigger branch consists of a nanosecond-resolution calorimetric
∼
time-of-ﬂight for background rejection and an electron trigger based on ana-
log ‘sliding windows’. The on-line background rejection currently achieved is
106. The electron trigger allows a low energy trigger threshold to be set
∼
99.9%. The energy and
at
time performance of the readout and trigger electronics is based on a newly-
developed low noise (σnoise ∼
200 MHz) preampliﬁer
located at the output of the photomultipliers which are used for the ﬁbre light
readout in the

0.08 (RMS) GeV with an eﬃciency

1 Tesla magnetic ﬁeld of H1.

0.4 MeV) wideband (f

0.50

±

∼

≥

≤

∼

Submitted to Nuclear Instruments and Methods A

H1 SpaCal Group

R.-D. Appuhn6, C. Arndt6, E. Barrelet16, R. Barschke6, U. Bassler16, F. Blouzon16,
V. Boudry15, F. Brasse6, Ph. Bruel15, D. Bruncko9, R. Buchholz6, B. Cahan5,
S. Chechelnitski13, B. Claxton2, G. Cozzika5,∗, J. Cvach17, S. Dagoret-Campagne16,
W.D. Dau8, H. Deckers4, T. Deckers4, F. Descamps16,α, M. Dirkmann4, J. Dowdell2,
C. Drancourt15, O. Durant16, V. Efremenko13, E. Eisenhandler10, A.N. Eliseev14,
G. Falley6, J. Ferencei9, M. Fleischer4, B. Fominykh13, K. Gadow6, U. Goerlach6,β,
L.A. Gorbov14, I. Gorelov13, M. Grewe4, L. Hajduk3, I. Herynek17, J. Hladk´y17,
M. H¨utte4, H. Hutter4, M. Janata17, W. Janczur3, J. Janoth7, L. J¨onsson11, I. Kacl17,
H. Kolanoski4, V. Korbel6, F. Kriv´aˇn9, D. Lacour16, B. Laforge5, F. Lamarche15
M.P.J. Landon10, J.-F. Laporte5, H. Lebollo16, A. Le Coguie5, F. Lehner6, R. Maraˇcek9,
P. Matricon15, K. Meier7, A. Meyer6, A. Migliori15, F. Moreau15, G. M¨uller6, P. Mur´ın9,
V. Nagovizin13, T.C. Nicholls1, D. Ozerov13, J.-P. Passerieux5, E. Perez5,
J.P. Pharabod15, R. P¨oschl4, Ch. Renard15, A. Rostovtsev13, C. Royon5, K. Rybicki3,
S. Schleif7, K. Schmitt7, A. Schuhmacher4, A. Semenov13, V. Shekelyan13, Y. Sirois15,
P.A. Smirnov14,d, V. Solochenko13, J. ˇSpalek9, S. Spielmann15, H. Steiner6,γ,
A. Stellberger7, J. Stiewe7, M. Taˇsevsk´y18, V. Tchernyshov13, K. Thiele6,
E. Tzamariudaki6, S. Valk´ar18, C. Vall´ee12, A. Vallereau16, D. VanDenPlas15, G. Villet5,
K. Wacker4, A. Walther4, M. Weber7, D. Wegener4, T. Wenk4, J. ˇZ´aˇcek18, A. Zhokin13,
P. Zini16 and K. Zuber4

1 School of Physics and Space Research, University of Birmingham, Birmingham, UKa
2 Electronics Division, Rutherford Appleton Laboratory, Chilton, Didcot, UK a
3 Institute for Nuclear Physics, Cracow, Poland b
4 Institut f¨ur Physik, Universit¨at Dortmund, Dortmund, Germany c
5 DSM/DAPNIA, CEA/Saclay, Gif-sur-Yvette, France
6 DESY, Hamburg, Germany c
7 Institut f¨ur Hochenergiephysik, Universit¨at Heidelberg, Heidelberg, Germany c
8 Institut f¨ur Reine und Angewandte Kernphysik, Universit¨at Kiel, Kiel, Germany c
9 Institute of Experimental Physics, Slovak Academy of Sciences, Koˇsice, Slovak
Republic d
10 Queen Mary and Westﬁeld College, London, UK a
11 Physics Department, University of Lund, Sweden e
12 CPPM, Universit´e d’Aix-Marseille II,IN2P3-CNRS,Marseille,France
13 Institute for Theoretical and Experimental Physics, Moscow, Russia f
14 Lebedev Physical Institute, Moscow, Russia
15 LPNHE, Ecole Polytechnique, IN2P3-CNRS, Palaiseau, France
16 LPNHE, Universit´es Paris VI and VII, IN2P3-CNRS, Paris, France
17 Institute of Physics, Czech Academy of Sciences, Prague, Czech Republic d,g
18 Nuclear Center, Charles University, Prague, Czech Republic d,g
α now at ILL, Grenoble, France
β now at CRN, Universit´e de Strasbourg, IN2P3-CNRS, Strasbourg, France
γ permanent address: LBL, University of California, Berkeley, USA

∗ Corresponding author. Tel.: +33 1 6908 2583,fax: +33 1 6908 6428,
e-mail: cozzika@hep.saclay.cea.fr.

1

a Supported by the UK Particle Physics and Astronomy Research Council, and formerly
by the UK Science and Engineering Research Council.
b Partially supported by the Polish State Committee for Scientiﬁc Research, grant no.
115/E-343/SPUB/P03/002/97.
cSupported by the Bundesministerium f¨ur Forschung und Technologie, Germany under
contract numbers 6DO57I, 6HH27I, 6HD27I and 6KI17P.
d Supported by the Deutsche Forschungsgemeinschaft.
e Supported by the Swedish Natural Science Council.
f Supported by INTAS-International Association for the Promotion of Cooperation with
Scientists from Independent States of the Former Soviet Union under Co-operation
Agreement INTAS-93-0044.
g Supported by GA ˇCR, grant no. 202/93/2423, GA AV ˇCR, grant no. 19095 and GA
UK, grant no. 342.

2

1 Introduction

The H1 detector has been in operation at the HERA ep collider at DESY since 1992.
Electrons of 27.5 GeV collide head-on with protons of 820 GeV at a 10 MHz bunch crossing
rate. During the HERA winter shutdown 1994-1995, the H1 collaboration upgraded the
backward part1 of its detector in order to extend deep inelastic ep scattering measurements
10−5) kinematic range. This upgrade
in the low Q2 (
program [1] was centred on the construction of two calorimeters (electromagnetic [2, 3] and
hadronic [4] wheels) which are based on the lead/scintillating-ﬁbre (SpaCal) technology.
In this paper we describe the electronics associated with both calorimeters and present
the performance achieved during normal data taking [5].

1 GeV2) and low Bjorken x (

∼

∼

The major improvements related to the electronics, compared to the previous backward
detector [6], concern the physics trigger and the on-line background rejection. The study
of low-x deep inelastic scattering makes it necessary to measure the scattered electron
down to very low energies at the level of 1-2 GeV whereas incident electrons have 27.5
GeV. A ﬁrst requirement for the backward physics trigger is the ability to run with a
2 GeV. A second requirement for the physics trigger is related to
threshold value of 1
the spatial detection uniformity of this calorimeter, which has a mean value of
2% [7],
an important feature that must be preserved at the trigger level. This has led to the
construction of a trigger based on ‘sliding’ analog sums which enable recovery of the full
deposited energy, regardless of the impact point of the particle.

∼

∼

∼

104 ; the physics trigger rate, including photoproduction, is of the order of

The purpose of the on-line selection mentioned above is to reject background events
induced by collisions between the proton beam (820 GeV) and residual molecules of gas
present in the beam pipe upstream of the H1 detector. The rate of these collisions
20 kHz) is a huge source of background triggers which must be reduced by a factor
(
∼
of
20 Hz.
The required background suppression is achieved by exploiting the path length diﬀerence
between upstream proton background and physics energy depositions. The front face
1.5 m (2.0 m for the hadronic part)
of the electromagnetic calorimeter is located at
from the interaction point, thereby giving rise to a time-of-ﬂight diﬀerence of 9 (12)
(hadronic) calorimeter. An on-line time-of-ﬂight (ToF) selection, at
ns for the e.m.
the nanosecond level, by a SpaCal calorimeter is possible due to its intrinsic low jitter
(
0.35 ns) [8]. In contrast, in the previous calorimeter, out-of-time background event
≪
rejection was maintained using signals from an external set of scintillation counters.

∼

∼

In the following section, the general layout of the SpaCal electronics is introduced,
while sections 3-7 are dedicated to the detailed description of each of the major compo-
nents.

2 Main features of the H1 SpaCal electronics

Fig.1 shows the electronics associated with the 1192 channels of the electromagnetic
calorimeter. Except for the electron trigger, the same electronics is also used for the
136 channels of the hadronic detector, so only minor diﬀerences will be mentioned when
necessary, the electronics description always referring to the electromagnetic wheel.

The basis of the improvement discussed in the introduction is a very low-noise wide-
band readout of the SpaCal light, achieved by a combination of a photomultiplier and a

1Backward refers to the electron direction.

3

Electronic
Calibration

Energy

Slow Shaper
350ns

ANCA

Delay  Line
2.3 - 2.5  µs

Sample and
Hold

ADC

DSP

    Local
Monitoring

Time

Fast Shaper
6ns

Trigger

Fast Shaper
30ns

Programmable
Thresholds

FEC

CFD

TDC

DSP

Programmable
ToF window

)

ToF

Σ 4

Σ 16

ToF Switch

AToF

Sliding
windows
Σ 2∗2

AToF
VETO
(MIP)

IET

O
F
I
F

Cable
19m

Preamp.

PM

e

SPACAL
1192 channels

H1 Central
Trigger

H1 CDAQ

Figure 1: General layout of the electronics associated to the SpaCal electromagnetic
section. The signal peaking-time values are given in the shaper boxes.

4

charge preampliﬁer. The ﬁber light is read out by ﬁne-mesh Hamamatsu R5505 photo-
104 for
tubes (R2490-05 for the hadronic section) which provide a gain of
1 Tesla magnetic ﬁeld of H1. The detailed characteristics
the hadronic section) in the
and performance of these photomultipliers are given in references [3, 9, 10]. In order to
transmit the photomultiplier pulses to the next stages of the electronics with the best
signal to noise ratio, a charge preampliﬁcation is performed at the anode output of the
phototube. The wideband preampliﬁcation associated with the photomultiplier tube is
described in the next section, where it is shown that a dynamic range greater than 17 bits
at a frequency of 50 MHz is achievable.

104 (

2
∼

∼

∼

×

As shown in Fig. 1, at the receiver end of the 19 m long 50 Ω transmission cables the

pulses are fed into three parallel signal processing chains, which are:

The energy readout branch described in Sect. 4,

•

•

The timing branch (Sect. 5); as shown in Fig.1, the constant-fraction discriminator
(CFD) output of the timing branch is on one hand digitized by a TDC system (Sect.
6) and, on the other hand, used in coincidence with a programmable gate for the
on-line time selection of the physics events. This function as well as the two fast
shapers and the analog sums (P4 and P16) are performed on the calorimetric ToF
board described in Sect. 5.

•

The trigger branch (section 7) which includes the level-1 physics trigger mentioned
in the introduction, and the total energy Etot ﬁrst level triggers for physics events as
well as for background collisions; the latter are used as vetoes for other H1 triggers.

The three branches are characterized by diﬀerent time constants, as can be seen in
Fig. 1 where peaking-time values are indicated. For on-line background rejection (timing
branch), the short time-constant enables the high frequency information of the pulses to
be recovered. For the trigger branch, the shaping is chosen in order to get the minimum
time occupancy corresponding to the period (96 ns) of the HERA machine clock. For the
energy readout branch, the time occupancy per channel due to the
20 KHz background
rate allows a longer shaping time compared to the trigger branch.

∼

Part of the electronics (the ANCA and FEC boards of Fig.1) is located close to the iron
yoke of the H1 detector in analog boxes designed for optimal shielding and access. Each
analog box contains 8 pairs of energy read-out/calorimetric-ToF boards. The electronics
of the trigger elements, and the TDC and ADC systems are located 20 m further away,
in the main H1 electronics trailer.

3 Preampliﬁcation

Usually, a photomultiplier is read out by connecting a matched resistor Rm at the end of
a transmission cable. With this conﬁguration, the transimpedance gain:

Zt =

= Rm

Vout
Ipm

(1)

is constant up to frequencies fc = 1/(2πτc) where τc = Rm . (Cpm + Cst); Cpm is the
capacitance of the last dynode-anode of the phototube and Cst is the stray capacitance.
Vout is the voltage measured across the resistor and Ipm the current pulse delivered by the

5

photomultiplier. By using such a readout, it is implicitly assumed that the photomultiplier
gain (106
107) ensures a high signal-to-noise ratio, independent of the signal processing
performed in the next stages of the electronics ; here noise means the pickup noise which
is added to the signal through the transmission line, the current noise contribution of the
dark current being negligible.

−

∼

However, in our present application the lower gain (

104) [10] of the ﬁne-mesh pho-
totubes inside the H1 magnetic ﬁeld does not ensure such a high signal-to-noise ratio.
Therefore it is necessary to preamplify the charge of the current pulse2 Ipm = Q δ(t) de-
livered by the photomultiplier (see Fig. 2), using the dynode-anode capacitance Cpm as
the integrating capacitor. The step voltage Q / Cpm decays according to the time con-
stant τpm=R1 ×
Cpm, where the mean value of τpm has been set to 180 ns (R1 = 12 kΩ,
Cpm ∼
15 pF ) in order to avoid saturation of the electronics by pile-up eﬀects; this
time constant τpm varies from channel to channel (20% maximum) due to the variation
of the geometrical capacitance value of the phototube. For the hadronic calorimeter, the
50 pF), so R1 has been
ﬁne-mesh phototubes R2490-05 have a larger capacitance value (
chosen equal to 3.3 kΩ.

∼

The two emitter-follower transistors (see Fig. 2) drive the voltage into the transmission
cable which is matched at both ends; matching at the emitter side reduces to a negligible
level reﬂected pulses due to residual mismatching at the receiver end. For a background
event, such delayed pulses (about two bunch-crossing later) could lead to wrong low-energy
physics triggers.

The transimpedance gain of the arrangement of Fig. 2 is given by:

Zt(s) =

Vout
Ipm

=

R1

1 + sR1Cpm ∼

1
sCpm

(2)

with s = jω the complex frequency. In this expression, the higher poles corresponding
to the transition frequency (ft∼
5 GHz) of the transistors (Philips BFQ23) are neglected
and a unit voltage gain for both transistors is assumed. Comparing this transimpedance
gain with the one provided by the usual readout discussed above, (Eq. 1), we ﬁnd that,
for Rm = 50 Ω, Zt(s)

50 Ω over the wide frequency range f

100 MHz.

There are two reasons to use such a preampliﬁer instead of a conventional charge

≥

≤

preampliﬁer with a feedback capacitor Cf :

•

•

For an energy deposit of
30 GeV inside a SpaCal tower, we already achieve a step
voltage amplitude 3 (a light yield of 1 photoelectron per MeV deposited energy is
assumed) Q/Cpm of
3.2 V. So there is no need to increase the gain by using a
smaller integrating capacitor,

∼

∼

With a feedback charge preampliﬁer, the rise-time of the output pulse is related to
the transimpedance gm of the input transistor and to the total input capacitor. As
these two quantities are channel dependent, the use of a feedback charge preampliﬁer
would have introduced timing performance variations, an undesirable feature for the
calorimetric ToF function.

A drawback of the arrangement of Fig. 2 is the gain dependence on the value of Cpm,
an undesirable feature which is usually removed in a conventional charge preampliﬁer
by knowledge of the value of Cf . However, with phototubes this gain dependence is

2SpaCal pulses have a rise time of
3Voltage range delivered by the preampliﬁer is 4 V.

∼

5 ns and decay with a time constant of

3 ns.

∼

6

Vin =

Q -t/e R1
CPM

CPM

R2

Signal

Q δ(t)

3.3kΩ

50Ω

50Ω

T1

T2

47Ω

19m

Vout   Vin

Next
Stages

50Ω V

  Vout
2

CPM

R1

0.5m Α

10mΑ

Figure 2: Layout of the charge preampliﬁcation.

+12V

compensated when the ampliﬁcation gain of the phototubes is tuned by balancing their
response in terms of energy.

The noise contribution introduced by this preampliﬁcation is discussed below in order
to show that, in terms of energy, it is below 1 MeV. The noise spectral density Sn(s) at
the output of the second transistor (Fig. 2) is given by the following expression:

Sn(s) = e2

n Z 2
i2

t (s)

n ⊕

where
ators respectively, Zt the impedance given by equation 2.

stands for addition in quadrature ; en and in are series and parallel noise gener-

⊕

The series noise generator is equal to:

e2
n = 4kT (2rbb′

1

1
2gm2

)

⊕

∼

2gm1 ⊕
10 Ω is the base spreading resistor of the transistor and gm1 (gm2) the transcon-
where rbb′
ductance of the transistor T1 (T2). As the collector current Ic1 of T1 is equal to
0.5 mA,
the term 1/2gm1 amounts to
10 mA)
from T2 is negligible. With these values of rbb′ and gm1, the series noise spectral density
en ∼

25 Ω while the contribution 1/2gm2∼
∼

0.75 nV/√Hz.
The parallel noise generator i2

∼
1Ω (Ic2 ∼

n is equal to:

i2
n = 4kT (

1
R1 ⊕

1
R2

)

⊕

2 q Ib1

where R1 and R2 (1.8 kΩ) are the resistors of the voltage divider (Fig. 2) and 2qIb1 the shot
15 µA, the current gain β being equal
noise of the base current of the transistor T1; Ib1∼
3.86 pA/√Hz,
to
where the dominant contribution is provided by the resistor R2; in equation (5), we have
neglected the noise contribution 2qIb2 of the transistor T2.

30 for the BFQ23 transistor. With these values, it is found that in ∼
∼

From equation (3), using the above values for en and in, it can be seen that series and
parallel noise contribute equally at a frequency fn∼
5 MHz, the parallel noise dominating
at lower frequencies. The noise contributions can be expressed in terms of equivalent noise
charge (ENC) for the three shapers of the next stages (see Fig. 1) by the usual equation
(ref.[11]):

(3)

(4)

(5)

(6)

ENC = Cpm

en Ja

hmax √τ ⊕

in Jb
hmax

√τ

7

•

•

•

•

•

hmax is the maximum of the preampliﬁer and ﬁlter response to a current pulse Qδ(t),
Ja and Jb are the series and parallel noise integrals. The values of hmax, Ja and Jb vary
according to the shaping performed in the next stages, which can be approximated by:

(CR)(RC) with CR

3 ns for the timing trigger,

∼

(CR)(RC)3 with RC = 10 ns for the electron trigger branch, and

(CR)(RC) with RC = 180 ns for the energy readout.

1/sCpm (equation 2) can be used (RC

It should be noted that equation(6) is valid for the trigger shapers because the approximate
τpm). For the readout branch,
expression Zt(s) ∼
this approximation does not hold but the ENC formula is still valid provided the transfer
function of a (CR)2(RC) shaper is used for the computation of hmax and Jb, the second
pole being the one of the charge preampliﬁer; the values of hmax,Ja and Jb can be found
in reference ([12]).

≪

Electronics
Branch
Timing
Trigger
Electron
Trigger
Energy
Readout

Shaper
(τ =RC)
(CR)(RC)
τ
3 ns
∼
(CR)(RC)3
τ = 10 ns
(CR)2(RC)
τ = 180 ns

hmax

J 2
a

J 2
b

0.367

1/8

1/8

Series
(e− (RMS))
1120

Parallel
(e− (RMS))
1270

Total
(Npe)
0.17

0.224

1/64

5/64

0.23

1/8

1/32

390

255

2990

7790

0.3

0.78

Table 1: Series and parallel noise contributions (expressed in number of electrons (RMS))
of the preampliﬁer for the three electronic branches. The total noise is expressed in number
of photoelectrons (Npe), assuming a photomultiplier gain equal to 104.

The noise contributions of the preampliﬁer for the three shapers are summarized in

table (1). From these values, one can conclude that:

The noise is lower than 1 MeV for both types of shapers

The achievable dynamic ranges for the energy readout and timing trigger are greater
than 15 and 17 bits respectively.
It is shown in the next sections that current
performance achieved in the H1 experiment are 14 and 15 bits respectively.

4 The energy read-out chain

The energy read-out is performed by 87 electronic boards which process 16 SpaCal chan-
nels each. As indicated in Fig. 3 these boards (labelled ANCA in Fig. 1) supply the
voltage of the preampliﬁers and the impedance termination of the 50 Ω cables. The out-
put of the unit-gain Analog Devices AD 811 ampliﬁer is sent in parallel to the calorimetric
ToF board and to the signal processing chain which consists of:

8

Relay  Cont rol

from
Input 
Calibrat ion

180 ns

0 V

-5 V

Ω
9
.
9
4

GENERATOR  MODULE

AD8 1 1

G= 8

RELAY

To  same  parity  channels

Pulse  at  delay  line  output

SAMPLE/HOLD  MODULE

0  to  + 5V

OUT PUT
TO  MUX

S /  H

Control
signals

AD8 1 1

100 nF

G= 1

FILTER
CR- RC
τ
(    =180ns)

2 2 0 Ω

2 .3

-

2 .5 µs

DELAY  LINE

2 2 0

Ω

SPACAL  signals
0  to  - 3.2V

49.9 Ω

1 k Ω

49.9 Ω

4 .7 µ F

10 nF

100     Hµ

SHAPER  MODULE

+12V 

for  active  bases

To  F.E.  Card

0  to  - 4V

Figure 3: Schematic layout of one analog card (ANCA) channel. The pulse at the output
of the delay line is shown with a time scale of 0.5 µs per square.

•

•

•

A (CR)(RC) ﬁlter with a time constant τ = 180 ns. As the mean value of the
180 ns this ﬁltering is equivalent to a (CR)2 RC
pole of the preampliﬁer R1Cpm is
shaper, providing bipolar output pulses as shown in Fig. 3. This bipolar shaping
was chosen so as to minimize energy pile-up eﬀects for the detector channels close
to the beam-pipe.

∼

∼

A delay line which has been custom built [13] and housed in a shield against the
stray ﬁeld (
100 Gauss) present close to the iron yoke. Special care was taken
in its design in order to reduce to a negligible level parasitic oscillations which can
occur before and after the pulse. A ﬁne adjustment of the delay between 2.3 and
2.5 µs in steps of 20 ns, set once by jumpers, enables alignment of the peak position
of the bipolar pulse with respect to the L1keep signal sent by the H1 ﬁrst level (L1)
trigger. This peak position is measured to an accuracy of
1 ns by the electronics
calibration described below.

∼

The sample and hold S/H (Fig. 3) which stores the value of the signal when an
L1keep signal is received. The control switches are based on the same principle as
those used in the H1 liquid argon electronics [14] in order to use the same sequencer,
but the bandwidth has been increased signiﬁcantly to deal with the faster SpaCal
signals.

The readout of the stored amplitudes by the S/H module uses the same multiplexing,
dual output gain (1 and 4), ADC and DSP electronics as for the H1 liquid argon calorime-

9

ter (see ref.
[15, 16]); the pedestal subtraction, zero suppression and gain selection are
performed by the DSP. The dual-gain system was chosen so that the eﬀective dynamic
range is 14 bits with a 12 bit ADC. A single coeﬃcient giving the ratio of these two gains
is necessary for the 128 channels of one analog box and is known to better than 10−3.

Checks, linearity measurement and delay calibration of the bipolar pulses are per-
formed by electronic pulses fed into the inverting input of the gain-1 AD811 ampliﬁer
(Fig. 3). Square voltage pulses received by the generator modules (Fig. 3 ) are provided
by the calibration system developed for the H1 liquid argon calorimeter [17]. In a gen-
erator module, which drives 8 readout channels, the square pulse is derived by a (CR)
of 180 ns in order to simulate SpaCal pulses. The gain-8 (Fig. 3) is necessary to cover
the full 4-Volt dynamic range but introduces a total coherent noise of
12 MeV on the 8
readout channels. During normal data-taking, the output of the generator module is dis-
connected by a relay in order to restore the minimum noise conﬁguration and to minimize
high frequency cross-talk (

3.5% at 100 MHz).

∼

The integral linearity of the full electronics chain has been found to be of the order
of 1%. As can be seen in Fig. 3, electronic pulses are also useful for checking the
trigger branches. However, for the time calibration of calorimetric ToF boards (sect.5),
the square-pulse generator of the liquid argon calorimeter is replaced by a commercial
product, HP 8082A, which simulates better the fast rising-edge of the SpaCal pulses. The
drawback is that the time calibration procedure is only semi-automatic because the HP
8082A output pulse, which is split passively into 16 pulses, is only capable of driving the
128 channels of one analog box.

≤

5 The calorimetric ToF card

•

•

The purpose of this board, labelled FEC in Fig. 1 (for Front End Card), is to perform
channel by channel:

The on-line timing selection of physics events and the rejection of the proton back-
ground originating upstream of the beam interaction point,

The shaping and analog summation of the pulses provided to the electron (P4) and
background veto (P16) trigger electronics (Fig. 1).

The inputs to this board are the 16 analog pulses supplied by the preampliﬁers, via the
energy read-out card and the HERA clock. The outputs provided are ﬁve analog sums
P16) for the electron and total energy triggers and 16 diﬀerential signals
( 4
(CFD outputs) which are sent to the TDC system.

P4 and 1

×

×

In the timing branch (Fig. 1), the pole of the preampliﬁer is removed by pole-zero
compensation (PZC, zero=225 ns and pole
3 ns). In order to prevent CFD oscillations,
∼
the time constant of the zero (225 ns) is chosen slightly larger than the expected maximum
value of the preampliﬁer decay time τpm.

The output signals of the CFD are fed in parallel into the TDC system (Sect.6) and
the ToF switch. By default the switches are positioned such that shaped pulses of the
trigger branch are fed into the AToF (for Anti ToF,i.e. out of time with respect to the

10

−→

beam interaction) branch. The switching to a ToF position requires that the leading
edge of the CFD output pulse occurs in a time range, called ToF window, covering the
energy deposition time of the physics events. The default position AToF is automatically
restored 150 ns after the AToF
ToF switching. The ToF window is a gate derived
for each bunch-crossing from the HERA clock. In order to take into account, channel by
channel, transit-time diﬀerences of SpaCal pulses and the HERA clock distribution in the
boards, the ToF window position is individually tunable by a programmable delay-line
(AD9500 chip). The rear edge of the ToF window is also derived from the HERA clock
and is tunable by a programmable delay-line which is, for simplicity, common to the 16
channels of a board. This implies that ToF window widths vary from channel to channel,
an eﬀect which is taken into account during time calibration procedures. The 8-bit-word
programmable delay lines of the ToF windows cover a 70 ns delay range in 270 ps steps
of the Programmable Delay Line (PDL).

In the following a more detailed description of the the constant-fraction discriminator,

the trigger shaping, and the on-line time selection switches is given.

•

•

•

The CFD circuit, based on the AD96687 comparator chip, runs in ARC (Amplitude
Risetime Compensated) mode with a constant fraction of 20% and a delay of 4 ns.
No amplitude validation is done in order to perform the on-line fast switching (Fig.1)
within
5 ns; this implies setting the CFD threshold above the noise, as shown
below. This voltage threshold is tunable by an 8-bit programmable DAC in the
range from -50 mV up to +10 mV in

230µV steps.

∼

∼

In the trigger branch, the SpaCal pulse is shaped by a (CR)(RC)3 ampliﬁer after
PZC (zero=225ns). The unipolar shaped pulse has a typical rise time of 20 ns and
returns to the base line, at a level of 1%, within
120 ns. The three integrations of
the shaper provide the

5 ns delay necessary for setting the switches (Fig. 1).

∼

∼

The trigger pulse is fed into a pair of switches, one for the AToF line and the other
for the ToF one. These switches consist of two BSS83 transistors (Philips) chosen
for their intrinsic delay of
0.5 ns. The two-transistor
4 ns with a small jitter of
conﬁguration suppresses fully the spike (ref. [18]) induced by the switching.

∼

∼

As explained above, during normal data-taking, these switches are activated (free
position) by the timing of the energy deposition. For calibration purposes, the switch
states can be downloaded, channel by channel, to permanent AToF, ToF or null position.
In this last mode, the channel contribution is removed in both AToF and ToF electronics.
This conﬁguration, which ensures the possibility to fully test the trigger electronics, also
enables suppression of contributions from noisy channels during data-taking.

The noise and timing calibrations of the calorimetric ToF board will now be discussed.
Fig. (4) shows, as function of the CFD threshold (in DAC units), the diﬀerential output
CFD pulse rates measured by the TDC system (Sect. 6), with particles (beam on), without
particles (HV on) and with photomultiplier high-voltages switched oﬀ. Each histogram
sums up the 128 channels of the hadronic calorimeter. The narrower distribution, which
measures the intrinsic electronic noise, is mainly contained within one bin and corresponds
67 µV (0.3 MeV). This value, which is approximately 4 times the
to a noise RMS of
expected noise contribution from the preampliﬁer, indicates that the transmission of the
high frequency range of SpaCal pulses is performed within a dynamic range of
15 bits.
A similar value is obtained for the electromagnetic calorimeter, except for the channels

∼

∼

11

of three analog boxes for which the RMS noise is increased up to 200 µV, the extra noise
contribution being induced by the low voltage power supplies. During data taking the
20 MeV (10 MeV with the hadronic gain factor,
CFD thresholds are set at a value of
see Fig. 4), well above the noise in order to ensure the long-term running stability.

∼

BEAM on

HV on

HV off

Threshold
~ 10 MeV

10 9

10 8

10 7

10 6

10 5

10 4

10 3

10 2

t

ep
tdc
ep
tdc- t
t
tjitter

ec
tdc

10 2

10

1

-20

-15

-10

-5

5

10

15

20

0
DAC unit

-4

-3

-1

-2
2
0
Time Dispersion (ns)

1

3

4

Figure 4: CFD noise of the 128 hadronic
channels in DAC units. The large tail
(BEAM on) is due to small energy deposits
by physics events. During data taking,
the threshold is set to an energy equiva-
lent value of
10 MeV. The noise RMS
of the narrow distribution (HV oﬀ) is equal
0.3 MeV. The equivalent performance
to
achieved with the electromagnetic calorime-
ter (with PMs of half gain) is

1.5 MeV.

∼

∼

∼

Figure 5: Result of the timing ad-
justment of the ToF window for one
analog box (128 channels), using the
electronic calibration. Starts and
stops are aligned within 270 ps of
delay step, with a sharpness bet-
ter than 100 ps (narrowest distribu-
tion). Refer to text for details.

The goal of the time calibration is to tune, channel by channel, the position of the ToF
window. This is done by setting the switches of each channel in turn to the free position
while all other channels are forced to null position, and then by delaying for two time
settings of the electronic calibration pulses, the ToF window in steps of 1 DAC count of
270 ps, equal to the DAC step of the PDL (270 ps). The transition time of the AToF/ToF
switching is recorded using the total energy trigger sums (Sect. 7) and is related to the
corresponding TDC time of the electronic pulses (for a more accurate measurement of
this transition time, the calibration system is pulsed ﬁve times for each step (see [19])).
From the linear relationship between the TDC time and the PDL unit, the setting of the
ToF window is calculated once the energy deposit time tep
tdc corresponding to ep collisions
has been measured. The start of the ToF window is set 2 ns earlier than tep
tdc.
Fig. (5) shows for the 1192 channels of the electromagnetic calorimeter:

•

•

The dispersion of the raw tep

tdc values as measured after one year of data-taking.

The relative time dispersion of tep
tec
tdc. The narrow RMS width (σ
the 1.25 ns RMS width of the raw tep
mainly generated between the calorimetric ToF board and the TDC system.

tdc and the electronics calibration
0.23 ns) of the latter distribution as opposed to
tdc one indicates that the dispersion of tep
tdc is

tdc between tep

tdc–tec

∼

12

•

The dispersion of the transition time width from AToF to ToF (and the converse)
as measured by the electronic pulses during the ToF window calibration. This
distribution4, which is mostly included within one DAC unit (270 ps), indicates
that the ToF window time jitter (tjitter) has an RMS value lower than

0.08 ns.

∼

Electronics tests have shown that the timing stability is better than 0.08 ns on the
few minutes scale. On longer time scales there exist no means to perform this check since
long term drifts of the trigger controller and beam interaction time with respect to the
HERA clock are larger than 1 ns.

6 The TDC system

A system of about 1400 TDCs, one per photomultiplier, is needed to record the pulse
timing in each SpaCal channel. This is necessary in order to be able to monitor and adjust
the timing of the ToF/AToF switching in the trigger, as well as to distinguish oﬄine
between energy depositions coming from interactions rather than from beam-induced
background.

Due to the ﬁrst-level trigger latency, TDC results must be pipelined for at least 2.5 µs,
but such TDCs are not available commercially. Therefore, a custom-made system has
been built [20, 21], based on the commercially available TMC1004 [22, 23] (Time Memory
Cell) developed for use on the Superconducting Super Collider.

Online monitoring was a serious consideration in the design. There is automatic on-
board histogramming of the timing, for diﬀerent types of trigger conditions, in order to
allow checking of both the calorimeter and the electronics. There are also scalers for
measuring the CFD output rates for calibration purposes as well as for on-line monitoring
during data taking. The TMC chip and the way it is used in H1, the architecture and
the boards of the TDC system, and the readout and on-line monitoring are described in
the following subsections.

6.1 The TMC1004 ASIC

A conceptual diagram of the device is shown in Fig. 6. Each ASIC contains four channels,
with individual timing inputs and a common clock. The digitisation is performed using a
chain of 32 delay elements controlling the write inputs to a corresponding chain of memory
cells. The timing input is connected to the data inputs of all the memory cells. A clock
edge propagates down the chain of delay elements, storing the state of the timing inputs
in the memory cells at intervals given by the delay of the delay elements. The position of
a zero-to-one transition in the data stored in the memory cells indicates the time between
the rising edge of the clock and the timing input signal. The data are stored in a pipeline,
implemented as a circular buﬀer so its depth can be conﬁgured to be up to 32 clock cycles
long.

The precision of the TMC1004 alone is speciﬁed to be 0.5 ns. The bin size, or accuracy
of the TDC measurement, can be changed by varying the clock frequency, a feature
available in the TDC system. The range over which the control of the delay is guaranteed
is 0.6 ns to 1.5 ns, corresponding to clock frequencies of 50 MHz and 21 MHz respectively.

4For the display, the bin contents have been downscaled by a factor of .3

13

Pipeline: 32 clock cycles deep

5

Rising-edge encoder

Timing
input

Clock
(32ns period)

Control voltage

32 delay elements
(Delay per cell = 1 ns)

Figure 6: Conceptual diagram of the TMC1004 chip.

×

A TMC clock period of 32 ns, i.e. covering only one-third of a bunch crossing, is
chosen. This is because the depth of the TMC1004 pipelines is only 1 µs if data are
32 ns), which is not long enough for the H1 trigger latency.
recorded continuously (32
The solution adopted, in order to avoid the need to extend the pipelines with external
memories, is to record data from only one third of a HERA clock period per bunch
crossing, which extends the length of the pipelines to 3 µs regardless of the TMC clock
period. Experience showed that the full base-width of the ‘interesting’ part of the bunch
crossing could be accommodated in the resulting 32 ns-wide active window. Thus, the
normal situation for running uses a 31.3 MHz clock covering a window of 32 ns with a
1.0 ns bin size. However, the TMC clock multiple can be changed from its normal value
of three to as much as ﬁve (52.1 MHz, covering 19.2 ns with a bin size of 0.75 ns) or to as
little as one (10.4 MHz, covering the full 96 ns bunch crossing with a bin size of 3.0 ns).
This trade-oﬀ means that precise measurements can be made over small windows, and
cruder measurements can be made over the entire bunch crossing if necessary.

6.2 TDC system architecture

×

The TDC system is contained in two 9U
400 mm deep crates with standard J1 VMEbus.
The VMEbus is used for control and online monitoring, while readout to the H1 data
acquisition system is via a dedicated bus to the same DSPs as the SpaCal energy read-out.
A custom J2/3 bus using ﬁve-row DIN connectors allows for rear plug-in of all inputs, and
the fanout of clock and control signals. The J2/3 bus also provides a separate acquisition
bus over which data are sent to the readout DSPs. The TDC system is integrated into
the SpaCal electronics as shown in Fig. 1.

14

DAQ
VMVbus

VBR VIC DSPDSPSVC

6U VME crate

STC, Spacal trigger bits

5 6U slots

9U VME crate

DSP acquistion bus

Local
VMVbus

VIC

Mac
VEE

SCM

11 THM Modules
64 channels each
(16 TMC1004)

Clock, control, histo-definition bits

5 6U slots

9U VME crate

VIC

Mac
VEE

11 THM Modules
64 channels each
(16 TMC1004)

Macintosh + MICRON

Ethernet

Figure 7: Block diagram of the TDC system.

The TDC function is performed on 22 TDC and Histogrammer Modules (THMs,
Fig.7), each with 64 channels and thus 16 TMC1004s. These modules receive the output
CFD pulses from the front-end electronics via 23 m-long multi-way shielded twisted-pair
cables. The THM includes also a 32-bit scaler per 16 TDC channels for the CFD rate
measurements (Xilinx XC3020). Individual channels can be gated on or oﬀ, so that these
scalers can be used either to monitor overall rates in blocks of 16 channels, or to examine
individual channels one-by-one. The latter is useful not only in online monitoring, but
also for setting the threshold of the front-end constant-fraction discriminators to be above
the noise.

One System Controller Module (SCM) receives the central HERA bunch-crossing clock
(10.4 MHz) and the Pipeline Enable (PE) sent by the L1 trigger. It multiplies the bunch-
crossing clock by a programmable multiple, between one and ﬁve but normally three, to
produce the TMC clock. The TMC clock and PE are fanned out to all THMs on equal-
length cables. The SCM also provides 32-bit scalers for use by the monitoring software
(e.g. number of bunch crossings, number of PEs, etc.). These are implemented in Xilinx
XC3042s FPGAs.

The contents of the TDCs, scalers and histograms are accessible to a Macintosh-based
C++ monitoring program. The use of a private bus for communication with the DSPs
allows the Macintosh uninterrupted VME access, even during data-taking.

6.3 TDC read-out and monitoring

While the pipelines are enabled, the TMC chips acquire the time of arrival of energy
with respect to the TMC clock for each channel. When a ﬁrst-level trigger occurs (2.5 µs
after the bunch crossing of interest) the pipelines are frozen, and data from the triggered

15

Scalers

TMC1004
Array
(16 chips)

Timing
Inputs

64

test pulse

Clock

PE

WSTART
Generation

Spy
Memory

Histogram
Memories

VME

Definition
Bits

DSP

Figure 8: Block diagram of the THM.

bunch crossing as well as one either side for safety are accessible to calorimeter-readout
DSPs. Two DSPs situated in a remote data-acquisition crate read the data over the local
acquisition bus. Each DSP reads out one crate of THMs, zero-suppresses the data, and
places them into a buﬀer for the event builder.

For online monitoring purposes, automatic histogramming of every channel using on-
board memories was implemented. This allows the monitoring computer to read out ﬁlled
histograms when it is convenient, rather than have to read out many events and build up
the histograms itself.

There are actually 16 histograms per channel. Data from a given bunch crossing are
added to the histogram speciﬁed by a set of four ‘deﬁnition bits’ fanned out from the
SCM. The bits are generated from the SpaCal trigger bits using a RAM-based lookup
table that allows speciﬁcation of arbitrary logical combinations of trigger bits. In this
way, the signiﬁcance of the histograms is completely programmable and can be changed
to allow diﬀerent investigations to be carried out for diﬀerent types of trigger in the
SpaCal.

There is one histogrammer unit per 16 channels. Although only one of these channels
can be selected for histogramming at a time, all 16 can be stepped through in sequence au-
tomatically. The histograms are stored in RAM, requiring 1024 32-bit words per channel.
This gives a total of 5.5 Mbytes of histogram RAM in the TDC system. To histogram the
data from a single bunch crossing takes eight bunch crossings, during which the histogram-
mer is insensitive. With zero-suppression this is acceptable, given the low occupancy of
each channel.

These histograms, along with the scalers on the SCM and THMs, are accessible via

VMEbus to the monitoring software for online checks and expert diagnoses.

16

7 Electron and Total Energy Triggers

7.1

Inclusive electron trigger

Since the current jet of a low Bjorken x deep-inelastic event is boosted in the backward
direction, a total energy sum cannot be used at the ﬁrst level trigger to distinguish deep
1 GeV2). We therefore
inelastic scattering events from photoproduction events (Q2
apply a simple inclusive electron trigger condition that there is at least one trigger tower
4 SpaCal towers) energy greater than a threshold. More precisely, this inclusive
(4
electron trigger (IET) is designed to compare the deposited energy inside a group of 4
4
×
SpaCal towers with each of 3 thresholds. A global ‘OR’ of the digital outputs for each
threshold is performed, the result of the three ‘OR’s being sent to the H1 ﬁrst-level central
trigger logic. The trigger tower size is chosen such as to ensure the transverse containment
of the electromagnetic shower at any scattering angle (1550 < Θ < 1770).

≪

×

The sliding trigger towers are formed as shown at the top of Fig. 9. From hardwired
presums Σ4 of the ToF-timed signals from 2
2 SpaCal towers (done in the calorimetric
×
ToF card described in Sect. 5) the content of all Σ4 presums (i.e. the overlaying sums of
16 SpaCal towers) is calculated (Fig. 9). In this way, even when the impact point is at
the border of two presums (point B in Fig. 9), the full deposited energy is recovered in
the trigger tower 3 (Fig. 9). As shown in this ﬁgure, the sliding summation is performed
in both directions, x and y.

SpaCal
tower

presum
of 2x2

A

B

Front view of
64 SpaCal Towers

Trigger
tower 1

Trigger
tower 2

Trigger
tower 3

Trigger
tower 4

 DISCRI.  card  (16 ch.)

 Discri.
 (3x16)

 Xilinx
   (3x)

(4x)

Σ16  SpaCal  ch.

Line
driver

Merging plate
S.W. card
(80 ch.)
..
Σ4
. .1
.
4.

3

2

H.C.

LIET bits
(3x)

 GLOBAL
 IET
 (1 card)

L1 trigger

(2 bits)

LIET

Readout

S.W. bits
(3x16)

S T O R E
C A R D S

ANALOG
SUMS

Next

Stages

Figure 9: General layout of the IET

A schematic view of the electronics is shown in Fig. 9. The pulses (ﬁxed presums)
supplied by the calorimetric card are sent to the trigger electronics on shielded multi

17

twisted-pair cables. The merging plate allows each presum to be individually mapped to
the correct destination in order to do the sliding-sum calculation. As sketched in Fig. 9,
a basic trigger crate consists of a Sliding Window (SW) card (80 channels) acting as a
backplane, and Discriminator Cards (5
) processing 16 channels each. The full trigger is
contained in 5 such (3U
350 mm deep) crates. The main features of these two cards
are:

×

×

±

Sliding Window Card: this is an 8-layer printed-circuit board, two layers used as
voltage supply planes (
6 V) and the others for the distribution of the analog pulses.
According to the sliding window scheme (Fig. 9), a diﬀerential presum pulse must
be sent to 4 line-receivers and each line-receiver processes 4 presum pulses (acting
then as summing ampliﬁer). The receiver/summing ampliﬁer (OPA620 from Burr-
Brown) is the only active component of this card. Receiver outputs corresponding
to trigger towers are gathered per group of 16 and sent to the discriminator card
via a two-row DIN connector. The latter enables the fast signals to be fed with a
minimal crosstalk of about 0.5 %.

Discriminator Card: The functions of this board are:

•

•

1. To compare (AD790JR discriminators) the trigger tower pulse height with three

thresholds.

2. To supply, per threshold, a local ‘OR’ (named LIET bit for Local IET) of the 16
discriminated pulses. These are latched and synchronized with the HERA clock
(HC) inside a Xilinx (XC 3020) which performs this ‘OR’. The individual bits
(SW bits), corresponding to detailed trigger information used for debugging or
analysis, are read out via ‘Store Cards’ ([24]).

3. To pick-up the analog information of the 4 adjacent trigger towers and to drive

them diﬀerentially to the summing electronics, as described below.

As shown in Fig. 9, LIET bits are sent to a single card (named ‘global IET’). This board
performs the ‘OR’ of the 3(thresholds)
25 LIET bits and supplies the encoded result to
the central L1 trigger.

×

∼

The main performance features of this trigger are as follows: the RMS output noise
of a receiver/summing ampliﬁer is equal typically to σ = 0.3 mV which is equivalent
8 MeV. The cross-talk signal, generated inside the SW card, between trigger tower
to
10−3, which is negligible. The amplitude dispersion σ at the
pulses, is of the order of
1.1% ([18]); no signiﬁcant spatial pat-
output of the SW cards has been measured to be
tern in the response of these cards was found, especially when the presums are distributed
to two SW cards as indicated in Fig. 9.

∼

∼

7.2 Total energy trigger

In this section we describe the electronics (Fig. 10) used to generate the trigger elements
Etot of the total energy for both in time (ToF or ep) and out of time (AToF or background)
events. They are based on the IET electronics and on two new boards, the Receiver card
(80 channels) and the Summing card (16 channels) which can be arranged in a crate in
a similar way as the SW and discriminator cards respectively. The receiver card is a
simpliﬁed version of the SW card, the OPA620 being mounted in the usual line receiver

18

conﬁguration. The Summing card performs the analog sums P16 or 2
P4
input channels; the option of the sums is set inside the card by jumpers. This allows great
ﬂexibility for doing sums according to a given mapping.

P8 or 4

×

×

LIET
Σ16

ATOF
Σ16

to FADC for L2 trigger

(8x)

Receiver
card

Summing
card

Receiver
card

Summing
card

Σ16

Σ64

S.W.
card

Discri
card

Receiver
card

Summing
card

Σ64

to L1 trigger

e-p
Etot

Receiver
Receiver
card
card

+

+

bkgEtot

Discri
card

to L1 trigger

ε

e-p
tot

bkgε

tot

(2 bits)

(2 bits)

Figure 10: General layout of total energy trigger

The 77 input channels of the summing electronics are processed diﬀerently for ep and

background events, as can be seen in Fig. 10:

•

•

For ep events, the P16 SpaCal channels with ToF signals supplied by the LIET cards
are summed into 8 ‘big sums’ which correspond to large regions of the calorimeter (4
quarters of an inner square of 16
16 SpaCal towers and 4 quarters of the remaining
outer shell). The 8 ‘big sums’ are fed into FADCs for the L2 trigger and, in parallel,
to a ﬁnal sum operation which provides the total energy Eep
tot.

×

For events outside of the ToF window (AToF events), the P16 SpaCal channels with
AToF signals supplied by the calorimetric ToF cards are processed by an electron
trigger crate (Fig. 10), using only one threshold for the energy comparison. The
‘OR’ of the 5 local AToF bits is sent to the L1 trigger. The purpose of the sliding
sum board for AToF energies is to recover, at the output of the discriminator cards,
the complete analog information for the total energy Ebkg
tot summation. The latter is
done in the same way as for the ep events (Fig. 10).

The right part of Fig. 10 shows that the quantities Eep

tot are discrim-
inated in place of the raw total energies Etot. This energy comparison is made to prevent
spurious triggers which are attributable to the following :

tot and Ebkg

tot–Ebkg

tot –Eep

1. Inside the calorimetric ToF board, the slewing of the CFD outputs for small energy
deposits (
CFD threshold value) can direct a non-negligible fraction of the total
energy of the event towards the trigger branch with inappropriate timing (AToF
instead of ToF or vice-versa).

∼

2. For an ep event, all energy deposits below the CFD threshold are not timed; they

are sent by default to the AToF branch and can lead to a trigger veto.

3. High frequency cross-talk inside the energy read-out and the ToF cards, summed

over the 16 neighbouring channels.

The ﬁrst two eﬀects dominate at low energy and the last one at high energy (4% of AToF
to ToF above 25 GeV and 2% ToF to AToF above 25 GeV).

19

As can been seen in Fig. 10, the subtraction is performed by feeding the same polarity
of the two diﬀerential pulses into a line receiver ampliﬁer of a Receiver card. The result
of this analog subtraction is compared with two thresholds of a discriminator card.

Although H1 has not yet run with the SpaCal energy thresholds set to values below
600 MeV, the electronic noise alone allows 100 MeV thresholds for the IET, well below
the 300 MeV level for a minimum ionising particle (mip).

8 Performance at HERA

During normal running at HERA, the rate scalers (Sect. 6) are used in a mode where
they cycle through all the SpaCal channels. Fig. 11 shows such a rate distribution; X
and Y are the SpaCal tower numbers. This on-line histogramming, as well as the timing
plots display of individual channels (not shown), have proven to be a valuable diagnostic
of both the correct behaviour of the SpaCal and of the backgrounds due to the HERA
beams. The rate distribution (Fig. 11) is peaked around the beam pipe at a value of
about 15 kHz. This is due to the proton–gas collisions, physics events accounting for only
a small fraction (

10−3) of this distribution.

∼

Hz

10 4

10 3

10 2

40

35

30

C

25

ell

20

n

u

15

10

m

5

5

0
0

b

er

15

10

C e l

40

35

30

25

20

l n u m b e r

Figure 11: 2-dimensional distribution of
the counting rates (Hz) of the 1192 cells
of the SpaCal EM calorimeter, measured
on-line by the TDC system.

E

E

ep
tot on
bkg
tot on

e-p events

10 4

s
s
s
s
s
s
t
t
t
t
t
t
n
n
n
n
n
n
e
e
e
e
e
e
v
v
v
v
v
v
E
E
E
E
E
E
b
b
b
b
b
b
N
N
N
N
N
N

 
 
 
 
 
 

 
 
 
 
 
 

10 3

10 2

10

1

-15 -12.5 -10 -7.5

-5

-2.5

0

2.5

5

7.5
Time (ns)
Time (ns)
Time (ns)
Time (ns)
Time (ns)
Time (ns)

10

Figure 12: Corrected time distri-
bution (see text) of the energy de-
posit in the SpaCal EM. The p-
background events seen here are in-
troduced in the H1 ﬁrst level trig-
ger prescaled by a factor
1000 to
monitor the performance of the var-
ious non-SpaCal triggers. The time
resolution achieved is σ
0.35 ns.

≥

∼

Studies of the performance of the SpaCal triggers can be achieved by recording events
without the on-line rejection maintained by higher-level triggers during normal H1 data-
taking. Fig. 12 shows a time distribution of events recorded during such a special run.
The earlier peak is due to background energy deposits, while the second one corresponds

20

to ep physics events, the small one in between coming from background due to the proton
beam structure (proton satellite bunch).

In Fig. 12, the time of the event has been calculated oﬀ-line in the following steps:

1. For the i-th cell, the raw time is corrected (tcorr

) from the oﬀset tep

tdc (sect.5) and the

i

slew eﬀect of the CFD,

2. The event time is deﬁned as the mean weighted time:

t =

ΣiEitcorr
i
ΣiEi

(7)

where Ei is the energy deposited in the i-th cell. This linear weighting has the
advantage of lowering the contribution of energy deposits which are approximately
40 MeV); for these low energies, the time is measured
equal to the CFD threshold (
with a jitter of a few ns due to the noise ﬂuctuation at the input of the CFD

∼

3. The ep distribution mean value is taken as the time origin. Due to the dispersion
tdc, the eﬀective histogramming time window is reduced from 32 ns to
25 ns. This window is still wide enough to contain both ToF events and proton

of the oﬀsets tep

∼
beam background.

∼

The two peaks of Fig. 12 are separated by

10 ns, as expected. The RMS width
of the physics events peak is a direct measurement of the time resolution achieved by
the SpaCal calorimeter and the electronics because the arrival-time dispersion of physics
events in the calorimeter is negligible. A gaussian ﬁt to data from events triggered by the
ep
total energy trigger
600 MeV yields a time
tot (see Fig.10) with an energy threshold of
E
0.35 ns, dominated by TDC resolution. The width of the background
resolution value σ
≃
peak is broader (σ
0.7 ns after subtraction of the 0.35 ns resolution) and is compatible
≃
with the proton bunch length measured, for instance, by the H1 central tracker detector
(σ
0.6 ns). When including events triggered by lower energies, the resolution degrades
from 0.35 ns at 600 MeV to 0.8 ns for 80 MeV (30 MeV) in the electromagnetic (hadronic)
section.

≃

∼

As can be seen in Fig. 12, besides the two main peaks discussed above, there is a
continuous time distribution of energy deposit. These events are related to background
collisions of a proton satellite bunch with the residual gas. This satellite bunch is delayed
with respect to the main proton bunch and varies in shape and intensity for diﬀerent ﬁlls
of the HERA machine.

These satellite background events can be used to study in-situ the transition AToF
↔
ToF performed by the calorimetric ToF board. The shaded histogram includes events
600 MeV, while
triggered by the total energy trigger
the hatched histogram corresponds to events which would have been rejected by the veto
bkg
tot at the same threshold value (see Fig.10); due to the energy subtraction performed
bkg
tot

E
at the last electronics stage, no events are found simultaneously with the
trigger bits ON.

ep
tot with an energy threshold of

ep
tot and

∼

E

E

E

10 ns) indicated by the vertical arrows. The transition AToF

The spread of the events selected as “ep” events corresponds to the average ToF
ToF
window width (
∼
occurs within
0.5 ns RMS. The width of this transition region is compatible with the
ToF window calibration error, dominated by the TDC resolution (and not by the slew
time because these events are from high energy background). At energies around 1 GeV
the transition would be broader due to slew eﬀects.

↔

∼

21

The two overlap events located at 3 ns and 4.5 ns (Fig. 12) are easily identiﬁed from
the oﬀ-line TDC information, as pile-up events of two consecutive bunches and are thus
rejected.

As a conclusion about this on-line time-of-ﬂight selection, it can be remarked that:

•

Events from the main proton peak are entirely rejected (about 108 events). The
remaining background due to the satellite bunches is of the order of 10−5 of the
It can be reduced to the level of 10−6 by an oﬀ-line
main proton background.
timing analysis. A further factor 10 can be gained by using the hadronic section of
the SpaCal [19].

•

For the 600 MeV cut on the total energy there is no loss of physics events. Below this
energy threshold, the importance of event topologies requires a special treatment,
as described in [19].

y
c
n
e

i

c

i
f
f

E

 

1

0.8

0.6

0.4

0.2

Thres.
Width

  1.800
 0.8550E-01

0

1

1.25

1.5

1.75

2

2.25

2.5

2.75

3
Energy / GeV

Figure 13: Combined eﬃciency of the time-of-ﬂight and electron trigger (IET) as a func-
tion of the deposited energy inside one sliding sum of the IET trigger.

Fig. 13 shows the combined eﬃciency of the time-of-ﬂight selection and the electron
trigger IET, for one sliding sum. This curve is obtained from the H1 data according to
the following procedure:

1. Events triggered without a SpaCal energy requirement and with a reconstructed

time in the interval of

2 ns (Fig. 12) are selected,

±

22

2. The deposited energy inside the trigger tower (Sect. 7.1) is calculated from the

energy deposited in the SpaCal towers belonging to the trigger tower,

3. Early or late pile-up events tagged by the

1 bunch-crossing TDC information are

rejected.

±

∼

85 MeV. This value is

During normal data taking, threshold values of the IET are set approximately to 0.5 GeV,
1.8 GeV and 5 GeV respectively. Fig. 13 shows that an eﬃciency of 100% is currently
achieved above 2 GeV by the second threshold, used mainly to trigger deep inelastic
scattering events; a similar performance has been shown (ref. [25]) for the lowest threshold
where an eﬃciency of 100 % is reached at 600 MeV. The width of the threshold (Fig. 13)
is found equal to σ
10 times greater than is expected from
the total noise (
8 MeV) of the analog sum (Sect.7.2). This discrepancy is due to the
variation, from channel to channel, of the charge preampliﬁcation gain discussed in Sect.
3. According to the shaping performed in the next stages, this gain variation is more or
less washed out; the longer shaping time of the readout branch implies that the shaped
pulse amplitude is less sensitive to this gain variation than the one in the trigger branch.
As the PM high voltages are tuned in order to balance the response of the channels in
the readout branch, the reconstructed width of the trigger threshold is larger than what
could be expected only from noise considerations. This gain eﬀect leads to a threshold
width proportional to the energy threshold, but is not a limitation for triggering with a
high eﬃciency over the full energy range.

∼

∼

9 Summary

The electronics associated with the H1 SpaCal lead/scintillating-ﬁbre calorimeters, in
operation at HERA since 1995 has been described. The full electronics was specially
developed to have the following functionality:

•

•

•

•

200 MHz) low noise (

Wideband (f
1 MeV) preampliﬁcation which uses the
photomultiplier capacitance for charge integration. This preampliﬁer is, in principle,
very general and can be applied to any low-capacitance detector.

≤

≤

For the readout branch, energy and time information for each cell is provided. In
particular, the time information has proved to be very powerful for the oﬀ-line
rejection of residual background or pile-up events. A time resolution of 0.8 ns is
obtained for SpaCal total energies above 80 MeV (30 MeV) for the electromagnetic
(hadronic) wheel.

For the trigger branch, the calorimeter time-of-ﬂight is able to reject proton back-
ground events with a time resolution of 0.5 ns RMS. The low-noise electron trigger,
based on analog sliding sums, running at the HERA frequency (10 MHz) enables
the use of 100% eﬃcient triggers with a cluster energy threshold as low as 0.5 GeV.

The low noise performance permits analog summation of the 1192 channels of the
electromagnetic calorimeter. A minimum-bias total-energy trigger with a threshold
of
0.6 GeV is currently used, yielding an out-of-time background rejection greater
than 106 with no measurable overeﬃciency. This total-energy sum, together with the
programmable switches of the calorimetric ToF board, are very powerful tools for

∼

23

the complete tuning and testing, channel by channel, of the electron and calorimetric
triggers.

10 Acknowledgements

The members of the H1 SpaCal group extend their warm thanks to the H1 collaboration
for its stimulating motivation and constant support, and acknowledge the outstanding
commitment of the many engineers and technicians from the diﬀerent institutes. The
authors thank C. de La Taille for his invaluable help in the design of the preampliﬁer.
The group also wishes to thank the DESY directorate for the hospitality extended to the
non-DESY members.

24

References

[1] H1 Collaboration, Technical Proposal to Upgrade the Backward Scattering Region

of the H1 Detector, DESY PRC 93/02.

[2] T. Nicholls et al., H1 SpaCal group, Nucl. Instr. and Meth. A374 (1996) 149.

[3] R.D. Appuhn et al., H1 SpaCal group, Nucl. Inst. and Meth.A386 (1997) 397.

[4] R.D. Appuhn et al., H1 SpaCal group, DESY 96-013.

[5] E. Tzamariudaki, VII Int. Conf. on Calorimetry in HEP, Tucson, AZ, USA (1997).

[6] J. B´an et al., Nucl. Instr. and Meth. A372 (1996) 399.

[7] I. Gorelov, VI Int. Conf. on Calorimetry in HEP, Frascati, Rome, Italy (1996), Fras-

cati Physics series vol.VI, pp 225-236.

[8] S. Dagoret et al., Nucl. Instr. and Meth. A346 (1994) 137.

[9] J. Janoth et al., Nucl. Instr. and Meth. A350 (1994) 221.

[10] R.D. Appuhn et al., H1 SpaCal group, Nucl.Inst. and Meth. A404 (1998) 265.

[11] V. Radeka, IEEE Trans. Nucl. Sci. NS 21 (1974) 51.

[12] See e.g. C. de La Taille, Th`ese de Doctorat (in French), Ecole Polytechnique, De-

cember 1989.

[13] SECRE Composants, Paris, France.

[14] R. Bernier et al., H1 internal note H1-07/92-237.

[15] B. Andrieu et al., H1 Calorimeter group, Nucl. Instr. and Meth. A336 (1993) 460.

[16] I. Abt et al., H1 Collaboration, DESY report H1-96-01 , DESY, Hamburg (1996) and

Nucl. Instr. and Meth. A386 (1997) 310 and ibid. A386 (1997) 348.

[17] R. Bernier et al., H1 internal note H1-04/92-219.

[18] S. Spielmann, Th`ese de Doctorat (in French), Ecole Polytechnique, July 1996.

[19] P. Zini, Th`ese de Doctorat (in French), Universit´e de Paris VI, July 1998.

[20] E. Eisenhandler et al., IEEE Trans. Nucl. Sci. 42 (1995) 688.

[21] T. Nicholls, Ph.D. Thesis, The University of Birmingham, April 1997.

[22] Y. Arai et al., IEEE Jour. of Solid State Circuits 27 (1992) 359.

[23] Y. Arai et al., IEEE Trans. Nucl. Sci. 39 (1992) 784.

[24] C. Beigbeider et al., H1 internal notes H1-10/92-242 and H1-02/93-269.

[25] F. Moreau, V Int. Conf. on Advanced Technology and Particle Physics, Como (Italy)

1996, Nucl. Phys. B (Proc. Suppl.), 132. 61B (1998).

25

