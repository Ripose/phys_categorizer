5
0
0
2
 
n
u
J
 
8
 
 
]
t
e
d
-
s
n
i
.
s
c
i
s
y
h
p
[
 
 
1
v
8
6
0
6
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

A sound card based multi-channel frequency measurement system

S. Groeger,1, 2 G. Bison,1 P. E. Knowles,1 and A. Weis1
1Physics Department, Universit´e de Fribourg, Chemin du Mus´ee 3, 1700 Fribourg, Switzerland
2Paul Scherrer Institute, 5232 Villigen PSI, Switzerland
(Dated: February 2, 2008)

For physical processes which express themselves as a frequency, for example magnetic ﬁeld mea-
surements using optically-pumped alkali-vapor magnetometers, the precise extraction of the fre-
quency from the noisy signal is a classical problem. We describe herein a frequency measurement
system based on an inexpensive commercially available computer sound card coupled with a software
single-tone estimator which reaches Cram´er–Rao limited performance, a feature which commercial
frequency counters often lack. Characterization of the system and examples of its successful appli-
cation to magnetometry are presented.

I.

INTRODUCTION

The present work is motivated by the need for a high
resolution frequency measurement system for analyzing
signals generated by optically-pumped cesium magne-
tometers [1]. A set of such magnetometers will be used
for a detailed investigation of magnetic ﬁeld ﬂuctuations
and gradients in an experiment searching for a neutron
electric dipole moment (nEDM). The experiment calls
for a magnetic ﬁeld of between 1 to 2 µT controlled at
the 80 fT level when measured over 100 s time intervals,
control corresponding to a relative uncertainty between
40 to 80 ppb. The magnetometers are based on the fact
that for low magnetic ﬁelds the Larmor precession fre-
quency fL in a vapor of Cs atoms is proportional to the
modulus of the magnetic ﬁeld ~B

(1)

fL = γ

.

~B
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

The proportionality factor γ is a combination of fun-
damental and material constants and has a value of
≈ 3.5 kHz/µT for 133Cs. The precession of the atoms
modulates the resonant absorption coeﬃcient of the ce-
sium vapor, which is measured by a photodiode moni-
toring the power of a laser beam traversing the atomic
vapor [2]. In the self-oscillating mode of operation [2, 3]
the magnetometer signal is of the form

s(t) = A sin (2πfLt + φ) + s0 .

(2)

The Larmor frequency, fL, has to be extracted from the
signal. Equation 1 connects the frequency determination
precision directly to the resulting ﬁeld measurement pre-
cision. The basic demand on the frequency measurement
system in order to achieve the required ﬁeld precision is
a resolution of a few hundred µHz in an integration time
of 100 s. Moreover, the synchronous detection of signals
from an array of magnetometers requires a cost-eﬀective
multi-channel solution.

In our recent study [3] of optically–pumped mag-
netometer performance, frequency measurements were
made with a commercial frequency counter (Stanford Re-
search Systems, model SR620), which has a limited fre-
quency resolution, thereby limiting the magnetic ﬁeld de-
termination. Frequency counters rely on the detection of

zero crossings of a periodic signal in a given dwell time.
Their performance is limited by their resolution of the
zero crossing times, an event which is aﬀected by the
amplitude, oﬀset, and phase noise of the signal. In de-
manding applications, such as the one investigated here,
that timing jitter limits the ultimate frequency resolution
of the magnetometer signal measurement. Put simple,
the limitation of frequency counters is due to the fact
that they use only information in the vicinity of the zero
crossings, while valuable wave form information from in
between the zero crossings is ignored.

As a more powerful alternative one can use numerical
frequency estimation algorithms to extract the frequency
from the complete waveform sampled at an appropriate
rate and with a suﬃcient resolution. The performance of
an ADC-based measurement system for measuring a sin-
gle frequency of about 8 Hz was discussed in [4]. Under
the assumption that a stable clock triggers the ADC, the
authors in [4] show that the lower limit of the frequency
resolution of their system coincides with the Cram´er–Rao
lower bound (CRLB) [5]. The CRLB is a well-known
concept from information theory and describes principle
limits for the estimation of parameters from sampled sig-
nals.

In our application, the Larmor frequency in a mag-
netic ﬁeld of 2 µT lies in the audio frequency range
(fL = 7 kHz). We have investigated whether a com-
mercially available (and rather inexpensive) professional
multi-channel sound card would present a viable solu-
tion for sampling the magnetometer signals. The estima-
tion of the frequency from the sampled data was done
by a software algorithm. In the following we will show
that such a simple system can indeed be used for CRLB
limited real-time frequency measurements and for a de-
tailed study of noise processes which limit the precision
of atomic magnetometers.

II. THE SYSTEM

The frequency measurement system consists of a pro-
fessional sound card (M–Audio Delta 1010) for digitizing
the analog input data, an atomic clock to provide a stable

time reference, and a standard personal computer (PC)
which reads the data and runs the frequency estimation
algorithm. The sound card provides 8 analog input chan-
nels in a breakout box that connects to a PCI interface
card in the PC. The analog input signals can be sampled
with a resolution of up to 24 bit at a sampling rate of up
to 96 kHz. In order to limit the amount of data we used
only 16-bit resolution, which was proven to yield suﬃ-
cient precision. Jitter or drifts of the sampling rate in-
duce additional phase noise on the sampled signal which
can seriously degrade the precision of the frequency esti-
mation. An essential feature of the Delta 1010 sound card
is its “world clock” input which can be used to phase-lock
the internal clock of the sound card to an external 96 kHz
time base. The time base was realized by a frequency gen-
erator synchronized to the 10 MHz signal of a rubidium
frequency standard (Stanford Research Systems, model
PRS10). The Rb frequency standard provides a relative
stability of 10−12 in 100 s which minimizes possible sam-
pling rate jitter and drifts far below the required level.
The requirements for the PC system are not very de-
manding as long as it allows for the continuous recording
of the 16 bit data sampled at a rate of 96 kHz (5.8 GB/h
for 8 channels). A 1.8 GHz Pentium-4 processor was fast
enough for real-time frequency determination for all eight
channels at a given integration time. However, for the de-
tailed analysis described below, in which the integration
time is varied, the time series were evaluated oﬀ-line from
the stored sampled data.

III. PERFORMANCE

Considering the magnetometer signal given by Eq. 2,
the frequency fL is to be determined from the AC-
coupled signal data which, after sampling, are of the form

where A is the signal amplitude, ∆t the time resolution
(inverse of the sampling rate rs), and φ0 the initial phase.
The number of sample points is N = τ /∆t(= τ rs), where
τ is the measurement integration time. Also shown is
the noise contribution at each point n arising from phase
n
noise δφn, frequency noise
k=1 δfk, and oﬀset noise
δxn. The frequency is determined from the data xn by
a maximum likelihood estimator based on a numerical
Fourier transformation which provides a CRLB limited
value [6]. The algorithm iteratively searches for the fre-
quency f that maximizes the modulus of the Fourier sum

P

M F (f ) =

xnWn exp

,

(4)

N −1

n=0
X

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

2πf
rs

n

i
(cid:18)

(cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

where Wn is a windowing function.

2

Under ideal conditions (stable ﬁeld and ideal electron-
ics), the frequency and phase noise (δfk and δφn) are
not present in the signal (Eq. 3). The fundamental noise
contribution is the photocurrent shot noise, which is pro-
portional to the square root of the DC oﬀset s0 in Eq. 2.
The noise is converted, by a transimpedance ampliﬁer,
to voltage Vpc and has a Gaussian amplitude distribu-
tion with zero mean, corresponding to a white frequency
spectrum that is characterized by its power spectral den-
x (in V2/Hz). The signal-to-noise ratio (SNR) is
sity ρ2
xfs), where fs = (2∆t)−1 = rs/2 is the
deﬁned as A2/(ρ2
sampling rate limited bandwidth, i.e., the Nyquist fre-
quency or the highest frequency that can be detected
unaliased. The CRLB of the frequency estimation from
such an ideal magnetometer signal is given by the vari-
ance [5]

σ2
CRLB =

3ρ2
x
π2A2τ 3 .

(5)

In frequency metrology it is customary to represent
frequency ﬂuctuations in terms of the Allan standard de-
viation σA — or its square σ2
A, the Allan variance [7, 8].
One can show that for white noise σA coincides with the
classical standard deviation [9]. A double logarithmic
plot of the dependence of σA on the integration time τ is
a valuable tool for assigning the origin of the noise pro-
cesses that limit the performance of an oscillator (see for
example [7, 8]). As shown in Table I, the variance σ2
A
depends both on integration time τ and measurement
bandwidth fc, which, for a measurement interval τ , is
given by fc = (2τ )−1. When that relation between band-
width and integration time is inserted into the formulas
given in the central column of Table I [8], one ﬁnds the
typical τ dependencies of the Allan standard deviation
σA shown in the right-hand column. In the presence of

white oﬀset

3
π2A2

·ρ

2

x· 1
τ 3

2
ﬂicker frequency 2 ln 2·h
f ·1

white frequency

ﬂicker phase

white phase

·ρ

2
f

1
2

· 1
τ

3
4π2
3
8π

·ρ

2

φ· fc
τ 2

φ· ln(2πfcτ )
2
·h
τ 2

−1

∝ τ

σA(τ )

−3/2

∝ τ

∝ τ 0

∝ τ −1/2

−3/2

∝ τ

TABLE I: The central column shows the dependence of the
Allan variance σ2
A on the integration time τ and measurement
bandwidth fc for the noise sources listed at the left [8]. White
noise sources α are characterized by their power spectral den-
sity ρ2
α. The frequency dependent spectral density of ﬂicker
noise process α is modeled by ρ2
α/f . By assuming
−1 we ﬁnd the power laws which typify
the relation fc = (2τ )
each noise type, shown in the right hand column.

α(f ) = h2

xn = A sin

2π

(fL + δfk) ∆t + φ0 +δφn

+ δxn, (3)

noise source

σ2
A(τ )

#

n

"

k=1
X
n = (0, . . . , N − 1) ,

0.1

1

10
Integration time (s)

t

100

0.01

0.1

1

10

100

Integration time (s)

t

10-2

10-3

10-4

10-5

10-6

10-7

10-8

10-9

)
z
H

(

A
s

.
v
e
d

 
.

d

t
s
 

n
a

l
l

A

t0

t-1/2

t-1

t-3/2

t-3/2

FIG. 1: Allan standard deviation of the frequency of a syn-
thesized sine wave aﬀected by diﬀerent noise processes. From
top to bottom: ﬂicker frequency noise (black dots), white
frequency noise (open circles), ﬂicker phase noise (black tri-
angles), white phase noise (open triangles), white oﬀset noise
(black squares).

several uncorrelated noise processes, α, the variance of
the estimated frequency is given by

σ2 =

σ2
α(f ) .

(6)

α
X
Note that for a magnetometer signal, the contribution
from Eq. 5 will always be present in the sum.

We ﬁrst investigated whether our data analysis algo-
rithm reproduces the theoretical τ -dependencies shown
in Table I. For that purpose we generated time series
(16 bit, 96 kHz) corresponding to Eq. 3 with only one of
the phase, frequency, or oﬀset noise terms enabled, and
selected with well deﬁned spectral characteristics (ﬂicker
or white). Figure 1 shows the Allan standard deviation
σA of those synthetic data. The emphasis here lies on
the slopes rather than on the absolute values, which were
chosen to yield a readable graph.

Next, we investigated the ability of the sound card to
reach CRLB limited detection of a 7 kHz sine wave. The
wave was generated by a digital function generator (Agi-
lent, model 33220A) stabilized to the same Rb frequency
standard as the sound card. In order to simulate a signal
comparable to that of the magnetometers, the SNR of
the function generator output was artiﬁcially decreased
from its nominal value of better than 5 × 105 to about
1.3 × 105 (in a 1 Hz bandwidth) by adding white oﬀset
noise. We recorded a 1 h time series of that signal, sam-
pled with 16-bit resolution. The data were analyzed with
the same algorithm as above and yielded an Allan stan-
dard deviation σA(τ ), shown as black dots in Fig. 2a).
The measurement agrees on an absolute scale with the
CRLB calculated using Eq. 5 and the applied SNR. In ad-
dition to the oﬀset noise, a second noise source was used
to apply 1/f noise, in turn, to the frequency or to the
phase modulation input of the function generator. The

)
z
H

(

A
s

.
v
e
d

 
.

d

t
s
 

n
a

l
l

A

10-1

10-2

10-3

10-4

10-5

10-6

10-7

10-8

10-9

)
z
H

(

A
s

.
v
e
d

 
.

d

t
s
 

n
a

l
l

A

10-2

10-3

10-4

10-5

10-6

10-7

t-1

t-3/2

frequency counter

d)

sound card

3

c)

b)

a)

FIG. 2: Allan standard deviation of the frequency of a sine
wave aﬀected by diﬀerent noise processes, measured with the
sound card (a–c) and a frequency counter (d): a) white oﬀset
noise, b) white oﬀset noise and ﬂicker phase noise, c) white
oﬀset noise and ﬂicker frequency noise. The dashed lines rep-
resent the dependencies calculated on an absolute scale using
the applied noise amplitudes. d) The same signal as in a)
measured with a commercial frequency counter (Stanford Re-
search model SR620) with a 300 Hz input bandpass ﬁlter.

a)

c)

b)

L
f
/
A
s

10-6

10-7

10-8

10-9

10-10

10-11

0.01

0.1

1

10

100

1000

Integration time (s)

t

FIG. 3: a) ASD σA of magnetic ﬁeld ﬂuctuations inside a
multi-layer magnetic shield. b) Residual ﬂuctuations of the
stabilized magnetic ﬁeld. The dashed lines indicate the CRLB
(left) and an assumed white frequency noise limitation (right).
c) Stability required for the proposed nEDM experiment.

resulting σA of the measured data is shown in Figs. 2b)
and c). Figure 2d) shows σA derived from the same sig-
nal as Fig. 2a) but analyzed by the commercial frequency
counter (Stanford Research Systems, model SR620) that
was used in [3]. The three points shown correspond to
the three possible integration times of the SR620. It can
be clearly seen that the counter technique does not allow
the correct measurement of these faint noise processes.
However, extrapolation of the data points suggest that
for integration times less than 10 ms the CRLB could be
reached.

Finally, after the frequency estimator algorithm and

the sound card had proven their CRLB performance
limit, we used the system to analyze the frequency gen-
erated by an optically-pumped magnetometer (OPM).
A magnetic ﬁeld of 2 µT was produced by a solenoid
driven by an ultra-stable current source. The OPM sig-
nal in that ﬁeld is a 7 kHz sine wave. The OPM and the
solenoid were located in a 6-layer magnetic shield in order
to suppress external ﬁeld ﬂuctuations. Figure 3a) shows
σA of a 2 h time series recorded with the sound card.
The data represent pure magnetic ﬁeld ﬂuctuations. In
particular, the approximately 2 mHz ﬂuctuations in the
range between 2 to 200 s could be traced back to irreg-
ular current ﬂuctuations in the solenoid. Nevertheless,
the relative ﬁeld stability — and therefore the relative
current stability — is on the order of 3 × 10−7 for that
range of integration times. However, for a 100 s integra-
tion time the ﬁeld instability exceeds the requirement for
the nEDM experiment mentioned in the introduction.

In order to determine the magnetometer performance
limit, we actively stabilized the magnetic ﬁeld in the fol-
lowing way. The magnetometer frequency was compared
to a stable reference oscillator (i.e., the Rb frequency
standard) by means of a phase comparator, and the er-
ror signal was used to control the solenoid current, thus
realizing a phase-locked loop. Figure 3b) shows the Al-
lan standard deviation of the OPM in the stabilized ﬁeld,
which is CRLB-limited up to an integration time of 1 s.
The noise excess between 1 and 300 s above the limits
expected from the CRLB and the assumed white noise

4

limitation shows the limitation of the current stabiliza-
tion scheme, which nonetheless allows the suppression of
the ﬂuctuations by three orders of magnitude at the in-
tegration time of interest.

We have realized a frequency measurement system
based on a digital sound card and have shown that it
yields a performance superior to commercial frequency
counters. We have proven that the system yields CRLB
limited frequency resolution in measurements of sine
waves aﬀected by various sources of noise. We have used
the system to prove that, at least in a limited range
of integration times, an active ﬁeld stabilization by an
optically pumped magnetometer is limited by the the-
oretical Cram´er-Rao bound. The performance and the
multi-channel feature of the sound card and its external
frequency reference option present a low-cost alternative
for applications requiring simultaneous characterization
of several frequency generation systems, especially for
long integration times.

Acknowledgments

We thank Francis Bourqui for help in developing the
read-out software. We acknowledge ﬁnancial support
from Schweizerischer Nationalfonds (grant no. 200020–
103864), and Paul Scherrer Institute (PSI).

[1] S. Groeger, G. Bison, and A. Weis, To be published in:

New Jersey 07458, 1993).

J. Res. Natl. Inst. Stand. Technol. 110(2005).

[6] D. C. Rife and R. R. Boorstyn, IEEE Trans. Inf. Theory 20,

[2] A. L. Bloom, Appl. Opt. 1, 61 (1962).
[3] S. Groeger, A. S. Pazgalev, and A. Weis, Appl. Phys. B 80,

591 (1974).

645 (2005).

[4] Y. Chibane, S. K. Lamoreaux, J. M. Pendlebury, and K. F.

Smith, Meas. Sci. Technol. 6, 1671 (1995).

[5] S. M. Kay, Fundamentals of Statistical Signal Processing,

Volume I: Estimation Theory, Prentice-Hall signal
processing series (Prentice Hall PTR, Upper Saddle River,

[7] J. Barnes, A. R. Chi, L. Cutler, D. Healey, D. Leeson,

T. McGunigal, J. Mullen, Jr., W. Smith, R. Sydnor, et al.,
IEEE Trans. Instrum. Meas. 20, 105 (1971).

[8] P. Lesage and C. Audoin, Radio Science 14, 521 (1979).
[9] D. W. Allan, IEEE Trans. Ultrason. Ferroel. Freq. Contr.

34, 647 (1987).

