Analysis of Water Vapor spatio-temporal structure over the
Madrid Area using GPS data

G. Ruﬃni1, A. Rius1, L. Cucurull1, A. Flores1

1

Short title: ANALYSIS OF WV SPATIO-TEMPORAL STRUCTURE

9
9
9
1
 
l
u
J
 
3
 
 
]
h
p
-
o
a
.
s
c
i
s
y
h
p
[
 
 
1
v
6
0
0
7
0
9
9
/
s
c
i
s
y
h
p
:
v
i
X
r
a

2

Abstract. We have analyzed Zenith Wet Delay (ZWD) time series from an

experiment over the Madrid (Spain) area obtained from 5 GPS receivers using two

diﬀerent techniques. In the ﬁrst case a delay correlation analysis of the ZWD time-series

has been carried out. We show that for this small network (with a spatial scale of

less than 100 km) the correlation between the time series is very strong, and that

using windowing techniques a reliable correlation delay time series can be produced for

each pair of sites (10 such pairs are available). We use this delay time series together

with a frozen ﬂow model to estimate the velocity of a passing front, and compare the

results to meteorological data and Numerical Weather Prediction output, showing good

agreement. In the second approach, the data is analyzed using Empirical Orthogonal

Functions. We demonstrate that the temporally demeaned and normalized analysis

yields information about the passing of fronts, while the spatially demeaned data

yields orographic information. A common second mode highlights the underlying wave

behavior.

3

Introduction

If an important goal for the GPS research community has been to test the limits of

the geophysical measurement techniques derived GPS technology, a now pressing task

is to use the newly available data for meteorological studies. We will focus here on

trying to extract relevant information from the new type of data generated by the GPS

measuring technique. In a previous publication we discussed the analysis of Zenith Wet

Delay (ZWD) and gradients measured with GPS and Water Vapor Radiometers (WVR)

[Ruﬃni et al. 1999]. We will now analyze the spatio-temporal structure of the obtained

GPS Zenith Wet Delay Time series. Similar studies have been carried out by [Davis

et al., 1998] (although the scale of the network involved, the Swedish permanent GPS

network, is signiﬁcantly diﬀerent, where it was already pointed out that GPS water

vapor estimates can be very useful for studying the spatial progress of air masses.

The refractivity of the neutral atmosphere at radio frequencies is given approximately

by N

77.6P/T + 3.73

105Pw/T 2

N dry + N wet, where P is the total pressure,

≈

×

≡

Pw is the water vapor partial pressure (both in mb), and T is the temperature (in

K). The equivalent excess path length corresponding to a ray crossing the neutral

atmosphere is given by [Bevis et al. 1992] ∆L = 10−6

N dl + S

. Here

is the

R

− G

G

straight-line distance between satellite and receiver, and S is the geometric path length

along the ray. In order to estimate Zenith Total Delay (ZTD) mapping functions are

used, because GPS measurements are not, in general, in the zenith direction. Mapping

functions model the dependence of the tropospheric delay on satellite elevation, making

some assumptions about the tropospheric gas distribution. In the past, azimuthally

symmetric models were employed, and the elevation dependent slant delay approximated

by ∆L(e)

∆Ldry

z mdry(e) + ∆Lwet

z mwet(e), where mwet(e) and mdry(e) are elevation

≈

mapping functions. Tropospheric delay gradient estimation is now possible and routinely

carried out [Bar-Sever et al. 1998; MacMillan 1995].

Two types of tropospheric gradients were considered in [El´osegui et al.,

4

≈

1998b; Ruﬃni et al. 1999]. Let the atmospheric refractivity be given by N(~ρ, z)

N0(z) +

∇ρN(z, ~ρ)
displacement vector, and deﬁne

|~ρ=0 ·

~ρ, where z is the height coordinate and ~ρ the horizontal

∇ρN(z, ~ρ)

|~ρ=0 ≡

~g(z), the horizontal refractivity

gradient. On one hand, there is a gradient associated with azimuthal dependencies

of delay observations at a GPS receiver. This GPS tropospheric slant-delay gradient

(sd-gradient), ~G = (GN , GE), is deﬁned by the non-azimuthally symmetric delay part in
the GPS signal by ∆D(e, ˆρ) = m∆(e) cot(e) ~G
azimuth unit vector [Bar-Sever et al. 1998; MacMillan 1995]. On the other hand, ~ZG,

ˆρ, where ˆρ = (cos φ, sin φ) = ~ρ/

is the

~ρ
||

||

·

the horizontal gradient estimated with the zenith delays from a network (zd-gradient)

is more closely related to ~g. As discussed in [El´osegui et al., 1998b], one can show

~G = 10−6

∞
0 dz z ~g(z),
R

~Z = 10−6

∞
0 dz ~g(z).
R

Here, we analyze the data from a GPS campaign carried out in the Madrid area

during December 1996 in the light of a frozen ﬂow model. It is known from analysis

of meteorological data that two humid, cold fronts crossed the network during the

campaign [Cucurull et al. 1998]. See also Figure 2 below.

The basic idea in the frozen ﬂow model is that the wet refractivity ﬁeld propagates

like a wave in the presence of a passing front:

N(ζ, ~ρ, t) = N0(~κ

~ρ

ωt)

e−ζ/h,

·

−

·

(1)

where the vectors are (2D) surface vectors. Here ζ is a generalized vertical coordinate

that depends on the distance from the geoid (z) but which may also depend on the

orography, ζ = z + η(~ρ), and h is a vertical scale. The velocity associated with this wave

is given by ~v = ˆκω/κ. Notice that temporal and spatial gradients are closely related in

this model: ~v

−
the ZWD (denoted by W ) is measured at constant z—not the present case.

· ∇

−

· ∇ρN =

∇tN

N

∇ρη/h or, equivalently, ~v

W = d

dt W

W

∇ρη/h, if

Notice also that the refractivity gradient is closely related to ~κ if we assume a

geopotentially stratiﬁed atmosphere, i.e., if z = ζ, since by equation 1, we have would

have ~g =

∇ρη/h, and the last term would
drop out. Unfortunately, this approximation was not correct for our network, where

∇ρN(z, ~ρ)

|~ρ=0 = ~κN ′
0(

ωt))e−ζ/h

ωt))

N(

−

−

−

5

orography plated an important role.

GPS Campaign

In the GPS campaign (December 1996), we deployed 5 Trimble geodetic GPS

receiver systems (called ROBL, ESCO, VILA, IGNE and VALD) near the Madrid area,

Spain, on December 2-15, 1996, with inter-site separations from 5 to 50 km [El´osegui

et al., 1998a] (see Table ). GPS observations consisted of data streams of undiﬀerenced

dual-frequency carrier-phase and pseudo-range measurements obtained every 30 seconds.

The GIPSY/OASIS-II (v.4) software package [Webb et al. 1993] (Gipsy) has been

used with a Point Positioning strategy to estimate ZTD at the ﬁve GPS sites with a

precision of 5 mm. Estimates of the satellite clock corrections and orbits were provided

by the IGS and JPL, as well as consistent earth-rotation parameters. Gipsy uses a

kalman ﬁltering technique to model time-dependent observables, such as the ZTD. The

tropospheric delay was modeled as a random walk, σ2 = d2

t, with a drift rate of d =

·

0.25 cm/√h. The drift rate for the gradient parameters was 0.03 cm/√h. We used a

cut-oﬀ elevation angle of 7o (see [Ruﬃni et al. 1999] for more data processing details).

The dry part of the delay can be estimated well (to less than 0.35 cm in delay) if surface

pressure is known to within 1.5 mb. We have used pressure estimates produced by

HIRLAM together with ground measurements, since barometric measurements were not

available at all sites. A conservative estimate of the accuracy of the pressure data is

better than a 1.5 mb [Cucurull et al. 1998].

6

(2)

Correlation analysis

sites can be approximated by

Given the frozen ﬂow model in equation 1, the time series of ZWD at the diﬀerent

Wi(t) = f (t + τi)e−ζi,

where Wi(t) represents the ZWD at the i-th site at time t, τi represents a delay relative

to some chosen site, and e−ζi is the scaling factor that should depend partly on the

height of the site (without loss of generality, we refer this height to VILA’s). Thus, the

delay τij between two sites will be given by τij = ~xij ·
velocity vector ~k is given by ˆv/v, the quotient of the velocity unit vector and its norm,

ˆv/v, where the inverse

~k = ~xij ·

τj. The delay is calculated by ﬁnding where the expression

~xij = ~xi −
F [τij] =

~xi, and τij = τi −
i (t)W t
W t

i∆., attains its maximum. The t-superscript indicates that the
time series’ have been temporally demeaned and normalized to unit standard deviation,

j (t + τij)

h

W t = (W

W

it. Cross-correlations are found using
− h
a time window given by ∆ (twelve hours were used here). In Figure 3 we see an example

it)/σt, where σt ≡ qh

− h

(W

W

it)2

of the analysis, where the signal is clearly seen. Note the presence of intervals where the

correlation is high, and the delay is zero, which will be discussed below.

The inverse velocity vector ~k has then been estimated, once for each time, by

minimizing

τij(t) −
The results are plotted in Figure 4, and will be discussed below. In particular, we

~xij ·

Xi6=j (cid:16)

(cid:17)

.

χ2(t) =

(3)

2

~k(t)

will try to interpret the existence of intervals where the estimated velocity is inﬁnite,

associated with zero delays.

EOF analysis

Empirical Orthogonal Function (EOF) decomposition is a standard tool in

multi-variate data analysis. For the task at hand, it will be convenient to think of the

7

(4)

ZWD time series at the diﬀerent sites as a time series of images, ~I(t), representing at

each time the WV content over a 2D network. Given these time series, the goal of EOF

analysis is to decompose them in orthogonal modes, that is

~I(t) =

5

Xj=1

λj ~Ij ·

uj(t).

We have used Singular Value Decomposition, a very useful tool in this context [Keiner

et al., 1997].

discuss below.

Carrying out EOF analysis with the original time series, however, yields a very

strong ﬁrst mode (λj = 338.9, 8.2, 5.6, 3.0, 4.2) which essentially represents the mean

temporal behavior and the exponential vertical behavior. The two eﬀects, however, are

hard to separate and interpret, as spatial and temporal eﬀects tend to get mixed up in

the modes. For this reason it is useful to demean and normalize the data ﬁrst, as we

It is important to emphasize that the most diﬃcult part in EOF analysis is not the

numerical computation of the modes (that is actually fairly simple), but to interpret the

results. For this task we will make extensive use of the ﬂow model.

Temporal demeaning

Let us ﬁrst study the case in which we temporally demean and normalize the time

series, since this parallels the correlation approach in the previous section. Recall that

we model by equation 2. It is the straightforward to show that

W t

i (t) =

f (t + τi)

f (t)

it

− h
st

≈

f (t)

f (t)

− h
st

it

+

˙f (t)τi
st

,

(5)

where s2

t =

(f (t)

f (t)

—assuming

h
this case should yield information analogous to that of correlation analysis. We should

− h

Et

D

0. Intuitively, EOF analysis in

˙f(t)

it ≈

it)2

obtain a spatially homogeneous ﬁrst mode, with a strong temporal variation, and a

second mode with a spatial structure related to the passing front (again, through the

8

delays involved). This spatial structure is directly related to the zd-gradients deﬁned

above, except for orographic corrections.

Another consequence of equation 5 is that W t

i (t) = g(t + τi). This means, for

example, in the case of two GPS sites that the observation matrix will have two columns

as follows, A = [g(t) g(t + τ )]. Carrying out the Singular Value Decomposition yields

A = UW V T with eigenvalues w± =

v± = (1,

1)/√2, and U eigenvectors u± = (g(t)

±

±

1
q

± h

g(t)g(t + τ )

it, corresponding V eigenvectors
g(t + τ ))/w±. Thus, we see that the

second mode carries information about the spatial relationships between the delays. The

second spatial eigenvector represents a spatial derivative, while the temporal eigenvector

is akin to a time derivative.

The case with three functions is more diﬃcult to analyze. Let gi(t) = g(t + τi), and

gij =

gi(t)gj(t)

h

it. Let also s =

q

12+g2
23+g2
g2
31
3

, and l = g12g23g31. Then, the eigenvalues

are given by λ = 1 + 2s (cos−1 (l/s3) + n2π/3) , with n = 0, 1, 2. For example, if
gi(t) = e−(t−τi)2/2∆2

/∆√4π, we ﬁnd

gi(t)gj(t)

ij /4∆2

.

h

it = e−τ 2

See Figure 5 for a representation of the ﬁrst three modes using GPS data for one of

the periods which involve the passage of a front (the eigenvalues for the decomposition

were λ = 10.0, 3.3, 2.3, 1.4, 1.2). Our simulations of passing fronts yield precisely this

structure. We have generated time series simply by taking one of the real ones and

shifting it in time in a manner conforming to that of a passing front. An example of the

resulting EOF analysis is shown in Figure 6—a north directed front was simulated with

a speed of 60 km/h. The eigenvalues in this case are λ = 12.37, 1.6, 0.6, 0.4, 0.0. The

fact that the last eigenvalue is zero is due to the need to specify only 4 numbers in the

simulation (the τi’s).

Spatial demeaning

In this case, spatial demeaning and normalization to unit variance are carried out

prior the EOF decomposition, W x = (W

W

ix)/σx, with σx =

− h

qh

(W

W

ix)2

ix.

− h

The x subscript means that statistics are to be computed using the site index i. From

equation 2, we ﬁnd,

W x

e−ζi

e−ζi

ix

d(ln f (t))
dt

τie−ζi

τie−ζi

ix

+

≈

where sx =

− h
sx
ix. Hence, up to normalization, we may expect modes
τie−ζi
,

qh
such as v0i ≈
with a temporal variation associated again to the time derivative of f (t). The ﬁrst

, with very little temporal variation, and v1i ≈

− h
e−ζi

τie−ζi

− h
sx
ix)2

(e−ζi/h

e−ζi/h

e−ζi

− h

− h

i

i

·

(6)

,

mode should be a reﬂection of the orography of the network, and the next modes

should encode the delay structure associated with the passing front. See Figure 7 for an

illustration of the ﬁrst 3 modes. The resulting eigenvalues were λ = 0.6, 0.3, 0.2, 0.1, 0.0.

Note here the disappearance of the last mode.

Spectral analysis

The spatially interpolated time-series can also be analyzed spectrally. This analysis,

however, is not simple to carry out or interpret, as we will see.

Spectral anaysis of the second EOF mode between the times of 13.6 and 14.2

days reveals peaks at the harmonic spatial frequency with several peaks in temporal

frequencies, including one at 0.7 per hour. This leads to a north-east velocities of around

40 km/h. The measured average surface wind speed was actually 25 km/h, and wind

direction was 42 degrees.

What should we expect from this analysis? A simple model for a traveling wave is

given by a gaussian wave-packet, Q = e−(kx−wt)2
kk′ e−k2/4k′2

F (k, ω) =

√π

δ(ω′/k′

ω/k).

−

. The Fourier transform is given by

For a more general wave in a non-dispersive medium, Q = Q(~k

wt), we obtain a

~x

·

−

similar result. The salient feature is a diagonal spectrum along the constant velocity

line ~k/ω = ~k′/ω′. In 2+1 dimensions the result is

F (~k, ω) = δ2(~k/ω

~k′/ω′) Z

−

eiωuQ(u)du.

9

(7)

(8)

10

As may be expected, perfect simulations with the required spatial density illustrate

this behavior, yielding a strong diagonal feature. Using the simulated data mentioned

above, however, we ﬁnd a north-direction-time spectrum with an axis of symmetry

deﬁned by a constant velocity vector, but not a diagonal spectrum. This is because the

simulation, although perfect at the station sites, loses coherence when interpolated in a

uniform grid, and the diagonal feature seems to be very unstable. The east direction

does conform to the ke = 0 equation. The resulting spectra for the north simulation

and the real time series are very similar, however, including the ke = 0 equation. We

conclude that spectral analysis of the raw time series are of limited use.

Conclusions

We have shown here that cross-correlation and EOF analysis can be very useful

tools for the detection of passing wet/dry fronts in small to medium size networks.

A striking feature of the EOF analysis is the similarity in the secondary modes

in the spatial and temporal demeaning approaches. As has been discussed before (see

[Keiner et al., 1997] and references therein), this is a feature of modes whose temporal

oscillations create spatial gradients, as is the case in the frozen ﬂow model—a simple

wave model.

We can also compare our results with those in [Ruﬃni et al. 1999]. We can see

there the passage of the front detected here in the form of the obtained sd-gradients

(see Figure 8), although it is hard at this point to make very quantitative statements.

The signal seems to appear in the two analysis, however, as we can see a south pointing

gradient. This in, in eﬀect, a comparison of zd-gradients with sd-gradients. If the

exponential law were exact we would see of course a match between the two. This is not

the case, however, because orography plays an important role.

We hypothesize that inﬁnite propagation speeds associated the zero delay

correlations (see Figure 1) are related to rain events. For instance, we can imagine that

11

at some time it is raining at all sites simultaneously: a drop in WV will be recorded at

all sites, yielding high correlation with zero delays. Any phenomenon that can change

the WV content estimates in the network at the same time will produce this eﬀect,

however, so the conclusion is not warranted. We have plotted rain rate measurements

in the Figure as well, for comparison. The peak of rain rate does seem to be associated

with the zero delay period and a ZWD drop during that time.

Acknowledgments. This work supported by Spanish Climate CICYT grant CLI95-1781

and by the WAVEFRONT project, funded by the European Commission Environment

and Climate Program (EC Contract ENV4-CT96-0301). We thank Caltech/JPL for the

GIPSY/OASIS–II package. The Spanish IGN loaned and operated the receivers. GR is

grateful to Jordi Vil`a for useful comments and constructive criticism.

12

References

5019–5035, 1998.

Bar-Sever, Y. E., Kroger, P. M., Borjesson, J. A., Estimating horizontal gradients of

tropospheric path delay with a single GPS receiver J. Geophys. Res., vol 103, No. B3:

Bevis, M., S. Businger, T.A. Herring, C. Rocken, R.A. Anthes, R. H. Ware, GPS Meteorology:

remote sensing of atmospheric water vapor using the Global Positioning System, J.

Geophys. Res., vol 97, No. D14: 15,787-15,801, 1992

Cucurull, L., Navascues, B., Ruﬃni, G., El´osegui, P. and Rius, A. On the use of GPS to

validate NWP systems: the HIRLAM model, submitted to Monthly Weather Review,

Oct 1998.

Davis, J.L., Elgered, G., The spatio-temporal structure of GPS water-vapor determinations,

Phys. Chem. Earth, vol 23, No. 1, pp. 91-96, 1998.

El´osegui, P., Rius, A., Davis, J.L., Ruﬃni, G., Keihm, S.J., B¨urki, B., Kruse, L. P., An

experiment for estimation of the spatial and temporal variations of water vapor using

GPS data, Phys. Chem. Earth, vol 23, No. 1, pp. 125-130, 1998.

El´osegui, P., J. L. Davis, A. E. Niell, G. Elgered, D. S. MacMillan, A proposed experiment for

measuring azimuthal variations in the atmosphere (abstract), EOS, Trans., AGU, 75,

Keiner, L. E., Xiao-Hai, Y., Empirical Orthogonal Function Analysis of Sea Surface

Temperature Patterns in the Delaware Bay, Trans. Geos. Rem. Sens., vol 35, no. 5, pp

173, 1998.

1299-1306, Sept. 1997.

MacMillan, D. S., Atmospheric gradients from very long baseline interferometry observations,

Geophysics. Res. Lett., 22, 1041-1044, 1995

G. Ruﬃni, L.P. Kruse, A. Rius, B. B¨urki, L. Cucurull and A. Flores, Estimation of

Tropospheric Zenith Delay and Gradients over the Madrid Area Using GPS and WVR

Data, Geophys. Res. Lett. vol. ??, No. ??, Feb 15, 1999.

13

Webb, F. H., J. F. Zumberge, An introduction to the GIPSY/OASIS-II, JPL Publ., D-11088,

1993.

G. Ruﬃni, Institut d’Estudis Espacials de Catalunya (IEEC), CSIC Research Unit,

Edif. Nexus-204, Gran Capit`a 2-4, 08034 Barcelona, Spain. (e-mail: ruﬃni@ieec.fcr.es)

Received July 30, 1998; revised November 5, 1998; accepted November 12, 1998.

1Institut d’Estudis Espacials de Catalunya, CSIC Research Unit, E-08034-Barcelona, Spain.

14

Table 1.

Positions of the re-

ceivers with respect to VILA (all

in km except ∆XZ, in meters.

site

∆XN

∆XE ∆XZ

ESCO 15.964

-16.834

IGNE

0.279

20.576

ROBL -1.558

-25.256

VALD 4.852

-7.158

430

119

181

197

VILA

0.000

0.000

0

15

Figure 1. The ZWD time series for the GPS and WVR during the campaign. The

periods during which no WVR data is available are associated with rain events, as the

WVR cannot work in wet conditions.

16

Figure 2. A Meteosat IR photo for December 12 1996 noon UTC (MET5 12 DEC 1996

1200 IR1 D2).

Figure 3. The delay structure between ESCO and ROBL (correlation is shown dashed

and normalized to 100 for graphing purposes). The fact that the delays are negative

mean, in the convention used, that ROBL detected the changes before ESCO. In the

bottom panel ROBL is shown dashed.

17

18

Figure 4. Results of the correlation analysis, and their comparison with meteorological

data. In the top panel we see the ZWD at VILA, and the average correlation function

of the analysis (normalized to 10). In the second panel we see the station mean delay

from the correlation analysis and the rain rate.

In the next panel the estimated ~k is

plotted. In the panel below the ground mean speed (in blue) is plotted vs. the estimated

wave speed. Finally, the estimated wave direction is plotted against the measured wind

direction (in blue) in the bottom panel.

Figure 5. The ﬁrst three modes after temporal demeaning. λ = 10.0, 3.3, 2.3, 1.2, 1.4.

19

Figure 6. The ﬁrst three modes after temporal demeaning with a simulated 60 km/h

north going front. λ = 12.37, 1.6, 0.6, 0.4, 0.0.

20

Figure 7. The ﬁrst three modes after spatial demeaning. λ = 0.6, 0.3, 0.2, 0.1, 0.0.

The ﬁrst mode is closely associated to the orography.

21

Figure 8. Gradients obtained with GPS: VILA (solid), ESCO (dots), ROBL (dashes).

