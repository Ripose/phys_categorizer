E-mail: erban@maths.ox.ac.uk; chapman@maths.ox.ac.uk

Radek Erban and S. Jonathan Chapman

simulations of reaction-diﬀusion processes

University of Oxford, Mathematical Institute, 24-29 St. Giles’, Oxford, OX1 3LB,
United Kingdom

6 Realistic boundary conditions for stochastic
0
0
2
 
v
o
N
 
7
2
 
 
]
h
p
-
o
i
b
.
s
c
i
s
y
h
p
[
 
 
1
v
1
5
2
1
1
6
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Abstract. Many cellular and subcellular biological processes can be described in
terms of diﬀusing and chemically reacting species (e.g.
enzymes). Such reaction-
diﬀusion processes can be mathematically modelled using either deterministic partial-
diﬀerential equations or stochastic simulation algorithms. The latter provide a more
detailed and precise picture, and several stochastic simulation algorithms have been
proposed in recent years. Such models typically give the same description of the
reaction-diﬀusion processes far from the boundary of the simulated domain, but
a membrane with receptors) is
the behaviour close to a reactive boundary (e.g.
unfortunately model-dependent.
In this paper, we study four diﬀerent approaches
to stochastic modelling of reaction-diﬀusion problems and show the correct choice of
the boundary condition for each model. The reactive boundary is treated as partially
reﬂective, which means that some molecules hitting the boundary are adsorbed (e.g.
bound to the receptor) and some molecules are reﬂected. The probability that the
molecule is adsorbed rather than reﬂected depends on the reactivity of the boundary
(e.g. on the rate constant of the adsorbing chemical reaction and on the number of
available receptors), and on the stochastic model used. This dependence is derived for
each model.

R3. Let
Let us consider a system of k chemicals diﬀusing and reacting in a domain Ω
nj(x, t), j = 1, . . . , k, be the density of molecules of the j-th chemical species at the
point x
Ω. Assuming that there are a lot of molecules present in the system, the time
evolution of density nj(x, t) can be computed by solving the system of reaction-diﬀusion
partial-diﬀerential equations

Keywords: stochastic simulation, boundary conditions, reaction-diﬀusion problems.

1. Introduction

⊂

∈

∂nj
∂t

= Dj∇

2nj + Rj(n1, n2, . . . , nk),

j = 1, . . . , k,

(1)

is the diﬀusion constant of the j-th chemical species,

2 is the Laplace
where Dj
operator and reaction term Rj(n1, n2, . . . , nk) takes into account the chemical reactions
which modify the concentration of the j-th chemical species. To describe uniquely the
time evolution of the system, we have to introduce suitable boundary conditions for the

∇

Boundary conditions for stochastic simulations

2

system of equations (1). The simplest boundary conditions can be formulated in terms of
vanishing density nj(x, t) on the boundary of Ω or vanishing ﬂux through the boundary
of Ω. Coupling system of equations (1) with such a boundary condition, we can compute
densities nj(x, t) at any time t from the initial densities nj(x, 0), j = 1, . . . , k.

Reaction-diﬀusion processes in biology often involve low molecular abundancies of
some chemical species. In such a case, the continuum deterministic description (1) is
no longer valid and suitable stochastic models must be used instead. Various stochastic
simulation algorithms have been proposed in the literature [1, 10, 11, 21]. In general,
the stochastic treatment of diﬀusion and ﬁrst-order reactions (such as degradation or
conversion) is well understood. There is less understanding (and stochastic models
diﬀer) when second-order chemical reactions are taken into account, e.g. reactions in
which two molecules collide for the reaction to take place. Another important problem
is the implementation of the correct boundary conditions for the stochastic simulation
algorithms. On the one hand, the simple boundary conditions mentioned above are
easy to reformulate in the stochastic case – the vanishing density on the boundary of Ω
simply means that a diﬀusing molecule is removed from the system whenever it hits the
boundary; and the vanishing ﬂux through the boundary means that a diﬀusing molecule
is reﬂected whenever it hits the boundary. On the other hand, more realistic boundary
conditions have to be handled with care. They can be formulated in terms of the
partially adsorbing boundary, which means that some molecules hitting the boundary
are reﬂected and some are adsorbed. The partially adsorbing boundary corresponds to
the so-called Robin boundary condition of the macroscopic partial-diﬀerential equation
(1). However, this correspondence is model-dependent.

We will see later,

in Section 5, that the derivation of the correct boundary
condition depends on the stochastic model of the diﬀusion but not on the stochastic
model of the chemical reactions in the solution. Consequently, we start this paper
by studying stochastic models of diﬀusion only.
In Section 2, we introduce four
diﬀerent stochastic approaches to model molecular diﬀusion and we state the appropriate
boundary conditions. In Section 3, we present illustrative simulations of all four models,
validating the boundary conditions presented. Moreover, we also clearly illustrate that
In Section 4, we present the
the boundary conditions are indeed model-dependent.
mathematical derivation of the boundary conditions for each model, i.e. we provide
a theoretical justiﬁcation of results from Section 2. Moreover, we show that all four
models are suitable for modelling diﬀusion far from the reactive boundary. Section 4
is intended for a more theoretical audience and can be skipped by a reader who is not
interested in the mathematical justiﬁcation of the boundary conditions and stochastic
models. In Section 5, we show that reaction-diﬀusion models can be treated using the
same boundary conditions which were previously derived for the corresponding models
of the diﬀusion only. We conclude with summary and outlook in Section 6.

Boundary conditions for stochastic simulations

3

2. Boundary conditions for stochastic models of diﬀusion

The boundary condition of any stochastic simulation algorithm can be formulated as
follows: whenever a molecule hits the boundary, it is adsorbed with some probability,
and reﬂected otherwise. The special cases of this boundary condition are:
(a) the
molecule is always reﬂected (such a boundary is called the reﬂecting boundary in what
follows); and (b) the molecule is always adsorbed (in this case the boundary is called
fully adsorbing). The reﬂecting boundary condition is often used when no adsorption of
the diﬀusing molecules on the boundary takes place. On the other hand, if the molecule
can chemically or physically attach to the boundary, then one has to assume that the
boundary is (at least) partially adsorbing.

The important question is, what is the probability that the particle is adsorbed
rather than reﬂected, and how does this relate to the reactive properties of the boundary
for a given stochastic model? To answer this question, let us follow the x-coordinate of
the diﬀusing molecule (the other coordinates can be treated similarly), so that we study
the diﬀusion of molecules in the one-dimensional interval [0, L] where L is the length of
the computational domain. Assuming that we have a lot of molecules in the system, we
can describe the system in terms of density n(x, t) of molecules at point x
[0, L] and
time t, so that n(x, t) δx gives the number of molecules in the small interval [x, x + δx]
at time t. The evolution of n(x, t) is governed by the diﬀusion equation

∈

∂n
∂t

= D

∂2n
∂x2 ,

for x

[0, L], t

0,

∈

≥

where D is the diﬀusion constant. The general ﬁrst-order reactive boundary condition
at x = 0 is the so-called Robin boundary condition

(2)

(3)

D

(0, t) = K n(0, t)

∂n
∂x

where the constant K describes the reactivity of the boundary (see Appendix for the
relation between K and the chemical properties of the boundary) and may in general
depend on time. The boundary condition at right boundary x = L can be treated
similarly.

In the following four subsections we introduce four stochastic models of diﬀusion.
The ﬁrst model, introduced in Section 2.1, is a position jump process on a lattice. This
model is discrete in both time and space, and is used in a stochastic simulation algorithm
which is based on the reaction-diﬀusion master equation [10, 11]. The second model,
introduced in Section 2.2, is again discrete in time and discontinuous in space but the
positions of molecules are not conﬁned to a regular lattice. It is essentially the Euler
scheme for the Smoluchowski stochastic diﬀerential equation, which is the core of the
stochastic approach of Andrews and Bray [1]. The third scheme, introduced in Section
2.3, is a discrete velocity jump process which is a discrete in time, continuous in space
random walk with discretized velocities, where the velocities evolve on a ﬁnite lattice.
The last stochastic model of diﬀusion, introduced in Section 2.4, is the Euler scheme for
the solution of the stochastic Langevin equation. It is a velocity jump process (i.e. a

Boundary conditions for stochastic simulations

4

random walk discrete in time, continuous in space and discontinuous in velocities) where
the Brownian particle can move with any real value of the velocity. In all four cases, we
study the connections between the boundary conditions of the stochastic simulation and
Robin boundary condition (3) of the macroscopic diﬀusion equation (2). We provide
the relation between K in (3) and the parameters of each model. The mathematical
derivation of these relations is included later, in Section 4.

2.1. Position Jump Process I

Let us discretize the domain of interest [0, L] into M lattice points a distance h = L/M
apart, namely we consider the lattice

h
2

,

3h
2

,

5h
2

,

7h
2

,

9h
2

. . . .

(2M

1)h

−
2

.

(cid:27)

(cid:26)

h2. We simulate a system of N molecules
Let us choose time step ∆t such that 2D∆t
whose positions are assumed to be at one of the discrete positions (4). Let xi(t) be
the position of the i-th molecule, i = 1, 2, . . . , N, at time t. The position xi(t + ∆t) is
computed from the position xi(t) as follows:

≪

xi(t + ∆t) = 


xi(t)
xi(t)
xi(t) + h

−

h

2D∆t/h2,

with probability 1
with probability D∆t/h2,
with probability D∆t/h2.

−



At x = 0, we implement the following boundary condition: whenever a molecule hits
the boundary, it is adsorbed with probability P1h, and reﬂected otherwise. Here, P1 is a
given nonnegative constant. The implementation of this boundary condition at x = 0
is performed as follows. If the i-th molecule is at position xi(t) = h/2 and attempts to
jump to the left, then

xi(t + ∆t) = h/2

with probability 1

P1h.

−

Otherwise, we remove the molecule from the system. We show in Section 4.1 that the
random walk (5) with boundary condition (6) leads to the diﬀusion equation (2) with
Robin boundary condition (3), where

K = P1D, which is equivalent to P1 =

K
D

.

2.2. Position Jump Process II

Let us choose a time step ∆t. Let xi(t), i = 1, 2, . . . , N, be the position of the i-th
molecule at time t. The position xi(t + ∆t) is computed from the position xi(t) as
follows:

xi(t + ∆t) = xi(t) + √2D ∆t ζi,

i = 1, . . . , N,

where ζi is normally distributed random variable with zero mean and unit variance. This
random walk is essentially the Euler scheme for the Smoluchowski stochastic diﬀerential

(4)

(5)

(6)

(7)

(8)

Boundary conditions for stochastic simulations

5

equation (21) as discussed later, in Section 4.2. We implement the following partially
adsorbing boundary condition at x = 0: whenever a molecule hits the boundary, it
is adsorbed with probability P2√∆t, and reﬂected otherwise. Obviously, if xi(t + ∆t)
computed by (8) is negative, a molecule has hit the boundary. However, Andrews and
Bray [1] argue that there is a chance that a molecule hit the boundary during the ﬁnite
time step even if xi(t + ∆t) computed by (8) is positive that is, during the time interval
[t, t + ∆t] the molecule might have crossed to xi negative and then crossed back to
xi positive again. They found that the probability that the molecule hit the boundary
x = 0 at least once during the time step ∆t is exp[
0,
−
xi(t+∆t)
0. Consequently, the partially reﬂective boundary condition is implemented
as follows:

xi(t)xi(t+∆t)/(D∆t)] for xi(t)

≥

≥

(a) If xi(t + ∆t) computed by (8) is negative then xi(t + ∆t) =
with probability 1

√2D ∆t ζi
P2√∆t, otherwise we remove the molecule from the system.
(b) If xi(t + ∆t) computed by (8) is positive then we remove the molecule from
the system with probability exp[

xi(t)xi(t + ∆t)/(D∆t)]P2√∆t.

xi(t)

−

−

−

−

The partially adsorbing boundary condition (a) - (b) leads to the Robin boundary
condition (3) with

K =

2P2√D
√π

, which is equivalent to P2 =

(9)

Let us note that some authors use the case (a) only as the implementation of the
partially reﬂective boundary condition [20], i.e.
they do not take the Andrews and
Bray correction (b) into account. Considering the random walk (8) with the boundary
condition (a) only, the parameter K of Robin boundary condition (3) can be computed
as

K =

, which is equivalent to P2 =

(10)

P2√D
√π

K√π
2√D

.

K√π
√D

.

Comparing (9) and (10), we see that we lose a factor of 2 if we do not consider the
Andrews and Bray correction (b). The mathematical justiﬁcation of formulas (9) and
(10) is presented in Section 4.2.

2.3. Velocity Jump Process I

We consider that each molecule moves along the x-axis at a constant (large) speed s, but
that at random instants of time it reverses its direction according to a Poisson process
with the turning frequency

λ =

s2
2D

.

(11)

its position xi(t) and its
Therefore, the i-th molecule is described by two variables:
velocity vi(t) =
1. During each time
step a molecule moves with speed s in the chosen direction. At the end of each time
[0, 1] is generated. If ri < λδt, then
step, uniformly distributed random number ri ∈

s. We use a small time step ∆t such that λ∆t

≪

±

Boundary conditions for stochastic simulations

6

the i-th molecule changes its direction, so that it will move during the next time step
in the opposite direction.

We implement the following partially adsorbing boundary condition at x = 0:
whenever a molecule hits the boundary, it is adsorbed with probability P3/s, and reﬂected
otherwise. Here, P3 is a given nonnegative number. The partially adsorbing boundary
condition at x = 0 is implemented as follows. If the position of the i-th molecule satisﬁes
xi(t + ∆t) < 0 at the end of the time step, then

xi(t + ∆t) =
vi(t + ∆t) =

−

xi(t)

vi(t)∆t

−
vi(t)

−

)

with probability 1

(12)

P3
s

,

−

otherwise, the i-th molecule is removed from the system.
It can be shown that this
velocity jump process leads to diﬀusion equation (2) provided that s is suﬃciently
large (see Section 4.3 for details). Boundary condition (12) can be related with Robin
boundary condition (3), with

K =

, which is equivalent to P3 = 2K.

(13)

P3
2

2.4. Velocity Jump Process II

Let us choose time step ∆t. The i-th molecule is described by two variables: its position
xi(t) and its velocity vi(t). We compute position xi(t + ∆t) and velocity vi(t + ∆t) from
position xi(t) and velocity vi(t) by formulas

xi(t + ∆t) = xi(t) + vi(t)∆t,
vi(t + ∆t) = vi(t)

βvi(t)∆t + β√2D∆t ζi,

−

(14)

(15)

where β is the (large) friction coeﬃcient and ζi is a normally distributed random variable
with zero mean and unit variance. This random walk is essentially the Euler scheme
for the stochastic Langevin equation [3]. The partially reﬂective boundary condition at
x = 0 can be stated as follows: whenever a molecule hits the boundary, it is adsorbed with
probability P4/√β, and reﬂected otherwise. Here, P4 is a given nonnegative number. The
implementation of this boundary condition is straightforward. If xi(t + ∆t) computed
by (14) is negative then

xi(t + ∆t) =
vi(t + ∆t) =

xi(t)

vi(t)∆t

−
−
vi(t) + βvi(t)∆t

−

β√2D∆t ζi )

−

with probability 1

;

(16)

P4
√β

−

otherwise, we remove the i-th molecule from the system.
It can be shown that this
velocity jump process leads to diﬀusion equation (2) provided that β is suﬃciently large
(see Section 4.4 for details). The parameter K of Robin boundary condition (3) is

K =

, which is equivalent to P4 =

(17)

P4√D
√2π

K√2π
√D

.

Boundary conditions for stochastic simulations

7

3. Comparison of stochastic models of diﬀusion

In this section, we present the results of two illustrative numerical simulations. First,
we choose the macroscopic value of K in (3), and we show the results of stochastic
simulations with the correct choice of the probabilities of the adsorption on the reactive
boundary for each model. We demonstrate numerically the validity of relations between
these probabilities and K, which were stated in Section 2 (the mathematical justiﬁcation
of these formulas is provided later, in Section 4). In the second numerical example, we
choose the apparently same microscopic boundary condition for each model. The goal
is to demonstrate that the realistic boundary condition has to be chosen for each model
with care, by applying formulas (7), (9), (13) or (17).

3.1. Stochastic simulation of models of diﬀusion

≥

Let us consider the computational domain [0, 5], i.e. L = 5 in this section. We choose
diﬀusion constant D = 1, and reactivity of the boundary x = 0 as K = 2. We
consider that the right boundary x = L is reﬂecting. Given an initial density proﬁle
n(x, 0), we can compute the density n(x, t) at time t
0 by solving diﬀusion equation
(2) accompanied with Robin boundary condition (3) at x = 0 and no-ﬂux boundary
condition at x = L. In this section, we show that comparable results can be obtained by
all four stochastic models provided that we choose the boundary conditions accordingly.
The key formulas were provided in the previous section. Given values of K and D,
we can compute the adsorbing probabilities on the reactive boundary x = 0 by formula
(7) for Position Jump Process I, formula (9) for Position Jump Process II, formula (13)
for Velocity Jump Process I and formula (17) for Velocity Jump Process II. We obtain
appropriate values of constants P1, P2, P3 and P4 which are used in the corresponding
stochastic model. In our case K = 2 and D = 1, so that formulas (7), (9), (13) and (17)
imply

P1 = 2, P2 = √π

.
= 1.772, P3 = 4, P4 = 2√2π

.
= 5.013.

(18)

The results of stochastic simulations are presented in Figure 1. The initial condition
was chosen as follows: we start with 100, 000 molecules in domain [0, 5]. We put 75, 000
molecules to position x = 1 and 25, 000 to position x = 2 at time t = 0. We plot the
density proﬁle at time t = 1 in Figure 1. To do that, we divide the interval [0, 5] into
50 bins of length 0.1 and we plot the number of molecules in each bin at time t = 1
(histograms). We also plot the solution of diﬀusion equation (2) accompanied by Robin
boundary condition (3) at x = 0 and no-ﬂux boundary condition at x = L. We see that
all four models of diﬀusion give the same results provided that we choose the partially
adsorbing probability accordingly.

To compute the simulation results from Figure 1, we also had to specify the
additional parameters of the stochastic models. We used space step h = 0.1 and time
step ∆t = 10−4 in Position Jump Process I. We used time step ∆t = 10−4 in Position
Jump Process II. We used speed s = 40 and time step ∆t = 10−5 in Velocity Jump

Boundary conditions for stochastic simulations

8

Position Jump Process I

Position Jump Process II

3000

2500

2000

1500

1000

500

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

3000

2500

2000

1500

1000

500

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

0
0

1

2
3
position

4

5

0
0

1

2
3
position

4

5

Velocity Jump Process I

Velocity Jump Process II

=1.772..
P
2

K=2

=5.013..
P
4

K=2

=2
P
1
K=2

=4
P
3
K=2

3000

2500

2000

1500

1000

500

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

3000

2500

2000

1500

1000

500

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

0
0

1

2
3
position

4

5

0
0

1

2
3
position

4

5

Figure 1. Stochastic simulations of four diﬀerent diﬀusion models for K = 2 and
D = 1. Probabilities of adsorption at partially adsorbing boundary x = 0 were computed
for each model according to formulas (7), (9), (13) and (17).

Process I and we used friction coeﬃcient β = 200 and time step ∆t = 10−6 in Velocity
Jump Process II.

3.2. Consequences of the same probability of adsorption

Let us now consider the following boundary condition: whenever a molecule hits the
boundary, it is adsorbed with probability R, and reﬂected otherwise. We can easily
modify the computer codes which were used to compute stochastic simulation results
from Figure 1 to incorporate this boundary condition: whenever the i-th molecule hits
the boundary, we generate a random number ri uniformly distributed in [0, 1]. If ri < R,
we remove the i-th molecule from the system. It means that the adsorbing condition
which was stated in terms of P1, P2, P3 and P4 is replaced by the same condition
expressed in terms of R. Choosing R = 0.05 and the same parameters and initial
condition as in Section 3.1, the stochastic simulation results at time t = 1 are shown
in Figure 2 (histograms obtained by dividing domain [0, 5] into 50 bins and plotting

Boundary conditions for stochastic simulations

9

Position Jump Process I

Position Jump Process II

4000

3000

2000

1000

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

4000

3000

2000

1000

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

4000

3000

2000

1000

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

4000

3000

2000

1000

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

0
0

1

2
3
position

4

5

0
0

1

2
3
position

4

5

Velocity Jump Process I

Velocity Jump Process II

0
0

1

2
3
position

4

5

0
0

1

2
3
position

4

5

Figure 2. Stochastic simulations of four diﬀerent diﬀusion models for R = 0.05
and D = 1 (histograms). Solid curves show the solution of the diﬀusion equation (2)
accompanied by no-ﬂux boundary condition at x = 5 and Robin boundary condition (3)
at x = 0 where the values of K are computed according to formulas (7), (9), (13) and
(17).

the number of molecules in each bin). We clearly see that the results quantitatively
diﬀer. The reason is that the probability of adsorption scales with other parameters of
simulations: namely with space step h for Position Jump Process I, with time step ∆t
for Position Jump Process II, with speed s for Velocity Jump Process I and with friction
coeﬃcient β with Velocity Jump Process II. The values of these scaling parameters were
chosen as in Section 3.1. Namely, we used space step h = 0.1 in Position Jump Process
I, time step ∆t = 10−4 in Position Jump Process II, speed s = 40 in Velocity Jump
Process I and friction coeﬃcient β = 200 in Velocity Jump Process II. Using these values,
we can compute P1, P2, P3 and P4 which correspond to R = 0.05. Moreover, we can
use formulas (7), (9), (13) and (17) to compute the corresponding value of K in Robin
.
= 5.64
boundary condition (3). We obtain K = 0.5 for Position Jump Process I, K
.
= 0.28 for
for Position Jump Process II, K = 1 for Velocity Jump Process I and K

Boundary conditions for stochastic simulations

10

Velocity Jump Process II. The solutions of diﬀusion equation (2) accompanied by no-
ﬂux boundary condition at x = 5 and Robin boundary condition (3) at x = 0 with
the appropriate choice of K are plotted in Figure 2 for comparison as solid curves. We
see that the Robin boundary condition (3) at x = 0 with the appropriate choice of K
gives the correct results when compared with stochastic simulations. Moreover, we also
conﬁrm that the same value of R leads to the diﬀerent values of K. Hence the boundary
condition cannot be formulated in terms of one probability R. It has to be appropriately
scaled as shown in Section 2.

To enable a direct comparison between models, we can slightly reformulate Position
Jump Process I. The formulation from Section 2.1 was chosen in a way which is used in
the stochastic reaction-diﬀusion approaches which are based on the reaction-diﬀusion
master equation [10, 11]. In particular, no relation between h and ∆t was given and
the probability of partial adsorption had to be scaled with h. One can also formulate
the position jump process on lattice as follows: we choose time step ∆t and space
step h = √2D ∆t. At each time step, the molecule jumps to the left with probability
1/2 and to the right otherwise. This random walk can be accompanied with partially
adsorbing boundary condition: whenever a molecule hits the boundary, it is adsorbed
P1√∆t, and reﬂected otherwise. This boundary condition leads to Robin
with probability
boundary condition (3) with K given by

e
K =

.

P1√D
√2
e

Comparing this formula with (9) or (13), we see that the Robin boundary condition is
diﬀerent for Position Jump Process I and Position Jump Process II even if we scale the
adsorption probability with the same factor √∆t.

The velocity jump processes can also be further compared. To do this, let us note
that the speed s of a molecule can be estimated as
kT /m where k is the Boltzmann’s
constant, T is the absolute temperature and m is the mass of a molecule. In particular,
we get the relation s = √Dβ which can be used to scale the boundary condition of
Velocity Jump Process I in terms of √β instead of s. Consequently, we can relate P3
to P4 by P3 = P4√D. However, using this relation in (13), we obtain a diﬀerent Robin
boundary condition (3) than by using formula (17).

p

To summarize this section, it is possible to reformulate Position Jump Process I to
have the adsorption probability of both position jump processes scaled as P √∆t. It is
possible to relate s to β in Velocity Jump Process I to have the adsorption probability
of both velocity jump processes scaled as P/√β. Then all four cases lead to Robin
boundary condition (3) of the form

K = αP √D

(19)

where α is model-dependent. Consequently, the boundary condition has to be chosen
diﬀerently for each model to get the same value of K in Robin boundary condition (3).
One has to use formulas (7), (9), (13) and (17) as we showed in Section 3.1.

Boundary conditions for stochastic simulations

11

4. Mathematical analysis of stochastic models of diﬀusion

The goal of this section is to provide the justiﬁcation of the results from Section 2. For
each stochastic model, we show that the model leads to the diﬀusion equation (2) away
from the boundary. Moreover, we derive the Robin boundary condition for each model.

4.1. Position Jump Process I

Let pk(t) be the probability of ﬁnding a molecule at mesh point xk = (2k
k = 1, 2, . . . , M. If k

= M, then pk satisﬁes

= 1, k

−

1)h/2 where

(cid:16)

h2

(cid:16)

−
h

pk(t + ∆t) =

pk(t) +

pk+1(t) + pk−1(t)

1
(cid:18)

−

2D∆t
h2

(cid:19)

D∆t
h2

(cid:17)

which can be rewritten as

pk(t + ∆t)
∆t

−

pk(t)

pk+1(t) + pk−1(t)

2pk(t)

−

.

= D

Passing to the limit ∆t
condition at x = 0 can be incorporated into the equation for p1(t) as

0, we obtain the diﬀusion equation (2). The boundary

0, h

→

→

p1(t + ∆t) =

p1(t) +

p2(t) + (1

P1h)p1(t)

(20)

1
(cid:18)

−

2D∆t
h2

(cid:19)

D∆t
h2

−

(cid:17)

which can be rewritten as

√∆t

p1(t + ∆t)
∆t

−

p1(t)

=

D√∆t
h

p2(t)

p1(t)

(cid:18)

P1 p1(t)

.

−

(cid:19)

Passing to the limit ∆t

0, h

0 such that √∆t/h is kept constant, we obtain (7).

→

→

4.2. Position Jump Process II

Position jump process (8) is a discretized version (Euler scheme) of the stochastic
diﬀerential equation

X(t + dt) = X(t) + √2D dW (dt)

(21)

where dW (dt) is the normal random variable with mean 0 and variance dt (i.e. the
propagator of the special Wiener process) and D is the macroscopic diﬀusion constant.
The diﬀusion equation (2) is the Fokker-Planck equation corresponding to the stochastic
diﬀerential equation (21) and its derivation can be found in any standard textbook
[17]. The derivation of Robin boundary condition (9) is more delicate and requires
the application of asymptotic methods [2]. To do that, we consider the Position Jump
Process II on the semiinﬁnite interval [0,
) subject to the boundary condition (a)-(b)
from Section 2.2. Let p∆t ≡
) be the probability
density function of the discretized process (8) with the boundary condition (a)-(b), so

∞
p∆t(x, t) : [0,

∆t N0 →

[0,

∞

∞

×

)

6
6
12

(22)

Boundary conditions for stochastic simulations

that p∆t(x, i∆t)dx is the probability of ﬁnding a molecule in the interval [x, x + dx] at
time t = i∆t. We have

p∆t(x, t + ∆t) =

p(x, t + ∆t

y, t) p∆t(y, t) dy,

|

∞

0

Z

|

where p(x, t + ∆t
y, t) is the conditional probability distribution function of ﬁnding
a molecule at point x at time t + ∆t given that it is at point y at time t. There
are two possible options to reach point x at time t + ∆t: either we use (8) only,
√2D ∆t ζi
i.e. x = y + √2D ∆t ζi; or we use the boundary condition x =
P2√∆t. If the former is true, we have to take into account that
with probability 1
some molecules are lost because of the Andrews and Bray boundary correction (b).
Consequently, we have

y
−

−

−

p(x, t + ∆t

y, t) =

|

1

exp

−

1
√4πD ∆t (cid:18)n
+ (1
−

P2√∆t) exp

xy
D∆t
−
i
h
(x + y)2
4D ∆t

P2√∆t

exp

o

y)2
(x
−
4D ∆t

+

(cid:21)

−

(cid:20)

=

1
√4πD ∆t (cid:18)

exp

−

(cid:20)

−
(cid:20)
y)2
(x
−
4D ∆t

(cid:21)

(cid:21)(cid:19)

−

+ (1

2P2√∆t) exp

(x + y)2
4D ∆t

.

(cid:21)(cid:19)

−

(cid:20)

Thus (22) reads as follows

p∆t(x, t + ∆t) =

∞

p∆t(y, t)
√4πD ∆t (cid:18)

exp

y)2
(x
−
4D ∆t

−

+ (1

2P2√∆t) exp

−

(x + y)2
4D ∆t

−

(cid:21)

(cid:20)

0
Z
Away from the boundary, a steepest descent approximation to the integral as ∆t
0
leads to the diﬀusion equation (2). However, as observed in [20], in the vicinity of
the boundary, such a calculation needs to be modiﬁed: there is a boundary layer of
width √∆t, and it is the solution in the boundary layer which determines the boundary
condition of the diﬀusion equation. In the boundary layer, we change variables from x
to η by setting x = √∆t η and deﬁne the inner solution

(cid:21)(cid:19)

→

(cid:20)

dy.

(23)

pinner(η, t) = p∆t(√∆t η, t).

Expanding pinner in the powers of √∆t, we obtain

pinner(η, t)

pi,0(η, t) + √∆t pi,1(η, t) + ∆t pi,2(η, t) + . . . .

∼

Using this expansion in the integral equation (23) and comparing the terms of the same
order, we obtain at O(1) that pi,0 is independent of η. At O(√∆t) we ﬁnd that

pi,1(η) =

2P2

−

∞

pi,0
√4πD

exp

0
Z

−

(cid:20)

∞

+

0
Z

pi,1(ξ)
√4πD (cid:18)

exp

−

(cid:20)

(ξ

η)2

−
4D

(cid:21)

+ exp

−

(cid:20)

(ξ + η)2
4D

dξ

(cid:21)
(ξ + η)2
4D

dξ.

(cid:21)(cid:19)

(24)

Boundary conditions for stochastic simulations

Now by matching the inner boundary layer expansion with the outer expansion
p∆t(x, t)

n(x, t) + . . ., we ﬁnd pi,0(t) = n(0, t) and

∼

lim
η→∞

∂pi,1
∂η

(η, t) =

(0, t).

∂n
∂x

Thus to determine the boundary condition on n at x = 0 we need to determine the
behaviour of ∂pi,1/∂η as η

. Diﬀerentiating (24) with respect to η, we obtain

→ ∞

(η) =

∂pi,1
∂η

P2 pi,0
√πD

exp

η2
4D

(cid:21)

−

(cid:20)
η)2

∞

+

0
Z

pi,1(ξ)
√4πD (cid:18)

ξ

η
−
2D

exp

−

(cid:20)

(ξ

−
4D

ξ + η
2D

exp

(ξ + η)2
4D

−

(cid:20)

dξ.

(cid:21)(cid:19)

−

(cid:21)

Using integration by parts, we obtain the integral equation

exp

η2
4D

(η) =

∂pi,1
∂η

P2 pi,0
√πD
1
√4πD
(cid:18)
Let us deﬁne the function g(η) by

(cid:21)
∂pi,1
∂η

−
(cid:20)
∞

(ξ)

0
Z

+

exp

−

(cid:20)

(ξ

η)2

−
4D

exp

−

(cid:21)

−

(cid:20)

(ξ + η)2
4D

dξ.

(cid:21)(cid:19)

P2 pi,0
√πD
Then (26) can be rewritten as

g(η) =

−

exp

η2
4D

(cid:21)

−

(cid:20)

+

∂pi,1
∂η

(η).

g(η) = φ(η) +

where

1
√4πD

∞

g(ξ)

exp

0

Z

(cid:18)

(ξ

η)2

−
4D

exp

−

(cid:21)

−

(cid:20)

(ξ + η)2
4D

dξ

(cid:21)(cid:19)

φ(η) =

P2 pi,0
√8πD

exp

−

(cid:20)

erf

(cid:21) (cid:18)

(cid:20)

η
√8D (cid:21)

erf

−

η
√8D (cid:21)(cid:19)

−

(cid:20)

and the error function is deﬁned by

−

(cid:20)

η2
8D

erf(ξ) =

exp

σ2

dσ.

2
√π

ξ

0
Z

−

(cid:2)
≥

(cid:3)

The function g(η) is deﬁned for η
the negative values as an odd function too by setting g(η) =
equation (28) can be simpliﬁed to

0. Since φ(η) is odd function, we can deﬁne g(η) for
η) for η < 0. Then

g(

−

−

g(η) = φ(η) +

g(ξ) exp

1
√4πD

∞

−∞

Z

(ξ

η)2

−
4D

dξ.

(cid:21)

−

(cid:20)

The natural way to solve such an equation is to apply a Fourier transform, but we have
to be slightly careful since the Fourier transform of g does not exist in the classical sense
(g tends to a constant at inﬁnity, so is not integrable). Deﬁning

g+(η) = g(η)χ[0,∞)(η)

g−(η) = g(η)χ(−∞,0](η),

13

(25)

(26)

(27)

(28)

(29)

(30)

Boundary conditions for stochastic simulations

14

where χ[a,b] is the characteristic function of the interval [a, b] (that is, χ[a,b](η) = 1 if
a

b and zero otherwise), and applying the Fourier transform

η

≤

≤

h(k) =

h(η) exp[ikη] dη

∞

−∞

Z

to equation (30), we obtain
b

(31)

g+(k) +

g−(k) =

φ(k) + (

g+(k) +

g−(k)) exp

Dk2

.

−

(cid:2)

(cid:3)

Thus

c
g+(k) +

c
g−(k) =

b

1

c
φ(k)

exp [
b

−

−

c

.

Dk2]

c

c

g+(k) and

g−(k), but in fact we know
This seems like one equation for the two unknowns
g+(k) is analytic for the imaginary part of k positive, while
from their deﬁnitions that
g−(k) is analytic for the imaginary part of k negative, and this tells us how to divide
c
g−(k), except for the pole at the
g+(k) and
all the poles of the right-hand side between
g−(k). To divide this pole contribution up
g+(k) or
origin, which may appear in either
c
k), which implies that the coeﬃcients of the
we note that since g is odd,
g−(
g+(k) =
c
−
odd powers of k near zero are equal in
g−(k), and that the coeﬃcients of the
g+(k) and
c
c
even powers are zero.
c
c

Using (27) we have

c

c

c

c

c

−

lim
η→∞

∂pi,1
∂η

(η) = lim
η→∞

g(η) = lim
η→∞

g+(k) exp[

ikη] dk,

−

1
2π

∞

−∞

Z

i
where the inversion contour lies in the upper half-plane. Deforming the contour to
∞
−
we pick up residue contributions from each of the poles of (31) in the lower half plane.
The only ﬁnite contribution as η

arises from the pole at the origin. Since

c

→ ∞

φ(k)

4i√DP2pi,0k
√π

∼

as k

0,

→

we have

so that

b

g+(k)

c

2iP2pi,0
√πD k

∼

as k

0,

→

D lim
η→∞

∂pi,1
∂η

(η) =

2P2 √D
√π

pi,0.

Using the matching condition (25) we therefore derive the Robin boundary condition
(9) for the stochastic boundary condition (a)-(b). If we consider the boundary condition
(a) only, equation (22) leads to the modiﬁed formula (23) where 2P2 is replaced by P2.
Thus the boundary layer method presented above gives in that case the Robin boundary
condition (10), which diﬀers from (9) by the factor of two.

Boundary conditions for stochastic simulations

4.3. Velocity Jump Process I

Using standard methods [12, 7], one can show that the density of molecules n(x, t)
satisﬁes the damped wave (telegrapher’s) equation

1
2λ

∂2n
∂t2 +

∂n
∂t

=

s2
2λ

∂2n
∂x2 .

The long time behaviour of (32) is described by the corresponding parabolic limit [22].
Using (11), we obtain that n(x, t) satisﬁes (2) for times t

λ−1.

Next, we derive the Robin boundary condition corresponding to (12). Let p+(x, t)
be the density of molecules that are at (x, t) and are moving to the right, and let p−(x, t)
be the density of molecules that are at (x, t) and are moving to the left. Then the density
of molecules at (x, t) is given by the sum n(x, t) = p+(x, t) + p−(x, t), and the ﬂux is
j(x, t) = s(p+(x, t)

p−(x, t)). The stochastic boundary condition (12) implies

≫

−
p+(0, t) =

1
(cid:18)

−

P3
s

(cid:19)

p−(0, t).

This boundary condition can be written in terms of n and j as

n(0, t) +

1
2

(cid:18)

j(0, t)
s

=

1

(cid:19)

(cid:18)

P3
s

−

1
2

(cid:19)

(cid:18)

n(0, t)

j(0, t)
s

−

(cid:19)

which implies

15

(32)

(33)

P3 n(0, t) =

2

j(0, t).

P3
s −

(cid:18)

(cid:19)

Since

j(0, t)

D

(0, t),

≈ −

∂n
∂x

we derive (13) in the limit s

.

→ ∞

4.4. Velocity Jump Process II

∞

The random walk (14)-(15) is a discretized version of Langevin’s equation [3]. To derive
the Robin boundary condition, we consider the behaviour of molecules in the semiinﬁnite
). The i-th molecule is described by two variables: its position xi(t) and
interval [0,
its velocity vi(t). We compute the position xi(t + ∆t) and velocity vi(t + ∆t) from the
position xi(t) and velocity vi(t) by (14)-(15) together with boundary condition (16) at
x = 0. Let f (x, v, t) be the density of molecules which are at position x with velocity
v at time t, so that f (x, v, t) δx δv is number of molecules in interval [x, x + δx] with
velocities between v and v + δv at time t. Assuming that the change in velocity of the
vi(t)), there are two
i-th molecule during the time step is ∆v (i.e. ∆v = vi(t + ∆t)
0 with velocity v at time t + ∆t:
possible options for the molecule to reach a point x
either the molecule was at position xi(t) = x
∆v
−
∆v and
at time t; or at position xi(t) =

≥
∆v)∆t with velocity vi(t) = v

x + (v + ∆v)∆t with velocity vi(t) =

(v

−

−

−

v
−

−

−

Boundary conditions for stochastic simulations

16

0. Consequently,

was reﬂected according to (16). Both cases make sense only if xi(t)
f (x, v, t + ∆t) can be computed from f (
∞

≥
, t) by the integral equation

·

·

,

f (x, v, t + ∆t) =

f (x

(v

∆v)∆t, v

∆v, t) ψ(v

∆v; ∆v) d∆v +

(34)

−

−

−

−

Z

v−x/∆t
∞

P4
√β

+

1
(cid:18)

−

−v+x/∆t

(cid:19) Z

−

f (

x + (v + ∆v)∆t,

∆v, t) ψ(

∆v; ∆v) d∆v

v
−

−

v
−

−

where ψ(w; ∆v) is a distribution function of the conditional probability that the change
in velocity during the time step is ∆v provided that vi(t) = w. Using (15), we obtain

ψ(w; ∆v) =

1
β√4πD∆t

exp

(∆v + βw∆t)2
4β2D∆t

.

(cid:21)

−

(cid:20)

0, we obtain that f (x, v, t) satisﬁes the Fokker-Planck

Passing to the limit ∆t
equation [3]

→

∂f
∂t

∂f
∂x

+ v

= β

vf + βD

∂
∂v

(cid:18)

∂f
∂v

(cid:19)

together with the boundary condition

P4
√β
The density of molecules at the point x and time t is deﬁned by

f (0, v, t) =

1
(cid:18)

v, t).

f (0,

−

−

(cid:19)

n(x, t) =

f (x, v, t) dv.

R

Z

To derive the diﬀusion equation for n and the corresponding Robin boundary condition
we consider the limit in which β

and rescale the velocity variable by setting

v = η

β,

f(x, η, t) = f (x, v, t),

→ ∞

p

to give

1
β

∂f
∂t

+

1
√β

η

∂f
∂x

=

∂
∂η

ηf + D

∂f
∂η

.

(cid:19)

We expand f in powers of 1/√β as

(cid:18)

1
√β

1
β

f(x, η, t) = f0(x, η, t) +

f1(x, η, t) +

f2(x, η, t) + . . . .

(40)

Substituting (40) into (39) and equating coeﬃcients of powers of β we obtain

∂
∂η
∂
∂η
∂
∂η

(cid:18)

(cid:18)

(cid:18)

ηf0 + D

= 0,

ηf1 + D

= η

,

ηf2 + D

= η

∂f0
∂η
∂f1
∂η
∂f2
∂η

(cid:19)

(cid:19)

(cid:19)

∂f0
∂x
∂f1
∂x

+

∂f0
∂t

.

(35)

(36)

(37)

(38)

(39)

(41)

(42)

(43)

17

(44)

(45)

(46)

Boundary conditions for stochastic simulations

Solving equations (41)-(42), we obtain

η2
2D

−

,

f0(x, η, t) = ̺(x, t) exp

f1(x, η, t) =

(cid:20)
(x, t) η exp

∂̺
∂x

−

(cid:21)

−

η2
2D

∂
∂η

∂f2
∂η

ηf2 + D

∂2̺
∂x2 η2 exp
Integrating over η gives the solvability condition
∂2̺
∂x2 .

∂̺
∂t

= D

−

=

(cid:18)

(cid:19)

(cid:20)
where the function ̺(x, t) is independent of η. Substituting (44)-(45) into (43) gives

(cid:21)

η2
2D

(cid:21)

−

(cid:20)

+

exp

∂̺
∂t

η2
2D

.

(cid:21)

−

(cid:20)

Using (38), we see that ̺(x, t) is proportional to density of individuals n(x, t) for large
β. Consequently, n(x, t) satisﬁes the diﬀusion equation (2) for large β. Multiplying (37)
by v and integrating over v, we obtain

j(0, t) =

∞

P4
√β

−

0
Z

vf (0,

v, t) dv

−

where ﬂux is deﬁned by j(0, t) =
derive the Robin boundary condition (17).

R

R vf (0, v, t) dv. Substituting (44)-(45) into (46), we

5. Boundary conditions for stochastic models of reaction-diﬀusion processes

In this section, we show that reactions in the solution do not change the boundary
conditions from Section 2, i.e.
the boundary conditions of stochastic models of the
reaction-diﬀusion processes are determined by the corresponding diﬀusion model. First,
we illustrate this fact numerically in Sections 5.1 and 5.2. In Section 5.1, we use the
stochastic approach based on the reaction-diﬀusion master equation [10, 11], so that the
corresponding diﬀusion model is the Position Jump Process I. In Section 5.2, we use
the stochastic approach of Andrews and Bray [1], so that the corresponding diﬀusion
model is the Position Jump Process II. Then, in Section 5.3, we provide mathematical
justiﬁcation of the fact that the presence of reactions in the solution does not inﬂuence
the choice of the boundary condition.

5.1. Nonlinear reaction kinetics

We consider two chemicals A and B which diﬀuse in the domain of interest [0, 1] with
diﬀusion constants DA and DB, respectively, and which react according to Schnakenberg
reaction kinetics [18]. The chemical A is produced with a constant rate (from a suitable
reactant which is supposed to be in excess) and degraded. The chemical B is also
produced with a constant rate. Moreover, A and B react according to the cubic reaction

2A + B

kc
−→

3A

(47)

Boundary conditions for stochastic simulations

18

3000

2500

2000

1500

1000

500

A

i

 
l
a
c
m
e
h
c
 
f
o
 
s
e
u
c
e
o
m

l

l

 
f
o
 
r
e
b
m
u
n

1500

1000

500

B

i

 
l
a
c
m
e
h
c
 
f
o
 
s
e
u
c
e
o
m

l

l

 
f
o
 
r
e
b
m
u
n

0
0

0
0

0.2

0.4

0.6

position

0.8

1

0.2

0.4

0.6

0.8

1

position

Figure 3. Stochastic simulations of the reaction-diﬀusion model of the Schnakenberg
kinetics with the partially adsorbing boundary at x = 0 (histograms). Panel on the left
shows chemical A and panel on the right chemical B. Solution of (48)-(49) with the
Robin boundary condition (50) at x = 0 and no-ﬂux boundary condition at x = 1 is
plotted as the solid line.

where kc is reaction constant. We use a partially adsorbing boundary condition at x = 0
and a reﬂective boundary condition at x = 1.

The stochastic simulation algorithm is based on the reaction-diﬀusion master
equation [10, 11]. We divide the domain of interest into M compartments of the length
h = 1/M which are assumed to be well-mixed. In particular, one can use the classical
Gillespie’s algorithm [9] to simulate stochastically the reactions in each compartment.
The system is then described by two M-dimensional vectors [A1, A2, . . . , AM ] and
[B1, B2, . . . , BM ] where Ai (resp. Bi) denotes the number of molecules of chemical A
(resp. B) in the i-th compartment. The diﬀusion of chemicals is added to the system as
another set of reactions–jumps between the neighbouring compartments with the rate
DA/h2 (resp. DB/h2) [15]. In particular, the model of diﬀusion is equivalent to the
Position Jump Process I.

We choose M = 50 in what follows, i.e. h = 0.02. Initially, we have ω = 1000
molecules of A and B in each compartment, i.e. Ai = Bi = ω, i = 1, 2, . . . , M, at
time t = 0. The rate of production of A is 2ω molecules per compartment per unit of
time. The rate of production of B is 8ω molecules per compartment per unit of time.
The degradation rate of A in the i-th compartment is proportional to 6Ai and kc is
chosen to be 3ω−2. Diﬀusion constants are DA = 1 and DB = 0.1. We implement
the following boundary condition at x = 0: whenever a molecule of chemical A (resp.
B) hits the boundary, it is adsorbed with probability P A
1 h), and reﬂected
otherwise. We choose P A
1 = P B
1 = 10. We consider the reﬂective boundary condition
for both chemicals at right boundary x = 1. Number of molecules in each compartment
at time t = 1 are plotted in Figure 3 (histograms).

1 h (resp. P B

Boundary conditions for stochastic simulations

19

Since ω is chosen suﬃciently large, we can compare the results of stochastic
simulation with A = ωa and B = ωb where a, b are the solution of the system of
reaction-diﬀusion equations
∂2a
∂x2 + 2
∂2b
∂x2 + 8

6a + 3a2 b

= DA

= DB

∂a
∂t

∂b
∂t

3a2 b

(48)

(49)

−

−

with Robin boundary conditions at x = 0 given by (7), namely

∂a
∂x

∂b
∂x

(0, t) = P A

1 a(0, t),

(0, t) = P B

1 b(0, t),

(50)

and with no-ﬂux boundary conditions at right boundary x = 1. The curves A = ωa and
B = ωb at time t = 1 are plotted in Figure 3 as solid lines for comparison. We see that
the Robin boundary (7) which was derived for the corresponding diﬀusion model gives
good results for the full reaction-diﬀusion simulation as well.

We note that the system (48)-(49) possesses a so-called Turing instability [13] if
the values of the diﬀusion constants DA and DB are chosen to be suﬃciently diﬀerent.
Our choice DA = 1 and DB = 0.1 falls in the regime in which the homogeneous solution
a = 10/6 and b = 48/50 of (48)-(49) is stable. On increasing the ratio DA/DB Turing
patterns would develop, and we would observe solutions with multiple peaks (provided
that the domain size is suﬃciently large); see e.g. [15].

5.2. Spatially localized reactions

In some morphogenesis applications [19, 16], one assumes that some prepatterning in the
domain exists and one wants to validate the reaction-diﬀusion mechanism of the next
stage of the patterning of the embryo. In this section, we present an example motivated
by this approach. We consider one-dimensional domain [0, 3] and we use the molecular
based approach of Andrews and Bray [1], i.e. the diﬀusion model is given by Position
Jump Process II. We choose a small simulation time step ∆t. At each time step, a
molecule is released at random points in the subinterval [1, 2] with probability kp∆t
1.
≪
Moreover, we assume that any molecule is degraded with probability kd∆t
1 during
the simulation time step. Here, kp and kd are given constants. We implement the
following boundary condition at x = 0: whenever a molecule hits the boundary, it is
adsorbed with probability P2√∆t, and reﬂected otherwise. We consider the reﬂective
boundary condition at right boundary x = 3.

≪

We start with no molecules in computational domain [0, 3] at time t = 0. We choose
diﬀusion constant D = 1, time step ∆t = 10−7, production rate kp = 105, degradation
rate kd = 1 and adsorption probability constant P2 = 5. To visualize the results, we
divide the interval [0, 3] into 30 bins of length 0.1 and we plot the number of molecules in
each bin at time t = 1 in Figure 4 (histogram). The results of the stochastic simulation
can be compared with the solution of reaction-diﬀusion equation

Boundary conditions for stochastic simulations

20

3500

3000

2500

2000

1500

1000

500

l

s
e
u
c
e
o
m

l

 
f
o
 
r
e
b
m
u
n

0
0

1

2

position

3

Figure 4. Stochastic simulations of the reaction-diﬀusion model with spatially localized
reaction with the partially adsorbing boundary at x = 0 (histogram). Solution of
.
(51) with Robin boundary condition (3), with K
= 5.642, and with no-ﬂux boundary
condition at x = 3, is plotted as the solid line.

∂n
∂t

= D

∂2n
∂x2 + 0.1 kpχ[1,2] −

kdn,

(51)

where χ[1,2] is characteristic function of the interval [1, 2]. Equation (51) is solved in
the interval [0, 3] together with Robin boundary condition (3), with K given by (9),
and with no-ﬂux boundary condition at x = 3. Using P2 = 5, formula (9) implies that
.
K
= 5.642. The density proﬁle n(x, 1) at time t = 1 is plotted in Figure 4 as a solid
line for comparison. We see that the Robin boundary condition (9), which was derived
for the corresponding diﬀusion model, gives good results for the full reaction-diﬀusion
simulation algorithm too.

5.3. Mathematical justiﬁcation

Let us consider a system of k chemicals diﬀusing and reacting in domain [0, L]. Let us
suppose that the diﬀusion model is the Position Jump Process I, i.e. we use the stochastic
approach based on the reaction-diﬀusion master equation [10, 11] as in Section 5.1. Let
pj
1(t) (resp. pj
2(t)) be the number of molecules of the j-th chemical, j = 1, 2, . . . , k, at
the boundary mesh point x1 = h/2 (resp. at x2 = 3h/2). If there are no reactions going
on, then pj
2(t) are related according to (20). Introducing reactions at mesh
point x = h/2, the boundary equation (20) is modiﬁed as follows

1(t) and pj

2D∆t
h2

(cid:19)

−

1
(cid:18)
1(t), . . . , pk

pj
1(t + ∆t) =

pj
1(t) +

(pj

2(t) + (1

P1h)pj

1(t)) + ∆tf (p1

1(t), . . . , pk

1(t))

D∆t
h2

−

where f (p1
1(t)) is the sum of the rates of all reactions which modiﬁes the j-th
chemical. Following the same procedure as in Section 4.1, we ﬁnd out that the additional
term does not inﬂuence the boundary condition (it is O(∆t) and only O(√∆t) terms
have nonzero contribution to the Robin boundary condition). In particular, we conclude

Boundary conditions for stochastic simulations

21

that the Robin boundary condition of the stochastic reaction-diﬀusion model is given
by (7).

Next, let us consider the stochastic reaction-diﬀusion model of Andrews and Bray
∆t N0 →
[1] which was used in Section 5.2. Let pj
pj
∆t(x, t) : [0,
) be the
density function of the j-th chemical species, so that pj
∆t(x, i∆t)dx is the number of j-th
molecules in interval [x, x + dx] at time t = i∆t. If there are no reactions going on, then
pj
∆t satisﬁes the formula (22). Introducing the reactions to the system, formula (22) is
modiﬁed as follows:

∆t ≡

[0,

∞

∞

×

)

∞

0

Z

p∆t(x, t + ∆t) =

[1 + O(∆t)] p(x, t + ∆t

y, t) p∆t(y, t) dy

(52)

|

where the additional O(∆t) term corresponds to the reactions in the solution. As before,
this term is of lower order (compared to O(√∆t) terms) and does not inﬂuence the Robin
boundary condition. Consequently, the Robin boundary condition (3) is obtained with
K given by (9).

In this paper, we did not use the velocity jump processes to simulate stochas-
tically the reaction-diﬀusion process. Velocity jump processes are generally more
computationally intensive. However, they might be of use if one considers that only
suﬃciently fast molecules can actually react. Alternatively, one can use the approach
based on binding/unbinding radii, as in the Andrews and Bray method [1], to incorporate
higher order reactions to the velocity jump models of molecular diﬀusion.
In any
case, the reactions are adding again O(∆t) terms and do not inﬂuence the boundary
conditions, i.e. the boundary conditions of the stochastic reaction-diﬀusion models can
be chosen as in the corresponding model of the diﬀusion only.

6. Conclusions and outlook

We have derived the correct boundary conditions for a number of stochastic models of
reaction-diﬀusion processes. For each model, we related the (microscopic) probability of
adsorption on the boundary with the (macroscopic) Robin (reactive) boundary condition
(3). First, we studied several stochastic models of diﬀusion. We showed that each model
is suitable for the description of the molecular diﬀusion far from the boundary. Moreover,
we derived formulas (7), (9), (13) and (17) relating reactivity K of the boundary with the
parameters of the stochastic simulation algorithms. Then, we showed that the boundary
conditions of stochastic models of reaction-diﬀusion processes are the same as for the
corresponding model of diﬀusion only. We studied the stochastic approaches based on
the reaction-diﬀusion master equation [10, 11] and on the Smoluchowski equation [1].
The main conclusion of this work is that a modeller can use any of the stochastic model
of the diﬀusion from Section 2, provided that the adsorption probability on the reactive
boundary is chosen according to the corresponding formula, i.e. (7), (9), (13) or (17),
which is model-dependent.

We also presented the mathematical derivation of key formulas (7), (9), (13) and
(17). We devoted the most space to the derivation of formula (9) which is (to our

Boundary conditions for stochastic simulations

22

knowledge) a new mathematical result. Derivation of formulas (7) and (13) is simple
and we included the mathematical arguments for completeness. The last formula (17)
has already appeared in literature [14], though our derivation is more systematic.

It is interesting to note that in some applications, the reactivity of the boundary
depends also on the geometrical constraints on the boundary. The binding sites
reactive groups or receptors) become full as the adsorption
on the surface (e.g.
progresses. Moreover, attaching large molecules to a binding site can sterically shield
the neighbourghing binding sites on the surface. For example, in [6, 4] we studied
the chemisorption of polymers where the attachment of a long polymer molecule to
the surface prevents attachment of other reactive polymers next to it. This steric
shielding was modelled using random sequential adsorption [8].
In these models, an
adsorption of one molecule to the surface is attempted per unit of time. To relate the
time scale of random sequential adsorption algorithms with physical time, one should
couple the theory of reactive boundaries presented here with algorithms which take the
additional geometrical constraints on the boundary into account. This is an area of
ongoing research [5].

Acknowledgments

This work was supported by the Biotechnology and Biological Sciences Research Council.

Appendix. Robin boundary condition and chemistry

In this appendix, we show the relation between the Robin boundary condition (3) and
the experimentally measurable chemical properties of the boundary. Let us consider a
chemical diﬀusing in the domain [0, L] which is adsorbed by boundary x = 0 with some
rate K. This problem can be described by the reaction-diﬀusion equation

∂n
∂t

∂2n
∂x2 −

= D

Kn δ(x),

for x

[0, L], t

0,

(53)

∈

≥

together with no-ﬂux boundary conditions, where D is the diﬀusion constant and δ(x)
a Dirac delta function. The term Kn δ(x) is a standard description of reaction kinetics,
localized on the boundary.
In the paper, we used an alternative description of the
chemically adsorbing boundary, given by the diﬀusion equation (2) accompanied by the
Robin boundary condition (3). It is interesting to note that the constant K in (3) is
actually equal to the experimentally measurable constant K. To see this, we discretize
(53) with space step h and we denote n0(t) = n(h/2, t) and n1(t) = n(3h/2, t). Using a
n(h/2, t)), the discretization of (53) gives
no-ﬂux boundary condition (i.e. n(

h/2, t)

which is equivalent to

∂n0
∂t

= D

n1 −

n0
h2 −

≡

−
Kn0

1
h

∂n0
∂t

= D

n1 −

n0 + hKn0

.

h2

(54)

(55)

Boundary conditions for stochastic simulations

23

The same equation can be obtained by the discretization of the diﬀusion equation (2)
together with the Robin boundary condition (3). Hence we showed that K = K, i.e.
the Robin boundary condition (3) is indeed the correct macroscopic description of the
chemically reacting boundary.

References

[1] S. Andrews and D. Bray, Stochastic simulation of chemical reactions with spatial resolution and

single molecule detail, Physical Biology 1 (2004), 137–151.

[2] C. Bender and S. Orszag, Advanced mathematical methods for scientists an engineers, McGraw-Hill

[3] S. Chandrasekhar, Stochastic problems in physics and astronomy, Reviews of Modern Physics 15

book company, 1978.

(1943), 2–89.

[4] R. Erban and S. J. Chapman, On chemisorption of polymers to solid surfaces, 20 pages, to appear

in Journal of Statistical Physics, available as arxiv.org/physics/0609029, 2006.

[5]

, What is the time scale of random sequential adsorption?, 4 pages, submitted to Physical

Review Letters, available as arxiv.org/physics/0611252, 2006.

[6] R. Erban, S. J. Chapman, K. Fisher, I. Kevrekidis, and L. Seymour, Dynamics of polydisperse
irreversible adsorption: a pharmacological example, 22 pages, to appear in Mathematical Models
and Methods in Applied Sciences (M3AS), available as arxiv.org/physics/0602001, 2006.
[7] R. Erban and H. Othmer, From individual to collective behaviour in bacterial chemotaxis, SIAM

Journal on Applied Mathematics 65 (2004), no. 2, 361–391.

[8] J. Evans, Random and cooperative sequential adsorption, Reviews of Modern Physics 65 (1993),

[9] D. Gillespie, Exact stochastic simulation of coupled chemical reactions, Journal of Physical

no. 4, 1281–1329.

Chemistry 81 (1977), no. 25, 2340–2361.

matics 21 (2005), no. 12, 2923–2924.

[10] J. Hattne, D. Fagne, and J. Elf, Stochastic reaction-diﬀusion simulation with MesoRD, Bioinfor-

[11] S. Isaacson and C. Peskin, Incorporating diﬀusion in complex geometries into stochastic chemical
kinetics simulations, SIAM Journal on Scientiﬁc Computing 28 (2006), no. 1, 47 – 74.
[12] M. Kac, A stochastic model related to the telegrapher’s equation, Rocky Mountain Journal of

Mathematics 4 (1974), no. 3, 497–509.

[13] J. Murray, Mathematical Biology, Springer Verlag, 2002.
[14] K. Naqvi, K. Mork, and S. Waldenstrom, Reduction of the Fokker-Planck equation with an
adsorbing or reﬂecting boundary to the diﬀusion equation and the radiation boundary condition,
Physical Review Letters 49 (1982), no. 5, 304–307.

[15] L. Qiao, R. Erban, C. Kelley, and I. Kevrekidis, Spatially distributed stochastic systems: Equation-
free and equation-assisted preconditioned computation, to appear in Journal of Chemical Physics,
available as arxiv.org/q-bio/0606006, 2006.

[16] G. Reeves, R. Kalifa, D. Klein, M. Lemmon, and S. Shvartsmann, Computational analysis of

EGFR inhibition by Argos, Developmental biology 284 (2005), 523–535.

[17] H. Risken, The Fokker-Planck Equation, methods of solution and applications, Springer-Verlag,

1989.

[18] J. Schnakenberg, Simple chemical reaction systems with limit cycle behaviour, Journal of

Theoretical Biology 81 (1979), 389–400.

[19] O. Shimmi, D. Umulis, H. Othmer, and M. Connor, Faciliated transport of a Dpp/Scw heterodimer
by Sog/Tsg leads to robust patterning of the Drosophila blastoderm embryo, Cell 120 (2005),
no. 6, 873–886.

[20] A. Singer, Z. Schuss, and D. Holcman, Partially reﬂected diﬀusion, 16 pages, preprint available as

arxiv.org/math-ph/0606043, 2006.

Boundary conditions for stochastic simulations

24

[21] A. Stundzia and C. Lumsden, Stochastic simulation of coupled reaction-diﬀusion processes, Journal

of Computational Physics 127 (1996), 196–207.

[22] E. Zauderer, Partial Diﬀerential Equations of Applied Mathematics, John Wiley & Sons, 1983.

