6
0
0
2
 
b
e
F
 
4
1
 
 
]
h
p
-
o
i
b
.
s
c
i
s
y
h
p
[
 
 
1
v
8
8
0
2
0
6
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Comparing free energy methods for molecular systems: Thermodynamic integration,
adaptive integration, Jarzynski method, and path-sampling

F. Marty Ytreberg∗
Department of Computational Biology, and Department of Environmental and Occupational Health,
University of Pittsburgh, 3064 BST-3, Pittsburgh, PA 15213

Robert H. Swendsen
Department of Physics, Carnegie Mellon University, Pittsburgh, PA 15213

Daniel M. Zuckerman†
Department of Computational Biology, University of Pittsburgh, 3064 BST-3, Pittsburgh, PA 15213
(Dated: February 21, 2014)

We present a careful comparison of eﬃciency and precision for several free energy diﬀerence
(∆F ) methods. The analysis includes both equilibrium and non-equilibrium approaches, as well as
distinguishing between uni-directional and bi-directional methodology. For the ﬁrst time, adaptive
integration and single-ensemble path sampling approaches are adopted for molecular systems. The
test systems used for this study are relative solvation free energies, with large changes to the size
or charge of a Lennard-Jones particle in explicit solvent. The results show that, for the systems
used in this study, both adaptive integration and path sampling oﬀer unique advantages over the
more traditional approaches of thermodynamic integration and Jarzynski averaging. Speciﬁcally,
adaptive integration is found to provide very precise long-simulation ∆F estimates as compared to
other methods used in this report, while also oﬀering reliable rapid estimation of ∆F . Also, the
single-ensemble path sampling approach is found to be superior to ordinary Jarzynski averaging for
the case where the free energy data is uni-directional and “fast-growth.”

I.

INTRODUCTION

Free energy diﬀerence (∆F ) calculations are useful
for a wide variety of applications,
including drug de-
sign [1, 2], solubility of small molecules [3, 4], and pro-
tein/ligand binding aﬃnities [5, 6, 7]. Due to the high
computational cost of ∆F calculations, it is of interest
to carefully compare the eﬃciencies of the various ap-
proaches.

The purpose of this study is to provide a careful com-
parison of the eﬃciency and precision of several ∆F
methods. We seek to answer two important questions:
(i) Given a ﬁxed amount of computational time (106 dy-
namics steps, in this study), which method estimates the
(ii)
correct value of ∆F with the greatest precision?
Which ∆F approach can obtain a reasonable estimate
of ∆F in the least amount of computational time?

Free energy diﬀerence methods can be classiﬁed as
either equilibrium or non-equilibrium. Equilibrium ap-
proaches include multi-stage free energy perturbation
[8], thermodynamic integration [9] multi-stage Bennett
analysis [10, 11] and weighted histogram analysis [12].
These approaches are in wide use and are known to pro-
vide accurate results, however, the computational cost
can be large due the simulation time needed to attain
equilibrium at each intermediate stage. A host of non-
equilibrium methods have recently been applied to vari-

∗E-mail: fmy1@pitt.edu
†E-mail: dmz@ccbb.pitt.edu

ous molecular systems, largely due to Jarzynski’s remark-
able equality [13]. Non-equilibrium methods have the po-
tential to provide very rapid estimates of ∆F , but can
suﬀer from bias [14, 15, 16].

In this report we present results using both equilib-
rium and non-equilibrium approaches—as well as uni-
Speciﬁ-
directional and bi-directional methodology.
cally, we compare: (i) thermodynamic integration [9];
(ii) adaptive integration [17]; (ii) single-ensemble path
sampling of non-equilibrium work values using Jarzyn-
ski’s uni-directional averaging; (iii) single-ensemble path
sampling using Bennett’s bi-directional formalism [18];
(iv) Jarzynski averaging of non-equilibrium work values
[13, 19]; and (v) Bennett analysis of non-equilibrium
work values [10, 20, 21].

II. FREE ENERGY METHODS

Generally, one is interested in the free energy diﬀerence
(∆F = F1 −F0) between two states or systems of interest
denoted by potential energy functions U0(~x) and U1(~x),
where ~x is the full set of conﬁgurational coordinates. ∆F
can be written in terms of the partition functions for each
state

∆F = −kBT ln

(1)

 

Z
Z

U1(~x)
U0(~x)
(cid:3)
(cid:2)
(cid:3)
(cid:2)

,
!

where kB is the Boltzmann constant and T is the system
temperature. There are many ways to estimate the ra-
tio of partition functions in Eq. (1), some of which are
detailed below.

2

(6)

(7)

A. Thermodynamic integration

C. Jarzynski averaging

Thermodynamic integration (TI) is probably the most
common fully equilibrium approach. In TI, equilibrium
simulations are performed at multiple values of the scal-
ing parameter λ. Then ∆F is found by approximating
the integral [9],

For the Jarzynski method [13], one considers non-
equilibrium paths that combine increments in λ with
“traditional” dynamics (e.g., Monte Carlo or molecular
dynamics) in ~x at ﬁxed λ values. Thus, a path with n
λ-steps is given by

1

∆F =

dλ

λ=0

Z

(cid:28)

∂Uλ(~x)
∂λ

,

(cid:29)λ

(2)

n

where the functional form for Uλ(~x) depends upon the
scaling methodology and will be discussed in detail in
Sec. III. Assuming that an adequate equilibrium sam-
pling is obtained at each λ value, error arises in TI from
the fact that only a ﬁnite number of λ values can be sim-
ulated, and thus the integral must be approximated by a
sum [11]. Thermodynamic integration can provide very
accurate ∆F calculations, but can also be computation-
ally expensive due to the equilibrium sampling required
at each λ value [22, 23, 24, 25].

B. Adaptive integration

The adaptive integration method (AIM), detailed in
Ref. [17], seeks to estimate the same integral as that of
TI; namely Eq. (2). However, the AIM approach uses a
Metropolis Monte Carlo procedure to sample the λ pro-
ﬁle. This is done by occasionally attempting Monte Carlo
moves in λ during the simulation. The probability of ac-
cepting a change from the old value λo to a new value λn
is

Pacc(λo → λn) =

Uλn (~x)−Uλo (~x)

δ ˆF (λn)−δ ˆF (λo)

min

1.0, e−β

(cid:20)

(cid:0)

e+β

(cid:1)

(cid:0)

,

(3)

(cid:1)(cid:21)

where β = 1/kBT and δ ˆF (λi) is the current running free
energy estimate obtained by numerically approximating
the integral

δ ˆF (λi) =

i

dλ

λ=0

Z

(cid:28)

∂Uλ(~x)
∂λ

.

(cid:29)λ

(4)

Between attempted Monte Carlo moves in λ, any canoni-
cal sampling scheme (e.g., molecular dynamics, Langevin
dynamics, Monte Carlo) can be used to propagate the
system. In this report, Langevin dynamics is used, and
Monte Carlo moves in λ are attempted at every time step.
It is important to note that, due to the use of the
running estimate δ ˆF in Eq. (3), the AIM method satisﬁes
detailed balance only asymptotically.
In other words,
once the ∆F estimate fully converges, the value of δ ˆF is
correct, and detailed balance is satisﬁed.

Zn =

(λ0 = 0, ~x0), (λ1, ~x0), (λ1, ~x1), (λ2, ~x1),

(λ2, ~x2), ..., (λn−1, ~xn−1), (λn = 1, ~xn−1)

,

(5)

o

where it should be noted that increments (steps) from λi
to λi+1 are performed at a ﬁxed conformation ~xi, and the
initial ~x0 is drawn from the U0 distribution. For simplic-
ity we have assumed that only a single dynamic step is
performed at each ﬁxed λi, from ~xi−1 to ~xi, but multiple
steps may be implemented if desired. A “forward” work
value is thus given by

Wf (Zn) =

n−1

i=0 h
X

Uλi+1(~xi) − Uλi (~xi)
i

.

By generating multiple paths (and thus work values)
it is possible to estimate ∆F via Jarzynski’s equality [13]

∆F = −kBT ln

e−βWf

0 ,
(cid:11)

(cid:10)

where the h...i0 represents an average over forward work
values Wf generated by starting the system at U0 and
ending at U1. A similar expression can be written for
the situation when work values are generated by switch-
ing from U1 to U0 (“reverse”) This approach is uni-
directional since only work values from either forward
or reverse data are used.

Perhaps the most remarkable aspect of Eq. (7) is that it
is valid for arbitrary switching speed. However, in prac-
tice, the ∆F estimates are very sensitive to the distribu-
tion of work values, which in turn is largely dependent on
the switching speed. If the distribution of work values is
non-Gaussian and the width is large (σW ≫ kBT ), then
the ∆F estimate can be heavily biased [14, 15, 16, 26].
It has been suggested in other eﬃciency studies [16, 20],
and veriﬁed in this report, that the optimal eﬃciency for
uni-directional Jarzynski averaging is when the switching
speed is slow enough that σW ∼ kBT .

D. Bennett averaging of work values

Due to the bias introduced in using uni-directional
Jarzynski averaging, it is useful to consider a method
where both forward and reverse data are utilized. It has
been shown that the most eﬃcient use of bi-directional
data is via Bennett’s method [10, 20, 21, 27]

1 + eβ

η+Wf −∆F

1 + eβ

−η+Wr+∆F

−1

=

Nf (cid:20)
X

(cid:0)

(cid:1)(cid:21)

Nr (cid:20)
X

(cid:0)

−1

,(8)

(cid:1)(cid:21)

3

where η = kBT ln (Nf /Nr) allows for diﬀering number of
forward (Nf ) and reverse (Nr) work values. Equation (8)
must be solved iteratively since ∆F appears in the sum
on both sides of the equation.

It is worth mentioning that is is possible to use Ben-
nett’s method with equilibrium simulation rather than
non-equilibrium work values [11]. The approach is to
perform independent equilibrium simulations at each λ
value (like TI), then use Bennett averaging to determine
the free energy diﬀerence between neighboring λ values—
these diﬀerences are then summed to obtain the total free
energy diﬀerence. Although promising, this method is
not included in our analysis.

must be reversed and then ordinary Langevin dynamics
are used to propagate the system. Once the trial path
is complete, all the velocities for the backward segment
are reversed. Since a stochastic algorithm is employed in
the simulation, it is not necessary to perturb the conﬁg-
urational coordinates at the shoot point to obtain a trial
path.

The above recipe for generating trial paths leads to the
following statistical weights for the existing Q(Zn) and
trial Q(Z′

n) paths

Q(Zn) = e−βU0(~x0)

p(~xi → ~xi+1),

E. Single-ensemble path sampling

Q(Z′

n) = e−βU0(~x

′
0)

p(~x′

i → ~x′

i+1),

(12)

n−1

i=0
Y
n−1

i=0
Y

Single-ensemble path sampling (SEPS) is a non-
equilibrium approach that seeks to generate “important”
paths more frequently [18]. The method uses importance
sampling to generate paths (and thus work values) ac-
cording to a distribution

D(Zn) = Q(Zn) e− 1

2 βW (Zn),

(9)

where Q(Zn) is proportional to the probability of occur-
rence of an ordinary Jarzynski path; Eq. (5). With this
choice of D the free energy is estimated via [18]

∆F = −kBT ln

D

e− 1

2 βWf

D

e+ 1

2 βWf

,

(10)

(cid:20)X

(cid:30)X
D is a reminder that the work values used in
where the
the sum must be generated according to the distribution
in Eq. (9). Since forward work values, Wf are utilized,
the paths must start in U0(~x) and end in U1(~x). A similar
expression can be written for reverse work values Wr.

P

(cid:21)

To generate work values according to the distribution
D, path sampling must be used [28, 29, 30, 31, 32]. In
path sampling, entire paths are generated and then ac-
cepted or rejected according to a suitable Monte Carlo
criteria. In general, the probability of accepting a trial
path with n λ-steps (Z′
n with work value W ′) that was
generated from an existing path (Zn with work value W )
is given by [18, 31, 33, 34]

Zn→Z′
n
acc

P

= min

1,

Q(Z′
n) P
Q(Zn) P

n→Zn

Z′
gen
Zn→Z′
n
gen

e− 1
e− 1

′

2 βW

2 βW #

"

,

(11)

Zn→Z′
n
gen

n→Zn

Z′
gen

are, respectively, the prob-
where P
abilities of generating a trial path from an existing path
and vice versa.

and P

For this study, we generate trial paths (compare to
[35, 36]) by randomly choosing a “shoot” point λs along
an existing path. Then, Langevin dynamics is used to
move the system from λs → 0 (backward segment), fol-
lowed by λs → 1 (forward segment). Before running
the backward segment, the velocities at the shoot point

where p(~xi → ~xi+1) is the the transition probability for
taking a dynamic step from conﬁguration ~xi to ~xi+1. We
have assumed for simplicity that only one dynamic step
is taken at each value of λ, however, the approach al-
lows for multiple steps. The corresponding generating
probabilities for the existing and trial paths are given by

pchoose pperturb

p(~x′

i → ~x′

i+1)

¯p(~x′

i+1 → ~x′

i),

n−1

i=s
Y

n−1

i=s
Y

Zn→Z′
n
gen

P

=

n→Zn

Z′
gen

P

=

s−1

i=0
Y

s−1

i=0
Y

choose p′
p′

perturb

p(~xi → ~xi+1)

¯p(~xi+1 → ~xi),(13)

where ¯p(~xi+1 → ~xi) is the transition probability of tak-
ing a backward step from ~xi+1 to ~xi. The “bar” notation
is a reminder that the velocities are reversed for these
segments. The probability of choosing a particular shoot
point λs is denoted by pchoose, and the probability of
a particular perturbation to the conﬁgurational coordi-
nates at the shoot point is given by pperturb.

Since we have chosen not to perturb the conﬁgura-
tional coordinates at the shoot point, and any value of λ
along the path is equally likely to be chosen as the shoot
point, then pperturb = p′
choose. In
addition, since the transition probabilities preserve the
canonical distribution then [33]

perturb and pchoose = p′

p(~xi → ~xi+1) e−β

Uλi+1 (~xi)−Uλi+1 (~xi+1)

(14)

¯p(~xi+1 → ~xi) =

.

(cid:1)

(cid:0)

Inserting Eqs. (12), (13) and (14) into Eq. (11) gives the
acceptance criterion for trial paths

Zn→Z′
n
acc

P

= min

δW −δW

′

+ 1

2 (W

′

−W )

1, e−β
"

(cid:0)

(15)

,
(cid:1)#

where δW is deﬁned as the work accumulated up to the
shoot point for the existing path

δW =

s−1

i=0h
X

Uλi+1(~xi) − Uλi (~xi)
i

.

(16)

and δW ′ is the equivalent quantity for the trial path.

F. Bennett averaging of path-sampled work values

The use of bi-directional data is worth considering for
the SEPS method, just as it was for Jarzynski averag-
ing. Generalizing Bennett’s method to include the work
values sampled from D gives

D

e+ 1

2 βWf

D

e+ 1

2 βWf

1 + eβ

η+Wf −∆F

(cid:20)X
Nr

Nf
X

D

2 βWr

e+ 1
(cid:0)
−η+Wr+∆F

(cid:1)

1 + eβ

Nr
X

(cid:0)

(cid:20)X
Nr

(cid:1)

−1

(cid:21)

=

−1

(cid:21)

D

e+ 1

2 βWr

.

(17)

III. SIMULATION DETAILS

To test the eﬃciency and precision of each method
detailed above we use two relative solvation free energy
calculations. One case involves a large change in the van
der Waals radius of a neutral particle in explicit solvent,
and the other case is a large change in the charge of the
particle while keeping the size of the particle ﬁxed.

The system used in this study consists of a single
Lennard-Jones particle in a 24.93 ˚A box of ﬁve-hundred
TIP3P water molecules. For all simulations, the molecu-
lar simulation package TINKER 4.2 was used [37]. The
temperature of the system was maintained at 300.0 K
using Langevin dynamics with a friction coeﬃcient of 5.0
ps−1. RATTLE was used to constrain all hydrogens to
their ideal lengths [38] allowing a 2.0 fs time step. A
cutoﬀ of 12.465 ˚A was chosen for electrostatic and van-
der-Waals interactions with a smoothing function imple-
mented from 10.465 to 12.465 ˚A. It is expected that the
use of cutoﬀs will introduce errors into the ∆F calcu-
lation, however, in this report we are only interested in
comparing ∆F methodologies—we do not compare our
results to experimental data.

For the ﬁrst test case, a neutral Lennard-Jones par-
ticle was “grown” from 2.126452 ˚A to 6.715999 ˚A. The
sizes were chosen to be that of lithium and cesium from
the OPLS-AA forceﬁeld [39]. In the second test case, the
Lennard-Jones particle remains at a ﬁxed size of 2.126452
˚A, but the charge is changed from -e/2 to +e/2 produc-
ing a very large free energy change. For each test case,
and each ∆F method, the system was initially equili-
brated for one-hundred ps. The initial equilibration is
not included in the total computational time listed in

4

the results, however, since every method was given iden-
tical initial equilibration times, the eﬃciency analysis is
fair.

The λ-scaling (i.e., the form of the hybrid potential Uλ)
used for all ∆F methods in this study is implemented
within the TINKER package [37] by introducing hybrid
parameter values. For example, if a particle charge is
varied from q0 to q1, the hybrid potential is simply the
regular potential energy calculated using a hybrid charge
of

qλ = λq1 + (1 − λ)q0.

(18)

Similarly, if a particle has a change in the van der Waals
parameters r, ǫ the hybrid parameters are given by

rλ = λr1 + (1 − λ)r0,
ǫλ = λǫ1 + (1 − λ)ǫ0.

(19)

The free energy slope as a function of λ for both the
growing and charging test cases are shown in Fig. 1 and
4. The smoothness of both plots suggests that a more
sophisticated λ-scaling is not necessary for this study.
If, for example, we had chosen to grow a particle from
nothing, then it is likely that a diﬀerent scaling would be
needed (such as in Refs. [11, 24, 40, 41]).

A. Thermodynamic integration calculations

the twenty-one,

For thermodynamic integration (TI), equilibrium sim-
ulations were performed at each value of λ.
An
equal amount of simulation time was devoted to each
of
equally-spaced values of λ =
0, 0.05, 0.1, ..., 0.9, 0.95, 1. Averages of the slope dF/dλ =
hdU/dλiλ, shown in Figs. 1 and 4, are collected for each
value of λ. The ﬁrst 25% of the slope data is thrown away
for equilibration. Finally, the data is used to estimate the
integral in Eq. (2) using the trapezoidal rule. Note that
higher order integration schemes were also used, but did
not change the results, suggesting that the curves in Figs.
1 and 4 are smooth enough that high order integration
schemes are not needed for this report.

B. Adaptive integration calculations

Adaptive integration (AIM) results were obtained
by collecting the slope of the free energy dF/dλ =
hdU/dλiλ, by starting the simulation from an equili-
brated conﬁguration at λ = 0 and performing one dy-
namic step.
Immediately following the single dynamic
step, a Monte Carlo move in λ is attempted, which is ac-
cepted with probability given by Eq. (3). The pattern of
one dynamic step followed by one Monte Carlo trial move
is repeated until a total of 106 dynamic steps (and thus
106 Monte Carlo attempts) have been performed. The
same λ values used in TI are also used for AIM, thus

5

TI
AIM

λ = 0, 0.05, 0.1, ..., 0.9, 0.95, 1 are the only allowed val-
ues. For this report Monte Carlo moves were attempted
between successive values of λ only, i.e., a move from
λ=0.35 to 0.4 may be attempted but not to 0.45. Also,
all δ ˆF (λi) values of Eq. (4) were initially set to zero. The
estimate of the free energy is obtained by numerically ap-
proximating the integral in Eq. (2) using the trapezoidal
rule. As with TI, higher order integration schemes are
not needed here.

)
l
o
m

/
l
a
c
k
(
λ
d
/

 

F
d

9

8

7

6

5

0

C. Jarzynski estimate calculations

0.2

0.4

0.6

Switching parameter, λ

0.8

1

Estimates of the free energy using the non-equilibrium
work values was done using Eq. (7) for Jarzynski averag-
ing, and Eq. (8) for Bennett averaging. “Forward” non-
equilibrium paths were generated by starting the simu-
lation from an equilibrated conﬁguration at λ = 0, then
incrementing the value of λ, followed by another dynamic
step, and so on until λ = 1. Thus, only one dynamic
step is performed at each value of λ. The work value
associated with the path is then computed using Eq. (6).
Between each path, the system was simulated for one-
hundred dynamic steps at λ = 0, starting with the last
λ = 0 conﬁguration—thus the λ = 0 equilibrium ensem-
ble broadens with every work value calculation.

Similarly, “reverse” non-equilibrium paths were gener-
ated by starting each simulation from conﬁgurations in
the U1 equilibrium ensemble and changing from λ = 1 to
λ = 0.

FIG. 1: The slope of the free energy dF /dλ as a function
of λ for changing the Lennard-Jones size of a neutral particle
in a box of explicit water. Results for both thermodynamic
integration (TI) and adaptive integration (AIM) methods are
shown for 106 dynamic steps. The data show the averages
(data points) and standard deviations (error bars) from eight
independent simulations for each method. The ﬁgure demon-
strates that AIM has the ability to “sense” when more sam-
pling is needed at a particular λ value, thus producing a much
smoother and more precise proﬁle compared to TI. In addi-
tion, the smoothness of the proﬁle suggests that the switching
function Uλ of Eq. (19) used in this report is adequate.

then chosen to be where the average free energy estimate
no longer depends on the number of discarded paths.

D. Single-ensemble path sampling calculations

IV. RESULTS AND DISCUSSION

To use the single-ensemble path sampling (SEPS)
method, one must ﬁrst generate an initial path using
standard Jarzynski formalism. The only diﬀerence be-
tween the paths described above and the initial path for
SEPS is that, due to the computer memory needed to
store a path, the number of λ-steps was limited to ﬁve-
hundred for this study.
In other words, if the desired
path should contain around two-thousand dynamic steps,
the simulation would perform four dynamic steps at each
λ value giving a total simulation time of 1996 dynamic
steps for each path (note that simulation at λ = 1 is not
performed).

Once an initial path is generated, a new path is cre-
ated by perturbing the old path as described in Sec. II E.
Then, the new path is accepted with probability given
Importantly, if the new path is rejected,
by Eq. (15).
then the old path is counted again in the path ensemble.
Also, as with any Monte Carlo approach, an initial equi-
libration phase is needed. For this report, the necessary
amount of equilibration was determined by studying the
dependence of the average free energy estimate, after 106
dynamic steps, from eight independent trials, as a func-
tion of the number of paths that were discarded for equi-
libration. The optimal number of discarded paths was

Using the simulation details described above, two rel-
ative solvation free energy calculations were carried out
in a box of ﬁve-hundred TIP3P water molecules. Each
of the free energy methods described above were used to
estimate ∆F . Speciﬁcally, we compare: (i) adaptive inte-
gration (AIM) using Eqs. (2) and (3); (ii) thermodynamic
integration (TI) using Eq. (2); (iii) single-ensemble path
sampling with Jarzynski averaging (SEPS) using Eq.
(10); (iv) single-ensemble path sampling with Bennett av-
eraging (Bennett-SEPS) using Eq. (17); (v) Jarzynski av-
eraging of work values (Jarzynski) using Eq. (7); and (vi)
Bennett averaging of work values (Bennett-Jarzynski) us-
ing Eq. (8).

A. Growing a Lennard-Jones particle

Figure 1 shows the slope of the free energy (dF/dλ =
hdU/dλiλ) as a function of λ for both TI and AIM after
106 Langevin dynamic steps. The ﬁgure demonstrates a
potential advantage of AIM over TI—namely, due to the
Monte Carlo sampling of the λ-proﬁle, AIM can “sense”
when more sampling is needed for a particular value of
λ, producing a smoother curve compared to TI.

AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

2E5

4E5

6E5

8E5

1E6

Number of dynamic steps

(a)

(b)

8.5

7.5

9

8

7

)
l
o
m

/
l
a
c
k
(
 
e
t
a
m

i
t
s
e
 
F
∆

6.5
0

1

0.8

0.6

0.2

0
0

)
l
o
m

/
l
a
c
k
(

 

F
∆

0.4

σ

2E5

4E5

6E5

8E5

1E6

Number of dynamic steps

(a) Free energy diﬀerence estimates obtained for
FIG. 2:
changing the Lennard-Jones size of a neutral particle in a box
of explicit water. Results are shown for various methods de-
scribed in the text as a function of the number of dynamics
steps used in the simulation. For single-ensemble path sam-
pling (SEPS) and Jarzynski methods, only the most eﬃcient
results are shown. (b) The standard deviation from eight in-
dependent simulations as a function of the number of dynamic
steps. The ﬁgures show that in the limit of long simulation
times (106 dynamic steps) there is no really clear advantage
to choosing one simulation approach over the other. However,
it should be noted that adaptive integration and Bennett av-
eraging of SEPS work values provide the lowest uncertainties.

Within 1.0 kcal/mol Within 0.5 kcal/mol

Method
AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

12,000
4,000
240,000
280,000
20,000
20,000

6

43,000
42,000
400,000
280,000
250,000
60,000

TABLE I: Number of dynamic steps necessary to be within a
speciﬁed tolerance of ∆Flong sim = 7.2 kcal/mol (average ∆F
estimate at 106 dynamic steps for all methods) for growing a
Lennard-Jones particle in explicit solvent. The ﬁrst column is
the method used to obtain the estimate. The second column
is the number of dynamic steps needed to estimate ∆F within
1.0 kcal/mol of ∆Flong sim with an uncertainty less than 1.0
kcal/mol. The third column is the number of dynamic steps
needed to obtain an estimate within 0.5 kcal/mol with an
uncertainty less than 0.5 kcal/mol.

ever, Fig. 2b does suggest that, given one-million dy-
namic steps, AIM and Bennett-SEPS provide the most
precise free energy estimates.

Table I shows the number of dynamic steps needed by
each method to obtain a free energy estimate within a
speciﬁc tolerance of ∆Flong sim (average of all estimates
at 106 dynamic steps). Note that the number of dy-
namic steps needed for SEPS methods are large due to
the fact that paths must be discarded for equilibration of
the path ensemble. From the data in the table, TI, AIM
and Bennett-Jarzynski appear to be the best methods for
obtaining rapid ∆F estimates for growing a particle in
solvent.

Thus we conclude that, for growing a Lennard-Jones
particle in explicit solvent, the preferred method depends
upon the type of estimate one wishes to generate. If a
very precise high-quality estimate is desired, then AIM
and Bennett-SEPS are good choices.
If a very rapid
estimate of ∆F is desired, then AIM, TI, or Bennett-
Jarzynski methodologies work best.

Figure 2 shows ∆F estimates for six diﬀerent ap-
proaches using in this report. Note that for all non-
equilibrium approaches, only the most eﬃcient data are
shown. For SEPS and Bennett-SEPS all paths were com-
posed of ﬁve-hundred λ-steps (restricted to ﬁve-hundred
due to computer memory) with forty dynamic steps at
each value of λ. For Jarzynski and Bennett-Jarzynski
the paths were composed of ten-thousand λ-steps with
one dynamic step at each value of λ. For all of these
data, the standard deviation of the work values σW =
0.8 kcal/mol ≈ 1.4 kBT , in agreement with previous
studies [16, 20]. At least ﬁve diﬀerent path lengths were
attempted for each non-equilibrium method to determine
the most eﬃcient.

At a glance, Fig. 2 does not suggest a clear advan-
tage to using a particular method over the others. How-

1. Fast-growth uni-directional data

In this

section we consider non-equilibrium uni-
directional fast-growth data, i.e., generated by “switch-
ing” the system from U0 to U1 rapidly. These data are
worth considering since a lot of optimization is poten-
tially needed for both SEPS and Jarzynski methods to
work eﬃciently; see Fig. 2. Speciﬁcally, if attempting a
free energy computation on a new system, there is no way
to know in advance the optimal path length (number of
λ-steps).
Importantly, there is an advantage to gener-
ating uni-directional data since only the U0 equilibrium
ensemble is needed to estimate ∆F .

Here, we consider using SEPS and Jarzynski methods
with short paths. For SEPS, ﬁve-hundred λ-steps with
four dynamic steps at each value of λ was used producing

(a)

Jarzynski

∆Flong sim

SEPS

4E5

2E5

6E5

8E5

1E6

Number of dynamic steps

(b)

∆Flong sim

Jarzynski

SEPS

10

)
l
o
m

/
l
a
c
k
(
 
e
t
a
m

i
t
s
e
 
F
∆

9

8

7

6
0

0.2

y
t
i
l
i
b
a
b
o
r
P

0.15

0.1

0.05

0
0

5

10

15

20

25

Work value (kcal/mol)

(a) “Fast-growth” uni-directional free energy diﬀer-
FIG. 3:
ence estimates obtained for changing the Lennard-Jones size
of a neutral particle in a box of explicit water. Results are
shown for both single-ensemble path sampling (SEPS) using
Eq. (10) and for the Jarzynski relation of Eq. (7) as a func-
tion of the number of dynamics steps used in the simulation.
For both methods, fast-growth work values were generated
by simulating roughly two-thousand dynamic steps per path,
which is ten times shorter than optimal. The solid horizontal
line represents the best estimate of the free energy diﬀerence
∆Flong sim based on averaging all results shown in Fig. 2a at
106 dynamic steps. The averages (data points) and standard
deviations (errorbars) are from eight independent simulations.
(b) Histograms of the work values used to generate the free
energy estimates for both the SEPS and Jarzynski methods.
The plots demonstrate the potential usefulness of using path
sampling over regular Jarzynski averaging. Speciﬁcally, if the
work values are fast-growth and uni-directional, then SEPS
is able to bias the work values in such a way to improve the
free energy estimate. Note that for all the SEPS data shown,
the ﬁrst ﬁfty work values are thrown away for equilibration
as, described in Sec. III D.

a distribution of work values with σW = 2.1 kcal/mol.
For Jarzynski, two-thousand λ-steps with one dynamic
step at each value of λ was used producing a distribution
of work values with σW = 2.9 kcal/mol. Note that these
paths are roughly ten times shorter than optimal and
that σW is 3-4 times larger than optimal for Jarzynski
paths.

Figure 3 gives a comparison between SEPS and Jarzyn-

7

ski methods for fast-growth uni-directional paths. The
upper ﬁgure (a) shows the average free energy estimates
and standard deviations for both the SEPS and Jarzyn-
ski methods. The lower ﬁgure (b) gives the histogram of
the work values for each method. Both ﬁgures also show
the “target” value ∆Flong sim. The ﬁgures clearly demon-
strate that, for fast-growth data, SEPS has the ability to
“bias” the work values such that the ∆F value is near
the center of the work value distribution—rather than in
the tail of the distribution as with the Jarzynski method.
Thus, while the average Jarzynski estimate is still inaccu-
rate after 106 dynamic steps, the SEPS method correctly
predicts ∆F .

We suggest that the the SEPS method may ﬁnd the
greatest use for the ability to bias fast-growth work values
to obtain the correct value of ∆F , as shown here.

B. Charging a Lennard-Jones particle

Figure 4 shows the slope of the free energy (dF/dλ =
hdU/dλiλ) as a function of λ for both TI (green) and
AIM (black) after 106 Langevin dynamic steps. The data
shown in the plot are the mean (data points) and stan-
dard deviation (errorbars) for eight independent trials.
While the errorbars are too small to resolve on the plot
shown, the average uncertainty in the the slope for AIM
is 0.3 kcal/mol and for TI is 0.7 kcal/mol, suggesting that
AIM has the ability to produce more precise slope data
compared to TI.

Figure 5 shows ∆F estimates for six diﬀerent ap-
proaches. The upper ﬁgure (a) shows the average ∆F
estimate obtained by eight independent simulations for
each method and the lower plot (b) shows the standard
deviation of the eight trials. For all non-equilibrium
approaches in the ﬁgure, only the most eﬃcient data
are shown. For SEPS and Bennett-SEPS the paths
were composed of ﬁve-hundred λ-steps (restricted to
ﬁve-hundred due to computer memory) with eighty dy-
namic steps at each value of λ. For Jarzynski the paths
were composed of forty-thousand λ-steps with one dy-
namic step at each value of λ, and for Bennett-Jarzynski,
twenty-thousand λ-steps with one dynamic step at each
value of λ were used. For all of these data, the stan-
dard deviation of the work values σW = 0.8 kcal/mol ≈
1.4 kBT , in agreement with previous studies [16, 20], and
with the growing data in this study. At least four diﬀer-
ent path lengths were attempted for each non-equilibrium
method to determine the most eﬃcient.

Interestingly, TI did not converge to the same ∆F esti-
mate as the other methods in Fig. 5a, possibly suggesting
insuﬃcient sampling at each λ value. However, all esti-
mates are within one standard deviation of each other.

Given one-million dynamic steps, AIM and Bennett-
Jarzynski provide the highest precision estimates. For
fast estimation of free energy diﬀerences, Table II shows
the number of dynamic steps needed by each method to
obtain a free energy estimate within a speciﬁc tolerance

0.2

0.4

0.6

Switching parameter, λ

0.8

1

2E5

4E5

6E5

8E5

1E6

Number of dynamic steps

TI
AIM

200

100

0

)
l
o
m

/
l
a
c
k
(
λ
d
/

 

F
d

-100

0

FIG. 4: The slope of the free energy dF /dλ as a function of λ
for a changing the charge of a Lennard-Jones particle in a box
of explicit water from -e/2 to +e/2. Results for both ther-
modynamic integration (TI) and adaptive integration (AIM)
methods are shown for 106 dynamic steps. The data show the
averages (data points) and standard deviations (error bars)
from eight independent simulations for each method. The er-
rorbars are too small to resolve on the plot shown, however, it
should be noted that the average uncertainty in the the slope
for AIM is 0.3 kcal/mol and for TI is 0.7 kcal/mol, suggesting
that AIM has the ability to produce a more precise proﬁle
compared to TI. The smoothness of the proﬁle also suggests
that the switching function Uλ of Eq. (18) used in this report
is adequate.

Within 1.0 kcal/mol Within 0.5 kcal/mol

Method
AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

35,000
25,000
280,000
400,000
40,000
40,000

145,000
145,000
400,000
500,000
400,000
80,000

TABLE II: Number of dynamic steps necessary to be within
a speciﬁed tolerance of ∆Flong sim = 18.1 kcal/mol (average
∆F estimate at 106 dynamic steps for all methods except
TI) for charging a Lennard-Jones particle in explicit solvent.
The ﬁrst column is the method used to obtain the estimate.
The second column is the number of dynamic steps needed
to estimate ∆F within 1.0 kcal/mol of ∆Flong sim with an
uncertainty less than 1.0 kcal/mol. The third column is the
number of dynamic steps needed to obtain an estimate within
0.5 kcal/mol with an uncertainty less than 0.5 kcal/mol.

of ∆Flong sim (average of all estimates at 106 dynamic
steps). Note that the number of dynamic steps needed for
SEPS methods are large due to the fact that paths must
be discarded for equilibration of the path ensemble. From
the data in the table, TI, AIM and Bennett-Jarzynski are
the best methods for obtaining rapid ∆F estimates for
charging a particle in solvent.

We conclude that, when charging a Lennard-Jones par-
ticle in explicit solvent, the preferred methodology de-

8

AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

AIM
TI
SEPS
Bennett-SEPS
Jarzynski
Bennett-Jarzynski

19

)
l
o
m

/
l
a
c
k
(
 
e
t
a
m

i
t
s
e
 
F
∆

18

17

16

1

0.8

0.6

)
l
o
m

/
l
a
c
k
(

 

F
∆

0.4

σ

0.2

0
0

(a)

(b)

2E5

4E5

6E5

8E5

1E6

Number of dynamic steps

(a) Free energy diﬀerence estimates obtained for
FIG. 5:
changing the charge of a Lennard-Jones particle from -e/2 to
+e/2 in a box of explicit water. Results are the averages of
eight independent simulations for various methods described
in the text as a function of the number of dynamics steps used
in the simulation. For single-ensemble path sampling (SEPS)
and Jarzynski methods, only the most eﬃcient results are
shown. (b) The standard deviation from eight independent
simulations as a function of the number of dynamic steps. The
ﬁgures show that in the limit of long simulation times (106
dynamic steps) adaptive integration and Bennett averaging
of Jarzynski work values provides the lowest uncertainty esti-
mate. Another interesting feature is that the thermodynamic
integration (TI) results do not agree with results from the
other methods, suggesting that perhaps 106 dynamic steps
did not provide suﬃcient sampling time for TI to converge
for the system used here. It should be noted, however, that
all estimates, including TI, lie within one standard deviation
of one another.

FIG. 6:

pends upon the type of estimate one wishes to gener-
If a very precise estimate is desired, then AIM
ate.
and Bennett-Jarzynski are good choices. If a very rapid
estimate of ∆F is desired, then AIM, TI, or Bennett-
Jarzynski methodology work well.

V. CONCLUSIONS

We have carefully studied several free energy diﬀerence
(∆F ) methods, comparing eﬃciency and precision. The
test cases used for the comparison are relative solvation
energy calculations involving either a large change in the
Lennard-Jones size or in the charge of a particle in ex-
plicit solvent. Speciﬁcally, we compared thermodynamic
integration [9], adaptive integration [17], Jarzynski [13]
and Bennett [10] averaging of non-equilibrium work val-
ues, and path sampling of non-equilibrium work values
using both a Jarzynski uni-directional formalism, and a
Bennett-like bi-directional formalism [18].

The single-ensemble path sampling method (SEPS) is
shown to be good at providing accurate free energy es-
timates from “fast-growth” non-equilibrium work values.
Speciﬁcally, in cases where the standard deviation of the
work values is much greater than kBT (σW ≫ kBT ),
the SEPS method can eﬀectively bias the work values to
allow for more accurate ∆F estimation than is possible
using ordinary Jarzynski averaging.

We also ﬁnd,

in agreement with previous studies
[16, 20], that the greatest eﬃciency for uni-directional
Jarzynski averaging is when σW ∼ kBT . For the ﬁrst
time, we show that SEPS is also most eﬃcient when
σW ∼ kBT

The adaptive integration method (AIM) [17] is found
to provide very high quality, precise estimates, given long

9

simulation times (106 total dynamic steps in this study),
and also provides a means for rapid estimation of ∆F . In
addition, AIM has the ability to provide very smooth free
energy proﬁles, compared to thermodynamic integration;
see Figs. 1 and 4.

Thermodynamic integration (TI) is found to perform
well for the test cases presented in this study. Rapid
estimation of ∆F are possible, as well as good long-term
precision and accuracy.

It should be noted that the results of this study
are valid only for the types of ∆F calculations we
considered—namely, growing and charging a Lennard-
Jones particle in explicit solvent. When large conforma-
tional changes are important, such as for binding aﬃni-
ties, the results will likely be dramatically diﬀerent.

Acknowledgments

The authors would like to thank Ronald White, Sri-
nath Cheluvarajah, and Hagai Meirovitch for helpful dis-
cussion and useful insight. Funding for this research was
provided by the Dept. of Environmental and Occupa-
tional Health at the University of Pittsburgh, the Dept.
of Computational Biology at the University of Pitts-
burgh, and the National Institutes of Health (Grants T32
ES007318 and F32 GM073517).

[1] W. L. Jorgensen, Science 303, 1813 (2004).
[2] C. Sotriﬀer, G. Klebe, M. Stahl, and H.-J. Bohm,
Burger’s Medicinal Chemistry and Drug Discovery, vol. 1
(Wiley, New York, 2003), Sixth ed.

[3] J. W. Pitera and W. F. van Gunsteren, J. Phys. Chem.

[4] A. Grossﬁeld, P. Ren, and J. W. Ponder, J. Am. Chem.

B 105, 11264 (2001).

Soc. 125, 15671 (2003).

[16] G. Hummer, J. Chem. Phys. 114, 7330 (2001).
[17] M. Fasnacht, R. H. Swendsen, and J. M. Rosenberg,

Phys. Rev. E 69, 056704 (2004).

[18] F. M. Ytreberg and D. M. Zuckerman, J. Chem. Phys.

120, 10876 (2004).

[19] C. Jarzynski, Phys. Rev. E 56, 5018 (1997).
[20] G. E. Crooks, Phys. Rev. E 61, 2361 (2000).
[21] M. R. Shirts, E. Bair, G. Hooker, and V. S. Pande, Phys.

[5] S. B. Singh, Ajay, D. E. Wemmer, and P. A. Kollman,

Rev. Lett. 91, 140601 (2003).

Proc. Nat. Acad. Sci. (USA) 91, 7673 (1994).

[22] S. Boresch, F. Tettinger, M. Leitgeb, and M. Karplus, J.

[6] B. C. Oostenbrink, J. W. Pitera, M. M. van Lipzip,
J. H. N. Meerman, and W. F. van Gunsteren, J. Med.
Chem. 43, 4594 (2000).

[7] H. Fujitani, Y. Tanida, I. M., G. Jayachandran, C. D.
Snow, M. R. Shirts, E. J. Sorin, and V. S. Pande, J.
Chem. Phys. 123, 084108 (2005).

[8] R. W. Zwanzig, J. Chem. Phys. 22, 1420 (1954).
[9] T. P. Straatsma and J. A. McCammon, J. Chem. Phys.

[10] C. H. Bennett, J. Comput. Phys. 22, 245 (1976).
[11] M. R. Shirts and V. S. Pande, J. Chem. Phys. 122,

118, 2977 (2003).

[12] S. Kumar, J. M. Rosenberg, D. Bouzida, R. H. Swendsen,
and P. A. Kollman, J. Comput. Chem. 13, 1011 (1992).

[13] C. Jarzynski, Phys. Rev. Lett. 78, 2690 (1997).
[14] F. M. Ytreberg and D. M. Zuckerman, J. Comput. Chem.

[15] D. M. Zuckerman and T. B. Woolf, Phys. Rev. Lett. 89,

(2005).

95, 1175 (1991).

144107 (2005).

25, 1749 (2004).

180602 (2002).

Phys. Chem. B 107, 9535 (2003).

[23] T. Z. Mordasini and J. A. McCammon, J. Phys. Chem.

B 104, 360 (2000).

[24] M. R. Shirts, J. W. Pitera, W. C. Swope, and V. S.

Pande, J. Chem. Phys. 119, 5740 (2003).

[25] T. P. Lybrand, I. Ghosh, and J. A. McCammon, J. Am.

Chem. Soc. 107, 7793 (1985).

[26] J. Gore, J. Ritort, and C. Bustamante, Proc. Natl. Acad.

Sci. (USA) 100, 12564 (2003).

[27] N. Lu, J. K. Singh, and D. A. Kofke, J. Chem. Phys.

[28] L. R. Pratt, J. Phys. Chem. 85, 5045 (1986).
[29] P. G. Bolhuis, D. Chandler, C. Dellago, and P. L.
Geissler, Annu. Rev. Phys. Chem. 53, 291 (2002).

[30] G. Hummer, J. Chem. Phys. 120, 516 (2004).
[31] S. X. Sun, J. Chem. Phys. 118, 5769 (2003).
[32] G. Adjanor and M. Ath`enes, J. Chem. Phys. 123, 234104

[33] C. Dellago, P. G. Bolhuis, and D. Chandler, J. Chem.

Phys. 108, 9236 (1998).

[34] G. E. Crooks and D. Chandler, Phys. Rev. E 64, 026109

(2001).

[38] H. C. Andersen, J. Comput. Phys. 52, 24 (1983).
[39] W. L. Jorgensen, D. S. Maxwell, and J. Tirado-Rives, J.

Am. Chem. Soc. 117, 11225 (1996).

[35] C. Dellago, P. G. Bolhuis, and D. Chandler, J. Chem.

[40] X. Kong and C. L. Brooks, J. Chem. Phys. 105, 2414

Phys. 110, 6617 (1999).

(1996).

[36] C. Dellago, P. G. Bolhuis, F. S. Csajka, and D. Chandler,

[41] W. Yang, R. Bitetti-Putzer, and M. Karplus, J. Chem.

J. Chem. Phys. 108, 1964 (1998).

Phys. 120, 2618 (2004).

[37] J. W. Ponder and F. M. Richard, J. Comput. Chem. 8,

1016 (1987), http://dasher.wustl.edu/tinker.

10

