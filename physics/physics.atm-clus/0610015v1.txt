SLAC-PUB-12136

Matrix formalism of synchrobetatron coupling

Stanford Linear Accelerator Center, Menlo Park, CA 94025

Xiaobiao Huang∗

(Dated: September 26, 2006)

Abstract

In this paper we present a complete linear synchrobetatron coupling formalism by studying the

transfer matrix which describes linear horizontal and longitudinal motions. With the technique

established in the linear horizontal-vertical coupling study [D. Sagan and D. Rubin, Phys. Rev.

ST Accel. Beams 2, 074001 (1999)], we found a transformation to block diagonalize the transfer

matrix and decouple the betatron motion and the synchrotron motion. By separating the usual

dispersion term from the horizontal coordinate ﬁrst, we were able to obtain analytic expressions of

the transformation under reasonable approximations. We also obtained the perturbations to the

betatron tune and the Courant-Snyder functions. The closed orbit changes due to ﬁnite energy

gains at rf cavities and radiation energy losses were also studied by the 5

×
matrix with the ﬁfth column describing kicks in the 4-dimension phase space.

5 extended transfer

PACS numbers: 29.27.-a,29.27.Bd,29.20.Dh,29.20.Lq

6
0
0
2
 
t
c
O
 
2
 
 
]
s
u
l
c
-
m
t
a
.
s
c
i
s
y
h
p
[
 
 
1
v
5
1
0
0
1
6
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

∗xiahuang@slac.stanford.edu;

1

I.

INTRODUCTION

The synchrobetatron coupling (SBC) comes from dispersion at rf cavities and the path

length dependence on the amplitude of betatron motion. The dispersion at an rf cavity

makes the longitudinal kicks received from the cavity aﬀect the betatron motion. Since

the longitudinal kicks depend on the arrival time of the particles, the longitudinal motion

is coupled to the betatron motion. On the other hand, particles with diﬀerent betatron

amplitudes have diﬀerent path lengths which aﬀect the arrival time. So betatron motion is

also coupled to the longitudinal motion.

Traditionally many authors treated SBC with the Hamiltonian dynamics approach [3, 4],

which is a general and complete description and naturally covers eﬀects of nonlinearities. It

is very useful for the study of synchrobetatron resonances since in such cases one can focus

on only the resonant term of the synchrobetatron potential. However, the Hamiltonian

approach is cumbersome for the oﬀ-resonance cases which are most common for storage ring

operations. In the linear case, a parallel approach is the matrix formalism ﬁrst proposed in

Ref. [2] which described the construction of the 6

6 transfer matrices and the decomposition

×

of the coupled motion to the eigen-modes of the one-turn transfer matrix. Ref. [2] also

described an iterative procedure to include the nonlinear eﬀects.

Recently the study of low-alpha lattices stimulated Shoji’s work on the path length eﬀect

which yielded an important result of bunch lengthening due to betatron emittance and

dispersion [5]. On the other hand Ref. [6] studied the SBC-induced closed orbit change by

considering the dipole-like kicks in the horizontal betatron phase space due to the sudden

changes of energy at a nonzero-dispersion rf cavity. The authors derived the horizontal closed

orbit changes induced by the ﬁnite energy gains at the rf cavities and veriﬁed with both

simulations and experiments. The closed obit formula was ﬁrst given and experimentally

veriﬁed in Ref. [7, 8].

In this paper, we will study the linear synchrobetatron coupling under the transfer matrix

framework without considering diﬀusion and damping due to radiation. Since the vertical

motion is not essential to the SBC, we don’t consider it for simplicity reasons. We then

study the 4

4 horizontal-longitudinal transfer matrix in the same manner as the horizontal-

×

vertical coupling is studied [1]. Namely, we try to decouple the horizontal and longitudinal

motions by using a coordinate transformation to block diagonalize the transfer matrix and

2

obtain the normal modes, in this case, the pure betatron mode and the pure synchrotron

mode. We ﬁrst study the ﬁxed-energy case in which no rf cavity exists (or the rf gap voltage

is set to zero). The transformed coordinates include the usual betatron coordinates and

momentum deviation coordinate. But the longitudinal phase coordinate is modiﬁed by a
term involving Dx′β −
Shoji [5]. In cases with rf cavities, we ﬁrst apply the previous ﬁxed energy transformation

D′xβ which corresponds to the bunch lengthening eﬀect studied by

to separate the dispersion term. Since the synchrotron motion is usually slow, the coupling

(oﬀ-diagonal) blocks of the transfer matrix for the new coordinates are small. Therefore

we can perform the block diagonalization procedure proposed in Ref. [1] approximately yet

with high precision. The transformation matrix is expressed analytically with the usual

parameters such as the Courant-Snyder parameters, dispersion functions and rf voltage

slope. When the normal modes are obtained, we can calculate their contributions to the

beam width and bunch length. Perturbations to horizontal betatron motion due to SBC,

including changes to the betatron tune and Courant-Snyder functions are also obtained.

It is well known that SBC causes changes to the beam orbit [7, 9, 10].

In this study

we ﬁnd the closed orbit in the 4-dimension phase space in an analytical form through the

5

5 extended transfer matrix method [2], with the ﬁfth column containing the 4-dimension

×
kicks the beam receives from rf cavities and dipole magnets. Both ﬁnite energy gains at rf

cavities and radiation energy losses in bending dipoles are considered. The radiation energy

loss is random by nature. However, since usually hundreds of photons are emitted in one

revolution, much more than the number of dipole magnets in which emission happens, we

consider the radiation energy loss as a steady and uniform process. The radiation energy

losses contribute additional terms to the horizontal closed orbit change. The above results

are veriﬁed with the accelerator modeling code AT [11].

This paper is organized as follows. Section I is this introduction. Section II describes

the block diagonalization of the 4

4 transfer matrix in the ﬁxed energy case. Section III

×

presents the matrix formalism of the synchrobetatron coupling. Section IV is the calculation

of closed orbit changes induced by ﬁnite energy gains at rf cavities and radiation energy

losses. Section V shows simulation results and the comparison to the theory. Section VI

gives the conclusions.

3

II. BLOCK DIAGONALIZATION FOR A FIXED ENERGY RING

The 4-dimension coordinate vector is X = (xT , lT )T , where the horizontal coordinate vec-

tor is x = (x, x′)T and the longitudinal coordinate vector is l = (cτ, δ)T . The cτ coordinate
h
instead of the phase coordinate φ = φs −
Rcτ , where φs is the synchronous phase, h is the
harmonic number and R is the average ring radius, is used to avoid the appearance of scal-

ing factors h/R in the transfer matrix. Note a negative cτ indicates the particle is behind

the synchronous particle. The coordinates at the entrance and the exit of an accelerator

component are related through its transfer matrix T by Xe = TXi and the transfer matrix

can be divided into 2

2 blocks M, E, F and L such that

×

T =

.

M E
F L 






In general, the coupling blocks E, F of a single component are nonzero only for dipole

magnets. And for time-independent components (which include most common accelerator

components except rf components such as rf cavity, rf dipoles and rf quadrupoles), the

coupling blocks have two zero matrix elements such that

E = (0, e)

and F =

,

f T
0 






where e and f are 2-component column vectors and 0’s are zero vectors of suitable sizes. The

zero elements in matrix E and F are consequences of the fact that the horizontal coordinates

don’t depend on the arrival time of the particles and the horizontal coordinates don’t cause

energy changes in such components. The L blocks for rf cavities and other components are

and

Lother =

Lrf =

w =

1 0
w 1 

dV
=
cdτ




e
E

eV0 cos φs
E

h
R

,

−

,

1 η
0 1 






where V0 is the gap voltage and E is the beam energy. The η parameter is related to the

fractional phase slippage factor and is nonzero only for dipole magnets if we assume all

particles have the same velocity c, the speed of light.

The transfer matrix for an accelerator section is the matrix product of the transfer ma-

trices of the sequence of components which it consists of. For any sequence of components

4

(1)

(2)

(3)

(4)

not containing an rf cavity, condition Eq. (2) still holds. The symplecticity requirement of

the transfer matrices of such sections is equivalent to: M and L are symplectic and

The e vector and η parameter for a section from point 1 to point 2 can be written in integral

MJ2f = e,

J2 =

.

0 1
1 0 


−





forms

e12 =

s2

M(s2|

s)



s1

ds
ρ
ds
ρ
where s is the arc length along the reference orbit, s2|
bending radius and e1 is the ﬁrst element of e.

e1(s2|

η12 =


s)

−

Z

Z

s1

s2

,

0

,





s means “from s to s2” , ρ is the

The one-turn transfer matrix with an rf cavity in the ring can be derived in the following

way. Suppose the rf cavity is located at point 2 and we want to calculate the transfer matrix

at an arbitrary point 1. The transfer matrices between point 1, 2 and at the rf cavity are

T12 =

M12 E12



F12 L12



, T21 =

M21 E21



F21 L21



, Trf =

I 0



0 Lrf

,



(8)


where M12 and M21 are the horizontal transfer matrices between the points, I is the 2











2
×
2 identity matrix by their (1, 2) elements

identity matrix and L12 and L21 diﬀer from the 2

of η12 and η21, respectively. The one turn transfer matrix at point 1 is

T = T21TrfT12 =

×





M1 E1

F1 L1

,





which can be expressed as

T =





M21M12 + E21LrfF12 M21E12 + E21LrfL12

F21M12 + L21LrfF12 F21E12 + L21LrfL12

.





We ﬁrst consider the case when there is no rf cavity or the cavity is turned oﬀ. This

corresponds to w = 0 and Lrf = I. Consequently E1 and F1 satisfy conditions Eqs. (2,5).

We intend to introduce a transformation X = UXn to block diagonalize the new transfer

matrix Tn = U−

1TU. It can be shown that this is achieved by

U =

,

U−

1 =

(11)

I D1
D+
1

I 






−

5

I

D+
1

−

,

D1
I 






(5)

(6)

(7)

(9)

(10)

where

D1 = (I

M1)−

1E1

−

and D+

1 is its symplectic conjugate [1]. We may introduce a column vector d1 = (D1, D′1)T
so that D1 = (0, d1). Eq. (12) deﬁnes the dispersion functions D1 and D′1 at point 1. One
can also show that

from T2T12 = T12T1. The new transfer matrix is found to be

E12 = D2 −

M12D1

Tn =

, with L1,n =

M1 0
0 L1,n 






,

1 ¯η
0 1 






where L1,n is the new longitudinal transfer matrix and ¯η is a constant of the ring given by

which is related to the usual momentum compaction factor α0 by ¯η =

2πRα0. We have

shown that

where νx is the betatron tune, η1 is the (1, 2) element of L1 and the

-function along with

its associated phase parameter are deﬁned by

−

H

¯η =

−

I

Dds
ρ

,

¯η = η1 − H1 sin 2πνx,

1
β

H

=

[D2 + (αD + βD′)2],

χ = tan−

1

D
αD + βD′

,

¯η12 =

s2

Dds
ρ

.

−

s1

Z

where α, β are Courant-Snyder parameters. We may deﬁne the fractional phase slippage

factor on a section between point 1 and 2 by

(12)

(13)

(14)

(15)

(16)

(17a)

(17b)

(18)

(19)

It has been shown that

¯η12 = η12 −

H1H2 sin(ψ12 + χ1 −

χ2),

where ψ12 =

s2
s1 ds/β is the betatron phase advance from point 1 to point 2.

R

p

6

The new coordinates at any location after transformation are related to the original

coordinates by

x = Mxn + δnd1,

cτ = cτn + Dx′n −
δ = δn.

D′xn,

(20a)

(20b)

(20c)

(21)

(22)

(23)

(24)

We recognize xn = (xn, x′n)T are just the betatron coordinates. The momentum deviation
coordinate is not changed by the transformation. But the longitudinal phase coordinate is

diﬀerent by

and is now

where Jx is the horizontal betatron action variable and ψ is the phase variable [12].

Dx′n −

D′xn =

2JxH

cos(ψ

χ),

−

−

p

III. MATRIX FORMALISM OF SYNCHROBETATRON COUPLING

When the rf cavity is turned on, its longitudinal transfer matrix deviates from the identity

Inserting it to Eq. (10) we get the one-turn transfer matrix

Lrf = I + W, W = w

T = T0 + w ˜T, T0 =

.

0 0
1 0 






M0

1 E0
1
1 L0
1

F0

,









where the superscript 0 denotes quantities when the rf cavity is oﬀ and

˜T =

˜M1 ˜E1
˜F1 ˜L1





=

1
w 







E21WF12 E21WL12

L21WF12 L21WL12

.





We may apply the procedure in Ref.

[1] directly to block diagonalize matrix T in Eq.

(23). However, it is easier to relate the elements in the transformation matrix to the well-

known parameters such as dispersion functions and rf parameters in the following way. We

ﬁrst apply the transformation described in the previous section and then apply the procedure

of [1] to decouple the new transfer matrix. After the ﬁrst transformation, the oﬀ-diagonal

7

blocks of the transfer matrix are small because the main dispersion eﬀect is separated.

Hence in the second transformation we can apply some approximations to derive explicit

expressions for the transformation matrix and the ﬁnal transfer matrix.

After the ﬁrst transformation, the transfer matrix is

Tn = U−

1TU = T0

n + w ˜Tn,

where

T0

n = U−

1T0U =

and

˜Tn = U−

1 ˜TU =

M0

1 0
0 L0





1,n


Following Sagan-Rubin [1], we want to ﬁnd the transformation matrix







˜Mn ˜En
˜Fn ˜Ln 


.

to block diagonalize the matrix Tn. According to the Sagan-Rubin procedure, we deﬁne

V =

γI C
C+ γI 


−





H = w( ˜En + ˜F+
n )

and letting

H
4
Ln]2 ,
||
||
Tr [Mn −
where Mn and Ln are diagonal blocks of Tn, the γ parameter and C matrix are then

κ =

1
2 r
The elements of the H matrix have been calculated to be

1
1 + κ

H
γ√1 + κTr [Mn −

C =

γ =

1
2

s

−

+

,

.

Ln]

H11 =

H12 =

H21 =

2
−

χ2),

ψ21 −
β1H2 sin πνx cos(πνx −
p
2¯η21 sin πνx cos(πνx −
β1H2(¯η sin(ψ21 + χ2)
−
H2
ψ21 −
sin πνx[sin(πνx −
β1

α1 cos(πνx −

χ2)

−

−

p
2
−

s

ψ21 −

χ2)),

ψ21 −

χ2)],

H22 =

[¯η(α1 sin(ψ21 + χ2)

H2
β1

s
(α1 cos(πνx −

2¯η21 sin πνx

cos(ψ21 + χ2))

−
sin(πνx −

−

−
ψ21 −

χ2))].

ψ21 −

χ2)

8

(25)

(26)

(27)

(28)

(29)

(30)

(31a)

(31b)

(31c)

(31d)

It follows that

= w2 ¯η

H

||

||

H2 sin 2πνx.

Exact solution of the transformation matrix can be computed numerically with the above

equations. However, it is more illuminating to have an analytic solution, even with some

approximations. To this end we observe that w is usually a small quantity (e.g., w = 0.008

for SPEAR3) and κ is on the order of w2 so that γ√1 + κ

1 + 3κ/8 = 1 + O(w2). To ﬁrst

order of w we have

C =

H
2(cos 2πˆνx −

−

cos 2πνs)

≈

,

where we have used Tr[Mn] = 2 cos 2πˆνx and Tr[Ln] = 2 cos 2πνs by deﬁnition. The parame-
ter ˆνx is related to the unperturbed betatron tune νx by cos 2πˆνx = cos 2πνx + 1
H2 sin 2πνx
since it has been shown that Tr[ ˜Mn] =
H2 sin 2πνx. To guarantee the symplecticity of the

2 w

new transfer matrix, we must have

cos 2πνs)2 .
The transfer matrix for the decoupled coordinates may be written as

γ =

− ||

s

p

−

=

||

1

1

H2 sin 2πνx

w2¯η
4(cos 2πˆνx −

C

where Md and Ld are given by [1]

Td = V−

1TnV =

,

Md 0
0 Ld 






Md = γ2Mn −
Ld = γ2Ln + γ(FnC + C+En) + C+MnC.

γ(CFn + EnC+) + CLnC+,

For both of the above equations, the last three terms are on the order of w2. To second

order of w, we have

Md ≈
Ld ≈

M0

1 + w ˜Mn + w2M(2)
d ,
1,n + w ˜Ln + w2L(2)
L0
d .

Explicit expressions have been developed for ˜Mn and ˜Ln. The elements of ˜Mn are

H2 sin(ψ21 + χ2)(cos(ψ12 −
H2β1 sin(ψ21 + χ2) sin(ψ12 −

χ2) + α1 sin(ψ12 −
χ2),

χ2)),

˜Mn,11 =

˜Mn,12 =
˜Mn,21 = H2
(cos(ψ12 −
β1
H2 sin(ψ12 −

˜Mn,22 =

χ2) + α1 sin(ψ12 −
χ2)(cos(ψ21 + χ2)

α1 sin(ψ21 + χ2)).

χ2))(cos(ψ21 + χ2)

α1 sin(ψ21 + χ2)),(40c)

−

−

9

(32)

(33)

(34)

(35)

(36)

(37)

(38)

(39)

(40a)

(40b)

(40d)

The additional terms w ˜Mn amounts to changes to the Courant-Snyder parameters. For

example, the change to β1 to ﬁrst order of w is

∆β1 =

w

H2β1
2 sin 2πνx

(cos(2πνx −

2ψ21 −

2χ2)

cos 2πνx).

−

Also, knowing the traces Tr[ ˜M(2)

d ] =

Tr[˜L(2)

d ] =

−

H2 cot πνx/2, we ﬁnd the total betatron
¯η

−

tune change to second order of w

∆νx =

w
H2
4π

−

+

w2 ¯η
16π sin2 πνx

H2

.

From the expressions of H and ˜Mn, it is clear that when the rf cavity is located in a
H2 = 0, there is no dynamic consequence from the coupling

dispersion-free region and thus

between horizontal and longitudinal motions.

The matrix ˜Ln is given by

˜Ln =

¯η21 ¯η12 ¯η21



1

¯η12

.



The unperturbed longitudinal transfer matrix Ln = L0


1,n + w ˜Ln describes the plain longitu-
dinal motion. The corrections due to synchrobetatron coupling is on the next higher order



of w. The matrix Ln can be Courant-Snyder parametrized so that

cos Φs + αs sin Φs

βs sin Φs

γsΦs

−

,

cos Φs −

αs sin Φs 


Ln =




s and Φs =

−

with βsγs = 1 + α2

2πνs, where a negative sign is chosen to make βs always

positive. The unperturbed synchrotron tune is given by

(cid:17)
The unperturbed longitudinal Courant-Snyder functions are

νs =

1

sin−

1
2π

w ¯η(1 +

w ¯η)

.

1
4

(cid:16)r−

αs =

1
2

w(¯η21 −
sin 2πνs

¯η12)

,

−

βs =

(¯η + w ¯η21 ¯η12)
sin 2πνs

,

−

γs =

w
sin 2πνs

,

which are equivalent forms of those found in Ref. [13]. It is noted that γs is a positive constant

and βs is positive but slightly varies around the ring. Without coupling, the longitudinal

coordinates (cτn, δn) are related to these parameters, the longitudinal action variable Js and

(41)

(42)

(43)

(44)

(45)

(46)

10

phase variable ψs by

from which we obtain relations between the rms bunch length, rms momentum spread and

the longitudinal emittance ǫs

cτn =

2Jsβs cos ψs,

δn =

(αs cos ψs + sin ψs),

p
−s

2Js
βs

σ2
cτn = βsǫs,

σ2
δn = γsǫs.

(47)

(48)

(49)

Note that the bunch length varies with location because particles with diﬀerent momentum

deviation experience diﬀerent longitudinal phase slippage. The bunch is longest at the rf

cavity and can be shortened by a maximum of 2π2ν2

s part of the original length at half way

across the ring from the cavity. For fast ramping synchrotrons, it can be as large as 5% ,

assuming νs = 0.05. The synchrobetatron coupling should slightly change the synchrotron

tune and the longitudinal Courant-Snyder functions given above.

The decoupled coordinates Xd = (xT

d , lT

d )T are related to the original coordinates X by

X = UVXd =

γI

−
C+

D1C+ C + γD1
D+

1 C 

n )T are related to the normal modes by the transformation
matrix V. Since all four elements of the C matrix in V are nontrivial in general, the hori-

The betatron coordinates (xT

1 γI

γD+

n , lT









−

−

−

.

xd
ld 


(50)

zontal betatron coordinate xn depends on the longitudinal phase, as pointed out in Ref. [6].

This is a natural consequence of the synchrobetatron coupling.

In fact, the longitudinal

coordinates cτn, δn also depend on the horizontal betatron coordinates.

In terms of the

betatron coordinates Xn, the phase space volume occupied by the beam tilts across the

horizontal and longitudinal subspace. Particles ﬂow in and out between the two subspaces.

However, the total phase space volume is preserved. The reason for Ref. [6] to suggest that

the total phase space volume is not preserved is because it didn’t fully consider the coupling

eﬀects on the horizontal betatron motion.

With Eq. (50) we can decompose the 4-dimension motion to the normal modes for any

given initial condition. It also allows us to derive the eﬀects of synchrobetatron coupling on

the beam sizes σx and σcτ . Following the single mode analysis of Ref. [1], we ﬁrst consider

11

the case when only the betatron mode, or mode a, is excited.

x
x′ 






= (γI

D1C+)

−

xa

x′a

,









(C+ + γD+
1 )

=

−

(51)

xa

x′a

,









where (xa, x′a) are the betatron normal mode coordinates given by

xa =

2Jaβa cos ψa,

x′a =

(αa cos ψa + sin ψa).

(52)

cτ
δ 






2Ja
βa

−s

It follows that

p

x
√2Ja
cτ
√2Ja

=

−

= [γ

βa + D(C21

βa + C11

)] cos ψa +

sin ψa,

(53a)

αa
√βa

DC11
√βa

p
[γ(βaD′ + αaD) + (βaC22 + αaC12)]

p

1
√βa

cos ψa −

(C12 + γD)
√βa

sin ψa. (53b)

The bunch width and length can be derived from the above equations by integrating over
the bunch distribution. Here we consider only the oﬀ-resonance cases and assume cos νs ≈
so that C

H/4 sin2 πνx. We get

1

≈

σ2
x,a = βaǫa −

ǫa

wD√β1H2
sin πνx

sin(πνx −

ψ21 −

χ2) + ǫa

w2

H2
4 sin2 πνx

(D2

1
2

−

β1 ¯η cot πνx),(54)

where ǫa is the emittance of the horizontal betatron normal mode. We see that the term on

the order of w varies around the ring. The leading non-varying correction term is on the

order of w2. Since the O(w2) terms are very small, we will drop them in the following for

brevity. Similarly for the bunch length we obtain

σ2
cτ,a = ǫaH

a
1 −

ǫa

w√
H1H2
2 sin2 πνx

[¯η cos(ψ21 + χ2 −

χ1)

2¯η21 sin πνx sin(πνx −

ψ21 −

−

χ2 + χ1)],

where

tions.

H

a
1 is the

H

-function at point 1 evaluated with the perturbed Courant-Snyder func-

Similarly the same analysis can be applied to the synchrotron mode, or mode b, to obtain

its contributions to bunch width and length, which are given by

x,b = ǫbγbD2 + ǫbγb
σ2

w ¯ηD√β1H2
2 sin2 πνx

cos πνx sin(πνx −

ψ21 −

χ2),

σ2
cτ,b = ǫbβb −

ǫbγb

¯η√
H1H2
sin πνx

cos(πνx −

ψ21 −

χ2 + χ1).

12

(55)

(56)

(57)

Note that γb is an O(w) factor. The momentum spread is given by

σ2
δ,a = ǫa

w2

H2
4 sin2 πνx

,

σ2
δ,b = ǫbγb −

ǫbγb

w2 ¯η

H2 sin 2πνx
16 sin4 πνx

.

So to ﬁrst order of w we have σ2

δ = ǫbγb.
The contributions to σ2 from mode a and b simply add up [1], i.e.

σ2 = σ2

a + σ2
b ,

which applies to all coordinates. Eqs. (54-58) show that because of synchrobetatron cou-

pling, the longitudinal motion aﬀects the transverse beam size and and the transverse motion

aﬀects the longitudinal beam size. The leading correction term is usually a small term on

the order of w and varies with the horizontal betatron phase advance around the ring. It is

noted that we have recovered Shoji’s result in Ref. [5] by the ﬁrst term in Eq. (55) which

is independent of w and indicates that the bunch length varies from location to location

according to the local

-function. This is a consequence of the uneven distribution of the

path length eﬀect.

H

IV. CLOSED-ORBIT CHANGE DUE TO ENERGY GAIN AND LOSS

The ﬁnite energy gain at the rf cavity and the radiation energy loss around the ring are

kicks to the momentum deviation coordinate. These kicks are transfered downstream and

aﬀect all other coordinates. Therefore the closed orbit of the beam is changed. To study this

eﬀect in the matrix formalism, we extend the coordinate vector to Xe = (x, x′, cτ, δ, 1)T [2].

The corresponding transfer matrix is then 5

5. The ﬁfth element is included to describe

the kicks received by the particle, namely the equation

×

X2 = T12X1 + g12

will now be written as

Xe

2 = Te

12Xe
1,

Te

12 =

T12 g12

0





1 


where g12 is a 4-vector which represents the kick-induced shifts of phase space coordinates

across the accelerator section from 1 to 2. The closed orbit Xc is given by the ﬁxed point

13

(58)

(59)

(60)

(61)

Xe

c = (XT

c , 1)T of the extended one-turn transfer matrix Te

[2], i.e., TeXe

c = Xe

c, which

yields

Xc = (I

T)−

1g,

−

where the g vector contains the ﬁrst four elements of the ﬁfth column of Te and represents the

coordinate shifts after one turn when a particle starts from a point with initial coordinates

of all zeros. We will derive analytic forms for g and (I

T)−

1 below.

For an rf cavity, there is an energy kick

grf = (0, 0, 0, ǫ)T ,

−

ǫ =

∆E
E

,

where ǫ denotes the sudden change of momentum deviation at the rf cavity. For a dipole

magnet, the energy kick due to radiation energy loss will propagate to the other coordinates

and cause ﬁnite changes to them. For example, the pure sector dipole with bending radius

ρ and bending angle θL has

gdipole = (

ǫ
2π

)

−

sin θL)

ρ(θL −
cos θL
1
−
cos θL −
θL

−

1

2θ2
L)

ρ(1










,










where

ǫθL/2π is the momentum deviation change on this dipole magnet. Here we have

−

assumed ǫ is the same as the momentum deviation gained at the rf cavity. It is seen that

the changes of x, x′ and cτ are on the order of θ3

L, respectively. Hence when θL
is small, we may neglect these changes for a single dipole magnet. The g vectors are zeros

L and θ4

L, θ2

for other accelerator components which don’t cause energy gains or losses.

The one turn extended transfer matrix can be computed as usual. For an arbitrary point

1 , we have Te

1 = Te

21Te

rfTe

12, from which we obtain

g1 = (T21g12 + g21) + T21grf + T21(Trf −

I)g12.

Simple calculations show that

(62)

(63)

(64)

(65)

(66)

T21grf =

M21 E21



0



F21 L21





0

0

ǫ











14

d1 −

M21d2

η21
1 








.






= ǫ 












The T21g12 + g21 term has nothing to do with the rf cavity. So it does not depend on the

location of point 2. In fact it represents the changes of coordinates in one turn for a particle

with initial coordinate (0, 0, 0, 0)T at point 1 when the rf cavity is turned oﬀ. Since energy

losses occur in dipoles, we get a summation over all dipoles in the ring

T21g12 + g21 =

Mi1 Ei1

Fi1 Li1

Nd

i=1
X





0

0

0

ǫi

−























=

−

i ei1ǫi
i ηi1ǫi
i ǫi 


P

P












P



.






Noting that ei1 = d1 −
ǫ∆si/2πρ, the summations can be turned to integrals to obtain

Mi1di and, assuming all bending radius are equal so that ǫi =

T21g12 + g21 = (

d1 −

s)d(s) ds
2πρ

1 M(s1|
1 η(s1|
H
1

s) ds
2πρ



,

−

ǫ) 









1 starts from point 1, completes one rev-
olution and ends at point 1. We may simplify the expressions by deﬁning new functions

i ǫi = ǫ and the integral

where we have used









H

H

P

S

(s) =

(s′) sin(ψs′s + χs′)

C

(s) =

(s′) cos(ψs′s + χs′)

s+C

s

Z

s+C

p

H

H

s

Z
(s) = S2
H

p
(s) + C 2
H

ds′
2πρ
ds′
2πρ

,

,

(s),

ξ(s) = tan−

1 S
C

H

H

(s)
(s)

,

H

H

K

I1

where ψs′s is the betatron phase advance from point s′ to point s and C is the ring circum-

ference. Then we can write down

M(s1|

s)d(s)

ds
2πρ

=

√β1
α1
√β1

−

0

1
β1

S

C

1

H

1

H

















s)

η(s1|

ds
2πρ

=

s)

¯η(s1|

ds
2πρ

+

I1

p

H1K1 sin(ξ1 −

χ1).

and

I1
It can be shown that

(67)

(68)

(69a)

(69b)

(69c)

(70)

(71)

(72)

s)

¯η(s1|

ds
2πρ

=

¯η.

1
2

I1

15

Since the ﬁrst three elements of the g vector have terms on the order of O(ǫ) and the

contributions of the third term of Eq. (65) to these elements are on the order of O(wǫ), we

will simply drop these contributions. However, the fourth element of this term is the leading

term and is not negligible. It is easy to show that

with the deﬁnition of

1 = wg3
g4

12 =

wǫ

s2

ds
2πρ

−
s2

s1

s)

Z
¯η(s2|

s)

η(s2|
ds
2πρ −

wǫ

p

=

wǫ

−

s1

Z

H2K

12 sin(ξ12

χ2)

−

(s′) sin(ψs′s2 + χs′)

(s′) cos(ψs′s2 + χs′)

S12
H

C 12
H

=

=

s2

s1

Z

s2

p

H

H

s1

Z

12 = (S12
H

p
)2 + (C 12
H

)2,

ds
2πρ
ds
2πρ

,

,

ξ12 = tan−

1 S12
H
C 12
H

.

K
If we write down the vector g1 in a form g1 = (gT

x , gT

l )T with 2-component vector gx and gl

representing the horizontal and longitudinal displacement, respectively, we have

√β1
α1
√β1
1
2

gx/ǫ =





−
g1
l /ǫ = ¯η21 −
¯η2
12
g2
w
l /ǫ =
2¯η −

−

¯η +

0

1
β1





S

C

1 −
H
1 −
H

√

√



H1H2 sin(ψ21 + χ2 −
12 sin(ξ12
χ2),

p

w

H2K

p

−
l , g2

,

H2 sin(ψ21 + χ2)
H2 cos(ψ21 + χ2) 

H1K1 sin(ξ1 −
χ1)

−

p

χ1),

(75b)

where g1

l , g2

l are the two elements of gl = (g1

l )T and in obtaining the ﬁrst term of Eq.

(75c) we have assumed the dipoles are distributed around the ring uniformly.

Radiation damping changes the transfer matrix T by a correction term on the order of ǫ

so that it is no more strictly symplectic. However, since ǫ is usually small and the correction

to the closed orbit due to this eﬀect is on the order of ǫ2, we will not consider the radiation

damping eﬀect. To work out the matrix inversion for (T

I)−

1, we will make use of

1 = U(Tn −
since the oﬀ-diagonal blocks of Tn are on the order of O(w). With matrix Tn as found in

(76)

I)−

I)−

(T

−

1.

−
1U−

Eq. (25), we have shown that

(73)

(74a)

(74b)

(74c)

(75a)

(75c)

(77)

(Tn −

I)−

1 =

a b
c d 






16

(78a)

(78b)

(78c)

(78d)

(79)

(80)

(81)

(82)

(83)

with

a = (M0

I)−

1,

1 −

b =

(M0

1

I)−

−

1 −



c =

˜F 21
n

− 

0


d = (Ln −

I)−



˜F 22
n
0 

1,

0 ˜E11
n
0 ˜E21
n

,




I)−

1,

(M0

1 −

where we have dropped all terms on the order of O(w) or higher and we have

(Ln −

I)−

1 =

1
¯η 

¯η12

−
1

¯η
w + ¯η12 ¯η21
¯η21

−

.






We then proceed to obtain the blocks of (T

closed orbit with Eq. (62). The results are given by

I)−

1 using Eq. (76) and ﬁnally we get the

−

xc =

ǫ√β1H2
2 sin πνx

−

cos(πνx −

ψ21 −

χ2) +

ǫ√β1K1
2 sin πνx

cos(πνx −

ξ1) + ǫD1(

1
2 −

¯η21
¯η

),

x′c =

ǫ
2 sin πνx s

H2
β1

K1
β1

ǫ
2 sin πνx s
¯η12 ¯η21
2¯η

+

cτc = ǫ

+ξ1)

−

1
2 −

¯η21
p
¯η

δc = ǫ(

α1 cos(πνx −
(cid:0)
α1 cos(πνx −

ψ21 −

χ2)

sin(πνx −

ψ21 −

−

χ2)

−

ξ1)

sin(πνx −

−

ξ1)

+ ǫD′1(

(cid:1)
¯η21
¯η

),

1
2 −

(cid:0)
ǫ
2 sin πνx
(cid:2)p
K1H1 cos(πνx + χ1 −
).

H1H2 cos(πνx −

ψ21 −
− H2 cos πνx

ξ1)

(cid:1)

χ2 + χ1) +

+ ǫ

i

p

K1H2 cos(πνx −
12 sin(ξ12
χ2),

−

p
H2K

ψ21 −

χ2

Note again that we have dropped all terms on the order of w or higher so that the results

are valid only for oﬀ-resonance cases. Obviously we have recovered Eqs. (23-24) of Ref. [6]

as the ﬁrst term in Eq. (80). The second term comes from the propagation of radiation

energy losses. The third term comes from the energy variation around the ring. It is worth

noting that the cτc orbit is zero at the rf cavity.

So far we have considered only one rf cavity in the ring. However, the same analysis

can be easily applied to more cavities. In fact, if we neglect the interaction between the rf

cavities, which corresponds to higher order terms of the wi parameters, the one-turn transfer

17

matrix is

i
X
where the summation is over all cavities. Eq. (84) means the total eﬀect of all cavities is

T1 = T0

1 +

T1iWiTi1,

(84)

the linear superposition of the single cavity eﬀects. It is then straightforward to modify the

results of the one-cavity case for multiple-cavity cases.

V. SIMULATION

In this section we will verify the theory developed in the previous sections by comparing

the results to simulations with the accelerator modeling code AT [11]. We use the machine

model of the SPEAR Booster for the calculation. The SPEAR Booster is chosen because

it has appreciable dispersion functions at the rf cavity. The model consists of 20 periods of

FODO lattice over a circumference of 2πR = 133.8 m. The bending radius is ρ = 11.82 m

for all dipoles. The extraction energy is E = 3 GeV. The rf frequency is frf = 358.533 MHz

and the harmonic number is h = 160. At extraction, the rf gap voltage is Vrf = 0.8 MV and

the one-turn radiation energy loss is U0 = 0.60 MeV. In the simulation, we will consider it

as a storage ring running at its extraction energy. The betatron tunes are νx = 6.16 and

νy = 4.23 for the model. At the rf cavity, the Courant-Snyder functions are α2 =

0.72 and

−

β2 = 2.09 m and the dispersion functions are D2 = 0.27 m and D′2 = 0.06. The horizontal
chromaticity is Cx =

7.9.

−

We ﬁrst present a numerical example to verify the transformation Eq. (50). The injection

point of the SPEAR Booster is located in the ring opposite to the rf cavity where we have

α1 = 0.02, β1 = 1.54 m, D1 = 0.24 m and D′1 = 0.01 and the betatron phase advance

from the rf cavity to this observation point is ψ21 = 0.16 rad modulo 2π. The synchronous

phase is set to φs = π and hence w = 0.0020. The one-turn transfer matrix for betatron

coordinates Xn at this location is

0.550532

1.306266

0.000447

0.001018

−

Tn =

0.547728

−
0.000396

0.516813

0.000129

0.000294



0.000910

0.995433

4.548267

−
0.000174 0.000399

0.002004

0.995433

−

−










−

.








(85)

18

The oﬀ-diagonal blocks represents the synchrobetatron coupling eﬀects. We then apply the

second transformation V as determined by Eqs. (27, 31, 33-34) to obtain the ﬁnal transfer

matrix

Td =










0.550533

1.306265

0.547728

0.516813

×

10

10−

10

10−

−

9.4

4.1

×

10

10−

10

10−

−
4.1

1.8

−

4.6

1.3

×

×

10

10−

10

10−

1.05

9

10−

×

3.0

−

×

10

10−



0.995432

4.548266

−

0.002004

0.995432

(86)

.








×
Elements of the oﬀ-diagonal blocks are reduced to the order of magnitude of 10−

−

×

10 from the

original value of 10−

4, indicating the high precision of the approximations we have made.

We may use matrix Td, or the original transfer matrix T to track a particle. Or we may

use the ringpass function of AT to track. Tracking result with the three methods may be

labeled “analytic”, “Matrix” and “AT”, respectively.

As an example we show the tracking results (Figure 1) for the initial condition (0, 0, 0, 1

×
4)T , i.e., only the momentum deviation is oﬀset by a small amount. We see excellent

10−

agreement between the three curves in the ﬁrst two plots (100 turns). There is no diﬀerence

between “analytic” and “Matrix”. There are diﬀerences between “analytic”/“Matrix” and

“AT” and the diﬀerences grow linearly (bottom plots) in the range shown (1000 turns).

This is because AT includes nonlinearity eﬀects which causes tune diﬀerences. The mea-

sured synchrotron tune is νs(AT) = 0.0152172 from AT and νs(ana) = 0.0152182 from

“analytic”/“Matrix”. The diﬀerence is ∆νs = 1.0

10−

6, which would give an estimated

amplitude of momentum deviation diﬀerence of 2π∆νsNδmax = 6.3

and δmax = 1

10−

4, against the measured value of 6.9

10−

10−

7 with N = 1000

×
7 as shown in the last

×

×

plot of Figure 1. The calculated synchrotron detuning due to nonlinear rf ﬁeld [12] is

×

∆νs = h2α2

0δ2

max/16νs = 1.2

10−

6. The measured betatron tune is νx(AT) = 0.160400 from

×

“AT” and νx(ana) = 0.160432 from “analytic”/“Matrix”. The linear growth of the diﬀerence

between “analytic”/“Matrix”and “AT” for the x coordinate can also be explained by the

tune diﬀerence. We have also tried other initial conditions and ﬁnd similar agreement. We

ﬁnd that the average path length eﬀect studied in Ref. [14] needs be compensated when there

is a large initial horizontal coordinate oﬀset. The average path length change corresponds to

an eﬀective change of momentum deviation in AT tracking. Therefore the initial condition

(x, x′, 0, 0, 0, 0)T in AT tracking is equivalent to an initial condition of (x, x′, 0, JxCx/α0R)T

in matrix tracking where Jx is the betatron action variable .

19

The betatron detuning due to synchrobetatron coupling (Eq. (42)) is also checked against

AT by comparing the betatron tune from AT tracking to the analytic calculation with various

rf voltage. The initial condition for AT tracking is (1

10−

5, 0, 0, 0, 1

10−

6, 0)T . Small

×

×

deviations of x and δ are chosen to avoid signiﬁcant nonlinear detuning eﬀects. The result

is shown in Figure 2.

In the above we turned radiation oﬀ in AT. If it is on, the synchronous phase will change

and so will the parameter w. Radiation damping will also start acting. Further more, the

ﬁnite energy gain at the rf cavity will cause changes to the closed orbit as studied in the

previous section. To calculate the closed orbit change, we need to calculate the functions

S

, C

,

and ξ deﬁned in Eq. (69). It is found that numerical integration through a dipole

H

H

K

does not make much diﬀerence from simply transporting the coordinate shifts at the dipole

exit to the observation point. In Figure 3 we show functions S

and C

for the SPEAR

H

H

Booster ring calculated with both methods. The one-turn coordinate shifts, or the g vector

is plotted in Figure 4. There are two curves in each plot, one is from Eq. (75), the other is

0.05

0

)

m
m

(
 
x

)

m
m

(
 
x
 
∆

0.01

0.005

0

−0.005

−0.01
 
0

−0.05
0

20

40
60
turn number

80

100

20

40
60
turn number

80

100

ana−AT
ana−Mat

−6

x 10

 

ana−AT
ana−Mat

 

200

400
600
turn number

800

1000

200

400
600
turn number

800

1000

FIG. 1:

(Color online) Comparison of the x and δ coordinates tracked with three diﬀerent ways

(see text). In the two top plots, the three curves in each ﬁgure are almost exactly on top of each

other. In the two bottom plots, the diﬀerences between “ana” and “AT”, and “ana” and “Mat”

are shown. The linear growth of “ana” and “AT” diﬀerence is cause by the tune diﬀerences due to

nonlinearities. The initial tracking condition is (0, 0, 0, 1

10−

4)T .

×

−4

x 10

δ

δ
 
∆

2

1

0

−1

−2
0

0.5

1

0

−0.5

−1
 
0

20

from direct matrix multiplication with the transfer matrix of each accelerator element given

by AT and the coordinate shifts of each element obtained by tracking through it with zero

initial coordinates in AT.

We then compare the closed orbit changes obtained with three diﬀerent ways: (1) AT

(using the function ﬁndorbit6), (2) direct matrix calculation with Eq.

(62) and (3) the

analytic solution in Eqs.

(80-83). The results are shown in Figure 5. Good agreement

between the three curves are seen, verifying the analysis in the last section. The S

, C

function are calculated with simple summations in the “analytic” approach.

H
H
It is worth

pointing out that all the three terms in Eq. (80) are important in determining the closed

orbit change for xc.

The same closed orbit calculation is done for the SPEAR3 ring. We only show the

synchrobetatron coupling induced closed orbit changes in Figure 6. Note dispersion at the
H2 have no

rf cavity for the SPEAR3 ring is zero. So the terms in Eqs. (80-83) involving

contribution.

 

AT track
analytic

1

2
 (MV)
V
rf

3

4

FIG. 2: The synchrobetatron coupling induced betatron detuning ∆νx obtained by AT tracking

is compared to analytic calculation with Eq. (42). The rf gap voltage is varied from 0.2 MV to

3.2 MV.

−5

x 10

0

−0.5

−1

x

ν
 
∆

−1.5

−2

−2.5

−3
 
0

21

VI. CONCLUSIONS

In this study we fully analyzed the linear synchrobetatron coupling by block diagonalizing

the 4

4 horizontal-longitudinal transfer matrix. We found the transformation between the

×

usual (x, x′, cτ, δ) coordinates and the normal modes and the transfer matrix for the normal

modes in analytic forms in terms of the Courant-Snyder functions, dispersion functions and

the rf voltage slope parameter. This enabled us to predict the 4-dimensional motion of

a particle knowing only the initial condition and those common parameters. The eﬀects

of synchrobetatron coupling on the horizontal betatron motion, including changes to the

Courant-Snyder functions and the betatron tune are also presented. We then studied the

beam width and the bunch length under synchrobetatron coupling. We readily recovered

Shoji’s result of dispersion-dependent bunch lengthening [5]. We found that the beam width

and the bunch length slightly oscillate around the ring with the betatron phase advance

measured from the rf cavity. We pointed out that the bunch length varies around the ring

due to phase slippage, a fact that is often overlooked. We also pointed out that the phase

space volume is preserved under SBC when not considering radiation induced diﬀusion and

damping.

Following Ref. [6], which studied the horizontal closed orbit changes due to ﬁnite energy

)

/

2
1
m

(
 

h

C

/

S

h

0.2

0.1

0

−0.1

−0.2
 
0

 

(Int)

S

H
C

S

H
C

H

(Int)

H
(Non)

(Non)

FIG. 3:

(Color online) Function S

and C

as deﬁned in Eq. (69) for the SPEAR Booster at 3

H

H

GeV. The curves labeled “Int” are from numerical integration with the Trapezoidal rule by cutting

each dipole into 100 slices. The “Non” curves are obtained by calculating the coordinate shifts at

the exit of each dipole, transporting to the observation point and summing up contributions of all

dipoles.

50

100

s (m)

22

Mat
Ana

Mat
Ana

AT
Mat
Ana

 

 

 

 

Mat
Ana

)

m
m

(
 

g

x

0.1

0.05

0

−0.05

−0.1
 
0

0.5

0

)

m
m

(
 

τ
c

g

−0.5
 
0

)

m
m

(
 

x

c

0.2

0.1

0

−0.1

−0.2
 
0

c

τ
c

−5

−10

−15
 
0

−5

x 10

5

0

50

100

150

50

100

150

s (m)

s (m)

50

100

150

50

100

150

s (m)

s (m)

FIG. 4:

(Color online) The one-turn coordinate shifts due to radiation energy losses and ﬁnite

energy gains at the rf cavity for the SPEAR Booster at 3 GeV. The four plots are x, x′, cτ and δ

shifts, respectively.

AT
Mat
Ana

s (m)

50

100

150

50

100

150

s (m)

50

100

150

s (m)

50

s (m)

150

AT
Mat
Ana

100

FIG. 5: (Color online) The SBC induced closed orbit changes calculated in three diﬀerent ways for

the SPEAR Booster at 3 GeV. The changes to xc, x′c, cτc and δc are shown in the four plots. The

three curves are from AT (“AT”), matrix inversion (“Mat”) and the analytic solution (“Ana”),

respectively.

)
d
a
r
m

(
 

g

p
x

0.02

0.01

0

−0.01

−0.02
 
0

−7

x 10

10

δ

g

5

0

−5
 
0

Mat
Ana

)
d
a
r
m

(
 

’

x

c

0.04

0.02

0

−0.02

−0.04
 
0

AT
Mat
Ana

c

δ

−4

x 10

2

1

0

−1

−2
 
0

 

 

 

 

23

gains at rf cavities, we fully explored the problem by looking for a closed orbit in the 4-

dimension phase space, considering both ﬁnite energy gains at rf cavities and radiation

energy losses in dipole magnets. We recovered the horizontal closed orbit change result in

Ref. [6] and found additional terms due to energy losses.

We carried out simulations with the accelerator modeling code AT [11] to verify the

analysis. We found that the block diagonalization transformation matrix had high precision

despite the approximations we made to get the analytic solution. The tracking result of the

code AT [11] agreed to the result via the decoupled transfer matrix which was obtained with

the analytic transformation matrix. The diﬀerences between them were caused by the tune

diﬀerences due to nonlinearities. The closed orbit results of AT also agreed well with the

theory.

Acknowledgments

The author thanks James Safranek, Andrei Terebilo and Jeﬀ Corbett for the fruitful

discussions with them which had signiﬁcant inﬂuences over the development of this study.

50

100

150

200

250

50

100

150

200

250

)

m
m

(
 

x

c

0.1

0.05

0

−0.05

−0.1
 
0

−6

x 10

5

0

c

τ
c

−5

−10

−15
 
0

AT
Mat
Ana

 

 

)
d
a
r
m

(
 

’

x

c

0.04

0.02

0

−0.02

−0.04
 
0

c

δ

2

1

0

−1

−2
 
0

−4

x 10

s (m)

AT
Mat
Ana

AT
Mat
Ana

s (m)

 

 

AT
Mat
Ana

50

100

150

200

250

50

100

150

200

250

s (m)

s (m)

FIG. 6:

(Color online) The SBC induced closed orbit changes calculated in three diﬀerent ways

for the SPEAR3 ring. The changes to xc, x′c, cτc and δc are shown. The three curves are from AT

(“AT”), matrix inversion (“Mat”) and the analytic solution (“Ana”), respectively.

24

Discussions with Alex Chao helped the author on the history of the subject.

[1] D. Sagan and D. Rubin, Phys. Rev. ST Accel. Beams 2, 074001 (1999).

[2] A. Chao, J. Appl. Phys. 50, 595 (1979).

[3] T. Suzuki, Part. Accel. 18, 115 (1985).

[4] C. Corsten and H. Hagedoorn, Nucl. Instr. Methods, 212, 37 (1983).

[5] Y. Shoji, Phys. Rev. ST Accel. Beams 7, 090703 (2004).

[6] W. Guo, K. Harkay, and M. Borland, Phys. Rev. E 72, 056501 (2005).

[7] A. Chao, M. Lee, and P. Morton, SLAC Technical Report PTM-25 (1975).

[8] A. Chao, SLAC Technical Report PTM-53 (1976).

[9] M. Lee, P. Morton, J. Rees, and B. Richter, IEEE Trans. Nucl. Sci. NS-22, 1914 (1975).

[10] J. Maidment, Closed orbit distortion due to energy loss by synchrotron radiation in ESR1,

EPIC-MC-14 (unpublished) (1973).

[11] A. Terebilo, in Proceedings of the 2001 Particle Accelerator Conference, Chicago (2001).

[12] S. Y. Lee, Accelerator Physics (World Scientiﬁc, 1999).

[13] B. Nash, Analytical approach to eigen-emittance evolution in storage rings (Stanford Univer-

sity thesis, 2006).

[14] Y. Shoji, Phys. Rev. ST Accel. Beams 8, 094001 (2005).

25

