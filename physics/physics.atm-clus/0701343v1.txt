APS/123-QED

A nc-AFM simulator with Phase Locked Loop-controlled

frequency detection and excitation

Laurent Nony∗

L2MP, UMR CNRS 6137, Universit´e Paul C´ezanne Aix-Marseille III,

Case 151, 13397 Marseille Cedex 20, France

Alexis Baratoﬀ

NCCR “Nanoscale Science”, University of Basel,

Klingelbergstr. 82, CH-4056 Basel, Switzerland

Dominique Sch¨ar, Oliver Pfeiﬀer, Adrian Wetzel, and Ernst Meyer

Institute of Physics, Klingelbergstr. 82,

CH-4056 Basel, Switzerland

Published in PHYSICAL REVIEW B 74,

235439 (2006)

7
0
0
2
 
n
a
J
 
0
3
 
 
]
s
u
l
c
-
m
t
a
.
s
c
i
s
y
h
p
[
 
 
1
v
3
4
3
1
0
7
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

∗ To whom correspondence should be addressed; E-mail: laurent.nony@l2mp.fr.

1

Abstract

A simulation of an atomic force microscope operating in the constant amplitude dynamic mode

is described. The implementation mimics the electronics of a real setup which includes a digital

Phase Locked Loop (PLL). The PLL is not only used as a very sensitive frequency detector, but

also to generate the time-dependent phase-shifted signal which drives the cantilever. The optimum

adjustments of individual functional blocks and their joint performance in typical experiments are

determined in details. Prior to testing the complete setup, the performances of the numerical

PLL and of the amplitude controller were ascertained to be satisfactory compared to those of

the real components. Attention is also focussed on the issue of apparent dissipation, that is

of spurious variations in the driving amplitude caused by the non-linear interaction occurring

between the tip and the surface and by the ﬁnite response times of the various controllers. To

do so, an estimate of the minimum dissipated energy which is detectable by the instrument upon

operating conditions is given. This allows to discuss the relevance of apparent dissipation which

can be conditionally generated with the simulator in comparison to values reported experimentally.

The analysis emphasizes that apparent dissipation can contribute to the measured dissipation

up to 15% of the intrinsic dissipated energy of the cantilever, but can be made negligible when

properly adjusting the controllers, the PLL gains and the scan speed.

It is inferred that the

experimental values of dissipation reported cannot only originate in apparent dissipation, which

favors the hypothesis of “physical” channels of dissipation.

PACS numbers: 07.79.Lh, 07.50.Ek, 46.40.Ff

Keywords: virtual machine, non-contact AFM, dissipation, damping, apparent dissipation, Phase Locked

Loop

2

I.

INTRODUCTION

Since almost a decade, non-contact atomic force microscopy (nc-AFM) has proven capable

of yielding images showing contrasts down to atomic scale on metals, semiconductors, as well

as insulating ionic crystals, with or without metallic or adsorbate overlayers1,2,3. Like other

scanning force methods, the technique relies on a micro-fabricated tip grown at the end of

a cantilever. However, unlike the widely used contact or the tapping modes, the cantilever

deﬂection is neither static nor driven at constant frequency, but is driven at a frequency

f0 =

ω0/2π equal to its fundamental bending resonance frequency, slightly shifted by the

tip-sample interaction. A suﬃciently large oscillation amplitude prevents snap into contact.
e
A quality factor exceeding 104, readily achieved in UHV, together with frequency detection

f

by demodulation provide unprecedented force sensitivity4,5. A phase-locked loop (PLL) is

typically used for that purpose. Since

f0 varies with the tip-surface distance, it deviates from

f0, the fundamental bending eigenfrequency of the free cantilever. Upon approaching the

surface, the tip is ﬁrst attracted, in particular by Van der Waals forces, which decrease

f0.

The negative frequency shift, ∆f =
f0 − f0, varies rapidly with the minimum tip-distance
e
d, usually as d−n with n ≥ 1.5, and then as exp(−d/λ) a few angstr¨oms above the surface,

owing to short-range chemical and/or steric forces6. When ∆f is used for distance control,

e

e

contrasts down to the atomic scale can be achieved. Another speciﬁc feature of the nc-AFM

technique is that the oscillation amplitude A is kept constant while approaching or scanning

the surface at constant ∆f .

Controlling the phase of the excitation so as to maintain it on resonance and to make the

frequency matching a preset

f0-value, as well as the driving amplitude so as to keep the tip

oscillation amplitude constant, respectively, requires dedicated electronic components. Am-

e

plitude control is usually achieved using a proportional integral controller (PIC), hereafter

referred to as APIC, whereas phase and frequency control can be performed in two ways.

In both cases the AC deﬂection signal of the cantilever is ﬁltered, then phase-shifted and

multiplied by the APIC output and by a suitable gain. The most common method consists

in using a band-pass ﬁltered deﬂection signal7,8. This is referred to as the self-excitation

mode. The second method, extensively analyzed hereafter, consists in using the PLL to

generate the time-dependent phase of the excitation signal. The PLL output is driven by

the AC deﬂection signal and phase-locked to it, provided that the PLL settings are properly

3

adjusted. Then, the PLL continuously tracks the oscillator frequency

f0 with high precision.

Moreover, the phase lag introduced by the PLL itself can be compensated. For reasons of

e

clarity, this mode will be referred to as the PLL-excitation mode. The choice of the PLL as

the excitation source has initially been motivated to take beneﬁt of the noise reduction due

to PLLs9. A further advantage is that the noise reduction does not only optimize the detec-

tion of the frequency shift, but also the excitation signal. In both modes, the phase shifter is

adjusted so as the phase lag ϕ between the excitation and the tip oscillation equals −π/2 rad

throughout an experiment. If all adjustments and controls were perfect, the oscillator would

then always remain on resonance.

The nc-AFM technique therefore requires the simultaneous operation of three controllers :

PLL, APIC and distance controller, which keeps constant a given ∆f while scanning the

surface. Since the tip-surface interaction makes the dynamic of the oscillator non-linear, the

combined action of those three controllers becomes complex. They can conditionally inter-

play7,8 and therefore inﬂuence the dynamics of the system. Consider for instance the time

the PLL spends to track

f0 is long compared to the time constant of the APIC. Then, the

cantilever is no longer maintained at

f0, but at a frequency slightly higher or lower. Conse-

quently, the oscillation amplitude drops10 and the APIC increases the excitation to correct

e

e

the amplitude reduction. Such an apparent loss of energy, which can as well be interpreted

as a damping increase of the cantilever, does not result of a dissipative process occurring

between the tip and the surface, but is the consequence of the bad tracking of

f0. So-called

apparent dissipation (or apparent damping) remains under discussions in the nc-AFM com-

e

munity, which hinders the quantitative interpretation of the experimental proofs of dissi-

pative phenomena on the atomic scale over a wide variety of samples11,12,13,14,15,16,17,18,19,20.

Thus, addressing the problem of apparent dissipation turns out to be mandatory but requires

to understand the complex interplay between controllers as well as to analyze the system

time constants. Although several models of physical dissipation, connected or not to the

conservative tip-surface interaction have been proposed21,22,23,24,25,26,27,28,29,30 and reviewed31,

the question of apparent dissipation in the self-excitation scheme has been addressed by two

groups7,8,32. M. Gauthier et al. [7] emphasize the interplay between the controllers and the

conservative tip-sample interaction which, although weak, can signiﬁcantly aﬀect the damp-

ing. They put in evidence resonance eﬀects which can conditionally occur in damping images

upon scan speed and APIC gains. G. Couturier et al.8 address a similar problem numerically

4

and analytically. They show that the self-excited oscillator can be conditionally stable within

a narrow domain of Kp and Ki gains of the APIC, but that consequent damping variations

can as well be generated upon conservative force steps which change the borders of the sta-

bility domain. The results mentioned above are valid for the self-excitation mode, but the

question of apparent dissipation remains open regarding the PLL-excitation mode. However

recently, J. Polesel-Maris and S. Gauthier [33] have proposed a virtual dynamic AFM based

on the PLL-excitation scheme. Their work is targeted at images calculations including real-

istic force ﬁelds obtained from molecular dynamics calculations34. Their conclusions stress

the contribution of the scanning speed and of the experimental noise to images distortion

but do not address the potential contribution of the PLL upon operating conditions.

The goal of the present work is two-fold : 1- providing a detailed description of the

PLL-excitation based electronics of a home-built AFM used in our laboratory; 2- assessing

the contribution of the various controllers to the dissipation signal and in particular the

contribution of the PLL. The paper is organized as follows. In section II, an overview of

the chart of the microscope and of the attached electronics (cf. ﬁg.1), is given in terms

of blocks, namely ; oscillator and optical detection (block 1), RMS-to-DC converter (block

2), amplitude controller (block 3), PLL (block 4), phase shifter (block 5) and tip-surface

distance controller (block 6). In section III, the detailed description of the numerical scheme

used to perform the calculations is given on the base of coupled integro-diﬀerential equations

ruling each block. Section IV provides an estimate of the minimum detectable dissipation

by the instrument with the goal to assess the relevance, compared to experimental results,

of the apparent dissipation which can be conditionally generated numerically. Section V

reports the results. In the ﬁrst part, the simulation is validated by comparing a numerical

∆f vs. distance curve to the analytic expression of the ∆f due to Morse and Van der Waals

interactions which does not take into account the ﬁnite response of the various controllers.

Then the dynamic properties of the numerical PLL and APIC upon gains are compared to

those of the real components. Section V C gives some examples on how apparent dissipa-

tion can be produced upon working conditions of the PLL. Section V D ﬁnally shows scan

lines computed while varying PLL gains, scan speed and APIC gains. A discussion and a

conclusion end the article.

5

II. OVERVIEW

A. Description

The electronics consists of analog and digital (12 bits) circuits which are described by

six interconnected main blocks operating at various sampling frequencies (fs). The highest

sampling frequency among the digital blocks is the PLL one, fs1 = 20 MHz. The PLL

electronics has initially been developped by Ch.Loppacher [35].

Block 1 represents the detected oscillating tip motion coupled to the sample surface. In

the simulation, the block is described by an equivalent analog circuit. More generally, all the

analog parts of the electronics are described in the simulation using a larger sampling fre-

quency compared to fs1, namely fs2 = 400 MHz. This is motivated by the ultra-high vacuum

environment within which the microscope is placed, thus resulting in a high quality factor

of the cantilever, typically Q = 30000 at room temperature. Besides, nc-AFM cantilevers

have typical fundamental eigenfrequencies f0 ≃ 150 kHz. The chosen sampling frequency

should therefore insure a proper integration of the diﬀerential equations with an error weak

enough. The signal of the oscillating cantilever motion goes into a band pass ﬁlter which

cuts-oﬀ its low and high frequencies components. The bandwidth of the ﬁlter is typically

60 kHz, centered on the resonance frequency of the cantilever. Despite the ﬁlter has been

implemented in the simulation, no noise has been considered, so far. The signal is then sent

to other blocks depicting the interconnected parts of two boards, namely an analog/digital

one, the “PLL board”, and a fully digital one which integrates a Digital Signal Processor

(DSP), the “DSP board”. The boards share data via a “communication bus” operating at

fs3 = 10 kHz, the lowest frequency of the digital electronics.

Block 2 stands for the lone analog part of the PLL board (fs = fs2). It consists of a RMS-

to-DC converter. The block output is the rms value of the oscillations amplitude, Arms(t).

Arms(t) is provided to block 3, one of the two PICs implemented on the DSP (fs = fs3).

When operating in the nc-AFM mode, the block output is the DC value of the driving

amplitude which maintains constant the reference value of the oscillations amplitude, Aset
0 .

This is why it is referred to as the amplitude controller, APIC. For technical reasons due to

the chips, the signal is saturated between 0 and 10 V.

The dashed line in ﬁg.1 depicts the border between analog and digital circuits in the

6

PLL board. The digital PLL, block 4 (fs = fs1), consists of three sub-blocks : a Phase

Detector (PD), a Numerical Controlled Oscillator (NCO) and a ﬁltering stage consisting of

a decimation ﬁlter and a Finite Impulse Response (FIR) low pass ﬁlter in series. The PLL

receives the signal of the oscillation divided by Arms(t) plus an external parameter : the

“center frequency”, fcent = ωcent/2π. fcent speciﬁes the frequency to which the input signal

has to be compared to for the demodulation frequency stage. This point is particularly

addressed in section III D. The NCO generates the digital sin and cos waveforms of the

time-dependent phase, ϕnco(t)+ϕpll(t), ideally identical to the one of the input signal. ϕpll(t)

is correlated to the error which is potentially produced while the frequency demodulation,

upon operating conditions. The sin and cos waveforms are then sent to a digital phase

shifter, block 5 (fs = fs1) which shifts the incoming phase ϕnco(t) + ϕpll(t) by a constant

amount, ϕps, set by the user. Since the cantilever is usually driven at

f0, ϕps is adjusted to

make that condition fulﬁlled36, namely :

e

ϕnco(t) + ϕpll(t) + ϕps =

ω0t,

(1)

Indeed, the PLL produces the phase locked to the input, that is ϕnco(t) + ϕpll(t) ≃

ω0t−π/2.

f

If it optimally operates, ϕpll(t) ≃ 0. ϕps has therefore to be set equal to +π/2 to maintain

the excitation at the resonance frequency prior to starting the experiments. Consequently,

f

ϕ = −π/2 rad. The block output, sin [ϕnco(t) + ϕpll(t) + ϕps], is converted into an analog

signal and then multiplied by the APIC output, thus generating the full AC excitation

applied to the piezoelectric actuator to drive the cantilever.

Block 6 is the second PIC of the DSP (fs = fs3). It controls the tip-surface distance to

maintain constant either a given value of the frequency shift, or a given value of the driving

amplitude while performing a scan line (switch 3 set to location “a” or “b”, respectively

in ﬁg.1). The output is the so-called “topography” signal. The block is referred to as the

distance controller, DPIC.

Finally, a digital lock-in ampliﬁer detects the phase lag, ϕ, between the excitation signal

provided to the oscillator and the oscillating cantilever motion.

7

B. Time considerations

Analog and digital data are properly transformed by Analog-to-Digital and Digital-to-

Analog Converters (ADC and DAC, respectively). In the electronics, ADC1 is an AD9042

(cf. ﬁg.1) with a nominal sampling rate of 41 × 106 samples per second37. This ensures the

analog signal is sampled quick enough and properly operated by the PLL at fs1. This ADC

is therefore not described in the simulation. ADC2 (ADS 7805) has a nominal frequency of

100 kHz [37]. The signal is transmitted to the communication bus, the bandwidth of which

is ten times smaller.

Its role is therefore as well supposed to be negligible. The code is

implemented assuming that the RMS-to-DC output signal is provided to the communication

bus operating at fs3. DAC1 (AD 668) is a 12 bits ultrahigh speed converter. It receives the

digital waveform coming from the PS. Indeed, it must be fast enough to provide a proper

analog signal to hold the excitation. Its nominal reference bandwidth is 15 MHz [37]. To

make the code implementation easier, the DAC has not been implemented neither. Thus,

it is assumed that the PS signal directly provides the signal at fs1 to perform the analog

multiplication, itself processed at fs3 due to the APIC output. The others DACs have all

nominal bandwidths much larger than the communication bus one and are also assumed to

play negligible roles.

III. NUMERICAL SCHEME

A. Block 1: oscillator and optical detection

The block mimics the photodiodes acquiring the signal of the motion of the oscillating

cantilever. The equation describing its behavior is given by the diﬀerential equation of the

harmonic oscillator :

¨z(t) +

˙z(t) + ω2

0z(t) = ω2

0Ξexc(t) +

ω0
Q

ω2

0Fint(t)
kc

(2)

ω0 = 2πf0, Q, kc stand for the angular resonance frequency, quality factor and cantilever

stiﬀness of the free oscillator, respectively. z(t), Ξexc(t) and Fint(t) are the instantaneous

location of the tip, excitation signal driving the cantilever and the interaction force acting

between the tip and the surface, respectively. The equation is solved with a modiﬁed Verlet

8

algorithm, so-called leapfrog algorithm38, using a time step ∆ts2 = 1/fs2 = 5 ns. In the

followings, the time will be denoted by its discrete notation : t → ti = i × ∆ts2.

The instantaneous value of the driving amplitude Ξexc(ti) (units : m) can be written as :

Ξexc(ti) = K3Aexc(ti)zps(ti)

K3 (units : m.V−1) represents the linear transfer function of the piezoelectric actuator driving

the cantilever. Aexc(ti) (units : V) is the APIC output (cf. section III C). It is proportional

to the damping signal according to :

K3Aexc(ti) =

Γ(ti)A0
ω0

,

Γ(ti) and A0 (units : s−1 and m, respectively) being the damping signal and oscillations

amplitude of the cantilever when driven at f0, respectively. When the cantilever is externally

driven and if no interaction occurs, Aexc(ti) can be written as a function of A0 and of the

quality factor of the cantilever :

Then the damping of the free cantilever equals :

K3Aexc,0 =

A0
Q

Γ0 =

ω0
Q

In nc-AFM, the dissipation is commonly expressed in terms of dissipated energy per oscil-

lation cycle, Ed0. For a cantilever with a high quality factor oscillating with an amplitude

A0 :

Ed0(A0) =

πkcA2
0
Q

=

πkcA2Γ0
ω0

In UHV and at room temperature, Q = 30000. Besides, nc-AFM commercial cantilevers
have typical stiﬀnesses39 kc ≈ 40 N.m−1. Considering A0 = 10 nm, the intrinsic dissipated

energy per cycle of the cantilever is then Ed0 ≃ 2.6 eV/cycle.

In equation 3, zps(ti) is the AC part of the excitation signal (cf. section III E).

It is

provided by the PS when the PLL is engaged. When the steady state is reached, e.g.

ti ≫ tsteady ≃ 2Q/f0, the block output is :

9

(3)

(4)

(5)

(6)

(7)

K1z(ti) = K1A(ti) sin [ωti + ϕ(ti)]

(8)

K1 (V.m−1) depicts the transfer function of the photodiodes which is assumed to be linear

within the bandwidth (3 MHz in the real setup). If the damping is kept constant, the ampli-

tude and the phase, A(ti) and ϕ(ti) respectively, are supposed to be constant as well. This

is no longer true once the various controllers are engaged, therefore their time dependence

is explicitly preserved.

In equation 2, the interaction force Fint(r) = −∂rVint(r) is derived from a conservative

potential consisting of two components : a long-range part, depicted by a Van der Waals

term deﬁned between a sphere and a half-plane and a short-range part, prevailing at closer

distances, depicted by a Morse potential :

2e− r−rc
h
H and R are the Hamaker constant of the tip-vacuum-surface interface and tip’s radius,

λ − e− 2(r−rc)

Vint(r) = −

− U0

(9)

i

λ

HR
6r

respectively. U0, rc and λ are the depth, equilibrium position and range of the Morse

potential. The instantaneous tip-surface separation is r(ti) = D(ti) − z(ti), where D(ti) is

the distance between the surface location and the cantilever position at rest. So far, neither

elastic deformation of the sample and tip, nor dissipative interaction have been considered.

The signal K1z(ti) then gets into the band pass ﬁlter (BPF), the central frequency of

which, fc = ωc/2π, equals the resonance frequency of the cantilever, f0, with a bandwidth

BW ≃ 60 kHz. The output, zbpf(ti) (units : V), is ruled by :

¨zbpf(t) + 2πBW ˙zbpf(t) + ω2

c zbpf(t) = 2πBW K1 ˙z(t)

(10)

zbpf(ti) is then provided to the RMS-to-DC converter of the PLL board.

B. Block 2: RMS-to-DC converter

The converter is the only analog part of the PLL board. The related diﬀerential equation

is integrated at fs2. The chip (AD734) computes the square root of the squared value of the

incoming signal, preliminary ﬁltered by a ﬁrst-order low pass ﬁlter, the cut-oﬀ frequency of

10

which is fco = 400 Hz. The output is the amplitude (DC value) of the oscillation, Arms(ti)

(units : V) :

Vs(ti) being the output of the ﬁrst-order low pass ﬁlter :

p

Arms(ti) =

Vs(ti),

τrms ˙Vs(t) + Vs(t) = z2

bpf(ti),

(11)

(12)

with τrms = 1/(2πfco) ≃ 400 µs.

zbpf(ti) is then divided by Arms(ti) in order to normalize the amplitude of the waveform.

The signal thus normalized is sent to the ADC1 to be operated by the digital PLL.

C. Block 3: amplitude controller

The block represents a digital PI controller implemented in the DSP board. The con-

troller receives the RMS-to-DC output signal via the communication bus. Since the bus

operates at fs3 = 10 kHz, the time step used to solve the related diﬀerential equation is

∆ts3 = 1/fs3 = 100 µs. Besides Arms, the controller receives three external parameters :
the proportional and integral gains, K ac
p and K ac
respectively (units : dimensionless and
i
s−1, respectively), and the reference amplitude expected to be kept constant as soon as the
controller is engaged (switch 1 set to location “b” in ﬁg.1), Aset
0

(units : V). The block output

is the DC value of the excitation, previously referred to as Aexc(ti) (cf. equ.3) :

Aexc(ti) =K ac
p

Aset

0 − Arms(ti)

K ac
i

(cid:3)
0 − Arms(tk)

Aset

∆ts3

(13)

i
(cid:2)

+

Xk=0

(cid:2)
Engaging the APIC makes the nc-AFM mode eﬀective. This requires the PLL-excitation

(cid:3)

mode (block 4, cf. section III D) to be already engaged. If operating at

f0, then Arms/K1

equals the resonance amplitude, A0. Aexc is then minimal.

e

11

D. Block 4: PLL

Before starting this section, note that some of the elements detailed hereafter are adapted

from the book by R.Best [9]. The digital PLL consists of three sub-units : a Phase Detector,

a decimation ﬁlter and a FIR low pass ﬁlter in series and a NCO. The block operates at

fs1 = 20 MHz, with the related time step ∆ts1 = 1/fs1 = 50 ns. In the electronics, various

FIR low pass ﬁlters have been implemented upon the desired sensitivity in the frequency

detection, among which a 19th order ﬁlter with a 3 kHz cut-oﬀ frequency and a 45th order

ﬁlter with a 500 Hz cut-oﬀ frequency. Both of them can be used in the simulation.

1. Phase detector

Kdze(ti) :

2. Filtering stage

The PD is analogous to a multiplier regarding the two input signals : the BPF output

divided by Arms and the cos waveform coming out of the NCO (cf. ﬁg.1). Their product is

multiplied by a further gain, Kd (units : V) converting the dimensionless signal into volts

to be operated by the FIR low pass ﬁlter. The instantaneous block output is referred to as

Kdze(ti) = Kd

cos (ϕnco(ti))

(14)

zbpf(ti)
Arms(ti)

Assume that

ω0(ti) and ωnco(ti) are the instantaneous angular frequencies of the can-

f

f

tilever and of the signal generated by the NCO, respectively. Kdze(ti) consists of a high

frequency component :

ω0(ti) + ωnco(ti) and a low frequency one : δω(ti) =

ω0(ti) −

ωnco(ti). The FIR low pass ﬁlter cuts oﬀ the high frequency component and produces

uf (ti) ∝ sin {δω(ti)ti} ∝ [δω(ti)] × ti, which can be referred to as an error signal of the

PLL. Indeed, when the PLL optimally operates, ωnco(ti) almost perfectly matches

ω0(ti).

The instantaneous value uf (ti) can therefore be interpreted as a correction term in the PLL

f

f

cycle.

Before being operated by the FIR low pass ﬁlter, the signal is processed by the decimation

ﬁlter. The ﬁlter averages Kdze(ti) over Nds PLL cycles upon the FIR low pass ﬁlter cut-oﬀ

frequency. For instance, Nds = 400 for the 3 kHz low pass ﬁlter. The updating rate of the

12

FIR low pass ﬁlter is therefore fs1/Nds = 50 kHz. The digital data are averaged over those

Nds cycles. The average value is fed at the ﬁrst entry of a buﬀer B consisting of Nﬁr entries.

The entries of the buﬀer are then all shifted by one into the buﬀer. At a given moment in

time, ti, uf (ti) is given by the following algorithm :

P

Kdze(tj )

Bk =

Nds
j=k−Nds
Nds
shift of the buﬀer entries

uf (ti) =

i
k=i−Nﬁr

ck × B(tk)





(15)

Nﬁr is the order of the FIR low pass ﬁlter (Nﬁr ≪ Nds) and ck is the kth coeﬃcient of the

P

FIR low pass ﬁlter. Once the buﬀer is transmitted, it is initialized and ﬁlled again. Finally,

uf (ti) is multiplied by a further gain, K0, which depicts the linear conversion of the signal
from volts to rad.s−1 (units: rad.V−1.s−1) and provided to the NCO.

3. Numerical Controlled Oscillator

We ﬁrst assume that the frequency tracker of the PLL is disengaged (switch 2 set to

location “a” in ﬁg.1). Its role is carefully addressed in section III D 5. The NCO adds the

instantaneous angular frequency K0uf (ti) to an external input, the center angular frequency

of the PLL, ωcent. ωcent is ﬁxed equal to the angular resonance frequency of the free cantilever

ω0, prior to starting the experiments. The signal is then integrated, which produces the

related phase, ϕnco(ti), locked to the one of the cantilever :

ϕnco(ti) =

[ωcent + K0uf (tk)] ∆ts1,

(16)

i

Xk=pll

tpll being the moment when the PLL is engaged. Obviously, the PLL has to be engaged once

the oscillator has reached its steady state and before the APIC.

4. Frequency demodulation

When the tip is located far from the surface,

ω0 = ω0. Once approached close enough

from it,

ω0 starts decreasing. Meanwhile, the NCO produces ωnco(ti) = ωcent + K0uf (ti),
f

as mentioned above. When the frequency tracker is disengaged, ωcent is kept constant and

matches the resonance frequency of the free cantilever, ωcent = ω0. Therefore K0uf (ti) is

f

13

nothing but the instantaneous frequency shift (actually 2π × ∆f ) of the tip interacting with

the surface. In other words :

ωcent + K0uf (ti) − ω0 = 2π∆f (ti)

(17)

K0 is a key parameter of the PLL. It sets its capability to get locked to the input signal and

in turn it sets its stability. R.Best deﬁnes K0 from the locking range ∆ωl of the PLL, e.g. the

frequency gap with respect to the center frequency the PLL can detect remaining locked9.

On the hardware level, the control signal uf (t) is limited to a range which is smaller than

the supply voltages, usually ±5V. Assuming ufm and ufM be the minimum and maximum

values allowed for uf , Best deﬁnes K0 as :

K0 =

3∆ωl
ufM − ufm

(18)

Therefore K0 is related to the maximum frequency shift detectable per volt within the

detection range of the low pass ﬁlter. Practically, the value of K0 is not accessible a priori.

It’s easier to set the locking range ∆ωl. For an oscillation at f0 = 150 kHz, frequency shifts

of about a few hundreds of hertz are typically expected40. We can therefore choose the

3 kHz FIR low pass ﬁlter to insure a proper detection of ∆f , which sets the locking range to
∆ωl = 2π × 6000 rad.s−1. The maximal value of K0 expected is then ≃ 11000 rad.V−1.s−1,

which is an excellent estimate as detailed in section V.

5. Frequency tracker

pass ﬁlter output :

The frequency tracker is a speciﬁc feature of our digital PLL. When engaged (switch 2

set to location “b” in ﬁg.1), the center frequency is continuously updated by the FIR low

ωcent(ti) = ωcent(ti−1) + K0uf (ti)

(19)

The updating frequency is 2.5 kHz. The frequency tracker has been implemented in order

to compensate the fact that the frequency demodulation was performed via the lone propor-

tional gain K0. Thus, as mentioned before, K0uf (ti) can be interpreted as the error signal

14

produced in the frequency detection compared to ωcent. Consequently, this error is also inte-

grated by the NCO, which leads to an additional phase lag added to ϕnco at each PLL cycle

and previously referred to as ϕpll. ϕpll per PLL cycle can approximately be estimated to :

∆ϕpll = ϕpll(ti+1) − ϕpll(ti) ≈ K0uf (ti) × ∆ts1

(20)

ϕpll would be zero if no frequency shift occurred, which is the case in most of the applications

using PLLs. But while approaching, ∆f decreases continuously, therefore so does ϕpll. On

the contrary, when the frequency tracker is engaged, ωcent is continuously updated. The

error in the frequency detection drops to zero. More exactly, it is equal to the diﬀerence

between two consecutive values of ωcent : ǫ ≃ ωcent(ti) − ωcent(ti−1), but is necessarily small

and so is ϕpll.

To assess how sensitive to frequency changes the phase is, the following experiment is

carried out. A 150 kHz sinusoidal waveform is generated by means of a function generator

and sent to the real PLL. The frequency is then slowly detuned from −150 Hz up to +150 Hz.

The phase lag between input and output waveforms, ϕpll, is recorded with a lock-in ampliﬁer

(Perkin Elmer 7280) and reported as a function of the detuning. The PLL center frequency

is ﬁxed to fcent = 150 kHz. The experiment is repeated the frequency tracker being engaged

and disengaged. Two amplitudes of the PLL input waveform are used. In this experiment,

the input waveform stands for the oscillatory motion of the cantilever and the tuning for the

shift occurring when the tip is approached towards the surface upon attractive or repulsive

forces. The results are reported in ﬁg.2. When the tracker is disengaged, the maximum

detuning corresponds to a phase lag of ±80 degrees, which means that the cantilever would

then be driven oﬀ resonance severely. On the opposite, when engaged, the phase lag reduces

(inset) to ±0.05 degree.

This feature has no consequence when the PLL is only used as a frequency demodulator

like in the self-excitation mode. On the opposite in the PLL-excitation scheme, this point is

crucial since the PLL is produces the excitation signal. Therefore particular attention has

to be paid on the way it is produced. If it is abnormally phase shifted, then the oscillation

amplitude drops and consequently apparent dissipation is generated, as shown in section V.

15

E. Block 5: phase shifter

The PS receives the sin and cos waveforms generated by the NCO. A further input to the

block is the phase lag, ϕps, ﬁxed prior to starting the experiments to make the cantilever

oscillating at f0. The PS digitally computes :

zps(ti) = sin [ϕnco(ti) + ϕpll] × cos (ϕps)

+ cos [ϕnco(ti) + ϕpll] × sin (ϕps)

= sin [ϕnco(ti) + ϕpll + ϕps]

(21)

When the system is being operated in the PLL-excitation mode, zps(t) is converted into an

analog signal by the DAC1 and multiplied by the APIC output.

F. Block 6: distance controller

The distance controller is the second digital PI controller implemented in the DSP oper-

ating at fs3. The block gets the setpoint value of the signal (∆f or damping) onto which

the control of the tip-sample distance is performed and the proportional and integral gains,

K dc

p and K dc
i

, respectively. Here, let’s assume that the reference signal is the frequency

shift, as depicted in ﬁg.1. We have arbitrarily chosen not to describe the transfer function
i have natural units (nm.Hz−1 and nm.Hz−1.s−1,

of the z-piezo drive. Therefore K dc

p and K dc

respectively). The controller is described by :

D(ti) =D(tdc) + K dc
i

p [∆fset − ∆f (ti)]

+

K dc
i

[∆fset − ∆f (tk)] ∆ts3,

Xk>dc

(22)

D(tdc) being the tip-surface distance when the DPIC is engaged.

G. Lock-in ampliﬁer

The description of the lock-in ampliﬁer implemented in the simulation does not depict

the detailed operational mode of the real lock-in which is used to monitor the phase shift

16

of the oscillator (Perkin Elmer 7280). Its purpose is to provide an easy way to estimate

the phase shift between the excitation and the oscillation. The calculation of the phase is

performed at 2.5 kHz. The buﬀer used to extract the phase therefore consists of nlock-in =

fs1/2.5 kHz = 8000 samples. The numerical code used to describe it is :

tan(ϕ(ti)) =

i
k=i−nlock-in
i
P
k=i−nlock-in

P

H. Code implementation

zbpf(tk) × sin[ϕnco(tk) + ϕpll + ϕps]

zbpf(tk) × cos[ϕnco(tk) + ϕpll + ϕps]

(23)

The numerical code has been implemented with LabViewTM 6.1, supplied by National

InstrumentsTM. It consists of a user interface where all the parameters are tunable at run-

time, like during a real experiment. The couple of integro-diﬀerential equations 2, 3, 10,

11, 12, 13, 14, 15, 16, 21 and 22 are integrated at their respective sampling frequencies.

The monitored signals are the oscillation amplitude Arms (equ.11), the frequency shift ∆f

(equ.17), the phase ϕ (equ.23) and the relative damping Γ/Γ0 −1=QK3Aexc/A0 −1, deduced

from the APIC output (equ.4). The connection to the dissipated energy per cycle Ed is given

by equation 7, that is Γ/Γ0 − 1 = Ed/Ed0 − 1.

IV. APPARENT DISSIPATION VS. MINIMUM DISSIPATION

Addressing the question of apparent dissipation requires to estimate the minimum dis-

sipation which is detectable by the instrument upon operating conditions. Beyond the

speciﬁcities of the PLL- or self-excitation modes, important parameters like quality factor

Q, temperature and bandwidth of the measurement must be considered.

We here focus on the minimum dissipated energy, δEd, due to thermal ﬂuctuations of

the cantilever when it oscillates close to a surface. Thermal driving forces are connected

to the energy dissipation by the Q factor of the cantilever. The thermal kicks introduce

ﬂuctuations of amplitude and phase and therefore ﬂuctuations of the energy dissipation.

This is true for a free cantilever, but the contribution of the thermal noise is expected to

be even more pronounced when the tip is close to the surface. Then, the ﬂuctuations of the

17

interaction force δFint have a strong inﬂuence on the nonlinear dynamics of the cantilever,

in particular when the tip is at distances involving short-range forces where the nonlinearity

is more pronounced.

The instrumental noise (cf. Ch.2 in refs.[1] and [33]), essentially due to electronic com-

ponents, is not considered and we further assume that the electronic blocks (RMS-to-DC,

PI controllers, PLL) operate perfectly. Doing so, δEd is under-estimated but the framework

of this section is to provide a ground value to be compared to the values obtained with the

simulation.

A. Connection between δEd and δFint

The ﬂuctuation of the dissipated energy per cycle can be connected to the ﬂuctuation of

damping δΓ, via equ.7 :

Besides, because Aexc = A0/Q = A0Γ0/ω0 = Fexc/kc on resonance and because the tip-
sample interaction force Fint can be treated, to ﬁrst order41, on the same level as Fexc, a

ﬂuctuation of Fint should produce, a ﬂuctuation of damping :

δEd = πkcA2
0

δΓ
ω0

δΓ
ω0

=

δAexc
A0

=

δFint
kcA0

,

δEd = πA0δFint

(24)

(25)

(26)

Consequently :

B. Estimate of δFint

For large oscillation amplitudes (that is larger than the minimum tip-surface dis-

tance, a few angstr¨oms), Fint is connected to the so-called normalized frequency shift42,
γ ≡ ∆f kcA3/2

0 /f0, via the equation43 (cf. also Ch.16 in ref.[1]) :

γ(r) ≃ 0.43

Vint(r)Fint(r),

(27)

p

18

where Vint(r) and Fint(r) are the interaction potential and force, respectively, between the

tip and the sample at a location r. The ﬂuctuation in the relative frequency shift δ∆f /f0 =

δf /f0, that is the cantilever frequency noise, due to a ﬂuctuation of Fint is then given by :

δf
f0

≃

0.43
2kcA3/2

0 s

Vint(r)
Fint(r)

δFint

C. Estimate of δf /f0

Y. Martin et al. [44], T.R. Albrecht et al. [4], H. D¨urig et al. [45] and F.J. Giessibl (Ch.2

in ref.[1]) have calculated the thermal limit of the frequency noise in frequency-modulation

technique over a measurement bandwidth B. It is given by :

Therefore, the dissipated energy due to thermal ﬂuctuations of the cantilever close to the

surface can be estimated to :

δf
f0

=

2kBT B

π3kcA2

0f0Q

s

δEd ≃ 4.6

2kBT BkcA3

0Fint(r)

s

πf0QVint(r)

The measurement bandwidth B can be estimated out of the following considerations. As

mentioned by F.J. Giessibl (cf. Ch.2 in ref.[1]), B is a function of the scan speed vs and the

distance a0 between the features which need to be resolved :

For UHV investigations, a0 is of about one atomic lattice constant, that is a few angstr¨oms.

At room temperature, due to thermal drift, atomic scale images are usually recorded at scan

speeds of about 6 lines (3 forwards plus 3 backwards) per second. Let’s consider for instance

a moderate resolution of 6 pixels per atomic period. Then, a line consisting of 256 pixels

should be acquired with a bandwidth B = 6 × 256/6 = 256 Hz.

Table I gives some estimates of the relative dissipated energy due to thermal ﬂuctuations

of the cantilever δEd/Ed0 close to the surface in the short-range or pure Van der Waals

regimes at various temperatures and for various quality factors.

In UHV at room tem-

perature, our experimental conditions, the minimum dissipated energy which is detectable

B =

vs
a0

19

(28)

(29)

(30)

(31)

Q

Interaction

Ed0

δEd

δEd/Ed0

regime

(eV/cycle)

(eV/cycle)

5000 (298◦K) VdW + short-range

7.69

0.177

VdW only

7.69

30000 (298◦K) VdW + short-range

0.141
7.25 × 10−2
5.78 × 10−2
500000 (4◦K) VdW + short-range 0.077 2.06 × 10−3
0.077 1.64 × 10−3

1.28

1.28

VdW only

VdW only

2.3%

1.8%

5.7%

4.5%

2.7%

2.1%

TABLE I: Dissipated energy of the free cantilever Ed0 (equ.7) and dissipated energy due to thermal

ﬂuctuations of the cantilever close to the surface δEd (equ.30) for various quality factors and

temperatures when Van der Waals plus short-range (equ.9) or pure Van der Waals forces (similar

equation, with U0 = 0) are considered. The cantilever parameters are A0 = 7 nm, f0 = 150 kHz,
kc = 40 N.m−1 and B = 260 Hz. The parameters of the interaction potential have been taken from
ref.[47] : H = 1.865 × 10−19 J, R = 5 nm, U0 = 3.641 × 10−19 J, λ = 1.2 ˚A, and rc = 2.357 ˚A. δEd

has been estimated at a distance r for which the two interaction regimes are clearly distinct (cf.

ﬁg.3(a)), r = 5 ˚A.

corresponds to 5% of the intrinsic dissipated energy of the free cantilever. This corresponds

to about 150 meV/cycle with typical conditions for UHV investigations carried out at room

temperature (cf. equ.7 and discussion below). Besides, as mentioned before, this value is

underestimated. A straightforward consequence is that the strength of apparent dissipation

should overcome this limit to be relevant. With a moderate quality factor in the Van der

Waals regime like in high vacuum for instance, the limit drops by almost a factor 3 (1.8%).

Thus, apparent dissipation eﬀects might occur more easily under these conditions46. At low

temperatures, in the short-range regime the ratio is 2.67%. However, this value is likely

still too high because then, the thermal drift being drastically reduced, the measurement

bandwidth can be lowered and apparent dissipation more likely to be measured.

20

V. RESULTS

A. Validation of the numerical setup

Frequency shift vs. distance curves obtained from the simulation have ﬁrst been com-

pared to the analytic expression of ∆f due to Van der Waals and Morse potentials (cf.

appendix, section A). The results are shown in ﬁg.3(a). The parameters chosen to perform

the simulation are consistent with typical parameters used during experiments performed

in UHV. The parameters of the interaction potential have been taken from ref.[47]. They

are representative of the interaction between a silicon tip and a silicon(111) facet. An ex-

cellent agreement is observed between numerical and analytic curves along the attractive

and repulsive parts of the interaction potential, thus validating the numerical scheme. The

parameters used to perform the calculation are given in the caption. Let’s also notice that

the frequency tracker was engaged.

In ﬁgs. 3(b), (c) and (d), the variations of ϕ, Arms

and relative damping, respectively are reported vs. the tip-surface separation. Phase and

amplitude remain almost constant while approaching, within, however, deviations limited

to 0.3% compared to −90 degrees and Aset

0 = 7 nm, respectively. In the repulsive part of

the potential, steep phase changes occur, but the amplitude does not dramatically drops, at

least up to ∆f = +100 Hz. Consequently, the relative damping remains constant.

B. Numerical vs. real setups

1. PLL dynamics

The dynamic behaviors of real and simulated PLLs have then been compared. The

experiment consists in locking the PLL onto a 150 kHz sinusoidal waveform according to

the same procedure than in section III D 5. The 3 kHz FIR low pass ﬁlter is used. At a

certain moment, a frequency step of +10 Hz is applied to the center frequency, resulting in

a shift of −10 Hz (ω0 + 2π∆f = ωcent). The step response is recorded for various values of

the so-called loop gain (real PLL) and various values of K0Kd (simulation). The variations

of ∆f vs. time are ﬁtted with simple decaying exponential functions, the characteristic time

of which stands for the locking time of the PLL. The results are reported in ﬁgs.4(a) and

(b). A rather long locking time is noticed for low values of the gains whereas the PLLs lock

21

faster when the gains become larger. For the latter case, the PLLs can operate up to the

limit of the locking range as shown by the oscillations.

The locking time deduced from each ﬁt is plotted as a function of the gains of both PLLs.

In order to make the curves comparable, the loop gain must be rescaled by an arbitrary

constant which depends on the electronics. The best agreement between the curves was

achieved with 91 × 103 (cf. ﬁg.5). A single master curve of the PLL dynamics can thus

be extracted. The rather good agreement between the two curves provides evidence that

the simulation reasonably describes the real component, at least within the locking range.
For values of the gains up to K0Kd = 6000 rad.s−1, the PLL is stable and able to track
frequency changes within the locking range around 150 kHz. Above 6000 rad.s−1, the PLL

introduces overshoot in the output waveform while attempting to lock the input signal.

For higher gains, the PLL is not able to properly track the input signal, even though its
frequency is within the locking range. The border is reached for K0 > 104 rad.V−1.s−1, in

good agreement with the value expected from R.Best’s criterion (cf. discussion in section

III D 4). The arrow in ﬁg.5 indicates the usual loop gain value which is chosen to perform
the experiments using the 3 kHz low pass ﬁlter, corresponding to K0Kd = 5000 rad.s−1. The

related locking time of the PLL is then ≃ 0.35 ms. For those values of gains, the locking

range is about ±400 Hz.

2. APIC dynamics

In order to extract a typical time constant of the component, similar experiments have

been carried out with the APICs. The cantilever remaining far from the surface, a step is

applied to the setpoint amplitude Aset
0

resulting in an abrupt change in Arms upon gains.

The results are reported in ﬁg.6(a, real setup) and (b, simulated setup). The curves exhibit

over- (no overshoot at all) under- (oscillating behavior) or critically damped (single over-

shoot) behaviors upon chosen gains. So as to extract the APIC response time, we focus

at curves which exhibit a single time constant, that is curves for which a weak overcriti-

cally or a critically damped response is observed (cf.

insets in ﬁgs.6(a) and (b)). This is

motivated by the controller response which is then the fastest, while preserving an overall

stable behavior. The changes in Arms are ﬁtted with decaying exponentials functions and

the related characteristic time is extracted. The variation of the so-called response time of

22

the controller (tresp) vs. gains is reported in ﬁg.7. The restriction to curves exhibiting a

single time constant is similar to restricting the analysis to a single gain of the controller48.

Thus, a single master curve which describes the dynamics of both APICs can be extracted

as well. In ﬁg.7, the Kp gain of the real controller has been rescaled to make it matching

K ac
p

(the best rescaling factor is 1/40000). tresp decreases as K ac
p

increases (being given a

single K ac

i per K ac

as shown by the plateau reached for K ac

p ). However, the controller is limited to an optimum tresp of about 2 ms
p ≃ 10−3 [49] (arrow in ﬁg.7).

So far, the origin of the saturation remains unclear. Nevertheless, a brief analysis of

the response function of the controller to a step wherein the contribution of the RMS-to-

DC converter is neglected (cf. appendix, section B) emphasizes that the dynamic behavior

can reasonably be predicted (triangles in ﬁg.7) up to 2 ms. The best agreement between

the experimental results and the model is found when considering the weak overcritically

damped regime, namely :

with :

p

tresp ≃

c +

1
c2 − ω0
2 K1K3K ac

i

,

c =

ω0
4

1
Q

(cid:18)

+ K1K3K ac
p

(cid:19)

(32)

(33)

The origin of the saturation might thus be attributed to the contribution of the RMS-to-DC

converter.

As expected, the shortest APIC response time is approximately 6 times longer than the

optimal PLL locking time, ≃ 0.35 ms. Thus the PLL should track frequency changes much

faster than amplitude changes. Therefore, with PLL gains insuring a locking time much

shorter than the APIC one, the two blocks can be considered as operating separately. Then,

no amplitude changes which would be the consequence of a bad tracking of the resonance

frequency can occur.

It might be objected that the experiments and the analysis, despite consistent, have been

performed without considering the tip-sample interaction. Regarding the PLL, the way the

dynamics is aﬀected when the tip is close to the surface has not yet been investigated. But

regarding the amplitude controller, Couturier et al. [8] have reported a theoretical analysis

of the controller stability upon the gains and the strength of the non-linear interaction in

23

the self-excitation scheme. The analysis stresses that the stability domain of the controller

shrinks when the contribution of the non-linear interaction (pure Van der Waals) increases.

Thus, a couple (K ac

i ) initially inside the stability domain might correspond to an un-
stable behavior of the controller close to the surface, thus introducing apparent dissipation8.

p ;K ac

Nevertheless, considering their parameters with a tip-surface distance ranging from inﬁnity
down to 0.8 ˚A (corresponding to ∆f . −250 Hz), that is very close to the surface for

operating in nc-AFM50, the stability domain weakly shrinks51. A similar analysis for the

PLL-excitation scheme is still lacking and should be performed for quantitative comparison

and discussion. But comparing their analysis to the tip-surface distances and frequency

shifts which are being used in this work, we believe that the contribution of the non-linear

interaction to the APIC dynamics remains weak and thus would not change drastically its

coupling to the PLL. This point is strengthened by the results given in the following section

(V C 1).

C. Apparent dissipation

1. Contribution of the PLL gains

Section V B 1 has proved that the PLL gains were controlling the PLL locking time.

Within the locking range, the higher K0Kd, the faster the PLL. The test performed here is

similar to those given in ﬁg.3. In particular, Q = 30000, K ac

to compute approach curves for various values of K0Kd. Except K0Kd, the parameters are
i = 10−4 s−1,
corresponding to tresp = 2 ms. 4 sets of K0Kd have been used, namely : 11000, 5000, 1000
and 100 rad.s−1, corresponding to locking times of ≃ 0.2 ms, 0.35 ms, 1.8 ms and > 4 ms,

p = 10−3 and K ac

respectively. Note that the two later values are almost similar or larger, respectively, than

tresp. The 3 kHz FIR low pass ﬁlter has been used and the frequency tracker has been

engaged. The results are reported in ﬁg.8.

With the four sets of data, no eﬀect on the frequency shift is observed. For K0Kd = 11000
and 5000 rad.s−1, changes in phase, amplitude and damping are noticeably similar. The

phase and the amplitude remain constant and subsequently, no damping occurs. On the
opposite, for K0Kd = 1000 and 100 rad.s−1, that is for a PLL locking time of about or larger
than the APIC one, the changes are more pronounced. With K0Kd = 1000 rad.s−1 (set 3),

24

the phase strongly varies along the repulsive part of the interaction, from −93 to −79 degrees.

Consequently, the amplitude starts dropping and the damping increases. This trend is more
pronounced with K0Kd = 100 rad.s−1, for which the phase in the repulsive regime reaches

−60 degrees, requiring the APIC to produce ≃ 14% more excitation. According to the

discussion put forward in section IV, such an eﬀect is expected to be detected if it would

occur.

Therefore, if the PLL does not lock the incoming signal fast enough, that is for locking

times of about or larger than 1 ms, corresponding approximately to tresp/2, an undesirable

phase shifted signal is produced, resulting in an amplitude decrease and producing signiﬁcant

apparent dissipation.

It’s peculiar to notice that, when the cantilever is driven out of resonance as shown
with the phase changes with K0Kd = 100 rad.s−1, no abnormal frequency shift occurs.

As a matter of fact, close to the resonance, the phase changes of the free cantilever scale
as, to ﬁrst order : ϕ u→1= π/2 − 2Q(u − 1), where u = f /f0. Considering f0 = 150 kHz
and δϕ = ±30 degrees, then δf = f0δϕ/2Q = ±1.3 Hz, which is not visible in ﬁg.8(a).

Similar eﬀects have been reported by H.H¨olscher et al. [52]. This eﬀect should be more

(less) pronounced with low (high) Q values (±8 Hz or ±0.08 Hz with Q = 5000 or 500000,

respectively) and the apparent dissipation higher (lower).

2. Contribution of the frequency tracker

As mentioned in paragraph III D 5, the frequency tracker updates ωcent with the goal to

prevent the phase due to the frequency shift, ϕpll, be added to the NCO output. Figure

9 reports two approach curves computed upon the frequency tracker is engaged or not.

When it is disengaged, the phase continuously decreases along the attractive part of the

interaction potential, as expected from equ.20. At a tip-sample separation corresponding
to the minimum of the interaction potential, r = 2.35 ˚A, the phase reaches −120 degrees,

meaning that the oscillator is then seriously driven out of resonance. Following the phase

change, the amplitude continuously decreases and the damping strives to compensate the

amplitude reduction, thus reaching 15% of the intrinsic damping of the free oscillator. Here

again, such an eﬀect should be measurable. When the tip is further approached towards

the surface, the repulsive regime makes the frequency shift increasing and so does ϕpll. The

25

amplitude increases back to reach Aset

0 and the damping is obviously reduced. An amplitude
growth is not expected in the repulsive region of the interaction potential, but it is the

consequence of the bad tracking of the resonance frequency. On the other hand, when

the tracker is engaged, as already mentioned, the phase remains constant and no apparent

dissipation occurs.

D. Scan lines

In addition to the analysis of the time constant of the various blocks, it is important to

focus at variables changes when the tip is scanned along a surface. Two types of surfaces

have been investigated : 1- a sinusoidally corrugated surface with a spatial wavelength of
6.6 ˚A and a corrugation of ±0.1 nm, consistently with the lattice constant of KBr, a sample

regularly used in the group, and 2- a surface with two opposite steps with a step height of
3.3 ˚A. The steps are built out of arctan functions and spread out laterally over 5 ˚A. The

upper terrace spreads out over 3 nm (cf. insets in ﬁg.12).

The results shown here have all been obtained by ∆f regulation. The scan lines have

been initiated from the approach curve shown in ﬁg.3 with ∆fset = −60 Hz, corresponding
to an initial tip-surface separation of about 5 ˚A, that is in the short-range regime (cf.

ﬁg.3(a)). The gains of the distance controller have been chosen in order to insure a critically

damped response of the controller to a step of −1 Hz when ∆fset is reached, namely K dc
2 × 10−3 nm.Hz−1 and K dc

p =
i = 2 nm.Hz−1.s−1. For all of the following curves, the frequency
tracker has been engaged. Three sets of parameters have been varied : the PLL gains, the

scan speed and the APIC gains.

1. Contribution of the PLL gains

Paragraph V B 1 has proven how K0 and Kd gains were controlling the PLL locking

time. Figure 10 shows scan lines computed for three values of K0Kd, namely : 100, 1000
and 5000 rad.s−1, corresponding to locking times > 4, 1.8 and 0.35 ms, respectively. The
i = 10−4 s−1. The
unchanged parameters are : scan speed = 7 nm.s−1, K ac
latter gains correspond to tresp ≃ 2 ms (arrow in ﬁg.7). Each signal, namely topography,

p = 10−3 and K ac

∆f , ϕ, Arms and relative damping, consists of 256 samples. The topography signal follows

26

accurately the surface corrugation. No contribution due to the gains is revealed. ∆f is

modulated around ∆fset = −60 Hz, with an amplitude ranging from ±2 to ±3 Hz upon

K0Kd. The accuracy of the distance control is then of about 97%. Note also that the

nonlinear interaction makes the modulation asymmetric around ∆fset and the maxima are

mismatched compared to the maxima of the surface. However, the mismatch does not

depend on K0Kd. If the PLL is slow, a rather important phase lag is observed, ranging from

−65 to −110 degrees, resulting in small amplitude changes. Here also, the asymmetry around

−90 degrees is manifest and it’s interesting, despite expected, to notice the doubling in the

periodicity of the amplitude ﬂuctuation. The related relative apparent damping ﬂuctuates

accordingly, reaching about 12%Γ0, which should be experimentally detectable.

2. Contribution of the scan speed

Five scan speeds ranging from 1 to 20 nm.s−1 have been used, accordingly to typical exper-
imental values for such a scan size. The unchanged parameters are : K0Kd = 5000 rad.s−1,
i = 10−4 s−1. The surface with opposite steps has been used and each
K ac
signal consists of 256 samples. The results are given in ﬁg.11. At high speed, the topography

p = 10−3 and K ac

channel starts being distorted as a consequence of a bad distance regulation as shown by the

large ∆f variations. The phase varies accordingly, but within a narrower domain. Therefore

neither relevant variations of amplitude nor of relative damping (±2% only) are revealed.

3. Contribution of the APIC gains

Similar experiments have been carried out by varying the APIC gains. Thirteen sets of
p and K ac

K ac
i values have been used over 2 orders of magnitude for each gain. The unchanged
parameters are : scan speed = 5 nm.s−1 and K0Kd = 5000 rad.s−1. The surface with opposite

steps has been used. For those curves, each signal consists of 1024 samples. The sets of gains

have been chosen such that the response time of the controller is varied from 2 to 20 ms,

according to ﬁg.7. The results are reported in ﬁg.12. Here again, the topography signal

accurately follows the corrugation. In particular, no unwanted overshoot is observed at the

step edge despite ∆f varies signiﬁcantly. A small phase variation is observed at the step

edge. For the latter three channels, no dependence is observed upon the gains such that the

27

curves match each other. The small phase variation induces a tiny amplitude change, barely

visible in the inset of ﬁg.12(d), but the overall ﬂuctuations are weak, which corresponds to

relative damping ﬂuctuations of ±3% (worse case, tresp ≈ 20 ms). Following discussion of

section IV, this value is below the threshold limit of thermal noise, at least for experiments

carried out in UHV and at room temperature. Upon gains, a small spatial shift is observed
in the amplitude or in the relative damping signals up to a maximum value of 0.1 ˚A.

VI. DISCUSSION

The above analysis stresses ﬁve important results :

• The PLL dynamics plays a major role in the occurrence of relevant apparent damping

if the locking time is about or larger than 1 ms, that is only twice faster than the

APIC optimum response time. By “relevant damping”, we mean, on the base of the

discussion given in section IV, a damping which would be detectable experimentally

upon operating conditions (cf. table I).

• The frequency tracker, the aim of which is to update the PLL center frequency to make

it matching the actual resonance frequency, plays also a major role in the occurrence

of apparent damping. It has to be mandatorily engaged when performing approach-

curves, otherwise unwanted additional phase shift due to the PLL occurs and the

cantilever is then driven oﬀ resonance.

• The PLL optimal locking time is about 0.35 ms that is 6 times shorter than the

shortest APIC response time of the free cantilever. Therefore the resonance condition

is expected to be always properly maintained. Consequently, when the PLL operates

properly, no amplitude changes due to a bad tracking of the resonance frequency are

expected to occur. If they would, this should rather be the consequence of the APIC

and/or the DPIC dynamics.

• The APIC response time seems to be limited to tresp ≃ 2 ms due to the RMS-to-DC

converter. There is a priori no fundamental restriction to the APIC response time,

as shown by ﬁg.7. However, it must be stressed that if the APIC is made faster, the

PLL should be made faster accordingly.

28

• A weak contribution of the APIC to apparent dissipation is observed. Although spatial

shift and apparent dissipation can conditionally be generated, the overall strength of

the eﬀect remains weak and should hardly be measurable for UHV investigations at

room temperature.

In order to compare our results to other works, the contribution of the noise (equ.30)

to the dissipation has been estimated with the parameters given by Gauthier et al. [7].

The maximum of relative apparent damping they report is about 5% (cf. ﬁg.4 in the
above reference, curve ♯6), corresponding to a scanning speed of about 90 ˚A.s−1. The
spatial wavelength of their surface model being 8˚A, the bandwidth of the corresponding

measurement is B ≃ 11 Hz (cf.
equ.31). The non-linear interaction is depicted by a
Rydberg function with U0 = 4 × 10−11 J, λ = 0.599 ˚A and rc = 3 ˚A. With A0 = 1.5 nm,
f0 = 159154 Hz, kc = 26 N.m−1, Q = 24000 (Ed0 = 4.8 × 10−2 eV/cycle), we get δEd/Ed0 ≃
2.3% at a distance53 s = 4 ˚A. Therefore, due to the use of a low amplitude54, the strength

of the eﬀect would not be balanced by the noise and could be detectable experimentally.

On the opposite, considering smaller scan speeds, the maximum of apparent dissipation

decreases down to 2%. Such eﬀects become then unlikely to be observed experimentally.

Finally, let’s note that the contribution of the third controller, the DPIC, has not been

assessed in this work. Nevertheless, as mentioned by H. Hug and A. Baratoﬀ [31], in or-

der to minimize feedback errors and resulting image distortions, the time constant of the

distance controller must be shorter than the speed in the fast scanning direction / lateral

extent of the smallest feature to be resolved and necessarily (much) larger than other time

constants (RMS-to-DC, APIC, PLL). If those conditions are satisﬁed, then its contribution

to the overall stability of the setup should be weak. This is what is readily seen in ﬁgs.10,

12 and, to a certain extend in ﬁg.11, with reasonable speeds. This is also conﬁrmed by

Couturier et al. who have recently found out that the distance controller had no eﬀect on

the stability diagram in the self-excitation scheme and that only the amplitude controller

played a role55,56.

To summarize, this analysis has emphasized that a maximum of about 15% of apparent

dissipation, mainly due to the PLL and not to the APIC, could be generated (cf. ﬁg.10).

The contribution of the APIC, within the range of gains used, is systematically smaller. We

ﬁnally infer that, with our setup (UHV and room temperature) and under typical experimen-

29

tal conditions (scanning speed, PLL and APIC gains...) corresponding to Ed0 ≃ 2 eV/cycle,

apparent dissipation in the range of a few eV per cycle, as frequently reported in the litera-

ture, is unlikely to occur. A striking example is provided by R. Hoﬀmann et al. [18] who put

in evidence a dissipation of 3 eV/cycle on a NiO(001) sample, despite operating at 4 K [57].

This strongly suggests the interpretation of the experimental damping images in terms of

“physical” dissipation.

VII. CONCLUSION

The realization and successful testing of a modular nc-AFM simulator implemented with

LabViewTM is reported. The design is based on a real electronics which includes a digital

PLL, the output of which is used to detect the frequency shift but also to generate the time

dependent phase of the excitation signal. Good agreement is obtained between the locking

behavior of the real PLL and the PLL from the simulator. The optimum locking time of the

PLL is found to be about 0.35 ms. The behavior of the amplitude controller is also found

to correctly describe the real setup with an optimum response of 2 ms. The analysis of the

time constants of the former two components provides evidence that the electronics tracks

properly the cantilever dynamics if the PLL runs more than twice faster than the amplitude

controller. When the system is operated with properly chosen parameters, frequency shift

vs. distance curves successfully compare to an analytic expression which ignores the ﬁnite

response of the electronics. No phase deviation resulting in apparent dissipation occur if

the center frequency of the PLL tracks the resonance frequency shifted by the tip-sample

interaction. An estimate of the minimum dissipation expected to be detected experimen-

tally gives some insights on the relevance of apparent dissipation which can conditionally

be generated numerically. This provides a framework to discuss the overall contribution of

apparent dissipation during experiments. Computations of scan lines show that when the

system is operated with experimentally relevant parameters, the contribution of the propor-
tional and integral gains of the amplitude controller and the scan speed (up to 20 nm.s−1)

do not lead to signiﬁcant apparent dissipation. To give orders of magnitude, the worse situ-

ation (frequency tracker disengaged) leads to a maximum of 15% more dissipation than the

intrinsic dissipation of the free cantilever. This is below the values which are experimen-

tally reported. This strongly suggests that nc-AFM damping images mainly reﬂect physical

30

channels of dissipation and not electronics artifacts.

Besides Ref.56, two publications dealing with the implementation and/or performance of

“virtual force microscopes” have appeared recently. These simulation codes are analogous

to ours but diﬀer in detail. Kokavecz et al.60 proposed and tested a numerical scheme de-

signed to produce response times of the whole simulated setup, as well as of separate blocks

(amplitude, phase and distance controllers) as short as 0.1 ms. Trevethan et al.61 used the

scheme described in Ref.33 to compute ﬁngerprint-like responses in the frequency shift, the

minimum tip-sample distance and the damping signal caused by an atomic-scale conﬁgu-

ration change at the surface of the sample. This change was ﬁrst predicted from atomistic

simulations and then induced upon approach under distance control down to a judiciously

chosen frequency setpoint. A manual describing the combined atomistic simulation30 and

virtual force microscope codes is now available online62.

Acknowledgments

The authors acknowledge the Swiss National Center of Competence in Research on

Nanoscale Science and the National Science Foundation for ﬁnancial support. They are

grateful to R. Bennewitz (Mac Gill Univ., Canada), C. Loppacher (Dresden Univ., Ger-

many), to colleagues of the electronics workshop of the University of Basel for discussions and

advices, in particular Ch. Wehrle H.-R. Hidber and M. Steinacher, to S. Gauthier, J. Polesel-

Maris and X. Bouju (CEMES, France) for stimulating discussions on noise, H. Hug, N. Pilet

and T. Ashworth (Basel Univ.) for discussions on the frequency tracker and to G. Couturier

for having provided a copy of his poster presented at the 2004 nc-AFM conference (Seattle,

USA).

31

1 S. Morita, R. Wiesendanger, and E. Meyer. Noncontact Atomic Force Microscopy. Springer,

2 R. Garcia and R. P´erez. Dynamic atomic force microscopy methods. Surf. Sci. Repts., 47:197–

Berlin, Germany, 2002.

301, 2002.

3 F.J. Giessibl. Advances in atomic force microscopy. Rev. Mod. Phys., 75:949–983, 2003.

4 T.R. Albrecht, P. Gr¨utter, D. Horne, and D. Rugar. Frequency modulation detection using

high-Q cantilevers for enhanced force microscope sensitivity. J. Appl. Phys., 69:668, 1991.

5 U. D¨urig, O. Z¨uger, and A. Stalder. Interaction force detection in scanning probe microscopy:

Methods and applications. J. Appl. Phys., 72(5):1778, 1992.

6 M. Guggisberg, M. Bammerlin, C. Loppacher, O. Pfeiﬀer, A. Abdurixit, V. Barwich, R. Ben-

newitz, A. Baratoﬀ, E. Meyer, and H.J. G¨untherodt. Separation of interactions by non-contact

force microscopy. Phys. Rev. B, 61:11151, 2000.

7 M. Gauthier, R. P´erez, T. Arai, M. Tomitori, and M. Tsukada. Interplay between nonlinearity,

scan speed, damping and electronics in frequency modulation atomic force microscopy. Phys.

Rev. Lett., 89(14):146104, 2002.

8 G. Couturier, R. Boisgard, L. Nony, and J.-P. Aim´e. Noncontact atomic force microscopy:

stability criterion and dynamical responses of the shift of frequency and damping signal. Rev.

9 Roland E. Best. Phase Locked Loops: Design, Simulation and Applications. Mc Graw-Hill, New

Sci. Instr., 74(5):2726–2734, 2003.

York, 4th edition edition, 1999.

10 This can readily be seen by considering the simple case of the free cantilever. If exciting at the

resonance frequency, the oscillation amplitude matches the maximum of the Lorentzian curve,

but if the excitation frequency changes, due to any reason, the amplitude decreases.

11 B. Gotsmann, C. Seidel, B. Anczykowski, and H. Fuchs. Conservative and dissipative tip-sample

interaction forces probed with dynamic afm. Phys. Rev. B, 60(15):11051, 1999.

12 C. Loppacher, M. Bammerlin, M. Guggisberg, S. Sch¨ar, R. Bennewitz, A. Baratoﬀ, E. Meyer,

and H.J. G¨untherodt. Dynamic force microscopy of copper surfaces: atomic resolution and dis-

tance dependence of tip-sample interaction and tunneling current. Phys. Rev. B, 62(24):16944–

16949, 2000.

32

13 C. Loppacher, R. Bennewitz, O. Pfeiﬀer, M. Guggisberg, M. Bammerlin, S. Sch¨ar, V. Barwich,

A. Baratoﬀ, and E. Meyer. Experimental Aspects of Dissipation Force Microscopy. Phys. Rev.

B, 62(20):13674–13679, 2000.

14 R. Bennewitz, A.S. Foster, L.N. Kantorovich, M. Bammerlin, C. Loppacher, S. Sch¨ar, M. Gug-

gisberg, E. Meyer, H.J. G¨untherodt, and A.L. Shluger. Atomically Resolved Steps and Kinks

on NaCl islands on Cu(111): Experiment and Theory. Phys. Rev. B, 62(3):2074–2084, 2000.

15 B. Gotsmann and H. Fuchs. Dynamic Force Spectroscopy of Conservative and Dissipative Forces

in an Al-Au(111) Tip-Sample System. Phys. Rev. Lett., 86(12):2597–2600, 2001.

16 P.M. Hoﬀmann, S. Jeﬀery, J.B. Pethica, H. ¨Ozer, and A. Oral. Energy dissipation in atomic

force microscopy and atomic loss processes. Phys. Rev. Lett., 87(26):265502, 2001.

17 F.J. Giessibl, M. Herz, and J. Mannhart. Friction traced to the single atom. Proc. Natl. Acad.

Sci. USA, 99(19):12006–12010, 2002.

18 R. Hoﬀmann, M.A. Lantz, H.J. Hug, P.J.A. van Schendel, P. Kappenberger, S. Martin,

A. Baratoﬀ, and H.J. G¨untherodt. Atomic resolution imaging and frequency versus distance

measurements on NiO(001) using low-temperature scanning force microscopy. Phys. Rev. B,

19 O. Pfeiﬀer, L. Nony, R. Bennewitz, A. Baratoﬀ, and E. Meyer. Distance dependence of force and

dissipation in non-contact atomic force microscopy on Cu(100) and Al(111). Nanotechnology,

67:085402, 2003.

15:S101–S107, 2004.

20 S. Hembacher, F.J. Giessibl, J. Mannhart, and C.F. Quate. Local spectroscopy and atomic

imaging of tunneling current, forces, and dissipation on graphite. Phys. Rev. Lett., 94:056101,

2005.

2000.

21 M. Gauthier and M. Tsukada. Theory of noncontact dissipation force microscopy. Phys. Rev.

B, 60(16):11716, 1999.

22 N. Sasaki and M. Tsukada. Eﬀect of Microscopic Nonconservative Process on Noncontact

Atomic Force Microscopy. Japan. J. Appl. Phys., 39:L1334–L1337, 2000.

23 M. Gauthier and M. Tsukada. Damping mechanism in dynamic force microscopy. Phys. Rev.

Lett., 85(25):5348, 2000.

24 U. D¨urig. Interaction sensing in dynamic force microscopy. New Journal of Physics, 2:5.1–5.12,

25 L.N. Kantorovich. Stochastic friction force mechanism of energy dissipation in noncontact force

33

microscopy. Phys. Rev. B, 64:245409, 2001.

26 R. Boisgard, J.-P. Aim´e, and G. Couturier. Analysis of mechanisms inducing damping in

dynamic force microscopy: surface viscoelastic behavior and stochastic resonance process. Appl.

Surf. Sci., 188:363–371, 2002.

27 R. Boisgard, J.-P. Aim´e, and G. Couturier. Surface mechanical instabilities and dissipation

under the action of an oscillating tip. Surf. Sci., 511:171–182, 2002.

28 T. Trevethan and L. Kantorovich. Physical dissipation mechanisms in non-contact atomic force

microscopy. 15:S44–S48, 2004.

29 T. Trevethan and L. Kantorovich. Atomistic simulations of the adhesion mechanism of atomic

scale dissipation in non-contact atomic force microscopy. 15:S34–S39, 2004.

30 L.N. Kantorovich and T. Trevethan. General theory of microscopic dynamical response in

surface probe microscopy: From imaging to dissipation. Phys. Rev. Lett., 93:236102, 2004.

31 cf. Ch.19 and 20 in ref.[1].

32 G. Couturier, L. Nony, R. Boisgard, and J.-P. Aim´e. Stability of an oscillating tip in noncontact

atomic force microscopy: Theoretical and numerical investigations. J. Appl. Phys., 91(4):2537–

33 J. Polesel-Maris and S.Gauthier. A virtual dynamic atomic force microscope for image calcula-

34 The images reported in the reference have been obtained out of a force ﬁeld calculated between

2543, 2002.

tions. J. Appl. Phys., 97:044902, 2005.

an MgO tip and a CaF2 slab.

35 C. Loppacher, M. Bammerlin, F.M. Battiston, M. Guggisberg, D. M¨uller, H.-R. Hidber,

R. L¨uthi, E. Meyer, and H.J. G¨untherodt. Fast Digital Electronics for Application in Dynamic

Force Microscopy Using High-Q Cantilevers. Appl. Phys. A, 66:215, 1998.

36 This condition is similar to the one obtained in the self-excitation scheme, without ϕpll (cf.

37 Analog Devices: http://www.analog.com; Intersil: http://www.intersil.com/cda/home; Burr-

38 D.C. Rapaport. The Art of Molecular Dynamics Simulation. Cambridge University Press,

equ.13 in ref.[32]).

Brown: http://www.burr brown.com.

Cambridge, 1995.

http://www.nanosensors.com).

34

39 We are referring to NanosensorsTM cantilevers with 190 kHz resonance frequencies (cf.

40 This is an order of magnitude of the ∆f usually reported in the litterature for cantilevers with

k = 40 N.m−1 in UHV (Q = 30000) and at room temperature.

41 To ﬁrst order, Fint = kef f z(t), where kef f = kc + dFint/dz(t).

42 F.J. Giessibl. Forces and frequency shifts in atomic-resolution dynamic-force microscopy. Phys.

Rev. B, 56(24):16010–16015, 1997.

43 S.H. Ke, T. Uda, and K. Teakura. Quantity measured in frequency-shift-mode atomic-force

microscopy: An analysis with a numerical model. Phys. Rev. B, 59:13267–13272, 1999.

44 Y. Martin, C.C. Williams, and H.K. Wickramasinghe. Atomic force microscope-force mapping

and proﬁling on a sub 100-˚A scale. J. Appl. Phys., 61(10):4723–4729, 1987.

45 U. D¨urig, H.R. Steinauer, and N. Blanc. Dynamic force microscopy by means of the phase-

controlled oscillator method. J. Appl. Phys., 82:3641–3651, 1997.

46 However, in the Van der Waals regime, the tip is relatively distant from the surface. No atomic

feature is expected to be observed. The bandwidth can therefore be made bigger accordingly.

47 R. P´erez, I. Stich, M.C. Payne, and K. Terakura. Surface-tip interactions in noncontact atomic-

force microscopy on reactive surfaces: Si(111). Phys. Rev. B, 58:10835–10849, 1998.

48 In the critically damped regime, it is known that Kp and Ki are not independent, but coupled

(cf. appendix, section B).

49 The scaling of the gains K ac

p and K ac
i

essentially depends on the transfer functions of the

piezo actuator K3 and of the photodiodes K1 as detailed in appendix, section B (equation 52).

Therefore, K ac

p can be chosen smaller than 1 considering K1K3 = 1 (cf. caption of ﬁg.3).

50 On the base of the work by R. P´erez with the Si(111)5 × 5 (ref.[47]), S.-H. Ke (Ch.16 in ref.[1]),

state that even at tip-surface distances of ≈ 5 ˚A, there is an onset of covalent chemical bonding

between the dangling bonds on the tip and the surface.

51 In ﬁg.3 of ref.[8], the stability domain is an K ac

by a parabola. For a tip-surface distance ranging from inﬁnity down to 0.8 ˚A, the (K ac

p chart that can qualitatively be described
p , K ac
i )
gains corresponding to the maximum of the parabola range from (61, 5.1 × 104) down to only

i vs. K ac

(55, 4.5 × 104).

52 H. H¨olscher, B. Gotsmann, W. Allers, U.D. Schwarz, H. Fuchs, and R. Wiesendanger. Mea-

surement of conservative and dissipative tip-sample interaction forces with a dynamic force

microscope using the frequency modulation technique. Phys. Rev. B, 64:075402, 2001.

53 This value corresponds to the tip-surface separation shown in ﬁg.3 in the above reference.

35

54 The amplitude dependence in equation 30 implies that δEd(A0 = 10 nm) ≃ 15δEd(A0 =

1.5 nm). But notice that the use of small amplitudes with standard cantilevers is experimentally

diﬃcult due to the degradation of the signal to noise ratio. We estimate that the smallest ampli-

tude we can reasonnably achieve with our experimental setup is 3 nm. Reaching low amplitudes

usually requires the use of a tuning fork (cf. for instance ref.[3]), the resonance frequency of

which being on the order of a few tens of kHz, that is one order of magnitude smaller than the

frequency chosen by M. Gauthier in ref.[7].

55 G. Couturier, R. Boisgard, D. Dietzel and J.-P. Aim´e, Contribution of the instrumentation to

the damping signal in nc-AFM. Poster at nc-AFM 2004 (Seattle, USA).

56 G. Couturier, R. Boisgard, D. Dietzel, and J.-P. Aim´e. Damping and instability in non-contact

atomic force microscopy: the contribution of the instrument. Nanotechnology 16:1346–1353,

2005.

57 According to the experimental parameters reported (A0 = 5 nm, kc = 43 N.m−1 and Q =

100000), Ed0 ≃ 0.2 eV/cycle. Therefore the ratio between the maximum of dissipation to Ed0

is 1500%! Even if 10% of apparent dissipation is generated, this is still weak compared to the

overall dissipation which is detected.

58 L. Nony, R. Boisgard, and J.-P. Aim´e. Stability criterions of an oscillating tip-cantilever system

in dynamic force microscopy. Eur. Phys. J. B, 24:221–229, 2001.

59 F.J. Giessibl and H. Bielefeldt. Physical interpretation of frequency-modulation atomic force

microscopy. Phys. Rev. B, 61(15):9968, 2000.

60 J. Kokavecz and Z. Toth and Z.L. Horvath and P. Heszler and A. Mechler Novel amplitude and

frequency demodulation algorithm for a virtual dynamic atomic force microscope. Nanotech-

nology, 17:S173–S177, 2006.

61 T. Trevethan and M. Watkins and L. N. Kantorovich and A. L. Shluger and J. Polesel-Maris and

S. Gauthier. Modelling atomic scale manipulation with the non-contact atomic force microscope.

Nanotechnology 17:S5866–S5874, 2006.

62 www.cmmp.ucl.ac.uk/~lev/codes/SciFi/manual_3_51/index.html

36

Appendices

A. The analytical method

The analytical method gives analytical, tractable expressions of the frequency shift versus

distance upon the force expression. Couple of years ago, F.J. Giessibl and M.Guggisberg

have proposed approached expressions for the frequency induced by a Morse potential6,42.

Here a complete expression is provided. The following calculation is based on a variational

method extensively detailed in former articles58. We start from equation 2 and postulate a

solution of the diﬀerential equation where the amplitude and the phase are not constant,

but are allowed to vary slowly within time, that is over durations much longer than the

oscillating period, namely :

Equation 2 is then equivalent to :

z(t) = A(t) cos [ωt + ϕ(t)]

with :

α cos (ϕ(t)) − β sin (ϕ(t)) = γ

β cos (ϕ(t)) + α sin (ϕ(t)) = 0






α = ¨A(t) + ω0
Q

˙A(t) +

0 − [ω + ˙ϕ(t)]2
ω2

β = A(t) ¨ϕ(t) +

γ = ω2

0K3Aexc

2 ˙A(t) + ω0
(cid:8)
h

i

Q A(t)

[ω + ˙ϕ(t)] + 2
(cid:9)
m

˜Fc
A(t) + 2
m
˜Fd





˜Fc and ˜Fd are the ﬁrst Fourier components of the conservative and dissipative forces expe-

rienced by the tip over one oscillation period T , respectively :

(cid:26)Z
Setting ˙A(t) = ¨A(t) = ˙ϕ(t) = ¨ϕ(t) = 0 yields to the steady equations of the oscillator in

(cid:27)

amplitude and phase out of which the relevant variables, namely ∆f = f − f0 and driving

amplitude, related to the damping, can be extracted :

˜Fc =

˜Fd =

∂A

1
T
1
T A

T

Vint(t)dt

0

(cid:26)Z
∂ϕ

T

0

(cid:27)

Vd(t)dt

37

(34)

(35)

(36)

(37)

(38)

˜Fc = kcA

∆f
f0

 

−

˜Fd
kcA

f + 2f0Q
2f0Q tan(ϕ) !

˜Fd =

kcAf
2f0 

A

1 + ∆f
f0
(cid:16)



K3Aexc

(1 + 1/ tan(ϕ))

−

1
Q



(cid:17)
Equation 39 illustrates that, if the phase is properly maintained at −π/2 rad, the frequency

shift is essentially due to the conservative interaction, whatever the dissipative contribution.

Besides, equ.39 gives the well known expression of the frequency shift due to the conservative

contribution59 :

The expression of ˜Fc related to the Morse potential given in equ.9 can be integrated analyt-

∆f
f0

=

˜Fc
kcA

ically :

where :

SMorse

int =

V Morse
int

(t)dt = −

2Υ0,1/λ − Υ0,2/λ

,

2πU0
ω

(cid:0)

(cid:1)

2π
ω

0

Z

Υα,β = e−β(D−rc) × BesselI(α, βA)

BesselI(α, βA) is the modiﬁed Bessel function of ﬁrst kind for the parameters α and βA. As

shown by equ.37, the method not only requires to estimate the action related to SMorse

, but

int

also its derivative with respect to the amplitude A :

Regarding the Van der Waals contribution, it was demonstrated58 :

(cid:1)

∂ASMorse

int = −

Υ1,1/λ − Υ1,2/λ

4πU0
ωλ

(cid:0)

∂ASVdW

int = −

πHRA
3ω (D2 − A2)3/2

The frequency shift due to both contributions can ﬁnally be deduced :

(39)

(40)

(41)

(42)

(43)

(44)

(45)

∆f
f0

= −

1
kcA "

HRA
6 (D2 − A2)3/2 +

2U0
λ

Υ1,1/λ − Υ1,2/λ

(46)

(cid:0)

#

(cid:1)

38

B. APIC response time

The problem consists in analyzing the dynamics of the oscillator the amplitude of which

is controlled by a proportional-integral controller. For that purpose, all the components are

assumed to be linear. No interaction occurs between the oscillator and the surface. The

contributions of the RMS-to-DC and of the band pass ﬁlter are neglected. The system under

investigation is given in ﬁgure 13.

1. Transfer function of the closed loop

We start from the set of equations 35 wherein the phase is assumed to be constant and

ﬁxed to ϕ(t) → ϕ = −π/2. This assumption is argued by the PLL behavior which maintains

the phase almost constant, even when the interaction occurs (cf. ﬁg. 3(b)). The assumption

implies : ω = ω0,

˙ϕ(t) = ¨ϕ(t) = 0 and obviously, we only focus at changes occurring in the

resonance amplitude A(t) = A0(t). The set of equations 35 is then equivalent to :

The transfer function of the block standing for the oscillator can thus be written :

Keeping β = γ yields to :

where :

˙A0(t) =

K3Aexc −

A0(t)
Q

(cid:27)

Gosc(s) =

= K1K3

K1A0(s)
Aexc(s)

b
s + a

β = γ

α = 0






ω0
2

(cid:26)

b = ω0
2
a = ω0
2Q




Gcl(s) =

p s + b ˜K ac

b ˜K ac
s2 + (a + b ˜K ac

i

p )s + b ˜K ac

i

,

39

The transfer function of the APIC being GAP IC(s) = K ac
the closed loop Gcl(s) = K1A0(s)/Aref

p + K ac
(s) can now be calculated :



0

i /s, the transfer function of

(47)

(48)

(49)

(50)

(51)

with :

˜K ac
˜K ac

p = K1K3K ac
p
i = K1K3K ac
i






The proportional and integral gains are scaled by the transfer functions of the piezoelectric

actuator and of the photodiodes, K3 and K1, respectively.

2. Analogy

Equation 51 has two poles :

where c is the parameter given in equation 33, which can also be written :

Equation 51 is thus almost analog to a standard 2nd order system, the canonical form of

which can be written :

where ωn and ζ are the characteristic frequency and damping factor of the system, respec-

s1,2 = −c ±

c2 − b ˜K ac
i ,

q

c =

a + b ˜K ac
p
2

G(s) =

ω2
n
s2 + 2ζωns + ω2
n

,

ζ =

c
b ˜K ac
i

q
Now, it’s well known that the position of ζ with respect to 1 deﬁnes the overall behavior of

tively. Thus :

the system :

(52)

(53)

(54)

(55)

(56)

(57)

Undercritically damped regime ⇒ ζ < 1 ⇔ c <

Critically damped regime ⇒ ζ = 1 ⇔ c =

Overcritically damped regime ⇒ ζ > 1 ⇔ c >

b ˜K ac
i

q
b ˜K ac
i

q

b ˜K ac
i

q





40

3. Analysis to a step response

To assess how fast the controller reacts, we investigate the response of the controller

to a step in amplitude upon it is in the over-, under- or critically damped regime. Let’s

assume a step of amplitude As, the corresponding transfer function is Gs(s) = As/s and

the transfer function of the closed loop system to which the step is applied is therefore

Gcls(s) = Gs(s) × Gcl(s), that is :

Gcls(s) =

Asb ˜K ac
p
(s + c)2 − c2 + b ˜K ac
i

+

Asb ˜K ac
i
(s + c)2 − c2 + b ˜K ac
i

×

1
s

The time-dependent solutions gcls(t) = L−1{Gcls(s)} are :

• Overcritically damped regime : c >

b ˜K ac
i

q

gcls(t) = As

1 + ς−e−(c+ξ)t − ς+e−(c−ξ)t

with ς± = (c ± ξ − b ˜K ac

(cid:8)
p )/2ξ and ξ =

c2 − b ˜K ac
i .

(cid:9)

• Critically damped regime : c =

q
b ˜K ac
i

n

q
gcls(t) = As

1 − e−ct +

te−ct

p − c

b ˜K ac
h

i

o

• Undercritically damped regime : c <

b ˜K ac
i

gcls(t) = As

(

q
1 − e−ct ×

cos (ξ′t) +
"

c − b ˜K ac
p
ξ′

sin (ξ′t)

#)

with ξ′ =

b ˜K ac

i − c2.

q

4. Summary

The transition from the over to the under critically damped regime is thus controlled by
b ˜K ac
i

the parameter c, that is the proportional gain, and occurs when the condition c =

q
is fulﬁlled. In the critically damped regime, the relationship between the two gains is :

˜K ac

i =

ω0
8

1
Q

+ ˜K ac
p

2

(cid:19)

(cid:18)

41

(58)

(59)

(60)

(61)

(62)

The time constant of the system can be extracted upon the regime and the time scale that

are considered. For short time scales, the response time of the controller is typically 1/c in

the critically damped regime and tresp = 1/(c +

i ) in the overcritically damped
regime (cf. equ.59), which is given in equation 32. Figure 7 shows that the response times of

q

c2 − b ˜K ac

the real system and of the simulated machine reasonably match tresp while the RMS-to-DC

converter has a negligible inﬂuence on the system dynamics.

42

Figures

FIG. 1: Scheme of the simulator operating in nc-AFM, based on the design of the electronics of

the real apparatus.

43

FIG. 2: Phase shift between a 150 kHz sinusoidal waveform sent to the real PLL and the PLL

output waveform (fcent = 150 kHz) when tuning the input frequency from −150 to +150 Hz upon

the frequency tracker is engaged or not. The 3kHz FIR low pass ﬁlter has been used. When the

tracker is disengaged, the phase lag can reach ±80 degrees (continuous black line, amplitude of the

input waveform : Aw = 110 mV peak-to-peak). When it is engaged, the phase lag drops to almost

zero (dotted black line and inset, similar input waveform). When the input frequency accurately

matches the center frequency, the shift is zero (modulo an error corresponding to a few fractions

of degrees as shown in the inset).

44

FIG. 3: Numerical approach curves. The parameters are Aset
0 = 7 nm, f0 = 150 kHz, kc =
30 N.m−1, Q = 30000, therefore Γ0 = 31.4 s−1 and Ed0 = 0.96 eV/cycle, K1 = 0.1 V.nm−1,
i = 10−4 s−1, approach
K3 = 1/K1 nm.V−1, Kd = 1 V, K0 = 5000 rad.V−1.s−1, K ac
speed 2 nm.s−1. The parameters of the interaction potential have been taken from ref.[47] :
H = 1.865 × 10−19 J, R = 5 nm, U0 = 3.641 × 10−19 J, λ = 1.2 ˚A, and rc = 2.357 ˚A. Except in

p = 10−3, K ac

(a), the signals are monitored at 10 kHz. (a)- Comparison between the ∆f computed numerically

(open circles) and the analytic expression of ∆f (thick grey line) due to Van der Waals and Morse

interactions (equ.46). The two curves match accurately along the attractive and repulsive parts

of the interaction potential. For clarity reasons, 10 times less samples are displayed compared to

plots shown in (b), (c) and (d). The dotted line depicts the analytic ∆f due to a pure Van der

Waals potential, thus showing where the short- and long-range interaction regimes are discernable.

(b)- Phase lag, ϕ. The frequency tracker being engaged, the phase remains constant and equal to

−90 degrees within deviations limited to 0.3%, thus maintaining the cantilever driven on resonance.

(c)- Amplitude Arms(t)/K1. Since no phase variation occur, the amplitude remains constant as

well throughout the approach. (d)- Relative damping.

45

FIG. 4: (Color online) Step response of the real (a) and of the simulated (b) PLLs to a center

frequency step of +10 Hz at fcent = 150 kHz, resulting in a ∆f of −10 Hz. For this experiment, no

interaction between the tip and the surface occurs. The various curves represent the experiments

carried out for various values of the related gains of the PLLs denoted by the symbols. The PLL

output is recorded at 10 kHz. The curves are ﬁtted with a decaying exponential (thick continuous

lines) out of which the PLL “locking time” is extracted. They are displayed over similar relative

ranges.

46

FIG. 5: Locking time of the simulated (ﬁlled squares) and real (empty circles) PLL vs. K0Kd and

loop gain×91000. The locking times are obtained from the related step response curves (ﬁgs.4(b)

and (a), respectively). The error bars depict the uncertainty on the ﬁtted value of the locking time

(±10%). The arrow indicates the value of the loop gain used experimentally which corresponds to

an optimum behavior of the PLL and a related locking time of about 0.35 ms. The curve is given

as guide eyes.

47

FIG. 6: Step response of the real (a) and of the simulated (b) APIC to a Aset
0

step. To perform

the experiments, the related PLLs are engaged (frequency trackers as well). The 3 kHz FIR low

pass ﬁlter has been used. No interaction between the tip and the surface occurs. The cantilever

properties are f0 = 157514.6 Hz and Q = 36000. To perform the calculation, since the cantilever
stiﬀness was not accurately known, we have arbitrarily chosen kc = 30 N.m−1, in reasonable

agreement with manufacturer’s datasheet. The other numerical parameters are similar to those

given in ﬁg.3. The curves depict the experiments carried out for various values of K ac

p and K ac
i

gains. Three behaviors are observed : overcritically damped responses without overshoot, critically

damped responses with a slight overshoot and undercritically damped responses with an oscillating

behavior. The insets show them for couple of curves which have been arbitrarily shifted along the

time axis, but note that the relative ranges are similar.

48

FIG. 7: Response time of the APIC vs. K ac

p of the simulated setup and the rescaled Kp gain of the

real controller. The best agreement between the curves is obtained with Kp/40000. The two curves

match with a reasonable agreement and exhibit two domains : ﬁrst the response time decreases

when increasing K ac

p and then a saturation is reached corresponding to tresp ≃ 2 ms. The dotted

line is given as guide eyes. Such an analysis can be performed assuming that the step response is

governed by a single time constant, thus restricting the analysis to curves which exhibit an almost

critically damped behavior (cf. text). The triangles depict the trace of the function tresp (equ.
32) with f0 = 157514.6 Hz, Q = 36000, K1 = 0.1 V.nm−1 and K3 = 1/K1 nm.V−1. The arrow
p = 10−3, a

denotes the value of the gain used to perform the scan lines (cf. section V). Beyond K ac

noticeable discrepancy between the theoretical model and the experiments is observed which might

be due to the contribution of the RMS-to-DC converter.

49

FIG. 8: Approach vs. distance curves for various sets (1 to 4) of K0Kd of the Pll gains, namely :
11000 (continuous black line), 5000 (continuous grey line), 1000 (dotted black line) and 100 rad.s−1

(dotted grey line), corresponding to locking times of 0.2, 0.35, 1.8 and > 4 ms, respectively. (a)-

∆f , the curves are all matching each other. (b)- Phase lag ϕ, (c)- amplitude Arms(t)/K1 and (d)-

relative damping. Except K0Kd, the parameters are similar to those given in ﬁg.3, in particular
i = 10−4 s−1 corresponding to tresp ≃ 2 ms. When the PLL locking time is

p = 10−3 and K ac

K ac

larger than tresp (set 4, K0Kd = 100), the resonance is not properly locked, which induces a phase

shift. Consequently, the amplitude decreases and the damping increases.

50

FIG. 9: Approach vs. distance curves upon the frequency tracker of the PLL is engaged or not (grey

or black lines, respectively).(a)- Frequency shift ∆f , (b)- phase lag ϕ, (c)- amplitude Arms(t)/K1

and (d)- relative damping. The parameters are similar to those given in the caption of ﬁg.3. When

not engaged, the phase continuously drifts during the approach due to the increase of the attractive

interaction meaning that the oscillator is not driven on resonance. Subsequently, the amplitude

drops and the APIC strives to keep it constant by increasing the excitation. 15% more excitation

is thus produced, that is above thermal noise (cf. section IV).

51

FIG. 10: Calculated cross-section of a sinusoidally corrugated surface for various PLL gains, namely
K0Kd = 100 rad.s−1 (continuous black line), 1000 rad.s−1 (continuous grey line) and 5000 rad.s−1

(dotted black line). The scan lines have been initiated from the approach curve shown on ﬁg.3 by
∆f regulation using ∆fset = −60 Hz. The lateral scan speed is 7 nm.s−1 and the section consists
i = 2 nm.Hz−1.s−1, corresponding to a critically

p = 2 × 10−3 nm.Hz−1 and K dc

of 256 samples. K dc

damped response of the controller to a frequency step of −1 Hz. (a)- Topography. (b)- Frequency

shift. (c)- Phase lag ϕ. (d)- Amplitude Arms/K1 and (e)- relative damping. No noticeable eﬀect is

revealed on the topography. The apparent dissipation remains below the thermal noise (cf. section
IV), except if the PLL is slow (K0Kd = 100 rad.s−1, 12%).

52

FIG. 11: Calculated cross-section of a surface with two opposite steps for various scanning speeds,
namely 1 ((cid:4)), 2 (•), 5 (△), 10 (+) and 20 nm.s−1 (◦). For clarity reasons, the right hand side

step region has been magniﬁed. The insets show the whole section. The scan lines have been
p = 10−3 and
initiated upon the same conditions than in ﬁg.10 with K0Kd = 5000 rad.s−1, K ac
i = 10−4 s−1. The high speeds require to reduce the number of samples per line to 256. The

K ac

gains of the distance controller are similar to those given in ﬁg.10. (a)- Topography. (b)- Frequency

shift. (c)- Phase lag ϕ. (d)- Amplitude Arms/K1 and (e)- relative damping. At high scan speeds,

the topography is slightly distorted, but the overall damping remains weak and below the thermal

noise (cf. section IV).

53

p = 10−2; K ac

FIG. 12: Calculated cross-section of a surface with two opposite steps for various sets of the
i = 10−3 s−1) = ◦, (10−3; 10−3) = ⋄, (10−2; 10−2) = ×,
APIC gains, namely (K ac
(10−3; 10−2) = +, (10−2; 10−4) =△, (10−3; 10−4) = •, (10−4; 10−4) = (cid:4), (10−4; 10−3) = (cid:7),
(10−3; 10−5) = N, (10−2; 10−5) = H and (10−4; 10−5) = ⊙. The scan lines have been initiated
upon the same conditions than in ﬁg.10 with K0Kd = 5000 rad.s−1. The lateral scan speed is
5 nm.s−1 and the section consists of 1024 samples. The gains of the distance controller are similar

to those given in ﬁg.10. (a)- Topography. (b)- Frequency shift. (c)- Phase lag ϕ. (d)- Amplitude

Arms/K1 and (e)- relative damping. The APIC gains have a negligible eﬀect on the topography. A

weak apparent damping (3%Γ0, that is not experimentally relevant) is revealed at the step if the

APIC is slow, corresponding to tresp = 20 ms.

54

FIG. 13: Simpliﬁed scheme of the closed loop for the characterization of the response time of the

APIC.

55

