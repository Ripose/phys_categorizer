5
0
0
2
 
n
a
J
 
3
1
 
 
]
h
p
-
m
s
a
l
p
.
s
c
i
s
y
h
p
[
 
 
1
v
6
6
0
1
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

PPPL–2290 (Nov. 1985)
Comp. Phys. Rep. 4(3–4), 183–244 (Aug. 1986)

Fokker–Planck and Quasilinear Codes∗

Charles F. F. Karney
Plasma Physics Laboratory, Princeton University
P.O. Box 451
Princeton, New Jersey 08544–0451, U.S.A.

Abstract

The interaction of radio-frequency waves with a plasma is described by a Fokker–Planck equation

with an added quasilinear term. Methods for solving this equation on a computer are discussed.

∗Presented at the 3rd European Workshop on Problems in the Numerical Modeling of Plasmas, Varenna, Italy, September 10–13,

1985. Reprinted in Problems in the Numerical Modeling of Plasmas, edited by K. Appert (1986).

1

I.

Introduction

In this paper, I will concentrate on those Fokker–Planck models which are most useful for the study
of rf-driven currents.1 I will therefore take the plasma to be azimuthally symmetric about the magnetic
ﬁeld and homogeneous (representative of the central portion of a tokamak plasma). The Fokker–Planck
equation then reduces to an equation in time and two velocity (or momentum) dimensions only. This
simpliﬁed model yields a wealth of interesting physics and furthermore illustrates the main numerical
problems encountered in more complicated situations. In addition to the collision term, the equation will
include the effects of externally injected rf power via a quasilinear diffusion term, and a dc electric ﬁeld.
(The electric ﬁeld arises whenever the current is time-varying, e.g., during current ramp-up.) Because
the wave interacts with very fast electrons, relativistic effects are also considered. In addition, the adjoint
method for solving for moments of the Fokker–Planck equation is discussed. This method allows for a
great reduction (by orders of magnitude) in the amount of computer time required.

The paper is divided into three parts: In the ﬁrst part of the paper, I give the formulation of the Fokker–
Planck equation. In sec. II, the Fokker–Planck equation and the coordinate systems are introduced. The
collision operator and approximations to it are given in secs. III and IV. Corresponding expressions for
the quasilinear diffusion operator are given in sec. V. The next part of the paper describes the numerical
solution of the equation. Its boundary conditions are considered in sec. VI. Sections VII and VIII describe
the spatial and temporal differencing of the equation. In sec. IX, we describe techniques for obtaining
the time asymptotic solution to the equation. The last part of the paper describes the incorporation of
relativistic effects (sec. X) and the adjoint method for solving the Fokker–Planck equation (sec. XI).

The numerical methods presented here are those used in the Fokker–Planck code used by the author.
A word about the lineage of this code is in order: Fokker–Planck codes were developed at Livermore
by Killeen et al.2,3 for the study of mirror-machine plasmas. The latest stage in the development of
these codes is FPPAC4 which is a two-dimensional multispecies nonlinear Fokker–Planck package. The
Livermore code was extensively modiﬁed by Winsor and Fallon for the study of runaway electrons, which
was undertaken by Kulsrud et al..5 This code has been used by the author in various studies of current
drive beginning with lower hybrid current drive.6 Over the years several further modiﬁcations have been
made, although the basic structure of the code is the same as that of Kulsrud etal.

The assumption of a homogeneous magnetic ﬁeld is warranted in the study of rf heating and current
drive in tokamaks if the rf interacts only with circulating particles. This is often not the case (for exam-
ple during ion- and electron-cyclotron heating) in which case proper account should be taken of trapped
particles. This has been done in so-called bounce-averaged codes7–9 in which the distribution function
is averaged over the bounce motion of the trapped particles. In tokamaks this leads to a modiﬁcation of
the coefﬁcients appearing in the Fokker–Planck equation but the numerical treatment of the equation is
largely unaltered. In machines with more complicated particle orbits, the distribution may be a multi-
valued function of the velocity coordinates. This occurs in tandem mirrors where there is more than one
population of trapped particles. In this case, special techniques are required.9

II. Preliminaries

A. The Fokker–Planck equation

We write the Fokker–Planck equation for the electrons e as

∂fe
∂t −

s
X

C(fe, fs) +

Sw +

fe = 0,

(1)

qeE
me · ∇

where qs and ms are the charge and mass of species s, C(fa, fb) is the collision term for species a
colliding off species b, the sum extends over all the species of the plasma (typically electrons and ions),

∇ ·

2

Sw is the wave (w)-induced quasilinear ﬂux, and E = Eˆvk is the electric ﬁeld (assumed to be parallel to
the magnetic ﬁeld). The quantity qs carries the sign of the charge, thus qe =
refer to the directions parallel and perpendicular to the magnetic ﬁeld. The
in velocity space.

⊥
∂/∂v operator operates

e. The subscripts

−
∇ ≡

and

k

Because collisions in a plasma are primarily due to small-angle scattering, the collision term can be

written as the divergence of a ﬂux

in which case eq. (1) can be expressed as

C(fa, fb) =

Sa/b
c

,

−∇ ·

(2)

(3)

(4)

(5a)

(5b)

(5c)

(6)

(7)

where

is the total ﬂux in velocity space, and

∂fe
∂t

+

∇ ·

S = 0,

S = Sc + Sw + Se

Sc =

Se/s
c

,

s
X
qeE
me

Se =

fe,

are the collisional (c)- and electric-ﬁeld (e)-induced electron ﬂuxes.

From eq. (2) we can derive the conservation laws

∂
∂t

fe d3v +

S

d2A = 0,

ZV
mevfe d3v +

ZA
mevS

d2A =

meS d3v,

fe d3v +

S

d2A =

mev

S d3v,

ZA

mev2
2

ZA

ZV

ZV

·

·

·

·

∂
∂t

ZV

∂
∂t

ZV
mev2
2

where V is some volume in velocity space and A is its boundary. These equations are statements of
conservation of number, momentum, and energy.

Typically, two types of terms appear in S: a diffusion term and a friction term

· ∇
The wave term is purely diffusive so that Fw = 0, while the electric ﬁeld term is nondiffusive: De = 0,

−

S =

D

fe + Ffe.

B. Coordinate systems

Because of azimuthal symmetry, fe is independent of φ the angle about the magnetic ﬁeld. Two
coordinate systems suggest themselves: the cylindrical coordinate system (v⊥, vk, φ) and the spherical
coordinate system (v, θ, φ); see ﬁg. 1. These are related by

Fe =

qeE
me

.

v2 = v2

⊥ + v2
k,

cos θ = vk/v.

3

Both of these coordinate systems are useful. In cylindrical coordinates (assuming azimuthal symmetry)
eq. (6) gives

Similarly, in spherical coordinates we have

Transformations between D and F expressed in the two coordinate systems may be achieved by

S =

∇ ·

1
v⊥

∂
∂v⊥

v⊥S⊥ +

∂
∂vk

Sk,

S⊥ =

D⊥⊥

D⊥k

+ F⊥fe,

∂fe
∂v⊥ −
∂fe
∂v⊥ −

∂fe
∂vk
∂fe
∂vk

Sk =

Dk⊥

Dkk

+ Fkfe.

S =

∇ ·

1
v2

∂
∂v

v2Sv +

Sv =

Dvv

Sθ =

Dθv

∂fe
∂v −
∂fe
∂v −

Dvθ

1
v sin θ
1
v
1
v

∂
∂θ
∂fe
∂θ
∂fe
∂θ

Dθθ

sin θSθ,

+ Fvfe,

+ Fθfe.

−

−

−

−

D⊥⊥
D⊥k
Dk⊥
Dkk











= M

Dvv
Dvθ
Dθv
Dθθ






· 



F⊥
Fk (cid:19)

(cid:18)

= N

Fv
Fθ (cid:19)

,

·

(cid:18)

M = M−1

N = N−1

=

= 




s2
sc
sc
c2
s
c

sc
s2
−
c2
sc

−
c
s

,

sc
c2
s2
sc

−
−

c2
sc
−
sc
−
s2






and

where

−
and here we have abbreviated s = sin θ and c = cos θ. The collision term is most conveniently expressed
in spherical coordinates and eqs. (10) allow us to transform this term to cylindrical coordinates. On the
other hand, the rf and electric ﬁeld terms are written most naturally in cylindrical coordinates, and this
equation also enables us to express these terms in spherical coordinates.

(cid:19)

(cid:18)

In the case of the collision operator, D and F are given in terms of the gradients of potentials

In cylindrical coordinates (with azimuthal symmetry), the relevant components of D and F are easy to
calculate—we just take the corresponding derivatives of ψ and φ. In spherical coordinates we have

D

ψ,

∝ ∇∇

F

φ.

∝ ∇

(
∇∇

ψ)vv =

(
∇∇

ψ)vθ = (

ψ)θv =

∇∇

∂2ψ
∂v2 ,
∂2ψ
1
∂v∂θ −
v

1
v2

∂ψ
∂θ

,

4

(8a)

(8b)

(8c)

(9a)

(9b)

(9c)

(10a)

(10b)

(11a)

(11b)

(
∇∇

ψ)θθ =

∂ψ
∂v

+

1
v2

∂2ψ
∂θ2 ,

1
v
∂φ
∂v
1
v

∂φ
∂θ

.

φ)v =

,

(
∇

(
∇

φ)θ =

(11c)

(11d)

(11e)

(12)

(13)

(14)

(15)

(16)

(17)

Several important quantities are given in terms of velocity-space moments of the distribution function.

Three-dimensional velocity space integrations can be carried out in cylindrical coordinates using

f (v) d3v =

dv⊥

dvk 2πv⊥f (v⊥, vk)

∞

∞

0
Z

−∞

Z

∞

π

0
Z

0
Z

Z

Z

f (v) d3v =

dv

dθ 2πv2f (v, θ) sin θ.

and in spherical coordinates using

C. Legendre harmonics

monics Pl(cos θ). We write this as

It is sometimes useful to decompose the distribution function and the potentials into Legendre har-

f (v, θ) =

f (l)(v)Pl(cos θ),

f (l)(v) =

2l + 1
2

f (v, θ)Pl(cos θ) sin θ dθ.

∞

Xl=0

π

0
Z

The Legendre polynomials may be evaluated on a computer using the recurrence relation10

P0(µ) = 1,

(l + 1)Pl+1(µ) = (2l + 1)µPl(µ)

lPl−1(µ).

−

D. Deﬁnitions

of species s is given by

Finally, we deﬁne some of the other quantities that we encounter in this paper. The thermal velocity

where Ts is the temperature of species s. The thermal collision frequency for the electrons is

where

where

and ns is the number density of species s, ǫ0 is the dielectric constant of free space, and ln Λa/b is the
Coulomb logarithm. The distributions are normalized so that

vts =

Ts
ms

,

r

νte = τ −1

te =

Γe/e
v3
te

,

Γa/b =

nbq2

aq2
4πǫ2

b ln Λa/b
0m2
a

,

fs(v) d3v = ns.

Z

5

In particular, the Maxwellian distribution is

fsm(v) = ns

3/2

(cid:18)

exp(

ms
2πTs (cid:19)
1
ts)3/2 exp(
(2πv2
−

−

= ns

1

2 msv2/Ts),

1

2 v2/v2

ts).

In discussing the applications to rf current drive, there are two quantities in which we will be inter-

ested: the electron current density

and the rf power absorbed per unit volume by the plasma

J =

qevkfe(v) d3v

Z

Z

P =

mev

Sw d3v.

·

The efﬁciency of rf current drive is usually given as the ratio J/P .

We shall use S.I. units throughout this paper except that we will measure temperature in units of

(18)

(19)

(20)

energy.

where

III. Collision Operator

A. The Landau collision operator

The collision ﬂux is given by the Landau collision integral11

Sa/b

c =

aq2
q2
b
8πǫ2
0ma

ln Λa/b

U(u)

Z

·

(cid:18)

fa(v)
mb

∂fb(v′)

∂v′ −

fb(v′)
ma

∂fa(v)
∂v

d3v′,

(cid:19)

(21)

U(u) =

u2I

uu

,

−
u3

u = v

v′.

−

The formula for the Coulomb logarithm ln Λa/b is given in text books and the NRLPlasmaFormulary.12
Because it is so insensitive to plasma parameters, in many cases it is adequate to take it to be a constant
equal to 15. In any case, it is required that ln Λa/b = ln Λb/a. The Landau collision operator conserves
number, momentum, and energy, i.e.,

C(fa, fb) d3v = 0,

mavC(fa, fb) d3v +

mbvC(fb, fa) d3v = 0,

C(fa, fb) d3v +

C(fb, fa) d3v = 0.

Z

Z

mbv2
2

Z

Z
mav2
2

Z

(22a)

(22b)

(22c)

There is an error on the order of 1/ ln Λa/b in the Landau collision operator. However, because it has
so many “nice” properties—the conservation laws of eqs. (22), an H-theorem, etc.—it is customary to
regard eq. (21) as being exact.

6

B. Rosenbluth potentials

×

Equation (21) is the most useful form for the collision operator for analytical work. However, it is not
in a convenient form for numerical computations. Suppose we represent the distribution functions on an
N grid (assuming azimuthal symmetry). Then evaluation of eq. (21) entails O(N 4) computations,
N
because it entails a two-dimensional integral (over v′) which must be carried out at each grid location.
Fortunately, substantial savings may be realized by using an equivalent representation in terms of Rosen-
bluth potentials.13,14 Here we use the slightly more convenient notation of Trubnikov.15 We deﬁne two
potentials

These are called potentials because they satisfy Poisson’s equations in velocity space

In terms of these potentials, eq. (21) becomes

2φb(v) = fb(v),

2ψb(v) = φb(v).

∇

∇

φb(v) =

ψb(v) =

1
4π
1
8π

−

−

Z

Z

fb(v′)
v′
v
|
v
|

v′

−

−

|

|

d3v′,

fb(v′) d3v′.

fa(v) + Fa/b

c fa(v),

Sa/b

c =

Da/b

c =

Fa/b

c =

−

−

−

Da/b

c ∇
4πΓa/b

ψb(v),

nb ∇∇
ma
mb ∇

4πΓa/b
nb

φb(v).

(An equivalent form of this equation is given by Rosenbluth etal.13 which contains a term of the form

∇∇
This form is used in several numerical codes,2–4 even though more derivatives of ψb must be taken. One
form may be derived from the other by noting that

∇ ·

2ψb = φb.)

There is an efﬁcient method for calculating the Rosenbluth potentials. This involves decomposing fb

∇

[fa(v)

ψb(v)].

in Legendre harmonics eq. (15). Then we have13

φ(l)
b (v) =

1
2l + 1

−

ψ(l)
b (v) =

1
2(4l2

v

0
(cid:20)Z

1)

0
(cid:20)Z

−

+

∞

b (v′) dv′

,

(cid:21)

vl
v′l−1 f (l)
f (l)
b (v′) dv′

b (v′) dv′ +

v

v′l+2
vl+1 f (l)
v′l+2
vl−1
∞

1
(cid:18)
vl
v′l−3

v
Z

v
Z
v′2
v2
1
l
2
−
l + 3
2

1
l
2
−
l + 3
2

−

1
(cid:18)

−

(cid:19)
v2
v′2

(cid:19)

f (l)
b (v′) dv′

.

(cid:21)

−

Let us assume that fb may be represented by K Legendre harmonics (i.e., the upper limit in the sum in
1). Then the calculation of f (l)
b (v) from fb(v) using eq. (15) takes O(N 2) computations
eq. (14) is K
for each l or O(KN 2) computations altogether. Given f (l)
b (v), the calculation of φ(l)
b (v)
using eqs. (25) takes O(N ) computations for each l. The calculation of φ(v) and ψ(v) takes a further
O(KN 2) step. Overall the number of steps is therefore O(KN 2). Often, we can take K to be quite
N , so we can compute the collision term much
small (usually K < 10), and in any case we have K
more economically than using the Landau operator directly.

b (v) and ψ(l)

≤

7

(23a)

(23b)

(24a)

(24b)

(24c)

(25a)

(25b)

IV. Approximations to the Collision Operator

A.

Isotropic background

If the background distribution is isotropic fb(v) = fb(v), then so too are φ and ψ. The collision term

is then from eqs. (24), (25), and (11)

Sa/b

cv =

Da/b
cvv

+ F a/b

cv fa,

Sa/b
cθ =

Da/b
cθθ

−

−

∂fa
∂v
∂fa
1
∂θ
v

,

where

Da/b

cvv =

Da/b

cθθ =

F a/b

cv =

v

0

v

4πΓa/b
3nb (cid:18)Z
4πΓa/b
3nb (cid:18)Z
4πΓa/b
3nb

−

0
ma
mb Z

∞

v
Z

v′4
v3 fb(v′) dv′ +
v′2
2v3 (3v2
3v′2
v2 fb(v′) dv′.

−

v

0

v′fb(v′) dv′

,
(cid:19)
v′fb(v′) dv′

∞

,
(cid:19)

v′2)fb(v′) dv′ +

v
Z

B. The high-velocity limit

may be replaced by inﬁnity to give

If v is much greater than the thermal velocity of particles of species b, the indeﬁnite limits in eqs. (27)

tb

cvv = Γa/b v2
Da/b
v3 ,
cθθ = Γa/b 1
Da/b
1
2v
(cid:18)
Γa/b ma
mb

cv =

F a/b

−

−
1
v2 ,

v2
tb
v2

,
(cid:19)

v2
ts =

∞

4π
3ns Z

0

v4fs(v) dv.

where the thermal velocity is deﬁned for an arbitrary isotropic distribution as

[For a Maxwellian distribution, eq. (18), this reduces to the usual expression eq. (16).]

C. Maxwellian background

give15

If the background distribution is Maxwellian eq. (18), the integrals in eq. (27) can be carried out to

Da/b

cvv =

v2 =

Da/b

cθθ =

v2 =

νa/b
k
2
νa/b
⊥
4

Γa/b
2v

Γa/b
4v

erf(u)

u2 −

(cid:18)

2

−

(cid:18)(cid:18)

erf′(u)
u

,
(cid:19)

erf(u) +

F a/b

cv =

ma
ma + mb

−

νa/b
s v =

erf′(u)
u

,
(cid:19)
u erf′(u)

,

(cid:3)

ma
mb

(cid:2)

erf(u)

−

1
u2
(cid:19)
Γa/b
v2

−

8

(26a)

(26b)

(27a)

(27b)

(27c)

(28a)

(28b)

(28c)

(29)

(30a)

(30b)

(30c)

⊥ , and the slowing down diffusion rate
are the same as those deﬁned in the NRLPlasmaFormulary.12 [However, the NRLPlasmaFormu-

The parallel diffusion rate νa/b
νa/b
s
lary (1983 edition) has an incorrect formula for the collision operator with a Maxwellian background.]

k

For u > 0, erf(u) is given approximately by10

where

where

and

x2) dx,

u

−

exp(

erf(u) =

erf′(u) =

0
Z
exp(

2
√π
2
√π
v
√2vtb
, perpendicular diffusion rate νa/b

u2),

u =

−

.

erf(u) = 1

exp(

−

u2)

−

aktk,

5

Xk=1

t = 1/(1 + pu)

p = 0.32759 11,
a1 = 0.25482 9592,
a3 = 1.42141 3741,
a5 = 1.06140 5429.

a2 =
a4 =

−

−

0.28449 6736,

1.45315 2027,

This approximation cannot be used in evaluating eqs. (30) near u = 0 because there is cancellation to
leading order in all three terms. In that case, the Taylor expansion,

erf(u)

u erf′(u) =

−

1)k
(
−
k!

2
2k + 3

u2k+3

2
√π

2
√π

∞

Xk=0
2
3

(cid:18)

=

u3

−

2
5

u5 +

u7

u9 + . . .

1
7

1
27

−

,
(cid:19)

may be used. Alternatively, we can compute eqs. (30) by numerically evaluating the integrals in eqs. (27)
with fb(v) = fbm(v). This method is then easily extended to include relativistic effects as given in
sec. X.

The ratio F a/b

cv /Da/b

cvv from eqs. (30) [and also (28)] is

mav/Tb so that the effect of collisions with

species b is to make species a approach a Maxwellian with temperature Tb.

−

D. Linearized collision operator

In many applications in plasma physics (including those involving rf waves) collisions dominate the

thermal particles. Therefore, the distribution function may be expanded about a Maxwellian

The self-collision operator C(fa, fa) may be approximated by the linearized operator

fa(v) = fam(v) + fa1(v).

Ca/a
lin

fa(v)

= C

fa(v), fam(v)

+ C

fam(v), fa(v)

,

(31)

(cid:0)

(cid:1)

(cid:0)

(cid:1)

(cid:0)

(cid:1)

9

where we have made use of the fact that C(fam, fam) = 0, and we have ignored terms of order f 2
can compute C
fa(v) as a sum of Legendre harmonics, eq. (14), to give

using eqs. (26) and (30). To compute C

fam(v), fa(v)

fa(v), fam(v)

a1. We
, we express

(cid:0)

(cid:1)

(cid:0)

(cid:1)

C

fam(v), fa(v)

=

C

fam(v), f (l)

a (v)Pl(cos θ)

.

(32)

∞

The zeroth term in the sum can be computed using eqs. (26) and (27) giving

(cid:0)

(cid:1)

Xl=0

(cid:0)

(cid:1)

fam(v), f (0)
fam(v)

a (v)

C

(cid:0)

(cid:1)

=

4πΓa/a
na

(cid:20)

f (0)
a (v) +

v

0
Z

∞

v′2
v2
ta
v′2
v2
ta

+

v
Z

f (0)
a (v′)

(cid:18)
a (v′)
f (0)

1
v

v′2
3v2
tav −
v2
3v2
tav′ −

(cid:19)
1
v′

(cid:18)

dv′

dv′

.

(cid:19)

(cid:21)

(33)

The next term in the sum in eq. (32) is given by eqs. (24), (25), and (11)

C

fam(v), f (1)

a (v) cos θ

fam(v) cos θ

(cid:0)

=

4πΓa/a
na

(cid:1)

(cid:20)

f (1)
a (v) +

v

0
Z

∞

v′2
v2
ta
v′2
v2
ta

+

v
Z

a (v′)
f (1)

(cid:18)
f (1)
a (v′)

v′3
5v2
tav2 −
v3
5v2
tav′2 −

v′
3v2
(cid:19)
v
3v′2

(cid:18)

dv′

dv′

.

(34)

(cid:19)

(cid:21)

The corresponding ﬂuxes for this term are

Sa/a
v
fam(v) cos θ

=

4πΓa/a
na

Sa/a
θ
fam(v) sin θ

=

4πΓa/a
na

v

f (1)
a (v′)

0
(cid:20) Z
+

∞

(cid:18)
f (1)
a (v′)

v
Z
v

0
(cid:20) Z

−

v
Z

f (1)
a (v′)

∞

(cid:18)
f (1)
a (v′)

+

v′5
5v2
tav3 −
v2
5v2
ta

(cid:18)
v′5
10v2
tav3 −
v2
15v2
ta

(cid:18)

2v′3
3v3
1
3

dv′

(cid:19)
dv′

,

(cid:21)

(cid:19)
v′3
6v2
tav −
1
3

dv′

(cid:19)

.

(cid:21)

+

v′3
3v3

(cid:19)

dv′

(35a)

(35b)

Because of conservation of number, momentum, and energy, the solutions to the homogeneous equa-

tion

are

Ca/a
lin

fa(v)

= 0

fa(v) = (a + b

(cid:1)

(cid:0)
mav + d 1

·

2 mav2)fam(v).

If we substitute a = b = 0, we obtain a check on eq. (33). Similarly, a = d = 0 and b = ˆvk gives
a check on eq. (34). Such checks are useful when incorporating the linearized collision operator into a
numerical code.

E. Electron-ion collision operator

We now turn to the speciﬁc problem of current drive by lower hybrid waves. In this problem we wish
to solve the Fokker–Planck equation for the electrons including the effects of electron-ion and electron-
electron collisions.

10

Because the ions are so massive relative to the electrons, we have v

and eqs. (28) apply. Indeed, we can make the further approximations mi → ∞
the collision operator is given by eq. (26) with

, vti →

≫

vti for nearly all the electrons
0, in which case

where

and we have assumed neutrality qene + qini = 0. The full electron-ion collision term C(fe, fi) can be
written as

Ce/i

fe(v)

= Γe/e Zi
2v3

1
sin θ

∂
∂θ

sin θ

fe(v).

∂
∂θ

For a multispecies plasma Zi is replaced by Zeﬀ where

(cid:0)

(cid:1)

(36a)

(36b)

(37)

cv = 0,

De/i
cvv = F e/i
cθθ = Γe/e Zi
De/i
2v

,

Zi =

qi ln Λe/i
qe ln Λe/e ,

−

Zeﬀ =

s ln Λe/s

s nsq2
neq2

e ln Λe/e

,

P

and the sum extends over all the ionic species.

With this collision operator the ions are characterized by a single dimensionless parameter Zi (or
Zeﬀ). The collision operator allows momentum to be transferred from the electrons to the ions, but there
is no energy exchange. The non-negative nature of fe is preserved.

F. Electron-electron collision operator

There are several choices for the electron-electron collision operator. We will discuss them starting

at the most complex.

The full electron-electron collision operator is given by eqs. (24) and (25). This was ﬁrst used in
current-drive studies by Harvey et al..16 This collision operator conserves both momentum and energy.
The electron distribution fe remains non-negative. Because the collision operator conserves energy, there
is nowhere for rf energy absorbed by the electrons to go. The problem arises because we have reduced
a problem in conﬁguration and velocity space to one in velocity space alone, so that there is now no
spatial diffusion of energy. In practice, this problem is solved by inserting an energy loss term into the
Fokker–Planck eq. (1). Unfortunately, there are several different models for this loss term and so this
procedure is somewhat adhoc.

The linearizedelectron-electron collision operator is given by eq. (31). This too conserves momentum
and energy. The non-negative nature of fe is no longer preserved. When the perturbation to fem is small,
fe usually only becomes negative far out on the tail. The energy conservation of the collision operator
again necessitates the introduction of an energy loss term. Fortunately, there is a systematic way to do
this within the context of a Chapman–Enskog–Braginskii expansion.17,18 The energy loss term has the
form

mev2
2Te −

3
2

−

fem(v)

∂ ln Te
∂t

,

(cid:19)
which appears on the right-hand side of eq. (1). Operationally, ∂ ln Te/∂t would be adjusted to ensure
that the energy of the electron distribution fe(v) remained constant. (In fact, one of the results of the
expansion procedure is an equation for the evolution of Te including the effects of rf and ohmic heating
and of energy transport.)

(cid:18)

11

A useful modiﬁcation of this collision operator is the truncatedcollision operator

Ce/e
trunc

fe(v)

= C

fe(v), fem(v)

+ C

fem(v), f (1)

e

(v) cos θ

,

(38)

(cid:1)

(cid:0)

(cid:0)

(cid:1)

(cid:0)

e

where the ﬁrst term is given by eqs. (26) and (30) and the second term by eq. (34). This differs from the
linearized operator in that we only retain the l = 0 and l = 1 terms in the sum in eq. (32) and we further
approximate f (0)
(v) by fem(v). As a consequence, this operator conserves momentum but not energy; so
there is no need to introduce an energy loss term. Again, the electron distribution function may become
negative. This collision operator is useful in the study of current drive by low-phase-velocity waves and
in the treatment of problems with an electric ﬁeld. In both of these examples, a momentum-conserving
electron-electron collision operator is required. This operator was used (in a relativistic form) in the study
of current drive by fast waves.19

(cid:1)

A slightly different technique for ensuring momentum conservation was used in our study of current
drive by low-phase-velocity waves.20 There we approximated the electron-electron collision operator by

Ce/e
drift

fe(v)

= C

fe(v), fem(

v

vdˆvk

)

,

−

(cid:1)
where the background is a drifting Maxwellian with a drift speed vd adjusted so that the parallel force
between fe(v) and the drifting Maxwellian,

(cid:0)

(cid:0)

(cid:1)

(cid:12)
(cid:12)

(cid:12)
(cid:12)

P e/e
k =

meSe/e

k d3v,

Z

vanishes. This collision operator conserves momentum (by construction) and preserves the non-negative
nature of fe. Energy is not conserved. It is, however, slightly less accurate than the truncated operator.
In particular, while the truncated operator gives the correct value for the electrical conductivity,21 this
operator gives an answer which is in error by about 15%. The computation of this collision operator
involves computing eqs. (30) in the drifting frame, converting to cylindrical coordinates using eqs. (10),
transforming to the rest frame (which is easy in cylindrical coordinates), and ﬁnally converting back to
spherical coordinates using eqs. (10). In order to determine the drift speed, we use the analytical formula
for the force on an electron Maxwellian drifting with speed vd due to a stationary ion background, i.e.,

P e/i
k =

−

nemeνtevdZi

1
3 r

2
π

r

mi
mi + me

,

which is valid for
vte. Here we have taken the mass ratio me/mi to be ﬁnite and have assumed
that Ti = Te. The force between two electron Maxwellians with a relative drift of vd is found by taking
Zi = 1 and mi = me which gives

vd| ≪
|

P e/e
k =

nemeνtevd
3√π

.

−

is computed using eq. (39). Equation (40) is used to estimate the change in

The situation may be further simpliﬁed by assuming that the background electrons are Maxwellian,

In the numerical code P e/e
vd required to give P e/e

k
k = 0.

so that the collision operator is given by

Ce/e
Max

fe(v)

= C

fe(v), fem(v)

,

(cid:0)
which may be evaluated using eqs. (26) and (30). This operator conserves neither energy nor momentum.
It does preserve the non-negative nature of fe. It was used by Kulsrud et al.5 in the study of runaways,
and in studies of lower hybrid current drive.6 The Maxwellian background serves as a heat bath, so

(cid:1)

(cid:1)

(cid:0)

(39)

(40)

(41)

12

no energy loss terms are required. The absence of momentum conservation introduces approximately a
factor-of-two error in the electrical conductivity5 and in the efﬁciency of current drive by slow waves.20
There is a relative error of order (vte/v)3 in the determination of the current-drive efﬁciency for fast
waves.19

Lastly, Ce/e

Max may be approximated by using the highvelocity limit, i.e., by using eqs. (28) instead of

eqs. (30). In fact, because eq. (28b) gives negative diffusion for small v, it is usually replaced by

cθθ = Γa/b 1
Da/b
2v

.

We deﬁne the resulting electron-electron collision operator as Ce/e
high. It has much the same properties as
Ce/e
Max. In particular, it yields a Maxwellian (with temperature Te) as the steady-state solution. Because
of the greater error in the collision term for thermal particles the electrical conductivity is even lower
than for Ce/e
Max. The evaluation of eqs. (28) is, of course, a little easier to program than that of eqs. (30).
However, because the results of evaluating eqs. (30) can be stored in a table, the extra computational cost
of working with Ce/e
Max is insigniﬁcant compared to the solution of the Fokker–Planck equation. Since
Ce/e
high is less accurate, its use is not recommended for numerical work. It is, however, useful in analytical
work.

When working with these electron-electron collision operators, it is useful to have some benchmark
against which to check their numerical realization. A useful benchmark is provided by the electrical
conductivity, which is the ratio of electrical current to electric ﬁeld in the limit E
0. This is tabulated in
table I for various values of Zi and for all the electron-electron collision operators discussed here. These
values were obtained by solving the corresponding one-dimensional equation by the method outlined in
sec. XI. In all cases, the electron-ion collision operator is given by eq. (37). The conductivity using the
full and the truncated electron-electron collision operators is the same as for the linearized operator. In
the limit Zi → ∞

, the conductivity is independent of the electron-electron collision model

→

For the high-velocity approximation to the collision operator the conductivity can be expressed analyti-
cally as

J
E

= 16

r

2
π

1
Zi

neq2
e
meνte

.

J
E

=

16
3 r

2
π

3Zi + 13
(Zi + 3)(Zi + 5)

neq2
e
meνte

.

V. Quasilinear Operator

A. Single wave

The interaction of electrons (or other species) with a wave is conveniently described in terms of the

quasilinear theory.22 In this theory the ﬂux of electrons in velocity space is given by

Sw =

Dw · ∇

−

fe,

where Dw is the quasilinear diffusion tensor which depends on the waves present in the plasma. Although
quasilinear theory is not strictly applicable to a single wave, we will start with this case because it is the
simplest. Suppose there is a uniform wave present in the plasma, i.e.,

(42)

(43)

E(r, t) = Re[Ew exp(ik

r

iωt)].

·

−

13

The quasilinear diffusion coefﬁcient is given by22

and

Dw =

π
2

q2
e
m2
e

n
X

δ(ω

kkvk −

−

nΩe)a∗

nan

an = Θn

ˆv⊥ + v⊥ˆvk

vk

kk
ω

ω
kk −
Ew+Jn−1 + Ew−Jn+1
√2

(cid:20)(cid:18)

(cid:19)

Θn =

(cid:21)
JnEwk,

+

vk
v⊥

(44)

where Ωe = qeB/me is the electron cyclotron frequency, B is the magnetic ﬁeld,
indicates complex
conjugation, Jn is the nth order Bessel function, and the argument of the Bessel functions is k⊥v⊥/Ωe.
Ew+ and Ew− are the left- and right-handed components of Ew; in a right-handed cartesian coordinate
system with ˆz parallel to B and k lying in the (x, z) plane, we have

∗

Ew+ =

Ew− =

Ewx + iEwy
√2
Ewx −
√2

iEwy

,

,

Ewk = Ewz.

It is instructive to consider the properties of eq. (44). The delta function speciﬁes the resonance
kkvk is zero (n = 0—the
condition. Only particles for which the Doppler-shifted wave frequency ω
Landau resonance) or a multiple of the cyclotron frequency (n
= 0—a cyclotron harmonic resonance)
interact with the wave. The vector an is perpendicular to the velocity of the electron in the wave frame
(ω/kk)ˆvk. This means that the wave-induced ﬂux is along diffusion paths which lie in constant-
v
energy surfaces in the wave frame; see ﬁg. 2. Similarly, the ﬂux is proportional to the gradient in fe in
this direction. As a consequence, when an electron interacts with a particle via the Landau resonance, the
diffusion tensor consists of only a single component

−

−

Likewise, for a cyclotron harmonic resonance, we have

Dw = Dkkˆvkˆvk.

Dw = D⊥⊥ˆv⊥ˆv⊥,

provided that v⊥ is small compared with nΩe/kk.

The appearance of the delta function in eq. (44) is a consequence of the assumed uniformity of the
magnetic ﬁeld. In this case, vk is a constant of the unperturbed motion and so a particle remains in reso-
nance for a long time. In situations described by bounce-averaged codes, the magnetic ﬁeld and vk vary
along a particle orbit so that the particle does not remain in resonance. This effect can be taken into ac-
count by averaging eq. (44) along a particle trajectory.23 This removes the delta function, although there
are still singularities in the resulting expression arising from those particles which turn in the resonance.8

B. Many waves

Equation (44) is easily generalized to include a more realistic representation of the wave ﬁelds. An
important application is to the incorporation of quasilinear effects into a ray-tracing code. Here the
externally injected rf power is represented by several rays. Let us consider the interaction of these waves

14

6
with the electrons on a particular ﬂux surface. At the point where a given ray intersects the ﬂux surface
it is characterized by its position r, wave number k, and power W (usually the frequency ω is ﬁxed by
the rf source). W measures the number of watts carried by the ray. In order to apply eq. (44), we must
determine the amplitude of the corresponding single wave Ew which has the same polarization and same
rms ﬁeld amplitude as the ray (with the rms averaging performed over time and over the ﬂux surface).

The ray contributes

W
ˆn
vg ·
|
|
to the wave energy density (in J/m3) averaged over the ﬂux surface, where vg is the group velocity of
the ray, ˆn is the unit vector normal to surface at the point of intersection and Af is the area of the ﬂux
surface. The polarization of the electric ﬁeld is given by

U =

Af

where

K

·

Ew = 0,

K =

c2
ω2 (kk

−

k2I) + I + i

σ(k, ω)
ωǫ0

is the dispersion tensor, c is the velocity of light, and σ(k, ω) is the conductivity tensor. The energy
density is related to Ew by24

U =

ǫ0ωE∗

1
4

∂K
∂ω ·

Ew.

w ·
Given W , we can therefore determine Ew (to within an ignorable phase factor) appropriately averaged
over the ﬂux surface.

This is substituted into eq. (44) and the result summed over all the rays to give the overall quasi-
linear diffusion tensor. In practice, the delta-functions appearing in this expression must be replaced
by smoothed functions. This allows the ray-tracing procedure to reﬂect the true situation in which a
continuous spectrum of waves is launched.

We complete the discussion of the ray-tracing by pointing out that the damping of the rays should
be calculated self-consistently from Dw. The power that a particular ray loses per unit volume due to
absorption by the electrons is given by eq. (20), where instead of the total Sw we use the contribution
the ray in question makes to Sw. To this should be added the power absorbed by the other species if
applicable. Then the ray power W satisﬁes the equation

dW
dt

=

P

−

vg ·
|

ˆn
|

Af ,

where the time derivative is the derivative taken along the ray.

If instead of a discrete set of waves, the wave ﬁelds are given by a spectrum

E(r, t) =

Ew(k) exp[ik

r

iω(k)t]

·

−

Z

d3k
(2π)3 ,

then eq. (44) becomes22

Dw =

q2
e
m2

e Z

d3k
(2π)3

1
Vp

n
X

πδ[ω(k)

kkvk −

−

nΩe]a∗

nan,

(45)

where Vp is the conﬁguration space volume of the plasma and the deﬁnition of an is generalized in the
obvious way.

15

C. Model forms

The results given above allow a ray-tracing code to be coupled to the solution of the Fokker–Planck
equation. This is an extremely complicated system, and much work has been carried out using assumed
forms for the quasilinear diffusion coefﬁcient. This allows us to study the physics of the interaction of the
electrons and the waves without having to worry about the additional physics of the wave propagation.
The most widely used model form for lower hybrid waves was introduced by Fisch1 and is given by

where

Dw = Dw(vk)ˆvkˆvk,

Dw(vk) =

(cid:26)

D0,
0,

for v1 < vk < v2,
otherwise.

(46a)

(46b)

This form of Dw is justiﬁed as follows. Because lower hybrid waves interact only via the Landau
resonance, only the ˆvkˆvk component is present. If k⊥vte/Ωe ≪
1, the dependence on perpendicular
1). Finally, in many cases, the magnitude of the quasilinear diffusion
velocity may be ignored (J0 ≈
greatly dominates over the collisions; thus the quasilinear diffusion coefﬁcient tends to make an abrupt
transition (in velocity space) from being negligible to being large; if D0 is sufﬁciently large (i.e., large
enough to form a quasilinear plateau), this situation is accurately modeled by eq. (46b).

This particular form for Dw is useful because much theoretical work has been carried out using it.1
Numerical solutions to the Fokker–Planck equation provide the best test of these theories. It is therefore
important that any numerical code be able to handle the discontinuities in Dw. (Note, however, that both
fe and S are continuous even if Dw is not.)

This model is readily generalized, for example, by allowing D0(vk) to be an arbitrary function. Thus
the effect of a backward component to the lower hybrid spectrum can be studied by including another
boxlike component to D0. Similar models have been used to study low-phase-velocity current drive20
and electron-cyclotron current drive.25

D. Direct speciﬁcation of the quasilinear ﬂux

Both analytical and numerical studies show that the current drive efﬁciency is primarily determined
by the location at which electrons interact with the waves and the direction in which the waves push the
electrons. It is sometimes useful to specify the rf-induced ﬂux directly as some arbitrary vector ﬁeld
Sw(v). Indeed, in some cases we may know Sw more accurately than we know Dw. In a ray-tracing
calculation, Dw may be calculated self-consistently in terms of the power ﬂows in the various rays.
However, in cruder zero-dimensional calculations, we may wish to assert merely that so much rf power
is absorbed by the electrons. Then Sw may be estimated from eq. (20) using an a priori knowledge of
which electrons interact with the waves. Alternatively, Sw may be estimated from either an approximate
analytic solution of the Fokker–Planck equation26 or from a solution of the one-dimensional Fokker-
Planck equation.1

If Sw is given, then the Fokker–Planck equation (1) is an inhomogeneous (instead of homogeneous)
equation. However, assuming that one of the linear electron-electron collision operators is being used,
the linear operator acting on fe in eq. (1) is now independent of the wave drive. This property is used in
the adjoint methods to provide a very efﬁcient method of solving for moments of fe (see sec. XI).

16

VI. Boundary Conditions

A. Computational domain

We shall take the computational domain V for the Fokker–Planck equation to be

0 < v⊥ < v⊥max,

vkmin < vk < vkmax,

for problems solved in a cylindrical coordinate system and

0 < v < vmax,

0 < θ < π,

for problems solved in a spherical coordinate system. The boundary of V is deﬁned to be A.
example, in spherical coordinates, A is the spherical surface v = vmax.)

B.

Internal boundaries

We distinguish two types of boundary: internal and external boundaries. The internal boundaries are
the simplest. In a cylindrical coordinate system we have an internal boundary at v⊥ = 0. Values of f
beyond this boundary are determined by symmetry

Similarly, in spherical coordinates we have internal boundaries at v = 0 and at θ = 0 and θ = π. These
boundaries are treated with the boundary conditions

fe(

v⊥, vk) = fe(v⊥, vk).

−

fe(
−
fe(v,

v, θ) = fe(v, π

−
θ) = fe(v, θ),

θ),

−

fe(v, π + θ) = fe(v, π

θ).

−

(47)

(48)

(For

(49)

(50a)
(50b)

(50c)

C. External boundaries

The other boundaries are inserted into the problem in violation of the true physical picture. In reality
the velocity domain extends off to inﬁnity; on the computer, however, we normally study only a subspace.
We have to choose the subspace to include all the interesting physics: for studies of electron distribution
vte; if the electrons are driven by lower hybrid
in a spherical coordinate system, we require vmax ≫
waves, then we further require vmax > (ω/kk)max, the maximum wave phase velocity; if we wish
to study runaways, then vmax must exceed the runaway velocity; and so on. We next have to choose
boundary conditions which are as “innocuous” as possible; i.e., which perturb the solution in the domain
of integration as little as possible compared to the solution in the full domain.

For electron current-drive problems we choose the condition

S

ˆn = 0,

·

(51)

on the external boundary A, where ˆn is the normal to A. This means that plasma cannot enter or leave
the domain of integration. Thus the number of electrons is conserved with this boundary condition. This
boundary condition gives a Maxwellian steady state in the absence of the rf, and allows a steady-state
solution to be reached in the presence of rf.

If an electric ﬁeld is present, then in the real problem some electrons will run away. Now we wish
vte so that
to impose boundary conditions which “allow” this to happen. At the boundary we have v
collisions are weak, and the dominant process is the acceleration by the electric ﬁeld (we assume that the

≫

17

boundary is removed from the region where the rf diffusion takes place). The Fokker–Planck equation
then reduces to a hyperbolic equation. The tactic is to apply the same boundary condition as before,
namely eq. (51), where the characteristics of the hyperbolic system enter the domain of integration.
Where the characteristics leave, we set those diffusion terms which lead to a ﬂux across the boundary
to zero. This makes the equation purely hyperbolic in the direction normal to the boundary and so no
boundary condition is required. (We shall see in sec. VII how this comes about in the numerical scheme.)
If we assume that qeE > 0 so that electrons run away in the positive direction, then in cylindrical

coordinates we would impose

Sk = 0,
S⊥ = 0,
Dk⊥ = Dkk = 0,

for vk = vkmin,
for v⊥ = v⊥max,
for vk = vkmax.

(52)

(53)

(The boundary at v⊥ = v⊥max is taken to be an incoming boundary because the small collisional friction
makes the characteristics enter along this boundary.)

A slightly more accurate treatment is possible in spherical coordinates. If we compare the various
te/v4.
v2
collision terms in the high-velocity limit eqs. (28), we ﬁnd Fcv ∼
Thus we can ignore the energy diffusion term Dcvv compared with the other collisional terms. The
pitch-angle scattering term Dcθθ requires no special handling because it causes diffusion parallel to the
boundary. The equation is, therefore, hyperbolic in the direction perpendicular to the boundary with a
characteristic acceleration given by Fv = Fcv + (qeE/me) cos θ. The boundary conditions on v = vmax
then become

1/v2 and Dcvv/v

Dcθθ/v

∼

∼

Sv = 0,
Dvv = Dvθ = 0,

for Fv < 0,
for Fv > 0.

vte, Fcv is accurately approximated by eq. (28c) (with a = b = e). Thus, if
For vmax ≫
<
v2
meΓe/e/
max, this boundary condition reduces to eq. (51), allowing problems involving both an
qe|
|
electric ﬁeld and rf diffusion to be handled in a uniﬁed way. In this small electric ﬁeld limit, Sv = 0 is
zero everywhere on the boundary and the numerical runaway rate vanishes. This is a close approximation
te).
to the true situation in which the runaway rate is exponentially small—on the order of exp(

max/v2
v2

E
|

|

−

D. Treatment of runaways

With a ﬁnite boundary, we can determine the runaway rate accurately (provided vmax is sufﬁciently
large). However, the behavior of the runaways beyond the boundary is not followed. One could, of
course, just choose a very large boundary; but this is wasteful of computer resources and really just
postpones the time at which the problem is encountered. It is, therefore, preferable to treat the runaways
as a separate species. Assuming that the runaways are affected only by the electric ﬁeld, the density and
current moments of the runaway population form a closed set of equations. We deﬁne

where V is the complement of V , i.e., the region v > vmax in spherical coordinates. Applying eqs. (5a)
and (5b) to V we ﬁnd

nr =

fe d3v,

Jr =

qevkfe d3v,

ZV

ZV

S

d2A,

·

∂nr
∂t
∂Jr
∂t

=

=

ZA
q2
e E
me

nr +

qevkS

d2A.

·

ZA

18

Thus if we wish to determine the total current as a function of time, we need only supplement the Fokker–
Planck equation by two ordinary differential equations and then sum the nonrunaway and runaway con-
tributions to the current.

VII. Spatial Differencing

A. Choice of coordinate system

We have discussed both the cylindrical and the spherical coordinate systems. Which one should be
used in a given application? The numerical scheme that is described here works best if the diffusion
(It is these
tensor is nearly diagonal. Then the mixed derivative terms in eqs. (8) or (9) are small.
terms which tend to make the numerical scheme unstable.) Now the collision operator is approximately
diagonal in spherical coordinates while the quasilinear term is nearly diagonal in cylindrical coordinates.
Thus the choice of coordinate system to some extent depends on the relative strength of these two terms.
Cylindrical coordinates were used in the study of current drive by low-phase-velocity waves20 because
the edges of the resonant region line up with coordinate lines allowing the scaling with phase velocity
to be measured more accurately. On the whole, however, the spherical system is to be preferred because
the electron-ion collision term eq. (37) becomes large near v = 0 and we wish this term to be diagonal.
In ref. 20 much smaller time steps had to be taken to avoid the problem with the electron-ion term. The
boundary conditions can also be applied more accurately in spherical coordinates when an electric ﬁeld
is present [eqs. (53)]. For this reason, we will focus on the spherical coordinate system in this section.
Extension to the cylindrical coordinate system is straightforward.

An alternate representation of fe is as a series of Legendre harmonics. This has no particular merit
in quasilinear problems because the sharp gradients in Dw, eq. (46), cause the Legendre expansion to be
slowly convergent.

B. Normalizations

In solving equations of physical signiﬁcance on the computer, it is often useful to normalize all
the physical quantities. This allows us to work with numbers which are closer to unity (and thus avoid
potential problems due to arithmetic overﬂow or underﬂow); more importantly, the number of parameters
needed to specify the problem is often reduced.

For the problem of current drive by lower hybrid waves, we solve the Fokker–Planck equation for
the electrons. We normalize velocities to vte eq. (16), times to τte eq. (17), the electron density to ne,
the electron distribution to ne/v3
teνte, the electric ﬁeld to
mevteνte/qe, the current density to neqevte, power density to nemev2

te, the quasilinear diffusion coefﬁcient to v2
teνte, etc.

These normalizations coincide with those used by Kulsrud et al..5 However, they differ from those

used in some of our earlier papers, e.g., ref. 6. (The thermal collision time differs by a factor of two.)

Since we are only dealing with the electron distribution, we will drop the species label from f and
other electron quantities. Otherwise, we shall use the same notation for normalized and unnormalized
quantities. For example, the electron Maxwellian eq. (18) reads in normalized terms

The reduction in the number of parameters now becomes apparent. The plasma is characterized by a

single parameter Zi and the quasilinear diffusion coefﬁcient by three parameters D0, v1, and v2.

fm(v) =

1

(2π)3/2 exp(
−

1

2 v2).

19

C. The numerical grid

We wish to solve eq. (1) in the domain V eq. (48). We do this by converting the differential equation
to an algebraic equation using the ﬁnite difference method. In this method f is represented by its values
on ﬁnite set of points and differentials are represented by differences between neighboring values.

First, we establish a numerical grid by dividing v and θ into N and M equal pieces, respectively.

Thus we deﬁne

together with grid positions

∆v = vmax/N,

∆θ = π/M,

vj = j ∆v,
θi = i ∆θ.

This grid system deﬁnes a system of cells. The electron distribution function is represented by its values
at the centers of these cells, i.e., by the values

fi+1/2,j+1/2 = f (vj+1/2, θi+1/2),

for 0

i < M,

0

j < N,

≤

≤

with i and j being integers; see ﬁg. 3. The cell vj < v < vj+1, θi < θ < θi+1 (i and j integers) is
assigned a volume

Vi+1/2,j+1/2 = 2π sin θi+1/2v2

j+1/2 ∆v∆θ.

We will deﬁne numerical volume integration by

M−1

N −1

int X =

Xi+1/2,j+1/2fi+1/2,j+1/2Vi+1/2,j+1/2.

This is the discrete analogue of
boundary by

j=0
X

i=0
X
V Xf d3v; see eq. (13). We deﬁne the ﬂux of a quantity through the
R
M−1

ﬂux X =

2π sin θi+1/2v2

N Xi+1/2,N +1/2Sv,i+1/2,N ∆θ,

which is a discrete analogue of

d2A. The number density of electrons becomes

i=0
X
A XS
R

·

n = int 1.

An alternative approach to ﬁnite differences is provided by the ﬁnite-element method where the f is
represented by the superposition of a set of trial functions with ﬁnite support. This approach has been used
in Fokker–Planck codes by workers at Lausanne.27,28 The ﬁnite-element method is also used in some
commercial computer codes for the solution of partial differential equations. One such code has been
applied to the Fokker–Planck equation by Fuchs etal..29 If we identify the weights of the trial functions
with the values of f at the grid positions, we see that the ﬁnite-difference and ﬁnite-element methods
are quite similar. In particular, the goals of the methods are identical: to express algebraically ∂f /∂t
at a particular location in terms of f at the same and neighboring locations (usually, the eight nearest
neighbors). Thus our discussion of the time advancement of the equation in sec. VIII is independent of
the choice of method.

(54)

(55a)

(55b)

(56)

(57)

(58)

(59)

20

D. Divergence of ﬂux

in a conservative form as

Consider the Fokker–Planck equation in the form eq. (2). This is translated onto our numerical grid

∂fi+1/2,j+1/2
∂t

=

−

(cid:18)

v2
v2
j Sv,i+1/2,j
j+1Sv,i+1/2,j+1 −
v2
j+1/2 ∆v

sin θi+1Sθ,i+1,j+1/2 −

+

sin θiSθ,i,j+1/2

vj+1/2 sin θi+1/2 ∆θ

.

(cid:19)

(60)

(61)

Notice that the ﬂuxes are required on the edges of the cells (see ﬁg. 3) and that the ﬂuxes on the internal
boundaries do not contribute since they are multiplied by v0 = 0 or sin θ0 = sin θM = 0. With this
method we difference the ﬂuxes and not the diffusion and friction coefﬁcients. This lets us treat problems
in which Dw is discontinuous, e.g., as given by eqs. (46). The scheme in eq. (60) is accurate to second
order in ∆v and ∆θ.

This form of difference equation is called conservative because it obeys the conservation law

∂ int 1
∂t

+ ﬂux 1 = 0,

M−1

N

i=0
X
M

j=0
X
N −1

−

i=0
X

j=0
X

M−1

N

where int and ﬂux are deﬁned by eqs. (57) and (58). This is a discrete counterpart of eq. (5a).
If
Sv,i+1/2,N = 0 for all i, then we have ﬂux 1 = 0 and particles are exactly conserved in the numerical
scheme (if we ignore round-off errors). The discrete form of the parallel component of the momentum
conservation law eq. (5b) is

∂ int(v cos θ)
∂t

+ ﬂux(v cos θ) =

2πv2

j sin θi+1/2 cos θi+1/2Sv,i+1/2,j ∆v∆θ

2πv2

j+1/2 sin2θiSθ,i,j+1/2 ∆v 2 sin( 1

2 ∆θ),

(62)

while the energy conservation relation eq. (5c) becomes

2 v2)

∂ int( 1
∂t

+ ﬂux( 1

2 v2) =

2π sin θi+1/2v3

j Sv,i+1/2,j ∆v∆θ.

(63)

i=0
X

j=0
X
These relations are useful in that they establish deﬁnitions of various physical quantities that are consis-
tent with the numerical scheme. For example, we can interpret the right-hand side of eq. (63) as the total
power ﬂowing into the electrons. This deﬁnition is consistent with the numerical deﬁnition of the energy
of the electrons, namely int( 1
2 v2). Furthermore, we can determine the power ﬂowing into the electrons
from the waves (for example) by replacing Sv in the right-hand side of this equation by the ﬂux due to the
waves Swv [compare with eq. (20)]. In this way, we obtain a complete and accurate power balance for
the electrons. Similarly, the right-hand side of eq. (62) gives the deﬁnition of the force on the electrons.
This is used when evaluating P e/e

in eq. (39).

k

[In order to prove eqs. (62) and (63), the following relation is useful:

M−1

1

i=0
X

2 (Ai+1 + Ai)(Bi+1 −

Bi) = AM BM −

A0B0 −

1

2 (Bi+1 + Bi)(Ai+1 −

Ai).

This is the rule for “summing by parts”—the discrete counterpart of integration by parts.]

The basic difference equation (60) is readily generalized to nonuniform grids. However, the deriva-
tion of eqs. (62) and (63) relies on the uniformity of the grid and they cannot easily be generalized.
Nonuniform spacing is used in FPPAC.4

M−1

i=0
X

21

E. Stream function

A very useful tool for understanding the Fokker–Planck equation (2) is the ﬂux plot, which shows the
vector ﬁeld S(v). This is sometimes displayed as a set of arrows, one at each grid point, which point in
the direction of S and which have a length proportional to S. In this problem, Sv and Sθ are known at
different locations, so that realization of this prescription would necessitate interpolation. Furthermore,
such a display is often very misleading because the visual impression is strongly affected by whether the
arrows line up with other grid points or not—a purely artiﬁcial aspect of the problem.

The much superior method is possible if we restrict ourselves to the steady state. In this case, the
S = 0, and so may be expressed as the curl of a stream function,

vector ﬁeld S(v) is divergence-free
i.e.,

∇ ·

where φ is the azimuthal coordinate. The components of S are given by

S(v) =

∇ ×

nA(v) ˆφ
2πv sin θ

,

Sv =

Sθ =

n
2πv2 sin θ

n
2πv sin θ

−

,

∂A
∂θ
∂A
∂v

.

· ∇

Because S
A = 0, lines of constant A are stream lines. Thus a contour plot of A(v) gives the vector
ﬁeld of S(v). The stream lines are obviously closed (indicating that the ﬂow is divergence-free), and the
total ﬂux of electrons between any two contours is equal to the difference in the values of nA on those
two contours.

We can compute A on the numerical grid using discrete analogs of eqs. (64)

Ai,j =

sin θi′+1/2Sv,i′+1/2,j ∆θ,

i−1

2πv2
j
n

Xi′=0
2π sin θi
n

=

−

j−1

Xj′=0

vj′+1/2Sθ,i,j′+1/2 ∆v.

If ∂fi+1/2,j+1/2/∂t = 0 according to eq. (60), then these two deﬁnitions are consistent.

F. Computation of the ﬂux

In order to complete the speciﬁcation of the difference scheme we must give formulas for Sv,i+1/2,j
and Sθ,i,j+1/2 in eq. (60). These depend on the type of electron-electron collision operator used. We start
with collisions off a Maxwellian background Ce/e
Max, eq. (41). This is the simplest case and yet it exhibits
all the difﬁculties of solving the Fokker–Planck equation.

The collisional ﬂux is given by the sum of the ﬂux contributing to Ce/e

Max which is given by eqs. (26)
and (30) and the ﬂux contributing to Ce/i which is given by eqs. (26) and (36). [In fact, we compute
the electron-electron ﬂux by numerically evaluating the integrals in eqs. (27).] To this is added the
quasilinear ﬂux from eqs. (42) and (46) and the electric-ﬁeld-induced ﬂux from eq. (4). Both these
terms are converted into spherical coordinates using eqs. (10). The total ﬂux is then given by the general
equations (9b) and (9c).

The diffusion and friction coefﬁcients are computed at the points at which we need to know Sv and
Sθ. Thus we compute Dvv,i+1/2,j, Dvθ,i+1/2,j, Fv,i+1/2,j , and Dθv,i,j+1/2, Dθθ,i,j+1/2, Fθ,i,j+1/2.

22

(64a)

(64b)

(65a)

(65b)

The coefﬁcients for Sv are not required at j = 0, nor those for Sθ at i = 0, M , because these ﬂuxes are
multiplied by zero in eq. (60). The boundary conditions eqs. (53) at vmax are handled by setting

0,

Dvv,i+1/2,N ←
Dvθ,i+1/2,N ←
Fv,i+1/2,N ←

0,
max(Fv,i+1/2,N , 0).

∂fi+1/2,j
∂v
∂fi,j+1/2
∂θ

=

=

fi+1/2,j+1/2 −
∆v
fi+1/2,j+1/2 −
∆θ

fi+1/2,j−1/2

fi−1/2,j+1/2

,

.

Next we must specify the way in which f and its derivatives are to be computed at the edges of the
cells—i.e., locations (i + 1/2, j) and (i, j + 1/2)—in terms of the values of f at the centers of the cells
(i + 1/2, j + 1/2). Two of the terms are straightforward:

(66a)

(66b)

(67a)
(67b)

(68a)

(68b)

(69)

Again these expressions are accurate to second order.

The evaluation of f at the cell edges uses a method proposed by Chang and Cooper30 extended here

to two dimensions. The simple method, i.e.,

fi+1/2,j = 1

2 (fi+1/2,j+1/2 + fi+1/2,j−1/2),

turns out to give poor results for the steady-state distribution. Chang and Cooper replace this with

fi+1/2,j = (1
fi,j+1/2 = (1

δi+1/2,j)fi+1/2,j+1/2 + δi+1/2,jfi+1/2,j−1/2,
δi,j+1/2)fi+1/2,j+1/2 + δi,j+1/2fi−1/2,j+1/2,

−
−

where the δs are given by

and

δi+1/2,j = g(
δi,j+1/2 = g(

∆vFv,i+1/2,j /Dvv,i+1/2,j),
∆θFθ,i,j+1/2/Dθθ,i,j+1/2),

−

−

g(w) =

1
w −

1
exp(w)

.

1

−

The role of the δ is to weight the averaging performed in eqs. (67). The weighting is needed because
often f is a strongly (exponentially) varying function of v. An acute example of this is the Maxwellian
distribution which varies very strongly for large v. In fact, the weighting is such that a Maxwellian is an
exact steady-state solution when there is no rf and no electric ﬁeld and when Ce/e
Max is employed as the
electron-electron collision operator. This is easily seen because for any isotropic distribution Scθ = 0; in
that case, we also require Scv = 0 in the steady state (because there are no sources or sinks of electrons).
Using eqs. (26a) (with a = b = e), (66a), and (67a), together with F e/e
vj, we
ﬁnd

cv,i+1/2,j/De/e

cvv,i+1/2,j =

−

fi+1/2,j+1/2
fi+1/2,j−1/2

=

fm,j+1/2
fm,j−1/2

= exp(

vj ∆v).

−

The errors in various moments of f are, therefore, exponentially small. With one-dimensional equations
the weighting cures the problem of f becoming negative.30 With our two-dimensional equation, this
problem is alleviated but not cured. In general, this problem is solved by taking a sufﬁciently ﬁne mesh
(assuming that the electron-electron collision operator preserves the non-negative nature of f ).

23

The function g has the properties

g(w) = 1

g(

w),

g(w) =

+ . . . ,

−

1
2 −

−
w
12

+

w3
720

g(

) = 1,

−∞

g(0) =

1
2

,

g(

) = 0.

∞

The ﬁrst two properties are useful for evaluating g(w) for w

1 and w

0, respectively.

The values of the cross-derivative terms which multiply the off-diagonal terms in the diffusion tensor

≫

≈

(Dvθ and Dθv) are now given in terms of eqs. (67) as

The internal boundary conditions eqs. (50) give the values of fi+1/2,j+1/2 beyond the internal bound-

aries as

∂fi+1/2,j
∂θ
∂fi,j+1/2
∂v

=

=

fi+3/2,j −
2∆θ
fi,j+3/2 −
2∆v

fi−1/2,j

fi,j−1/2

,

.

fi+1/2,−1/2 = fM−i−1/2,1/2,
f−1/2,j+1/2 = f1/2,j+1/2,
fM+1/2,j+1/2 = fM−1/2,j+1/2.

(70a)

(70b)

These conditions are only needed in the evaluation of cross-derivative terms. The form of eq. (60) auto-
matically takes care of the internal boundaries for the other terms.

The external boundary at v = vmax is treated as follows: In the computation of Sv,i+1/2,N we need
only worry about the friction term (since Dvv = Dvθ = 0 on the boundary) so that only fi+1/2,N
is needed. Furthermore, the friction coefﬁcient Fv,i+1/2,N is non-negative. From eq. (67a), we have
1 for Fv,i+1/2,N > 0 and Dvv,i+1/2,N = 0+. (Obvi-
fi+1/2,N = fi+1/2,N −1/2 because δi+1/2,N →
ously the value of fi+1/2,N is not required where Fv,i+1/2,N = 0.) Recall that the equation reduces to
hyperbolic type on this boundary, so that no boundary condition should need to be speciﬁed here, as in-
deed is the case. In fact, the method reduces to the standard upstream differencing for a hyperbolic equa-
tion on this boundary. In the computation of Sθ,i,N −1/2, only the cross-derivative term ∂fi,N −1/2/∂v
potentially involves points outside the integration domain. In this term, we use

∂fi,N −1/2
∂v

=

fi,N −1/2 −
∆v

fi,N −3/2

,

instead of eq. (70b).

G. Matrix formulation

For collisions off a Maxwellian background the problem is linear so that eq. (60) can be rewritten as

∂f
∂t

+ Af = h,

(71)

where f is a vector of length M N of the values fi+1/2,j+1/2 and A is an M N
M N matrix of coef-
ﬁcients. The right-hand side h (also a vector of length M N ) is inserted to aid in the treatment of other
collision operators. For the Maxwellian collision operator, we have h = 0. It is convenient to split A into
three pieces, namely

×

A = Av + Aθ + A×,

24

(72a)

(72b)

(73a)

(73b)

(73c)

(73d)

(73e)

(73f)

where Av contains the terms proportional to Dvv and Fv, Aθ contains those proportional to Dθθ and Fθ,
and A× contains the cross-derivative terms proportional to Dvθ and Dθv. With the difference scheme
given in this section Av and Aθ are tridiagonal matrices. Thus we can write

(Avf )i+1/2,j+1/2 = av,i+1/2,j+1/2fi+1/2,j−1/2 + bv,i+1/2,j+1/2fi+1/2,j+1/2

(Aθf )i+1/2,j+1/2 = aθ,i+1/2,j+1/2fi−1/2,j+1/2 + bθ,i+1/2,j+1/2fi+1/2,j+1/2

+ cv,i+1/2,j+1/2fi+1/2,j+3/2,

+ cθ,i+1/2,j+1/2fi+3/2,j+1/2,

where

+ Fv,i+1/2,j+1δi+1/2,j+1

,

av,i+1/2,j+1/2 =

Fv,i+1/2,j δi+1/2,j

bv,i+1/2,j+1/2 =

Fv,i+1/2,jǫi+1/2,j

−

−

Dvv,i+1/2,j
∆v

v2
j
Bv (cid:18)
−
v2
Dvv,i+1/2,j
j
∆v
Bv (cid:18)
v2
Dvv,i+1/2,j+1
j+1
+
∆v
Bv (cid:18)
Dvv,i+1/2,j+1
∆v
Dθθ,i,j+1/2
vj+1/2∆θ −

v2
j+1
Bv (cid:18)
−
sin θi
Bθ (cid:18)
−
Dθθ,i,j+1/2
sin θi
vj+1/2∆θ −
Bθ (cid:18)
sin θi+1
+

Dθθ,i+1,j+1/2
vj+1/2∆θ
Dθθ,i+1,j+1/2
vj+1/2∆θ

Bθ (cid:18)

sin θi+1

Bθ (cid:18)
−

cv,i+1/2,j+1/2 =

+ Fv,i+1/2,j+1ǫi+1/2,j+1

aθ,i+1/2,j+1/2 =

Fθ,i,j+1/2δi,j+1/2

bθ,i+1/2,j+1/2 =

Fθ,i,j+1/2ǫi,j+1/2

cθ,i+1/2,j+1/2 =

+ Fθ,i+1,j+1/2ǫi,j+1/2

,

+ Fθ,i+1,j+1/2δi,j+1/2

,
(cid:19)

(cid:19)

,
(cid:19)

(cid:19)

(cid:19)

,
(cid:19)

,
(cid:19)

(cid:19)

δ, Bv = ∆v v2

j+1/2, and Bθ = vj+1/2∆θ sin θi+1/2. With these coefﬁcients the bound-
where ǫ = 1
ary conditions are reﬂected in the relations av,i+1/2,1/2 = cv,i+1/2,N −1/2 = 0 and aθ,1/2,j+1/2 =
cθ,N −1/2,j+1/2 = 0, which are automatically satisﬁed.

−

The matrix A× is more complicated with (A×f )i+1/2,j+1/2 depending, in general, on the eight
nearest neighbors to fi+1/2,j+1/2. The boundary conditions have to be explicitly included in this matrix.
We do not give expressions for the components of A× here because only the product A×f is ever needed
in the calculation. This is most easily computed directly in terms of the ﬂux; this also cuts down on the
storage requirements.

H. Alternate collision operators

The methods we will describe in the next sections for solving eq. (71) depend on the linearity of this
equation and the fact that Av and Aθ are tridiagonal matrices. With more complicated electron-electron
collision operators, these conditions no longer hold. However, the techniques can still be used because
the difference between the other collision terms and the Maxwellian collision term varies slowly in time.
If the full electron-electron collision operator is used, the basic framework given above still applies,
except that the diffusion and friction coefﬁcients De/e
are now given in terms of gradients of
c
the Rosenbluth potentials eqs. (24). These coefﬁcients depend on f making the equation nonlinear. In

and Fe/e

c

25

practice, the dependence on f is weak so that the coefﬁcients only need to be recomputed occasionally.
This also means that the equation is approximately linear so that the linear matrix techniques used to
advance the equation in time still apply.

If the linearized or truncated collision operators are used, then the equation remains linear but with
a term which involves an integral over f , namely C
or the truncation of this term. Again,
this term is weakly dependent on f so that it need not be recomputed every time step. It is then most
(cid:0)
convenient to regard this term as the inhomogeneous driving term h eq. (71). For the truncated col-
lision operator Ce/e
evaluated at
(vj+1/2, θi+1/2). The computation of this term is described in appendix A.

trunc, eq. (38), the elements of h are given by C

fm(v), f (1)(v) cos θ

fm(v), f (v)

(cid:1)

(cid:0)

(cid:1)

VIII. Time Differencing

A. Crank–Nicholson method

(74)

(75)

We now turn to the method for advancing the Fokker–Planck equation in time. If the time step is ∆t,

then we deﬁne

The simplest way of advancing eq. (71) is the explicit scheme

f k = f (t = tk),

tk = k∆t.

f k+1

f k

−
∆t

+ Af k = h.

f k+1

f k

−
∆t

+ A

f k+1 + f k
2

= h.

This is only accurate to ﬁrst order in ∆t. Furthermore, ∆t must be chosen to be very small, on the order
of ∆v2 or ∆θ2, for stability. These defects are easily remedied by the Crank–Nicholson scheme31 which
reads

This scheme is accurate to second order in ∆t and is stable if A is positive deﬁnite. (This is a condition
possessed by the continuous form of the operator A.) In order to solve eq. (75) for f k+1 we have to
compute the inverse of (I + 1
2 ∆t A). This is a large banded matrix which can either be inverted using
In both cases the number of operations is O(N 3),
iterative methods or using Gaussian elimination.
N ) making it a very expensive proposition. (This approach is discussed further in
(assuming M
sec. IX.)

∼

B. Alternating-direction-implicit method

Although (I + 1

2 ∆t A) is difﬁcult to invert, the matrices (I + 1

2 ∆t Aθ) are rather
easily inverted. This allows the alternating-direction-implicitmethod31 to be used. Unfortunately, (I +
1
2 ∆t A×) is not easily inverted and this means that the cross-derivative terms are treated explicitly in this
method. Consider the equation

2 ∆t Av) and (I + 1

I +

Av

I +

∆t
2

(cid:19)(cid:18)

∆t
2

Aθ

(cid:19)

f k+1

f k

−
∆t

+ Af k = h.

(76)

(cid:18)

∆t2
4

(cid:18)

If we rearrange the terms in this equation to give

I +

AvAθ

+ (Av + Aθ)

f k+1

f k

−
∆t

(cid:19)

f k+1 + f k
2

+ A×f k = h,

we see that this method differs from the Crank–Nicholson method in two respects. Firstly, there is a
∆t2 term multiplying the time difference term. This difference is unimportant because it does not alter

26

the accuracy of the scheme. Secondly, the cross-derivative terms are treated explicitly. If we ignore
the cross-derivative terms, eq. (76) is as accurate as the Crank–Nicholson scheme, but is much easier to
realize because it is easy to solve eq. (76) for f k+1. The explicit treatment of the cross-derivative terms
lowers the accuracy and the stability, putting a limit on the maximum ∆t that can be used. On the other
hand, the implicit treatment of the other terms means that this method is far superior to the fully explicit
method.

We can compute f k+1 from eq. (76) in a series of simple steps:

φk = h

Af k,

−

ξk+1/2 =

I +

(cid:18)

−1

φk,

(cid:19)

−1

∆t
2

∆t
2

Av

Aθ

ξk+1 =

I +

ξk+1/2,

(cid:19)
f k+1 = f k + ∆t ξk+1.

(cid:18)

The inversion of the matrices is carried out using Gaussian elimination as described in appendix A.

C. Example

Let us consider a speciﬁc example relevant to lower hybrid current drive. The plasma consists of
electrons and inﬁnitely massive ions with Zi = 1. Electron-electron collisions are computed assuming a
Maxwellian background using Ce/e
Max eq. (41). Electron-ion collisions are given by eq. (37). The effect of
the lower hybrid waves is modeled by a quasilinear diffusion coefﬁcient given by eqs. (46) with D0 = 1,
v1 = 3, and v2 = 5. The electric ﬁeld E is taken to be zero. Except for minor details this is the
same example treated in the paper on lower hybrid current drive.6 (The time normalization used in that
paper differs from the one adopted here by a factor of two.) We take f (t = 0) = fm, vmax = 10,
M = N = 100, and ∆t = 0.2.

In studies of current drive, we are principally interested in the current density J, the rf power absorbed
per unit volume by the plasma P , and their ratio J/P . These are deﬁned by eqs. (19) and (20) whose
discrete forms read

int(v cos θ)
n
M−1

N

,

J =

P =

1
n

i=0
X

j=0
X

2π sin θi+1/2v3

j Swv,i+1/2,j ∆v∆θ,

(77)

(78)

where n is given by eq. (59). (These deﬁnitions include a 1/n factor, because the n is included in the
normalizations for J and P .)

The current is plotted as a function of time in ﬁg. 4. With ∆t = 0.5, the integration is unstable. The
difference in the values of the current when the equations are integrated with ∆t = 0.2 and ∆t = 0.05 is
about 0.1% of the ﬁnal current.

The steady-state solution for f is shown in ﬁg. 5. This may be obtained by integrating the equation
sufﬁciently long (until about t = 1000) with a ﬁxed time step or else using the techniques described in
sec. IX. (With this numerical method, the steady state is independent of ∆t.) The plateau in the resonant
region is clearly visible as well as the considerable perpendicular heating. Using eqs. (77) and (78), we
10−3, and J/P = 14.34.
have J = 5.754

10−2, P = 4.011

The ﬂux plot for this case is given in ﬁg. 6. This shows that the combination of rf diffusion and
collisional scattering induces a perpendicular ﬂux in the resonant region. Such ﬂux plots are useful

×

×

27

in providing guidance for the analytic solution of this problem.26 More extensive examination of this
example can be found in the original paper6 including projections onto the vk axis, slices at constant v⊥,
etc.

There are two possible sources of error in these results: errors arising from the ﬁnite boundary
(i.e., because vmax is ﬁnite) and errors arising from the ﬁnite mesh. The effect of the boundary can
be determined by increasing vmax to 20 (and increasing N to 200).
In the steady state, this gives
10−3, J/P = 14.35—changes of less than 0.1%. Thus for this
J = 5.759
particular problem, vmax = 10 is adequate.

10−2, P = 4.012

×

×

→

0, J approaches its asymptotic value of about 5.6

The effect of the discrete spatial grid is found by varying ∆v and ∆θ. This we do by keeping
vmax = 10 varying M and N with M = N . Thus we have N = 10/∆v and ∆θ = ∆v π/10. The
results for J and J/P are shown in ﬁg. 7. We see that there is a lot of scatter in the data which arises
because Dw is discontinuous. As ∆v and ∆θ are varied, grid points (those on which the ﬂux is deﬁned)
enter or leave the resonant region v1 < vk < v2. Each time this happens, there is a jump in J and P .
10−2 and the convergence to this value
As ∆v
is as ∆v. The ﬁnite mesh error in J with M = N = 100 is about 3%. This rate of convergence can be
understood because J and P are exponentially dependent on v1 [J
1)] and v1 is determined
1
2 v1∆v. This
only to within
gives a relative error of 15% for v1 = 3, N = 100, vmax = 10. The actual error is somewhat less than
this because the boundary of the resonant region cuts across the grid lines and so v1 is in fact determined
more accurately than was assumed here. Because J and P are both subject to the same error, the ratio
J/P is more accurately given: convergence to the asymptotic value of 14.24 is as ∆v2 and the value with
M = N = 100 is in error by less than 1%.

exp(
2 ∆v. Thus the relative error in J and P is about exp( 1

1
2 v2
−
2 v1∆v)

≈

∼

−

±

×

1

1

If instead we use the truncated electron-electron collision operator Ce/e

trunc, the steady-state distribution
function is rather similar to that shown in ﬁg. 5. However, the ﬂux plot ﬁg. 8 shows a new eddy at low
velocities due to the overall drift of the electrons with respect to the ions. (This plot is obtained with the
10−3, J/P = 16.52.
same parameters as for ﬁg. 6.) In this case, we ﬁnd J = 7.092
The enhancement of the efﬁciency J/P comes about because momentum (and hence current) is no longer
lost when tail electrons collide with bulk electrons.
A check on the implementation of the Ce/e

trunc is given by measuring the electrical conductivity. For
2/π.21 Integrating
Zi = 1, the exact conductivity is given by table I as J/E = 7.429
0.582
the Fokker–Planck equation using the truncated collision operator with no rf D0 = 0 and a small electric
ﬁeld E = 10−3, the conductivity is J/E = 7.446, a 0.3% error. This small error is probably attributable
partly to the ﬁnite mesh size (here we again took M = N = 100 and vmax = 10) and partly to the
ﬁniteness of E (since there is a contribution to the current which varies as E3). In contrast, if Ce/e
Max, is
used the conductivity is J/E = 3.772 a factor of two too small.5

10−2, P = 4.294

16

p

×

≈

×

×

IX. Steady-State Solution

A. Statement of problem

Often, we are only interested in the steady-state solution to the Fokker–Planck equation. Nearly
always we must resort to an iterative method for obtaining the steady state. In that case we need some
measure of how close we are to the steady state so that iteration may be stopped when this is small
enough. The measure we shall employ is

R =

1
n s

int

∂f
∂t

(cid:20)(cid:18)

(cid:19)

2

,
(cid:21)

28

(79)

where the residue∂f /∂t is given by eq. (60). Somewhat arbitrarily we use R = 10−9 as the convergence
criterion.

One obvious way of obtaining a steady state is to integrate the time-dependent solution as described
in sec. VIII for a long time. This should be done with the largest time step consistent with stability. For
the example shown in ﬁg. 5, the convergence criterion is met at time t = 812. The largest time step
that can be used is approximately 0.2; so that 4060 steps are required. The CPU time required to run the
Fokker–Planck code on the Cray–1 is approximately 2 µs per mesh point per time step. Thus, achieving
the steady state by this method takes about 80 s. This is rather expensive and it is therefore desirable to
ﬁnd faster methods.

However, this method is quite effective when A× = 0. Then the numerical scheme is stable even
if ∆t is large. For example, for the electric ﬁeld example discussed in sec. VIII in which D0 = 0 and
E = 10−3, we can take ∆t = 1, and the convergence criterion is met after 220 steps. Here the integral
portion of Ce/e
trunc, which is represented by the term h in eq. (71), is evaluated every tenth time step.
The numerical method is stable for larger values of ∆t. But, because the integration is less accurate,
more steps are required to meet the convergence criterion. With large ∆t the numerical solution tends to
oscillate about the steady state.

B. Chebyshev acceleration

A signiﬁcant improvement can be achieved by using a varying time step. Hewett etal.32 describe an
adaptive time selection for the alternating direction implicit method which speeds the convergence by a
factor of two to three. Here we describe Chebyshev acceleration31 which is a nonadaptive method for
selecting varying time steps. We choose the time step ∆tk = tk+1 −

tk according to

∆tk =

β + α

(β

α) cos

−

−

(cid:18)

2
[2(k mod K) + 1]π
2K

,

(cid:19)

(80)

where α, β, and K are constants with α < β and K = integer. The advantage of this method is that by
changing a few lines of code it can easily be incorporated into the alternating-direction-implicit method
described in sec. VIII. A ﬁxed time step is recovered in the special case α = β = 1/∆t.

Let us discuss the choice of the parameters in eq. (80). With K large, eq. (80) gives a series of K
time steps (repeated periodically) varying from 1/α down to 1/β. In the examples we consider, we take
K = 20. Then the maximum time step is somewhat less than 1/α while the minimum time step is very
close to 1/β. In order to realize performance gains with this method we wish to pick the minimum time
step comfortably within the stability threshold for the ﬁxed-time-step method, while the maximum time
step is considerably greater than the stability threshold.

The method works because the long wavelength eigenmodes of the linear operator decay slowly but
are stable with large ∆t; on the other hand, the short wavelength modes decay rapidly but are only stable
if ∆t is small. Consider a particular cycle of K steps. During the initial large time steps, the long
wavelength modes are efﬁciently damped (because ∆t is large), but the short wavelength modes grow.
This is followed by successively shorter time steps which damp the short wavelength modes.

For the example shown in ﬁg. 5, the stability threshold for ∆t lies between 0.2 and 0.5. Thus we
choose 1/β = 0.05 and 1/α = 1000. With K = 20 this gives a maximum time step of 31.4, a minimum
step of 0.05, and an average time step of 1.95. Since the average time step is about 10 times the largest
time step that can be used in the ﬁxed time step scheme, we expect convergence to be 10 times faster.
Indeed this is the case. The convergence criterion is met after 400 steps at t = 790. This takes about
8 s of CPU time. The variation of R with time is shown in ﬁg. 9. This shows the growth of R during
the large time steps followed by a drop in R as the instabilities are quenched during the small time steps.

29

The overall decay of R with t closely matches that seen with a ﬁxed time step. (This is contrary to the
experience of Hewett etal. with their adaptive code in which the rates of decay are very different.32)

C. Runaway problem

If the electric ﬁeld is sufﬁciently large to produce runaways, i.e., E > v−2

a
steady state is reached which decays at the runaway rate γ (assuming that a linear collision operator is
employed). Because f and all its moments decay at the same rate, γ is given from eq. (61) as

max, then as t

→ ∞

γ =

ﬂux 1
int 1

,

(81)

(82)

(83)

which we will take to be the deﬁnition of γ for all t. Thus we write

f (v, t) = f ′(v, t) exp

t

γ(t′) dt′

,
(cid:19)

−

(cid:18)

0
Z

→ ∞
∂f ′
∂t

+ (A

γ)f ′ = 0,

where γ is given by eq. (81) and f ′(t
we obtain

) is independent of t. If eq. (82) is substituted into eq. (71),

−
where for simplicity we set the inhomogeneous term h to zero. Because γ is expressed as an integral
over f eq. (81), it varies slowly and need not be evaluated very often. Thus eq. (83) may be regarded as
a linear equation and solved in precisely the same way as eq. (71) (with h = 0) except that γ must be
subtracted from bv,i+1/2,j+1/2 eq. (73b).

As an example, ﬁg. 10 shows the steady-state distribution obtained by this method with Zi = 1,
E = 0.06, M = N = 100, vmax = 10, and electron-electron collisions given by Ce/e
Max. Since there
is no rf diffusion term, there are no cross-derivative terms and the steady state is most easily obtained
by taking a constant time step of ∆t = 1. The runaway rate γ is recomputed every ten time steps
and the convergence condition R = 10−9 is met after 820 time steps.
In the steady state, we have
10−5 and J = 0.3133. These are close to the results obtained by Kulsrud et al.,5 namely
γ = 5.211
10−5 and J = 0.3143.
γ = 5.411

Again, it is important to explore the possible errors in these ﬁgures. Extending the boundary to
10−5 and J = 0.4514. While there is practically
vmax = 20 and doubling N to 200 gives γ = 5.210
no change in γ, J is about 50% larger. This discrepancy arises because there is a large contribution to
the total current by the runaways in the region 10 < v < 20. We can verify this by estimating the total
current for an arbitrary vmax on the basis of the results from vmax = 10. For simplicity, assume that all the
runaways are concentrated near v⊥ = 0. From small γ and in the limit t
, the runaway distribution
(γ/E)δ(v⊥). The current obtained by integrating vkf out to
is independent of vk, so that f (vk ≫
v = vmax is then

→ ∞

vt)

×

≈

×
×

J(vmax)

≈

Jbulk + 1

2 (γ/E)v2

max,

where, using the data from vmax = 10, we have Jbulk = 0.270. We can interpret Jbulk as the current
carried by the bulk electrons and the other term as the current carried by the runaways. This now gives
J(vmax = 20) = 0.444 which is within 2% of the observed value. The lesson from this exercise is that
it makes little sense to quote the result for J when the runaway rate is appreciable because it depends
strongly on vmax. It is preferable to determine the bulk current since this is then weakly dependent on
vmax and has a physical interpretation. We have seen that vmax = 10 is sufﬁciently large to give γ and
Jbulk accurately.

In order to determine the effect of the ﬁnite mesh on the runaway results, we vary M and N with
M = N and vmax = 10. The results for γ and J are shown in ﬁg. 11. The asymptotic values are

30

10−5 and J = 0.31334. The errors in the values for M = N = 100 are 0.5% and 0.02%,
γ = 5.185
respectively. The errors are considerably less than with the rf problem in ﬁg. 7 and the convergence is
much more regular (as ∆v2).

×

A disadvantage of solving for the decaying steady state of the distribution, eq. (83), is that S is
no longer divergence free. This means that the stream lines cannot be plotted as contours of a stream
function A, eq. (65). This can be remedied by injecting electrons at the origin to match the runaway loss
of particles. Although this is a rather artiﬁcial problem, there is little error in the runaway rate provided
that the runaway rate itself is small. We implement this procedure as follows: The loss of particles at
v = vmax is

We match this loss by a uniform radial ﬂux at the origin

nγ = ﬂux 1.

which is chosen to give

v2
0Sv,i+1/2,0 =

nγ sin( 1
2π ∆θ

2 ∆θ)

,

2π sin θi+1/2v2

0Sv,i+1/2,0 ∆θ = nγ.

M−1

i=0
X

(The product v2
0Sv,i+1/2,0 is ﬁnite even though Sv,i+1/2,0 is inﬁnite.) From eq. (60), we see that this in-
troduces a source term v2
1/2 ∆v) into the expressions for ∂fi+1/2,1/2/∂t. This is included
as part of the inhomogeneous term h in eq. (71). The expressions for the stream function eqs. (65) require
a slight modiﬁcation to give

0Sv,i+1/2,0/(v2

Ai,j =

γ +

−

sin θi′+1/2Sv,i′+1/2,j ∆θ,

= Ai,0 −

vj′+1/2Sθ,i,j′+1/2 ∆v,

i−1

2πv2
j
n

Xi′=0
2π sin θi
n

j−1

Xj′=0

where the integration constant has been chosen to given A0,j =

γ and AM,j = 0.

The ﬂux plot computed by this method for the case shown in ﬁg. 10, i.e., for Zi = 1, E = 0.06,
M = N = 100, vmax = 10, is shown in ﬁg. 12. When computed in this way, the runaway rate is slightly
10−5 because a typical runaway particle has to be accelerated from v = 0 instead of
lower γ = 5.148
v = 1. The current J = 0.3127 is also lower.

×

−

D. Other methods

An inﬁnitetime step can be used if the Crank–Nicholson scheme, eq. (75), is modiﬁed so that f k+1 is
used in place of 1
2 (f k+1 +f k). Then, the steady state can be achieved in a single time step. Of course, this
entails inverting the large matrix A (which is why we advocated using the alternating-direction-implicit
method in preference to the Crank–Nicholson method). However, routines are available to perform such
an inversion and they have been employed by O’Brien et al..33 An important feature of this method
is the use of disk ﬁles to hold intermediate results. (Typically, the full matrix cannot ﬁt into memory.)
They report a CPU time of 35 s to invert the matrix arising from the discretization of the Fokker–Planck
equation on a 300
min(M, N ). This method is therefore
comparable (as far as CPU time goes) to the Chebyshev acceleration method. There are two potential
drawbacks of this scheme: Firstly, there is a signiﬁcant cost in I/O time with this method because of the
use of disk ﬁles for storage. Secondly, the advantage of the method is reduced if the steady state cannot

100 grid with this time scaling as M N

×

×

31

be reached in a single time step. This is the case with the more complicated collision operators, because
the matrix A is a function of time.

Various iterative methods are available for obtaining a steady-state solution.31 These are basically
approximate methods of inverting the matrix A. Notable is Gauss–Seidel relaxation in which the elements
of f are successively updated to achieve ∂f /∂t = 0 at the point in question.
In line relaxation, a
whole line of elements (for example, j = const) is updated simultaneously (requiring the solution of
a tridiagonal system of equations). Line relaxation gives the same convergence rate as Gauss–Seidel
relaxation and may be vectorized if the even-numbered rows (j = even) are updated in one sweep
followed by the update on the odd-numbered rows.

The odd-even line relaxation method is extended with the successive-over-relaxation method where
the over-relaxation parameter ω determines how much overshoot there is beyond the value of f which
gives ∂f /∂t = 0. Unfortunately, these methods give results which are roughly the same as using ﬁxed
time steps. For the example shown in ﬁg. 5, with the over-relaxation parameter set to ω = 1.4, the
convergence criterion is met after 5980 steps. (Compare this to the 4060 steps required in the ﬁxed-time-
step method. However, one relaxation step tends to be computationally less expensive than one step of
1.5.
the alternating-direction-implicit method.) For this example, the method becomes unstable with ω
Although by themselves relaxation methods are not very useful for this problem, they are an important
ingredient in the multigrid method.34,35 In this method, the problem is solved at several different grid
spacings (usually differing from each other by a factor of two). A few relaxation sweeps are carried
out on the ﬁnest grid. Because relaxation is a local method, this is very effective at damping the short
wavelength modes (with wavelength comparable to grid spacing). If relaxation is continued on the ﬁnest
grid, convergence would become slower because longer wavelength modes would dominate the residue.
However, in the multigrid method, the residue is transferred onto the next coarsest grid where relaxation
methods are again efﬁcient. This process continues recursively up to very coarse grids where either
relaxation methods or direct solution methods can be used.

≥

This method has not been implemented for the Fokker–Planck equation. However, we can estimate
the time required to obtain a steady state. Each relaxation step on the ﬁnest grid gives a reduction in R
by about a factor of two. (The total work at the coarser grids is at most a multiple of the work on the
ﬁnest grid.) In contrast, the mean reduction in R with the Chebyshev method is by 4% per step (see
ﬁg. 9). Thus the multigrid method will require about log(0.5)/ log(0.96)
16 times fewer steps—an
order-of-magnitude improvement over the Chebyshev method.

≈

X. Relativistic Treatment

A. The Fokker–Planck equation

Fokker–Planck methods have been used to study current drive by lower hybrid waves. In a fusion
plasma, these waves will interact with electrons that travel at close to the speed of light. In such cases, it
is necessary to reformulate the equation to include relativistic effects. The ﬁrst change is that the electron
distribution function is expressed in momentum rather than velocity space so that eq. (1) becomes

∂fe
∂t −

s
X

C(fe, fs) +

Sw + qeE

fe = 0,

∇ ·

· ∇

(84)

where now the
∇ ≡
space, and fe is normalized so that

∂/∂p operator operates in momentumspace, Sw is the rf-induced ﬂux in momentum

fe(p) d3p = ne.

Z

32

In spherical coordinates we have

S =

∇ ·

1
p2

∂
∂p

p2Sp +

1
p sin θ

∂
∂θ

sin θSθ,

where cos θ = pk/p.

In addition, the forms of the collision term and the quasilinear diffusion term are altered.

B. The relativistic collision operator

The relativistic collision operator is given by Beliaev and Budker.36 It can again be written as the
, where now we have

divergence of a ﬂux C(fa, fb) =

Sa/b
c

−∇ ·

Sa/b

c =

q2
aq2
b
8πǫ2
0

ln Λa/b

U(u)

fa(p)

Z

·

(cid:18)

∂fb(p′)

∂p′ −

fb(p′)

∂fa(p)
∂p

d3p′.

(cid:19)

(85)

The expression for U is rather complicated.36 However, if either the test or the background species is
weakly relativistic (p

mbc), then U may be approximated by its nonrelativistic form

mac or p′

≪

≪
U(u) =

u2I

uu

u = va −
where vs = p/msγs is the velocity of species s, γs = (1 + p2/m2
factor, and ms is the rest mass.

−
u3

,

v′
b,

sc2)1/2 is the relativistic correction

Despite the resemblance of eq. (85) to eq. (21), this collision operator cannot be readily expressed in
terms of Rosenbluth potentials. However, considerable progress can still be made by working directly
with eq. (85). We restrict our attention to electron-ion and electron-electron collisions.
For collisions off inﬁnitely massive ions, we can take the ions to be stationary v′

0 and evaluate

the integrals to give

where

Ce/i

fe(p)

(cid:0)

(cid:1)

= Γe/e Zi
2vep2

1
sin θ

∂
∂θ

sin θ

fe(v),

∂
∂θ

Γa/b =

nbq2

aq2
b ln Λa/b
4πǫ2
0

(this differs by a factor of m2

a from the deﬁnition given in sec. II).

For electron-electron collisions we start with the case of an isotropic background C

fe(p), f (0)

e

(p)

.

The ﬂuxes for this term are19

i →

(cid:0)

Se/e

cp =

De/e
cpp

+ F e/e

cp fe,

−

−

Se/e
cθ =

De/e
cθθ

∂fe
∂p
∂fe
1
∂θ
p

,

where

p′2f (0)
e

(p′)

dp′ +

p′2f (0)
e

(p′)

dp′

De/e

cpp =

De/e

cθθ =

F e/e

cp =

p

p

0

4πΓe/e
3ne (cid:18)Z
4πΓe/e
3ne (cid:18)Z
4πΓe/e
3ne (cid:18)Z

0

−

p

0

2

v′
e
v3
e
3v2

∞

p
Z
dp′ +

2

v′
e

p′2f (0)
e

(p′)

e −
2v3
e

p′f (0)
e

(p′)

3/c2

3v′

e −

v′
e
v2
e

1
v′
e

,
(cid:19)
1
v′
e

∞

p′2f (0)
e

(p′)

p
Z
dp′ +

∞

p′f (0)
e

p
Z

dp′

,
(cid:19)
(p′)2ve/c2 dp′

.
(cid:19)

33

(86)

(cid:1)

(87a)

(87b)

(88a)

(88b)

(88c)

These should be compared with their nonrelativistic counterparts eqs. (26) and (27).

In the relativistic limit, the Maxwellian distribution eq. (18) becomes37

fem(p) =

4πm2

ecTeK2(Θ−1)

exp

,

E
Te (cid:19)

−

(cid:18)

ne

(89)

where

is the total electron energy,

= mec2γe

E

Θ = Te/mec2 = Te/511 keV,

and Kn is the nth-order modiﬁed Bessel function of the second kind. If we substitute f (0)
(p) = fem(p)
into eqs. (88), we obtain F e/e
ve/Te. Thus we ﬁnd that fem annihilates the electron-
electron collision term C(fem, fem) = 0. The integrals in eq. (88) cannot be performed analytically
with f (0)

(p) = fem(p) and so in the numerical code these are performed numerically.

cp /De/e

cpp =

−

e

e

For the Maxwellian distribution eq. (89), we deﬁne a thermal momentum

a thermal velocity

1
3ne Z
and a thermal collision frequency

v2
te =

e fem(p) d3p =
v2

Te
1
me (cid:18)

5
2

−

Θ +

Θ2 + . . .

55
8

,
(cid:19)

pte =

meTe,

p

νte =

meΓe/e
p3
te

.

For p

≫

pte, the indeﬁnite limits in the integrals in Eq. (88) can be replaced by
cpp = Γe/e v2
te
De/e
v3
e
cθθ = Γe/e 1
De/e

,

, giving38

∞

v2
te
,
v2
e (cid:19)

−

1
2ve (cid:18)
Γe/e v2
te
Tev2
e

.

F e/e

cp =

−

(90a)

(90b)

(90c)

These should be compared with eqs. (28).

For a background which consists of just the ﬁrst Legendre harmonic, the collision term is C
(p) cos θ

. This is given by19

f (1)
e

fem(p),

(cid:0)

(cid:0)

C

fem(p), f (1)

(cid:1)

(p) cos θ

e
fem(p) cos θ
mef (1)
e
γe

(p)

(

=

p

(cid:1)

0
Z

+

1
5

4πΓe/e

ne ×

p′2f (1)
e

(p′)

∞

+

1
5

p
Z

p′2f (1)
e

(p′)

me
Te (cid:20)

me
Te (cid:20)

γe
p2

2

(cid:18)

v′
e
3
γ′
e
v′
e
3
γ′
e
ve
γ3
e (cid:18)
ve
γ3
e (cid:18)

Te
mec2 (4γ′
mev′
e
Te
(cid:18)
Te
mec2 (4γ2
mev2
e
Te

2

+

γ2
e
p2
γ′
e
p′2

+

γ′
e
p′2

34

2 + 6)

e

1
3

−

3

(4γ′
e

−

9γ′
e)
(cid:19)

3

γ′
e

1
3

−

(4γ′
e

2 + 6)

dp′

e + 6)

1
3

(4γ3

e −

−

(cid:19)(cid:21)
9γe)

(cid:19)

γ3
e −

1
3

(4γ2

e + 6)

dp′

.

)

(cid:19)(cid:21)

(91)

[Compare with eq. (34).] The general solution of the linearized electron-electron collision operator
C(fe, fem) + C(fem, fe) = 0 is

·
where a, b, and d are arbitrary constants. With a = d = 0 and b = ˆpk, this provides a useful check on
Eqs. (88) and (91) and their computational realizations.

fe = (a + b

p + d
E

)fem,

In the example we show below, we use the electron-ion collision operator given by eq. (86) and the

relativistic generalization of the truncated collision operator eq. (38)

Ce/e
trunc

fe(p)

= C

fe(p), fem(p)

+ C

fem(p), f (1)

e

(p) cos θ

,

(92)

where the ﬁrst term is given by eqs. (87) and (88) and the second term by eq. (91).

(cid:0)

(cid:1)

(cid:0)

(cid:1)

(cid:0)

(cid:1)

C. Wave-particle interaction

We saw in sec. V that the quasilinear diffusion operator had two principal ingredients: the wave-

particle resonance condition, and the diffusion paths. Both of these are modiﬁed by relativistic effects.

The wave-particle resonance condition becomes

ω

kkvek −

−

nΩe/γe = 0,

where Ωe = qeB/me is the rest-mass cyclotron frequency. Translating this into momentum space gives

−
This modiﬁcation of the resonance condition is important in the consideration of current drive by electron
cyclotron waves.39

p

ω

1 + p2/m2

ec2

kkpk −

nΩe = 0.

The diffusion paths are again given by surfaces of constant energy in the wave frame. The expression

for the energy in a frame moving at (ω/kk)ˆpk is

The diffusion paths are, therefore, given by

These paths are parallel to the vector

′ = E −
1

E

(ω/kk)pk
ω2/k2
kc2

.

−

q

(ω/kk)pk = const.

E −

ω
kk −

vek

ˆp⊥ + ve⊥ˆpk.

(cid:19)
This should be compared with the vector an deﬁned in sec. V. The paths are ellipses or hyperbolae in
momentum space depending on whether ω/kk is less than or greater than c.25

(cid:18)

For lower hybrid waves, we have n = 0 and the diffusion is in the parallel direction. We, therefore,

generalize eqs. (46) by incorporating the modiﬁed resonance condition to read

where

Dw = Dw(p⊥, pk)ˆpkˆpk,

Dw(p⊥, pk) =

(cid:26)

D0,
0,

for v1 < pk/γe < v2,
otherwise.

35

(93a)

(93b)

D. Example

To illustrate the relativistic effects we show in ﬁg. 13 the steady-state distribution function obtained
by integrating the Fokker–Planck equation with electron-electron collisions given by Ce/e
trunc eq. (92) and
electron-ion collisions given by Ce/i eq. (86) with Zi = 1. The quasilinear diffusion term is given by
eq. (93) with D0 = 1, v1 = 0.4c, and v2 = 0.7c. (Except for the perpendicular proﬁle of Dw, this is the
same as the example given in ref. 19.) The integration is carried out with M = N = 100 and pmax = 20.
We normalize all momenta to pte, velocities to pte/me (not vte), the current density to neqepte/me, the
power density to nep2
teνte/me, etc. Again we are principally interested in the current and the power
dissipated. These are deﬁned by

int(ve cos θ)
n
M−1

N

,

J =

P =

1
n

i=0
X

j=0
X

2π sin θi+1/2vjp2

j Swp,i+1/2,j ∆p∆θ,

where int is the generalization of eq. (57) to momentum space, n = int 1. [Compare these expressions
10−4, and
with eqs. (77) and (78).] In the steady state, we ﬁnd J = 3.732
J/P = 29.72.

10−3, P = 1.256

×

×

Again a useful benchmark is provided by the electrical conductivity. In the limit E

0 this is
correctly given if Ce/e
trunc is employed. With E = 10−3, Zi = 1, Θ = 0.01, M = N = 100, and
pmax = 10, we ﬁnd J/E = 7.307, which differs from the true value of 7.291 by about 0.2%. Values of
the conductivity for various values of Zi and Θ are tabulated in table II.

→

XI. Adjoint Method

A.

Introduction and example

We have considered here techniques for solving the Fokker–Planck equation with an added quasi-
linear diffusion term. This tends to be an expensive operation because the addition of the quasilinear
diffusion term greatly increases the parameter space to be scanned. For example, the study of lower hy-
brid current drive6 included the results of some 50 runs with different values of v1 and v2. Even so, no
systematic study was made of the dependence on the parameters D0 and Zi.

However, the amount of work can be drastically reduced using the adjoint method. This was intro-
duced by Hirshman40 for the study of beam-driven currents. Later, Antonsen and Chu41 used it to study
rf-driven currents.

To illustrate the method, we will outline the analysis given by Antonsen and Chu.41 The method
begins by assuming that fe is close to a Maxwellian fem so that the linearized electron-electron collision
operator Ce/e
lin eq. (31) can be used. The quasilinear diffusion term is taken as a given. As pointed out in
sec. V, the Fokker–Planck equation then becomes an inhomogeneous equation, whose linear operator is
independent of the wave drive. Two further assumptions are made, namely that E = 0 and that a steady
state has been reached. (Neither of these assumptions is necessary and they have been relaxed in ref. 42.)
The Fokker–Planck equation is then

C

fe(v)

Ce/e
lin

fe(v)

(cid:0)

≡

=

(cid:1)

(cid:0)
Sw +

∇ ·

+ Ce/i
mev2
(cid:1)
2Te −

fe(v)
3
(cid:0)
2

(cid:19)

(cid:18)

(cid:1)
fem(v)

∂ ln Te
∂t

,

(94)

36

where we have inserted the Chapman–Enskog–Braginskii energy loss term to ensure that eq. (94) has
a solution (i.e., to ensure that the Fokker–Planck equation reaches a steady state). Taking the energy
moment of this equation, and noting that the collision operator is energy conserving, we ﬁnd the equation
for ∂Te/∂t

∂
∂t

3
2

(cid:18)

neTe

= P,

(cid:19)

where P is given by eq. (20).

The straightforward approach is now to solve eq. (94) for a particular Sw, determine the electron
distribution fe, and hence ﬁnd the rf-driven current. The adjoint method gives a way of computing the
current without having to ﬁnd fe. Consider ﬁrst the “adjoint” problem

C

fem(v)χ(v)

=

qevkfem(v),

−

(95)

(cid:1)
where we require that femχ have zero density and zero energy. This is the Spitzer–H¨arm equation for the
perturbed distribution in the presence of an electric ﬁeld E = Teˆvk. Let us multiply eq. (95) by fe/fem
and integrate over velocity. This gives

(cid:0)

where J is the current carried by the electron distribution fe. Now we utilize the self-adjointness of the
linearized collision operator

together with eq. (94) for C(fe) to give

Z

J =

(fe/fem)C(femχ) d3v,

−

Z

ψC(femχ) d3v =

χC(femψ) d3v,

Z

· ∇

J =

Sw(v)

χ(v) d3v.

Z

J
P

=

Sw · ∇
meSw ·

χ d3v
v d3v

.

R
R

Equation (96) is the desired expression for the current. The quantity χ serves as the Green’s function for
the current J. The current drive efﬁciency is given by

(96)

(97)

B. Solving the adjoint equation

In order to apply this method, we must determine χ by solving eq. (95). Because χ(v) consists of only
the ﬁrst Legendre harmonic χ(1)(v) cos θ, this equation reduces to a one-dimensional integro-differential
equation,

1
v2

∂
∂v

v2De/e
cvv

∂χ(1)

∂v −

mev
Te

De/e
cvv

∂χ(1)

∂v −

2De/e

cθθ + Γe/eZi/v
v2

χ(1) + I e/e(χ(1)) + qev = 0,

(98)

where De/e

cvv and De/e

cθθ are given by eqs. (30), and I e/e is deﬁned by

I e/e(χ(1)(v)) =

C(fem(v), fem(v)χ(1)(v) cos θ)
fem(v) cos θ

[see eq. (34)].

37

In general, eq. (98) must be solved numerically. This is done by constructing the partial differential
equation by setting the left-hand side of eq. (98) equal to ∂χ(1)/∂t. The resulting equation is integrated
in time with arbitrary initial conditions until a steady state is reached. The integration is carried out
in the domain 0 < v < vmax and the boundary conditions are taken to be χ(1)(v = 0) = 0 and
∂2χ(1)(v = vmax)/∂v2 = 0.

Approach to the steady state is accelerated by treating the ﬁrst three terms in eq. (98) fully implicitly;
χ(1)(t)]/∆t, we evaluate these terms at t + ∆t. This means that
i.e., in order to compute [χ(1)(t + ∆t)
very large time steps can be used. The integral term I e/e(χ(1)) is treated explicitly and is reevaluated
at each time step. The resulting difference equations form a tridiagonal matrix which can be solved by
Gaussian elimination.

−

Because the adjoint equation is the same as the equation for the perturbed distribution in the presence
of a weak electric ﬁeld, we can solve eq. (98) to obtain values of the electrical conductivity which is
deﬁned by

J
E

=

Z

qevk
Te

4πqe
3Te Z

fem(v)χ(v) d3v =

v3fem(v)χ(1)(v) dv.

This procedure was carried out using the method outlined above with vmax = 15vte, ∆v = 0.001vte, and
∆t = 1000/νte. Because we are only working with a one-dimensional equation, it is possible to use a
much ﬁner mesh than with two-dimensional problems and so obtain results which are effectively “exact.”
The results are summarized in table I where we have also included the results from use of approximate
collision operators. The same technique is easily generalized to relativistic plasmas using the collision
operator given in sec. X. This gives the relativistic corrections to the conductivity which are given in
table II.

When the adjoint method is applied to more complicated situations (e.g., including a dc electric ﬁeld),
a two-dimensional equation must be solved. We can then use many of the techniques for the solution of
the Fokker–Planck equation, which have been presented in the preceding sections.

C. Discussion

Let us assess the work involved in utilizing the adjoint method. Once the adjoint equation has been
solved, the current and the efﬁciency are immediately given in terms of Sw by eqs. (96) and (97). Instead
of having to solve the Fokker–Planck equation afresh for every form of Sw, a couple of velocity integrals
over Sw sufﬁce to give the important quantities. The parameter space that must be scanned in order to
give a complete understanding of the physics is greatly reduced. The adjoint method does not give the
electron distribution fe nor the rf-induced ﬂux Sw. On the other hand, a crude estimate of Sw gives
an accurate estimate of the efﬁciency because eq. (97) involves the ratio of two integrals over Sw. An
effective way to use this method within a ray-tracing code would be to determine Sw from a solution of
the one-dimensional Fokker–Planck equation1 and to use this to determine both J and P from eqs. (96)
and (20). The code thereby beneﬁts from an accurate determination of the current drive efﬁciency while
the high computational costs of integrating the two-dimensional Fokker–Planck equation are avoided.

Because the current drive efﬁciency is determined by a single function χ, it is possible to ask questions
not readily answerable from numerical solutions of the Fokker–Planck equation. Examples are: What is
the asymptotic form for the efﬁciency as the wave phase velocity becomes large? What is the maximum
possible efﬁciency for a particular class of waves?

Besides determining the current, the adjoint method can be adapted to give other moments of the
electron distribution by changing the right-hand side of eq. (XI). This can then give, for example, the
perpendicular energy of the electrons, bremsstrahlung radiation, etc. This method has been used to
determine the current-drive efﬁciency in a relativistic plasma.19 Recent developments of the method42
allow the determination of arbitrary moments of fe (not just the current J), and the determination of the
time development of such moments. These have been applied to the study of rf current ramp-up.43

38

XII. Conclusions

In the last ﬁfteen years, Fokker–Planck codes have gone from esoteric programs developed by a few
researchers which could only be run on a few machines to widely available tools used by a large number
of physicists on many different computers. This has been due to the large increase in computer power
available to the average physicist and the pioneering efforts of Killeen etal..2,3

In this paper, I have given a detailed description of a particular implementation of a code to solve the
Fokker–Planck equation with emphasis on a particular application, namely current drive by lower hybrid
waves. There are many other implementations of this code that have been applied to a large variety of
interesting problems. My goal has been to illustrate the main numerical problems by means of concrete
examples. The methods presented here cover the major numerical problems that are encountered in all
Fokker–Planck codes.

There are two areas which still require attention. Firstly, improved methods for obtaining the steady-
state solution of the Fokker–Planck equation are needed. Here the multigrid method offers the best
promise for substantial savings over the other methods described in this paper. Secondly, the adjoint
methods outlined in sec. XI should be extended and applied to a wider range of problems. Ray-tracing
codes still need to be modiﬁed to accept the results of these calculations.

Acknowledgments

I would like to thank N. J. Fisch for a very fruitful collaboration extending over several years on

various problems in rf current drive, which provided the impetus for the work described here.

This work was supported by the United States Department of Energy under Contract DE–AC02–76–

CHO–3073.

Appendix A. Numerical Techniques

In this appendix, various fragments of code are shown. A two-dimensional Fokker–Planck code is
ideally suited to a vector processing machine like the Cray–1. However, care must be taken to order the
loops correctly, otherwise they will not vectorize.

The ﬁrst example is the computation of the current int(v cos θ) eq. (57). This illustrates the rather
peculiar way in which FORTRAN code must be written in order to take advantage of the Cray–1’s archi-
tecture.44 We assume that the arrays and variables given in table III have been initialized as indicated.

1

2
3

4

dimension temp(0 : iy
do 1 i = 0, iy
−
temp(i) = 0.0

1

1)

−

continue
do 3 j = 0, jx
−
do 2 i = 0, iy
−
temp(i) = temp(i) + x(j)
continue

1
1

3
∗∗

∗

f (i, j)

continue
do 4 i = 0, iy
1
temp(i) = sn(i)

−

continue
cur = 0.0
do 5 i = 0, iy

1

−

cn(i)

temp(i)

∗

∗

39

cur = cur + temp(i)

5

continue
cur = 2.0

pi

dx

dy

cur

∗

∗

∗

∗

The important point is that the inner loop (with label 2) vectorizes. This would not happen if the order
of the loops were reversed. There is no particular advantage in taking the computation of x(j)
3 out
of the inner loop since the CFT compiler does this automatically. The only loop that the compiler treats
inefﬁciently is the last one. In fact, we replace this by a call to the OMNILIB routine ssum.

∗∗

The second example is computing the integral part of the truncated collision operator C

fm(v),
/ cos θ eq. (34). Here again it is easy to arrange so that most of the code vectorizes.4 The

f (1)(v) cos θ
computation of this term is then relatively inexpensive compared with the other computations.

(cid:0)

1), s3 (0 : jx), s5 (0 : jx), f1 (0 : jx

1)

−

(cid:1)

−

1 : jx
−
1
−

dimension s0 (
do 1 j = 0, jx
f1 (j) = 0.0
continue
do 3 i = 0, iy
−
do 2 j = 0, jx
f1 (j) = f1 (j) + 1.5
continue

−

1

1

∗

1

−

−

∗
∗

−
1) = dx

continue
do 4 j = 0, jx
f1 (j)
s0 (j
∗
s3 (j + 1) = s0 (j
1)
s5 (j + 1) = s3 (j + 1)
continue
s3 (0) = 0.5
∗
s5 (0) = 0.5
∗
do 5 j = 1, jx
s3 (j) = s3 (j
s5 (j) = s5 (j
continue
s0 (jx
−
do 6 j = jx
−
s0 (j) = s0 (j + 1) + 0.5
continue
do 7 j = 0, jx
c1 (j) = (s5 (j)/5.0

s3 (1)
s5 (1)
1
1) + 0.5
1) + 0.5

s0 (jx
1

1) = 0.5

−
−
−

∗
2, 0,

−

−

1

1

2
3

4

5

6

7

dy

sn(i)

cn(i)

f (i, j)

∗

∗

∗

x(j)
x(j)

3
2

∗∗
∗∗

∗
∗

−

∗

2)

(s3 (j) + s3 (j + 1))
(s5 (j) + s5 (j + 1))

(s0 (j) + s0 (j

1))

−

+

+ s0 (j)
pi

−
(x(j)

∗
fm(j)

2
∗∗
1.0/3.0)

s3 (j)/3.0)/x(j)

2/5.0

∗∗
−
(f1 (j) + c1 (j))
∗

x(j)

∗

c1 (j) = 4
continue

∗

∗

All the loops vectorize with the exception of the indeﬁnite integration loops (with labels 5 and 6). Most
of the time is spent in the inner loop 2 during the computation of f (1) eq. (15).

Finally, we consider vectorized Gaussian elimination. This subroutine performs Gaussian elimination

for the tridiagonal system of equations

xi,j + 1

2 ∆t(ai,jxi−1,j + bi,jxi,j + ci,jxi+1,j ) = yi,j,

j < m. The coefﬁcients satisfy a0,j = cn−1,j = 0. A substantial fraction
to give xi,j for 0
of the running time of the Fokker–Planck code is spent in this subroutine. When implemented for a single

i < n, 0

≤

≤

40

system of equations m = 1, this leads to “vector dependencies” which inhibit vectorization. The solution
is to solve the m systems in parallel with j being the index for the inner loops. In the subroutine below,
it is assumed that all the matrices are the same size, that the spacing in memory between xi,j and xi+1,j
(the solution direction) is ns, and that the spacing between xi,j and xi,j+1 (the vectorizing direction) is
ms. This subroutine uses x and y as temporary storage; thus the initial data in y are destroyed.

1, 0 : m
1, 0 : m

1),
1),

−
−

−
−

+
+

∗

−
−
−

−
−
−

1, 0 : m
1, 0 : m
1, 0 : m

subroutine solve(x, ns, n, ms, m, a, b, c, y, dt)
dimension x(0 : ms
1), y(0 : ms
1), b(0 : ms
a(0 : ms
c(0 : ms
1)
dt2 = 0.5
dt
do 2 i = 0, n
(i
ia = ns
ib = ns
i
do 1 j = 0, m
den = 1.0/(1.0 + dt2
x(ib, j) = (y(ib, j)
y(ib, j) =
continue

∗
dt2
−
c(ib, j)

(b(ib, j) + a(ib, j)

a(ib, j)
den

x(ia, j))

−
−

1
1)

dt2

∗
∗

∗
∗

−

−

1

∗

∗

∗

y(ia, j)))
den

∗

1
2

3
4

−

2, 0,

continue
do 4 i = n
−
i
ib = ns
ic = ns
(i + 1)
do 3 j = 0, m
1
x(ib, j) = y(ib, j)
continue

∗
∗

−

1

∗

continue
return
end

x(ic, j) + x(ib, j)

There are a couple of tricky points here. Firstly, we use nonstandard indexing into the arrays. The element
xi,j is accessed by the array element x(ns
i will generally exceed the upper
1 on the ﬁrst dimension of the arrays. This type of array indexing may cause problems with
bound ms
compilers that perform bounds checking. Secondly, we have utilized the fact that a(0) = c(n
1) = 0
and assumed that an arbitrary (possibly undeﬁned) number multiplied by zero will give zero. If this is
1 iterations in the loop with label 2 will have to be split off from the
not the case, the i = 0 and i = n
rest of the loop and treated separately.

i, j). If ms = 1, then ns

−

−

−

∗

∗

This subroutine is sufﬁciently general to be used for both the matrix inversions required in imple-

menting eq. (76). Assuming that all the matrices are dimensioned by, for example,

dimension f (0 : iyl

−
then the inversions are obtained by

1, 0 : jxl

1)

−

call solve(xia, iyl, jx, 1, iy, ax, bx, cx, phi, dt)
call solve(xib, 1, iy, iyl, jx, ay, by, cy, xia, dt)

41

References

1N. J. Fisch, Phys. Rev. Lett. 41, 873 (1978).
2J. Killeen and K. D. Marx, in Methods in Computational Physics, edited by B. Alder, S. Fernback, and

M. Rothenberg, volume 9, page 421, Academic, New York, 1970.

3J. Killeen, A. A. Mirin, and M. E. Rensink, in Methods in Computational Physics, edited by B. Alder,

S. Fernback, and M. Rothenberg, volume 16, page 389, Academic, New York, 1976.

4M. G. McCoy, A. A. Mirin, and J. Kileen, Computer Phys. Comm. 24, 37 (1981).
5R. M. Kulsrud, Y.-C. Sun, N. K. Winsor, and H. A. Fallon, Phys. Rev. Lett. 31, 690 (1973).
6C. F. F. Karney and N. J. Fisch, Phys. Fluids 22, 1817 (1979).
7T. A. Cutler, L. D. Pearlstein, and M. E. Rensink, Computation of the bounce average code, Technical

Report UCRL–52233, Lawrence Livermore Laboratory, 1977.
8G. D. Kerbel and M. G. McCoy, Phys. Fluids 28, 3629 (1985).
9Y. Matsuda and J. J. Stewart, Jr., J. Comput. Phys. 66, 197 (1986).
10M. Abramowitz and I. A. Stegun, Handbook of Mathematical Functions, Dover, New York, 1965.
11L. D. Landau, Phys. Z. Sowjet. 10, 154 (1936).
12D. L. Book, The NRL Plasma Formulary, Naval Research Laboratory, Washington, D.C., 1983.
13M. N. Rosenbluth, W. M. MacDonald, and D. L. Judd, Phys. Rev. 107, 1 (1957).
14B. A. Trubnikov, Sov. Phys. JETP. 7, 926 (1958).
15B. A. Trubnikov,

in Reviews of Plasma Physics, edited by M. A. Leontovich, volume 1, page 105,

Consultants Bureau, New York, 1965.

16R. W. Harvey, K. D. Marx, and M. G. McCoy, Nucl. Fusion 21, 153 (1981).
17S. Chapman and T. G. Cowling, The Mathematical Theory of Non-uniform Gases, Cambridge Univer-

18S. I. Braginskii,

in Reviews of Plasma Physics, edited by M. A. Leontovich, volume 1, page 205,

sity Press, Cambridge, 3rd edition, 1970.

Consultants Bureau, New York, 1965.

19C. F. F. Karney and N. J. Fisch, Phys. Fluids 28, 116 (1985).
20N. J. Fisch and C. F. F. Karney, Phys. Fluids 24, 27 (1981).
21L. Spitzer and R. H¨arm, Phys. Rev. 89, 977 (1953).
22C. F. Kennel and F. Engelmann, Phys. Fluids 9, 2377 (1966).
23I. B. Bernstein and D. C. Baxter, Phys. Fluids 24, 108 (1981).
24A. Bers, in Plasma Physics—Les Houches 1972, edited by C. DeWitt and J. Peyraud, page 113, Gordon

and Breach, New York, 1975.

25C. F. F. Karney and N. J. Fisch, Nucl. Fusion 21, 1549 (1981).
26N. J. Fisch and C. F. F. Karney, Phys. Fluids 28, 3107 (1985).
27A. H. Kritz, K. Appert, L. Muschietti, and J. Vaclavik, in Non-Inductive Current Drive in Tokamaks,
Proc. IAEA Technical Committee Meeting, Culham, England, edited by D. F. H. Start, volume I, page
161, 1983.

28S. Succi, K. Appert, W. Core, H. Hamn´en, T. Hellsten, and J. Vaclavik, Comp. Phys. Comm. 40, 137

(1986).

29V. Fuchs, M. M. Shoucri, A. Bers, and R. A. Cairns, Technical Report TV RI 187e, Institut de

Recherche d’Hydro-Qu´ebec, 1985.

30J. S. Chang and G. Cooper, J. Comput. Phys. 6, 1 (1970).
31G. I. Marchuk, Methods of Numerical Mathematics, Springer–Verlag, New York, 1975.

42

32D. W. Hewett, V. B. Krapchev, K. Hizanidis, and A. Bers, Technical Report PFC/RR–84–18, Mas-

sachusetts Institute of Technology, Plasma Fusion Center, 1984.

33M. R. O’Brien, M. Cox, and D. F. H. Start, Comp. Phys. Comm. 40, 123 (1986).
34A. Brandt, Math. Comp. 31, 333 (1977).
35W. Hackbusch and U. Trottenberg, editors, Multigrid Methods, volume 960 of Lecture Notes in Math-

ematics, Springer–Verlag, Berlin, 1982.

36S. T. Beliaev and G. I. Budker, Sov. Phys. Doklady 1, 218 (1956).
37S. R. de Groot, W. A. van Leeuwen, and C. G. van Weert, Relativistic Kinetic Theory, North–Holland,

Amsterdam, 1980.

38D. Mosher, Phys. Fluids 18, 846 (1975).
39R. A. Cairns, J. Owen, and C. N. Lashmore-Davies, Phys. Fluids 26, 3475 (1983).
40S. P. Hirshman, Phys. Fluids 23, 1238 (1980).
41T. M. Antonsen, Jr. and K. R. Chu, Phys. Fluids 25, 1295 (1982).
42N. J. Fisch, Phys. Fluids 29, 172 (1986).
43C. F. F. Karney and N. J. Fisch, Phys. Fluids 29, 180 (1986).
44Cray Research, Inc., CFT, the Cray–1 FORTRAN Compiler, 1984.

43

Tables

TABLE I. The electrical conductivity for various values of the ion charge Zi and for various electron-
electron collision operators. The conductivities are normalized to neq2

e /meνte.

Collision operator
linearized
drifting
Maxwellian
high-velocity

Zi = 1
7.429
6.331
3.773
2.837

Zi = 2
4.377
3.876
2.824
2.310

Zi = 5
2.078
1.932
1.660
1.489

Zi = 10
1.133
1.084
0.998
0.938

TABLE II. The electrical conductivity of a relativistic plasma for various values of the ion charge Zi
and for various electron temperatures. The conductivities are normalized to neq2
e /meνte and the electron
temperatures are given in terms of Θ = Te/mec2.

Θ
0.0
0.01
0.02
0.05
0.1
0.2

Zi = 1
7.429
7.291
7.160
6.807
6.317
5.575

Zi = 2
4.377
4.275
4.180
3.928
3.590
3.102

Zi = 5
2.078
2.019
1.963
1.821
1.636
1.383

Zi = 10
1.133
1.097
1.064
0.979
0.872
0.729

TABLE III. Meaning of FORTRAN variables and arrays.

FORTRAN name
dx
dy
dt
jx
iy
xg(j)
x(i)
yg(i)
y(i)
cg(i)
cn(i)
sg(i)
sn(i)
pi
f (i, j)
fm(j)
cur
f1 (j)
c1 (j)
∗
ax(i, j)
ay(i, j)
phi(i, j)

cn(i)

meaning
∆v
∆θ
∆t
N
M
vj
vj+1/2
θi
θi+1/2
cos θi
cos θi+1/2
sin θi
sin θi+1/2
π
fi+1/2,j+1/2
fm,j+1/2
int(v cos θ)
f (1)(vj+1/2)
C
av,i+1/2,j+1/2
aθ,i+1/2,j+1/2
φi+1/2,j+1/2

(cid:0)

44

fm(v), f (1)(v) cos θ

i+1/2,j+1/2

(cid:1)(cid:12)
(cid:12)

FIG. 1. The cylindrical and spherical coordinate systems.

FIG. 2. The relation between the resonance condition for quasilinear diffusion ω
the diffusion path (v

(ω/kk)ˆvk)2 = const.

kkvk −

−

nΩe = 0 and

−

45

FIG. 3. The numerical grid showing where the distribution function and the ﬂuxes are deﬁned.

FIG. 4. The current as a function of time for Zi = 1, f (t = 0) = fm, and rf diffusion given by eqs. (46)
with D0 = 1, v1 = 3, and v2 = 5. Here we have M = N = 100, ∆t = 0.2, and vmax = 10.
Electron-electron collisions are computed using Ce/e
Max.

46

FIG. 5. The steady-state distribution for the case shown in ﬁg. 4. The contour levels are f = (2π)−3/2
1
exp[
spacing δv = 1

×
2 (j/5)2] for j = integer. This gives equally spaced contours for a Maxwellian distribution with

5 . The resonant region is shown.

−

FIG. 6. The ﬂux plot for the case shown in ﬁg. 5. The plot was obtained by plotting contours of the
stream function A, eq. (65). The contour levels are 2

10−5(j + 1

2 ) for j = integer.

×

47

FIG. 7. The current J (a) and the efﬁciency J/P (b) as functions of ∆v. The parameters are the same as
for ﬁg. 4 except that M and N are allowed to vary with M = N . The plots show the results from runs
with N varying between 100 and 350 in steps of 5 and between 350 and 500 in steps of 50.

48

FIG. 8. The ﬂux plot when Ce/e

trunc is used. The parameters are otherwise the same as for ﬁg. 6.

FIG. 9. R as a function of time when Chebyshev acceleration is applied to the example shown in ﬁg. 5.
Here 1/β = 0.05, 1/α = 1000, K = 20, and f (t = 0) = fm. The convergence criterion R < 10−9 is
met after 400 steps at t = 790.

49

FIG. 10. The steady-state distribution in the presence of a dc electric ﬁeld. Here we have Zi = 1,
E = 0.06, M = N = 100, vmax = 10 and electron-electron collisions are computed using Ce/e
Max. The
contour levels are the same as for ﬁg. 5.

50

FIG. 11. The runaway rate γ (a) and the current J (b) as functions of ∆v. The parameters are the same
as for ﬁg. 10 except that M and N are allowed to vary with M = N . The plots show the results from
runs with N varying between 50 and 300 in steps of 10 and between 300 and 500 in steps of 50.

51

FIG. 12. The ﬂux plot for the runaway problem. This illustrates the same case as shown in ﬁg. 10 except
10−5. One
that a source of particles is introduced at the origin to balance the runaway loss γ = 5.148
set of contour levels is 0.1γ(j + 1
j < 10 (these give the stream lines that
2 ) for j = integer and
run away and the outermost stream lines that encircle the central eddy). The other set of contour levels is
2

2 ) for j = integer and j > 0 (these are the innermost stream lines about the eddy).

10−4(j + 1

10

≤

×

−

×

FIG. 13. The steady-state distribution for Zi = 1, Θ = 0.01 (Te = 5.11 keV), and rf diffusion
given by eq. (93) with D0 = 1, v1 = 0.4c, and v2 = 0.7c. Here we have M = N = 100 and
pmax = 20. Electron-electron collisions are computed using Ce/e
trunc. The contour levels are chosen
1 + Θ(j/3)2/Θ]/[4πK2(Θ−1)] for j = integer which give equally spaced
to be f = √Θ exp[
contours for a relativistic Maxwellian with spacing δp = 1
[For Θ = 0.01 we have K2(Θ−1) =
3 .
p
1/Θ).] The resonant region is shown.
1.019

π/2√Θ exp(

−

−

p

52

