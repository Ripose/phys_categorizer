DEFLECTIONS IN MAGNET FRINGE FIELDS

Y. Papaphilippou∗ and J. Wei

Brookhaven National Laboratory, Upton, New York 11973, U.S.A.

Cornell University, Ithaca, New York 14843, U.S.A.

R. Talman

(Dated: January 30, 2003)

Abstract

A transverse multipole expansion is derived, including the longitudinal components necessarily

present in regions of varying magnetic ﬁeld proﬁle.

It can be used for exact numerical orbit

following through the fringe ﬁeld regions of magnets whose end designs introduce no extraneous

components, i.e. ﬁelds not required to be present by Maxwell’s equations. Analytic evaluations

of the deﬂections are obtained in various approximations. Mainly emphasized is a “straight-line

approximation”, in which particle orbits are treated as straight lines through the fringe ﬁeld regions.

This approximation leads to a readily-evaluated ﬁgure of merit, the ratio of r.m.s. end deﬂection

to nominal body deﬂection, that can be used to determine whether or not a fringe ﬁeld can be

neglected. Deﬂections in “critical” cases (e.g. near intersection regions) are analysed in the same

approximation.

3
0
0
2
 
b
e
F
 
0
2
 
 
]
h
p
-
c
c
a
.
s
c
i
s
y
h
p
[
 
 
1
v
9
6
0
2
0
3
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

∗Present address: European Synchrotron Radiation Facility, BP 220, F-38043 Grenoble Cedex, FRANCE;

Electronic address: yannis@esrf.fr

1

I. STRATEGY AND NOTATION

The purpose of this paper is to derive formulas for the orbit deﬂections caused by the

fringe ﬁelds of non-solenoidal accelerator magnets. The main ingredient is a multipole

expansion for ﬁelds having arbitrary longitudinal proﬁle and including all ﬁeld components

(and only those) required to be present by Maxwell’s equations.

Because terminology describing magnets depends on context, we deﬁne some of our terms,

if only implicitly, by using them in this section. Most magnets in accelerators are “dipoles”,

“quadrupoles” or other “multipoles” where, in this paper, we distinguish by quotation marks

the common names of these magnets from the dipole, quadrupole, multipole, etc., terms ap-

pearing in mathematical expansions of their magnetic ﬁelds. The particle orbits are paraxial,
with small transverse displacements, r = (x2 + y2)1/2, with slopes (x′, y′) ≡ (dx/dz, dy/dz)

small compared to 1 because the orbits are more or less parallel to the z-axis, which is

the magnet centerline. The dominant magnetic ﬁeld components (Bx, By) are therefore

transverse to this axis, and the currents in most accelerator magnets are therefore longitu-

dinal. But actual magnet coils must have radial leads to return the currents and, because

of practical considerations, they also have azimuthal currents.

The standard multipole expansion derives entirely from longitudinal magnet currents

(this includes the bound currents in ferromagnets).

It is only for a long magnet whose

length L is large (for example compared to a typical radial magnetic half-aperture r1/2)

that a single multipole term provides a good approximation to the ﬁeld. Yet, as concerns

the eﬀect of the magnet on a particle orbit, a common idealization is the short magnet or

thin lens approximation, in which the entire deﬂection caused by the magnet occurs at a

single longitudinal position. Even more extreme than our straight line approximation is to

treat the transverse orbit coordinates (x, y) as constant through the entire magnet, body and
ends; the deﬂection (say horizontal) is proportional to a ﬁeld integral of the form ∆x′(x, y) ∼

∞
−∞ B(x, y, z) dz, where B(x, y, z) stands for any one of Bx, By, dBx/dx, dBx/dy, . . . , that is,

either of the transverse magnetic ﬁeld components, or any of their derivatives with respect
R
to x and/or y. Commonly then, one deﬁnes an eﬀective magnet length Leﬀ ≈ L such that

∞
−∞ B(0, 0, z) dz = B(0, 0, 0) Leﬀ. This length is speciﬁc to the particular multipole the

magnet is designed to produce.
R

In spite of the facts that the magnet must be long to

validate the multipole approximation, yet short to validate the thin element treatment, and

2

that discontinuous magnetic ﬁelds violate the Maxwell’s equations, this approximation is

curiously accurate for most accelerator magnets. Because of this good start, it promises

to be eﬀective to improve upon the approximation by assuming that magnets have ideal

multipole ﬁelds within the length Leﬀ , but also to include “end ﬁelds” applicable in regions

of length ∆L− and ∆L+ at input and output ends. In this approximation the transverse

magnetic ﬁelds are continuous, but their derivatives are discontinuous at both ends of the

fringe ﬁeld regions.

In a well-designed magnet, the same multipole that is dominant in the central region is

dominant in the end regions. But the ﬁelds in the end regions are necessarily more com-

plicated and include longitudinal components Bz(x, y, z). Since the ﬁelds in these regions

are, in principle, constrained only by Maxwell equations, rigorous formulas for the deﬂec-

tions they cause can only be evaluated by solving diﬀerential equations appropriate for the

detailed magnet end conﬁguration. To obtain analytic formulas we must make some as-

sumptions, the ﬁrst of which is that the formulation is not intended to apply to “intentional

solenoids” (because of their large azimuthal currents and longitudinal ﬁeld components).

Furthermore the only longitudinal ﬁelds included are those that are required by Maxwell’s

equation to be present in regions of varying longitudinal proﬁle. In other words, the for-

mulas can be expected to be accurate for “well-designed” magnets, in which the dominant

fringe ﬁeld multipolarity matches the body multipolarity. This can, in principle, be assured

by proper shaping of pole ends and proper conformation of the magnet return currents. In

the absence of magnetic ﬁeld measurements in the end regions, this is the only practical

assumption one can make when predicting the fringe ﬁeld deﬂections. If the ﬁelds have been

accurately measured or calculated, to improve on formulas given in this paper, it would be

necessary to separate out the (presumably small) extraneous components and include their

eﬀects perturbatively. One cannot exclude the possibility of end geometries that introduce

multipoles for which the extraneous fringe ﬁelds are large compared to the required fringe

ﬁelds, either intentionally of unintentionally. The present formalism would not be directly

applicable for such ﬁelds.

In this paper, we derive ﬁrst approximations for the deﬂections occurring in the end ﬁeld

regions, of the form ∆x′

− ∼

+ ∼

L+∆L+
L

B(x, y, z) dz [34]. Like

the thin lens approximation, these formulas assume the transverse orbit displacement is

R

0

−∆L− B(x, y, z) dz and ∆x′
R

constant through the end intervals ∆L− and ∆L−. This is a much more valid assumption

3

than assuming constant displacement through the whole magnet if, as is usually true, the

end regions are “short”; ∆L± << L. Furthermore terms proportional to transverse slopes
x′ and y′ can be consistently included, in the formulas for the deﬂections.

A criterion for the validity of treating the end region as short can be based on the

inequality |β′

x,y|∆L±/βx,y << 1., where βx,y and β′

x,y are the usual beta functions and their

derivatives with respect to the longitudinal position z. When this is true the (fractional)

rate of change of multipole strength 1/∆L± is large compared to the (fractional) rate of

change of lattice beta functions.

There is often a tendency to believe that multipole contributions from opposite ends of

a magnet cancel each other. But, since this is not universally valid, in this paper no such

assumption will be made.

II. 3D MULTIPOLE EXPANSION

In this section, a multipole expansion is developed that is appropriate for performing

the calculation just described. This expansion is applicable to magnetic ﬁelds that depend

arbitrarily on the longitudinal coordinate z but, being a power series in the transverse coor-

dinates x and y, its accuracy after truncation to an order n deteriorates at large transverse

amplitudes. The expansion is intended to describe an arbitrary “multipole” magnet along

with its fringe ﬁeld. The formalism presented here generalizes an approach described by

Steﬀen and reduces to formulas he gives in the case of “dipoles” and “quadrupoles” [1].

In the current-free regions to which the beams are restricted, the magnetostatic ﬁeld

B(x, y, z) can be expressed as the gradient of a scalar potential Φ(x, y, z)

B(x, y, z) = ∇Φ(x, y, z) =

x +

y +

z ,

∂Φ
∂x

∂Φ
∂y

∂Φ
∂z

where Φ satisﬁes

An appropriate expansion is

∇2Φ(x, y, z) =

∂2Φ
∂x2 +

∂2Φ
∂y2 +

∂2Φ
∂z2 = 0 .

where the coeﬃcients Cm,n(z) depend on the longitudinal position z[35].

Φ(x, y, z) =

Cm,n(z)

xn ym
n! m!

,

∞

∞

m=0
X

n=0
X

4

(1)

(2)

(3)

Substituting Eq. (3) into Eq. (2), we get a recursion relation for the coeﬃcients;

Cm+2,n = −Cm,n+2 − C[2]

m,n ,

(4)

where in this and subsequent formulas a superscript [l] denotes l diﬀerentiations with respect

to z; in this case l = 2. Now, we can evaluate the gradient of the potential and get the ﬁeld

components in the three Cartesian directions

Bx(x, y, z) =

Cm,n+1(z)

∞

∞

m=0
X
∞

n=0
X
∞

m=0
X
∞

n=0
X
∞

xn ym
n! m!

xn ym
n! m!

Bz(x, y, z) =

C[1]
m,n(z)

xn ym
n! m!

By(x, y, z) =

Cm+1,n(z)

.

(5)

n=0
X
The two-index coeﬃcients Cm,n can be expressed in terms of the usual normal and skew

m=0
X

multipole coeﬃcients which, as well as being conventional, have only one index,

We next seek a representation of the ﬁeld as a function of these coeﬃcients and their deriva-

tives. The relation (4) can be applied recursively to obtain

bn(z) =C1,n(z) =

an(z) =C0,n+1(z) =

(z)

.

(z)

∂nBy
∂xn

(cid:18)

x=y=0
(cid:19) (cid:12)
(cid:12)
∂nBx
(cid:12)
(cid:12)
∂xn
x=y=0
(cid:19) (cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:18)

Cm,n =

(−1)k

C[2l]
m−2k,n+2k−2l

,

k

Xl=0

k
l

(cid:18)

(cid:19)

(6)

(7)

where the upper limit of the series k is equal to the integer part of m/2. This shows that

the coeﬃcients Cm,n can be expressed as a series of even derivatives of C0,n+1 or C1,n. Using

Eq. (6) we can distinguish two cases for m, namely m = 2k (even) or m = 2k + 1 (odd),

and we have

C0,0 = 0,

C2k,n =

(−1)k

a[2l]
n+2k−2l−1,

for n > 0,

.

(8)

C2k+1,n =

(−1)k

b[2l]
n+2k−2l

The requirement C0,0 = 0 corresponds to the restriction to non-solenoidal magnets.

k

Xl=0
k

Xl=0

k
l

k
l

(cid:18)

(cid:19)

(cid:18)

(cid:19)

5

Substituting this representation into Eqs. (5) and rearranging the m-summation yields

b[2l]
n+2m+1−2l

y
2m + 1

+ a[2l]

n+2m−2l

Bx(x, y, z) =

By(x, y, z) =

∞

∞

m

(−1)m

m
l
(cid:18)
Xl=0
(−1)m xn y2m

xn y2m
n! (2m)!

(cid:19)

m

n! (2m)!"

Xl=0 (cid:18)

m+1

n=0
X
∞

m=0
X
∞

n=0
X

m=0
X

b[2l]
n+2m−2l

(cid:18)

m
l

(cid:19)
m + 1
l

Bz(x, y, z) =

∞

∞

m

n=0
X

m=0
X

Xl=0

(−1)m

m
l

(cid:18)

(cid:19)

−

Xl=0 (cid:18)
xn y2m
n! (2m)!

a[2l]
n+2m+1−2l

y
2m + 1 #

(cid:19)

b[2l+1]
n+2m−2l

y
2m + 1

(cid:18)

+ a[2l+1]

n+2m−1−2l

,

(9)

(cid:19)

(cid:19)

again limiting the ranges so the lowest coeﬃcients are b0 ≡ C1,0 and a0 ≡ C0,1.

In an idealized model of a magnet, only one (or in the case of combined function magnets,

two) of the multipole coeﬃcients will be non-vanishing in the body of the magnet (length

Leﬀ) and in this region only the l = 0 terms in the expansions survive. The important

terms are: (m = 0, l = 0) corresponding to the leading “design” multipole; (m = 0, l = 1),

the “next-to-leading” term associated with longitudinal variation of the design multipole;

and (m = 1, l = 0) coming from the next higher body multipole. Examples in this paper

are mainly concerned with the relative importance of the ﬁrst two of these terms in the

deﬂections caused by the actual magnet, including body and ends. The same formulas

could, however, be used to evaluate the relative importance of the second and third terms—

to answer the question “Which are more important, fringe ﬁelds or body ﬁeld imperfection?”

To obtain results concerning the symmetries of the skew and normal multipole coeﬃcients

it is more useful to express these formulas in terms of cylindrical coordinates. This is done

in Appendix A.

In the fringe regions of the magnet, the ﬁelds can be arranged so that they match the

central ﬁelds at the ends of the body region and fall linearly to zero in the fringe regions.

For example, let us keep just one more term as a “next approximation”, arrange its leading

(l = 0) part to match a given body ﬁeld at z = 0, and let it vary linearly with z;

Bx(x, y, z) ≈

By(x, y, z) ≈

Bz(x, y, z) ≈

∞

∞

n=1
X
∞

m=0
X
∞

n=0
X
∞

m=0
X
∞

n=0
X

m=0
X

xn−1 y2m+1
(n − 1)! (2m + 1)!

xn y2m
n! (2m)!

(−1)m

xn y2m+1
n! (2m + 1)!

(−1)m

n+2m + b[1]
b[0]
h
n+2m + b[1]
b[0]
h
(−1)m

n+2m z

b[1]
n+2m

i

n+2m z

i

,

h

i

6

(10)

where the n index has been shifted by 1 in the Bx expansion for convenience in the next

step. Next, we arrange for Bx(x, y, ∆L) = 0 by setting

b[1]
n+2m = −

b[0]
n+2m
∆L

.

(11)

It can be seen that this condition also assures By(x, y, ∆L) = 0. This is a consequence of

the requirement that ∇ × B = 0. Setting B(x, y, z) = 0 for z ≥ ∆L, we have assured that

the transverse ﬁeld components are continuous. Due to the artiﬁcial assumption of linear

fall-oﬀ of the ﬁeld in the fringe region, the longitudinal component Bz is discontinuous in

this approximation.

At this point, the “multipole” magnet has been idealized by a model whose parameters,

apart from its multipolarity index, are its multipole strength b[0]

n+2m, and its lengths Leﬀ

and ∆L±. This representation is appropriate for representing the magnet within a parti-

cle tracking computer program. The lengths ∆L± could be determined by best-ﬁtting to

measured fringe ﬁelds. But, to reduce the number of parameters in the remainder of this

paper, and with some reduction in accuracy, a slightly diﬀerent approach will be taken; the

impulses delivered by the fringe ﬁelds will be evaluated in a way that is independent of the

fringe ﬁeld lengths: all the integrals involved will be computed by using the “hard-edge”

approximation, i.e. taking the limit for which ∆L± → 0.

In this limit the straight line

approximation becomes exact.

For the sake of consistency another point must also be made. Since the dominant mul-

tipole in the magnet body is also dominant in the fringe ﬁeld, there can be an appreciable

contribution to the dominant ﬁeld integral (due to the magnet as a whole) that comes from

the ﬁelds in the fringe regions. It is a matter of taste whether this contribution is to be

treated as part of the main ﬁeld or part of the fringe ﬁeld. In this paper, from here on, to

simplify the formulas somewhat, the term “fringe ﬁeld” will refer to components other than

the dominant component, but restricted to those components necessarily associated with the

dominant multipole. In other words, the contributions from the dominant multipole compo-

nent in the fringe regions will be counted as part of the ideal magnet ﬁeld integral. Treating

the magnet in this way increases its eﬀective length probably making it more nearly equal

to the the physical magnet length; i.e. L ≈ Leﬀ , and this will be assumed in all subsequent

formulas.

7

III. DEFLECTIONS AT MAGNET ENDS

For a given magnet with a perfect 2(n+1)-pole geometry written in cylindrical coordinates

(see Appendix A), the scalar potential satisﬁes the following symmetry condition:

which leads to a relation between the harmonic multipole number allowed by symmetry n′

and the multipole order (n + 1):

Φ(r, θ, z) = Φ(r,

− θ, z) ,

π
n + 1

n′ = (2j + 1)(n + 1) − 1 .

Thus, for a normal “dipole” (n = 0) the multipole coeﬃcients allowed by the magnet sym-

metry are of the form b2j, for a normal “quadrupole” (n = 1) b4j+1, for a normal “sextupole”

(n = 2) b6j+2, etc. Consider now a “multipole magnet”, with normal symmetry, for example.

Following the symmetry condition (13), we can rewrite the ﬁeld components (A7), keeping

terms of the expansion to leading order:

Bx(x, y, z) =Im

By(x, y, z) =Re

Bz(x, y, z) =Im

(x + iy)nbn(z)
n!

−

(x + iy)nbn(z)
n!

−

(x + iy)n+1b[1]

n (z)

(n + 1)!

(

(

(

+ O(n + 3)

)

4(n + 2)!

4(n + 2)!

(x + iy)n+1 [(n + 3)x − i(n + 1)y] b[2]

n (z)

+ O(n + 4)

(x + iy)n+1 [(n + 1)x − i(n + 3)y] b[2]

n (z)

+ O(n + 4)

,

(12)

(13)

)

)

(14)

where the functions O(j) represent polynomial terms in the transverse variables x, y of order

greater or equal to j. These expressions apply for n > 0. The special case of the “dipole”
will be treated separately. Here the terms proportional to b[1]

n approximate the ﬁelds

n and b[2]

present due to the longitudinal ﬁeld proﬁle variation and do not include ﬁelds that could be

present due to non-ideal magnet design.

For a particle traversing the magnet along the straight line having transverse coordinates

(x, y), the impulse (i.e. change of transverse momentum) imparted by the nominal ﬁeld

component is

∆pb

x = − e

By(x, y, z)dz ≈ − ebnLeﬀ

∆pb

y =

Bx(x, y, z)dz ≈ ebnLeﬀ

e

body
R

body
R

Re {(x + iy)n}
n!
Im {(x + iy)n}
n!

8

,

(15)

where Leﬀ =

bn(z)dz/bn is the eﬀective length of the magnet, and bn is the nominal ﬁeld

coeﬃcient in the body of the multipole magnet. The quantities in Eq. (15), the intentional

body
R

and dominant (“zero order”) deﬂections caused by the magnet, are only approximate, since

they account neither for orbit curvature within the body of the magnet nor for end ﬁeld

deﬂections. Expressions like this will be used only as “normalizing denominators” in ratios

having (the presumably much smaller) magnet end deﬂections as numerators. For magnets

other than bending magnets, for which the average deﬂection is zero, it will be necessary to

use r.m.s. values for both the normalizing denominator and the numerator.

The impulse due to the fringe ﬁeld at one end of a magnet is deﬁned in this paper as

the eﬀect of ﬁeld deviation from nominal, from well inside (where the nominal multipole

coeﬃcient is assumed to be independent of z) to well outside the magnet (where all ﬁeld

components are assumed to vanish). These will be the limits for the integrals used in order to

calculate the fringe deﬂection. To obtain explicit formulas the upper limit of these integrals

will be taken to be inﬁnity. Exploiting the assumed constancy of x and y along the orbit,

these integrals will all be evaluated using integration by parts.

Suppressing the entire pure multipole contribution, as explained above, we have

∞
−∞ B(x, y, z)dz ≈ 0. For x = y = 0 this is an equality by deﬁnition, and for ﬁnite

displacements it is approximately true if, as we are assuming, the transverse particle dis-
R

placements remain approximately constant. This is consistent with our straight line orbit

The individual components of the impulse can themselves be separated into terms due

to longitudinal ﬁelds (labeled k) and due to transverse ﬁelds (labeled ⊥);

approximation.

where

fringe
R
are the momentum increments of the particle caused by the longitudinal component of the

magnetic ﬁeld and

∆pf

x,y = ∆pf

x,y(k) + ∆pf

x,y(⊥) ,

∆pf

x(k) =

e

y′Bz(x, y, z)dz

∆pf

y (k) = − e

x′Bz(x, y, z)dz

fringe
R

∆pf

x(⊥) = − e

By(x, y, z)dz

∆pf

y (⊥) =

Bx(x, y, z)dz

e

fringe
R

fringe
R

9

(16)

(17)

(18)

are the momentum increments of the particle caused by the transverse components of the

magnetic ﬁeld. Using the leading order expressions of the magnetic ﬁeld, we obtain the

relations

∆pf

x(k) ≈

Im

(x + iy)n+1

y′

ebn
(n + 1)!

ebn
(n + 1)!

(cid:8)

(cid:8)

(cid:9)

(cid:9)

∆pf

y (k) ≈ −

Im

(x + iy)n+1

x′

,

(19)

Re {(x + iy)n [(n + 1)xx′ + (n + 3)yy′ + i(n − 1)xy′ − i(n + 1)yx′]}

Im {(x + iy)n [(n + 3)xx′ + (n + 1)yy′ + i(n + 1)xy′ − i(n − 1)yx′]}

and

∆pf

x(⊥) ≈

−ebn
4(n + 1)!

∆pf

y (⊥) ≈

ebn
4(n + 1)!

The total impulses caused by the fringe ﬁeld are therefore

∆pf

x ≈ −

ebn
4(n + 1)!

∆pf

y ≈

ebn
4(n + 1)!

Re {(x + iy)n [(n + 1)(x − iy)(x′ + iy′) + 2iy′(x + iy)]}

Im {(x + iy)n [(n + 1)(x − iy)(x′ + iy′) − 2x′(x + iy)]}

Even though they occur at a ﬁxed point in the lattice, because these impulses depend
on slopes x′ and y′ and are truncated Taylor series, they are not symplectic. To use them

in long term, damping-free tracking, symplecticity would have to be restored by including

deviations in transverse coordinates [2, 3, 4, 5].

.

(20)

.

(21)

IV. APPLICATION EXAMPLES

The formulas just derived are appropriate to calculate the end ﬁeld deﬂection of any single

particle. But to assess the importance of these deﬂections it is appropriate to calculate their

impact on the beam as a whole, for example by calculating an r.m.s. deﬂection, such as
(∆pf

y )2i. Here the operator h.i denotes an averaging over angle

x)2i + h(∆pf

h(∆pf

⊥)rms =

variables. Note that here, and from here on, the subscript ⊥ speciﬁes the transverse impulse,

q

and does not refer to a magnetic ﬁeld component. Formulas for r.m.s. values like these are

derived in Appendix B. This section contains examples of the use of those formulas, starting

10

with the cases of ﬂat and round beams, then specializing the results further for “dipole” and

“quadrupole” magnets. The derived formulas are ﬁnally applied for evaluating the impact

of magnets end ﬁelds in the case of the Large Hadron Collider (LHC) and the Spallation

Neutron Source (SNS) accumulator ring. The calculations are based on Eq. (B13).

A. Flat Beam

For a ﬂat beam, one of the transverse degrees of freedom (e.g. the vertical y, y′) vanishes.

Thus, the total transverse r.m.s. momentum increment from the magnet body is

(∆pb

⊥)rms ≡

h(∆pb

x)2i ≈

p

ebnLeﬀ
2nn! s(cid:18)

2n
n

(cid:19)

βnǫn

⊥ ,

where βn represents the average of the βn in the body of the magnet and ǫ⊥ is the transverse

emittance. The total transverse r.m.s. momentum increment from one of the fringes of the

magnet is

these quantities is

(∆pf

⊥)rms ≡

h(∆pf

x)2i ≈

q

ebn
2n+3n!s(cid:18)

2n + 2
n + 1

(cid:19)

βn[1 + (2n + 3)α2]
2(n + 2)

ǫn+2
⊥

,

where β and α represent the beta and alpha functions, at the fringe location. The ratio of

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

ǫ⊥
8Leﬀ s

(2n + 1)βn[1 + (2n + 3)α2]
(n + 1)(n + 2)βn

.

Assuming that the beta functions are not varying rapidly, if the magnets are in non-critical

locations (which is to say most magnets), the square root dependence can be neglected, so an

order-of-magnitude estimate (dropping an n-dependent numerical factor not very diﬀerent

from 1) is given by

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

ǫ⊥
Leﬀ

.

The case in which fringe ﬁeld deﬂections are likely to be most important is when α is

anomalously large, for example in the vicinity of beam waists such as at the location of

intersection points in colliding beam lattices.

In this case, (again dropping a numerical

factor) the ratio of deﬂections is roughly

(22)

(23)

(24)

(25)

(26)

(∆pf
(∆pb

⊥)rms
⊥)rms

≈ α

ǫ⊥
Leﬀ

.

11

The same result is obtained by setting βx >> βy in Eqs. (B13).

Often the relative deﬂection is so small as to make neglect of the fringe ﬁeld deﬂection

entirely persuasive. The simplicity of the formula is due to the fact that the fringe contri-

bution is expressed as a fraction of the dominant contribution. Note that, as stated before,

this formula applies to each end separately, and does not depend on any cancellation of the

contributions from two ends. In fact, nonlinear analysis shows that in magnets fringe-ﬁeld

contributions can tend to add up instead of cancelling [3].

B. Round beam

For a round beam, the two transverse emittances are equal ǫx = ǫy = ǫ⊥. For simplicity,

we assume that typical values of horizontal and vertical lattice functions are approximately

equal; βx ≈ βy = β and αx ≈ αy = α. Also assume that βn ≈ β

, i.e. the beta functions

n

do not vary signiﬁcantly in the body of the magnet. Taking into account the previous

hypotheses, the total transverse r.m.s. momentum increment for the body becomes:

(∆pb

⊥)rms ≈

ebnLeﬀ
2n/2n!

n/2

ǫn/2
⊥

β

3F2(1/2, −n, −n; 1, 1/2 − n; 1)
(cid:20)

1/2

(2n − 1)!!
n!

(cid:21)

,

(27)

where the function in the square root represents the generalized Hyper-geometric function

(see [6] for details). Applying the same simpliﬁcations, the r.m.s. momentum kick given by

the fringe ﬁeld is:

(∆pf

⊥)rms ≈

n

ebnβn/2ǫn/2+1
2n+3(n + 1)! "

⊥

2(n − l)
n − l

2l
l

1/2

#

gn,l(α2)

,

(28)

Xl=0 (cid:18)
where we considered βx ≈ βy = β and the same for the α functions. Notice now that the
sum of the coeﬃcients gn,l = gn,l,0 + gn,l,1 + gn,l,2 depends only on α2. The series involving

(cid:19)(cid:18)

(cid:19)

them can be also written as a sum of a few generalized Hyper-geometric functions. The

ratio of the r.m.s. momentum transverse kicks is:

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

ǫ⊥
Leﬀ

β

βn/2
n/2 Cn(α2) ,

(29)

where the coeﬃcient Cn is:

Cn(α2) =

1
8(n + 1) "

n!

n
l=0

2(n−l)
n−l

2l
l

gn,l(α2)

1/2

3F2(1/2, −n, −n; 1, 1/2 − n; 1)(2n − 1)!!#
(cid:1)(cid:0)

(cid:0)

(cid:1)

P

.

(30)

12

Let us consider two cases, as before: one where α is small and one where α is large, as near

the interaction points of large colliders. For the ﬁrst case (α small), we may neglect the

terms having α as a factor in the coeﬃcient gn,l and in the second case, we can pull out α

from the square root and neglect terms in the coeﬃcient gn,l having now the α function in

the denominator. In this way, the coeﬃcients Cn of Eq. (30) will depend only on the order

n. We plot in Figs. 1, the behavior of these coeﬃcients as a function of the multipole order

n, for large and small α. The dominant factor in Cn seems to be 1/(n + 1), which is reﬂected

in the slow asymptotic decay depicted at the plots. For all practical cases (multipole orders

up to 20), Cn lies between 1/2 and 1/10. Assuming now that the average β in the body of

the magnet is not so diﬀerent from β in the fringe, one gets for small α functions:

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

ǫ⊥
Leﬀ

,

(∆pf
(∆pb

⊥)rms
⊥)rms

≈ α

ǫ⊥
Leﬀ

,

(31)

(32)

as in Eq. (25), and for α large:

as in Eq. (26).

C. Dipole magnet

Consider a “straight” dipole magnet; the conﬁguration of poles and coils is symmetric

about the x = 0 and y = 0 planes, and the coils are excited with alternating signs and equal

strength. By symmetry Bx is odd in both x and y, By is even in both x and y, and Bz is

even in x and odd in y. Using the general ﬁeld expansion of Eq. (9), we get:

∞

m

m,n=0
X
∞

Xl=0
m

m,n=0
X
∞

Xl=0
m

Bx =

By =

Bz =

(−1)mx2n+1y2m+1
(2n + 1)!(2m + 1)!

m
l

b[2l]
2n+2m+2−2l

m
l

(−1)mx2ny2m
(2n)!(2m)!

(cid:18)
(−1)mx2ny2m+1
(2n)!(2m + 1)!

(cid:19)
m
l

(cid:18)

(cid:19)

b[2l]
2n+2m−2l

b[2l+1]
2n+2m−2l

.

(33)

(cid:19)
m,n=0
X
Taking the ﬁeld expansion up to leading order, we get:

Xl=0

(cid:18)

b[2]
0 y2 +

b2(x2 − y2) + O(4)

,

(34)

Bx = b2xy + O(4)

1
2

By = b0 −
Bz = y b[1]

0 +O(3)

1
2

13

where b2 represents a sextupole ﬁeld component allowed by the symmetry of the “dipole”

magnet (for an ideally designed magnet b2 = 0) and O(3) and O(4) contain all the allowed

terms of higher orders.

A point has to be made about the application of the integrals evaluating the rms momen-

tum kicks for bending magnets: because of the curved central orbit, these integrals are not

exact, as previously mentioned. Nevertheless, in most practical cases, the ﬁeld uniformity in

the interior of a “dipole” magnet is very high, and thus, on heuristic grounds, this approach

can be expected to provide fairly good estimates even in this case.

The change of transverse momentum imparted by the dipole ﬁeld is (see Eq. (15))

∆pb = −e

b0dz ≈ −eb0Leﬀ ,

Zbody

where as before Leﬀ =

body b0dz/b0 is the eﬀective length of the “dipole” magnet, and b0 is
the main dipole ﬁeld in the body of the “dipole” magnet. Using Eq. (18) the deﬂections in

R

one fringe are

∆pf

x ≈ 2eb0yy′

,

∆pf

y ≈ −eb0yx′

,

and the total r.m.s. fringe kick is

(∆pf

⊥)rms = eb0

4hy2y′2i + hy2x′2i .

q

Using Eqs. (B10) and (B11), we have

hy2y′2i =

(1 + 3α2

y)ǫ2
y

8

,

hy2x′2i = hy2ihx′2i =

(1 + α2

x)βyǫxǫy
4βx

,

and the r.m.s. transverse momentum kick becomes

(∆pf

⊥)rms = eb0

(1 + 3α2

y)ǫ2
y

(1 + α2

+

x)βyǫxǫy
4βx

,

s

8

Thus, the by-now-standard ratio is

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

1
Leﬀ s

(1 + 3α2

y)ǫ2
y

(1 + α2

+

x)βyǫxǫy
4βx

.

8

(35)

(36)

(37)

(38)

(39)

(40)

Except for numerical factors near one this formula yields the same “ball-park” estimates as

given by Eq. (31) and Eq. (32) for the small α and large α cases.

14

D. “Quadrupole” magnet

The conﬁguration of poles and coils in a “quadrupole” magnet is symmetric about the

four planes x = 0; y = 0; x = y; x = −y and if the coils are excited with alternating signs

and equal strength, the magnetic ﬁeld will satisfy the following symmetry conditions: Bx

is even in x and odd in y; By is odd in x and even in y; Bz is odd in both x and y; and

Bz(x, y, z) = Bz(y, x, z). As before, we may express the ﬁeld components as:

b[2l]
2n+2m+1−2l

.

(41)

b[2l]
2n+2m+1−2l

Bx =

By =

Bz =

∞

m

m,n=0
X
∞

Xl=0
m

m,n=0
X
∞

Xl=0
m

m,n=0
X

Xl=0

(−1)mx2ny2m+1
(2n)!(2m + 1)!

m
l

(cid:18)

(cid:19)

m
l

(−1)mx2n+1y2m
(2n + 1)!(2m)!

(cid:18)
(−1)mx2n+1y2m+1
(2n + 1)!(2m + 1)!

(cid:19)

m
l

(cid:18)

(cid:19)

b[2l+1]
2n+2m+1−2l

Bx = y

By = x

Bz = xyb[1]

b1 −

1
12
1
12
1 + O(4)

b1 −

(cid:20)

(cid:20)

(3x2 + y2)b[2]
1

+ O(5)

(3y2 + x2)b[2]
1

+ O(5)

,

(cid:21)

(cid:21)

The ﬁeld expansion can be written as

(42)

(43)

(44)

where b1(z) is the transverse ﬁeld gradient at the quadrupole axis, and O(4), O(5) contain

all the higher order terms. For a particle traversing the magnet with a horizontal deviation

x and vertical deviation y from the center, the momentum increments produced by the

nominal ﬁeld gradients are

∆pb

x = −eb1xLeﬀ ,

∆pb

y = eb1yLeﬀ ,

where Leﬀ =

body b1dz/b1 is the eﬀective length of the quadrupole magnet. The momentum
increments of the particle contributed from the longitudinal component of the magnetic ﬁeld

R

are

∆pf

x(k) ≈ exyy′b1 ,

∆pf

y (k) ≈ −exyx′b1 ,

and the momentum increment produced by the transverse component of the fringe ﬁelds are

∆pf

x(⊥) ≈

2xyy′ + (x2 + y2)x′

,

∆pf

y (⊥) ≈

2xx′y + (x2 + y2)y′

.

(45)

eb1
4

(cid:2)

(cid:3)

(cid:3)

15

−eb1
4

(cid:2)

Combining the contributions, the total momentum increments due to fringe ﬁeld are

∆pf

x ≈

∆pf

y ≈

eb1
4
eb1
4

2xyy′ − (x2 + y2)x′

(cid:3)
(cid:2)
−2xx′y + (x2 + y2)y′

.

(cid:3)

(46)

1/2 .

(cid:3)
ǫxǫ2
y

(cid:3)

(cid:27)

(47)

Again, by averaging the sum of squares of the transverse momenta contribution, we obtain

the total rms transverse momentum kick imparted by the fringe ﬁeld:

(∆pf

⊥)rms ≈

eb1
16

(1 + 5α2

x)βxǫ3

x +

(1 + α2

y)β2

x − 8αxαyβxβy + 2(1 + 3α2

x)β2
y

ǫ2
xǫy

(cid:26)
+(1 + 5α2

y)βyǫ3

y +

(cid:2)
(1 + α2

x)β2

y − 8αxαyβxβy + 2(1 + 3α2

y)β2
x

(cid:2)

3
βy
3
βx

(cid:2)

Note that the expected rotation symmetry of the quadrupole is exhibited both in this formula

and in the body deﬂection formula. The standard ratio is

(1 + 5α2

x)β2

xβyǫ3

x − 8αxαyβxβy + 2(1 + 3α2

x)β2
y

ǫ2
xǫy

(∆pf
(∆pb

⊥)rms
⊥)rms

≈

1
8Leﬀ (
y ǫ3

(1 + 5α2

y)βxβ2

y + 3βy

(1 + α2

x)β2

+

y)β2

x + 3βx

(1 + α2
2βxβy(βxǫx + βyǫy)
y − 8αxαyβxβy + 2(1 + 3α2

(cid:2)

y)β2
x

ǫxǫ2
y

1/2

(cid:3)

)

2βxβy(βxǫx + βyǫy)

(cid:2)

(cid:3)

.

(48)

Again dropping factors near 1, this leads to the same ball-park estimates of Eq. (31) and

Eq. (32) .

E. Magnets of LHC and SNS

The LHC and the SNS accumulator ring are good examples for testing the validity of

the derived fringe ﬁeld ﬁgure of merit formulas. Indeed, the purpose of these two proton

machines and thereby their magnet design diﬀers in great extent: the LHC, a high-energy

hadron collider, is ﬁlled with long super-conducting magnets of very small aperture (around

1 cm). In contrast, the SNS ring, a low-energy high intensity accumulator, contains short

normal conducting magnets with wide aperture (tens of cm). In addition, the lattice design,

optics functions and physical parameters of the two machines are substantially diﬀerent, e.g.

the emittance of the SNS beam is several orders of magnitude bigger, than the one of the

LHC. In Table I, we summarize the parameters of the main magnets in the two accelerators

entering in the ﬁgure of merit formulas (40) and (48).

16

In Fig. 2, we plot in logarithmic scale the fringe-ﬁeld ﬁgure of merit estimates for the

LHC and the SNS accumulator ring magnets. The black bars represent evaluation with the

exact formulas derived for dipoles and quadrupoles (see Eqs. (40) and (48)) and the grey

bars represent the evaluation with the formula for round beams (31). In both cases, the

total eﬀect for each magnet is computed by summing up the fringe-ﬁeld ﬁgures of merit from

both ends due to all the magnets of the same type. The fringe ﬁeld importance in the case

of the SNS is striking, especially for quadrupole magnets, whereas in the case of the LHC

can be completely neglected. Note that similar results can be derived by careful dynamical

analysis and computation of tune-shifts due to fringe ﬁelds or dynamic aperture analysis

for both the LHC [7] and the SNS [8]. It is important to stress that even the approximate

formula for round beams (31) is slightly pessimisitic and within a factor of 2 of the exact

ﬁgure of merit.

V. CONCLUSION

We have derived formulas for the momentum kicks imparted by the fringe ﬁelds of general

straight (non-solenoidal) multipole magnets. These formulas are based on an expansion

having arbitrary dependence on the longitudinal coordinate. This expansion can be used for

direct integration of the equations of motion for particle tracking or other analytical non-

linear dynamics estimates. It also permits the fringe part and the body part of individual

magnets to be identiﬁed and separated. A ﬁgure of merit, the ratio of r.m.s. end deﬂection

to r.m.s. body deﬂection is introduced and evaluated. Its proportionality to the transverse

emittance results in an easily-evaluated measure of the importance of fringe ﬁelds both in

cases in which the variation of optical functions is not too rapid and in the opposite case

of rapid variation. These results are in agreement with previous crude estimations which

employed simple physics arguments based on Maxwell laws [9]. Finally, the formalism has

been applied to the most common cases of multipole magnets, namely normal “dipoles” and

“quadrupoles” [10]. Since the straight line approximation has been used throughout, these

formulas are only precise for magnetic ﬁelds that are well-approximated by step functions

(the “hard-edge” approximation). Thus, the formulas contain no parameters associated with

the fringe shape (for example, see [11, 12]). Also, as stated previously, only those fringe ﬁelds

matching, and therefore required by, the nominal body multipolarity are accounted for.

17

Numerical evaluation of the end/body ﬁgure of merit shows that fringe ﬁelds can be

neglected in the magnets populating the arcs of large colliders like the LHC. In these rings,
the magnets are long enough and the emittances are so small (of the order of 10−9 m rad)

that the eﬀect of fringe ﬁelds is a tiny perturbation as compared to the dominant multipole

errors in the body of the magnets. The eﬀect may be important, however, in small rings,

as the SNS accumulator ring [8] or the muon collider ring [13], where the emittance is large
(typically 10−4 m rad) and the magnets much shorter. Careful consideration should be also

taken in the case of the magnets located in the interaction regions of the collider [14], where

the beta variation is quite big.

It is perhaps appropriate to call attention to possible “overly optimistic” use of the

scaling law. Often quadrupoles are grouped in doublets or triplets in which the desired

focal properties rely on the intentional, highly-tuned, near cancellation of deﬂections caused

by more than one element. In such cases, the fringe deﬂections are, of course, ampliﬁed,

when evaluated relative to the gross multiplet deﬂection. This eﬀect is most obvious at focal

points.

Since the early analytical studies of Lee-Whiting [15] and Forest [2, 3], signiﬁcant progress

has been achieved for the construction of accurate maps which represent the motion of

particles through the magnet fringe ﬁeld, using either direct numerical evaluation with exact

integration of the magnetic ﬁeld [16, 17] or parameter ﬁt of an adequate function [18, 19, 20]

(e.g.

the Enge function [21]). These maps are essential for the study of non-linearities

introduced by fringe-ﬁelds through Hamiltonian perturbation theory techniques. On the

other hand, the scaling law we have emphasized can provide a rough estimate of the impact

of these fringe ﬁelds in a ring. If the fringe ﬁelds are found to be important, a thorough

numerical modelling and analysis of their eﬀect has to be undertaken, including computation

of the amplitude dependent tune-shift, resonance excitation and dynamic aperture [8, 11,

12, 22, 23, 24, 25, 26], as non-linear dynamics can be very sensitive to the details of diﬀerent

lattices and magnet designs. Furthermore, great care is required to preserve symplecticity

and use these maps in particle tracking.

18

APPENDIX A: 3D MULTIPOLE EXPANSION, CYLINDRICAL COORDI-

NATES

treated.

The magnetic ﬁeld representation in Cartesian coordinates (x, y, z) is not optimal for

studying symmetries imposed by the cylindrical geometry of a perfect multipole mag-

net. For this, it is preferable to rely on expansions in cylindrical coordinates (r, θ, z) =

(

x2 + y2, arctan (y/x), z) [2, 3, 16, 27, 28, 29, 30]. Both expansions are equivalent and

the use of the former or the latter depends mostly on taste and the speciﬁc problem to be
p

First, consider the magnetic scalar potential written in the following form [2, 3]

Φ(r, θ, z) = Re

ei(n+1)θ

Gn+1,m(z)rm

,

(A1)

∞

∞

(

n=0
X

m=0
X

)

where now the z–dependent coeﬃcients Gn+1,m(z) are generally complex. The above expan-

sion follows directly from the fact that the Laplacian commutes with ∂/∂θ [3]. This allows

the consideration of solutions where the dependence in θ is an harmonic 2(n + 1)-pole. This

expansion is compatible with the general solution of the Laplace equation in cylindrical

coordinates, involving Bessel functions [16, 31, 32].

Using Eq. (A1) and the Laplace equation, one gets that Gn+1,0 = 0. Moreover, Gn+1,1,

should vanish for n > 0 (all terms except the dipole). Finally, we have a recursion relation [3,

30] similar to Eq. (4):

Gn+1,m+2(z) =

G[2]
n+1,m(z)
(n + 1)2 − (m + 2)2

for m 6= n − 1 ,

(A2)

where again the superscript in brackets denotes derivatives with respect to z. Following

these relations, one can show that all coeﬃcients with m < n + 1 vanish. Thus, the ﬁrst

non-zero coeﬃcient is Gn+1,n+1 (for m = n + 1). By extending the recursion relation (A2) so

as to express any coeﬃcient as a function of Gn+1,n+1, we get:

Gn+1,n+1+2k(z) =

(−1)k(n + 1)!
22k(n + 1 + k)!k!

G[2k]
n+1,n+1(z) .

(A3)

The summation indexes can be rearranged so as to express the magnetic scalar potential in

cylindrical coordinates [3, 33]:

Φ(r, θ, z) = Re

ei(n+1)θ

∞

∞

(−1)k(n + 1)!
22k(n + 1 + k)!k!

G[2k]
n+1(z) rn+1+2k

,

(A4)

)

(

n=0
X

Xk=0

19

and the three-dimensional ﬁeld components are:

Br(r, θ, z) = Re

ei(n+1)θ

∞

∞

(−1)k(n + 1 + 2k)(n + 1)!
22k(n + 1 + k)!k!

G[2k]
n+1(z) rn+2k

)

Bθ(r, θ, z) = −Im

ei(n+1)θ

(−1)k(n + 1)!(n + 1)
22k(n + 1 + k)!k!

G[2k]
n+1(z) rn+2k

.

(A5)

Bz(r, θ, z) = Re

ei(n+1)θ

(−1)k(n + 1)!
22k(n + 1 + k)!k!

G[2k+1]
n+1

(z) rn+1+2k

(

n=0
X

∞

(
∞

n=0
X

(

n=0
X

Xk=0
∞

Xk=0
∞

Xk=0

)

)

The coeﬃcients Gn+1 ≡ Gn+1,n+1 can be related with the usual multipole coeﬃcients, through

Eqs. (6). First, we write the scalar magnetic potential in Cartesian coordinates:

Φ(x, y, z) = Re

∞

∞

(

n=0
X

Xk=0

(−1)k(n + 1)!
22k(n + 1 + k)!k!

G[2k]
n+1(z) (x + iy)n+1(x2 + y2)2k

.

(A6)

)

The magnetic ﬁeld components are computed by the gradient of the potential (A6):

Bx(x, y, z) = Re

(x2 + y2)k−1(x + iy)n+1 ×

(−1)k(n + 1)!
22k(n + 1 + k)!k!

(

Xn,k=0

[(n + 1 + 2k)x − i(n + 1)y] G[2k]

n+1(z)

By(x, y, z) = Im

(x2 + y2)k−1(x + iy)n+1×

.

(A7)

(−1)k(n + 1)!
22k(n + 1 + k)!k!

(

Xn,k=0

)

)

[−(n + 1)x + i(n + 1 + 2k)y] G[2k]

n+1(z)

(−1)k(n + 1)!
22k(n + 1 + k)!k!

(x + iy)n+1(x2 + y2)2kG[2k+1]

(z)

n+1

)

∞

∞

∞

Bz(x, y, z) = Re

(

Xn,k=0

Using Eqs. (6), we get:

bn(z) = − (n + 1)! Im{Gn+1(z)} − n!

an(z) = (n + 1)! Re{Gn+1(z)} + n!

(−1)k(n + 1 − 2k)(n + 1 − 2k)!
22k(n + 1 + k)!k!

Im{G[2k]

n+1−2k(z)}

(−1)k(n + 1 − 4k)(n + 1 − 2k)!
22k(n + 1 + k)!k!

Re{G[2k]

n+1−2k(z)}

n/2

Xk=1
n/2

Xk=1

,

(A8)

where the upper limit of both series is the integer part of n/2. Thus, in the absence of

longitudinal dependence of the ﬁeld, the normal and skew multipole coeﬃcients are just

20

scalar multiples of the imaginary and real part of Gn+1(z). On the other hand, the situation

is more complicated in the case of 3D ﬁelds. By inverting the series (A8), we have:

Im{Gn+1(z)} = −

Rnor

n,k b[2k]

n−2k(z)

Re{Gn+1(z)} =

Rsk

n,ka[2k]

n−2k(z)

1
n!

1
n!

n/2

Xk=0
n/2

Xk=0

,

(A9)

where the coeﬃcients Rsk

n,k and Rnor

n,k can be computed order by order by the j + 1 relations

Rnor

n,0 =

Rsk

n,0 =

1
(n + 1)

1
(n + 1)

,

,

j

Xk=0
j

Xk=0

(−1)k(n + 1 − 2k)(n + 1 − 2k)!
22k(n + 1 + k)!k!

Rnor

n−2k,j−k = 0

(−1)k(n + 1 − 4k)(n + 1 − 2k)!
22k(n + 1 + k)!k!

Rsk

n−2k,j−k = 0

,

(A10)

and j runs from 1 to the integer part of n/2. Using the last relations, the scalar potential

and the magnetic ﬁeld can be expressed as a function of the usual multipole coeﬃcients. By

expanding the complex polynomials in the expression of the magnetic ﬁeld components, one

recovers the expansions of the magnetic ﬁelds (9) in Cartesian coordinates.

APPENDIX B: EVALUATION OF R.M.S. END DEFLECTIONS

In order to evaluate the r.m.s. deﬂection caused by a magnet end, we start from the

expressions (21) by splitting the product inside the brackets:

∆pf

x ≈ −

ebn
4(n + 1)!

∆pf

y ≈

ebn
4(n + 1)!

Re {(x + iy)n} [(n + 1)xx′ + (n − 1)yy′]

h
+ Im {(x + iy)n} [−(n + 3)xy′ + (n + 1)x′y)]
i

Re {(x + iy)n} [(n + 1)xy′ − (n + 3)x′y]

h
+ Im {(x + iy)n} [(n − 1)xx′ + (n + 1)yy′)]
i

.

(B1)

The total r.m.s.

transverse momentum kick imparted by the fringe ﬁeld is (∆pf

⊥)rms =

h(∆pf

x)2i + h(∆pf

y )2i, where the operator h.i denotes the average over the angle variables.

q
An equivalent expression stands for the deﬂection due to the body part of the ﬁeld. The

h.i operator is linear, we can ﬁrst compute the sum of squares of the momentum kicks and

21

1/2

#

1/2

(cid:11)(cid:3)

then proceed to their averaging. Thus, we have:

(∆pf

⊥)rms ≈

hf1 (Re {(x + iy)n})2 + f2 (Im {(x + iy)n})2

ebn
4(n + 1)!"

+2f3Re {(x + iy)n} Im {(x + iy)n}i

,

(B2)

where f1, f2 and f3 are:

ebnLeﬀ
n!

(cid:2)(cid:10)

(∆pb

⊥)rms ≈

(Re {(x + iy)n})2 + (Im {(x + iy)n})2

f1 = (n + 1)2x2(x′2 + y′2) + y2

(n + 3)2x′2 + (n − 1)2y′2

− 8(n + 1)xx′yy′

(cid:2)
(n − 1)2x′2 + (n + 3)2y′2

f2 = x2

(cid:3)

+ (n + 1)2y2(x′2 + y′2) − 8(n + 1)xx′yy′

.

(B3)

(cid:2)
−(n + 1)(x2 + y2)x′y′ + xy(x′2 + y′2)

(cid:3)

f3 = 4

(cid:2)

We have the following relations for the real and imaginary part of (x + iy)n:

Re {(x + iy)n} =

(−1)l

xn−2ly2l

(cid:3)

n
2l

(cid:18)

(cid:19)

[n/2]

Xl=0

Im {(x + iy)n} =

[(n−1)/2]

Xl=0

(−1)l

n
2l + 1

(cid:18)

(cid:19)

xn−2l−1y2l+1

and thus:

,

(B4)

(Re {(x + iy)n})2 =

n

+ Re

(x + iy)2n

(cid:1)

(cid:8)
+ (−1)l

(cid:9)(cid:3)
x2n−2ly2l

2n
2l

(cid:18)

(cid:19)(cid:21)

(Im {(x + iy)n})2 =

n

− Re

(x + iy)2n

(cid:1)

(cid:8)
− (−1)l

(cid:9)(cid:3)
x2n−2ly2l

2n
2l

(cid:18)

(cid:19)(cid:21)

,

(B5)

x2 + y2
n
(cid:2)(cid:0)

n
l

Xl=0 (cid:20)(cid:18)

(cid:19)

x2 + y2
n
(cid:2)(cid:0)
Xl=0 (cid:20)(cid:18)

n
l

(cid:19)

1
2
1
2

1
2
1
2

1
2
1
2

=

=

=

Im
n

Xl=0

22

Re {(x + iy)n} Im {(x + iy)n} =

(x + iy)2n

(cid:8)
(−1)l

2n
(cid:9)
2l + 1

(cid:18)

(cid:19)

x2n−2l−1y2l+1

where the upper limit of the last sum is taken to be l = n for uniformity in the equations,

instead of the last non-zero term for which l = n − 1. Finally, it is straightforward to show

that

(Re {(x + iy)n})2 + (Im {(x + iy)n})2 = (x2 + y2)n =

x2n−2ly2l

.

(B6)

n

n
l

Xl=0 (cid:18)

(cid:19)

After expanding the products in Eq. (B2) and collecting the terms of equal power in the

transverse variables, we have that the transverse kicks can be written in the following form:

(∆pf

⊥)rms ≈

(Ω1 + Ω2 + Ω3 + Ω4 + Ω5 + Ω6)

ebn
4(n + 1)! "

n

Xl=0

1/2

#

,

(B7)

(∆pb

⊥)rms ≈

ebnLeﬀ
n!

n

n
l

x2n−2l

y2l

"

Xl=0 (cid:18)

(cid:19)

(cid:10)

#

(cid:11)

(cid:11) (cid:10)

1/2

where the Ωk’s are

Ω1 = (ω1(n, l) + ω2(n, l)) hx2n−2l+2x′2ihy2li

Ω2 = (ω3(n, l) + ω4(n, l)) hx2n−2lx′2ihy2l+2i

Ω3 = (ω3(n, l) + ω5(n, l)) hx2n−2l+2ihy2ly′2i

Ω4 = (ω1(n, l) + ω6(n, l)) hx2n−2lihy2l+2y′2i

Ω5 = ω7(n, l)hx2n−2l−1x′ihy2l+3y′i

Ω6 = (ω7(n, l) + ω8(n, l)) hx2n−2l+1x′ihy2l+1y′i

,

(B8)

with the coeﬃcients ωk’s:

n
l

ω1(n, l) =

n2 + 1

ω3(n, l) =

(cid:0)

(cid:18)

(cid:19)
(cid:1)
n2 + 4n + 5

(cid:18)
ω5(n, l) = −2 (n + 2) (−1)l

(cid:1)

(cid:0)

n
l

(cid:19)
2n
2l

ω2(n, l) = 2n(−1)l

2n
2l
2(5n + 2ln + 2)(−1)l
2l + 1

(cid:18)

(cid:19)

−2l(2n + 1)(−1)l
2l + 1

(cid:18)
2n
2l

(cid:18)

(cid:19)

2n
2l

ω4(n, l) =

ω6(n, l) =

(cid:19)

.

(B9)

ω7(n, l) =

(cid:19)
−8(n + 1)(n − l)(−1)l
2l + 1

(cid:18)

2n
2l

(cid:18)

(cid:19)

ω8(n, l) = −8 (n + 1)

n
l

(cid:18)

(cid:19)

23

In order to proceed to the averaging of the transverse variables, we write them in the standard

form

{x, y} =

ǫx,yβx,y Cx,y,

{x′, y′} =

(Sx,y + αx,yCx,y) ,

(B10)

where ǫx,y are the transverse emittance associated with the corresponding phase space di-

p

mension, βx,y, αx,y are the usual beta and alpha functions and Cq, Sq stand for cos φq, sin φq,

respectively. Using the above relations and averaging over the angle variables φq one can

ǫx,y
βx,y

r

show that:

hq2mi

=

2m
m

(cid:18)

(cid:19)

q ǫm
βm
q
22m

hq2mq′2i =

2m
m

(cid:18)

(cid:19)(cid:2)

1 + (2m + 1)α2
q

βm−1
q
22m+1(m + 1)

ǫm+1
q

.

(cid:3)

(B11)

hq2m+1q′i =

2(m + 1)
m + 1

αqβm

q ǫm+1
q
22m+2

(cid:18)

(cid:19)

Then, the Ωk’s become:

Ω1 = (ω1(n, l) + ω2(n, l))

Ω2 = (ω3(n, l) + ω4(n, l))

Ω3 = (ω3(n, l) + ω5(n, l))

Ω4 = (ω1(n, l) + ω6(n, l))

2(n − l)
n − l

2(n − l)
n − l

2(n − l)
n − l

2(n − l)
n − l

(cid:18)

(cid:18)

(cid:18)

(cid:18)

(cid:19)(cid:18)

(cid:19)

(cid:19)(cid:18)

(cid:19)

(cid:19)(cid:18)

(cid:19)

2l
l

2l
l

2l
l

2l
l

(cid:19)(cid:18)

(cid:19)

(2n − 2l + 1)[1 + (2n − 2l + 3)α2

x]βn−l
22n+2(n − l + 1)(n − l + 2)

x βl

yǫn−l+2

x

ǫl
y

(2l + 1)[1 + (2n − 2l + 1)α2

x]βn−l−1
22n+2(n − l + 1)(l + 1)

x

βl+1
y

ǫn−l+1
x

ǫl+1
y

(2n − 2l + 1)[1 + (2l + 1)α2

y]βn−l+1
22n+2(n − l + 1)(l + 1)

x

βl−1
y

ǫn−l+1
x

ǫl+1
y

.

(2l + 1)[1 + (2l + 3)α2

y]βn−l
22n+2(l + 1)(l + 2)

x βl

yǫn−l

x

ǫl+2
y

Ω5 = ω7(n, l)

2(n − l)
n − l

2l
l

(2l + 1)(2l + 3)αxαyβn−l−1

βl+1
y
22n+2(l + 1)(l + 2)

x

ǫn−l
x

ǫl+2
y

(cid:18)

(cid:19)(cid:18)

(cid:19)

Ω6 = (ω7(n, l) + ω8(n, l))

2(n − l)
n − l

2l
l

(2n − 2l + 1)(2l + 1)αxαyβn−l

x βl
22n+2(n − l + 1)(l + 1)

yǫn−l+1

x

ǫl+1
y

(cid:18)

(cid:19)(cid:18)

(cid:19)

(B12)

24

After collecting terms of equal emittances, the r.m.s. transverse momentum kicks can be

expressed as:

(∆pf

⊥)rms ≈

n

ebn
2n+3(n + 1)! "

Xl=0 (cid:18)

2(n − l)
n − l

2l
l

(cid:19)(cid:18)

(cid:19)

βn−l
x βl

yǫn−l

x

ǫl
y

gn,l,m(αx,y, βx,y)ǫm

x ǫ2−m

y

2

m=0
X

1/2

(∆pb

⊥)rms ≈

n

ebnLeﬀ
2nn! "

n
l

2(n − l)
n − l

2l
l

(cid:19)(cid:18)

(cid:19)

βn−l
x βl

yǫn−l

x

ǫl
y

#

Xl=0 (cid:18)

(cid:19)(cid:18)

1/2

#

,

(B13)

where the bars on the β’s denote their average values over the body of the magnet. The

coeﬃcients gn,l,m, given by

gn,l,0(αx,y, βx,y) =

(n2 + 1)(2l + 1)

n
l

(cid:0)

(cid:1)

− 2l(2n + 1)(−1)l
(l + 1)(l + 2)

(cid:0)

(cid:1)(cid:3)

2n
2l

[1 + (2l + 3)α2
y]

−

8(n + 1)(n − l)(2l + 3)(−1)l
βx(l + 1)(l + 2)

2n
2l

αxαyβy

(cid:0)

(cid:1)

gn,l,1(αx,y, βx,y) =

(n2 + 4n + 5)(2l + 1)

n
l

(cid:0)

(cid:1)

+ 2(5n + 2ln + 2)(−1)l
βx(n − l + 1)(l + 1)

2n
2l

(cid:0)

(cid:1)(cid:3)

[1 + (2n − 2l + 1)α2

x]βy

,

(n2 + 4n + 5)

− 2(n + 2)(−1)l

(2n − 2l + 1)[1 + (2l + 1)α2

y]βx

n
l

(cid:0)

(cid:1)

2n
2l
βy(n − l + 1)(l + 1)
(cid:0)

(cid:1)(cid:3)

(cid:2)

(cid:2)

+

(cid:2)

−

8(n + 1)

(2l + 1)

(2n − 2l + 1)αxαy

n
l

2n
+ (n − l)(−1)l
2l
(n − l + 1)(l + 1)

(cid:0)

(cid:1)

(cid:0)

(cid:1)(cid:3)

(cid:2)

n
l

gn,l,2(αx,y, βx,y) =

(n2 + 1)

+ 2n(−1)l

2n
2l

(2n − 2l + 1)[1 + (2n − 2l + 3)α2
x]

(cid:2)

(cid:0)

(cid:1)

(n − l + 1)(n − l + 2)

(cid:0)

(cid:1)(cid:3)

(B14)

depend on the twiss functions αx,y, βx,y and on the multipole order n. One may note

that r.m.s. transverse momentum kick of the fringe is represented by the square root of a

polynomial of order n + 2 in the transverse emittances ǫx and ǫy as compared to the square

root of a polynomial of order n representing the body contribution (see also [3]). Thus, their

ratio should be proportional to the transverse emittance. This scaling law is indeed exact

for the case of the “dipole” and “quadrupole”. For higher order “multipoles”, it is exact for

ﬂat and round beams (Sec. IV).

25

APPENDIX C: ACKNOWLEDGEMENTS

The authors would like to thank A. Jain for useful suggestions regarding the magnetic

ﬁeld expansions, E. Keil for his criticism in an early version of this work and R. Baartman

for many useful comments and discussion. This work was performed under the auspices of

the U.S. Department of Energy.

[1] K.G. Steﬀen, High Energy Beam Optics (Interscience, New York, 1965).

[2] E. Forest and J. Milutinovic, Nucl. Instrum. Methods 269, 474 (1988)

[3] E. Forest, Beam Dynamics - A new attitude and framework, (Harwood Acad. Pub., Amster-

dam, 1998).

[4] J. Irwin and C. Wang, Explicit soft fringe maps of a quadrupole, Proceedings of the Particle

Accelerator Conference, Dallas, 1995, (IEEE Piscataway NJ, 1996), p. 2376.

[5] R. Baartman, Intrinsic Third Order Aberrations in Electrostatic and Magnetic Quadrupoles,

in Proceedings of the 6th European Particle Accelerator Conference, Stockholm, 1998, edited

by S. Myers et al., (Institute of Physics, London and Philadelphia, 1998), p. 1415.

[6] I.S. Gradshteyn and I.M. Ryzhik, Table of Integrals, Series, and Products, Corrected and

enlarged edition, (Academic Press Inc., San Diego, CA, 1980).

[7] F. M´eot, Particle Accelerators, 55, 329 (1996).

[8] Y. Papaphilippou and D.T. Abell, Beam dynamics analysis and correction of magnet ﬁeld

imperfections in the SNS accumulator ring, in Proceedings of the 7th European Particle Accel-

erator Conference, Vienna, 2000, edited by J.-L. Laclare et al., (Austrian Academy of Science

Press, Vienna, 2000), p. 1453.

[9] J. Wei and R. Talman, Particle Accelerators 55, 339 (1996).

[10] J. Wei, Y. Papaphilippou and R. Talman, Scaling law for the impact of magnet fringe ﬁelds,

in Proceedings of the 7th European Particle Accelerator Conference, Vienna, 2000, edited by

J.-L. Laclare et al., (Austrian Academy of Science Press, Vienna, 2000), p. 1092.

[11] M. Venturini, Scaling of third-order quadrupole aberrations with fringe ﬁeld extension, in

Proceedings of the Particle Accelerator Conference, New York, 1999, edited by A.U. Luccio

and W.W.MacKay, (IEEE Piscataway NJ, 1999), p. 1590.

26

[12] M. Berz, B. Erd´elyi and K. Makino, PRST-AB 3:124001 (2000).

[13] M. Berz, B. Erd´elyi and K. Makino, Fringe-ﬁeld eﬀects in muon rings, (preprint).

[14] W. Wan, C. Johnstone, J. Holt, M. Berz, K. Makino, M. Lindemann and B. Erd´elyi, Nucl.

Instrum. Methods, 427, 74 (1999).

[15] G.E. Lee-Whiting, Nucl. Instrum. Methods 83, 232 (1970).

[16] M. Venturini and A.J. Dragt, Nucl. Instrum. Methods 427, 387 (1999).

[17] A.J. Dragt, D.R. Douglas, F. Neri, E. Forest, L.M. Healy, P. Sch¨utt, J. van Zeijts, MARYLIE

3.0 User’s Manual, University of Maryland, Physics Department Report, 1999 (unpublished).

[18] G.H. Hoﬀst¨atter and M. Berz, Phys.Rev E 54, 5664 (1996).

[19] B. Erd´elyi, M. Berz and M. Lindemann, Diﬀerential algebra based magnetic ﬁeld computations

and accurate ﬁeld maps, (preprint).

[20] K. Makino and M. Berz, Nucl. Instrum. Methods 427, 338 (1999).

[21] H.A. Enge, Deﬂecting magnets, in Focusing of charged particles, volume 2, edited by A. Septier

(Academic Press, NY and London 1967).

[22] E. Forest, D. Robin, A. Zholents, M.Donald, R.Helm, J. Irwin and H. Moshammer, Sources of

amplitude dependent tune shift in the PEP-II design and their compensation with octupoles,

Proceedings of the 4th European Particle Accelerator Conference, London, 1994, edited by

V. Suller and C. Petit-Jean-Genaz, (World Scientiﬁc, River Edge NJ 1994), p. 1033.

[23] F. Zimmermann, Tune shift with amplitude induced by quadrupole fringe ﬁelds, CERN-SL-

2000-009 AP, 2000 (unpublished).

[24] F. Zimmermann, C. Johnstone, M. Berz, B. Erd´elyi and K. Makino and W. Wan, Fringe

ﬁelds and dynamic aperture in the FNAL muon storage ring, CERN-SL-2000-011, 2000 (un-

published).

[25] F. Zimmermann, Fringe ﬁelds, dynamic aperture and transverse depolarisation in the CERN

muon storage ring, CERN-SL-2000-012 AP, 2000 (unpublished).

[26] M. Berz, B. Erd´elyi and K. Makino, Nucl. Instrum. Methods, 472, 533 (2001).

[27] G.T. Danby, S.T. Lin and J.W. Jackson, Three-Dimensional properties of magnetic beam

transport elements, in Proceedings of the National Particle Accelerator Conference, Washing-

ton D.C., 1967, (IEEE Transactions on Nuclear Science 14, No. 3, 1967), p. 442.

[28] K.L. Brown and R.V. Servranckx, First- and second-order charged particle optics, in Proceed-

ings on Physics of High Energy Particle Optics, BNL/SUNY Summer School, 1983, edited by

27

n
C

0.4

0.35

0.3

0.25

0.2

0.15

0.1

0.05

0.4

0.3

0.2

0.1

n
C

0

20

80

100

0

20

80

100

40
60
order

40
60
order

FIG. 1: Order dependent coeﬃcient of the momentum increment ratio, for a round beam (see

Eq. (30)), when the α function is small (left) and when the α function is large (right).

M. Month, P.F. Dahl and M. Dienes (American Institute of Physics Conference Proceedings

No.127, New York, 1985), p. 62.

[29] M. Bassetti and C. Biscari, Particle Accelerators 52, 221 (1995).

[30] C.J. Gardner, Three-dimensional ﬁeld expansions in magnets: A primer, BNL/SNS Technical

Note No.53, 1998 (unpublished).

[31] J.D. Jackson, Classical Electrodynamics, 3rd edition, (John Wiley and Sons, New York, 1999).

[32] A. Jain, Basic theory of magnets, in Proceedings of CERN Accelerator School on Measurement

and Alignment of Accelerator Magnets, edited by S. Turner, (CERN Yellow Report 98-05,

[33] A.B. El-Kareh and J.C. El-Kareh, Electron Beams, Lenses and Optics (Academic Press, New

[34] In most cases, one limit of each integral can be taken to inﬁnity, because of the rapid fall oﬀ

[35] The spatial dependence of function Φ can guide the shaping of the pole pieces of iron magnets

to match, as closely as possible, equipotentials of Φ. This is discussed by Steﬀen [1] for the

Geneva, 1998), p. 1.

York, 1970).

of the ﬁeld.

case of quadrupoles.

28

Exact evaluation

Approximation

t
i
r
r
e
m

 
f
o
 
e
r
u
g
i
f
 
d
l
e
i
f
-
e
g
n
i
r
F

1

10- 1

10- 2

10- 3

10- 4

10- 5

10- 6

10- 7

LHC
T r i plet s

LHC Arc
Quadrupoles

LHC Arc Dipoles

SNS Dipoles

SNS Quadrupoles

FIG. 2: Fringe-ﬁeld ﬁgure of merit estimates for the LHC and the SNS accumulator ring magnets.

The two diﬀerent bars in each case represent evaluation with the exact formulas derived for the

fringe-ﬁeld ﬁgure of merit of Eqs. (40) and (48) (black bars) and the approximate formula for round

beams (31) (grey bars).

maximum value.

Magnet

TABLE I: Parameters associated with the LHC and SNS magnets, whose fringe-ﬁeld ﬁgure of

merit is evaluated in Fig. 2. When two numbers occur, they are associated to the minimum and

LHC Quadrupole Triplets

LHC Arc Quadrupoles

LHC Dipoles

SNS Dipoles

SNS Quadrupoles

Number Leﬀ [m]

368

1104

3.1

βx,y [m]

βx,y [m]
|αx,y| [m] ǫx,y [m rad]
16 5.5 – 6.37 1055 – 4463 1157 – 4401 1.1 – 203.9 5.03 10−10
7.82 10−9
7.82 10−9
4.8 10−4
4.8 10−4

52 0.5 – 0.7

1.1 – 1.9

0.5 – 2.4

0.5 – 2.6

40 – 143

32 – 178

28 – 176

32 – 176

2 – 28

2 – 26

0 – 8

4 – 8

14.3

1.5

32

6

29

