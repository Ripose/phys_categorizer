6
0
0
2
 
r
a

M
 
1
3
 
 
]
h
p
-
c
c
a
.
s
c
i
s
y
h
p
[
 
 
1
v
9
6
2
3
0
6
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

DEUTSCHES ELEKTRONEN-SYNCHROTRON

in der HELMHOLTZ-GEMEINSCHAFT

DESY 06-037

April 2006

Statistical Optics approach to the design of
beamlines for Synchrotron Radiation

Gianluca Geloni, Evgeni Saldin, Evgeni Schneidmiller and
Mikhail Yurkov
Deutsches Elektronen-Synchrotron DESY, Hamburg

ISSN 0418-9833

NOTKESTRASSE 85 - 22607 HAMBURG

Statistical Optics approach to the design of
beamlines for Synchrotron Radiation

Gianluca Geloni a Evgeni Saldin a Evgeni Schneidmiller a
Mikhail Yurkov a

aDeutsches Elektronen-Synchrotron (DESY), Hamburg, Germany

Abstract

In this paper we analyze the image formation problem for undulator radiation
through an optical system, accounting for the inﬂuence of the electron beam emit-
tance. On the one hand, image formation with Synchrotron Radiation is governed
by the laws of Statistical Optics. On the other hand, the widely used Gaussian-
Shell model cannot be applied to describe the coherence properties of X-ray beams
from third generation Synchrotron Radiation sources. As a result, a more rigorous
analysis of coherence properties is required. We propose a technique to explicitly
calculate the cross-spectral density of an undulator source, that we subsequently
propagate through an optical imaging system. At ﬁrst we focus on the case of an
ideal lens with a non-limiting pupil aperture. Our theory, which makes consistent use
of dimensionless analysis, also allows treatment and physical understanding of many
asymptotes of the parameter space, together with their applicability region. Partic-
ular emphasis is given to the asymptotic situation when the horizontal emittance is
much larger than the radiation wavelength, which is relevant for third generation
Synchrotron Radiation sources. First principle calculations of undulator radiation
characteristics (i.e. ten-dimensional integrals) are then reduced to one-dimensional
convolutions of analytical functions with universal functions speciﬁc for undulator
radiation sources. We also consider the imaging problem for a non-ideal lens in pres-
ence of aberrations and a limiting pupil aperture, which increases the dimension of
the convolution from one to three. In particular we give emphasis to cases when the
intensity at the observation plane can be presented as a convolution of an impulse
response function and the intensity from an ideal lens. Our results may be used in
practical cases as well as in benchmarks for numerical methods.

Key words:
X-ray beams, Undulator radiation, Transverse coherence, Image formation,
Emittance eﬀects
PACS: 41.60.m, 41.60.Ap, 41.50 + h, 42.50.Ar

Preprint submitted to Elsevier Science

22 July 2013

Contents

Introduction

1

2

5

6

Elements and deﬁnitions of image formation theory

2.1 Wave propagation in free space

2.2

Image formation with coherent light

2.2.1

Large non-limiting aperture

2.2.2

Eﬀect of aperture size

2.3

Propagation of partially coherent light in free space

2.4

Image formation with partially coherent light

2.4.1

Large non-limiting aperture

2.4.2

Eﬀect of aperture size

3

Image formation with a perfectly coherent undulator source

4

Image formation with partially coherent undulator source

4.1 Coherence properties of undulator source in the presence of electron

3.1

Large non-limiting aperture

3.2

Eﬀect of aperture size

beam emittance

4.2

Large non-limiting aperture

4.3

Eﬀect of aperture size

Imaging of quasi-homogeneous Gaussian undulator sources by a
lens with large non-limiting aperture

5.1 Evolution of the cross-spectral density function in free space

5.2 Evolution of the cross-spectral density function behind the lens

Imaging of quasi-homogeneous non-Gaussian undulator sources by
a lens with large non-limiting aperture

6.1 Source with non-Gaussian angular distribution in the vertical

direction

3

6

13

13

17

20

22

25

28

29

30

32

38

43

46

46

53

54

56

56

60

63

64

7

8

10

11

12

13

6.2 Source with non-Gaussian intensity distribution in the vertical

direction

Analysis of the image formation mechanism for quasi-homogeneous
undulator sources in terms of Geometrical Optics

Imaging of quasi-homogeneous undulator sources: eﬀect of aperture
size

8.1 Quasi-homogeneous Gaussian undulator sources

8.2 Quasi-homogeneous non-Gaussian undulator sources

8.2.1

Source with non-Gaussian angular distribution in the vertical
direction

8.2.2

Source with non-Gaussian intensity distribution in the
vertical direction

9

Aberrations and imaging of quasi-homogeneous sources

9.1 Aberrations and the eﬀect of aperture size

9.2

Severe aberrations

9.2.1

Physical Optics prediction of the line spread function

9.2.2

Physical Optics and Geometrical Optics

9.2.3 Geometrical Optics prediction of the line spread function

A uniﬁed theory of incoherent imaging by a single lens

Pinhole optics

Imaging in the focal plane

Depth of focus

13.1 Large non-limiting aperture

13.1.1 Far zone

13.1.2 Near zone

13.2 Eﬀect of aperture size

14

Solutions to the image formation problem for non-homogeneous
undulator sources

4

67

73

86

86

96

96

98

100

101

108

108

111

115

119

135

140

142

144

145

146

147

149

14.1 Horizontally quasi-homogenous and vertically non-homogeneous

14.1.1 Large non-limiting aperture

14.1.2 Eﬀect of aperture size

source

source

14.2 Horizontally non-homogeneous and vertically diﬀraction limited

14.3 General imaging considerations

15

Supplementary remarks on quasi-homogeneous undulator source
asymptotes

16

Conclusions

150

150

156

159

161

164

169

5

1

Introduction

The majority of experiments based on the use of X-rays are carried out at Syn-
chrotron Radiation facilities, as very high brilliance is achievable by means of
undulator devices installed in storage rings. Guiding the photons from the exit
of an undulator to the specimen position requires the development of optical
beamlines whose main task is to re-image the undulator source to any plane
of interest. To deal with the image formation problem, one should account for
the fact that Synchrotron Radiation constitutes a random stochastic process.
In fact, the shot noise in the electron beam causes ﬂuctuations of the elec-
tron beam current density. These ﬂuctuations are random both in space and
time. As a result, the radiation ﬁeld produced by the electron beam can be
described in terms of a phasor with random amplitudes and phases and, in all
generality, the laws of Statistical Optics must be applied to solve the image
formation problem. In this paper we study the image formation problem with
undulator radiation beams based on Statistical Optics. In this framework,
the basic quantity characterizing Synchrotron Radiation sources is the second
order correlation function of the ﬁelds at two observation points on a given
transverse plane identiﬁed by the coordinate zo along the optical beamline.
Once such a plane is ﬁxed, the two points, P1 and P2, are fully characterized
by their transverse coordinates ~r⊥1 and ~r⊥2 respectively. Our presentation will
be given in the frequency domain. Due to the limited temporal resolution of
detectors in Synchrotron Radiation experiments, the analysis in frequency do-
main is much more natural than that in the time domain. As a consequence
of this choice, and without restrictive assumptions on the system, we study
the spatial correlation between Fourier transforms of the electric ﬁeld 1 at a
ﬁxed frequency ω, that is the cross-spectral density

G =

¯E (zo, ~r⊥1, ω) ¯E∗ (zo, ~r⊥2, ω)
E

D

.

(1)

In Eq. (1) ¯E is the complex amplitude of the Fourier transform of a given
Cartesian component of the electric ﬁeld at the space-frequency point (zo, ~r⊥, ω),
the asterisk denotes complex conjugation, and brackets < ... > indicate an
ensemble average over electron bunches. Since we study an ultra-relativistic
system, the paraxial approximation can always be enforced so that, here, the
electric ﬁeld is understood to obey the paraxial wave equation [1]. The cross-
spectral density carries all information about the transverse characteristics of
undulator radiation. A fully general study of the cross-spectral density is not a
trivial one. Diﬃculties arise when one tries to include simultaneously the eﬀect
of intrinsic divergence of the radiation, due to the presence of the undulator, of

1 Since our analysis deals with the electric ﬁeld in frequency domain, we will some-
times refer to the ”Fourier transform of the electric ﬁeld” simply as ”the ﬁeld”,
when this does not generate confusion.

6

the electron beam size and of the electron beam divergence. In [2] a technique
was described, based on Statistical Optics, to calculate the cross-spectral den-
sity from undulator sources in the most general case 2 , at any position after
the undulator but still without optical elements (i.e. in free space). Although
self-contained, the present study relies on that work. Expressions from [2] will
be taken as a starting point to proceed along the optical beamline towards
the specimen position.

In general, as we will see, undulator radiation can be thought as originating
from an equivalent source localized on a transverse plane at a given longitudi-
nal position. By deﬁnition, such source has the following property: it produces
a ﬁeld which coincides with that from the undulator at any distance from the
exit of the undulator. In particular, we localize the equivalent source in the
center of the undulator, that will be conventionally taken as the beamline
origin z = 0. Since in this case the equivalent source does not reproduce the
real electromagnetic ﬁeld distribution in the center of the undulator, we refer
to it as virtual source. Further on, throughout this paper we assume that the
beta functions of the electron beam have their minimal value in the center of
the undulator. By this, as we will see, the virtual source exhibits particular
properties which simplify our treatment. Once the concept of virtual source
is introduced, the problem of describing radiation characteristics at a certain
observation plane after a given optical element is twofold. First, one has to
characterize the cross-spectral density at the virtual source and, second, one
has to propagate the cross-spectral density along the optical beamline to the
observation plane.

Let us ﬁrst consider the problem of characterizing the source. An important
simpliﬁed model which admits an analytical description without loss of essen-
tial information about the source features is obtained by letting both horizon-
tal and vertical electron beam emittances be much larger than the radiation
λ/(2π)). This is a good assumption for second genera-
wavelength (ǫx,y ≫
tion Synchrotron Radiation sources. The kind of virtual source obtained for
λ/(2π) belongs to the wider class of quasi-homogeneous ones. These are
ǫx,y ≫
characterized by the fact that the cross-spectral density at the virtual source
plane (i.e. at z = 0) can be written as:

G(~r⊥1, ~r⊥2, ω) = I (~r⊥1, ω) g(~r⊥2

~r⊥1, ω) ,

where

I (~r⊥1, ω) =

E (~r⊥1, ω)
|
|

D

2

E

2 With the point of view of the source parameters.

−

7

(2)

(3)

−

~r⊥1, ω) is the spectral degree
is the ﬁeld intensity distribution and g(~r⊥2
of coherence (normalized, by deﬁnition, so that g(0, ω) = 1). The deﬁnition
of quasi-homogeneity amounts to a factorization of the cross-spectral density
as the product of the ﬁeld intensity distribution and the spectral degree of
coherence, which contains information about the spatial correlation. A set of
necessary and suﬃcient conditions for such factorization to be possible follows:
(a) the radiation intensity at the virtual source varies very slowly with the
position across the source on the scale of the ﬁeld correlation length and (b)
the spectral degree of coherence depends on the positions across the source
only through the diﬀerence ~r⊥2

~r⊥1.

−

There are situations when the Statistical Optics description is not the only
one possible. The asymptotic limit for large electron beam emittances (ǫx,y ≫
λ/(2π)) is one of these. In this limit, the Statistical Optics description of
the source coincides with the Geometrical Optics (or Hamiltonian) descrip-
tion of the source, where a photon-beam phase space is deﬁned and can be
described in terms of rays speciﬁed by position-angle coordinates. In the Ge-
ometrical Optics approach, based on the uncertainty principle, only the ra-
diation originating by a photon-beam phase space area of order [λ/(2π)]2 is
spatially coherent. When the emittance is much larger than the wavelength,
2πǫx,y/λ
1, the divergence of the electron beam is much larger than the
diﬀraction angle of undulator radiation, and the transverse size of the elec-
tron beam is much larger than the diﬀraction size of undulator radiation. As
a result one can completely neglect diﬀraction eﬀects, and the Geometrical
Optics approach can always be applied. Since Geometrical Optics describes a
limiting situation of Statistical Optics there must be a relation between the
fundamental Geometrical Optics quantity, the phase space distribution, and
the fundamental Statistical Optics quantity, the cross-spectral density. It can
be shown [3] that the radiant intensity of the ﬁeld generated in free space by a
quasi-homogeneous source in the direction of a unit vector ~s can be expressed
as

≫

(~s, ω)

Γ(~s, ω) ,

I

∝

Γ(~s, ω) being the two-dimensional spatial Fourier transform of the degree of
transverse coherence g(~r⊥2

~r⊥1, ω):

Γ(~s, ω) =

g(~ρ′, ω) exp

Z

−

iω
c

~s

·

(cid:20)

~ρ′

d~ρ′ .

(cid:21)

The expression for the phase space distribution is given by the product of the
intensity distribution of the source and the radiant intensity

(4)

(5)

(6)

Φ (~s, ~r⊥) = I (~r⊥, ω)

(~s, ω)

I (~r⊥, ω) Γ (~s, ω) ,

I

∝

8

where the variables (~r⊥, ~s) characterize a ray in phase space. A comparison
between Eq. (6) and Eq. (2) shows that cross-spectral density and phase space
λ/(2π).
distribution contain the same information in the limiting case ǫx,y ≫
In other words, if a source has a large angular divergence (compared with the
diﬀraction angle) and a large transverse size (compared with the diﬀraction
size), one can completely neglect diﬀraction eﬀects and treat the problem of
the characterization of the source by means of Geometrical Optics 3 .

÷

Despite the previous discussion, the possibilities of using Geometrical Optics
to describe undulator sources are quite limited in many realistic situations.
Applications of Synchrotron Radiation make use of a very wide range of wave-
lengths which span over four order of magnitude, from 0.1˚A to 103˚A. For third
generation light sources, either planned or in operation, the horizontal electron
beam emittance ǫx = σxσx′ is of order of 1
3 nm. The vertical emittance is
given by ǫy = σyσy′ = χǫx, χ being the so called coupling factor. Typical values
of χ for third generation light sources are of order χ
0.01, corresponding
0.3˚A. These values are always near or
to vertical emittances of order 0.1
within the diﬀraction limit for wavelength ranges up to the hard X-rays in the
vertical direction, and Geometrical Optics descriptions fail. In particular, in
the VUV wavelength range, both vertical and horizontal emittances are much
λ/(2π)). One recovers, then,
smaller than the radiation wavelength (ǫx,y ≪
the perfectly coherent situation when the source is diﬀraction limited in both
horizontal and vertical directions. This is another situation when the Statisti-
cal Optics description is not the only one possible. In this case, deterministic
Wave Optics may be used as well. As the wavelength becomes shorter, in the
soft X-ray range, one obtains ǫy ≪
λ/(2π). At wavelengths
of about 1˚A the vertical emittance reaches the same order of magnitude of
the wavelength ǫy ∼
λ/(2π). Finally, in the hard X-ray
region, at a wavelength of about 0.1˚A, both emittances are much larger than

λ/(2π), while ǫx ≫

λ/(2π), but ǫx ≫

∼

÷

≫

3 Condition 2πǫx,y/λ
1 is suﬃcient, but not necessary. In general, we cannot say
that Geometrical Optics is never applicable for electron beam emittances smaller
than the radiation wavelength λ. We will treat this subject in a more extensive
fashion in Section 7. There we will see that there are situations when Geometrical
Optics can be applied to describe the (virtual) source even when the electron beam
emittance is smaller than λ. We will ﬁnd that a suﬃcient (less restrictive, but
still not necessary) condition for the applicability of Geometrical Optics to the
description of a given undulator source is that such source can be characterized in
terms of a quasi-homogeneous virtual source. Moreover, as it will also be discussed
in Section 7, our comparison of the emittance with the radiation wavelength is done
under the assumption that the electron beam beta function is comparable with the
radiation formation length at wavelength λ. This is often, but not always, the case
for undulator sources, since the radiation formation length is the undulator length,
which is at least a few meters. However, it is not the case for bending magnet
radiation.

9

the wavelength (ǫx,y ≫
λ/(2π)), and Geometrical Optics can be used along-
side Statistical Optics. It follows that, for third generation light sources, only
the limiting cases for wavelengths around 100 nm and 0.1˚A can be treated, re-
spectively, my means of Wave Optics or Geometrical Optics. The intermediate
situation can be treated in a rigorous way only with the help of Statistical Op-
tics, which includes both Wave Optics and Geometrical Optics as asymptotic
cases.

Strictly related to the problem of source characterization, but separate from
it, is the issue of propagating the photon beam through the optical beamline
to the observation plane. In the case of quasi-homogeneous virtual sources,
if diﬀraction eﬀects from the optical elements can be neglected, Geometrical
Optics can be taken advantage of. The virtual source can be described in
terms of phase space distribution, and interactions with optical media can be
conveniently modelled in terms of symplectic transformations, very much like
electron beams in storage rings optics. Several computer codes (e.g. SHADOW
[4]), usually referred to as ray-tracing codes, have been developed and are
standard tools used to carry out Geometrical Optics-based calculations. How-
ever, this approach is not always possible as the virtual source may not be
quasi-homogeneous or diﬀraction eﬀects may not be neglected in the optical
beamline. A rigorous analysis of the object-image coherence relationship is of
fundamental importance in the context of several coherence-based techniques
like ﬂuctuation correlation dynamics, phase imaging, coherent X-ray diﬀrac-
tion and X-ray holography, whose development has been fostered by the high
ﬂux of coherent X-rays provided by state-of-the-art third generation facilities.
It should be noted that, in the case of partially coherent wavefronts, even
the calculation of the intensity distribution at the specimen position should
involve Statistical Optics techniques. In fact, to obtain the intensity at the
specimen position as some optical element is present one ﬁrst needs to track
the cross-spectral density through the beamline i.e. one needs to study the
evolution of the partially coherent wavefront.

Computer codes have been written [5] in order to deal with beamline design
in the case of partially coherent radiation. These are devoted to the solu-
tion of the image formation problem starting from ﬁrst principles. Results
may in fact be obtained using numerical techniques alone, starting from the
Lienard-Wiechert expressions for the electromagnetic ﬁeld and applying the
deﬁnition of the ﬁeld correlation function without any analytical manipula-
tion. Yet, a ﬁrst-principle calculation of the ﬁeld correlation function between
two generic points or, in particular, calculation of the intensity at a single
point involves very complicated and time-expensive numerical evaluations. To
be speciﬁc, one needs to perform two integrations along the undulator device
and four integrations over the electron-beam phase space distribution to solve
the problem in free space. Then, modelling the optical beamline as a single
convergent lens, other four integrations are needed to characterize coherence

10

properties on the image plane, for a total of ten integrations. The development
of a universal code for any experimental setup is then likely to be problematic.
A more conservative approach may suggest the use of computer codes based
on some analytical manipulation of ﬁrst principle equations suited for spe-
ciﬁc experimental setups. From this viewpoint our most general expressions
may be used as reliable basis for the development of numerical methods. Yet,
computer codes can calculate properties for a given set of parameters, but
can hardly improve physical understanding, which is particularly important
in the stage of planning experiments. Our theory will allow treatment and
physical understanding of many asymptotes of the parameter space and their
applicability region with the help of a consistent use of dimensional analysis.
In the most general asymptotic cases treated here, this will allow to reduce
ﬁrst principle calculations (i.e. ten-dimensional integrals) to one-dimensional
convolutions of analytical functions with universal functions speciﬁc for the
undulator source case, and still to retain a certain degree of generality. It is
also worth to underline that our asymptotic results may also be used as a
benchmark for numerical methods.

One of the main diﬃculties in applying a Statistical Optics approach to Syn-
chrotron Radiation sources stems from the fact that Statistical Optics has
principally developed in connection with problems involving thermal light.
Solutions to all these problems share approximations that allow major sim-
pliﬁcations, but are speciﬁc of thermal sources only. For instance, thermal
sources can be modelled as perfectly incoherent, and the cross-spectral den-
sity assumes the form

G(~r⊥1, ~r⊥2, ω)

I (~r⊥1, ω) δ (~r⊥2

~r⊥1) ,

∝

−

(7)

where I is the source intensity distribution and δ is the two-dimensional Dirac
δ-function. However, there is a close connection between the state of coher-
ence of the source and the angular distribution of the radiant intensity (see
Eq. (4)). The physical interpretation of Eq. (7) is that the source is correlated
over the minimal possible distance (which is of order of the wavelength). This
has the consequence that the radiant intensity is distributed over a solid angle
of order 2π. This is correct for thermal sources, but is in contradiction with
the fact that any Synchrotron Radiation source is conﬁned within a narrow
cone in the forward direction. The high directionality of Synchrotron Radia-
tion rules out the use of Eq. (7) as a model for Synchrotron Radiation sources.
However, such high directionality is not in contrast with the poor coherence
which characterizes the quasi-homogeneous limit. Quasi-homogeneous sources
are only locally coherent over a distance of many wavelengths but, by deﬁni-
tion of quasi-homogeneity, the linear dimension of the source is much larger
than the correlation distance. Even though a quasi-homogeneous source can be
described with Geometrical Optics techniques, a coherence distance of many

11

wavelengths rules out the use of Eq. (7) as a model for Synchrotron Radia-
tion sources. A more precise knowledge of the cross-spectral density (that is
equivalent to the knowledge of the correct phase space density) is necessary to
solve the image formation problem. For instance, suppose that a light source
is placed at arbitrary distance in front of a lens. If the source is perfectly
incoherent (thermal light case) the area of the light incident on the lens is al-
ways the area of the lens. In the case of Synchrotron Radiation source though,
such area may be smaller than the lens. Even in the limit for a large beam
emittance (compared with the radiation wavelength), information about the
small angular distribution must be printed in the wavefront at the exit of the
undulator leading once more to the same conclusion: Eq. (7) cannot be used
in order to model Synchrotron Radiation sources. In [2] we treated, among
other cases, the asymptote for a large electron beam size and divergence. The
expression for the cross-spectral density of the source in free space simpliﬁes
and a particular quasi-homogeneous model can be given. In the same work,
we speciﬁed also the region of applicability of such model, and we showed
that it cannot be applied outside the limit for a large electron beam size and
divergence.

In relation with these remarks it should be mentioned that an attempt to fol-
low the path proposed in this paper is described in [6]. To our knowledge, [6]
constitutes the ﬁrst remarkable attempt to use Statistical Optics techniques in
order to characterize the evolution of partially coherent X-ray beams through
optical systems. In that work, as well as in [7], the beamline optics from the
undulator to the specimen can be modelled as a critical illumination system
[8], the beamline behaving as the condenser. After this, Statistical Optics
techniques are consistently used to calculate coherent properties on the im-
age plane. However, the authors of [6] reduced the general ten-dimensional
integrals to four-dimensional integrals by postulating that the cross-spectral
density distribution at the exit of the undulator can be written as Eq. (7), i.e.
a perfectly incoherent source is assumed at the exit of the undulator. As we
have just seen though, this assumption is always inconsistent in the case of
Synchrotron Radiation, even in the Geometrical Optics limit and, a fortiori,
in the case treated by the authors (the undulator beamline 12 at ALS), where
ǫy ≃
We organize our work as follows. Besides this Introduction, in Section 2 we
describe the optical system under study and some concepts from Statistical
Optics that will be widely used in the following Sections. In Section 3 we
review some general expressions pertaining undulator radiation from a single
particle. In particular, following [2] we present an analytical expression for the
Fourier transform of the electric ﬁeld generated by a single electron with oﬀset
and deﬂection which is valid at any distance from the exit of the undulator. We
also present the analytical solution of the imaging problem for a deterministic
model of undulator radiation (absence of electron beam emittance). In Section

3λ/(2π), which is highly spatially coherent.

0.1λ/(2π) and ǫx ≃

12

4 we give a derivation of the cross-spectral density for undulator radiation
based sources. Subsequently we analyze the evolution of the cross-spectral
density function through the optical system with particular attention to the
focal and to the image plane. The following two Sections 5 and 6 describe
quasi-homogeneous sources, respectively Gaussian and non-Gaussian, in the
ideal case when the lens is aberration-free and the pupil aperture is non-
limiting. A digression is then taken in Section 7, where we analyze in detail
the relation between Geometrical Optics and quasi-homogeneous sources. Such
Section may therefore be skipped in a ﬁrst reading, without interrupting the
main logical stream of our work. The next Section 8 describes the eﬀects of
a ﬁnite aperture size on the radiation characteristics from quasi-homogeneous
sources at the image plane, and is followed by Section 9 that assumes a quasi-
homogeneous source as well and deals with the consequences of lens aberration
on the intensity at the image plane. In Section 10 we introduce a particular
setup, a pinhole camera, capable of producing images of the sources in the
absence of lenses. The study of this particular setup is of particular interest
because it allows the reader to recognize mathematical analogies between cases
otherwise physically diﬀerent and serves as a junction between the previous
Section 9 and Section 11 treating physical cases when one obtains, surprisingly,
the image of the source on the focal plane. In the following Section 12 we
extend the treatment for the focal plane to any plane of interest. In Section
13 we discuss the depth of focus, including the case of a large non-limiting
aperture and the eﬀects of aperture size. In the next Section 14 solutions
for the image formation problem in non-homogeneous cases relevant for third
generation Synchrotron Radiation sources are given. Before conclusions, in
Section 15, we discuss the accuracy of quasi-homogenous source asymptotes.
Finally, in Section 16, we come to conclusions.

2

Elements and deﬁnitions of image formation theory

2.1 Wave propagation in free space

Let us indicate with E⊥(z, ~r⊥, t) any ﬁxed polarization component (along the
direction x or y) of the electric ﬁeld at time t calculated on a plane at position
z down the beamline at a certain transverse location ~r⊥. E⊥(z, ~r⊥, t) obeys,
in free space, the homogeneous wave equation:

c2

2E⊥ −

∇

∂2E⊥
∂t2 = 0 .

(8)

13

Let us now introduce the Fourier transform ¯E⊥(z, ~r⊥, ω) of the electric ﬁeld
E⊥(z, ~r⊥, t):

¯E⊥(ω) =

dtE⊥(t)eiωt ,

so that

E⊥(t) =

dω ¯E⊥(ω)e−iωt .

∞

Z−∞

1
2π

∞

Z−∞

As already remarked in footnote 1, we will sometimes refer to ¯E⊥ as ”the
ﬁeld”, understanding that we are working in the frequency domain.

Let us consider the ﬁeld propagation problem. To this purpose, we ﬁrst intro-
duce the complex envelope of the ﬁeld:

E = ¯E⊥ exp[

iωz/c] .

−

e

It is always possible to give such a deﬁnition. However, its utility is restricted
to the case when ˜E is a slowly varying function of z with respect to the
radiation wavelength λ. When the paraxial approximation is applicable (i.e.
always, for Synchrotron Radiation sources), this condition is fulﬁlled [1].

In paraxial approximation and in free space, the following parabolic equation
E of the Fourier transform of the electric ﬁeld
holds for the complex envelope
along a ﬁxed polarization component:

e

2 +

 ∇⊥

2iω
c

∂
∂z !

E = 0 .

e

2 are taken with respect to the
The derivatives in the Laplacian operator
transverse coordinates. One has to solve Eq. (12) with a given initial condition
at z, which is a Cauchy problem. Indicating with ~ro the transverse coordinate
of an observation point on a plane at longitudinal position zo we have

∇⊥

E(zo, ~ro) =

e

iω
2πc(zo −

z) Z

d~r′ ˜E(z, ~r′) exp 



iω
~ro −
2c(zo −

(cid:12)
(cid:12)
(cid:12)

,

2

~r′
z) 
(cid:12)
(cid:12)
(cid:12)



where the integral is performed over the transverse plane.

14

(9)

(10)

(11)

(12)

(13)

Next to the propagation equation for the ﬁeld in free space, Eq. (13), we can
discuss a propagation equation for the spatial Fourier transform of the ﬁeld,
which can also be derived from Eq. (12) and will be useful in the following
parts of this work. We will indicate the spatial Fourier transform of ˜E(z, ~r′)
with F(z, ~u) 4 :

2 +

 ∇⊥

2iω
c

∂
∂z ! (cid:26)Z

d~u F (z, ~u) exp [

i~r

~u]

= 0 .

(15)

−

·

(cid:27)

F (z, ~u) =

d~r′ ˜E(z, ~r′) exp

i~r′

Z

.

~u
i

·

h

Eq. (12) can be rewritten in terms of F as

Eq. (15) requires that

2 +

~u
|

2iω
c

∂
∂z !

 − |

F (z, ~u) = 0 .

Solution of Eq. (16) can be presented as

F (z, ~u) = F (0, ~u) exp

ic

2z
~u
|
|
2ω #

.

"−

(14)

(16)

(17)

It should be noted that the deﬁnition of F(0, ~u) is a matter of initial conditions.
In many practical cases, including the totality of the situation treated in this
paper, F (or ˜E) may have no direct physical meaning at z = 0. For instance, in

4 For the sake of completeness we explicitly write the deﬁnitions of the two-
dimensional Fourier transform and inverse transform of a function g(~r) in agreement
with the notations used in this paper. The Fourier transform and inverse transform
pair reads:

˜g(~k) =

d~r g(~r) exp

i~r

; g(~r) =

d~k ˜g(~k) exp

~k

·

i

h

~k

,

i~r

−

·

h

i

the integration being understood over the entire plane. If g is circular symmetric
we can introduce the Fourier-Bessel transform and inverse transform pair:

˜g(k) = 2π

dr rg(r)Jo(kr) ; g(r) =

dk k˜g(k)Jo(kr) ,

r and k indicating the modulus of the vectors ~r and ~k respectively, and Jo being
the zero-th order Bessel function of the ﬁrst kind.

Z

∞

Z0

1
4π2

Z

∞

1
2π

Z0

15

all cases considered in this paper, z = 0 is in the center of the undulator, well
within the radiation formation length. However, F(0, ~u) can be considered as
the spatial Fourier transform of the ﬁeld produced by a virtual source. Such
a source is deﬁned by the fact that, supposedly placed at z = 0, it would
produce, at any distance from the undulator, the same ﬁeld as the real source
does. The result in Eq. (17) is very general. On the one hand, the spatial
Fourier transform of the electric ﬁeld exhibits an almost trivial behavior in
2 = const. On the other hand, the behavior of the electric ﬁeld
z, since
itself is not trivial at all (see Section 2.4 and Fig.s 3-6). These properties follow
directly from the propagation equation for the ﬁeld and its Fourier transform.

F(z)

|

|

Let us now discuss the physical meaning of Eq. (17). The spatial Fourier
transform of the ﬁeld, F(z, ~u), may be interpreted as a superposition of plane
waves (the so-called angular spectrum). Once the frequency ω is ﬁxed, the wave
number k = ω/c is ﬁxed as well, and a given value of the transverse component
of the wave vector ~k⊥ = ~u corresponds to a given angle of propagation of a
plane wave. Diﬀerent propagation directions correspond to diﬀerent distances
travelled to get to a certain observation point. Therefore, they also correspond
to diﬀerent phase shifts, which depend on the position along the z axis (see,
for example, reference [9] Section 3.7). Free space basically acts as a Fourier
transformation. This means that the ﬁeld in the far zone is, phase factor and
proportionality factor aside, the spatial Fourier transform of the ﬁeld at any
position z. To show this fact, we ﬁrst recall that if we know the ﬁeld at a given
position (z, ~r′) we may use Eq. (13) to calculate the ﬁeld at another position
, with ﬁnite ratio ~ro/zo. In
(zo, ~ro) . Let us now consider the limit zo −→ ∞
this case, the exponential function in Eq. (13) can be expanded giving

E(zo, ~ro) =

d~r′ ˜E(z, ~r′) exp

iω
2πczo Z

2

~ro|
iω
|
2czo −

"

iω(~ro ·
czo

~r′)

+

iωz

2

~ro|
|
2cz2
o #

.

Letting ~θ = ~ro/zo we have

E(zo, ~ro) =

iω
2πczo

exp

iω

2

~θ
|
|
2c





(zo + z)

F

z,









ω~θ
c 


−

.

With the help of Eq. (17), Eq. (19) may be presented as

E(zo, ~ro) =

iω
2πczo

exp

iω

2

~θ
|
|
2c



F

0,



−

zo


.

ω~θ
c 



Eq. (20) shows what we wanted to demonstrate: free space basically acts as a
Fourier transformation.



16

(18)

(19)

(20)

e

e

e

y

x

f

-Lw/2

0

Lw/2

z1

z

z2

Fig. 1. Single lens imaging system with an undulator source as object.

2.2

Image formation with coherent light

As has been remarked in [6], any beamline optics used to re-image undulator
radiation to an observation plane of interest can be modelled as a critical
illumination system [8]. Therefore, the setup considered in this paper can be
sketched as in Fig. 1. It consists of an undulator of length Lw centered at
z = 0, a convergent lens positioned at z = z1, characterized by a focusing
strength f , and a plane of observation at position z = z2. In principle, z1, z2
and f are unrelated parameters. However our main case of interest is a critical
illumination system. Therefore, a given source plane at coordinate z = zs -
the object - is imaged at a particular observation position z = z2, that deﬁnes
the image plane. Using Ray Optics we can calculate the distance z2 along the
axis behind the lens where the image is formed. This gives the well-known
lens-maker equation

The size of the image is magniﬁed by a factor
with respect to the object because

M
|

|

and a real image is inverted

as expected from Ray Optics. We also deﬁne a scale factor m, that is the
inverse of the magniﬁcation power

of the lens:

1
f

=

1

−

+

.

z1

zs

z2

z1

1

−

M =

< 0 ,

z2
z1

−

z1
zs

−
−

m =

=

1
M
|

|

z1
z2

−
−

zs
z1

.

M
|

|

17

(21)

(22)

(23)

Once the lens position is ﬁxed at z = z1, the position zs of the source is a
matter of choice. Such a choice ﬁxes the position zi = z2 of the image plane
in agreement with Eq. (21). For instance, with [6] and [7], one may set the
critical illumination system to image the radiation at the undulator exit, in
which case the choice zs = Lw/2 is made. However, one is not obliged to do so.
In particular, in this paper, we will make the choice zs = 0. Then, the critical
illumination system images the center of the undulator, in the sense that the
image plane zi = z2 obeys Eq. (21) with zs = 0.

From a mathematical viewpoint, specifying the source is equivalent to ﬁxing
the initial conditions for Maxwell equations in terms of a ﬁeld distribution on
a certain transverse plane. When a certain ﬁeld distribution (in the frequency
domain) is ﬁxed on a plane at position z, Maxwell equations automatically set
the way radiation propagates in free space, and the source is univocally deﬁned.
The choice made in [6] and [7] corresponds to the choice of a real source.
The denomination ”real” is justiﬁed by the fact that the initial condition for
Maxwell equations amounts to the speciﬁcation of a ﬁeld distribution which is
actually present, and in principle measurable, at the exit of the undulator. On
the contrary, our choice zs = 0 corresponds to the position down the z-axis
in the middle of the undulator, well within the radiation formation length.
Although it makes sense to talk about the distribution of the electromagnetic
ﬁeld in the middle of the undulator, it does not make any sense to identify
such distribution with the initial condition for Maxwell equations, i.e. with
the source. However, it makes sense to deﬁne a virtual source as in Section
2.1. There is a particular reason for the choice z = 0 as the position for the
virtual source. In the case of a coherent undulator source (that is being treated
in the present Section), the wavefront of the radiation at a virtual source
located at z = 0 is plane. In other words, the far zone ﬁeld from an undulator
has spherical wavefronts centered in the middle of the undulator. This fact
alone makes the center of the undulator a privileged point with respect to
others. Moreover, in the more general case of partially coherent radiation we
will assume (as it is often veriﬁed in practice) that the beta functions of the
electron beam have their minima (in both horizontal and vertical directions)
in the center of the undulator. Subject to this assumption, as we will see, the
center of the undulator constitutes a privileged point of interest in this case
as well. As a result of the previous discussion we set

zs = 0 .

(24)

Let us assume that the position z1 and the focal length f of the lens are
set. Throughout this paper we will be particularly interested in the radiation
characteristics at two privileged positions down the beamline:

the image plane, at position z2 identiﬁed by Eq. (21).
the focal plane, at position z2 identiﬁed by the equation z2

•
•

z1 = f .

−

18

As it will be seen in the next Sections, both image and focal planes have
special properties that can be expressed in terms of Fourier Optics. These
properties are valid for any wavefront. We will ﬁrst take advantage of them in
Section 3, where we will deal with wavefronts generated by an electron beam
with zero emittance and further on in Section 4, where emittance eﬀects will
be discussed in the realm of Statistical Optics. In the present Section, after
having set the conﬁguration under study, we will limit ourselves to describe
these properties and to deﬁne basic quantities to be used in the Statistical
Optics formulation of the image formation problem.

Consider the problem of mapping the plane immediately in front of the lens
onto the plane at longitudinal position z2 > z1 behind the lens (see Fig. 1). If
one knows ˜E at position z = z1 immediately in front of the lens, one can also
obtain the expression for ˜E immediately behind the lens multiplying by the
transmission function:

T

~r′

= P

(cid:16)

(cid:17)

~r′
(cid:16)

(cid:17)

exp 

−




2

~r′
iω (cid:12)
2cf 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)



.

(25)

For simplicity of notation we consider here identical focal distances in the
horizontal and in the vertical direction, i.e. f = fx = fy. Results for more
complicated optical systems (e.g. a combination of cylindrical mirrors) are
found substituting consistently Eq. (25) with its straightforward generaliza-
tion. We assume with [8] that the complex pupil function P is zero outside the
lens aperture. Its phase accounts for aberrations and its modulus may vary
along the lens to describe apodizations: the simplest possible study case is for
= 1 and arg (P ) = 0 within the lens aperture. Accounting for Eq. (25), the
P
|
E(z1, ~r′) immediately in front of the lens to
propagation equation for any ﬁeld
the point (z2, ~r2) on the observation plane behind the lens can be written as:

|

e

˜E(z2, ~r2) =

d~r′

E(z1, ~r′)P (~r′)

iω
2πc(z2

exp

×

z1)

−
iω
c  

"

exp

2

iω
~r2
|
2c(z2

|
−

2(z2

z1) −

"
1

−

z1) # Z
1
~r′
2f ! |

2

|

#)

(

e
exp

iω(~r2
c (z2

·
−

~r′)
z1) #

"−

. (26)

Since Synchrotron Radiation is highly collimated, it is practically relevant
to discuss the case when the area of the spot of the incident radiation is
small compared with the area of the lens. It is also simpler and more natural
to start with this situation. Then, eﬀects from a ﬁnite pupil dimension can
be neglected. Note that this is not the case for thermal sources: since these
are emitting into a solid angle of 2π (they are perfectly incoherent) the ﬁnite
pupil dimensions cannot be ignored and result in the so-called vignetting eﬀect
[8]. Considering a perfect lens with no aberrations too, Eq. (26) assumes a

19

particularly simple form at the focal and on the image plane. Initially we will
consider situations when the pupil presence can be neglected. Later on we
discuss how to include the eﬀects due to the presence of the pupil.

2.2.1

Large non-limiting aperture

We will now specialize the result in Eq. (26) in the asymptote for a large
non-limiting aperture and in the case of the focal and of the image plane. Let
us denote with (zf , ~rf ) a point on the focal plane, and with (zi, ~ri) a point on
the image plane. From Eq. (26), on the focal plane we have

˜E(zf , ~rf ) =

iω
2πcf

exp

2

iω
~rf |
|
2cf # Z

"

d~r′

E(z1, ~r′) exp

iω(~rf ·
cf

"−

~r′)

.

#

(27)

With the help of Eq. (14) we can write Eq. (27) as

e

˜E(zf , ~rf ) =

iω
2πcf

exp

iω

2

~rf |
|
2cf #

"

F

z1,

 

−

ω~rf
cf !

.

Substitution of Eq. (17) in Eq. (28) gives

˜E(zf , ~rf ) =

iω
2πcf

exp

iω

2

~rf |
|
2cf #

"

exp

"−

2

iωz1

~rf |
|
2cf 2

F

0,

#

 

−

ω~rf
cf !

.

For the image plane, remembering that

1
f

=

+

1
z1

1
zi −

z1

and that

di = zi −

z1 =

z1
m

,

we obtain, from Eq. (26)

˜E(zi, ~ri) =

iωm
2πcz1

exp

2

~ri|
iωm
|
2cz1

2

"
~r′
iω
|
2cz1 #)

|

exp

exp

"−

d~r′

E(z1, ~r′)

# Z

(

e

iωm(~ri ·
cz1

"−

~r′)

.

#

20

(28)

(29)

(30)

(31)

(32)

On the image plane, according to Eq. (32), we have to calculate the Fourier
2/(2cz1)], representing the
transform of the product of two factors: exp [
E(z1, ~r′). A direct
phase of a spherical wave in paraxial approximation, and
calculation shows that the Fourier transform of the phase factor is

iω

~r′

−

|

|

e

d~r′ exp

2

~r′
iω
|
2cz1 #

|

"−

exp

iωm(~ri ·
cz1

"−

~r′)

=

4iz1 exp

#

−

2

im2ω

~ri|
|
2cz1

"

#

. (33)

Z

Since the Fourier transform of a product is equal to the convolution of the
Fourier transforms of each separate factor, from Eq. (32) one obtains

(34)

(35)

(36)

˜E(zi, ~ri) =

m
4π2 exp

2

~ri|
iωm
|
2cz1

"

#

d~u F (z1, ~u) exp

× Z





icz1
2ω  −

mω~ri
cz1 −

~u

!

2

.





Substitution of Eq. (17) in Eq. (34) gives

˜E(zi, ~ri) =

m
4π2 exp

2

"

exp

~ri|
iωm
|
2cz1
d~u F(0, ~u) exp [im~ri ·

"

#

× Z

2

iωm2

~ri|
|
2cz1

#

~u] ,

that is

˜E(zi, ~ri) = m exp

2

~ri|
iωm
|
2cz1

"

#

exp

2

iωm2

~ri|
|
2cz1

"

#

˜E (0,

m~ri) .

−

~u
|
|

The phase factor in the Fourier transform of the electric ﬁeld, given in Eq.
2 in Eq. (34). Therefore, the
(17), cancels the quadratic phase factor in
convolution integral in Eq. (34) transforms to a Fourier integral. As a result,
in the image plane we always obtain (aside for a scaling and a net phase factor)
the inverted ﬁeld distribution in the virtual source plane. More in general, at
any observation plane located at z = z2 behind the lens and the focal plane,
one observes (aside, again, for a scaling and a net phase factor) the inverted
ﬁeld distribution on an object plane located at z = zs, where zs satisﬁes the
lens condition Eq. (21).

Eq. (29) and Eq. (36) are reﬂections of well-known theorems of Fourier Optics.
Neglecting the eﬀects from a ﬁnite pupil dimension and assuming a perfect
lens with no aberrations, the focal plane has the following property [9]:

21

•

For any position of the object in front of the lens, the ﬁeld distribution
(amplitude and phase) on the focal plane diﬀers from the spatial Fourier
transform of the ﬁeld distribution on the object plane by a scale factor

ω/(cf ) and a net phase factor.

−

At the image plane, instead, the following property applies [9]:

•

For any position of the object in front of the lens, the ﬁeld distribution
(amplitude and phase) on the image plane diﬀers from the ﬁeld distribution
on the object plane by a scale factor

m and a net phase factor 5 .

−

These properties can be interpreted in terms of intensity distributions. The
ﬁrst tells that the intensity proﬁle on the focal plane has the same shape of
that on a distant plane and is obtained taking, essentially, the square modulus
of the Fourier transform of the ﬁeld on the object plane. The second tells that
the intensity proﬁle of the object is inverted and magniﬁed by the lens on
the image plane. For the image plane we just obtained, for perfectly coherent
light, the same result which is obtained in Geometrical Optics in the perfectly
incoherent limit.

2.2.2

Eﬀect of aperture size

Pupil eﬀects are taken into account, from a general standpoint, in Eq. (26).
Eq. (26) takes a speciﬁc form in the focal and in the image plane. One has

˜E(zf , ~rf ) =

iω
2πcf

exp

2

iω
~rf |
|
2cf # Z

"

d~r′

E(z1, ~r′)P (~r′) exp

~r′)

iω(~rf ·
cf

"−

#
(37)

and

˜E(zi, ~ri) =

iωm
2πcz1

exp

exp

×

"−

2

"

~ri|
iωm
|
2cz1
~r′)
iωm(~ri ·
cz1

# Z

.

#

d~r′

E(z1, ~r′)P (~r′) exp

2

~r′
iω
|
2cz1 #)

|

"−

(38)

Eq. (37) and Eq. (38) are formal extensions of Eq. (27) and Eq. (32), respec-
tively. Use of the convolution theorem on Eq. (37) and Eq. (38) allows to write
analogous extensions of Eq. (29) and Eq. (36). To this purpose we deﬁne

5 The prefactor m(zi) is a consequence of the conservation of the total energy
associated with the propagating ﬁeld.

e

(

e

22

(~u) =

d~r′P (~r′) exp

i~r′

P

Z

−
h

.

~u
i

·

(39)

Then, indicating with ˜EP the ﬁeld in the presence of the pupil, on the focal
plane we have

d~u

P  

ω~rf
cf −

exp

~u

! ·

"−

icf

2

~u
|
|
2ω #

˜E

zf ,

 

cf~u
ω !

(40)

× Z

˜EP (zf , ~rf ) = exp

iω

2

~rf |
|
2cf #

"

and on the image plane

˜EP (zi, ~ri) = exp

2

~ri|
iωm
|
2cz1

"

#
ωm~ri
cz1 −

d~u

P  

× Z

exp

~u

! ·

"−

2

icz1

~u
|
|
2ωm #

˜E

cz1~u
ωm !

zi,

 

.

(41)

One may apply the following mnemonic rule to include the eﬀects of the pupil
in Eq. (29) or Eq. (36). First, divide Eq. (29) or Eq. (36) by the ﬁrst phase
factor, corresponding to the phase factor outside the integral sign in Eq. (26).
Second, convolve with

. Third, put the phase factor back.

P

can be substituted
It should be noted that, in the limit for large apertures,
by a δ-Dirac function in both Eq. (40) and Eq. (41). In this case, from Eq. (40)
we recover ˜EP (zf , ~rf ) = ˜E(zf , ~rf ), given in Eq. (29). Form Eq. (41) instead,
we have ˜EP (zi, ~ri) = ˜E(zi, ~ri), given in Eq. (36).

P

Unless particular conditions are met, the phase factors under the integral signs
in Eq. (40) and Eq. (41) compensate only partially the phase of ˜E, which can
be found in Eq. (29) and Eq. (36) respectively. This fact complicates the
evaluation of the convolution integrals. Let us restrict our attention to the
image plane. We can treat analytically the case when the phase factors under
integral in Eq. (41) completely compensate the phase factor in Eq. (36), i.e.
when we can neglect the second phase factor in Eq. (36). This happens when
we are in the far ﬁeld limit. The far ﬁeld limit of Eq. (36) can be obtained
by substitution of Eq. (20) in Eq. (32). After the inverse Fourier transform in
Eq. (32) is calculated one obtains

˜E(zi, ~ri) = m exp

2

~ri|
iωm
|
2cz1

"

#

˜E (0,

m~ri) ,

−

(42)

that can also be obtained directly from Eq. (36) neglecting the second phase

23

factor on the right hand side. This is possible when

(43)

(44)

ωm2

2

~ri|
|
2cz1 ≪

1

ωm2σ2
i
c

.

z1

≫

for any point ~ri on the image pattern.

Let us indicate with σi the characteristic size of the image. Condition (43) can
be interpreted as the following requirement for z1:

|

|

M

≫

Since we are interested in the parametric dependence only, a factor 2 has been
neglected in Eq. (44). From Eq. (36) follows that mσi is the characteristic size
of the virtual source. As such it is independent of the position of the lens and
= m−1 as well. Condition (44) is often met
of the magniﬁcation factor
in practice and means that the radiation spot size on the lens, cz1/(ωmσi), is
much larger than the characteristic size of the virtual source, mσi. Then, the
lens is placed in the far zone with respect to the virtual undulator source by
σo, σo being the source size. We conclude
deﬁnition of far zone λz1/(2πσo)
that the condition for the lens to be placed in the far zone is equivalent to
the condition that Eq. (36) can be reduced to Eq. (42). This result will be of
importance in what follows. However, this kind of reasoning is only valid on
the image plane. On the focal plane the second phase factor in Eq. (29) follows
directly from the phase factor in Eq. (17), that is related with the propagation
of the angular spectrum: in this case one concludes that plane waves with
diﬀerent directions of propagation lead to an increasing phase diﬀerence as
the distance z1 increases. Therefore, in the focal plane, some simpliﬁcation
may be obtained in the near ﬁeld only, as z1 is small enough that the phase
diﬀerence between diﬀerent plane wave components is negligible. We will not
investigate this situation further. Going back to the image plane one can see
that a term of the expansion of the phase factor under the integral sign in
Eq. (34) cancels the phase factor in Eq. (17). It follows that the second phase
factor in Eq. (36) is not related with the propagation of the angular spectrum.
Therefore, in the far ﬁeld region, when condition (44) holds, we have that
the pupil eﬀects can be accounted for by means of a simpler convolution. In
the following parts of this paper we will restrict to this particular case when
treating pupil eﬀects. It is interesting to remark that pupil eﬀects due to ﬁnite
pupil dimension are especially important in the far region. In this limit the
radiation spot size on the lens is much larger than the size of the radiation
spot at the virtual source, and is often larger that the size of the pupil. In the
near ﬁeld instead, the radiation spot size on the lens is of order of the radiation
spot size at the virtual source. Therefore, in this limit, one can neglect eﬀects

24

from any ﬁnite pupil aperture larger than the radiation spot size at the virtual
source.

In conclusion, explicit substitution of Eq. (42) in Eq. (41) yields the following
far ﬁeld limit expression on the image plane:

˜EP (zi, ~ri) = exp

2

~ri|
iωm
|
2cz1

"

# Z

d~u

ωm~ri
cz1 −

~u

! ·

P  

˜E

0,

 

−

ω !

cz1~u

.

(45)

2.3

Propagation of partially coherent light in free space

Let us now consider the stochastic nature of the Synchrotron Radiation ﬁeld
in general terms. Synchrotron Radiation is a Gaussian stochastic process. As
has been discussed in detail in reference [2], the electromagnetic signal at
any position down the beamline is completely characterized, from a statistical
viewpoint, by the knowledge of the second order ﬁeld correlation function in
space-frequency domain

Γω(zo, ~ro1, ~ro2, ω, ω′) =

¯E⊥(zo, ~ro1, ω) ¯E∗

⊥(zo, ~ro2, ω′)

.

(46)

D

E

...
i

In this paper, the averaging brackets
will always indicate an ensemble
h
average over bunches. As it will be better explained in the following Section
3, we will restrict ourselves to the treatment of radiation from planar undu-
lators in resonance with the fundamental harmonic. Therefore we can neglect
vertically polarized radiation components and consider ¯E as a scalar quantity.
The shot noise in the electron beam is responsible for random ﬂuctuations of
the beam density, both in space and time. As a result, the temporal Fourier
transform of the Synchrotron Radiation pulse at a ﬁxed frequency and a ﬁxed
point in space is a sum of a great many independent contributions:

¯E⊥(zo, ~ro, ω) =

¯Es⊥(~ηk,~lk, zo, ~ro, ω) exp (iωtk) ,

(47)

N

Xk=1

where N is the number of electrons in the bunch. Here ~ηk,~lk and tk are random
variables describing random angular direction, position and arrival time of an
electron at the reference position zo = 0. As has been demonstrated in [2],
under the assumption - generally veriﬁed for X-ray beams and third generation
light sources - that the radiation wavelengths of interest is much shorter than
the bunch length we can write Eq. (46) as

Γω(zo, ~ro1, ~ro2, ω, ω′) = NFω(ω

ω′)

−

25

¯Es⊥(~η,~l, zo, ~ro1, ω) ¯E∗

s⊥(~η,~l, zo, ~ro2, ω′)

, (48)

×*

+~η,~l

where F (ω) is the Fourier transform of the bunch longitudinal proﬁle function
Ft(tk), that is

∞

exp (iωtk)

h

it =

Z−∞

dtkFt(tk)eiωtk = Fω(ω) .

(49)

Note that the ensemble average on the right hand side of Eq. (48) is done over
the product of the electric ﬁeld produced by the same electron. In other words
each electron is correlated only with itself.

If the dependence of ¯Es⊥ on ω and ω′ is slow enough, so that ¯Es⊥ does not vary
appreciably on the characteristic scale of Fω we can substitute ¯E∗
with ¯E∗

s⊥(~η,~l, zo, ~ro2, ω) in Eq. (48) thus obtaining:

s⊥(~η,~l, zo, ~ro2, ω′)

Γω(zo, ~ro1, ~ro2, ω, ω′) = NFω(ω

ω′)G(zo, ~ro1, ~ro2, ω)

−

where

G(zo, ~ro1, ~ro2, ω) =

¯Es⊥(~η,~l, zo, ~ro1, ω) ¯E∗

s⊥(~η,~l, zo, ~ro2, ω)

*

.

+~η,~l

(50)

(51)

As has been shown in [2] this assumption is by no means a restrictive one.

From now on we will be concerned with the calculation of the correlation func-
tion G(zo, ~ro1, ~ro2, ω), while the correlation in frequency (which may be com-
plicated by other factors describing, for instance, the presence of a monochro-
mator) can be dealt with separately.

On the one hand, the cross-spectral density as is deﬁned in Eq. (51) includes
the product of ﬁelds which obey the free space propagation relation Eq. (13).
On the other hand, the averaging over random variables commutes with all
operations involved in the calculation of the ﬁeld propagation. More explicitly,
introducing the notation ˜E(zo) =
[ ˜E(z)] as a shortcut for Eq. (13) one can
write

O

G(zo) =

¯Es⊥(zo) ¯E∗
D
∗
O · O

=

s⊥(zo)
O
¯Es⊥(z) ¯E∗
D
E
s⊥(z)

¯Es⊥(z)
=

i
O · O

h

∗

s⊥(z)

¯E∗
O
h
∗ [G(z)] .

iE

=

hD

Ei

Note that

may represent, more in general, any linear operator.

O

(52)

26

As a result, one can obtain a law for the propagation of the cross-spectral
density in free space in analogy with Eq. (13) from position z to position zo:

ω2
4π2c2(zo −
exp

Z

z)2
iω
2c(zo −

G(zo, ~ro1, ~ro2) =

d~r′

1d~r′

2 G(z, ~r′

1, ~r′

2)

×

z) (cid:18)(cid:12)
(cid:12)
(cid:12)
where the integral is performed in four dimensions. We may now proceed in
parallel with Section 2.1. In analogy with Eq. (14) let us ﬁrst deﬁne

(cid:19)#

−

−

−

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

"

~ro1

2

~r′

1

2

~r′

2

,

(53)

~ro2
(cid:12)
(cid:12)
(cid:12)

(z, ~u1, ~u2) =

d~r′

1d~r′

2 G

1, ~r′

2

exp

z, ~r′
(cid:16)

i
h

~u1
(cid:16)

·

~r′

1

~u2

~r′

2

−

·

(cid:17)i

(cid:17)

Z

G

.

(54)

Eq. (54) is a second-order correlation function between spatial Fourier trans-
forms of the ﬁeld. In the following, for simplicity, and with some abuse of lan-
as the ”Fourier transform of G”. The spatial Fourier
guage, we will denote
transform of ˜E depends on the position along the beamline through a phase
factor only. Moreover, as already said, the operation of ensemble average com-
mutes with the operation of Fourier transform. It follows that also
depends
on the position along the beamline through a phase factor only. To be speciﬁc,
the analogous of Eq. (17) is given by

G

G

(z, ~u1, ~u2) =

(0, ~u1, ~u2) exp

G

G

ic
2ω

(cid:20)−

(cid:16)

2

~u1
|

|

~u2

2
|

− |

z

.

(cid:21)

(cid:17)

(55)

Continuing in analogy with Section 2.1 we ﬁnd Eq. (20), which relates the
far ﬁeld expression for ˜E(zo, ~ro) (in the limit zo −→ ∞
and for a ﬁnite ratio
~ro/zo) to the spatial Fourier transform F . We can take advantage of Eq. (20)
to obtain, with the help of Eq. (51) and Eq. (54), a useful relation between
the cross-spectral density in the far ﬁeld and the Fourier transform of G at the
and for ﬁnite ratios ~θ1 = ~ro1/zo,
virtual-source position. In the limit zo −→ ∞
~θ2 = ~ro2/zo we have

G (zo, ~ro1, ~ro2) =

ω2
4π2c2z2
o

exp

iωzo
2c (cid:18)(cid:12)
(cid:12)
(cid:12)

(cid:20)

2

~θ1

−

(cid:12)
(cid:12)
(cid:12)

2

~θ2
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

(cid:19)(cid:21) G 


ω~θ1
c

,

−

0,

−

.

ω~θ2
c 
(56)


This expression will be very useful later on. In [2] we obtained an explicit
expression for the cross-spectral density of the undulator source in free space
at any distance from the undulator. In particular we can calculate the cross-
spectral density in the far ﬁeld, which assumes a simpliﬁed form. Consequently,

27

the use of Eq. (56) allows to calculate the Fourier transform of the cross-
spectral density at the virtual-source position. As a result we can characterize
the virtual source and operate with it. Our starting point, here as in [2] is
the electron beam in the undulator device. In contrast with this, previous
literature dealing with application of Statistical Optics to undulator radiation
assumes a priori the validity of a postulated expression for the cross-spectral
density.

2.4

Image formation with partially coherent light

In analogy with Section 2.2 we will now consider the problem of propagating
the cross-spectral density immediately in front of the lens through the optical
system up to the screen at z = z2 behind the lens. Suppose that we know
G(z1) immediately in front of the lens. The cross spectral density immediately
behind the lens, Gl(z1), is related to G(z1) by

Gl

z1, ~r′
(cid:16)

1, ~r′

2

= G

1, ~r′

2

T

z1, ~r′
(cid:16)

T ∗

~r′
1
(cid:16)

(cid:17)

,

~r′
2
(cid:16)

(cid:17)

(cid:17)

(cid:17)

(57)

where the transmission function T is deﬁned by Eq. (25). One can obtain a
law for the propagation of the cross-spectral density in free space using Eq.
(53), in agreement with [8], from position z1 immediately behind the lens to
the image plane at position z2, that is

G(z2, ~r1, ~r2) =

d~r′

1d~r′

2 Gl(z1, ~r′

1, ~r′

2)

2

~r′

1

~r1

−

−

−

~r2
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

2

~r′

2

.

(cid:19)#

(cid:12)
(cid:12)
(cid:12)

−

z1) (cid:18)(cid:12)
(cid:12)
(cid:12)

(58)

Substituting Eq. (57) in Eq. (58) and remembering Eq. (25) one ﬁnds

G(z2, ~r1, ~r2) =

d~r′

1d~r′

2 G

1, ~r′

2

P

~r′
1

P ∗

z1, ~r′
(cid:16)

iω

2c(z2

(cid:17)

(cid:16)
~r1

(cid:17)

−

~r′

1

−

z1) (cid:18)(cid:12)
(cid:12)
(cid:12)

~r′
2
(cid:16)
2

(cid:17)

(cid:12)
(cid:12)
(cid:12)

(59)

+

−

2

~r′
1

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

(cid:19)

Manipulation of the argument in the exponential function under integral allows
the more suggestive representation

ω2
4π2c2(z2

exp

×

2c(z2

"

−

z1)2
iω

Z

ω2
4π2c2(z2

z1)2
~r′
2

−
iω
2cf (cid:18)(cid:12)
(cid:12)
~r′
(cid:12)
(cid:19)(cid:21)

2

2

Z
2

(cid:12)
(cid:12)
(cid:12)
.

"

−

(cid:12)
(cid:12)
(cid:12)

×

−

exp

~r2
(cid:12)
(cid:12)
(cid:12)

28

(60)

(61)

G(z2, ~r1, ~r2) =

iω

−

(cid:17)

ω2
4π2c2(z2

−
1d~r′

2

d~r′

z1)2 exp

2c(z2

"

z1)

~r1
|

2
|

~r2

2
|

− |

#

(cid:17)

1, ~r′

2

P

G

z1, ~r′
(cid:16)

iω
c  

"

(
1
2f −
iω

× Z

exp

exp

×

×

c(z2

"

z1)

−
(cid:16)

−

2(z2

1

−

~r1

·

z1) ! (cid:18)(cid:12)
(cid:12)
(cid:12)
~r′
1 + ~r2

·

(cid:16)
~r′
1
(cid:16)

~r′
2

P ∗

~r′
2

(cid:17)
2

(cid:16)
~r′
1

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

,

(cid:17)
2

(cid:12)
(cid:12)
(cid:12)
~r′

2

−

#

(cid:17)

(cid:19)# )

that is analogous to Eq. (26). The quantity in brackets
is basically Fourier-
transformed. As mentioned before, similarities between the way G and ˜E
evolve through the beamline have to be ascribed to the fact that the average
over random variables commutes with all other operations in the calculation
of the cross-spectral density. As a result, the reason why Eq. (60) is basically
a Fourier transformation is due to the particular way ˜E evolves.

...
}

{

Similarly as has been explained above for the ﬁelds, the image and the fo-
cal plane are privileged planes for which the cross-spectral density assumes
particularly simple forms, that can be found in terms of Fourier Optics.

2.4.1

Large non-limiting aperture

We will now proceed in analogy with Section 2.2.1. On the focal plane, simi-
larly to Eq. (28) we have

G(zf , ~r1f , ~r2f ) =

ω2

4π2c2f 2 exp

z1,

×G  

−

iω
2cf

"
ω~r1f
cf

,

−

2

~r1f |
|
(cid:16)
ω~r2f
cf !

,

2

~r2f |

− |

#

(cid:17)

while using Eq. (55) we obtain, similarly to Eq. (29),

G(zf , ~r1f , ~r2f ) =

iω
2cf

ω2

4π2c2f 2 exp
"
iωz1
2cf 2

exp

"−

×

2

2

~r2f |

− |

~r1f |
|
(cid:16)

#

(cid:17)

2

~r1f |
|

2

~r2f |

− |

(cid:16)

# G  
(cid:17)

0,

ω~r1f
cf

,

ω~r2f
cf !

−

−

.

(62)

In analogy with Eq. (32), for the image plane we can write

G(zi, ~r1i, ~r2) =

2

mω
2πcz1 (cid:19)

(cid:18)

exp

iωm
2cz1

(cid:20)

(cid:16)

2

~r1i|
|

2

~r2i|

− |

(cid:17)(cid:21)

29

d~r′

1d~r′

2 G(z1, ~r′

1, ~r′

2) exp

× Z

exp

×

(cid:20)−

imω
cz1

~r1i ·

(cid:16)

~r′

1

~r2i ·

−

(cid:17)(cid:21)

iω
2cz1 (cid:18)(cid:12)
(cid:12)
.
(cid:12)

(cid:20)
~r′

2

2

~r′

2

2

~r′

1

−

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

(cid:19)(cid:21)

(cid:12)
(cid:12)
(cid:12)

(63)

Using the convolution theorem in analogy with Eq. (34) we obtain

G(zi, ~r1i, ~r2i) =

2

exp

m
4π2

(cid:19)

iωm
2cz1

(cid:20)

(cid:18)

×

exp

icz1
2ω 


 






~r1i|
|
(cid:16)
mω~r1i
cz1

2

2

~r2i|

− |
2

+ ~u

!

−  

(cid:17)(cid:21) Z

mω~r2i
cz1

d~u d~v

(z1, ~u, ~v)

+ ~v

.

G

2

!










(64)

Finally, taking advantage of Eq. (55) we have

G(zi, ~r1i, ~r2i) =

2

m
4π2

(cid:19)
exp

"

(cid:18)

×

exp

(cid:20)
im2ω
2cz1

d~u d~v

G

× Z

2

2

(cid:16)
2

~r2i|

~r1i|
|

iωm
2cz1
− |
~r2i|
~r1i|
|
− |
(cid:16)
(0, ~u, ~v) exp [im (~r1i ·

(cid:17)

#

2

(cid:17)(cid:21)

that can be rewritten as the analogous of Eq. (36):

~u

~r2i ·

−

~v)] ,

(65)

G(zi, ~r1i, ~r2i) = m2 exp

imω
2cz1
(cid:20)
im2ω
2cz1

"

2

2

(cid:16)

~r1i|
|
~r1i|
|
(cid:16)

2

2

~r2i|
~r2i|

− |

− |

(cid:17)(cid:21)

#

(cid:17)

exp

×

G (0,

m~r1i,

m~r2i) .

−

−

(66)

2.4.2

Eﬀect of aperture size

Eﬀects of aperture size can be included in strict analogy with Section 2.2.2.
Similarly to Section 2.2.2 the following mnemonic rule can be applied to in-
clude the eﬀects of the pupil in Eq. (62) or Eq. (66). First, divide Eq. (62)
or Eq. (66) by the ﬁrst phase factor, corresponding to the phase factor out-
side the integral sign in Eq. (60). Second, convolve twice with
P
having already been deﬁned in Eq. (39). Third, put the phase factor back.
We will denote with GP the cross-spectral density including the eﬀects due to
the presence of the pupil. On the focal plane, in analogy with Eq. (40), one
obtains

and

∗,

P

P

30

GP (zf , ~r1f , ~r2f ) = exp

iω
2cf

"

(cid:16)
d~u d~v

2

~r1f |
|

P  

2

~r2f |

− |
ω~r1f
cf −

#

(cid:17)
~u

∗

! P

 

2
|

~v
|
(cid:16)

~u

2
|

− |

#

(cid:17)

G

zf ,

 

× Z

exp

×

icf
2ω

"

ω~r2f
cf −
cf~u
ω

,

~v

!
cf~v
ω !

(67)

while on the image plane, in analogy with Eq. (41), one has

GP (zi, ~r1i, ~r2i) = exp

imω
2cz1

(cid:20)
(cid:16)
d~u d~v

~r1i|
|

2

2

~r2i|
− |
ωm~r1i

(cid:17)(cid:21)
~u

× Z

exp

×

P  

cz1 −

! P

 

icz1
2ωm

2

~v
|

|

2

~u

− |

|

G

zi,

 

ωm~r2i

∗

~v

!

cz1 −
cz1~u
ωm

,

cz1~v
ωm !

.

(68)

(cid:20)

(cid:16)

(cid:17)(cid:21)
∗ can be substituted by δ-Dirac
and
In the limit for large apertures,
functions in both Eq. (67) and Eq. (68). In this case, from Eq. (67) we recover
GP (zf , ~r1f , ~r2f ) = G(zf , ~r1f , ~r2f ), that is given by Eq. (62). From Eq. (68)
instead, we have GP (zi, ~r1i, ~r2i) = G(zi, ~r1i, ~r2i), that is given by Eq. (66).

P

P

Similarly to the case analyzed in Section 2.2, unless particular conditions are
met, the phase factor under the integrals in Eq. (67) and Eq. (68) compen-
sate only partially the phase in Eq. (62) and Eq. (66). In the following we
will restrict our attention to the image plane. In this case, complete phase
compensation is achieved when the lens is in the far ﬁeld.

The far ﬁeld limit of Eq. (66) can be obtained by substitution of Eq. (56) in
Eq. (63). After calculating the inverse transformation of Eq. (54) one obtains:

G(zi, ~r1i, ~r2i) = m2 exp

imω
2cz1

(cid:20)

(cid:16)

2

~r1i|
|

2

~r2i|

− |

(cid:17)(cid:21)

G (0,

m~r1i,

m~r2i) .

−

−

Eq. (69) can also be obtained directly from Eq. (66) neglecting the second
phase factor on the right hand side, that is possible when

(69)

(70)

m2ω
2cz1

2

2

~r2i|

− |

~r1i|
|
(cid:16)

1

≪

(cid:17)

for any pair of points (~r1i, ~r2i) on the image pattern. When the coherence
length on the image plane is much smaller than the characteristic size of the
image, condition (70) constitutes, similarly to condition (43) before (that holds
in the case of coherent light), the requirement to be satisﬁed for the lens to

31

be in the far zone. When condition (70) is satisﬁed, Eq. (69) holds instead of
Eq. (66). As explained in Section 2.2, in this paper we will study pupil eﬀects
only under this assumption.

Explicit substitution of Eq. (69) in Eq. (68) yields, the following far ﬁeld limit
expression:

GP (zi, ~r1i, ~r2i) = exp

2

imω
2cz1

~r1i|
|
(cid:16)
ωm~r2i

(cid:20)

∗

×P

 

cz1 −

2

~r2i|

− |

~v

G

!

 

d~u d~v

(cid:17)(cid:21) Z
0,

−

cz1~u
ω

,

P  
cz1~v

,

−

ω !

ωm~r1i

cz1 −

~u

!

(71)

that is the analogous of Eq. (45) in Section 2.2.2.

3

Image formation with a perfectly coherent undulator source

1, ~r′

In order to give an explicit expression for the cross-spectral density at posi-
tion z2 we need to know an explicit expression for the cross-spectral density
G(z1, ~r′
2) immediately in front of the lens. This was the subject of our pre-
vious work [2]. In this and in the following Sections we will present the image
formation problem and its solution with the help of that reference. In particu-
lar, in the present Section 3 we will begin with the simpler deterministic case
of zero electron beam emittance. One may think of a ﬁlament electron beam
or equivalently, as concerns the cross-spectral density, of a single electron. We
will start neglecting the presence of the pupil. At the end we will generalize
our results to account for it. In the following parts of this paper we will then
generalize the results obtained in the present Section 3 to include emittance
eﬀects, thus taking full advantage of the Statistical Optics formulation.

Our starting point is an expression, derived in reference [2], for the complex
envelope ˜Es⊥ of the Fourier transform of the electric ﬁeld produced by a single
electron moving through a planar undulator at any distance from the exit of
the undulator. That expression accounts for a given oﬀset and deﬂection angle
of the particle trajectory with respect to the undulator axis. Referring to Fig.
2 we found

˜Es⊥ =

KωeAJJ
c2γ

−

Lw/2

Z−Lw/2

×

i 

exp 


 

C +






dz′

1
zo −
~η
|
|
2c !

2

ω

z′

z′ +

32

2

ω

~l
~ηz′
~r⊥o −
−
z′)
2c(zo −

(cid:16)

(cid:17)

.











(72)

y

x

(xo1,yo1,zo)

(xo2,yo2,zo)

-Lw/2

O

Lw/2

z

Fig. 2. Illustration of the undulator geometry and of the observation plane after the
undulator.
Here K is the undulator parameter, Lw, as before, is the undulator length,
e) is the electron charge and γ is the relativistic Lorentz factor. Moreover
(

−

K 2

AJJ = J0

4 + 2K 2 ! −

 

J1

K 2
4 + 2K 2 !

 

,

Jn being the Bessel function of the ﬁrst kind of order n. Also,

ωo =

4πcγ2
λw (1 + K 2/2)

C =

2π
λw

ω

ωo

−
ωo

is the fundamental frequency of the undulator, λw being the undulator period.
Finally,

is the detuning parameter, which accounts for small deviations in frequency
from resonance.

Eq. (72) is valid for frequencies about the fundamental harmonic ωo. This
means that we are considering a large number of undulator periods Nw ≫
1
and that we are looking at frequencies near the fundamental at angles within
the main lobe of the directivity diagram of the radiation. In this situation
one can neglect the vertical y-polarization component of the ﬁeld with an
accuracy (4πNw)−1. This constitutes a great simpliﬁcation of the problem. At

33

(73)

(74)

(75)

any position of the observer, we may consider the temporal Fourier transform
of the electric ﬁeld as a complex scalar quantity corresponding to the surviving
x-polarization component of the original vector quantity. Moreover it should
be noted that, in deriving Eq. (72), we assumed that no inﬂuence of focusing
is present inside the undulator. ~η and ~l are to be understood as deﬂection
angles and oﬀset of the electron at the position z = 0.

Let us introduce normalized units 6

c2γ ˜Es⊥
KωeAJJ

,

ˆEs⊥ =

~ˆη = ~η

−
ωLw
c
ˆC = LwC = 2πNw

s

,

~ˆr⊥o = ~r⊥o

ω
Lwc

,

s

ω
Lwc

,

~ˆl = ~l
s
z
Lw

ˆz =

.

ω

ωo

−
ωo

,

(76)

(78)

As shown in Appendix B of [2], after some algebraic manipulation, Eq. (72)
can be rewritten in normalized units as

ˆEs⊥ =

1/2

Z−1/2

dˆz′
ˆzo −

ΦU + ˆC ˆz′ +

ˆz′ exp 


i 






~ˆl
ˆzo −

−

ˆzo ˆz′
2(ˆzo −

~ˆθ
ˆz′) 



2

~ˆη













,(77)

where

~ˆθ =

~ˆr⊥o
ˆzo

6 The relation between ˆEs⊥ and ˜Es⊥ in Eq. (76) diﬀers from the analogous one in
Eq. (25) of reference [2] for a factor ˆzo = zo/Lw. The reason for this discrepancy
is related to the diﬀerent subjects treated. In [2] we considered only the free space
case, while in this paper we extend our considerations to an optical element, thus
introducing another privileged longitudinal position (the lens position) other that
the observation plane. The deﬁnition of ˆEs⊥ in [2] is no more a convenient one
here and would lead to artiﬁcial complications in the following parts of this paper.
Therefore it has been slightly modiﬁed as in Eq. (76). This leads to slight changes
(related with the factor ˆzo) in some of the following equations when compared to
the analogous quantities in [2].

34

represents the observation angle and ΦU is given by

~ˆθ
ΦU = 

~ˆl
ˆzo

−

2






ˆzo
2

.




Eq. (77) is of the form

ˆC, ˆzo,

~ˆθ

~ˆl
ˆzo −

−

~ˆη



ˆEs⊥ 



= exp (iΦU )S 

.

(80)

~ˆθ
ˆC, ˆzo, 





~ˆl
ˆzo −

−

2

~ˆη








It is possible to show that the expression for the function S(
sinc(
ﬁeld from a single particle, Eq. (77), is simpliﬁed to

) reduces to a
1 . In this limiting case, the expression for the electric

) function as ˆzo ≫

·

·

ˆEs⊥ = exp (iΦU )

1/2

Z−1/2

dˆz′
ˆzo

iˆz′

ˆC +





exp 




~ˆlx
ˆzo −

−

1
~ˆθ
2 



2

~ˆη



.











Eq. (81) can be integrated analytically giving

ˆEs⊥ = exp (iΦU )

sinc

1
ˆzo

ˆC
2

 

+

ζ 2
4 !

,

where

ζ =

~ˆθ

~ˆl
ˆzo −

~ˆη

−

sinc(x) =

sin(x)
x

.

and where the sinc function has been deﬁned as

For simplicity, in this paper we will restrict our attention to the case ˆC = 0.
In the particular case ˆC = 0, the function S can be represented in terms of
) as
the exponential integral function Ei(
·

S

0, ˆzo, ζ 2
(cid:16)

(cid:17)

= exp(

iˆzoζ 2/2)

−

Ei
"

 

−

oζ 2

iˆz2
1 + 2ˆzo ! −

Ei

iˆz2
oζ 2
1 + 2ˆzo !#

 

.

(85)

35

(79)

(81)

(82)

(83)

(84)

f( )

1,2

1,0

0,8

0,6

0,4

0,2

0,0

-0,2

z

=1

^

o

36

0

2

4

6

8

10

12

14

Fig. 3. Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real (dashed line)
and the imaginary (dash-dotted line) parts of f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 1.

It is interesting to study the behavior of the S function as the distance from the
undulator center ˆzo increases. This gives an idea of how good the asymptotic
approximation of the S function for ˆzo ≫
1 (that is a sinc function) is. A com-
parison between sinc(ζ 2/4) and the real and imaginary parts of ˆzoS(0, ˆzo, ζ 2)
for ˆzo = 1, ˆzo = 2, ˆzo = 5 and ˆzo = 10 is given respectively in Fig. 3, Fig. 4,
Fig. 5 and Fig. 6.

When the electron beam has zero emittance we are dealing with a perfectly
coherent wavefront. The evolution of the radiation wavefront through our op-
tical system can be obtained with the help of Eq. (80). In the following we will
~ˆl = 0 and ~ˆη = 0. These assumptions
study such evolution assuming ˆC = 0,
mean that the radiation frequency is perfectly tuned to the fundamental fre-
quency of the undulator and that the electron beam is moving on the z axis.
In this case Eq. (82) describes, in the far ﬁeld region, a spherical wave with
the source in the center of the undulator. This remark allows one to consider
the undulator center as a privileged point. In other words, the phase factor in
Eq. (82) represents, in paraxial approximation, the phase diﬀerence (charac-
terizing a spherical wave) between the point (ˆxo, ˆyo, ˆzo) and the point (0, 0, ˆzo)
on the observation plane.

f( )

1,2

1,0

0,8

0,6

0,4

0,2

0,0

-0,2

1,0

0,8

0,6

0,4

0,2

0,0

-0,2

f( )

1,2

z

=2

^

o

^

z

=5

o

37

0

2

4

6

8

10

12

14

Fig. 4. Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real (dashed line)
and the imaginary (dash-dotted line) parts of f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 2.

0

2

4

6

8

10

12

14

Fig. 5. Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real (dashed line)
and the imaginary (dash-dotted line) parts of f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 5.

z

=10

^

o

f( )

1,2

1,0

0,8

0,6

0,4

0,2

0,0

-0,2

0

2

4

6

8

10

12

14

Fig. 6. Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real (dashed line)
and the imaginary (dash-dotted line) parts of f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 10.

3.1

Large non-limiting aperture

We will ﬁrst study the case when the pupil function can be neglected. Let us
introduce a normalized version of the spatial Fourier transform of the ﬁeld,
analogous to Eq. (14), that is

ˆF

=

ˆz, ~ˆu
(cid:17)

d~ˆr′ ˆE

ˆz, ~ˆr′
(cid:18)

(cid:16)

Z
The spatial Fourier transform ˆF
(compare also with Eq. (184) of reference [2]) and gives

(cid:19)

.

~ˆu
(cid:21)

·

exp

i~ˆr′
(cid:20)
ˆz, ~ˆu
(cid:17)
(cid:16)

can be calculated directly from Eq. (77)

ˆF

ˆz, ~ˆu
(cid:17)

(cid:16)

=

2πi sinc 

−

exp 

−

2

~ˆu
4 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)



2

ˆz

i

~ˆu
(cid:12)
(cid:12)
2
(cid:12)
(cid:12)
(cid:12)
(cid:12)

.





Eq. (28) and Eq. (34) can be respectively rewritten in normalized units as







(86)

(87)

(88)

ˆE⊥(ˆzf ,~ˆrf ) =

i
2π ˆf

exp

2

~ˆrf |
i
|
2 ˆf 






ˆF

ˆz1,





~ˆrf
ˆf 


−

and

38

ˆE⊥(ˆzi, ~ri) =

m
4π2 exp

2

~ˆri|
im
|
2ˆz1 






Z

d~ˆu ˆF

ˆz1, ~ˆu

exp 

(cid:16)

(cid:17)

m~ˆri
ˆz1 −

~ˆu

−

iˆz1
2 





2

,








(89)


where ˆf = f /Lw. Substitution of Eq. (87) in Eq. (88) and in Eq. (89) yields
results respectively for the focal and the image plane. In the focal plane we
have

ˆE⊥(ˆzf ,~ˆrf ) =

exp

1
ˆf

2

~ˆrf |
i
|
2 ˆf 






exp

iˆz1

2

~ˆrf |
|
2 ˆf 2 




−



sinc 

2

~ˆrf
4 ˆf 2 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)






.

Note that the relative distribution of intensity in the focus reproduces the
angular distribution of intensity in the far ﬁeld, that is

ˆI (ˆrf ) = sinc2

2

~ˆrf
4 ˆf 2 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)








.

A plot of the universal function sinc2(α2/4) is given in Fig. 7. Note that all ex-
pressions pertaining undulator radiation from a single electron are azimuthal
symmetric but do not admit factorization in the product of functions sepa-
rately depending on the x and the y coordinates. As we have shown in [2], the
absence of factorization leads to an inﬂuence of the presence of the horizontal
emittance on the coherent properties of undulator radiation in the vertical
direction. As a result, even in the case of zero vertical emittance one cannot
have perfect coherence in the vertical direction.

For the image plane we obtain:

ˆE⊥(ˆzi,~ˆri) =

im
2π

−

exp



2

~ˆri|
im
|
2ˆz1 
2

~ˆu
4 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)




d~ˆu sinc 



exp

exp

im2

2

~ˆri|
|
2ˆz1 

.

~ˆu
i

im~ˆri ·





h

× Z

As already seen in Eq. (190) of [2] (Appendix C), the Fourier transform in Eq.
(92) can be calculated in terms of a Fourier-Bessel transform:

Z

d~ˆu sinc 



2

~ˆu
4 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)



exp

im~ˆri ·

~ˆu
i

h

= 2π

du uJo

∞

Z0

~ˆri|
m
|

u

(cid:16)

(cid:17)

sinc

u2
4 !

 

39

(90)

(91)

(92)

sinc

(

)

2

1,0

0,8

0,6

0,4

0,2

0,0

( )

1,0

0,8

0,6

0,4

0,2

0,0

0

1

2

3

4

5

6

7

8

Fig. 7. Universal function sinc2(α2/4) used to calculate (according to Eq. (91)) the
focal intensity of a single electron at the fundamental harmonic at perfect resonance.

0

1

2

3

4

5

Fig. 8. Universal function Ψ(α) used to calculate (according to Eq. (96)) the in-
tensity distribution on the image plane from a single electron at the fundamental
harmonic at perfect resonance.

40

Eq. (92) can now be written as

= 2π

2Si

π
h

−

(cid:16)

m2

2

~ˆri|
|

(cid:17)i

.

(93)

ˆE⊥(ˆzi,~ˆri) =

im exp

−

2

~ˆri|
im
|
2ˆz1 






exp

im2

2

~ˆri|
|
2ˆz1 






2Si

·

π
h

−

2

~ˆri|
|

m2
(cid:16)

(cid:17)i

. (94)

It is convenient to introduce the following universal function normalized to
unity:

Ψ(α) =

1
π2

π
h

−

2Si

α2

2

(cid:16)

(cid:17)i

The relative intensity on the image plane is related to the universal function
Ψ through the scaling factor m:

ˆI

~ˆri|

|
(cid:16)

(cid:17)

= Ψ

~ˆri|
m
|
(cid:16)

(cid:17)

.

A plot of the universal function Ψ(α) is given in Fig. 8.

Comparison of Eq. (94) with Eq. (36) allows one to conclude that the equiva-
lent source for a single electron moving on the z axis is a source characterized
by a plane wavefront and an intensity distribution related to the universal
function Ψ, that can be written as

ˆE⊥(0,~ˆr) =

i
−

π

2Si

−

h

2

~ˆr
|
|

(cid:16)

(cid:17)i

.

By means of an inverse Fourier transformation it follows that

ˆF

0, ~ˆu
(cid:17)

(cid:16)

=

2πi sinc 

−

2

~ˆu
4 
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)






,

in agreement with Eq. (87). Comparison of Eq. (97) with a normalized version
of Eq. (20) show that the phase of the ﬁeld of the virtual source is shifted of a
π/2 with respect to the spherical wave in the far zone. Such phase
quantity
shift is the analogous of the Guoy phase shift in laser physics. A single electron
produces a laser-like radiation beam that has a (virtual) waste much larger
than the radiation wavelength located in the center of the undulator.

−

The intensity distribution from the most elementary undulator source, i.e. the
radiation from a single electron (or, equivalently, from an electron beam with

(95)

(96)

(97)

(98)

41

zero emittance) was just described analytically. Such analytical description,
Eq. (96), can immediately be applied in situations of practical relevance. In
[10, 11] a characterization of the vertical emittance in Spring-8 is reported. It
is based on the measurement of the X-Ray beam coherence length in the far
zone. The experiment was performed at the beamline BL29XU. Based on the
assumption of validity of the van Cittert-Zernike theorem, it was found that
the rms electron beam size at the undulator center (corresponding to the min-
4.5 µm, and that the coupling factor
imal value of the beta function) was sy ≃
0.12%,
between horizontal and vertical emittance was down to the value χ
which corresponds to an extremely small vertical emittance ǫy = 3.6 pm
rad.
·
A resolution limit of this method was also discussed, based on numerical cal-
1.6 µm at Ep = 14.41
culations of the radiation size from a single electron sp ≃
keV for the 4.5 m long undulator used in the experiment. The resolution limit
of the measurement of sy was estimated to be about 1 µm.

≃

·

Based on Eq. (96), we can determine the virtual source size of undulator
radiation from a single electron. Let us consider the case when the single
electron is emitting photons at the fundamental harmonic with energy E =
14.41 keV. The angular frequency of light oscillations is given, in this case,
1019 Hz. For an undulator length Lw = 4.5 m, the normalization
by ω = 2.2
factor for the transverse size introduced in Eq. (76), (Lwc/ω)1/2, is about 8 µm.
From Fig. 8 obtain the dimensionless Half Width Half Maximum (HWHM)
radiation size from a single electron (i.e. the HWHM width of the intensity
distribution at the virtual source, located at the center of the undulator). This
HWHM dimensionless value is about 0.7. It follows that the HWHM value of
the radiation spot size from a single electron is about 0.7
6 µm. Therefore, the rms value sp ≃
numerically [12], is an underestimation of the correct value.

≃
1.6 µm in [10, 11], which was calculated

(cLw/ω)1/2

·

Note that the HWHM radiation spot size from a single electron is larger
4.5 µm found by means of coherence
than the rms electron beam size sy ≃
measurements. One concludes that the uncertainty due to ﬁnite resolution is
larger than the measured electron beam size. This suggests that the method
used in [10, 11] may be inconsistent. Such inconsistency may be traced to the
fact that authors of [10, 11] assume the validity of the van Cittert-Zernike
theorem in the vertical direction. If one assumes their result of a vertical
0.3λ/(2π), it follows a posteriori that the van Cittert-Zernike
emittance ǫy ≃
theorem could not have been applied in ﬁrst instance (in this experiment the
value of the beta function was β
Lw). Hence the inconsistency of the method
follows. Analysis of experimental results should have been based, instead, on
the study of transverse coherence for non-homogeneous undulator sources in
free space made in [2].

≃

42

3.2

Eﬀect of aperture size

The eﬀects due to the presence of the pupil can be included in the treatment
by means of a normalized version of Eq. (40) and Eq. (41) on the focal plane

ˆEP (ˆzf ,~ˆrf ) = exp

2



~ˆrf |
i
|
2 ˆf 

~ˆrf
ˆf −


d~ˆu ˆ

P 


× Z

and on the image plane

ˆEP (ˆzi,~ˆri) = exp

2



~ˆri|
im
|
2ˆz1 

m~ˆri
ˆz1 −


d~ˆu ˆ

P 


× Z

where

(~ˆu) =

ˆ
P

Z

d~ˆr′P (~ˆr′) exp

i~ˆr′

.

~ˆu

·

(cid:21)

(cid:20)−

~ˆu

exp



·



2

~ˆu
i ˆf
|
|
2 




−



ˆE⊥

ˆzf , ˆf~ˆu

,

(cid:16)

(cid:17)

(99)

~ˆu

exp



·



iˆz1

2

~ˆu
|
|
2m 




−



ˆE⊥ 

zi,



ˆz1~ˆu
m 


,

(100)

Eq. (100) is valid independently of the position of the lens. However, as ex-
plained in Section 2.2 and in Section 2.4 we will limit ourselves to the case
when the lens is in the far zone. From Eq. (96) we see that the characteristic
size of the source is of order unity, because Ψ is a universal function. As a
result, the far ﬁeld zone for a single particle is deﬁned by the condition

ˆz1

1 .

≫

By substitution of Eq. (20) in Eq. (26), followed by use of the lens equation
Eq. (30) and normalization, one obtains an expression for the ﬁeld valid in the
case the lens is placed in the far zone. Such expression is equivalent, in that
limit, to Eq. (100). If the pupil function is not set to unity, we have

(101)

(102)

ˆEP (ˆzi, ~ˆri) =

m
4π2 ˆz2
1

−

exp

d~ˆr′ ˆF

× Z




0,

2

~ˆri|
im
|
2ˆz1 

~ˆr′
P
ˆz1 


−





43

~ˆr′

exp

(cid:16)

(cid:17)



−



~ˆr′)

im(~ˆri ·
ˆz1

.





(103)

(104)

(105)

(106)

Eq. (103) can also be obtained by substitution of Eq. (89) in Eq. (100) followed
by application of the convolution theorem.

In the far ﬁeld case Eq. (100) (or Eq. (103)) can be more easily used to
calculate the eﬀects of the pupil on the intensity. A natural example to study
is the case of a lens with azimuthal symmetry and no aberrations. Consider a
pupil of radius a. After introduction of the normalized pupil radius:

ˆa = a

ω
Lwc

s

we set the pupil function:

P (~ˆr) = 


1

0

if

< ˆa

~ˆr
|
|
otherwise .

Using the Fourier-Bessel transform one obtains



(~ˆu) =

ˆ
P

2πˆa
~ˆu
|
|

J1

~ˆu
|
|

ˆa
(cid:16)

(cid:17)

.

Substitution of Eq. (94) in Eq. (100) and use of the far zone assumption leads
to

ˆEP (ˆzi,~ˆri) =

2πimˆa exp

−




m~ˆri
ˆz1 −

2

~ˆri|
im
|
2ˆz1 
−1

J1 
ˆa


~ˆu
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

d~ˆu

× Z

m~ˆri
ˆz1 −

~ˆu
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)





2Si

π
h

−

2

~ˆu
ˆz2
1|
(cid:16)

|

(cid:17)i

.

(107)

Eq. (107) is, essentially, the convolution product of the Fourier transform of
two known functions with circular symmetry. Therefore, recalling Eq. (93) and
Eq. (105), Eq. (107) can be written in terms of the following Fourier-Bessel
transform:

ˆEP (ˆzi,~ˆri) =

i exp

−

ˆa/ˆz1

2

~ˆri|
im
|
2ˆz1 






Z0

dˆu ˆuJ0

~ˆri|
m
|

ˆu
(cid:17)

(cid:16)

sinc

ˆu2
4 !

 

.

(108)

44

 Universal function 

 Diffr. pattern from circ. hole

 Relative intensity

0,8

Here a/z

= 1.0

^ ^

1

^

I

P

1,0

0,6

0,4

0,2

0,0

0

1

2

3

4

5

6

7

8

9

10

m r

^

i

Fig. 9. Comparison between the relative intensity for a single electron at the image
plane ˆIP , Eq. (109), the universal function Ψ, Eq. (96), and the (Airy) diﬀraction
pattern from a circular hole, Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 1.

Eq. (108) can also be directly obtained using the Fourier-Bessel integration
formula and Eq. (103). Eq. (108) corresponds to a relative intensity

ˆIP

=

~ˆri|

|

(cid:16)

(cid:17)

1
4 "

Si

ˆa2
4ˆz2

 

1 !#

dˆu ˆuJ0

~ˆri|
m
|

ˆu
(cid:17)

(cid:16)

sinc

ˆu2
4 !

 

−2

ˆa/ˆz1

.

(109)

In the limit ˆa/ˆz1
factor, and Eq. (109) gives back Eq. (96) as it should be.

1 Eq. (108) gives back Eq. (94) without the second phase

≫

When ˆa/ˆz1
1 the sinc(
diﬀraction pattern from a circular hole:

≪

·

) drops out of the integral in Eq. (109) giving the

Z0

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

2

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

ˆIP

~ˆri|

=

ˆa/ˆz1

dˆu ˆuJ0

~ˆri|
m
|

ˆu
(cid:17)

2

=

4ˆz2
1
~ˆri|
ˆa2m2
|

|

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
Further, analysis of Fig. 9 actually shows that Eq. (110) retains its validity
(cid:12)

ˆz1 !

 

Z0

(cid:17)

(cid:16)

(cid:16)

2

ˆamˆri

J 2
1

.

(110)

4ˆz4
1
ˆa4 (cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

45

 Universal function 

 Diffr. pattern from circ. hole

 Relative intensity

0,8

Here a/z

= 5

^ ^

1

^

I

P

1,0

0,6

0,4

0,2

0,0

0

1

2

3

4

5

m r

^

i

Fig. 10. Comparison between the relative intensity for a single electron at the image
plane ˆIP , Eq. (109), the universal function Ψ, Eq. (96), and the (Airy) diﬀraction
pattern from a circular hole, Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 5.

also for ˆa/ˆz1 . 1.

Comparisons between the relative intensity ˆIP , Eq. (109), the universal func-
tion Ψ, Eq. (96), and the diﬀraction pattern from a circular hole, Eq. (110),
are plotted as a function of mˆri in Fig. (9) for ˆa/ˆz1 = 1, in Fig. (10) for
ˆa/ˆz1 = 5 and in Fig. (11) for ˆa/ˆz1 = 10.

4

Image formation with partially coherent undulator source

4.1

Coherence properties of undulator source in the presence of electron
beam emittance

In the last Section we dealt with the image formation problem in the case of a
ﬁlament beam, i.e. when the electron beam emittance is zero. In this Section
we will generalize the previous results to the case when the electron beam
has ﬁnite emittance. In this situation, methods from Statistical Optics must

46

 Universal function 

 Diffr. pattern from circ. hole

 Relative intensity

0,8

Here a/z

= 10

^ ^

1

^

I

P

1,0

0,6

0,4

0,2

0,0

0

1

2

3

4

5

m r

^

i

Fig. 11. Comparison between the relative intensity for a single electron at the image
plane ˆIP , Eq. (109), the universal function Ψ, Eq. (96), and the (Airy) diﬀraction
pattern from a circular hole, Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 10.

be applied in order to solve the image formation problem. As discussed be-
fore, the cross-spectral density of an undulator source must ﬁrst be calculated
at the lens position and subsequently propagated through the lens and the
forthcoming optical beamline up to the experimental plane.

In [2] we proposed a method, based on Eq. (77), to calculate the cross-spectral
density from undulator sources at any position in free space after the undula-
tor. Let us follow [2] and use Eq. (77) to calculate the cross-spectral density.
The cross-spectral density G is given, in dimensional units and as a function
of dimensional variables, by Eq. (51). Since the ﬁeld in Eq. (77) is given in
~ˆθx,y and ˆC,
normalized units and as a function of normalized variables ˆzo,
it is convenient to introduce a version of G deﬁned by means of the ﬁeld in
normalized units

ˆG(ˆzo,

~ˆθ1,

~ˆθ2, ˆC) =

*

ˆEs⊥ 



ˆC, ˆzo,

~ˆθ1

~ˆl
ˆzo −

−

~ˆη



47

ˆE∗

s⊥ 

ˆC, ˆzo,

~ˆθ2

×

~ˆl
ˆzo −

−




.

+~ˆη,
~ˆl

~ˆη



Transformation of G in Eq. (51) to ˆG (and viceversa) can be performed shifting
from dimensional to normalized variables and multiplying G by an inessential
factor

(111)

(112)

ˆG =

2

c2γ
KωeAJJ !

 

G .

Substituting Eq. (80) in Eq. (111) we obtain

ˆG(ˆzo,

~ˆθ1,

~ˆθ2, ˆC) =

S 

~ˆθ1

ˆC, ˆzo, 


~ˆθ1


i 



exp 


*

×







~ˆl
ˆzo −

−

~ˆη



2

~ˆl
ˆzo

−

2

S∗





~ˆθ2

−






− 



~ˆθ2



ˆC, ˆzo, 


ˆzo
2 




~ˆl
ˆzo





2







~ˆl
ˆzo −

−

2

~ˆη








.

(113)

+~ˆη,
~ˆl



Expanding the exponent in the exponential factor in the right hand side of
Eq. (113), one can see that terms in ˆl2
x,y contribute
for a common factor, and only linear terms in ˆlx,y remain inside the ensemble
average sign. Substitution of the ensemble average with integration over the
beam distribution function leads to


x,y cancel out. Terms in ˆθ2

ˆG(ˆzo,

~ˆθ1,

~ˆθ2, ˆC) = exp

2
~ˆθ
1 −
 

~ˆθ

2

2

i
"

!

ˆzo
2 # Z

d~ˆηd

~ˆl F~ˆη,
~ˆl

~ˆl
~ˆη,
(cid:18)
(cid:19)
~ˆl
ˆzo −

−

~ˆθ1

2

~ˆη








(114)

exp

×

~ˆθ2
i(
(cid:20)

~ˆθ1)

·

−

S∗



×

~ˆθ2

−

ˆC, ˆzo, 



S 

~ˆl
(cid:21)
~ˆl
ˆzo −

2

ˆC, ˆzo, 




~ˆη





.

Here integrals d~ˆη and in d
spanned by the ~ˆη and
a starting point for computer simulations.





~ˆl are to be intended as integrals over the entire plane
~ˆl vectors. Eq. (114) is very general and can be used as

We assume that the distribution in the horizontal and vertical planes are not
correlated, so that F~ˆη,
= Fˆηx,ˆlxFˆηy,ˆly . If the transverse phase-space is speciﬁed
~ˆl
at the virtual-source position ˆzo = 0 corresponding to the minimal values of
the beta functions, we can write Fˆηx,ˆlx = FˆηxFˆlx and Fˆηy,ˆly = Fˆηy Fˆly with

48

Fˆηx(ˆηx) =

Fˆηy (ˆηy) =

Fˆlx(ˆlx) =

Fˆly (ˆly) =

1
2π ˆDx
1
2π ˆDy
1
2π ˆNx
1
2π ˆNy

q

q

q

q

exp

 −

exp

 −

exp

 −

exp



−



,

,

,

.

ˆη2
x
2 ˆDx !
ˆη2
y
2 ˆDy !
ˆl2
x
2 ˆNx !
ˆl2
y
2 ˆNy





From Eq. (76) and Eq. (78) it is possible to see that

(115)

(116)

(117)

(118)

ˆDx,y = σ2

x′,y′

ˆNx,y = σ2
x,y

ωLw
c

ω
cLw

ˆAx,y =

ˆNx,y
ˆz2
o

.

where σx,y and σx′,y′ are the rms transverse bunch dimension and angular
spread. Parameters ˆNx,y will be indicated as the beam diﬀraction parameters
and are analogous to Fresnel numbers. They correspond to the normalized
square of the electron beam sizes. ˆDx,y represent the normalized square of
the electron beam divergences instead. It is also convenient to introduce the
square of the apparent angular size of the electron beam at the observer point
position ˆzo, that is

Substitution of relations (115) in Eq. (114) yields 7 at perfect resonance ( ˆC =
0):

ˆG(ˆzo,

~ˆθ1,

~ˆθ2) =

exp

i
"

4π2

ˆzo/2

2

2

~ˆθ

2
~ˆθ
1 −
 
ˆDx ˆDy ˆNx ˆNy

!

#

∞

Z−∞

q

dˆηx exp

ˆη2
x
2 ˆDx !

 −

~ˆθ2, ˆC) with the simpliﬁed dependence ˆG(ˆzo,

7 In Eq. (119),
for notational simplicity we substituted the proper notation
~ˆθ1,
~ˆθ2). This is justiﬁed because
ˆG(ˆzo,
~ˆl/ˆzo −
~ˆθ
~ˆη)2] is
we will be treating the case ˆC = 0 only. Consistently, also S[ˆzo, (
~ˆθ
~ˆl/ˆzo −
~ˆη)2] calculated at
to be understood as a shortcut notation for S[ ˆC, ˆzo, (
ˆC = 0.

~ˆθ1,

−

−

49

∞

×

Z−∞
∞

×

Z−∞

dˆηy exp

 −

dˆly exp

S 

ˆzo, 

~ˆθ1

×

−







ˆη2
y
2 ˆDy !
ˆl2
y
2 ˆNy
~ˆl
ˆzo −




~ˆη



∞

Z−∞

exp

2








−



dˆlx exp

ˆl2
x
2 ˆNx !

 −

~ˆθ2
i(

~ˆθ1)

−

·

(cid:20)

S∗

ˆzo, 


~ˆθ2







~ˆl
(cid:21)
~ˆl
ˆzo −

−

2

~ˆη








Let us now introduce 8

∆ˆθx =

ˆθx1

ˆθx2

−
2

, ¯θx =

ˆθx1 + ˆθx2
2

and

∆ˆθy =

ˆθy1

ˆθy2

−
2

, ¯θy =

ˆθy1 + ˆθy2
2

.

With this variables redeﬁnition we obtain

ˆG = ˆG(ˆzo, ¯θx, ¯θy, ∆ˆθx, ∆ˆθy)

and, explicitly,

. (119)

(120)

(121)

(122)

exp

ˆG =

i2ˆzo
h

4π2

¯θx∆ˆθx + ¯θy∆ˆθy
ˆDx ˆDy ˆNx ˆNy

(cid:16)

∞

(cid:17)i

Z−∞

∞

dˆηx exp

ˆη2
x
2 ˆDx !

 −
ˆl2
x
2 ˆNx !

dˆlx exp

 −

∞

q
dˆηy exp

dˆly exp

×

Z−∞
∞

×

Z−∞

ˆη2
y
2 ˆDy !
ˆl2
y
2 ˆNy





 −



−



S

×

ˆzo,

¯θx + ∆ˆθx −

 









2i

∆ˆθx

ˆlx + ∆ˆθy

ˆly

+

¯θy + ∆ˆθy −

 

Z−∞

exp

ˆlx
ˆzo −
ˆlx
ˆzo −

−
h

ˆηx

(cid:16)
2

!

2

(cid:17)i
ˆly
ˆzo −
ˆly
ˆzo −

ˆηy

2

!



2


ˆηy

!





S∗

ˆzo,

×

¯θx −

∆ˆθx −

 

ˆηx

!

+

¯θy −

∆ˆθy −

 

. (123)

8 Note that the deﬁnition of ∆ˆθx and ∆ˆθy diﬀer for a factor 2 and a sign with
respect to notations in [8, 9].

50

A double change of variables ˆηx,y −→
ˆlx,y/ˆzo −→
leads to

ˆφx,y −

ˆηx,y + ¯θx,y followed by the substitution
ˆηx,y and by analytical calculation of the integrals in dˆηx,y

ˆG =

1

4π2

ˆAx ˆDx ˆAy ˆDy

q
exp

i2¯θx ˆzo∆ˆθx

exp

¯θx ˆzo∆ˆθx

¯θ2
y + 4 ˆAy ˆz2

ˆDy + 4i ˆAy ¯θy ˆzo∆ˆθy

y

x

ˆDx + 4i ˆAx

o∆ˆθ2
2( ˆAx + ˆDx)
o ∆ˆθ2
2( ˆAy + ˆDy)
¯θx + 2i ˆAx ˆzo∆ˆθx
(cid:16)
2( ˆAx + ˆDx)

(cid:17)





¯θ2
x + 4 ˆAx ˆz2

"−

×

×

h

h

i

i

exp

i2¯θy ˆzo∆ˆθy

exp

∞

∞

d ˆφx

d ˆφy exp





−
x + 2 ˆφx
ˆφ2



−

×

Z−∞

Z−∞
y + 2 ˆφy
ˆφ2




¯θy + 2i ˆAy ˆzo∆ˆθy
(cid:16)
2( ˆAy + ˆDy)
−
ˆzo, ( ˆφx −
∆ˆθy)2
∆ˆθx)2 + ( ˆφy −
ˆzo, ( ˆφx + ∆ˆθx)2 + ( ˆφy + ∆ˆθy)2
h
h



(cid:17)





i

.

i

exp

×

S∗

×

×

S

#





(124)

Eq. (124) is a valid expression for the cross-spectral density in free space
after the undulator device (i.e. for ˆzo > 1/2) and can be used together with
equations from (60) to (66).

Let us now introduce the dimensionless version of Eq. (54) with the help of
~¯r = ˆzo

~¯θ and ∆~ˆr = ˆzo∆

~ˆθ 9 :

·

R

d∆~ˆr′ ˆG(ˆz,~¯r, ∆~ˆr′) exp[2i(~¯u

9 A short digression about Eq. (125) is due here. As the reader may have noticed, ˆ
G
coincides with the Fourier transform, done with respect to ~¯r′, of the Wigner distri-
∆~ˆr′)]. The knowledge of the Wigner
bution ˆΦ(ˆz,~¯r, ~¯u) =
distribution is mathematically equivalent to the knowledge of ˆ
or ˆG. A formalism
G
based on the Wigner distribution may be thus developed, which is mathematically
equivalent to the one developed here. In the case of quasi-homogeneous sources,
the Wigner distribution amounts to Eq. (6), that is the phase space distribution.
Interpretations of such a function as a sort of generalized phase space distribution in
more generic cases for non-homogeneous sources have been proposed. However, there
is no practical advantage in considering such an approach in our case. Moreover,
the Wigner distribution is a quantity that cannot be directly measured. Therefore,
we prefer to use a formalism based on the cross-spectral density which is a physi-
cally measurable quantity. The cross-spectral density may be directly measured by
means of Young’s double pinhole interferometer, whereas the Wigner function is a
mathematical transformation of the cross-spectral density.

51

ˆ
G

(cid:16)

ˆz, ~¯u, ∆~ˆu

=

d~¯r′ d∆~ˆr′ ˆG

ˆz, ~¯r′, ∆~ˆr′

exp

∆~ˆr′ + ∆~ˆu

.(125)

2i
h

~¯u
(cid:16)

·

~¯r′

·

(cid:17)i

(cid:17)

Z

(cid:16)

(cid:17)

Its inverse is given by

ˆG

ˆz,~¯r, ∆~ˆr
(cid:17)
(cid:16)

=

d~¯u′ d∆~ˆu′

Z
ˆz, ~¯u′, ∆~ˆu′

1
(2π)4
ˆ
G

×

(cid:16)

exp

2i

−

h

(cid:17)

Similarly as before, we consider coordinates ~¯θ = ~¯r/ˆzo and ∆
but for ﬁnite ratios ~¯θ and ∆
limit ˆzo −→ ∞
Eq. (56) then reads:

~¯u′
(cid:16)

.

·

·

(126)

∆~ˆr + ∆~ˆu′

~¯r
(cid:17)i
~ˆθ = ∆~ˆr/ˆzo in the
~ˆθ. The dimensionless version of

ˆG

~ˆθ
ˆzo,~¯θ, ∆
(cid:19)
(cid:18)

=

1
4π2ˆz2
o

exp

~¯θ
2iˆzo

(cid:20)

~ˆθ
∆
(cid:21)

ˆ
G (cid:18)

·

0,

~¯θ,
−

~ˆθ
∆
(cid:19)

−

.

This result will be widely used in what follows. Moreover an analogous of Eq.
(55) is:

ˆ
G (cid:18)

~ˆθ
ˆz,~¯θ, ∆
(cid:19)

= ˆ

G (cid:18)

~ˆθ
0,~¯θ, ∆
(cid:19)

exp

i2ˆz~¯θ

~ˆθ
∆
(cid:21)

·

.

(cid:20)−

This result means that, aside for a phase factor, the spatial Fourier transform
of the cross-correlation function, ˆ
, does not depend on ˆz, as it follows from
G
the analogous property of the Fourier transform of the electric ﬁeld discussed
in Section 2.

Before proceeding, let us introduce the spectral degree of coherence g, which
can be presented as a function of ¯r and ∆ˆr:

g

~¯r, ∆~ˆr
(cid:16)
(cid:17)

=

ˆG

2

~¯r, ∆~ˆr
(cid:16)
(cid:17)
1/2
ˆEs⊥

ˆEs⊥

~¯r + ∆~ˆr
(cid:16)

(cid:28)(cid:12)
(cid:12)
(cid:12)

(cid:29)

(cid:17)(cid:12)
(cid:12)
(cid:12)

(cid:28)(cid:12)
(cid:12)
(cid:12)

∆~ˆr

~¯r
(cid:16)

−

(cid:29)

(cid:17)(cid:12)
(cid:12)
(cid:12)

1/2 .

2

(129)

With reference to Fig. 12, the modulus of the spectral degree of coherence,
,
|
mathematically describes the fringe visibility of the interference pattern from
a Young’s double-pinhole interferometric measure. The phase of the spectral
degree of coherence is related, instead, to the position of the fringes. The
cross-spectral density gives amplitude and position of the fringes. In general,
the process may not be quasi-homogeneous. In this case, the result of Young’s
experiment varies with ~¯r. In this case, the relation between the visibility V of
the fringes and g(~¯r, ∆~ˆr) reads

g

|

(127)

(128)

52

z1

z2-z1

fringes

V=|g| is the fringes visibility

Fig. 12. Measurement of the cross-spectral density of an undulator source. (a)
Young’s double-pinhole interferometer demonstrating the coherence properties of
undulator radiation. Radiation must be spectrally ﬁltered by a monochromator or
detector (not shown in ﬁgure). (b) In the quasi-homogeneous case the fringe visi-
bility V of the resultant interference pattern is equal to the absolute value of the
spectral degree of coherence: V =

.
|

g
|
1/2

2

ˆEs⊥

~¯r + ∆~ˆr
(cid:16)
ˆEs⊥

(cid:17)(cid:12)
(cid:12)
~¯r + ∆~ˆr
(cid:12)
(cid:17)(cid:12)
(cid:16)
(cid:12)
(cid:12)

(cid:29)
2

(cid:29)

V = 2 (cid:28)(cid:12)
(cid:12)
(cid:12)
(cid:28)(cid:12)
(cid:12)
(cid:12)

(cid:28)(cid:12)
(cid:12)
+
(cid:12)
(cid:28)(cid:12)
(cid:12)
(cid:12)

∆~ˆr

ˆEs⊥

~¯r
(cid:16)
ˆEs⊥

−
~¯r
(cid:16)

−

(cid:29)
2

(cid:17)(cid:12)
(cid:12)
∆~ˆr
(cid:12)
(cid:17)(cid:12)
(cid:12)
(cid:12)

(cid:29)

1/2

2

In the quasi-homogeneous limit V

−→

g
(cid:12)
(cid:12)
(cid:12)

(cid:16)

∆~ˆr

.

(cid:17)(cid:12)
(cid:12)
(cid:12)

4.2

Large non-limiting aperture

.

(130)

g

~¯r, ∆~ˆr
(cid:16)

(cid:12)
(cid:12)
(cid:12)

(cid:17)(cid:12)
(cid:12)
(cid:12)

As explained before we start neglecting, at ﬁrst, the eﬀects from a ﬁnite pupil
dimension, assuming a perfect lens with no aberrations. The imaging problem
for an ideal lens is solved once we ﬁnd the cross-spectral density of the equiv-
alent virtual source for the undulator source. On the focal plane we can write
Eq. (62) in normalized units as

ˆG(ˆzf ,~¯rf , ∆~ˆrf ) =

1
4π2 ˆf 2

exp

2i
ˆf

~¯rf ·

"

∆~ˆrf

#

53

exp

×

"−

2iˆz1
ˆf 2

~¯rf ·

∆~ˆrf

#

ˆ
G 


0,

~¯rf
ˆf

,

−

−

,

∆~ˆrf
ˆf 


(131)

while on the image plane, Eq. (66) in normalized units reads

ˆG(ˆzi,~¯ri, ∆~ˆri) = m exp

2im
ˆz1
2im2
ˆz1

~¯ri ·
~¯ri ·

(cid:20)

"

∆~ˆri

(cid:21)
∆~ˆri

#

exp

×

ˆG

0,

m~¯ri,

m∆~ˆri

.

−

−

(cid:16)

(cid:17)

(132)

In all cases considered in this paper the position ˆz = 0 is well within the radi-
ation formation length of the undulator. Therefore the cross-spectral density
ˆG, calculated at ˆz = 0 has no direct physical meaning, and must be considered
as a quantity characterizing the virtual source only. From the deﬁnitions of
virtual source and cross-spectral density follows that the virtual source pro-
duces not only the same ﬁeld but also the same cross-spectral density of the
real undulator source, at any distance from the exit of the undulator.

In the present study case of a radiation spot size smaller than the area of the
lens and of a lens with no aberrations, Eq. (124) and Eq. (128), together with
Eq. (131) and Eq. (132), solve the problem of characterizing the cross-spectral
density on the focal plane (with the help of Eq. (131)) and on the image plane
(with the help of Eq. (132)). The situation of a radiation spot size smaller
than the area of the lens is practically achievable for Synchrotron Radiation
due to its high directionality. In this case, vignetting eﬀects are not present.
However, even in this case, in order to use Eq. (131) and Eq. (132) one must
further assume that aberrations can be neglected.

4.3

Eﬀect of aperture size

Accounting for the presence of the pupil, in analogy with Eq. (60) one has the
following normalized expression for the cross-spectral density on any observa-
tion plane at position ˆz2 along the beamline behind the lens:

ˆG(ˆz2,~¯r, ∆~ˆr) =

1
4π2(ˆz2

ˆz1)2 exp

−
d~¯r′ d∆~ˆr′

× Z

exp

2i
"

 −

×

ˆG

+

(
1
ˆf



∆~ˆr
2i~¯r
·
ˆz1 
ˆz2
−


ˆz1, ~¯r′, ∆~ˆr′
(cid:18)

1

−

ˆz2

ˆz1 !

54

P ∗

~¯r′
(cid:18)

−

(cid:19)

∆~ˆr′

(cid:19)

P

~¯r′ + ∆~ˆr′
(cid:18)
∆~ˆr′

# )

(cid:19)
~¯r′

·

exp

×

(cid:20)−

ˆz2

2i

−

~¯r
ˆz1 (cid:18)

·

∆~ˆr′ + ~¯r′

∆~ˆr

.

·

(cid:19)(cid:21)

(133)

Let us consider, more speciﬁcally, the focal and the image plane. Results can
be obtained directly from Eq. (133). Alternatively, in analogy with Eq. (67)
and Eq. (68), one can use our previous results, Eq. (131) and Eq. (132), divide
them by the ﬁrst phase factor, convolve them twice with ˆ
∗ and, ﬁnally,
P
put the phase factor back. A normalized version of the cross-spectral density
ˆGP including pupil eﬀects at the focal is then found and can be written as

and ˆ
P

ˆGP (ˆzf ,~¯rf , ∆~ˆrf ) = exp

∆~ˆrf

2i
~¯rf ·
ˆf
"
#
d~¯u d∆~ˆu exp
~¯rf + ∆~ˆrf
ˆf

−

−
h
~¯u

× Z
ˆ
P 


×

2i ˆf~¯u

∆~ˆu

∆~ˆu


∗

ˆ
P

−

·



i





ˆG(ˆzf , ˆf~¯u, ˆf∆~ˆu)
∆~ˆrf
~¯rf −
ˆf

−

~¯u + ∆~ˆu

,



(134)


while on the image plane one obtains

ˆGP (ˆzi,~¯ri, ∆~ˆri) = exp

2im
ˆz1

(cid:20)

ˆG

×

 

∗

ˆ
P

×

ˆzi,

m
ˆz1

(cid:20)

∆~ˆri

(cid:21) Z
∆~ˆu

~¯ri ·
ˆz1
ˆz1
~¯u,
m
m
∆~ˆri
~¯ri −

(cid:16)

!

−

(cid:17)

d~¯u d∆~ˆu exp

"−
m
~¯ri + ∆~ˆri
ˆz1
(cid:16)
~¯u + ∆~ˆu

.

ˆ
P (cid:20)

(cid:21)

2iˆz1
m

~¯u

∆~ˆu

·

~¯u

−

−

(cid:17)

#

∆~ˆu

(cid:21)

As said before, we will treat particular situations in the image plane when the
lens is in the far ﬁeld. Using coordinates ~¯ri and ∆~ˆri the analogous of condition
(70) reads

(135)

(136)

2m2
ˆz1

~¯ri ·

∆~ˆri ≪

1

for any pair of points on the image pattern.

Explicit substitution of Eq. (132) in Eq. (135) yields the following far ﬁeld
limit expression, which accounts for condition (136):

ˆGP (ˆzi,~¯ri, ∆~ˆri) = m exp

∆~ˆri

2im
~¯ri ·
ˆz1
~¯ri + ∆~ˆri
(cid:16)

(cid:20)
m
ˆz1

(cid:17)

(cid:21) Z

ˆ
P (cid:20)

×

~¯u

−

−

∆~ˆu

(cid:21)

d~¯u d∆~ˆu ˆG

ˆz1~¯u,

ˆz1∆~ˆu

−

0,
(cid:16)

−

(cid:17)

55

∗

ˆ
P

×

m
ˆz1

(cid:20)

~¯ri −

(cid:16)

∆~ˆri

~¯u + ∆~ˆu

.

−

(cid:17)

(cid:21)

(137)

Eq. (137) is in analogy with Eq. (71) and Eq. (45).

5

Imaging of quasi-homogeneous Gaussian undulator sources by
a lens with large non-limiting aperture

In this Section we specialize our discussion to the particular case of quasi-
homogeneous Gaussian undulator sources, assuming a lens with large non-
limiting aperture and no aberrations. A Statistical Optics treatment is not
the only one possible in this particular study case. A Geometrical Optics
approach can also be applied, practically consisting in ray-tracing techniques.
In this Section we will consider the image formation problem from a Statistical
Optics viewpoint. In Section 7 an analysis in terms of Geometrical Optics will
be given, and agreement between these two methods will be demonstrated.

1 and ˆDx ≫

From this point on, we will systematically ignore unimportant pre-factors ap-
pearing in the expressions for the cross-spectral density. Moreover we will
assume ˆNx ≫
1 which is a reasonable approximation for third
generation light sources in the X-ray region. We will show that this assump-
tion leads to a major simpliﬁcation: namely, horizontal and vertical coordi-
nates turn out to be factorized in the expression for the cross-spectral density
in free space. As a consequence, Eq. (131) and (132) can also be factorized in
the product of a factor depending on the horizontal coordinates and a factor
depending on the vertical coordinates. These separate factors will be obtained
from Eq. (131) and (132) substituting all vector quantities with scalar quan-
tities (horizontal or vertical components).

5.1 Evolution of the cross-spectral density function in free space

Eq. (124) is a valid expression for the cross-spectral density in free space at
perfect resonance, calculated under the only assumptions that the system is
ultra-relativistic (and, therefore, the paraxial approximation can be applied)
and that the insertion device is characterized by a large number of undulator
periods. In this case the resonance approximation is enforced. Eq. (124) is
quite generic and, with respect to ﬁrst-principle calculations, it involves the
computation of a two-dimensional integral, whereas the most generic calcula-
tions would require a total of six integrations, two over the undulator length
and four over the electron beam transverse phase space (assuming that the
cross-correlation terms between diﬀerent electrons is neglected). From a com-
putational viewpoint, the advantage of reducing the number of integration is

56

obvious and it can be appreciated even more after the cross-spectral density is
propagated through an optical system with limiting apertures, which naturally
increases the dimensions of the integration to be performed.

1 and ˆDx ≫

When ˆNx ≫
1 the cross-spectral in free space, Eq. (124), can be
written as the product of factors separately depending on the x and on the y
coordinate, as has been shown in [2]. In fact, analyzing the exponential factor
outside the integral sign in Eq. (124) it is possible to see that the maximum
value of ∆ˆθ2
1, where we remember ˆAx =
o. As a result, ∆ˆθx can be neglected inside the S functions in Eq. (124).
ˆN 2
x /ˆz2
Moreover, since ˆDx ≫
x +
2 ˆφx

1 one can also neglect the exponential factor in ˆφ2

x is of order ( ˆAx + ˆDx)/( ˆAx ˆDx ˆz2
o)

¯θx inside the integral. This leads to

≪

¯θ2
x + 4 ˆAx ˆz2

ˆDx + 4i ˆAx

¯θx ˆzo∆ˆθx

¯θ2
y + 4 ˆAy ˆz2

ˆDy + 4i ˆAy ¯θy ˆzo∆ˆθy

x

o∆ˆθ2
2( ˆAx + ˆDx)
o∆ˆθ2
2( ˆAy + ˆDy)

y

#





ˆG = exp

i2¯θx ˆzo∆ˆθx

exp

"−

i

h
i2¯θy ˆzo∆ˆθy
h
d ˆφx exp

i
i ˆφx
"

exp

×

∞

×

Z−∞
∞

d ˆφy exp

exp



−

2 ˆAx ˆzo∆ˆθx
ˆAx + ˆDx #
y + 2 ˆφy
ˆφ2

¯θy + 2i ˆAy ˆzo∆ˆθy

(cid:17)







×

×

Z−∞
S∗

∆ˆθy)2

ˆzo, ˆφ2
h

−
x + ( ˆφy −

(cid:16)
2( ˆAy + ˆDy)
ˆzo, ˆφ2
h
Following the same reasoning in [2], we can also neglect the phase factor in ˆφx
under the integral in d ˆφx in Eq. (138). As a result, when ˆNx ≫
1 and ˆDx ≫
1
horizontal and vertical coordinates are factorized and we obtain the following
equation for ˆG:

x + ( ˆφy + ∆ˆθy)2

S
i

(138)



i

.

ˆG(ˆzo, ¯θx, ¯θy, ∆ˆθx, ∆ˆθy) = ˆGx(ˆzo, ¯θx, ∆ˆθx) ˆGy(ˆzo, ¯θy, ∆ˆθy) ,

(139)

where

and

ˆGx = exp

i2¯θx ˆzo∆ˆθx
h

i

exp

"−

¯θ2
x + 4 ˆAx ˆz2

ˆDx + 4i ˆAx ¯θx ˆzo∆ˆθx

x

o∆ˆθ2
2( ˆAx + ˆDx)

#

(140)

ˆGy = exp

i2¯θy ˆzo∆ˆθy
h

i

exp



−



¯θ2
y + 4 ˆAy ˆz2

ˆDy + 4i ˆAy ¯θy ˆzo∆ˆθy

y

o ∆ˆθ2
2( ˆAy + ˆDy)





57

y + 2 ˆφy
ˆφ2

¯θy + 2i ˆAy ˆzo∆ˆθy

(cid:16)
2( ˆAy + ˆDy)

(cid:17)





∞

×

Z−∞
∞

×

Z−∞

d ˆφy exp

d ˆφxS∗



−


ˆzo, ˆφ2
h

x + ( ˆφy −

∆ˆθy)2

S
i

ˆzo, ˆφ2
h

x + ( ˆφy + ∆ˆθy)2

.

(141)

i

≫

≫

1 and ˆD

To begin our investigation of quasi-homogeneous sources we will consider the
limit ˆN
1, when the photon-beam phase space in a certain
(horizontal or both horizontal and vertical) direction is an exact replica of the
electron-beam phase space. Calculations can be performed in one dimension,
suppressing indexes x and y. In the case of Second Generation light sources
the results that we are going to derive constitute a realistic description of the
radiation characteristics in both horizontal and vertical directions. Then, Eq.
(141) coincides with Eq. (140).

Let us present Eq. (140), i.e. the asymptotic expression for the cross-spectral
1, in terms of coordinates ¯r = ˆz ¯θ and
density in the limit ˆN
∆ˆr = ˆz∆ˆθ. We have

1 and ˆD

≫

≫

ˆG(ˆz, ¯r, ∆ˆr) = exp

"−

¯r2
2( ˆA + ˆD)ˆz2 #
ˆA¯r∆ˆr
ˆz( ˆA + ˆD) #

2i

"−

exp

×

exp

¯r∆ˆr
ˆz #

2i
"

exp

2
"−

ˆA ˆD(∆ˆr)2
( ˆA + ˆD) #

,

(142)

(143)

where

ˆA =

ˆN
ˆz2 .

Note that here, depending on the situation, r may assume the meaning of
either variable x or y.

In the far ﬁeld limit, when ˆA
of Eq. (142):

≪

ˆD one obtains the following limiting expression

ˆG(ˆz, ¯r, ∆ˆr) = exp

2i

¯r∆ˆr
ˆz #

exp

¯r2
2 ˆDˆz2 #

"−

"

exp

2 ˆA(∆ˆr)2

.

(144)

−

h

i

With the help of Eq. (144) and using Eq. (127) one can ﬁnd the expression
for ˆ
and ˆG at the virtual source position in the center of the undulator. In
G
the case under study ( ˆN
1) the virtual source is a Gaussian
quasi-homogeneous source. Aside for unessential multiplication constants we
have

1 and ˆD

≫

≫

58

ˆ
G

0, ¯θ, ∆ˆθ
(cid:17)

(cid:16)

= exp

2 ˆN ∆ˆθ2

exp

−
h

i

¯θ2
2 ˆD #

.

"−

Therefore, using Eq. (126) we also obtain

(145)

ˆG(0, ¯r, ∆ˆr) = exp

exp

2 ˆD(∆ˆr)2

.

(146)

¯r2
2 ˆN #

"−

−

h

i

From Eq. (146) we conclude that the intensity distribution of the virtual source
is a replica of the electron beam density distribution at the position of minimal
beta function of the undulator (i.e. at the undulator center). Moreover, in this
particular study case, if the position of the minimal beta function does not
coincide with the undulator center, the virtual source corresponding to the
description in Eq. (146) is simply translated, and is always located at the
position where the beta function of the electron beam is minimal.

−

≪

It should be noted that the far ﬁeld limit ˆA
ˆD corresponds with the ap-
plicability region of the van Cittert-Zernike theorem. In virtue of the van
Cittert-Zernike theorem the modulus of the spectral degree of coherence in
2 ˆA(∆ˆr)2] from Eq. (144), forms a Fourier pair with the
the far ﬁeld, i.e. exp[
¯r2/2 ˆN] from Eq. (146).
intensity distribution of the virtual source, i.e. exp[
ˆN ,
In particular one concludes that the rms width of the virtual source is
as it can be seen directly from Eq. (146). In our study case for ˆN
q
1 and
ˆD
1, such a relation between the rms width of the spectral degree of co-
herence in the far ﬁeld and the rms dimension of the virtual source is also a
relation between the rms width of the cross-spectral density function in the
far ﬁeld and the rms dimension of the electron beam at the plane of minimal
beta function in the center of the undulator. In dimensional units one can
write the value σc of the rms width of the spectral degree of coherence g(∆~ˆr)
in the far ﬁeld as

≫

≫

−

σc =

λz
2πσ

,

(147)

σ being, as usual, the rms dimension of the electron beam. These few last re-
marks help to clarify what is the size of the source in the van Cittert-Zernike
theorem, that is far from being a trivial question. For instance, assume that the
van Cittert-Zernike theorem can be applied. Then, the rms electron beam size
can be recovered from the measurement of the transverse coherence length. In
this regard, in [10] Section V, one may ﬁnd a statement according to which
the rms electron beam size ”is only the average value along the undulator” be-
cause ”the beta function has a large variation along the undulator”. However,
as we have seen before, the concept of virtual source does not require a small
variation of the beta function. In the most general case, any variation of the

59

beta function does not aﬀect the virtual source size and, in our case of quasi-
homogeneous Gaussian source, the virtual source size is also the transverse size
of the electron beam at the position where the beta function is minimal. An-
other example dealing with the same issue is given in reference [13]. This paper
(as well as reference [10]) reports experimental results. However, authors of
[13] observe a disagreement between the electron beam rms size reconstructed
from the van Cittert-Zernike theorem and beam diagnostics result of about a
factor 2. They ascribe this variation to the variation of the electron beam size
along the undulator. In footnote [25] of reference [13], one may read: ”The
precise shape and width of the x-ray intensity distribution in the source plane
are directly connected to the properties of the electron beam. It would not be
surprising if the limited depth of focus of the parabolically shaped electron
beta function in the undulator translates into a virtually enlarged x-ray source
size.”. At ﬁrst glance it looks like if the Synchrotron Radiation source has a
ﬁnite longitudinal dimension. However, based on the previous discussion we
conclude that the virtual source size is equal to the electron beam size at the
point where the beta functions have their minimum and that it is not aﬀected
by variations of the beta function along the undulator. As a result, one should
not observe any virtually enlarged X-ray source size because of this reason.

5.2 Evolution of the cross-spectral density function behind the lens

≫

1 and ˆD

If we neglect the eﬀect of the pupil in the particular case under examination
( ˆN
1), it is possible to ﬁnd an analytical expression for the
cross-spectral density for any observation plane, and not only for the focal
or the image plane. This is due to the fact that, in this particular case, the
virtual source is gaussian. In the most general case instead, one has to make
use of Eq. (133).

≫

As usual we will neglect, at ﬁrst, the eﬀect of the pupil function and group all
the phase terms in ∆ˆr′ ¯r′ in Eq. (133) with the help of the deﬁnition

ˆQ =

1
ˆz1 −

ˆA
ˆz1( ˆA + ˆD) −

1
ˆf

+

,

ˆz2

ˆz1

1

−

where

ˆA =

ˆN
ˆz2
1

.

(148)

(149)

With this in mind, after substitution of Eq. (142) calculated at ˆz = ˆz1 in Eq.
(133), one obtains

60

ˆG(ˆz2, ¯r, ∆ˆr) = exp

2i

"

ˆz2

¯r∆ˆr

exp

1(∆ˆr)2
ˆz1)2

2( ˆA + ˆD)ˆz2
(ˆz2
"−
¯r + 2i ˆQ( ˆA + ˆD)ˆz2
h

ˆz1 #
−
( ˆA + ˆD)
2 ˆA ˆD + 2( ˆA + ˆD)2 ˆQ2ˆz2
1

(ˆz2

−

#

2

1∆ˆr
ˆz1)2 
i


−



i

×

exp 


−

h



which corresponds to a relative intensity

.

(150)

ˆI(ˆz2, ¯r) = exp

( ˆA + ˆD)¯r2
2 ˆA ˆD + 2( ˆA + ˆD)2Q2 ˆz2
1
h

i

−






(ˆz2

−

ˆz1)2 


.



and to a modulus of the spectral degree of transverse coherence

(151)

g(ˆz2, ¯r, ∆ˆr)

= exp

|

|

2 ˆA ˆD( ˆA + ˆD)ˆz2
ˆA ˆD + ( ˆA + ˆD)2 ˆQ2ˆz2
1

1(∆ˆr)2
(ˆz2

−






h

.

(152)

ˆz1)2 


−



i

−

−

ˆA/[ˆz1( ˆA + ˆD)] the reader can specialize the results to the case
Letting ˆQ =
of the image plane. For ˆQ = ˆ1/ˆz1
ˆA/[ˆz1( ˆA + ˆD)] one gets the results for
the focal plane. Also, the intensity and the modulus of the spectral degree of
coherence on the image plane can be obtained from those on the focal plane
exchanging ˆA with ˆD. This symmetry can be explained in terms of Fourier
transforms. Phase factors aside, the cross-spectral density on the image plane
is equal to the cross-spectral density on the object plane. The cross-spectral
density on the focal plane instead, is equal (phase factors aside) to the Fourier
transform of the cross-spectral density on the object plane.

≫

≫

As we have seen, in the case for a Gaussian electron beam with ˆN
1,
ˆD
1 and for a perfect lens with non-limiting aperture and no aberrations,
the Gaussian approximation for the cross-spectral density at the virtual source
in Eq. (146) can be used, and the cross-spectral density in free space at any
position ˆz can be calculated with the help of Eq. (142). Then, Eq. (133) can
be simpliﬁed to recover both the intensity and the modulus of the spectral
degree of coherence (Eq. (151) and Eq. (152) respectively), which are Gaussian
functions for any value of ˆz2 and ˆz1. Even for quasi-homogeneous sources
though, there are a number of examples when it is diﬃcult to obtain analytical
results from Eq. (133) for any value of ˆz2. Nevertheless it is possible to calculate
the cross-spectral density at the image plane and at the focal plane (for any
value of ˆz1) with the help of Eq. (131) and Eq. (132). This can be done relying
on the calculation of the cross-spectral density at the virtual-source position
(and its Fourier transform), which allows further use of Eq. (131) and Eq.
(132). We will ﬁrst use Eq. (131) and Eq. (132) to deal with the case that we
just discussed when ˆN
1. This is not a simple repetition of
≫
already known results, because the particular way of reasoning used for the

1 and ˆD

≫

61

focal and the image plane, through Eq. (131) and Eq. (132), will be widely
used in the following parts of this paper too. The Statistical Optics method
conjugated to Fourier Optics results allows us to predict, by manipulations
of Eq. (142), the cross-spectral density (and, therefore, the intensity and the
absolute value of the spectral degree of coherence) on the focal and on the
image plane. In order to use Eq. (131) and Eq. (132) we must take advantage
of the expressions for ˆ
and ˆG at the virtual source position, Eq. (145) and
G
Eq. (146) respectively.

With the help of Eq. (131) and Eq. (145), on the focal plane we obtain

ˆG(ˆzf ,~¯rf , ∆~ˆrf ) = exp

i2( ˆf

ˆz1)

−
ˆf 2

¯rf ∆ˆrf

exp

#

"

2 ˆN∆ˆr2
f
ˆf 2

exp

"−

¯r2
f
2 ˆD ˆf 2 #

.



−







For any value of ˆz1 we have a relative intensity on the focal plane given by

ˆI = exp

¯r2
f
2 ˆD ˆf 2 #

,

"−

while the modulus of the spectral degree of coherence (again, for any position
ˆz1 of the lens 10 ) is

g (ˆzf , ¯rf , ∆ˆrf )

= exp

|

|

2 ˆN ∆ˆr2
f
ˆf 2

.





−




These results are intuitively sound. In Section 2 we explained that we expect
to ﬁnd, on the focal plane, the spatial Fourier transform of the wavefront on
the object plane (except for a phase and a proportionality factor). Therefore,
it is intuitive that the intensity on the focal plane must depend on the electron
beam divergence only and that the modulus of the spectral degree of coherence
must depend on the electron beam size only. In fact, the exchange of roles of
ˆN and ˆD passing from the virtual source plane to the the focal plane is related
to the operation of Fourier transform. Also note that the Fourier transform of
the ﬁeld depends on ˆz1 through a phase factor only, and free space basically
acts as a Fourier transform itself (see Section 2): what we ﬁnd on the focal
plane in terms of intensity and modulus of the spectral degree of coherence we

10 Note that the modulus of the spectral degree of coherence in Eq. (155) is inde-
pendent of ¯rf . However, the spectral degree of coherence depends on ¯rf through a
phase factor. This situation corresponds, according to a deﬁnition given by us in [2],
to a weakly quasi-homogeneous wavefront. This remark is valid for many expressions
of the modulus of the cross-spectral density given in this work.

(153)

(154)

(155)

62

(156)

(157)

(158)

must also ﬁnd in the far ﬁeld after propagation in free space. The reader may
∆ˆθ, Eq. (154) and
check that, after substitution ¯rf / ˆf
−→
Eq. (155) can be found from Eq. (54) and Eq. (61) in [2] in the limit ˆzo ≫
1,
which describe propagation in free space, as it should be.

¯θ and ∆ˆrf / ˆf

−→

A similar simpliﬁed reasoning can be applied for the cross-spectral density on
the image plane. With the help of Eq. (132) and Eq. (146), describing the
cross-spectral density of the virtual source we obtain:

ˆG(ˆzi, ¯ri, ∆ˆri) = exp

2im(m + 1)¯ri∆ˆri
ˆz1
2 ˆDm2(∆ˆri)2

#
.

"
exp

exp

"−

m2¯r2
i
2 ˆN #

−
h
The relative intensity on the image plane is given by

×

i

ˆI = exp

m2¯r2
i
2 ˆN #

,

"−

while the modulus of the spectral degree of coherence is

g (ˆzi, ¯ri, ∆ˆri)

= exp

2m2 ˆD(∆ˆri)2

.

|

|

−

h

i

These results are very natural. By deﬁnition of image plane, when we image an
object with an ideal lens with a large non-limiting pupil aperture, we obtain
a magniﬁed version of the object (virtual, in this case).

We remarked before that the intensity and the modulus of the spectral degree
of coherence on the image plane can be obtained from that on the focal plane
exchanging ˆA with ˆD. This symmetry though is not evident from the expres-
sions in Eq. (154), Eq. (157), Eq. (155) and Eq. (158): to display it one has
to express these equations in terms of ˆz2 and ˆz1.

6

Imaging of quasi-homogeneous non-Gaussian undulator sources
by a lens with large non-limiting aperture

In the previous Section 5 we treated the case for ˆN
1. In
the present Section 6 we will deal with other quasi-homogeneous cases, always
1 and ˆDx ≫
assuming ˆNx ≫
1. The quasi-homogeneous situations that remain
to be treated under this assumption are for either ˆNy ≫
1. In fact,
the situation for both ˆNy ≫
1 is automatically included in Section
5. Moreover, in all quasi-homogeneous cases, the cross-spectral density in the

1 and ˆDy ≫

1 or ˆDy ≫

1 and ˆD

≫

≫

63

horizontal direction obeys Eq. (150). Therefore, we will focus our attention on
the cross-spectral density in the vertical direction only.

6.1 Source with non-Gaussian angular distribution in the vertical direction

1, ˆDx ≫

Let us use of our Statistical Optics approach to solve a somewhat complicated
image formation problem. After assuming separability of the horizontal and
vertical directions ( ˆNx ≫
1) we suppose that the electron beam has
a vertical transverse size much larger than the diﬀraction size, ˆNy ≫
1, and
a ﬁnite divergence ˆDy > 0. As usual, we will ﬁrst neglect the inﬂuence of the
pupil function. The diﬀerence with respect to the case treated in the previous
Section 5 is that Eq. (133) cannot be explicitly calculated for any value of
ˆz1 and ˆz2. However, as said before, the Statistical Optics method conjugated
to Fourier Optics results allows us to predict, for any value of ˆz1, the cross-
spectral density on the focal (ˆz2 = ˆzf ) and on the image (ˆz2 = ˆzi) plane by
means of Eq. (131) and Eq. (132). In order to use these equations we must
ﬁrst calculate ˆG and ˆ
at the virtual source at position ˆzo = 0. This can be
G
ˆN / ˆD of Eq. (141), i.e. calculating the far zone
done taking the limit ˆz2
limit of Eq. (141), and using Eq. (127). First, under the assumption ˆNy ≫
1
we can neglect ∆ˆθy in the S functions in Eq. (141), thus obtaining the vertical
cross-spectral density function in the far ﬁeld limit

o ≫

ˆG = exp

i2¯θy ˆzo∆ˆθy
h

i

−
h

exp

2 ˆNy∆ˆθ2
y

d ˆφy exp

∞

Z−∞
i

( ˆφy + ¯θy)2
2 ˆDy

#

"−

ˆIS( ˆφy) ,

where

ˆIS( ˆφy) =

d ˆφx sinc2

ˆφ2
x + ˆφ2

y

/4

h(cid:16)

(cid:17)

i

3
8√π

∞

Z−∞

is a universal function related to undulator radiation. A plot of ˆIS is given in
Fig. 13. Eq. (159), substituted into Eq. (127), gives the Fourier transform of
the cross-spectral density at ˆzo = 0, i.e. at the virtual-source position:

(0, ¯u, ∆ˆu) = exp

2 ˆNy∆ˆu2

d ˆφy exp

ˆ
G

−
h

∞

Z−∞
i

( ˆφy + ¯u)2
2 ˆDy

#

"−

ˆIS( ˆφy) .

64

(159)

(160)

(161)

^

^

I

(   )

y

S

1,00

0,75

0,50

0,25

0,00

-10

-8

-6

-4

-2

0

2

4

6

8

10

^

y

Fig. 13. The universal function ˆIS, used to calculate the focal
1, ˆDx ≫
quasi-homogeneous source at ˆNx ≫
Inverse transforming Eq. (161) according to the deﬁnition in Eq. (126), we
obtain the cross spectral density at the virtual source position

1 and ˆNy ≫

intensity of a

1.

ˆG(0, ¯y, ∆ˆy) = exp

¯y2
2 ˆNy #

"−

exp

2 ˆDy∆ˆy2

γ(∆ˆy) ,

−

h

i

where function γ(∆ˆy) is an inverse Fourier transform, normalized to unity, of
ˆIS, deﬁned as from Eq. (93) in [2]:

γ(∆ˆy) =

d ˆφy exp

i (

2∆ˆy) ˆφy

−

h

ˆIS( ˆφy) .
i

1
2π2

∞

Z−∞

It has been shown in [2] that γ can be expressed in terms of the sine integral
function Si(
·

) and of the cosine integral function Ci(
·

). One has

γ(∆ˆy) =

+ 2∆ˆy2Ci

2
π (cid:20)

π
2

2∆ˆy2
(cid:16)

(cid:17)

−

sin

2∆ˆy2
(cid:16)

(cid:17)

−

Si

2∆ˆy2

.

(cid:16)

(cid:17)(cid:21)

(164)

(162)

(163)

65

This means that γ is a real function. Moreover, in Eq. (162), ∆ˆy and ¯y are
separated and, since ˆNy ≫
1, the typical correlation length is much smaller
than the radiation spot, independently of the value of ˆDy. This shows that
Eq. (162) models a quasi-homogeneous source. From Eq. (131) and Eq. (161)
we obtain the cross-spectral density on the focal plane

ˆG(ˆzf , ¯yf , ∆ˆyf ) = exp

2i
ˆf 2

ˆf

−

(cid:16)

"

∞

ˆz1

¯yf ∆ˆyf

exp

(cid:17)

#
¯yf / ˆf + ˆφy
2 ˆDy

(cid:17)



−

2







×

Z−∞

d ˆφy exp 
− (cid:16)



2 ˆNy∆ˆy2
f
ˆf 2





ˆIS( ˆφy) .

The relative intensity on the focal plane is therefore given by

ˆI(ˆzf , ¯yf ) =

∞

Z−∞

− (cid:16)

d ˆφy exp 


d ˆφy exp

∞

× 


Z−∞



2

¯yf / ˆf + ˆφy
2 ˆDy

ˆφ2
y
2 ˆDy







−



ˆIS( ˆφy)

(cid:17)





ˆIS( ˆφy)

−1

,






while the modulus of the spectral degree of coherence reads

g(ˆzf , ¯yf , ∆ˆyf )

= exp

|

|

ˆNy∆ˆy2
f
ˆf 2

.



2
−




For the image plane, Eq. (132) and Eq. (162) give the following cross-spectral
density:



ˆG(ˆzi, ¯yi, ∆ˆyi) = exp

"

im(m + 1)¯yi∆ˆyi
2ˆz1
m2 ¯y2
i
2 ˆNy #

exp

"−

#

−
h

exp

×

2 ˆDym2∆ˆy2
i

γ(m∆ˆyi) ,

(168)

i

corresponding to a relative intensity on the image plane

ˆI(ˆzi, ¯yi) = exp

m2 ¯y2
i
2 ˆNy #

.

"−

Eq. (169) is the (magniﬁed) image of the electron beam in the object plane
ˆz = 0. The modulus of the spectral degree of coherence is:

66

(165)

(166)

(167)

(169)

| |

1,0

0,8

0,6

0,4

0,2

0,0

0,0

0,5

1,0

1,5

2,0

2,5

3,0

^

y

Fig. 14. Absolute value of the universal function γ, used to calculate, on the image
plane, the spectral degree of coherence of a quasi-homogeneous undulator source
when ˆNx ≫

1.

1, ˆDx ≫
g(ˆzi, ¯yi, ∆ˆyi)

1 and ˆNy ≫
= exp

2 ˆDym2∆ˆy2
i

(170)

−
h

γ(m∆ˆyi)

.

|

|

i

|

|

|

|

A plot of

γ(∆ˆy)

is given in Fig. 14.

6.2 Source with non-Gaussian intensity distribution in the vertical direction

1 and ˆNy assumes arbitrary values.
Let us now consider the case when ˆDy ≫
In this case, Eq. (115) and Eq. (125) of [2] allow reconstruction of the cross-
spectral density in the far zone, that is

ˆG = exp

2i¯θy ˆzo∆ˆθy
h

i

exp

2 ˆNy∆ˆθ2
y

exp

−
h

i

¯θ2
y
2 ˆDy #

"−

β(∆ˆθy) ,

(171)

where the function β(∆ˆy) is deﬁned in Eq. (113) of [2] and reads:

67

β(∆ˆθy) =

1
2π2

∞

∞

d ˆφy

d ˆφx

Z−∞

Z−∞

x + ( ˆφy −
ˆφ2
4

"

sinc

×

∆ˆθy)2

x + ( ˆφy + ∆ˆθy)2
ˆφ2
4

.

#

sinc
#

"

(172)

ˆNy/ ˆDy,
Eq. (171) may be obtained directly from Eq. (141) in the limit ˆz2
1 ( ˆNy . 1 is our main case of interest
i.e. in the far zone. Note that if ˆNy/ ˆDy ≪
since we have already treated the case when both ˆNy ≫
1) the
far zone begins already at the exit of the undulator, when ˆz1
1 (see also [2]
for details). Let us introduce, in analogy with Eq. (163) the following (inverse)
Fourier transform of the function β:

o ≫
1 and ˆDy ≫
∼

ˆ
(¯y) =
B

∞

1

Z−∞

K

d ˆφy exp

2¯y) ˆφy

β( ˆφy) .

i(
h

−

i

Here

is the normalization factor

K

∞

=

K

Z−∞

d ˆφyβ( ˆφy)

2.200 ,

≃

and has been calculated numerically.

Both β(∆ˆθy) and ˆ
(¯y) admit representations in terms of a one-dimensional
B
integral (note that the representation for β(∆ˆθy) has been already introduced
in [2]). In order to see this, let us ﬁrst consider the function:

˜f (∆ˆθ′

x, ∆ˆθ′

y) =

1
2π2

∞

∞

d ˆφy

d ˆφx

Z−∞

Z−∞

sinc

sinc

×

×









( ˆφx −

∆ˆθ′

x/2)2 + ( ˆφy −
4

∆ˆθ′

y/2)2

( ˆφx + ∆ˆθ′

x/2)2 + ( ˆφy + ∆ˆθ′

y/2)2

4









.

The function ˜f is circularly symmetric. This can be seen switching to polar
coordinates:

ˆφx = ˆrφ cos(ˆηφ)
ˆφy = ˆrφ sin(ˆηφ)

and

68

(173)

(174)

(175)

(176)

∆ˆθ′
∆ˆθ′

x/2 = ˆrθ cos(ˆηθ)
y/2 = ˆrθ sin(ˆηθ) .

Then, Eq. (175) can be rewritten as

˜f (ˆrθ) =

1
2π2

∞

2π

dˆrφ

dˆηφ

Z0

Z0
φ + ˆr2
ˆr2

sinc

sinc

×

×

"

"

θ −

2ˆrφˆrθ cos (ˆηφ −

4
θ + 2ˆrφˆrθ cos (ˆηφ −
4

ˆηθ)

ˆηθ)

#

#

,

φ + ˆr2
ˆr2

β(∆θy) = ˜f (∆ˆθ′

x, ∆ˆθ′
y)

for any (∆ˆθ′

x, ∆ˆθ′

y) such that

∆ˆθy =

(∆ˆθ′

x/2)2 + (∆ˆθ′

y/2)2 .

r

which does not depend on ˆηθ, as can be seen switching to the integration
variable ˆη′ = ˆηφ −

ˆηθ. The following relation follows:

The function β can be seen as a restriction of the function ˜f. The reason why
˜f has been introduced is that it allows the use the autocorrelation theorem to
obtain the following relation:

d∆ˆθ′
x

d∆ˆθ′

y exp [i(αx∆ˆθ′

x + αy∆ˆθ′

y)] ˜f(∆ˆθ′

x, ∆ˆθ′

y) =

d ˆφx

d ˆφy exp [i(αx ˆφx + αy ˆφy)]sinc

(181)

x + ˆφ2
ˆφ2
4

y

2

.





(cid:12)

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)

The integral in the right hand side of Eq. (181) has been already calculated, in
practice, in Eq. (93), and it can be expressed in terms of the universal function
Ψ deﬁned in Eq. (95). It follows that

∞

∞

Z−∞

∞

Z−∞

Z−∞

∞

1
2π2 (cid:12)
(cid:12)
Z−∞
(cid:12)
(cid:12)
(cid:12)
(cid:12)

∞

∞

Z−∞
2Si(α2

Z−∞

2

π
h

−

d∆ˆθ′
x

d∆ˆθ′

y exp [i(αx∆ˆθ′

x + αy∆ˆθ′

y)] ˜f (∆ˆθ′

x, ∆ˆθ′

y) =

x + α2
y)

= 2π2Ψ

x + α2
α2
y

.

(cid:16)q

(cid:17)

2

i

69

(177)

(178)

(179)

(180)

(182)

We can now inverse transform Eq. (182) using the Fourier-Bessel formula, thus
obtaining

˜f (∆ˆθ′

x, ∆ˆθ′

y) = π

dα αJo

α

(∆ˆθ′

x)2 + (∆ˆθ′

y)2

Ψ(α) .

 

r

!

(183)

∞

Z0

Letting ∆ˆθ′
representation for β:

x = 0 and using Eq. (179) and Eq. (180) we obtain the following

(184)

(186)

(187)

β(∆ˆθy) = π

dα αJo

2α∆ˆθy

Ψ(α) .

(cid:16)

(cid:17)

∞

Z0

Applying the deﬁnition of ˆ
B

in Eq. (174) we obtain

ˆ
(¯y) =
B

∞

π

Z0

K

∞

Z−∞

dα αΨ(α)

d∆ˆθy exp

2¯y)∆ˆθy

Jo

i(
h

−

2α∆ˆθy
(cid:16)

(cid:17)

.

i

(185)

The Fourier integral in ∆ˆθy can be performed analytically (see [8], Appendix
A.3.), thus giving the following representation of ˆ
:
B

ˆ
(¯y) =
B

∞

π

Z0

K

dα

rect [¯y/(2α)]
(¯y/α)2

1
h

−

1/2 Ψ(α) ,

i
where the function rect(x) is deﬁned, following [8], to be unity for
and zero otherwise. A plot of the universal ˆ
B

is given in Fig. 15.

6 1/2

x
|

|

Using Eq. (127) and Eq. (171) we obtain the Fourier transform of the cross-
spectral density at the virtual-source position

ˆ
G

(0, ¯u, ∆ˆu) = exp

2 ˆNy∆ˆu2

exp

−
h

i

¯u2
2 ˆDy #

"−

β(∆ˆu) .

Inverse transforming Eq. (187) we can write the cross-spectral density at the
virtual-source position

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

dη exp

−
h

(η + ¯y)2
2 ˆNy

"−

ˆ
(η) .
B

#

(188)

∞

Z−∞
i

70

^

-

B(y)

1,0

0,8

0,6

0,4

0,2

0,0

0

1

2

3

4

5

-

y

Fig. 15. The universal function ˆ
B
a quasi-homogeneous undulator source when ˆNx ≫

, used to calculate intensity on the image plane of
1, ˆDx ≫

1 and ˆDy ≫

1.

Then, from Eq. (131) and Eq. (187) we obtain the cross-spectral density on
the focal plane

ˆG(ˆzf , ¯yf , ∆ˆyf ) = exp

2i
ˆf 2

"

exp

×

"−

ˆf

(cid:16)

(cid:17)

−
¯y2
f
2 ˆDy ˆf 2 #

ˆz1

¯yf ∆ˆyf

exp



−



#
∆ˆyf
ˆf !

.

β

 

2 ˆNy∆ˆy2
f
ˆf 2





The relative intensity on the focal plane is therefore given by

ˆI(ˆzf , ¯yf ) = exp

¯y2
f
2 ˆDy ˆf 2 #

,

"−

while the modulus of the spectral degree of coherence reads

(189)

(190)

71

| |

1,0

0,8

0,6

 

0,4

0,2

0,0

0

1

2

3

4

5

 

^
^

y
y

Fig. 16. Absolute value of the universal function β, used to calculate coherence on
the focal plane of a quasi-homogeneous undulator source when ˆNx ≫
1, ˆDx ≫
1
and ˆDy ≫

1.

g(ˆzf , ¯yf , ∆ˆyf )

= exp

|

|

2 ˆNy∆ˆy2
f
ˆf 2



−



β

 





(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

.

∆ˆyf
ˆf !(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

A plot of
(188) give the following cross-spectral density:

|

|

β(∆ˆθy)

is given in Fig. 16. For the image plane, Eq. (132) and Eq.

ˆG(ˆzi, ¯yi, ∆ˆyi) = exp

im(m + 1)¯yi∆ˆyi
2ˆz1

"

2 ˆDym2∆ˆy2
i

dη exp

exp

×

−

h

(η + m¯yi)2
2 ˆNy

"−

ˆ
(η) ,
B

#

#
∞

Z−∞
i

corresponding to a relative intensity on the image plane

ˆI(ˆzi, ¯yi) =

dη exp

∞

Z−∞

(η + m¯yi)2
2 ˆNy

"−

ˆ
(η)
B

#

∞

dη exp

η2
2 ˆNy #

ˆ
(η)
B

"−

, 


Z−∞



72

(191)

(192)

.






The modulus of the spectral degree of coherence is

g(ˆzi, ¯yi, ∆ˆyi)

= exp

|

|
Finally, in the particular case for ˆNy ≪

−
h

i

2 ˆDym2∆ˆy2
i

.

1, Eq. (193) reduces to

ˆI(ˆzi, ¯yi) = ˆ
B

(m¯yi) .

(193)

(194)

(195)

7 Analysis of the image formation mechanism for quasi-homogeneous

undulator sources in terms of Geometrical Optics

In the Introduction we have stressed that the image formation problem is
twofold: one should be able to provide a characterization of the virtual source
as well as to track the cross-spectral density of the source trough the optical
beamline.

Let us ﬁrst analyze the problem of source characterization. In Section 1 we
have seen that, in the asymptotic limit for a large electron beam emittance
λ/(2π), Geometrical Optics may be used equally well as Statistical
ǫx,y ≫
Optics to fulﬁll this task. Here we will discuss more in detail the relation
between the Statistical Optics approach and the Geometrical Optics approach
with particular attention to the applicability region of the latter.

Let us start with a remark, which applies not only to undulator radiation
sources but also to sources of other kind (e.g. bending magnets). In the In-
troduction, in order to decide wether Geometrical Optics or Wave Optics
is applicable, we compared the electron beam emittance with the radiation
wavelength. This is acceptable in many cases when undulator radiation is in-
volved but not, for instance, when bending magnet radiation is considered.
In all generality one should separately compare the photon beam size and di-
vergence with the radiation diﬀraction size and diﬀraction angle, which are
quantities pertaining the single electron radiation. Let us ﬁx a given direction
x or y. The square of the diﬀraction angle is deﬁned by (σ′
λ/(2πLf ), Lf
being the formation length of the radiation at wavelength λ as deﬁned in [1].
σ′
The diﬀraction size of the source is given by σd ∼
dLf . In calculating the
photon beam size and divergence one should always include diﬀraction eﬀects.
As a result, if σ2 and (σ′)2 indicate the square of the electron beam size and
divergence, the corresponding square of the photon beam size and divergence
d)2]. These quantities
will be respectively of order max[σ2, σ2
can be rewritten in terms of the electron beam emittance as max[ǫβ, σ2
d] and

d] and max[(σ′)2, (σ′

d)2

∼

73

∼

d and (σ′

d)2], β being the minimal beta function value, deﬁning the virtual
max[ǫ/β, (σ′
source position for the radiator (undulator, bending magnet, or other). Di-
viding these two quantities respectively by σ2
d)2 give natural values,
normalized to unity, for the photon beam size max[2πǫβ/(Lf λ), 1] and diver-
gence max[2πǫLf /(βλ), 1]. When the product between these two quantities is
much larger than unity one can use a Geometrical Optics approach. In this
case, this product represents the normalized photon beam emittance. When
Lf , as in many undulator cases, one may compare, for rough estimations,
β
the electron beam emittance and the radiation wavelength as we have done
before. However, in the case of a bending magnet one may typically have β of
order 10 m and Lf of order 10−3
1 now consti-
tutes an extra large parameter of the problem. In this case, even if the electron
beam emittance is two order of magnitude smaller than the wavelength, due to
diﬀraction eﬀects one can still apply a Geometrical Optics approach, because
max[2πǫβ/(Lf λ), 1]
1, i.e. the photon beam emittance
is much larger than the wavelength. As a result, dimensional analysis suggests
that bending magnet radiation may be treated exhaustively in the framework
of Geometrical Optics even for third generation light sources.

10−2 m. The ratio β/Lf ≫

max[2πǫLf /(βλ), 1]

≫

÷

·

∼

≪

As discussed above, when β
Lf a large electron beam emittance (com-
pared with the radiation wavelength) is a necessary and suﬃcient condition
Lf
for the Geometrical Optic approach to apply. In spite of that, when β
or β
Lf , a large electron beam emittance is a suﬃcient, but not neces-
sary condition for the Geometrical Optic approach to be possibly used for
source characterization. Let us prove this statement with undulator sources
in mind 11 . It is enough to prove that the wider class of quasi-homogeneous
sources, which includes situations when the electron beam emittance is not
larger than the wavelength, can be described in terms of Geometrical Optics.

≫

Let us then consider the class of quasi-homogeneous virtual sources for undu-
lator devices. The cross-spectral density of the virtual source (positioned at
z = 0, i.e. at the virtual source plane) can be written as in Eq. (2), that we
rewrite here for convenience in terms of coordinates ¯rx,y and ∆ˆrx,y:

ˆGo(¯rx, ¯ry, ∆ˆrx, ∆ˆry) = ˆI (¯rx, ¯ry) g(∆ˆrx, ∆ˆry) .

(196)

As usual, the Fourier transform of Eq. (196) with respect to all variables will
be indicated with

11 Note that, even though in the case of undulator sources one often has β
Lf ,
there are situations when β
Lf and when the electron emittance is
≪
of order of the wavelength. However, in the undulator case, very large values of the
104, typical of the bending magnet case, are unrealistic.
ratio β/Lf of order 103

Lf or β

≫

∼

÷

74

Go(¯θx, ¯θy, ∆ˆθx, ∆ˆθy) =
ˆ

∞

∞

∞

∞

d∆ˆr′
x

d∆ˆr′
y

d¯r′
x

d¯r′
y

ˆGo(¯r′

x, ¯r′

y, ∆ˆr′

x, ∆ˆr′
y)

Z−∞

Z−∞
exp[2i(¯θx∆ˆr′

Z−∞
x + ¯θy∆ˆr′

Z−∞
y)] exp[2i(∆ˆθx¯r′

×

y)] .
(197)
The two quantities ˆI(¯rx, ¯ry) = ˆGo(¯rx, ¯ry, 0, 0) and ˆΓ(¯θx, ¯θy) = ˆ
Go(¯θx, ¯θy, 0, 0)
are always positive, because, by deﬁnition of ˆGo, they are ensemble averages
of quantities under square modulus.

x + ∆ˆθy ¯r′

Let us now introduce the Fourier transform of Eq. (196) with respect to ∆ˆrx,y:

ˆΦo(¯rx, ¯ry, ¯θx, ¯θy) =

d∆ˆr′
x

d∆ˆr′
y

ˆGo(¯rx, ¯ry, ∆ˆr′

x, ∆ˆr′
y)

∞

∞

Z−∞

Z−∞
exp[2i(¯θx∆ˆr′

×

x + ¯θy∆ˆr′

y)] .

(198)

Accounting for Eq. (196), i.e. in the particular case of a (virtual) quasi-
homogeneous source, Eq. (198) can be written as

ˆΦo(¯rx, ¯ry, ¯θx, ¯θy) = ˆI (¯rx, ¯ry) ˆΓ(¯θx, ¯θy) ,

(199)
having recognized that ˆΓ(¯θx, ¯θy) = ˆ
Go(¯θx, ¯θy, 0, 0) is the Fourier transform of
the spectral degree of coherence g. The distribution ˆΦo, being the product of
two positive quantities, never assumes negative values. Therefore it may always
be interpreted as a phase space distribution 12 . This analysis shows that quasi-
homogeneous sources can always be characterized in terms of Geometrical
Optics. It also shows that, in this particular case, the coordinates in the phase
space, ¯rx,y and ¯θx,y, are separable.

Eq. (198) is the deﬁnition of a Wigner distribution. In the case of quasi-
homogenous sources, as we have just seen, the Wigner distribution is never
negative and, therefore, can always be interpreted as a phase space distri-
bution. In the case of non quasi-homogeneous sources one may still deﬁne a

12 It should be remarked that this result has been obtained only on the ground of
mathematical basis, i.e. without ascribing to ˆI and ˆΓ any physical meaning. In other
words, we simply considered the cross-spectral density ˆGo as the ensemble-averaged
product of ˆE(ˆ~r1) and ˆE∗(ˆ~r2) without ascribing to the function ˆE any physical
meaning. Physically, as has been said in the Introduction, in the quasi-homogeneous
case ˆΓ can be identiﬁed with the radiant intensity of the virtual source (compare
with Eq. (6)). This follows from a statement similar to the van Cittert-Zernike
theorem for quasi-homogeneous sources (see [3]). Note that the intensity and the
Fourier transform of the spectral degree of coherence are obtained back from the
phase space distribution, Eq. (199), by integration over coordinates ¯θx,y and ¯rx,y
respectively.

75

Wigner distribution using Eq. (198). The integral of the Wigner function over
its coordinates must still be ﬁnite 13 . However the Wigner function itself is
not always a positive function. As a consequence it cannot always be inter-
preted as a phase space distribution. On the one hand, quasi-homogeneity is
a suﬃcient condition for the Geometrical Optics approach to be possibly used
in the representation of the source. On the other hand though, necessary and
suﬃcient conditions for ˆΦo to be a positive function are more diﬃcult to ﬁnd.

One may observe that Bochner’s theorem 14 may be used to investigate whether
the Wigner function can be interpreted as a phase space distribution in the
case of non-homogeneous sources. In particular, it is necessary and suﬃcient
to look for non-negative deﬁnite cross-spectral density functions. However, in
general, it is not trivial to investigate wether a function is non-negative deﬁnite
(see footnote 14) and therefore this observation does not seem to constitute
a simpliﬁcation. We will simply leave the search for necessary and suﬃcient
condition for ˆΦo to be a positive function as an open question. We did not rule
out, for undulator setups, the possibility of having a positive Wigner distribu-
tion in the non quasi-homogeneous case. At ﬁrst glance it may look like such a

13 This ensures that ˆΦo has ﬁnite integral over its variables. ˆΦo is the Fourier trans-
form of a correlation function (the cross-spectral density) of electromagnetic ﬁelds.
The ﬁelds being physical quantities can carry only a ﬁnite amount of energy and
they are limited in spatial extent. As a result the cross-spectral density must be an
integrable function over its variables and so must be, by deﬁnition, ˆΦo.
14 Bochner’s theorem ”in its elementary form asserts that every non-negative deﬁ-
nite function of a broad class has a non-negative Fourier transform and, conversely,
that the Fourier transform of every non-negative function of a broad class is non-
negative deﬁnite. This class includes functions which fall oﬀ suﬃciently rapidly to
inﬁnity to ensure that their Fourier transforms are continuous functions” [cited
from paragraph 1.4.2. of reference [3]]. It should hereby be stressed the diﬀerence
in the mathematical language between a positive function f (ξ) > 0 for every real
value ξ and a non-negative deﬁnite function. The function h is said to be non-
negative deﬁnite when ”for an arbitrary set of N real numbers ξ1, ξ2,...,ξN and N
ξi) > 0.”[cited
arbitrary complex numbers a1, a2, ..., aN ,
from paragraph 1.4.2. of reference [3]]. Based on the assumption of a quasi-
homogeneous source authors of [3] use Bochner’s theorem instead of our previous
discussion to demonstrate that the spectral degree of coherence g in Eq. (196)
is necessarily non-negative deﬁnite. In fact, since the intensity ˆI is a positive
i ajg(∆ˆrx ij, ∆ˆry ij) is the same of the sign of
function, the sign of
N
N
j=1 a∗
j=1 a∗
=

i aj ˆI(¯rx ij, ¯ry ij)g(∆ˆrx ij, ∆ˆry ij) =
P

i ajh(ξj −

N
j=1 a∗

N
j=1 a∗

N
i=1

N
i=1

N
i=1

N
i=1

E(ˆrj)E∗(ˆri)
i

i aj h

P

P

P

(cid:29)

P

N
P
i=1 aiE(ˆri)
(cid:12)
(cid:12)
(cid:12)

> 0, quantum erat demonstrandum. This demonstration is more
P

P
(cid:28)(cid:12)
involved than ours, even though it is based, as the ours, on the positivity of the
(cid:12)
(cid:12)
square modulus of quantities. The reason for this complexity is that it uses a more
general theorem, i.e. Bochner’s theorem. However, as we have seen, it is not neces-
sary to invoke Bochner’s theorem in the quasi-homogeneous case.

P

2

76

case brings advantages in the formulation of the imaging theory, because the
source can be described in terms of Geometrical Optics. On the one hand, in
the case the Wigner distribution is positive, the evolution of the radiation in
free space can be described by a ray-tracing approach, as the Wigner distri-
bution can be interpreted as a phase space distribution. On the other hand
though, such fact is almost irrelevant because it is not of help when optical
elements are considered. As we will see later on, there are two particular con-
ditions at the basis of a simpliﬁed formulation of the imaging theory based
on the incoherent point spread function of the optical system. The ﬁrst is the
separability of the cross-spectral density is the product of a factor depending
on ~¯r and a factor depending on ∆~r. The second is a transverse dimension of
the source much larger than the transverse coherence length. As we have al-
ready seen these two conditions, together, deﬁne a quasi-homogeneous source.
Quasi-homogeneous sources are necessarily characterized by a positive Wigner
function. However, the positivity of the Wigner function alone is not suﬃcient
to obtain a simpliﬁed formulation of the imaging theory in terms of inco-
herent point-spread function. A similar remark holds for a particular kind of
sources often considered in literature also in connection with undulator radi-
ation (see [14, 15]). These sources, characterized by a cross-spectral density
G =
r2) are called Shell sources (in particular, in [14, 15]
Gaussian-Shell sources are discussed which assume gaussian a proﬁle for both
I and g). They exhibit separability of the cross-spectral density, but are not
quasi-homogeneous because the transverse dimension of the source fails to
be much larger than the transverse coherence length: a simpliﬁed formula-
tion of the imaging theory does not hold in this case either. Moreover, as it
will be more extensively discussed here below and in Section 15, the Shell
model (and, in particular, the Gaussian-Shell model) may be useful for de-
scribing light sources other than undulator-based or for educational purposes,
but does not describe any practical realization of an undulator source.

I(r2)g(r1

I(r1)

−

q

q

We are now interested to ﬁnd, in particular, equivalent conditions for quasi-
homogeneity in terms of the electron beam sizes ˆNx,y and divergences ˆDx,y that
apply to our case of interest, i.e. third generation light sources. In order to do
so we start deriving an expression ˆ
for the Fourier transform of the cross-
G
spectral density at the virtual source position. This is given by calculating the
limit of Eq. (124) for ˆzo ≫
1 and taking advantage of Eq. (127). Aside for an
inessential multiplicative constant we obtain:

(0, ¯θx, ¯θy, ∆ˆθx, ∆ˆθy) = exp
ˆ
G

−
h

2 ˆNx∆ˆθ2
x

exp

2 ˆNy∆ˆθ2
y

−
h

∞

∞

d ˆφx

d ˆφy

Z−∞

2

i
ˆφx + ¯θx
2 ˆDx

(cid:17)

Z−∞
i
ˆφy + ¯θy
2 ˆDy

2

(cid:17)






exp 

− (cid:16)








exp 

×

− (cid:16)



77

sinc

"

sinc

×

×

∆ˆθy)2

∆ˆθx)2 + ( ˆφy −
( ˆφx −
4
#
( ˆφx + ∆ˆθx)2 + ( ˆφy + ∆ˆθy)2
4

"

.

#

(200)

We have said that the quasi-homogeneity of the virtual source is equivalent to
(i) separability of the cross-spectral density ˆG in the product of two factors
respectively depending on ¯θx,y and ∆ˆθx,y and (ii) a large characteristic scale
of ¯θx,y with respect to the characteristic scale of ∆ˆθx,y. From condition (i)
follows that the virtual source is quasi-homogeneous only if it is possible to
factorize the Fourier transform of the cross-spectral density, ˆ
in Eq. (200),
G
in the product of two factors separately depending on ¯θx,y and ∆ˆθx,y. Such
factorization, for third generation light sources, is equivalent to a particular
choice of the region of parameters for the electron beam: ˆNx ≫
1 and
either (or both) ˆNy ≫
1 15 . In this case, the second condition (ii)
is automatically veriﬁed as one can verify inspecting Eq. (200).

1 and ˆDy ≫

1, ˆDx ≫

An intuitive picture in the real space is given by a (virtual) quasi-homogeneous
source with characteristic (normalized) square sizes max( ˆNxy, 1) and charac-
teristic (normalized) correlation length square of order min(1/ ˆDx,y, 1). As al-
ready remarked before, in the quasi-homogeneous situation the horizontal and
the vertical directions can be treated separately, because Eq. (200) factorizes
in the product of factors separately depending on the horizontal and on the
vertical coordinates. This corresponds to a large number of independently
radiating sources given by the product

Mx,y = max( ˆNx,y, 1) max( ˆDx,y, 1) .

(201)

The number Mx,y is, in other words, an estimation of the number of coherent
modes in the horizontal and in the vertical direction 16 . The number M −1
x,y

1, or ˆDx ≫

1 and ˆNy ≫

15 It should be remarked here, that these conditions describe the totality of third
generation quasi-homogeneous sources. In fact, while a purely mathematical analysis
indicates that factorization of Eq. (200) is equivalent to more generic conditions
1 and ˆDy ≫
( ˆNx ≫
1), comparison with third generation
source parameters reduces such conditions to the already mentioned ones.
16 This is in agreement with an intuitive picture where the photon-beam phase space
reproduces the electron-beam phase space up to the limit imposed by the intrinsic
diﬀraction of undulator radiation. Imagine to start from a situation with ˆNx,y ≫
1
1 and to ”squeeze” the electron-beam phase space by diminishing ˆNx,y
and ˆDx,y ≫
and ˆDx,y. On the one hand the characteristic sizes of the phase space of the electron
beam are always of order ˆNx,y and ˆDx,y. On the other hand the characteristic sizes
of the phase space of the photon beam are of order max( ˆNx,y, 1) and max( ˆDx,y, 1):
diﬀraction eﬀects limit the ”squeezing” of the phase space of the photon beam.

78

is the accuracy of Geometrical Optics results compared with Statistical Op-
tics results or, better, the accuracy of the quasi-homogeneous assumption. It
should be noted that, as Mx,y approaches unity, the accuracy of the quasi-
homogeneous assumption becomes worse and worse and Mx,y cannot be taken
anymore as a meaningful estimation of the number of modes: it should be
replaced by a more accurate concept based on Statistical Optics. To complete
the previous statement we should add that Mx,y completely loses the mean-
ing of ”number of modes” when Geometrical Optics cannot be applied. For
instance when both ˆNy and ˆDy are of order unity (or smaller), one can state
that the Geometrical Optics approach fails in the vertical direction because
the phase space area is getting near to the uncertainty limit. In this case it is
not possible to ascribe the meaning of ”number of modes” to the number My
simply because the Geometrical Optics approach in the vertical direction fails.
However, when ˆNy and ˆDy are of order unity (or smaller), but both ˆNx ≫
1
and ˆDx ≫
1, the cross-spectral density admits factorization in the horizontal
and in the vertical direction and the source in the horizontal direction can be
still described, independently, with the help of Geometrical Optics.

Up to now we discussed about the roles of Geometrical and Statistical optics
in the characterization of the source only. However, as already remarked, the
speciﬁcation of the source constitutes only part of the solution of the imaging
problem. One has, in fact, to track information regarding the source through
the optical beamline up to the observation plane. Depending on the situation
Geometrical Optics may be used or not. For instance, a quasi-homogeneous
source may well be described in terms of a phase space distribution, but if
diﬀraction eﬀects dominate the photon beam transport to the observation
plane, one cannot use ray-tracing techniques to calculate the intensity proﬁle
at the observation plane. However, as we will see in the next Section, if the
virtual source is quasi-homogeneous, the intensity at the observation plane can
always be expressed as a convolution product between the impulse response
of the optical system and the intensity which would be recovered at the obser-
vation plane in the case of an ideal optical system (i.e. one with no aberration
and non-limiting pupil apertures). In this case, the entire line may be studied
with the help of ray-tracing programs if and only if the impulse response of
the system can be recovered by means of Geometrical Optics techniques.

In Geometrical Optics, a Hamiltonian description of the optical system holds
so that interaction with optical media (i.e. the system evolution) is conve-
niently modelled in terms of symplectic transformations. A given symplectic
acts on point ˜ρo = (¯rox, ¯θox, ¯roy, ¯θoy) of the phase space ˆΦo
transformation
at ˆzo = 0 and maps it to a point ˜ρ = (¯rx, ¯θx, ¯ry, ¯θy), of the phase space ˆΦˆz at
ˆzo = ˆz according to

S

˜ρ =

(˜ρo) .

S

(202)

79

The phase space distribution is therefore transformed according to

ˆΦˆz (˜ρ) = ˆΦo

−1 (˜ρ)

.

S
h

i

According to Liouville’s theorem, the area of the phase space is conserved
during this process. In the particular case of linear transformations, one can
use a matrix formalism. N successive linear transformations are represented
by N matrices L1 ... LN and the resulting transformation is represented by N
successive matrix multiplications, which give the matrix L = LN
L1. The
action of L on an element of the phase space is then naturally represented by
multiplication. The variables ˜ρ in phase space characterize a ray with a certain
direction and oﬀset with respect to the optical axis. The task of calculating
the phase space distribution after a given number of optical elements through

...

·

·

ˆΦˆz (˜ρ) = ˆΦo

L−1
h

·

(˜ρ)t

,

i

where t indicates transposition, or through the more general Eq. (203) can
be solved by ray-tracing programs. Once ˆΦˆz is known, these codes usually
integrate it over the variable ¯θx and ¯θy to give the intensity distribution

ˆI (ˆz, ¯rx, ¯ry) =

d¯θx

d¯θy ˆΦˆz

∞

∞

Z−∞

Z−∞

¯rx, ¯θx, ¯ry, ¯θy
(cid:16)

(cid:17)

.

However, the same programs may also be used to calculate the Fourier trans-
form of the spectral degree of coherence through

∞

∞

ˆΓ

ˆz, ¯θx, ¯θy
(cid:16)

(cid:17)

=

d¯rx

d¯ry ˆΦˆz

¯rx, ¯θx, ¯ry, ¯θy)

.

Z−∞

Z−∞

(cid:16)

(cid:17)

In particular, in free space, Eq. (204) becomes

ˆΦˆz

¯rx, ¯θx, ¯ry, ¯θy

= ˆI

(cid:16)

(cid:17)

(cid:16)

0, ¯rx −

ˆz ¯θx, ¯ry −

ˆz ¯θy

ˆΓ

0, ¯θx, ¯θy

,

(cid:17)

(cid:16)

(cid:17)

while Eq. (205) and Eq. (206) reduce to convolutions:

(203)

(204)

(205)

(206)

(207)

∞

∞

ˆI (ˆz, ¯rx, ¯ry) =

d¯θx

d¯θy ˆI

Z−∞

Z−∞

(cid:16)

0, ¯rx −

ˆz ¯θx, ¯ry −

ˆz ¯θy

ˆΓ

0, ¯θx, ¯θy

(208)

(cid:17)

(cid:16)

(cid:17)

and

80

ˆΓ

ˆz, ¯θx, ¯θy
(cid:16)

(cid:17)

=

∞

∞

d¯rx

d¯ry ˆI

Z−∞
= ˆΓ

Z−∞
0, ¯θx, ¯θy
(cid:16)

(cid:17)

.

0, ¯rx −

ˆz ¯θx, ¯ry −

ˆz ¯θy

ˆΓ

0, ¯θx, ¯θy
(cid:16)

(cid:17)

(cid:17)

(cid:16)

(209)

Note that ˆΓ calculated at ˆz = 0 has direct physical sense as the intensity
distribution in the far zone, i.e. the angular spectrum. Then, Eq. (209) tells
that, at arbitrary distance ˆz, the angular spectrum does not vary.

The intensity recovered at the image plane in the case of an ideal optical system
is a scaled copy of that at the virtual source, regardless of the source. Generally,
although as we will see exceptions apply, such correspondence between the
intensity of the source and the observed intensity is only true in the case
the observation plane is the image plane. In the case of a quasi-homogeneous
virtual source, Geometrical Optics as well as Statistical Optics techniques can
be employed to recover the intensity at the observation plane. Results from
the Geometrical Optics and from the Statistical Optics approach must then
coincide. Let us prove this fact considering the particular case ˆN
1 and
ˆD
1 in a given direction and showing that we are able to recover Eq. (151)
by means of Geometrical Optics techniques, namely by means of the matrix
formalism employed in ray-tracing codes.

≫

≫

In this particular situation, the photon beam can be modelled as if a Gaussian
photon beam was present at ˆz = 0 with the same horizontal phase space of
the electron beam. This is an ansatz on the virtual quasi-homogeneous source
based on the phase space picture described above since strictly speaking it does
not make sense to talk about a Gaussian photon beam inside the undulator,
i.e. within the radiation formation length. If, however, this ansatz is made, we
can describe the optical equivalent of the Twiss matrix at ˆz = 0. Let us ﬁrst
introduce the notion of normalized Twiss parameters as:

ˆαT = αT ,
ˆβT = L−1
w βT ,
ˆγT = LwγT ,
ˆǫ = (ω/c)ǫ ,

where αT , βT and γT are the Twiss parameters and ǫ is the emittance per-
taining the photon beam 17 . In the case under study they are identical to the
analogous electron beam parameters. We have

σ|ˆz=0 ≡

ˆǫ 

ˆβT (0)

ˆαT (0)

−
ˆαT (0) ˆγT (0)

= 



,



ˆN 0
0 ˆD

−



17 The Twiss parameters are the second moments of the phase space distribution of
the photons divided by the emittance.










(210)

(211)

81

For this exempliﬁcation we will assume a non-limiting pupil aperture. Then,
the linear transformation mapping a phase-space point in ˆz = 0 to a phase-
space point in ˆz = ˆz2 is represented by the matrix L. In our particular case of
interest we have

L = 




=

1

0










ˆz2

ˆz1

−
1



· 


ˆz2/ˆz1 + 1




−

1
1/ ˆf

0

1

0






· 



−

ˆz2/(ˆz2

1 −

ˆz1 ˆz2)

ˆz1/(ˆz1

ˆz2)

−

ˆz1

1






.

1

0










As one can see from Eq. (42), L describes a free-space ﬂight followed by a
focusing element and a second free-space ﬂight. A point (ˆlo, ˆηo) of the photon
beam phase space at ˆz = 0 is transformed, at ˆz = ˆz2 into

ˆl1

ˆη1











= L 

ˆlo

ˆηo

,









while the Twiss parameters for the photon beam at ˆz = ˆz2 are described by
the matrix

σ|ˆz=ˆz2 = L

σ|ˆz=0 ·

·

Lt = ˆǫ 



−

ˆβT (ˆz2)

ˆαT (ˆz2)

−
ˆαT (ˆz2) ˆγT (ˆz2)






ˆǫˆαT (ˆz2) =

1
ˆA + ˆD

(cid:17)
ˆA ˆD +

(cid:16)
− (cid:20)

(

(cid:16)

ˆz1

ˆA +
h
ˆA + ˆD

(cid:16)
2

ˆA + ˆD

Qˆz1

ˆD +

Q2 ˆz2
1

(cid:17)

ˆz2

i h

,

(cid:21)

)

ˆA + ˆD
(cid:16)

(cid:17)

Qˆz1

i

(cid:17)

2

ˆǫ ˆβT (ˆz2) = (cid:20)

ˆA ˆD +

ˆA + ˆD

Q2 ˆz2
1

(ˆz1

ˆz2)2

−

(cid:21)

(cid:16)

(cid:17)
ˆA + ˆD

with

and

82

(212)

(213)

(214)

(215)

(216)

ˆǫˆγT (ˆz2) =

ˆA ˆD
ˆA + ˆD

+

ˆA + ˆD

Q2ˆz2

1 + (cid:16)

(cid:16)

(cid:17)

−

ˆA + ˆD
(ˆz1

ˆz2
1
ˆz2)2 +

(cid:17)

2

ˆA + ˆD
(cid:16)
ˆz1

(cid:17)
ˆz2

Qˆz2
1

.

−

(217)

It should be recalled that parameters Q and ˆA have been deﬁned in Eq. (148)
and Eq. (149).

The photon phase space distribution at ˆz = ˆz2 is described by

f|ˆz=ˆz2 =

1
2πˆǫ

exp

"−

ˆγT (ˆz2)ˆl2

1 + 2 ˆαT (ˆz2)ˆl1 ˆη1 + ˆβT (ˆz2)ˆη2

1

2ˆǫ

.

#

(218)

The relative intensity is derived from Eq. (218) integrating over the ˆη1-coordinate,
which gives

I(ˆz2) = exp

2ˆl2
1
2ˆǫ ˆβT (ˆz2) #

.

"−

(219)

Finally, substitution of the expression for ˆǫ ˆβT (ˆz2) obtained in Eq. (216), yields
back Eq. (151), as it should be. Similar conclusions may be obtained for the
spectral degree of coherence integrating over the ˆl1-coordinate and inverse
Fourier transforming the result.

In spite of these results, we should stress again that Statistical Optics is the
only mean to deal with the stochastic nature of Synchrotron Radiation in
general. Only in particular cases Synchrotron Radiation can be treated in
terms of Geometrical Optics. As we have just discussed, one of these cases is
constituted by second generation light sources, when ˆNx,y ≫
1.
Experiments in this region of parameters can take advantage of ray-tracing
code techniques.

1 and ˆDx,y ≫

To conclude this Section, we would like to make a much stronger statement:
there are practical cases of interest when the Statistical Optics approach must
be used even for second generation light sources. This should not sound too
awkward since, as we have stated before, the impulse response of an optical line
may not be treatable in terms of Geometrical Optics. Consider, for instance,
the setup illustrated in Fig. 17. This consists of an entrance slit, a grating and
an exit slit, that is a grating monochromator. The grating equation, which
describes how the monochromator works, relies on the principle of interference
applied to the light coming from adjacent grooves. Such principle though, can
only be applied when phase and amplitude variations of the electromagnetic
ﬁeld are well deﬁned across the grating, that is when the ﬁeld is perfectly
transversely coherent. If the transversely coherent spot of the radiation is
smaller than the grating, not all the grating is taken advantage of, resulting

83

Fig. 17. Illustration of a grating monochromator.

in a decrease of resolution in wavelength. To better explain this point, with
reference to Fig. 17, let us indicate the width of the entrance slit with d and
the angle of incidence of the incoming radiation with α. Moreover, let Dg be
the typical dimension of the grating, Ng the total groove number, m the order
of diﬀraction and z the distance between the entrance slit and the grating.
The maximal (relative) resolution which can be obtained with a particular
grating is given by (mNg)−1. Qualitatively, to obtain such maximal resolution
we must have a transverse coherence area of at least the size Dg cos(α). If it is
smaller, not all the grating is used. We now need to transform this qualitative
requirement into a quantitative requirement.

In practical situations, the grating is placed in the far zone with respect to
the entrance slit. This is because the radiation spot size at the grating should
be at least of order Dg cos(α), which is much larger than the slit aperture d.
If we assume the slit uniformly illuminated, we can consider the slit itself like
a quasi-homogeneous source with rectangular proﬁle. Then, the van Cittert-
Zernike theorem applies at the grating position in the far zone. As a result,
the modulus of the spectral degree of coherence
in the far zone is equal
to the modulus of the Fourier transform of the intensity proﬁle at the slit,
which is a rectangular proﬁle. The following expression for
is found in the
dispersion direction:

g

g

|

|

|

|

g(∆r)

=

sinc

|

|

 

.

πd∆r

λz !(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(220)

A quantitative requirement for the coherence property of the radiation at the
g
grating can be given imposing that
varies within a ﬁxed interval. For in-
|
|
stance, one may require 0.8 <
< 1. This requirement may be changed,
g(∆r)
|
and is somewhat subjective. However it corresponds to a quantiﬁcation of the
transverse coherence properties of the radiation on the grating. In particular,
< 1 is chosen, the argument of the sinc func-
if the criterium 0.8 <

|

g(∆r)
|

|

84

(221)

(222)

(223)

1.13.
tion in Eq. (220) is allowed to vary a certain range [
Moreover, the maximal value for ∆r is Dg cos(α), i.e. the grating dimension.
Putting all together we obtain the following condition for the monochromator
setup parameters:

X, X] with X

≃

−

πdDg cos(α)
λz

= X

1.13 .

≃

The same calculation may be repeated with a diﬀerent choice for the minimal
allowed value of

. This would lead to a diﬀerent value of X.
|

g(∆r)

|

Our result is in agreement with the conclusion that one may draw considering
the following relation [16]:

∆λ
λ

=

dDg cos(α)
λz

!

1
mNg

.

 

Eq. (222) describes how the entrance slit width limits the resolution in wave-
length according to. The second factor on the right hand side of Eq. (222),
i.e. (mNg)−1 is, again, the maximal relative resolution. This resolution can
be obtained by setting the ﬁrst factor to unity. This yields a result in para-
metrical agreement with Eq. (221). The right parametric dependence in the
condition for the maximal resolution can also be obtained in another way. If
the radiation sent through the slit has, at the grating, a spot size equal to
Dg cos(α), the condition for transverse coherence is given by the space-angle
product:

d

θ =

·

dDg cos(α)
2z

λ
2π

.

≃

Again, the qualitative estimation in Eq. (223) is in parametrical agreement
with the quantitative calculation in Eq. (220).

The grating works with a resolution near to the theoretical limit (mNg)−1 only
with transversely coherent radiation. We may say that the purpose of the en-
trance slit is to supply a transversely coherent radiation spot at the grating
in order to allow the monochromator to work with a certain resolution. This
fact must hold for any light source, and in particular for second generation
light sources. The bottom line is that this monochromator setup cannot be de-
scribed in terms of Geometrical Optics even in the case of a second generation
light source: transversely coherent radiation means that the image on the exit
slit is close to the diﬀraction limit. Therefore, in this case, Geometrical Optics
can only be used for approximate estimations, while a correct treatment must
involve the application of Statistical Optics techniques.

85

8

Imaging of quasi-homogeneous undulator sources: eﬀect of aper-
ture size

We will now consider, with the help of Eq. (135), the eﬀects of a pupil in
the one-dimensional case (that can be practically realized with the help of a
slit aperture and a cylindrical lens) when aberrations are not present. First,
in Section 8.1, we will consider Gaussian quasi-homogeneous sources. Then,
in Section 8.2 we will see that the arguments for Gaussian sources can be
generalized without modifying their substance with the help of some notational
change to treat the case of non-Gaussian quasi-homogeneous sources as well.

8.1 Quasi-homogeneous Gaussian undulator sources

1 and ˆDx ≫
In the case for ˆNx ≫
1 we can treat the horizontal and the vertical
direction separately. Then, also the function P and ˆ
can be expressed as the
P
product of factors in the horizontal and in the vertical direction. In particular
we may consider the pupil function

1

0

< ˆa

if

ˆr
|
|
otherwise

,

P (ˆr) = 




(ˆu) = 2ˆasinc(ˆaˆu) .

ˆ
P

where ˆr may represent either the variable ˆx or the variable ˆy. According to
the deﬁnition in Eq. (101) this gives:

(224)

(225)

estimate the characteristic size of the source, that is of order

We can use Eq. (135) and Eq. (156) to describe the case when the lens is in
the far zone, that is when condition (136) is satisﬁed. From Eq. (146) we can
ˆN, and of the
ˆD. According to condition
ˆD, in agreement with the
ˆD 18 . In this limit, Eq.

q
(136), the lens is in the far zone when
≪ q
far zone limit of Eq. (142), which is obtained for ˆA
(135) and Eq. (156) give

correlation length at the source, that is of order 1/

ˆN/ˆz1

≪

q

q

18 Condition (136) is usually not discussed in textbooks describing thermal sources.
In fact, for perfectly incoherent thermal sources, the far zone is deﬁned by ˆz
ˆσo,
σo being the source transverse size, i.e. when the paraxial approximation is valid.
Therefore, in this case, the pupil is always in the far zone.

≫

86

ˆGP (ˆzi, ¯ri, ∆ˆri) = 4ˆa2 exp

¯ri∆ˆri

2im
ˆz1

(cid:20)

d¯u d∆ˆu exp

exp

2 ˆDˆz2

1(∆ˆu)2

(cid:21)

"−

ˆz2
1 ¯u2
2 ˆN #
¯u

(¯ri + ∆ˆri)

−
h
∆ˆu

−

−

(cid:21)(cid:27)

(¯ri −

∆ˆri)

¯u + ∆ˆu

.

−

× Z

sinc

sinc

×

×

(cid:26)

(cid:20)

ˆa

ˆa

m
ˆz1
m
ˆz1

i

(226)

(cid:26)

(cid:20)
According to the far ﬁeld limit of Eq. (142), the quantity ˆDˆz2
1 is the square
1/ ˆN is essentially the square of
of the radiation spot size on the pupil, while ˆz2
the coherence length on the pupil. Two interesting limiting cases of Eq. (226)
can be obtained comparing these two characteristic scales with ˆa2, that is the
square of the pupil size.

(cid:21)(cid:27)

1/ ˆN . ˆa2
First, let us consider the case ˆz2
1. As we will demonstrate
later on, in all situations when the quasi-homogeneous assumption is veriﬁed,
the exponential function in ∆ˆu inside the integral in Eq. (226) behaves like a
δ-Dirac distribution, and one obtains

ˆDˆz2

≪

ˆGP (ˆzi, ¯ri, ∆ˆri) = 4ˆa2 exp

¯ri∆ˆri

d¯u exp

∞

(cid:21)
Z−∞

1 ¯u2
ˆz2
2 ˆN #

"−

2im
ˆz1
m
ˆz1
m
ˆz1

(cid:20)

(cid:20)

(cid:20)

ˆa

ˆa

sinc

sinc

×

×

(cid:26)

(cid:26)

(¯ri + ∆ˆri)

(¯ri −

∆ˆri)

¯u

¯u

(cid:21)(cid:27)

(cid:21)(cid:27)

−

−

.

This corresponds to a relative intensity

ˆIP (ˆzi, ¯ri) =

∞

1

Z−∞

C

d¯u exp

"−

sinc

ˆa

"

 

¯ri
ˆdi −

¯u

2

,

!#(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

ˆz2
1 ¯u2
2 ˆN # (cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

C

where the normalization constant

is given by

∞

=

C

Z−∞

d¯u exp

ˆz2
1 ¯u2
2 ˆN # |

"−

sinc (ˆa¯u)

2 .
|

(227)

(228)

(229)

Eq. (228) expresses the image as a convolution of the geometrical image with
the slit diﬀraction pattern (in two dimensions this would be the Airy pattern).
ˆDˆz2
It is valid for values ˆz2
1: the
diﬀerence between these two cases is that in the ﬁrst the pupil inﬂuence is
signiﬁcant, while in the second it is not. Inspection of Eq. (228) and use
of Eq. (31) yields the ratio between the size of the diﬀraction pattern and

1 and also for ˆz2

1/ ˆN . ˆa2

1/ ˆN

ˆDˆz2

≪

≪

≪

ˆa2

87

−1

−1

(cid:19)

(cid:18)

ˆa

=

M

|q

ˆN /ˆz1

ˆN ˆa/ ˆdi

. When ˆz2

the geometrical image:

1/ ˆN . ˆa2
(cid:18)|
(cid:19)
such ratio is comparable with unity, i.e. the diﬀraction pattern signiﬁcantly
inﬂuences the image formation process. When, ˆz2
ˆa2, this ratio is much
smaller than unity. As a result, the pupil inﬂuence is not signiﬁcant and the
image is given by the geometrical image. The ratio between the size of the
ˆN, gives the resolution
diﬀraction pattern and the geometrical image, ˆz1/ˆa
of the image due to diﬀraction eﬀects. It is also interesting to note that in
ˆDˆz2
the limiting case when ˆz2
1, Eq. (227) presents the asymptotic
behavior

q
1/ ˆN

1/ ˆN

≪

≪

≪

ˆa2

q

ˆGP (ˆzi, ¯ri, ∆ˆri) = 4ˆa2 exp

¯ri∆ˆri

exp

2im
ˆz1

(cid:20)

m2¯r2
i
2 ˆN #

"−

∞

×

Z−∞

d¯u sinc

ˆa

∆ˆri −

¯u

(cid:26)

(cid:20)

(cid:21)(cid:27)

(cid:26)

(cid:20)

sinc

ˆa

∆ˆri + ¯u

.

m
ˆz1

(cid:21)
m
ˆz1

(cid:21)(cid:27)

(230)

The convolution theorem yields the following expression for the spectral degree
of coherence:

gP (ˆzi, ∆ˆri) =

∞

1

Z−∞

D

dˆr′

P (ˆr′)
|

2 exp
|

2i

"−

ˆr′∆ˆri
ˆdi #

,

the normalization factor

being given by

D

∞

=

D

Z−∞

dˆr′

P (ˆr′)

2 .

|

|

¯u′√N/ˆz1 we may rewrite Eq. (228) as a function
After the substitution ¯u
of ξ = ˆam¯ri/ˆz1 with the help of the only parameter p = ˆa√N /ˆz1, that is easier
to plot

−→

ˆIP (ξ) =

d¯u′ exp

¯u′2
2 # |

"−

sinc (ξ

p¯u)

2 ,

−

|

∞

1

Z−∞

C

where

can explicitly be calculated as:

C

=

C

r

π
2

1
p2

−

n

1 + exp

2p2

+

erf

√2p

.

−
h

io

h

i

π
p

88

(231)

(232)

(233)

(234)

 p=0.1

 p=1.0

 p=2.0

 p=5.0

 Diffr. pattern from slit

 Exp[-( /p)

/2] with p =5.0

2

^

I

P

1,0

0,8

0,6

0,4

0,2

0,0

0

1

2

3

4

5

6

7

8

9

10

Fig. 18. Image intensity for a quasi-homogeneous source, ˆIP , as a function of
ξ = ˆam¯ri/ˆz1, calculated with Eq. (233), for diﬀerent values of the parameter
ˆN /ˆz1. The plot illustrates the one-dimensional image formation problem
p = ˆa
(slit aperture, cylindrical lens).

p

·

|

M
|

) in Eq. (234) indicates the error function. Note that the
The function erf(
variable ξ = ˆam¯ri/ˆz1 may also be written as ξ = (ˆa/ ˆdi)¯ri, where ˆdi = ˆzi −
ˆz1
= ˆdi/ˆz1 = m−1. It is interesting to remark that the ratio ˆdi/ˆa is
and
the dimensionless characteristic size of the Fresnel zone, i.e. λdi/(2πa). ˆIP is
plotted in Fig. 18 for several values of the parameter p. In Fig. 18 we also plot
the asymptotic behaviors of ˆIp for small values of p, i.e. ˆIp = sinc2(ξ), that is
(ξ/p)2/2].
the diﬀraction pattern from a slit, and for large values of p, i.e. exp[

−

On the one hand, the integral in d¯u in Eq. (228) is a convolution. On the
ˆ
2 =
(ˆu)
other hand, aside for numerical factors, the Fourier transform of
|
|
P
2 can be given in terms of the triangular function tri(
2ˆasinc(ˆaˆu)
), deﬁned
·
|
as 19

|

19 It should be noted that χ = 2∆ˆr. The reason why we introduced the new variable
χ is to keep a certain homogeneity of notation when comparing with reference [8].
Since our deﬁnition of ∆ˆr diﬀers for a factor 2 with respect to that in [8], it is
somewhat convenient to introduce χ = 2∆ˆr.

89

P

^

P 

1.0

1.0

^

-a

 

0

^

a

^

- /a

^

/a

 

0

~

F(P )

1.0

 

 

 

 

~

P

1.0

^

-2a

0

 

^

2a

^

- /a

0

 

^

/a

Fig. 19. Upper plots: proﬁle of the pupil function P (slit aperture), together with
ˆ
P

. Lower plots: autocorrelation function of the pupil, ˜P , together with

( ˜
P

F

).

tri

χ
2ˆa (cid:19)

(cid:18)

=

1 + χ/(2ˆa)

1

χ/(2ˆa)

−

−

if

if

2ˆa < χ < 0

0 < χ < 2ˆa

0

otherwise .






By means of the convolution theorem, Eq. (228) can be written as

(235)

ˆIP (ˆzi, ¯ri) =

dχ exp

∞

1

Z−∞

N

ˆN χ2
2ˆz2
1 #

tri

χ
2ˆa (cid:19)

(cid:18)

"−

m
ˆz1

(cid:21)

(cid:20)−

exp

iχ

¯ri

.

(236)

The normalization factor

is given by

N

∞

=

dχ exp

N

Z−∞

ˆN χ2
2ˆz2

1 #

tri

χ
2ˆa (cid:19)

(cid:18)

=

"−

ˆz1
2ˆa ˆN



(cid:16)



1 + ˆa2

1 + exp

"−

(cid:17)

ˆa2 ˆN
ˆz2
1 !#

2
 −

ˆz1 + 2ˆa

2 ˆN ˆa
ˆz1

q

q

2π ˆN erf 



.







(237)


90

Eq. (236) can be written as an analogous of Eq. (5.7-10) of [8], that sometimes
goes under the name of Shell’s theorem. Let us deﬁne the autocorrelation
function of the pupil as

∞

˜P (χ) =

duP

u +

Z−∞

(cid:18)

χ
2 (cid:19)

P ∗

u

−

(cid:18)

χ
2 (cid:19)

.

(238)

(239)

In Fig. 19 we plot the proﬁle of the pupil function P , together with ˆ
and the
P
autocorrelation function of the pupil ˜P , together with its Fourier transform

( ˜P ). With the help of Eq. (238), Eq. (236) can be written as

F

ˆIP (ˆzi, ¯ri) =

dχ exp

∞

1

Z−∞

N

ˆN χ2
2ˆz2
1 #

"−

˜P (χ) exp

iχ

¯ri

,

m
ˆz1

(cid:21)

(cid:20)−

that is Eq. (5.7-10) of reference [8].

A second limiting case of interest is found when ˆa2
1. The
pupil is coherently and uniformly illuminated. In this case both the exponential
functions inside the integral in Eq. (226) behave like δ-Dirac functions yielding

≪

≪

1/ ˆN
ˆz2

ˆDˆz2

ˆGP (ˆzi, ¯ri, ∆ˆri) = 4ˆa2 exp

¯ri∆ˆri

sinc

ˆa

(¯ri + ∆ˆri)

2im
ˆz1
m
ˆz1

(cid:20)

(cid:20)
ˆa

sinc

×

(cid:26)

(cid:26)

(cid:21)
∆ˆri)

(cid:20)
.

(cid:21)(cid:27)

(¯ri −

m
ˆz1

(cid:21)(cid:27)

(240)

corresponding to a relative intensity

(241)

ˆIP (ˆzi, ¯ri) = sinc2

ˆam
ˆz1

"

¯ri

=

#

1
4ˆa2

m
ˆz1

ˆ
P (cid:18)

¯ri

2

.

(cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

Also, using the deﬁnition of the spectral degree of coherence given in Eq. (129)
g
one sees that
= 1, i.e. the pupil is coherently illuminated. Eq. (241) is the
|
analogous of Eq. (5.7-14) in [8].

|

Results obtained here deal both with the cross-spectral density ˆGP and the
relative intensity ˆIP in the presence of the pupil. We classiﬁed these results
comparing the square of the extent of the pupil ˆa2 with the square of the
1/ ˆN at the pupil location.
radiation spot size ˆDˆz2
1 and of the coherence length ˆz2

Let us now consider the intensity ˆIP only. In the case of quasi-homogeneous
sources, there is a more general method taken from the theory of linear systems
to account for the pupil presence. This method can be extended to account
for aberrations as well, and allows a more compact treatment of the pupil

91

eﬀects because it does not depend on how the extent of the pupil scales with
respect to the coherence length and to the radiation spot size. It is based
on the concept of line spread function. A linear time-invariant system in two
dimensions can be characterized by the knowledge of the point spread function
(or impulse response) h(x, y). Given a certain input f (x1, y1), the output at
any point (x, y) is given by the convolution of the point-spread function h and
the input f . The point spread function h(x, y) is the response to a δ-Dirac
signal at position (0, 0), i.e. δ(x1, y1). The line spread l(x) is, instead, the
response obtained from a line input δ(x1), which is independent of y1, and can
be calculated by integrating the point spread function h(x, y) with respect to
the y-variable (see, for instance, [17] Sec 6.2.).

In the quasi-homogeneous case, the intensity ˆIP can be written as a convo-
lution between a suitable line spread function l 20 and the intensity ˆI which
does not account for the pupil presence, that is

ˆIP (ˆzi, ¯ri) = [ ˆI

l](ˆzi, ¯ri)

∗

The line spread function l acts as the passport of the imaging system, and
depends on the properties of the lens only. In this case we are only considering
the eﬀect of a ﬁnite pupil dimension, i.e. we are accounting for diﬀraction
eﬀects from the pupil. More in general, l may depend on lens apodization or
aberrations too.

In the case under study here, the line spread function of the system is given
by

(242)

(243)

l(¯ri) = sinc2

ˆa
ˆdi

 

.

¯ri

!

For instance, it is straightforward to see that substitution of the (magniﬁed)
input signal ˆI = exp[
¯u2/(2
), that
is a line input, in Eq. (228) gives back Eq. (243).

2 ˆN )] with the input signal ˆI = δ(¯u/

M
|

M
|

−

|

|

It should be emphasized that the resolution due to diﬀraction eﬀects is of order
ˆN ) is
ˆN). In all cases when this resolution is better than (i.e. ˆz1/(ˆa

ˆz1/(ˆa

q

20 Here we are treating a two-dimensional system, but we are considering the case
when we have separability properties for both the source and the pupil. For the
source this means that ˆNx ≫
1, while for the pupil it means that the
pupil is rectangular. This case is practically realized with the help of slit apertures
and cylindrical optics. The line spread function l is, then, the proper tool to consider.
If one wants to consider the situation when no separability property for the pupil
is present, one should take advantage of an approach based on the point spread
function.

1 and ˆDx ≫

q

92

−

ˆD, 1/

smaller than) the resolution of the ideal image (which does not account for
the pupil presence) the pupil does not play any role and, with the accuracy
of the calculation of the ideal intensity (see Section 15), the l function in Eq.
(243) cannot be distinguished from a δ-Dirac. In our study case, the ideal
intensity ˆI = exp[
1 ¯u2/(2 ˆN)] is calculated with an accuracy which is much
ˆz2
worse than the quasi-homogenous accuracy (see Section 15 for details) and
ˆN ). In general, it is important to compare the
is of order max(1/
resolution due to diﬀraction eﬀects with the accuracy of the calculation of
the ideal intensity. For example, on the basis of such comparison, one may
ˆa2 . ˆDˆz2
1/ ˆN
conclude that the case for ˆz2
1 can be calculated assuming that
ˆN ˆD
1/
the line spread function in Eq. (243) is a δ-Dirac. In fact ˆz1/(ˆa
q
since ˆa2 . ˆDˆz2
ˆN). This kind of
ˆN)
reasoning can be used to treat any quasi-homogeneous case, and the l function
can be modiﬁed to include aberrations and apodization eﬀects as well. In the
most general case, accounting for the eﬀects of the pupil in one dimension,
Eq. (135) yields the relative intensity

1 and therefore ˆz1/(ˆa

max(1/

ˆD, 1/

ˆN)

≪

≪

∼

q

q

q

q

q

q

(244)

(245)

ˆIP (ˆzi, ¯ri) =

1

d¯u d∆ˆu exp

S Z
ˆ
P (cid:20)

m
ˆz1

×

¯u

¯ri −

−

∆ˆu
(cid:21)

ˆG

ˆzi,

#

 

ˆz1
m

¯u,

∆ˆu

ˆz1
m

!

2iˆz1
m

"−
ˆ
P

∗

(cid:20)

¯u

∆ˆu

·
¯ri −

m
ˆz1

¯u + ∆ˆu

,

(cid:21)

where the normalization factor

is given by

S

=

d¯u d∆ˆu exp

S

Z
ˆ
P

×

¯u

[
−

−

∆ˆu] ˆ
P

¯u

∆ˆu

2iˆz1
m
·
¯u + ∆ˆu] .

"−
∗ [

−

ˆG

ˆzi,

#

 

ˆz1
m

¯u,

∆ˆu

ˆz1
m

!

In the quasi-homogeneous case (including cases when the source is not Gaus-
sian, see Section 6), if the lens is in the far ﬁeld, one can write

ˆG

ˆzi,

 

ˆz1
m

¯u,

∆ˆu

ˆz1
m

= ˆI

ˆzi,

 

!

ˆz1
m

¯u

g

ˆzi,

!

 

∆ˆu

exp

!

ˆz1
m

2iˆz1
m

"

¯u

∆ˆu

.

(246)

·

#

Further on, within the accuracy of the quasi-homogeneous approximation, the
spectral degree of coherence g behaves like a Dirac δ-function in the calculation
of both the intensity and the cross-spectral density. In fact, the accuracy of the
2 is also the accuracy of the quasi-homogenous
incoherent impulse response
assumption, and this is the accuracy with which we can substitute g with a
Dirac δ-function on the image plane. As a result, in analogy with Eq. (227)
one has

ˆ
P|

|

93

ˆGP (ˆzi, ¯ri, ∆ˆri) =

d¯u ˆI

∞

Z−∞
ˆ
P (cid:20)

×

m
ˆz1

ˆz1
m

¯u

!

ˆzi,

 

(¯ri + ∆ˆri)

while the relative intensity can be written as

∗

ˆ
P

¯u

(cid:21)

(cid:20)

−

m
ˆz1

(¯ri −

∆ˆri)

,

¯u
(cid:21)

−

(247)

ˆIP (ˆzi, ¯ri) =

∞

1

d¯u

m
ˆz1

ˆ
P (cid:18)

¯u

¯ri −

2

ˆI

ˆz1
m

,

¯u

!

ˆzi,

 

D

Z−∞

(cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)
being deﬁned in Eq. (232). The line input response is obtained by setting

D
ˆI(ˆzi, ˆz1 ¯u/m) to a Dirac δ-function, thus obtaining the line spread function:

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(248)

(249)

l(¯ri) =

m
ˆz1

ˆ
P (cid:20)

¯ri

2

(cid:21)(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

−1( ˜P ) .

=

F

The line spread function is therefore the inverse Fourier transform of the au-
tocorrelation function of the pupil. The autocorrelation function of the pupil,
i.e. the Fourier transform of the line spread function, is also known as the Op-
tical Transfer Function (OTF). Other relevant quantities introduced in linear
system theory are the phase of the Optical Transfer Function and its modulus,
which is known as the Modulation Transfer Function (MTF) [17].

Eq. (248) and, consequently, the line spread function approach, constitutes
a universal description of the intensity in all quasi-homogeneous cases. In
literature the line spread function is used to describe perfectly incoherent
sources only. Note that, in general, radiation produced by an electron beam in
an undulator is similar to an incoherent sum of many independent laser-like
beams. Yet, it cannot be considered as an incoherent sum of point sources
because, as we have seen in Section 3, a single electron cannot be considered
as a point-like radiation source. Radiation produced by a single electron is
similar to a laser beam. If no inﬂuence of focusing is present in the undulator,
this laser-like beam has a waist located in the center of the undulator. At
the waist the radiation wavefront is plane and the radiation spot size is much
larger than the wavelength. We extended the use of the line spread function
approach to the realm of quasi-homogeneous sources.

In the case of third generation light sources the line spread function method
can almost always be applied in the horizontal direction. However, it fails in
the vertical direction, where third generation light sources are seldom quasi-
homogeneous. If the source is not quasi-homogeneous, the cross-spectral den-
sity cannot be factorized in the product of the intensity and of the spectral
degree of coherence, or the coherence length is not short (compared with the
size of the source). As a result, the incoherent line spread function l cannot

94

be used to describe the system. The function ˆ
is known as the coherent
P
line spread function and must be used in its place. In fact, when the source
starts to exhibit a high degree of transverse coherence (i.e. in the non quasi-
homogeneous case), the coherent line spread function, ˆ
acts on the ﬁeld at
P
the image plane analogously to the way the incoherent line spread function
acts on the intensity at the image plane. To see this, it is suﬃcient to inspect
Eq. (100).

It is interesting to compare this viewpoint with what can be found in literature.
For instance, in [6], where a condenser system is discussed, one may read: ”The
intrinsic divergence of the extreme ultraviolet (EUV) undulator considered
here is θcen = 80µrad, which is larger than the beamline acceptance θaccept of
48µrad. Therefore it is evident that the incoherent source approximation holds
here and the term incoherence source is used accordingly in this paper”. In
the following Sections of their work, authors of [6] use a point-spread function
approach to account for aberration eﬀects: in their paper, the intensity at
the source is used, instead of the cross-spectral density, in order to evaluate
both the intensity and the degree of coherence at the image plane. Such an
approach is justiﬁed in the passage above, where they state that the source is
incoherent.

The statement in [6] about the incoherence of the source is a misconception.
According to such statement, perfectly coherent undulator radiation produced
by an electron beam with zero emittance should exhibit incoherent properties
when the radiation divergence is larger than the acceptance of the optical
system. In contrast with the assertion made in [6], the coherence properties
of the source are independent of the beamline elements which follow. In order
to discuss about the coherence properties of the source one has to refer to the
radiation ﬁeld at the virtual plane location only. In particular, the fact that
the source is coherent (or not) does not depend on how the beam acceptance
angle scales with the intrinsic (single particle) divergence of the undulator
radiation. Our conclusion is that the only parameters which describe wether
a source is quasi-homogeneous or not are (in the vertical direction) ˆNy and
ˆDy. If the source is quasi-homogeneous, a point-spread function approach can
be used. If not, the more general results described in Section 14.1 should be
considered. In particular, in the case of [6], the vertical rms dimension of the
source is σy = 16 µm and the radiation wavelength is λ = 13.4 nm, while the
undulator (see [7]) is composed of 55 periods, each one 8 cm long. This means
0.1nm, while
Lw = 4.4 m. Moreover, the vertical emittance at ALS is ǫy ≃
Lw. As a result
the vertical beta function for beamline 12 is βy = 4.2 m
both ˆNy ∼
0.1 and the source is non-homogeneous. We conclude
that, in this case, approximations like Eq. (247) or Eq. (248) cannot be used.
Eq. (376) in Section 14 should be considered instead.

0.1 and ˆDy ∼

≃

95

As a ﬁnal remark we should stress that, even in cases when the virtual source
is quasi-homogeneous, one should verify the assumption that the lens is in
the far zone, before applying a point spread function formalism. In contrast
to this, note that in the usual framework of Statistical Optics, the radiant
intensity from thermal sources is distributed over a solid angle of order 2π,
and optical elements can always be considered in the far zone.

8.2 Quasi-homogeneous non-Gaussian undulator sources

1 and ˆDy ≫

In the present Section 8.2 we will extend results obtained in Section 6. Results
obtained in the previous Section 8.1 apply for a quasi-homogeneous Gaussian
undulator source only. In particular, under the assumptions ˆNx ≫
1 and
ˆDx ≫
1 the cross-spectral density can be factorized in a horizontal and in a
vertical contribution, and results in Section 8.1 can be applied in the horizontal
1, one has, automatically, ˆDx ≫
direction. Note that, if ˆNy ≫
1
and ˆDx ≫
1 and the same results in Section 8.1 can be separately applied
in both the horizontal and the vertical directions. Here, with the help of Eq.
(135), we will include the eﬀects of a pupil in the one-dimensional case when
the source is still quasi-homogeneous, but non-Gaussian. In particular, we
will still assume ˆNx ≫
1 and ˆDx ≫
1 and concentrate our attention on
1 and ˆDy
the vertical direction. First we will study the case when ˆNy ≫
is arbitrary and, then, the case when ˆNy is arbitrary and ˆDy ≫
1. We will
see that the reasoning applied in the case of quasi-homogeneous Gaussian
sources also holds in the case for quasi-homogeneous non-Gaussian sources
as it relies on the separability of the cross-spectral density only. As a result
we will present practical examples of how, with minor substitutions, we can
extend our analysis of the pupil eﬀects to the case of non-Gaussian sources.

8.2.1 Source with non-Gaussian angular distribution in the vertical direction

Let us start considering the case when ˆDy is arbitrary and ˆNy ≫
function and ˆ
P
be now substituted with the y-direction.

1. The pupil
are given by Eq. (224) and Eq. (225). The r-direction should

We can use Eq. (135) and an asymptotic expression of Eq. (168) to describe
the case when the lens is in the far zone, that is when condition (136) is
satisﬁed. From Eq. (162) we can estimate the typical size of the source that
ˆNy, and of the correlation length at the source, that is of or-
is of order
q
ˆDy, 1]. According to Eq. (136), the lens is in the far zone when
q
max[

ˆDy, 1]. In this limit, Eq. (135) and Eq. (168) give

der min[1/
ˆNy/ˆz1

q

≪

q

96

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

¯yi∆ˆyi

2im
ˆz1

(cid:20)

d¯u d∆ˆu exp

exp

2 ˆDy ˆz2

1(∆ˆu)2

γ(ˆz1∆ˆu)

(cid:21)

"−

ˆz2
1 ¯u2
2 ˆNy #
¯u

(¯yi + ∆ˆyi)

−
h
∆ˆu

−

−

(cid:21)(cid:27)

(¯yi −

∆ˆyi)

¯u + ∆ˆu

.

−

× Z

sinc

sinc

×

×

(cid:26)

(cid:20)

ˆa

ˆa

m
ˆz1
m
ˆz1

i

(250)

(cid:26)

(cid:21)(cid:27)

(cid:20)
1 max[ ˆDy, 1] is of the order of the square of the
From Eq. (159), one sees that ˆz2
1/ ˆNy is of the order of the square of
radiation spot size on the pupil, while ˆz2
the coherence length on the pupil. Note that the limiting expression obtained
from Eq. (250) for ˆDy ≫
1 is Eq. (226). As before, two interesting limiting
cases of Eq. (226) can be obtained comparing these two scales with ˆa2, that
is the square of the pupil size.

1 max[1, ˆDy]. As we have already
First, let us consider the case ˆz2
ˆz2
discussed, in all situations when the quasi-homogeneous assumption is veriﬁed,
the exponential function in ∆ˆu inside the integral in Eq. (250) behaves like a
δ-Dirac distribution. As in Eq. (227) one obtains

1/ ˆNy . ˆa2

≪

(251)

(252)

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

¯yi∆ˆyi

d¯u exp

∞

(cid:21)
Z−∞

1 ¯u2
ˆz2
2 ˆN #

"−

2im
ˆz1
m
ˆz1
m
ˆz1

(cid:20)

(cid:20)

(cid:20)

ˆa

ˆa

sinc

sinc

×

×

(cid:26)

(cid:26)

(¯yi + ∆ˆyi)

(¯yi −

∆ˆyi)

¯u

¯u

(cid:21)(cid:27)

(cid:21)(cid:27)

−

−

.

Setting ∆ˆyi = 0 one yields the intensity

ˆIP (ˆzi, ¯yi) =

∞

1

Z−∞

C

d¯u exp

"−

1 ¯u2
ˆz2
2 ˆN # (cid:12)
(cid:12)
(cid:12)
(cid:12)

sinc

ˆa

(cid:20)

(cid:18)

m
ˆz1

¯u

¯yi −

2

,

(cid:19)(cid:21)(cid:12)
(cid:12)
(cid:12)
(cid:12)

has already been deﬁned in Eq. (229). The
where the normalization constant
result in Eq. (252) is equivalent to the intensity already given in Eq. (228). It
can also be written as in Eq. (236), that is

C

ˆIP (ˆzi, ¯yi) =

dχ exp

∞

1

Z−∞

N

ˆN χ2
2ˆz2

1 #

tri

χ
2ˆa (cid:19)

(cid:18)

"−

m
ˆz1

(cid:21)

(cid:20)−

exp

iχ

¯yi

,

(253)

is deﬁned in Eq. (237). After introduction of ˜P as in Eq. (238), Eq.

where
(253) can be rewritten as Eq. (239),

N

97

(254)

(255)

ˆIP (ˆzi, ¯yi) =

dχ exp

∞

1

Z−∞

N

ˆN χ2
2ˆz2

1 #

"−

˜P (χ) exp

iχ

¯yi

.

m
ˆz1

(cid:21)

(cid:20)−

In this case, the expression for the intensity is the same as in the case ˆDy ≫
Also note that the results obtained for the case ˆz2
1/ ˆNy ≪
are valid in the limit ˆz2
(252) can be simpliﬁed to

1.
1 max[1, ˆDy]
ˆz2
1 max[1, ˆDy] as well. In this case Eq.
ˆz2

1/ ˆNy . ˆa2

ˆa2

≪

≪

ˆIP (ˆzi, ¯yi) = exp

m2 ¯y2
i
2 ˆN #

.

"−

The second limiting case that we can mention here for comparison with what
has been done in the Gaussian case is when ˆa2
1 the
pupil is coherently and uniformly illuminated. In this case one recovers the
same results in Eq. (240) and Eq. (241).

max[ ˆDy, 1]ˆz2

1/ ˆN
ˆz2

≪

≪

To sum up, we obtain, in all situations, the same intensity as in the case
ˆDy ≫

1 .

8.2.2 Source with non-Gaussian intensity distribution in the vertical direc-

tion

1.

Let us now study the case when ˆNy is arbitrary and ˆDy ≫
We can use Eq. (135) and an asymptotic expression of Eq. (192) to describe
the case when the lens is in the far zone, that is when condition (136) is
satisﬁed. From Eq. (188) we can estimate the typical size of the source that
ˆNy, 1], and of the correlation length at the source, that is
is of order max[
ˆDy. According to Eq. (136), the lens is in the far zone when
ˆDy. In this limit, Eq. (135) and Eq. (192) give

q
ˆNy, 1]/ˆz1

of order 1/

max[

q

q

≪

q

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

¯yi∆ˆyi

d¯u d∆ˆu

2im
ˆz1

(cid:20)

∞

×

Z−∞

2

(cid:21) Z
ˆφy + ˆz1 ¯u
2 ˆNy

d ˆφy exp 
− (cid:16)


(¯yi + ∆ˆyi)

ˆa

sinc

×

×

sinc

ˆa

(cid:26)

(cid:20)

(cid:26)

(cid:20)

m
ˆz1
m
ˆz1



−

¯u

∆ˆu

−

−

(cid:21)(cid:27)

(cid:21)(cid:27)

(¯yi −

∆ˆyi)

¯u + ∆ˆu

.

(cid:17)



( ˆφy) exp
ˆ
B

−
h

2 ˆDy ˆz2

1(∆ˆu)2

i

(256)

According to Eq. (171), the quantity ˆz2
1

ˆDy is of the order of the square of the

98

1/ max[ ˆNy, 1] is of the order of the
radiation spot size on the pupil, while ˆz2
square of the coherence length on the pupil. Note that the limiting expression
obtained from Eq. (256) for ˆDy ≫
1 is Eq. (226). We will study again two
limiting cases of Eq. (256), which can be obtained comparing these two scales
with ˆa2, that is the square of the pupil size.

ˆD. As before, because
First, let us consider the case ˆz2
of the quasi-homogeneous assumption is veriﬁed, the exponential function in
∆ˆu inside the integral in Eq. (256) behaves like a δ-Dirac distribution. One
obtains

1/ max[ ˆNy, 1] . ˆa2

ˆz2
1

≪

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

2im
ˆz1
∞

(cid:20)

¯yi∆ˆyi

(cid:21)

2

ˆφy + ˆz1 ¯u
2 ˆNy

(cid:17)

∞

d¯u

×

Z−∞

sinc

sinc

×

×

Z−∞
m
ˆz1
m
ˆz1

(cid:20)

(cid:20)

ˆa

ˆa

(cid:26)

(cid:26)

d ˆφy exp 
− (cid:16)



(¯yi + ∆ˆyi)

(¯yi −

∆ˆyi)

¯u

¯u

(cid:21)(cid:27)

(cid:21)(cid:27)

−

−

.

( ˆφy)
ˆ
B






This corresponds to the intensity

ˆIP (ˆzi, ¯yi) =

2

ˆφy + ˆz1 ¯u
(cid:17)
2 ˆNy

( ˆφy)
ˆ
B






∞

1
˜
Z−∞
C

d¯u

∞

Z−∞

sinc

ˆa

(cid:20)

(cid:18)

× (cid:12)
(cid:12)
(cid:12)
(cid:12)

d ˆφy exp 
− (cid:16)



2

m
ˆz1

¯u

¯yi −

,

(cid:19)(cid:21)(cid:12)
(cid:12)
(cid:12)
(cid:12)

where

∞

∞

=

˜
C

d¯u

Z−∞

Z−∞

d ˆφy exp 
− (cid:16)



2

ˆφy + ˆz1 ¯u
2 ˆNy

(cid:17)






( ˆφy)
ˆ
B

|

sinc (ˆa¯u)

2 .

|

In analogy with Eq. (239), Eq. (258) can also be written as:

ˆIP (ˆzi, ¯yi) =

∞

Z−∞

1
˜
N

dχ

exp

(

"−

ˆNyχ2
2ˆz2
1 #

β

χ
2ˆz1 (cid:19))

(cid:18)

˜P (χ) exp

iχ

¯yi

,

m
ˆz1

(cid:21)

(cid:20)−

where the normalization factor ˜
N

is deﬁned as

99

(257)

(258)

(259)

(260)

(261)

(262)

(263)

∞

=

˜
N

Z−∞

dχ

exp

(

"−

ˆNyχ2
2ˆz2
1 #

β

χ
2ˆz1 (cid:19))

(cid:18)

˜P (χ) .

Note that results obtained in the case ˆz2
1/ max[ ˆNy, 1]
valid in the asymptote for ˆz2
is simpliﬁed to

≪

1/ max[ ˆNy, 1] . ˆa2
ˆz2
1

ˆD are also
ˆz2
1
ˆD. In this case, Eq. (258)

≪

ˆa2

≪

ˆIP (ˆzi, ¯yi) =

∞

Z−∞

1
˜
S

d ˆφy exp 



2

ˆφy + m¯yi
2 ˆNy

(cid:17)

− (cid:16)

( ˆφy) ,
ˆ
B






where

∞

=

˜
S

Z−∞

d ˆφy exp

ˆφ2
y
2 ˆNy







−



( ˆφy) .
ˆ
B

The second limiting case that we will mention here for comparison with what
has been done in the Gaussian case is for ˆa2
1 the
pupil is coherently and uniformly illuminated. In this case one recover the
same results in Eq. (240) and Eq. (241).

1/ max( ˆNy, 1)
ˆz2

ˆDy ˆz2

≪

≪

However, in general, the expression for the intensity is diﬀerent from that for
ˆNy ≫

1 .

9 Aberrations and imaging of quasi-homogeneous sources

Up to now we have discussed cases when no aberrations are present. Although
there are widespread treatments of Aberration Theory in literature, we will in-
troduce our own here, so that this work is self-consistent. In particular, we will
focus on the one-dimensional case, which has not been treated widely in books
and monographies, aside for some exception (see [18]). In the present Section
9 we will assume that the virtual undulator source is quasi-homogeneous. Al-
though we will begin introducing the Optical Transfer Function (OTF) for
the system, we will mainly be concerned with the line spread function of the
system. In addition to that we will discuss the case of severe aberrations,
presenting new analytical results for this asymptote and comparison with nu-
merical calculations. Finally, we will intensively discuss defocusing aberrations
and present general analytical results for this case too. Our particular consider-
ation of the defocusing case is justiﬁed by the fact that this is a privileged kind
of aberration in the framework of Fourier Optics. In fact it shows a quadratic

100

l

0,30

0,25

0,20

0,15

 

0,10

0,05

0,00

b2=π

^

Φ(r) = b2 (r/a)2

^

^

b2=3/2 π

-8

-6

-4

-2

2

4

6

8

0

 

^
^ ^r
a/d
i
i

Fig. 20. The line spread l function in the presence of defocusing aberration.

dependence of the phase error along the pupil aperture, that is quite a natural
dependence in the Fourier Optics approach. Quadratic phase factors, which
can be interpreted as defocusing aberrations, are present even in the case of
a pinhole camera setup (that will be treated in the next Section 10) and of
imaging from ideal lenses in an arbitrary plane of interest behind the lens (as
it will be seen in Section 11 and 12).

9.1 Aberrations and the eﬀect of aperture size

In general, aberrations may be accounted for substituting the pupil function
, the autocorrelation function ˜P and the
P , the coherent line spread function ˆ
P
( ˜P ) with new functions,
Fourier transform of the autocorrelation function
F
( ˜Pa), that account for aberrations. Since from the
respectively Pa, ˆ
very beginning of the present Section 9 we considered only the one-dimensional
case, we will consider one-dimensional aberration theory only. Generalization
is possible, although calculations would become more cumbersome.

Pa, ˜Pa and

F

Mathematically, the presence of aberrations in one-dimension modiﬁes the
pupil function by means of a phase error Φ(ˆr) leading to

101

l

0,5

0,4

0,3

0,2

0,1

0,0

 

l

0,6

0,5

0,4

 

0,3

0,2

0,1

0,0

b3=π

^

Φ(r) = b3 (r/a)3^

^

b3=3/2 π

-4

-2

0

4

6

8

10

2

 

^
^ ^r
a/d
i
i

Fig. 21. The line spread l function in the presence of coma aberration.

b

=

b

= -

4

2

b

=

b

=0

4

2

^

^

^

4

^ ^

2

(r) b

 (r/a)

+b

 (r/a)

4

2

b

=3/2 

b

=0

4

2

-8

-6

-4

-2

0

2

4

6

8

^ ^

^

r

a/d

i

i

Fig. 22. The line spread l function in the presence of both spherical and defocusing
aberrations.

102

~
P
a

1,0

0,5

 

0,0

0,0

^

Φ(r) = b2 (r/a)2^

^

b2=π

0,5

1,0

 

b2=3/2 π

1,5

2,0

^χ/a

Fig. 23. The transfer function in the presence of defocusing aberration.

Pa(ˆr) = P (ˆr) exp [iΦ (ˆr)] .

It is customary (see, for instance, [18]) to consider phase errors of the form:

(264)

(265)

Φ (ˆr) = bn

n

ˆr
ˆa !

 

,

n being an integer number, and bn being the maximum phase error at the edge
of the aperture. The value n = 0 corresponds to a constant phase error and
has no eﬀects, as it cancels out when one calculates the pupil autocorrelation
function. The value n = 1 contributes to the autocorrelation function for
a phase term linearly varying with the position. Its only eﬀect is to shift the
image position. We will not deal with the cases n = 0 and n = 1. We will focus
instead on the values n = 2 corresponding to defocusing, n = 3 corresponding
to coma and n = 4 corresponding to spherical aberrations.

As we have seen in Section 8, the presence of the pupil can be dealt with in-
dependently of how the pupil extension ˆa scales with respect to the radiation
spot size and coherence length at the pupil location. Every quasi-homogeneous
imaging system can be described by means of a line spread function that de-
pends on the physical characteristics of the pupil only. As has been shown
in Section 8, the knowledge of the line spread function l and of the inten-

103

~
|
|P
a

1,0

0,5

b3=3/2 π
modulus

^

Φ(r) = b3 (r/a)3

^ ^

b3=π,
phase

b3=π
modulus

~
)
phase(P
a

10

 

b3=3/2 π 
phase

8

6

4

2

0

0,0

0,0

0,5

1,0

1,5

2,0

^χ/a

Fig. 24. The transfer function in the presence of coma aberration.

sity at the image plane without the pupil inﬂuence allows one to reconstruct
the actual image by means of a convolution operation. In the present case of
interest, the line spread function must be calculated accounting for the pres-
ence of aberrations. With in mind the purpose of calculating the line spread
function in presence of aberrations, and with the only assumption of a quasi-
homogeneous source, we start considering Eq. (137). The quasi-homogeneous
assumption allows to represent the cross-spectral density at the virtual source
plane as ˆG(0,
ˆz1∆ˆu). By deﬁnition of quasi-
−
−
homogeneity, and with the accuracy of the quasi-homogeneous assumption
(max[1, ˆNy]
max[1, ˆDy])−1/2, the spectral degree of coherence g plays the role
of a Dirac δ-function in the calculation of the intensity. Such calculation begins
from Eq. (137). Accounting for the pupil inﬂuence, the following expression
for the intensity at the image plane is therefore found:

z1∆ˆu) = ˆI(0,

ˆz1 ¯u)g(0,

ˆz1 ¯u,

−

−

·

ˆIP (ˆzi, ¯ri) =

d¯u

ˆ
Pa

m
ˆz1

(cid:18)

¯u

¯ri −

2

ˆI(0,

ˆz1 ¯u) ,

−

∞

1

Z−∞

D

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(266)

where we recall that
is deﬁned in Eq. (232). Note that Eq. (266) is obtained
from Eq. (137) under the only assumption of quasi-homogeneity. Also, when

D

(cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)

104

~

P

a

1,0

0,5

 

0,0

^

^ ^

^ ^

4

2

(r) b

 (r/a)

+b

 (r/a)

4

2

b

=

b

= -

4

2

b

=

b

=0

4

2

b

=3/2 

b

=0

4

2

0,0

0,5

1,0

1,5

2,0

 

 

^

/a

Fig. 25. The transfer function in the presence of both spherical and defocusing
aberrations.

·

·

)

δ(

2(

−→

) we obtain back an ideal lens and ˆIP (ˆzi, ¯ri) = ˆI(0,

ˆ
Pa|
|
By deﬁnition, the line spread function can be obtained by letting ˆI(0, ˆr)
δ(ˆr) in Eq. (266). As a result we have

m¯ri).

−

−→

l(¯ri) =

m
ˆz1

¯ri

(cid:18)

2

=

∞

Z−∞

(cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)

ˆ
Pa
(cid:12)
(cid:12)
(cid:12)
(cid:12)

dχ ˜Pa(χ) exp

i
"−

χ
ˆdi

.

¯ri

#

(267)

The proof of the last equality in Eq. (267) is based on the autocorrelation
theorem, which states that if the (two-dimensional) Fourier transform of a
function w(x, y) with respect to variables αx and αy is indicated by ¯w(αx, αy),
then the Fourier transform of the two-dimensional autocorrelation function of
2.
w(x, y) with respect to the same variables αx and αy is given by
In formulas, after deﬁnition of the autocorrelation function

¯w(αx, αy)

|

|

A

∞

∞

Z−∞

Z−∞

[w](x, y) =

dη

dξw(η + x, ξ + y)w∗(η, ξ) ,

(268)

105

which is equivalent to

A

∞

∞

Z−∞

Z−∞

[w](x, y) =

dη

dξw(η + x/2, ξ + y/2)w∗(η

x/2, ξ

y/2) , (269)

−

−

the autocorrelation theorem states that

∞

∞

Z−∞

Z−∞

dx

dy exp [i(αxx + αyy)]

[w](x, y) =

¯w(αx, αy)

(270)

A

|

2 .

|

Eq. (267) could have been written down immediately just recalling that the line
spread function is the Fourier transform of the pupil autocorrelation function.

It is convenient to make the change of variable χ
∆xˆa. In fact, because
of the deﬁnition of bn in Eq. (265), only the ratio ∆ˆr/ˆa, or χ/ˆa = 2∆ˆr/ˆa is
important. Aside for an unimportant factor ˆa, the line spread function becomes

−→

l(¯ri) =

d∆x ˜Pa(ˆa∆x) exp

i
"−

ˆa
ˆdi

∆x¯ri

.

#

∞

Z−∞

The autocorrelation function of the pupil ˜Pa, which is the Fourier transform
of l, is known under the name of Optical Transfer Function (OTF) of the sys-
tem. The Optical Transfer Function and the line spread function are obviously
equivalent and their knowledge solves the problem of accounting for aberra-
tions. The Optical Transfer Function can be written explicitly modifying Eq.
(238) to include a phase error in the expression for the pupil function, that is

˜Pa(ˆa∆x) =

d¯x P

ˆa

¯x +

Z

×

exp

(cid:20)
iΦ

(cid:18)
ˆa

(cid:26)

(cid:20)

(cid:18)

ˆa

P

∆x
2 (cid:19)(cid:21)
∆x
2 (cid:19)(cid:21) −

(cid:20)

¯x +

¯x

(cid:18)
iΦ

−

ˆa

∆x
2 (cid:19)(cid:21)
¯x

−

(cid:20)

(cid:18)

∆x
2 (cid:19)(cid:21)(cid:27)

.

Accounting for the deﬁnition of the phase error Φ in Eq. (265) one obtains
from Eq. (272) the following expression for the Optical Transfer Function:

˜Pa(ˆa∆x) =

d¯x P

ˆa

¯x +

(cid:20)

(cid:18)

∆x
2 (cid:19)(cid:21)
n
∆x
2 (cid:19)

P

ˆa

¯x

(cid:20)

(cid:18)

−

∆x
2 (cid:19)(cid:21)
n

¯x
− (cid:18)

−

∆x
2 (cid:19)

.

#)

exp

ibn

¯x +

(

"(cid:18)

∞

Z−∞

×

106

(271)

(272)

(273)

Here P is the pupil function with no aberrations or apodizations and only an
aberration term of order n has been considered. If ¯x is outside the interval
1, 1], at least one of the P functions in the integral gives zero value. As
[
−
a result we may substitute the integration limits in Eq. (273) to obtain the
following expression for the Optical Transfer Function:

˜Pa(ˆa∆x) =

d¯x P

ˆa

¯x +

(cid:20)

(cid:18)

P

n

∆x
2 (cid:19)(cid:21)
∆x
2 (cid:19)

¯x

ˆa
(cid:20)

(cid:18)

−

¯x
− (cid:18)

−

∆x
2 (cid:19)(cid:21)
n

∆x
2 (cid:19)

.

#)

exp

ibn

¯x +

(

"(cid:18)

1

Z−1

×

(274)

With the help of Eq. (265) it is possible to directly calculate how diﬀerent
aberrations modify the expression for the autocorrelation function and its
Fourier transform. These computations can be carried out by means of nu-
merical techniques for any value of n and bn, in analogy with what has been
done in [18].

For completeness we will now calculate the Optical Transfer Function in sev-
eral situations, which may also be found in [18]. In addition, we will also
present the line spread function typical of these situation, which cannot be
easily found in textbooks. Other kind of aberrations can be treated in the
same fashion, and pupils with diﬀerent shape may be selected. We are inter-
ested in the case when the inﬂuence of the phase error is comparable with the
1. Here we will
inﬂuence of diﬀraction eﬀects on the pupil, i.e. when
consider several cases for defocusing (n = 2), coma (n = 3), spherical aber-
rations (n = 4) and a combination of defocusing and spherical aberrations as
well. This last situation is per se interesting, because it illustrates how it is
possible to improve the quality of a lens with spherical aberration by further
introducing a defocusing aberration (in the case under study, i.e. for
1).
In Fig. 20, Fig. 21 and Fig. 22 we plot the line spread functions describing
these aberration cases. As an aside it is worth to anticipate here that Fig. 20
is strictly related with the resolution of a pinhole camera setup. This will be
demonstrated in the next Section 10. As has been already said, the knowledge
of the line spread function is completely equivalent to the knowledge of the
transfer function (OTF) of the system. In Fig. 23, Fig. 24, and Fig. 25 we plot
the transfer functions relative to the same cases treated in Fig. 20, Fig. 21 and
Fig. 22.

bn| ∼

bn| ∼

|

|

ˆDˆz2
In closing, it is interesting to deal with the limit when ˆz2
1.
In this case the coherence length at the pupil is much smaller than the char-
2, as
acteristic pupil size, or, equivalently, Pa(ˆr1)P ∗
presented in Eq. (7.2-15b) of [8]. In order to retain this last simpliﬁcation when
aberrations are present, we must require that the phase of the pupil function
Pa (that is now a complex object) is not appreciably diﬀerent when ˆr1 and

Pa(ˆr2)

Pa(ˆr1)

a (ˆr2)

1/ ˆN

≃ |

≃ |

≪

≪

ˆa2

|

|

2

107

|

ˆa2

bn|

ˆDˆz2

1/ ˆN

ˆr2 are separated by a distance of order of the coherence length or smaller.
This is equivalent to the requirement that the characteristic scale of the lens
imperfections is much larger than the coherence length. Mathematically, this
. 1. Under this assumption, aberrations cannot aﬀect the
means that
cross-spectral density in the limit ˆz2
1. This fact is known from
a long time and, as reported in [8], it was ﬁrst discovered by Zernike [19].
The same limiting case can be presented in the line spread function formal-
ism. One should recall that the resolution due to diﬀraction eﬀects is of order
ˆN), as has already been seen in the previous Section 8. This means
ˆz1/(ˆa
that in the limit ˆz2
1 it makes sense to account for diﬀraction
eﬀects from the pupil, because in this case the resolution due to diﬀraction
eﬀects is worse than that related with the quasi-homogeneous approximation
ˆN ˆD). However, one may choose to worsen the resolution
ˆN ˆD to the resolution due to diﬀraction eﬀects,

≫
of the calculations from 1/

(ˆz1/(ˆa

1/ ˆN

ˆDˆz2

ˆN)

≪

≪

≪

≪

ˆa2

1/

q

q

q

q

ˆN)
bn|

q
|

ˆz1/(ˆa
1. This is equivalent to neglect diﬀraction eﬀects. In this case,
≪
. 1, the autocorrelation function of the pupil can be substituted
since
with unity or, equivalently, the line spread function l plays the role of a Dirac
δ-function in the calculation of the intensity. Therefore, aberrations cannot af-
fect the intensity distribution at the image plane. Moreover, the expression for
. 1 because,
the spectral degree of coherence Eq. (231), remains valid for
2. One concludes that
as already discussed, Pa(ˆr1)P ∗
≃ |
in this limit, and with resolution ˆz1/(ˆa
q
coherence properties on the image plane.

≃ |
1, aberrations cannot aﬀect the

Pa(ˆr1)
ˆN )

Pa(ˆr2)

a (ˆr2)

bn|

≪

|

|

|

2

9.2

Severe aberrations

It is now interesting to discuss an analytical treatment valid in the case for
bn| ≫
1, which exploits the simpliﬁcations arising from the large parameter
bn|

. Under this constraint, aberrations will be considered severe.

|
|

9.2.1

Physical Optics prediction of the line spread function

|

bn| ≫

Under the approximation
1, it is possible to present an analytical cal-
culation for the line spread function l which characterizes the imaging system
in the case of quasi-homogeneous sources. Then, once the line spread function
is known, one obtains the intensity at the image plane by convolving the line
spread function and the intensity from an ideal system (i.e. without accounting
for the pupil inﬂuence).

Let us now focus on that term in the phase factor of Eq. (274) which is linear
in ∆x, i.e. on nbn∆x¯xn−1. We will assume that the integrand contributes to

108

−

bn|

1, 1], otherwise the au-
the integral for all values of ¯x inside the interval [
tocorrelation function would be suppressed, as the eﬀective integration range
1, 1]. Then, a typical scale of the autocorrelation
would be smaller than [
−
function is obtained in terms of ∆x by imposing n
1. In fact,
|
∼
∆x¯xn−1 > 1 the integrand starts to exhibit fast oscillatory behavior,
as n
|
bn|
thus suppressing the integral. Thus, the characteristic scale ∆xtyp ∼
1/(n
)
|
bn|
1, we can state that, with accuracy 1/
,
is found. Since we assumed
|
the functions P inside the integrand can be substituted with unity and the
nonlinear phase factors in ∆xk with k = 2, 3... can be neglected, at least
for reasonable orders of n, as they would give rise to typical scales of order
1/

. As a result we obtain the following major simpliﬁcation:

bn| ≫

∆x¯xn−1

bn|

1/

1/k

|

bn|

|

≫

bn|

|

˜Pa(ˆa∆x) =

d¯x exp

inbn∆x¯xn−1
h

i

.

1

Z−1

Eq. (275) can be integrated analytically for all values of n (therefore including
defocusing, coma, spherical or higher order aberrations). After deﬁnition of

(n, bn, ∆x) =

T

2

(n

1) [

inbnx]

−
(n

−
1)Γ

× (cid:20)

−

0,

(cid:18)

1
n−1
n

n

−

Γ

1 (cid:19) −

n

(cid:18)

,

1

−

1

−

inbn∆x

,

(276)

(cid:19)(cid:21)

Γ(s, z) being the incomplete Euler gamma function

(275)

(277)

Γ(s, z) =

dt ts−1 exp[

t] ,

−

∞

Zz

we have the following result:

˜Pa(ˆa∆x) = Re [

T

(n, bn, ∆x)] + Π(n)

Im [

(n, bn, ∆x)] ,

(278)

·

T

where Π(n) is the parity of n, i.e. Π(n) = 0 if n is even and Π(n) = 1 if n is
odd. Eq. (278) is valid for any value of n > 1.

|

bn| ≫

It is interesting to compare the shape of the autocorrelation function obtained
in the limiting case
1 with that obtained with numerical calculations
which do not exploit the simpliﬁcation based on the large value of the pa-
rameter
. They rely, instead, on the exact formula for the autocorrelation
function, Eq. (274) . This gives a visual idea of the accuracy of the asymptotic.
Fixing bn = 9π we plot the autocorrelation function for defocusing aberrations,
with n = 2, in Fig. 26 and Fig. 27. For coma aberrations, with n = 3, we plot

bn|

|

109

the real part of the autocorrelation function in Fig. 28 and Fig. 29, while the
imaginary part is plotted in Fig. 30 and Fig. 31. The function
should be
truncated as ∆x > 2.

T

Explicit substitution of Eq. (275) in Eq. (271) gives

l(¯ri) =

d∆x

d¯x exp

inbn∆x¯xn−1

exp

(279)

h

i

i
"−

ˆa
ˆdi

∆x¯ri

.

#

∞

Z−∞

1

Z−1

Finally, exchange of the integration order and calculation of the integral in
d∆x yields the following expression for the line spread function, provided that
bn| ≫

1:

|

l(¯ri) =

d¯x δ

nbn ¯xn−1

 

ˆa
ˆdi

−

.

¯ri

!

1

Z−1

Eq. (280) may be explicitly evaluated with the help of the new integration
variable y = nbn ¯xn−1. Care must be taken in separating the cases when n is
even and when n is odd.

When n is even we obtain

l(¯ri) =

2(n

1)

=

2(n

1)

1

−
1

−

nbn

Z−nbn

rect

dy δ

y

 

−

ˆa
ˆdi

¯ri

abs(y)

− n−2
n−1

!  

nbn !

ˆa¯ri

ˆa abs(¯ri)

 

2 ˆdinbn ! ·  

ˆdinbn !

− n−2
n−1

.

Here the function rect(x) is deﬁned, as before, following [8], and is equal to
6 1/2 and zero otherwise. When n is odd we have
unity for

x
|

|

l(¯ri) =

n

1

Z0

nbn

dy δ

y
 

−

ˆa
ˆdi

¯ri

y
nbn (cid:19)

! (cid:18)

− n−2
n−1

=

n

1

rect

ˆa¯ri
ˆdinbn −

1
2 ! ·  

ˆa¯ri
ˆdinbn !

 

− n−2
n−1

.

1

−
1

−

Introduction of the new variable ¯r′′ = ˆa¯ri/( ˆdinbn) allows to write Eq. (281)
and Eq. (282) in a more compact way,

(280)

(281)

(282)

(283)

l(¯r′′) =

1

−

2(n

1)

rect

¯r′′
2 ! ·

 

(abs(¯r′′))− n−2

n−1

110

when n is even, and

l(¯r′′) =

1

−

n

1

rect

¯r′′

−

(cid:18)

1
2 (cid:19) ·

(¯r′′)− n−2

n−1

(284)

when n is odd. Note that we have normalized Eq. (283) and Eq. (284) in such
a way that integration of l in d¯r′′ over the real ﬁeld gives unity.

As we will see later on, Eq. (283) and Eq. (284) can be found with the help of
Geometrical Optics alone. We will refer to such derivation as the Geometrical
Optics prediction of the line spread function. We plotted Eq. (283) or Eq. (284)
as a function of ¯r′′ for diﬀerent aberrations. In Fig. 32 we plotted the case of
defocusing aberration , in Fig. 33 the case of coma and in Fig. 34 the case
of spherical aberrations. Also, in these ﬁgures, comparison with numerical
calculations is shown for the severe aberration cases b2 = 9π, b3 = 9π and
b4 = 9π. Note that Eq. (283) is symmetric in ¯r′′ (when n is even l is symmetric),
while Eq. (284) is not (when n is odd l is not symmetric). This is consistent
with the fact that the Optical transfer function is real in the case n is even,
while it has a non-zero imaginary part in the case n is odd (see, for instance,
Fig. 23, Fig. 24 and Fig. 25 and, later on, Fig. 26, Fig. 28 and Fig. 30). The
same behavior is also found in Fig. 20, Fig. 21 and Fig. 22. Furthermore it
should be noted that the line spread functions in Fig. 33 and Fig. 34 are not
convergent for values of ¯r′′ near zero. However, the meaning of the line spread
function is that of the imaged intensity from a line input, but a line input is
not physical, and must be represented in terms of a generalized function, a
δ-Dirac function. It is not surprising that such an object may lead to a singular
result.

9.2.2

Physical Optics and Geometrical Optics

|

bn| ≫

In the previous Section 9.2.1 we presented a calculation of the line spread
function l for the case
1 based on Physical Optics. This gave us Eq.
(280) for the line spread function or, equivalently, Eq. (281) and Eq. (282), that
are an explicit evaluation of Eq. (280) in the case n is even or odd. We have
seen that the analytical treatment in Section 9.2.1 follows mathematically from
a major simpliﬁcation of Eq. (274), arising from the large parameter
1.
Physically, this condition means that eﬀects of diﬀraction from the pupil can
be neglected. Consider the expression for the pupil autocorrelation function,
Eq. (272). On the one hand, when ¯x
1/bn the phase term due to aberration
∼
eﬀects in Eq. (272) becomes comparable to unity, thus leading to oscillatory
behavior of the integrand. On the other hand, the pupil ﬁnite aperture limits
the integration in Eq. (272) for ¯x
1 diﬀraction eﬀects
. 1. It
bn|
can be neglected, while they start to become important when
follows that it must be possible to obtain results in Section 9.2.1, which have

1. Therefore,

bn| ≫

bn| ≫

∼

|

|

|

111

~
P
a

1,0

0,5

0,0

n=2; b2=9 π
 Numerical
 Analytical

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

1,6

1,8

2,0

^χ/a

Fig. 26. The transfer function in the presence of defocusing aberration (n = 2,
b2 = 9π). Numerical techniques have been used to calculate the exact autocorrela-
tion function that is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

been derived with the help of physical Optics, with the help of Geometrical
Optics only. In the next Section 9.2.3 we discuss how this can be done.

Before doing that it is worth to discuss the relationship between Geometrical
and Physical Optics, which may otherwise be misleading. We should make
clear that when we discuss about Geometrical or Physical Optics we are talking
about possible ways of calculating the line spread function of the system l.

In Section 8 we have introduced the concept of line spread function l and
we have demonstrated that, under the assumption that the virtual source is
quasi-homogeneous, l constitutes a sort of passport for a given lens. It relates
the intensity from any quasi-homogeneous source imaged with a perfect lens
and the intensity obtained by using a particular non-ideal lens. The intensity
from a speciﬁc optical system can be recovered as a convolution of the intensity
obtained in the case of an ideal optical system and the line spread function.
The intensity from an ideal system at the image plane is, by deﬁnition, the
intensity at the virtual source. Therefore, when the quasi-homogeneous ap-
proximation is applicable, it is always possible to break the imaging problem

112

~
P
a

1,0

0,5

0,0

n=2; b2=9 π
 Numerical
 Analytical

0,0

0,1

0,2

0,3

0,4

0,5

^χ/a

Fig. 27. An enlarged version of Fig. 26. Numerical techniques have been used to
calculate the exact autocorrelation function that is compared to the analytical eval-
uation of the autocorrelation function in the severe aberration asymptote.

into two separate problems. First, specify the intensity distribution of the
source. Second, specify the optical system through the l function.

|

bn| ≫

When diﬀraction eﬀects are negligible with respect to aberration eﬀects, i.e.
when
1, the line spread function of the lens can be calculated by both
Physical Optics considerations (as in Section 9.2.1) and Geometrical Optics
considerations, as in the next Section 9.2.3. In this case, a ﬁnite aperture size
does not inﬂuence the calculation of the line spread function. It is responsible
for the quantity of the total energy transmitted only. Once the source charac-
teristics are speciﬁed, one may use a ray-tracing code to get the image intensity
from a non-ideal system or, equivalently, one may calculate the l function and
convolve with a scaled version of the intensity on the virtual source. When
diﬀraction eﬀects are not negligible anymore, l can be evaluated with the help
of Physical Optics considerations only. In this case, use of ray-tracing codes
to solve the imaging problem makes no sense. Yet, the quasi-homogeneous
approximation allows one to use a line spread function approach. Convolu-
tion of l with a scaled version of the intensity on the virtual source solves the
imaging problem. From this viewpoint the quasi-homogeneity of the source is
an a priori condition with respect to the possibility of applying Geometrical

113

n=3 ; b3=9 π
 Numerical
 Analytical

~
 Re[P
]
a
1,0

0,5

0,0

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

1,6

1,8

2,0

^χ/a

Fig. 28. The real part of the transfer function in the presence of coma aberration
(n = 3, b3 = 9π). Numerical techniques have been use to calculate the exact autocor-
relation function that is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

Optics for the solution of imaging problems from a non-ideal setup.

A ﬁnal word of caution should be spent regarding notations historically used to
represent aberrations (see, for instance, [20]). On the one hand, the knowledge
of the phase error Φ(ˆr) = bn(ˆr/ˆa)n is equivalent to the knowledge of the
surfaces of equal phase, i.e. of the wavefronts of the electromagnetic ﬁeld. In
this case one usually talks about ”wave aberration”. On the other hand, the
knowledge of the derivative dΦ(ˆr)/dˆr (or, in more dimensions, of the gradient
Φ(~ˆr)) is equivalent to the knowledge of the vector ﬁeld orthogonal to the
~
∇
wavefronts of the electromagnetic ﬁeld. In the case diﬀraction eﬀects are not
present, one may identify dΦ(ˆr)/dˆr with the extra angular displacement of a
ray and recover the deviation of the transverse coordinate of a ray on the image
plane. In this case, usually, one talks about ”Geometrical aberration” [20] 21 . It
should be clear though, that the presentations in terms of ”Wave aberration”
and ”Geometrical aberration” are completely equivalent from a mathematical

21 In reference [21] the term ”Rays aberration” is used in place of ”Geometrical
aberration”

114

n=3 ; b3=9 π
 Numerical
 Analytical

~
 Re[P
]
a

0,8

0,4

0,0

0,0

0,1

0,2

0,3

0,4

0,5

^χ/a

Fig. 29. An enlarged version of Fig. 28. Numerical techniques have been use to calcu-
late the exact autocorrelation function that is compared to the analytical evaluation
of the autocorrelation function in the severe aberration asymptote.

viewpoint, regardless the value assumed by the parameter
with respect to
unity. Therefore, one needs to clearly distinguish between the language used
(Geometrical or Wave aberration) and the possibility of applying Geometrical
. 1 this is not possible,
Optics to calculate the line spread function. When
and one has to rely on Wave Optics predictions for the line spread function
l only. When
1 one may rely both on Wave Optics predictions (see
Section 9.2.1) or Geometrical Optics predictions (see Section 9.2.3), and the
two predictions must coincide.

bn| ≫

bn|

bn|

|

|

|

9.2.3 Geometrical Optics prediction of the line spread function

As has been already said in Section 9.2.2, when diﬀraction eﬀects are negligible
with respect to aberration eﬀects, i.e. when
1, the line spread function
of the lens can be calculated by both Physical Optics considerations (as in
Section 9.2.1) and Geometrical Optics considerations. In this case, a ﬁnite
aperture size does not inﬂuence the calculation of the line spread function,
and is responsible for the quantity of the total energy transmitted only.

bn| ≫

|

115

~
]
 Im[P
a

0,4

0,2

0,0

n=3 ; b3=9 π
 Numerical
 Analytical

0,0

0,2

0,4

0,6

0,8

1,0

1,2

1,4

1,6

1,8

2,0

^χ/a

Fig. 30. The imaginary part of the transfer function in the presence of coma aber-
ration (n = 3, b3 = 9π). Numerical techniques have been use to calculate the exact
autocorrelation function that is compared to the analytical evaluation of the auto-
correlation function in the severe aberration asymptote.

In the Geometrical Optics limit, Maxwell equations can be replaced by the
simpler Eikonal equation, which should be solved for surfaces of equal phase.
In our one-dimensional case of study, these surfaces are indeed lines on the
plane ˆr
ˆz and may be indicated with the family φp(ˆr, ˆz), where p identiﬁes
a particular value of the phase. Once the functions φp are known, one can
recover the usual ray-tracing techniques remembering that rays are, at any
point, normal to surfaces with equal phase. The following ray equation holds:

−

~s(ˆr, ˆz) = ~
∇

φp(ˆr, ˆz) ,

(285)

where ~s indicates a vector ﬁeld tangent to the rays expressed in normalized
units. If the lens is ideal one recovers, at the image plane, the intensity proﬁle
of the source reversed and magniﬁed. In particular, a line input would be
mapped to a line on the image plane. However, aberrations modify the surfaces
of equal phase in Eq. (285), because a phase error is to be added to φp . As a
result, when calculating ~s by means of Eq. (285), one obtains an extra angular
displacement in normalized units for each ray dependent on the transverse
position of the ray, that is

116

n=3 ; b3=9 π
 Numerical
 Analytical

~
]
 Im[P
a

0,4

0,2

0,0

0,0

0,2

0,4

^χ/a

Fig. 31. An enlarged version of Fig. 30. Numerical techniques have been use to calcu-
late the exact autocorrelation function that is compared to the analytical evaluation
of the autocorrelation function in the severe aberration asymptote.

α(ˆr) =

dΦ(ˆr)
dˆr

=

bn

n
ˆa

ˆr
ˆa !

 

n−1

.

It follows that the coordinate of the ray going through the lens at transverse
position ˆr has a transverse position, at the image plane, given by

(286)

(287)

¯ri(ˆr) =

n ˆdi
ˆa

bn

ˆr
ˆa !

 

n−1

.

The relation between the coordinate of a ray at the pupil and its transverse
position at the image plane for n = 2 (defocusing), n = 3 (coma), and n = 4
(spherical aberration) is plotted in Fig. 35.

If the lens is hit by a ﬁnite number of rays, the output of the system at the
image plane is constituted by a ﬁnite sum of Dirac-δ functions. Each of these

can be represented in the implicit form δ

. Therefore, if the

lens is homogeneously illuminated by an inﬁnite number of rays from the input

¯ri −

(cid:20)

n ˆdi
ˆa bn

ˆr
ˆa

n−1

(cid:16)

(cid:17)

(cid:21)

117

 Numerical calculation: n=2, b

=9π
2
 Geometrical Optics prediction

l

0,8

0,6

0,4

 

0,2

0,0

-2,0

-1,5

-1,0

-0,5

0,5

1,0

1,5

2,0

r’’

0,0

 

a

Z−a

1

Z−1

Fig. 32. The line spread function versus the reduced coordinate on the image plane
¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe defocusing aberration(n = 2, b2 = 9π) and
comparison with the geometrical optics prediction.

line source, we obtain the line spread function

l(¯ri) =

dˆrδ

n ˆdi
ˆa

bn

ˆr
ˆa !

 

¯ri −

n−1





.





Finally, using the new integration variable ¯x = ˆr/ˆa and normalizing l so that
the integral of l gives unity yields

l(¯ri) =

d¯xδ

¯ri −

 

n ˆdi
ˆa

bn ¯xn−1

,

!

that is equivalent to Eq. (280). From a ray-tracing viewpoint, the problem of
calculating the line spread function reduces to the problem of transforming a
uniform distribution of rays into a non-uniform distribution related to the non-
. 1 instead, Geometrical Optics
linear transformation Eq. (287). When
cannot be used to calculate the l function, and the Eikonal approximation
fails. As we have seen in Section 9.2.1 this is equivalent, in the language of
Physical Optics, to a situation when the simpliﬁcation in Eq. (275) does not

bn|

|

(288)

(289)

118

 Numerical calulation:  n=3, b

=9π
3
 Geometrical Optics prediction

l

4

3

1

0

2

 

-1,0

-0,5

0,5

1,0

r’’

0,0

 

Fig. 33. The line spread function versus the reduced coordinate on the image plane
¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe coma aberration (n = 3, b3 = 9π) and
comparison with the geometrical optics prediction.

hold.

10 Pinhole optics

Taking advantage of Eq. (133), we will now study the case when images of a
virtual source can be obtained with the help of a pinhole (i.e. a pupil without
a lens), without further lenses or mirrors. When a pinhole can be treated
as an imaging system, people refer to it as an (X-ray) pinhole camera. Here
we will consider the geometry in Fig. 36. The study of this relatively simple
setup will be helpful to reach a better understanding of Section 11, dedicated
to imaging in the focal pane, Section 12, where we will describe imaging in
any plane behind the lens, and Section 13, that will deal with the depth of
focus of an imaging system. Moreover, it will also suggestively show how a
problem apparently not related with the theory of aberrations (in the pinhole
camera setup there is not even a lens) can formally be treated like a defocusing
aberration problem. This is due to the appearance of a quadratic phase factor
in the equation for the intensity at the image plane.

119

 Numerical calculation: n=4, b

=9π
4
 Geometrical Optics prediction

l

6

5

4

3

2

1

0

 

-1,0

-0,5

0,5

1,0

r’’

0,0

 

Fig. 34. The line spread function versus the reduced coordinate on the image plane
¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe spherical aberration (n = 4, b4 = 9π) and
comparison with the geometrical optics prediction.

An X-ray pinhole camera has the same properties as the more familiar visible
light pinhole-camera. The main advantage of such a lensless imaging system is
that a pinhole is easier to fabricate than a lens. Pinhole cameras can be com-
bined with X-ray Synchrotron Radiation sources and detectors for a number
of relatively specialized applications [22].

The conditions under which the pinhole can be treated as an imaging system
are non-trivial, and are not always satisﬁed. With the help of Eq. (133) we can
investigate the properties of the image in the limiting case for ˆf
, i.e.
when there is no lens. We will restrict ourselves to the one-dimensional case,
thus simplifying the vectorial notation in Eq. (133) to scalar notation. The
assumption of separability of the cross-spectral density in the horizontal and
1 and ˆDx ≫
in the vertical direction ( ˆNx ≫
1) suggests, in fact, to discuss
horizontal and vertical directions separately. In general, one can see that the
following conditions must be satisﬁed in order to form an image of the source
(in one dimension):

−→ ∞

1. The pinhole must be in the far ﬁeld. In this case, using Eq. (127), the

cross-spectral density on the pupil plane is given by

120

.( UAri

.)

.( UAri

.)

2=n

ˆ/ˆ
ar

defocusing

3=n

coma

ˆ/ˆ
ar

.( UAri

.)

4=n

ˆ/ˆ
ar

spherical

Fig. 35. Amount by which a geometrically traced ray departs from a desired location
in the image formed by an optical system. The ordinate for each curve is the height
at which the ray intersects the image plane. The abscissa is the coordinate of the
ray at the pupil plane. n = 2 represents defocusing, n = 3 represents coma, and
n = 4 represents spherical aberration cases according to Eq. (287).

121

ˆG (ˆz1, ¯r, ∆ˆr) =

1
4π2ˆz2
1

exp [2i¯r

∆ˆr/ˆz1] ˆ
G

·

(0,

¯r,

∆ˆr) .

−

−

(290)

2. In the integrand of Eq. (133) two speciﬁc phase factors appear. These
∆ˆr′/ˆz1], the latter appearing through

ˆz1)] and exp[2i¯r′

∆ˆr′/(ˆz2

are exp[2i¯r′
Eq. (290). Both must be negligible.

−

·

·

3. The pinhole size must be larger than the coherence length on the pinhole
plane, or the pupil functions P in Eq. (133) will modify the dependence of
ˆG(ˆz2) on ¯r (i.e. the image will not have a good resolution).

If conditions from 1. to 3. above are satisﬁed, the pinhole camera works as an
imaging system forming an inverted image of the source. From Eq. (133) one
= ˆz2/ ˆz1, because of the
may see that the image is magniﬁed of a quantity
same reason as the lens.

M
|

|

We will now give a physical interpretation of conditions 1. through 3. stated
above. We begin considering the limiting case when ˆN
1, i.e.
a Gaussian quasi-homogeneous virtual source. Further on we will see up to
what extent this assumption can be relaxed. We assume a large magniﬁcation
1, where ˆd = ˆz2
ˆz1. Here this assumption will be
constant
accepted for simplicity and relaxed, later on, to an arbitrary value of

1 and ˆD

ˆd/ˆz1

| ≃

≫

≫

≫

M

−

|

.

M
|

|

≪

The second condition requires that two distinct phase factors in Eq. (133)
may be neglected. The assumption ˆd
ˆz1 leads to the single requirement
¯r∆ˆr/ˆz1
1. On the one hand, ¯r is limited by the presence of the pinhole,
i.e. we must impose ¯r . ˆa. On the other hand, ∆ˆr is limited by the coherence
ˆN , because otherwise the cross-spectral
length at the pinhole, i.e. ∆ˆr . ˆz1/
density ˆG in Eq. (133) drops to zero. As a result we obtain that the second
condition given above can be expressed in mathematical terms by

≫

q

ˆN .

ˆa

≪ q

(291)

It is possible to give a clear interpretation of condition (291) in terms of
Geometrical Optics. In fact, on the one hand, the minimal geometrical spot
ˆa. On the other
size from a line source is given, at the image plane, by
M
|
ˆN , by deﬁnition of magniﬁcation
M
hand, the size of the image is of order
|
. Then, in order to have a good resolution, we must require that the image
M
|
|
size of a point source be much smaller than the image size of the object, i.e.

|q

|

ˆN /ˆa

≫

1, that is condition (291).

q
The third condition given above requires that the pinhole size be larger than
the coherence length on the pinhole plane, otherwise the pupil functions P in

122

Eq. (133) would modify the dependence of ˆG(ˆz2) on ~¯r (i.e. the image would
be inﬂuenced by the pupil). This can be mathematically stated by requiring
that

(292)

ˆa

≫

ˆz1
ˆN

.

q

Condition (292) has a natural explanation in terms of diﬀraction theory. In
fact, the diﬀraction spot due to the presence of the pupil can be estimated as
ˆd/ˆa. In order to have a good resolution, we should impose that the diﬀraction

spot be much smaller than the image size of the object, i.e.
that is condition (292).

M

|

|q

ˆN /( ˆd/ˆa)

1,

≫

Finally, the ﬁrst condition given above requires that the cross-spectral density
at the pinhole position be Eq. (290), i.e. the pinhole must be in the far zone
region. This fact can be alternatively stated by requiring that the radiation
spot size at the pupil be dominated by the angular divergence ˆD, i.e. ˆz1

ˆD

ˆN . In the case ˆN < ˆD, one should require in any case that ˆz1

q
be mathematically expressed by the requirement

≫
q
1. This can

≫

(293)

ˆz1

≫

max 

ˆN
ˆD

v
u
u
t




, 1

.




Note that condition (293) and the initial assumption of a quasi-homogeneous
source are equivalent to the requirement that the pinhole be far enough for
the van Cittert-Zernike theorem to apply. In the case of a perfectly incoher-
ent object (e.g. thermal light), the source radiates over an angle 2π. Then,
the validity of the van Cittert-Zernike theorem (i.e. the requirement that the
radiation spot size at the pupil be dominated by the angular divergence) is
equivalent to the condition that the transverse dimension of the source be
much smaller than the distance between the source and the pupil. This is the
same condition for the paraxial approximation to be applicable. As a result,
condition (293) is always considered satisﬁed in usual treatments describing
pinhole setups in the presence of incoherent objects.

The three conditions (291), (292) and (293) can be summed up in the following:

ˆN

q

ˆa

≫

≫

ˆz1
ˆN ≫

q

max



,

1
ˆD

.

1
ˆN







q

q

(294)

Let us now discuss about the resolution of the pinhole camera. Consistency of

123

Image 
plane

z2

z

(295)

Virtual source
plane

pinhole

S

0

2a

z1

z1

d=z2-z1

Fig. 36. Geometry for a pinhole camera setup. S indicates the virtual source plane.

condition (294) requires that

ˆN

ˆz1 .

≫

Although condition (294) requires that condition (295) be satisﬁed, it does
not pose any constraint on the relative magnitude of ˆa2 with respect to ˆz1.
This observation suggests the presence of another characteristic scale of the
problem, ˆa2/ˆz1. This scale is linked with the resolution of the system. When
ˆa2/ˆz1
1 we are in the presence of an extra large or small pa-
rameter and, thus, we have two asymptotic regimes. In order to systematically
consider this issue we start writing the expression for the intensity proﬁle for
the pinhole camera image with the help of Eq. (133) and Eq. (290), that is

1 or ˆa2/ˆz1

≫

≪

ˆI(ˆz2, ¯r) =

d¯r′d∆ˆr′

ˆ
(0,
G

(

−

−

¯r′,

∆ˆr′) exp

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

exp

−

)

(cid:20)−

1

Z Z

×

+

¯r′∆ˆr′

(cid:21)

2
ˆz1

(cid:18)
¯r∆ˆr′

i

(cid:20)
2i
ˆd

(cid:21)

2
ˆd (cid:19)
.

(296)

is chosen in such a way that ˆI(ˆz2, 0) = 1.
As usual, the normalization factor
The phase in parenthesis
must be negligible under condition (291), and
the inﬂuence of the pupil function P must also be negligible under condition
(292). Here we retain both these factors, because we are interested in studying
the resolution of the pinhole camera, i.e. the accuracy of our calculations.

...
}

Z

{

The phase contribution in 2/ ˆd is always much smaller than the phase contri-

124

M

bution in 2/ˆz1, since we assumed
1. The integrand contributes to the
| ≫
integration results only for those values of ¯r′ and ∆ˆr′ for which the phase factor
is not much larger than unity, otherwise the integrand exhibits fast oscillatory
behavior and it eﬀectively averages to zero. As a result we may neglect, with
some accuracy over the accuracy of the integral, the phase term in 1/ ˆd, that
will start oscillating for higher values of ¯r′ and ∆ˆr′.

|

Note that, under the accepted assumptions ˆN
1, the expression
for the Fourier transform of the cross-spectral density at the virtual source
position is given by

1 and ˆD

≫

≫

(0, ¯r′, ∆ˆr′) = exp

ˆ
G

2 ˆN ∆ˆr′2
ˆz2
1

#

"−

exp

"−

¯r′2
2ˆz2
1

ˆD #

,

(297)

in agreement with Eq. (145).

Analysis of Eq. (297) shows that the exponential function in ¯r′ exhibits a char-

acteristic scale of order ˆz1

ˆD. Conditions (291) and (293) require ˆz1

ˆD

ˆN

ˆa. As a result, since ˆz1

≫
ˆa, we can approximate the exponential
function in ¯r′ in Eq. (297) with unity to obtain an equation still suitable for
q
investigating the resolution of the pinhole camera, that is

ˆD

≫

≫

q

q

q

ˆI(ˆz2, ¯r) =

d∆ˆr′ exp

2 ˆN ∆ˆr′2
ˆz2
1

#

"−

exp

2i
ˆd

(cid:20)−

¯r∆ˆr′

(cid:21)

∞

1

Z−∞

Z

∞

×(

Z−∞

d¯r′ exp

i

¯r′∆ˆr′

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

.

−

)

2
ˆz1 (cid:19)

(cid:20)

(cid:18)

(cid:21)

(298)

{

...
}

in Eq. (298) is the autocorrelation function
The quantity in parenthesis
of the pupil. It accounts for a phase error, exactly as in the case of aberrations
of the second order (defocus). Condition (292) states that the characteristic
scale of ∆ˆr′ in Eq. (297) is small compared to ˆa, that is the characteristic scale
of the pupil function P . If also ˆa2/ˆz1
1 we see that the characteristic scale
≫
of P is large compared with the scale imposed by the phase in parenthesis
ˆa. Therefore,
1 we may neglect the dependence of P on ∆ˆr′

in Eq. (298), because ¯r′∆ˆr′/ˆz1

1 at ∆ˆr′

ˆa and ¯r′

≫

∼

∼

...
{
}
under the assumption ˆa2/ˆz1
in Eq. (298) and obtain

≫

ˆI(ˆz2, ¯r) =

d∆ˆr′ ˜P (∆ˆr′) exp

∞

1

Z−∞

Z

2 ˆN ∆ˆr′2
ˆz2
1

#

"−

exp

2i
ˆd

(cid:20)−

¯r∆ˆr′

,

(cid:21)

(299)

125

(300)

(301)

(302)

(303)

where

˜P (∆ˆr′) =

d¯r′

P (¯r′)

2 exp

|

|

2
ˆz1

i
(cid:20)

¯r′∆ˆr′

,

(cid:21)

or, equivalently 22 :

˜P (∆ˆr′) =

d¯r′ exp

¯r′∆ˆr′

.

i

2
ˆz1

(cid:20)

(cid:21)

∞

Z−∞

ˆa

Z−ˆa

Except for an unessential multiplicative factor ˆa, Eq. (301) is formally equiv-
alent 23 to Eq. (275) with n = 2 and

b2 =

ˆa2
2ˆz1 ≫

1 .

This means that we may study the problem of the resolution of the pinhole
camera as an aberration problem: in particular, a defocusing aberration. The
parameter range when ˆa2/ˆz1
1 leads to equations similar to the case of
severe aberrations when
1, treated in Section 9.2. The autocorrelation
function of the pupil, that is the Optical Transfer Function of the system, is
then obtained by integration of Eq. (301) and reads:

≫
bn| ≫

|

˜P (∆ˆr′) = sinc

2ˆa
ˆz1

 

∆ˆr′

,

!

where Eq. (301) has been used and an unessential multiplicative factor 2ˆa has
been neglected. Substitution of Eq. (303) in Eq. (299) yields

ˆI(ˆz2, ¯r) =

d∆ˆr′sinc

∞

1

Z−∞

Z

2ˆa
ˆz1

 

∆ˆr′

exp

!

"−

2 ˆN∆ˆr′2
ˆz2
1

#

exp

2i
ˆd

(cid:20)−

¯r∆ˆr′

. (304)

(cid:21)

Eq. (304) allows an estimation of the resolution by taking the ratio of the
width of the sinc and of the exponential function in ∆ˆr′. On the one hand,

22 We assume, as done before, that no apodization is present.
23 It should be noted that we switched back from notations ¯x and ∆x, used in
Section 9, to our usual notation ¯r′ and ∆ˆr′, with ¯r′ = ¯x and 2∆ˆr′ = ˆa∆x. We
remind that the reason why we used notations ¯x and ∆x in Section 9 was for the
reader’s convenience, as these notations allow direct comparison with aberration
theory developed in standard textbooks.

126

≫

1 the resolution of the camera is of order ˆa/

ˆN). On the other
the width of the exponential function is of order ˆz1/(2
q
hand, the width of the sinc function is of order ˆz1/(2ˆa). As a result, when
ˆN . This procedure
ˆa2/ˆz1
is justiﬁed by the fact that Eq. (304) can be interpreted as a convolution of
a rectangular proﬁle with a (new) Gaussian function, and that the width of
these two functions can be obtained by taking the inverse widths of the sinc
function and the Gaussian function in Eq. (296) and by multiplying them by
the factor ˆd.

q

...
}

in Eq. (298), because ¯r′∆ˆr′/ˆz1

Let us now deal with the case when ˆa2/ˆz1
1. Going back to Eq. (298), we see
that ˆa is narrow compared with the scale imposed by the phase in parenthesis
ˆa and ¯r′
ˆa. Therefore
{
we can neglect the phase factor in parenthesis
, which corresponds to a
case with no aberrations. The autocorrelation function of the pupil can now
be written as a triangle function

1 at ∆ˆr′

∼
...
}

≪

≪

∼

{

˜P (∆ˆr′) = tri

∆ˆr′
ˆa !

 

,

(305)

(306)

that should be substituted into Eq. (299) to give the analogous of Eq. (304)
in the limit ˆa2/ˆz1

1, that is

≪

∞

Z−∞

Z

ˆI(ˆz2, ¯r) =

1

d∆ˆr′tri

∆ˆr′
ˆa !

 

exp

"−

2 ˆN∆ˆr′2
ˆz2
1

#

exp

2i
ˆd

(cid:20)−

¯r∆ˆr′

.

(cid:21)

Eq. (306) can also be interpreted as a convolution of a sinc2(
Gaussian proﬁle.

·

) proﬁle with a

Similarly to Eq. (304), Eq. (306) allows an estimation of the resolution by
taking the ratio of the width of the triangular function and of the exponential
function in ∆ˆr′ . As before, on the one hand the width of the exponential
ˆN). On the other hand, the width of the triangular
1 the resolution of the

function is of order ˆz1/(2
function is of order 2ˆa. As a result, when ˆa2/ˆz1
q
ˆN).

camera is of order ˆz1/(ˆa

≪

q

≫

1 the resolution of the camera is of order ˆa/

1 becomes less and less satisﬁed. When ˆa2/ˆz1

ˆN. One has
When ˆa2/ˆz1
better resolution as the pupil becomes smaller and smaller, but the condition
ˆa2/ˆz1
1 the resolution of
ˆN). In this case one has better resolution as the
the camera is of order ˆz1/(ˆa
pupil becomes larger and larger, but the condition ˆa2/ˆz1
q
1 becomes less and
less satisﬁed. As a result there must be an optimum for pupil apertures of order

≫

≪

≪

q

127

ˆa

Z−ˆa

1

∼

ˆa2
ˆz1. This optimum depends on the object considered (in this discussion, for
instance, we assumed a Gaussian source) and on the deﬁnition of the width of
a function, that may vary depending on circumstances. However, starting from
Eq. (298), we may present an expression for the Optical Transfer Function of
the pinhole camera, which is the quantity in parenthesis
. Such quantity
can be written as

...
}

{

˜Ppc(∆ˆr′, ˆa, ˆz1) =

d¯r′P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′) exp

i2

.

(307)

−

¯r′∆ˆr′

"

ˆz1 #

After introduction of ξ = ¯r′/ˆa and Ω = ˆa2/ˆz1 we can write Eq. (307) as

˜Ppc

∆ˆr′
ˆa

 

, Ω

=

dξP

ξ +

!

Z−1

 

∆ˆr′
ˆa !

P

ξ

 

−

∆ˆr′
ˆa !

"

∆ˆr′
ˆa #

exp

i2ξΩ

.

(308)

−→

−→ ∞

of Eq. (308) is a sinc(
·

) function, while the limit
Note that the limit Ω
) function, as it should be. Eq. (308) enters in the expression
Ω
0 is a tri(
·
for the intensity as the term in
in Eq. (298), that can be reinterpreted as a
convolution product. Then, the Fourier transform of Eq. (308) with respect to
∆ˆr′/ˆa is one of the factors in this convolution product, and its width is related
with the resolution of the pinhole camera. This Fourier transform is the line
spread function for the pinhole camera. After introduction of y = ˆa¯ri/ ˆd and
η = ∆ˆr′/ˆa we can write the line spread function for the pinhole camera as

...
}

{

1

1

Z−1




Z−1



lpc (Ω, y) =

dξ

dηP (ξ + η) P (ξ

η) exp [i2η (ξΩ

y)]

,

(309)

−

where we accounted for the fact that the Fourier transform integral in dξ
1, 1]. On the one
is limited by the presence of the pinhole to the range [
hand, the integral in parenthesis
in Eq. (309) is the Fourier transform of
η) calculated with respect to η as a function of 2(ξΩ + y). On
P (ξ + η)P (ξ
η) is a window function similar
the other hand, the function P (ξ + η)P (ξ
< 1
to the pupil function P . It is equal to unity for values of
ξ
, and it
|
is zero elsewhere. Therefore, the quantity in parenthesis
in Eq. (309) can
be calculated analytically yielding

η
|
|
...
}

...
}

− |

−

−

−

{

{

−






lpc (Ω, y) =

dξ

sin [2(ξΩ + y)(1
ξΩ + y

ξ

)]

− |

|

.

(310)

1

Z−1

−→

Note that if Ω

0 we have

128

l
pc

2,0

1,5

1,0

0,5

0,0

 Numerical
 Asymptote

Ω=0.5

-10

0

10

y’

1
y

1

Z−1

Ω

1
Ω

Z−Ω

1
Ω {

Fig. 37. The line spread function lpc with Ω = 0.5. In this case the asymptote for
Ω

0, Eq. (311), is well-matched to the numerical evaluations.

−→

lpc (Ω, y)

−→

dξsin [2y(1

ξ

)] = 2sinc2(y) ,

− |

|

(311)

as it should be, while if Ω
we can rewrite Eq. (310) as

−→ ∞

, after the change of variable ξ

ξ′ = Ωξ

−→

lpc (Ω, y)

−→

dξ′ sin [2(ξ′ + y)]
ξ′ + y

=

1
Ω

Ω

Si[2(y + ξ)]
(cid:12)
−Ω
(cid:12)
(cid:12)
(cid:12)
(cid:12)

,

Ω)]
}

−

=

Si[2(y + Ω)]

Si[2(y

−

(312)

·

where Si(
,
) indicates the sin integral function. It can be seen that, as Ω
−→ ∞
the function deﬁned by Eq. (312) approximates more a more a rectangular
Ω < y < Ω and equal to zero elsewhere, as it
function which is constant for
should be.

−

We may use a new variable y′ = y/√Ω in Eq. (310), thus obtaining:

129

l
pc

2,0

1,5

1,0

0,5

0,0

 Numerical
 Asymptote

Ω=2

-10

0

10

y’

Fig. 38. The line spread function lpc with Ω = 2. In this case the asymptote for
0, Eq. (311), starts to diverge from numerical evaluations. The width of lpc
Ω
is close to its minimum.

−→

lpc (Ω, y′) =

dξ

1

Z−1

sin

2(ξΩ + y′√Ω)(1
ξΩ + y′√Ω

h

ξ

)

− |

|

.

i

(313)

≫

1 and
The reason for this is that, now, both the asymptotes Eq. (311) for Ω
1 present a characteristic width 1/√Ω and √Ω respectively.
Eq. (312) for Ω
In Fig. 37, Fig. 38, Fig. 39 and Fig. 40 we present various shapes of the lpc
function and its asymptotic limit for diﬀerent values of Ω. Once a deﬁnition
of the width of the function lpc is chosen, the optimal operation point for the
pinhole camera may be set requiring that the width of lpc be minimal. It should
be remarked that the deﬁnition of the width of lpc is somewhat subjective.

≪

One may, for instance, deﬁne the width of lpc to be the Full Width Half
Maximum (FWHM). In Fig. 41 we present diﬀerent plots for lpc normalized
to lpc(0) for diﬀerent values of Ω = 1, 2, 3, 4, 5, 6. The minimal value of the
FWHM of the line spread function for the pinhole camera happens to be
located somewhere between Ω = 4 and Ω = 5. It may be estimated to be
about 1.5. As a result one concludes that the optimal aperture for the pinhole

130

l
pc

0,5

0,4

0,3

0,2

0,1

0,0

Ω=10

-10

-5

0

5

10

y’

Fig. 39. The line spread function lpc with Ω = 10. An intermediate situation between
.
the two limits for Ω

0 and Ω

−→

−→ ∞

is given by

ˆa2

≃

4.5ˆz1

or, in dimensional units,

a2

4.5

≃

z1c
ω

.

δr

1.5

≃

c
ωz1

s

d .

We can estimate the resolution δr of the pinhole camera in dimensional units
imposing δy′ to be equal to the FWHM of the line spread function, i.e. 1.5,
and taking advantage of the deﬁnition of y′. Therefore we obtain

Results in this Section have been obtained under the assumption

M

1. A

|

| ≫

131

(314)

(315)

(316)

l
pc

0,045

0,040

0,035

0,030

0,025

0,020

0,015

0,010

0,005

0,000

 Numerical
 Asymptote

Ω=100

-20

-10

0

10

20

y’

Fig. 40. The line spread function lpc with Ω = 100. The asymptote in Eq. (312)
starts to match the numerical calculations. In the limit Ω
they both merge
to a rectangular function.

−→ ∞

generalization can be presented introducing

and the analogous dimensional value zeﬀ = ˆzeﬀLw to be used in place of ˆz1
and z1 in Eq. (314), Eq. (315) and Eq. (316). In dimensional units we have

ˆzeﬀ =

ˆz1 ˆd
ˆz1 + ˆd

a2

4.5

≃

zeﬀc
ω

and

δr

1.5

≃

c
ωzeﬀ

s

d .

(317)

(318)

(319)

Before proceeding we should discuss about the applicability of Eq. (313). Up
to now, in fact, we discussed about a Gaussian quasi-homogeneous undulator
source ( ˆN
1). Eq. (313) can be applied in a wider variety of

1 and ˆD

≫

≫

132

l

/l
pc

(0)

pc
1,0

0,8

0,6

0,4

0,2

0,0

 Ω = 1
 Ω = 2
 Ω = 3
 Ω = 4
 Ω = 5
 Ω = 6

Half maximum

min FWHM

~ 1.5

-3

-2

-1

0

1

2

3

y’

Fig. 41. Relative line spread function lpc/lpc(0) for diﬀerent values of Ω.

≪

max[1, ˆD]ˆz2

cases. In particular, Eq. (313) can be applied when (a) the virtual source is
quasi-homogeneous, (b) the pinhole camera is installed in the far zone and
(c) ˆa2
1. When conditions (a), (b) and (c) are satisﬁed, the
line spread function for the pinhole camera, lpc can be calculated from Eq.
(313). At the beginning of the present Section 10 we stated three conditions in
order to have an image of the source, besides the Gaussian quasi-homogeneous
assumption (that we relaxed, here, to the more general case (a)). Condition
1. given at the beginning of the present Section 10 can be identiﬁed with (b).
Condition 1. and 2., together, are responsible for (c). The other requirement
was formulated in order to obtain a good quality image of the source. However
lpc can be calculated regardless of it and, in diﬀerent situations, one may have
a good quality or a bad quality of the image, depending on how the width
of lpc scales with the width of the ideal image. The intensity proﬁle at the
observation plane located at ˆz = ˆz2 is given, in any case, by the convolution
product between the line spread function lpc and the ideal image. In particular,
for an undulator source with Gaussian intensity proﬁle at the virtual plane
= ˆd/ˆz1. When
¯r2/(2M2 ˆN )], where
such a product is given by lpc
ˆN a good quality image is formed at the observation plane.
q
In other situations instead, the width of lpc is of order of, or even larger than,

M
|

exp[

ˆz1/

≫

≫

ˆN

−

q

ˆa

∗

|

133

the width of the ideal image, and a bad quality image will be formed. To
sum up, in order to calculate the intensity distribution at the observation
plane located at position ˆz = ˆz2 behind the pinhole, we should ﬁrst calculate
Ω = ˆa2/ˆzeﬀ. Then use Eq. (313) to calculate the line spread function lpc.
Finally, convolve with the ideal image from the source. The minimal width
of the line spread function, which correspond to the best accuracy for the
image, is for ˆa2/ˆzeﬀ
4.5. Note that conditions (a), (b) and (c) above do not
require the source to be an undulator source. In particular, (a), (b) and (c) are
automatically satisﬁed for thermal sources, or perfectly incoherent objects. As
a result, our theory can be applied for visible light imaging as well.

≃

3

≃

≃

≫

2mm

These remarks simplify our discussion and drastically widen the applicability
region of our results. In particular they can describe bending magnet sources.
For instance, at ESRF (European Synchrotron Radiation Facility) a pinhole
camera setup has been developed for electron beam diagnostics [22]. Syn-
chrotron Radiation from a bending magnet is imaged through an X-ray pin-
hole camera setup. Subsequent analysis of the pinhole camera image allows
one to retrieve the electron beam sizes. In the situation studied in [22] the
diﬀraction angle is of order of γ−1
10−4 rad. The system is reported to
∼
generate an image of the source when the pinhole is moved at about z1 = 23
m from the dipole magnet. At this distance, and at the critical wavelength,
the spot size due to divergence of the single particle radiation is estimated
to be about γ−1z1
σx,y, σx,y being the transverse electron beam
sizes. This guarantees that the pinhole is in the far ﬁeld, i.e. condition (b) is
10−11 m, since one may
satisﬁed. The critical wavelength is of order λ
read, in [22], that ”the contribution from diﬀraction assumes a typical photon
energy of 40 keV”. The radiation diﬀraction size can be estimated to be of
order λγ/(2π)
σx,y, which demonstrates the quasi-homogeneity
of the source, i.e. condition (a). In reference [22] one can also ﬁnd di = 11.5
m. We obtain an optimal pinhole aperture of a
12µm. Since the pinhole
aperture is much smaller than the spot size due to divergence of the single
particle radiation, condition (c) is satisﬁed as well. As a result our theory can
be applied to the situation treated in [22]. Our results should be compared
with the actual choice in [22]. From Fig. 2 in that reference we can conclude
that and 2a
50µm in the horizontal direction. This choice is not optimal,
10. The line spread function for the pin-
since corresponds to the value Ω
hole camera in the horizontal direction is illustrated, in this case, in Fig. 39.
Estimation of the resolution is not easy because, as already said, is related to
the deﬁnition of the width of lpc, which is quite subjective in the particular
case depicted in Fig. 39. However, knowing the proﬁle of the line spread func-
tion, we may use it in order to deconvolve experimental results and extract
the electron beam size. From the same Fig. 2 in [22] we can also conclude that
25µm in the vertical direction. Although the deﬁnition of the width of
2a
lpc is somewhat subjective, we can conclude that the choice made in [22] is
near the optimal value in the vertical direction. The resolution in the vertical

10−1µm

≪

≃

≃

≃

≃

∼

·

134

14µm. As a result the res-
direction turns out to be, from Eq. (319), δr
olution in [22], that is about 26µm, is somewhat underestimated. It should
be clear from the previous discussion that decreasing the pinhole dimension
beyond the optimal size not only will decrease the photon ﬂux, but will also
worsen the camera resolution.

≃

11

Imaging in the focal plane

≫

≫

1, ˆD

In this Section we will investigate the intensity distribution on the focal plane
due to a quasi-homogeneous source. We will ﬁrst consider the case of a Gaus-
sian quasi-homogeneous source ( ˆN
1) and subsequently generalize
our conclusions, as done before for the more comprehensive case of generic
quasi-homogeneous sources. The characteristics of the intensity distribution
in the focal plane can be treated in formal analogy with the pinhole camera
setup treated in Section 10 and with the physics of aberrations, in particular
defocusing aberrations, described in Section 9. This may seem counterintu-
itive, since, at ﬁrst glance, we are treating completely diﬀerent systems from a
physical viewpoint. The formal analogy between these situations is a demon-
stration of the power of the combined Statistical and Fourier Optics approach,
which allows one to unify study cases otherwise completely distinct. Such uni-
ﬁcation can be seen from the expression for the cross-spectral density at any
distance from the source in the presence of a pupil, Eq. (133). As usual, we will
ˆN. Under this assumption
assume that the lens is in the far ﬁeld, i.e. ˆDˆz2
we may use Eq. (127) to characterize the cross-spectral density at the lens
position. In the image plane, the far ﬁeld assumption allows cancellation of
all phase factors in the integrand of Eq. (133) and leads to Eq. (226). This
cancellation does not hold anymore for the focal plane. Use of the focal plane
condition ˆf = ˆz2

ˆz1 and of Eq. (127) yields the intensity (∆ˆrf = 0)

1 ≫

−

1

Z Z

×

i

2
ˆz1

(cid:20)
2i
ˆf

(cid:21)

.

#

ˆI(ˆz2, ¯rf ) =

d¯r′d∆ˆr′

ˆ
(0,
G

(

−

−

¯r′,

∆ˆr′) exp

¯r′∆ˆr′

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

exp

¯rf ∆ˆr′

−

)

"−

(320)

As one can see, the phase factor in the expression for the cross-spectral den-
sity, Eq. (127), survived in Eq. (320) due to the choice of the focal plane as
the observation plane. From a formal viewpoint Eq. (320) is identical to Eq.
(296). In fact, as the reader will remember, the phase ¯r′∆ˆr′/ ˆdi in Eq. (296) is
negligible for
1 and can be retained without change in the formalism
| ≫
is not much larger than unity by deﬁning ˆzeﬀ according to
in the case
Eq. (317). As before, the normalization factor
is chosen in such a way that
ˆI(ˆz2, 0) = 1.

|
M

M

Z

|

|

135

Under the (for now) accepted assumptions ˆN
1, the expression
for the Fourier transform of the cross-spectral density at the virtual source
position is given by Eq.(297). Substitution of Eq. (297) in Eq. (320) yields

1 and ˆD

≫

≫

ˆI(ˆzf , ¯rf ) =

d∆ˆr′ exp

2 ˆN ∆ˆr′2
ˆz2
1

#

exp

2i
ˆf

"−

¯rf ∆ˆr′

#

d¯r′ exp

¯r′∆ˆr′

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

−

∞

1

Z−∞

Z

∞

×(

Z−∞

"−

2
ˆz1

i
(cid:20)

exp

×

"−

¯r′2
2ˆz2
1

.

ˆD # )

(321)

Note that when the pupil inﬂuence is negligible (that is the case when ˆa2
ˆDˆz2

1/ ˆN), Eq. (321) reads
ˆz2

≫

1 ≫

ˆI(ˆzf , ¯rf ) =

d∆ˆr′ exp

∞

1

Z−∞

Z

∞

×(

Z−∞

2i
ˆf

¯rf ∆ˆr′

#

"−

2
ˆz1

i
(cid:20)

d¯r′ exp

¯r′∆ˆr′

exp

2 ˆN ∆ˆr′2
ˆz2
1

#

"−

exp

"−

¯r′2
2ˆz2
1

.

ˆD # )

(322)

The reader may check that evaluation of Eq. (322) gives back Eq. (190), as
it should be. For large non-limiting apertures, the extra phase imposes an
extra Fourier transformation of the integrand, which gives the usual result.
The intensity in the focal plane is a scaled version of the Fourier transform
of the spectral degree of coherence on the virtual source plane. Yet, there are
situations when one may recover an image of the virtual source at the focal
plane. This happens when parameters are such that the only inﬂuence of a
ﬁnal pupil aperture is to make the phase factor in parenthesis
in Eq.
(321) negligible. Looking for a region in parameter space where this situation
is realized is equivalent to what has been done in Section 10. Three conditions
were given such that the phase factor in ¯r′∆ˆr′ in Eq. (296) could be neglected.
In that case, for a pinhole camera, we had image formation at all positions
after the pinhole.

..
}

{

ˆN

ˆa2

1 ≫

In particular, when ˆDˆz2
1/ ˆN not only we can neglect the
ˆz2
phase factor in Eq. (321) but we can also see that the width of the exponential
function in ∆ˆr′ is much narrower than that of the pupil function P . Therefore,
the dependence on ∆ˆr′ in P can be neglected. Moreover, the width of P in ¯r′
is much narrower than the width of the exponential function in ¯r′, so that the
latter can be neglected as well. As a result we simplify Eq. (321) to obtain

≫

≫

(cid:21)

(cid:21)

136

(324)

(325)

1

Z Z

∞

1

Z−∞

Z

ˆI(ˆzf , ¯rf ) =

d¯r′d∆ˆr′ exp

2 ˆN ∆ˆr′2
ˆz2
1

# |

"−

P (¯r′)

2 exp

|

2i
ˆf

"−

¯rf ∆ˆr′

. (323)

#

The integral in d¯r′ yields an unessential multiplication constant to be included
in

, and one is left with

Z

ˆI(ˆzf , ¯rf ) =

d∆ˆr′ exp

2 ˆN ∆ˆr′2
ˆz2
1

#

"−

exp

2i
ˆf

"−

¯rf ∆ˆr′

.

#

Including another unessential constant in the normalization factor
(324) can be written as

Z

, Eq.

ˆI(ˆzf , ¯rf ) =

exp

1

Z

1 ¯r2
ˆz2
f
2 ˆf 2 ˆN #

.

"−

ˆN

ˆa2

≫

1 ≫

1/ ˆN, we obtain, in the focal plane, a
As a result, when ˆDˆz2
ˆz2
scaled image of the virtual source. This is exactly what a pinhole camera does
in the parameter region when conditions 1. to 3. in Section 10 are satisﬁed.
A correspondence between completely diﬀerent problems has thus been estab-
lished thanks to the combined power of Statistical Optics and Fourier Optics
approach.

≫

Such a correspondence can be pursued further, up to a complete formal iden-
tiﬁcation between the pinhole camera and the focal imaging system. To this
purpose we restrict our analysis to the case ˆa2
1. In the opposite limit
we would obtain the already treated result for negligible pupil inﬂuence. In
this situation we can neglect the exponential function in ¯r′2 in Eq. (321). Eq.
(321) can thus be simpliﬁed to

ˆDˆz2

≪

ˆI(ˆzf , ¯rf ) =

d∆ˆr′ exp

2 ˆN ∆ˆr′2
ˆz2
1

#

exp

2i
ˆf

"−

¯rf ∆ˆr′

#

∞

1

Z−∞

Z

∞

×(

Z−∞

"−

2
ˆz1

i
(cid:20)

d¯r′ exp

¯r′∆ˆr′

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

.

(326)

(cid:21)

−

)

ˆd, ˆzf −→

Once the substitutions ˆf
¯r are made, Eq. (326)
ˆz2 and ¯rf −→
−→
is identical to Eq. (298). This means that, in the limit ˆa2
1 studying the
pinhole camera setup is completely equivalent to studying the focal imaging
...
detup. As in Eq. (298), the quantity in parenthesis
constitutes an Optical
}
Transfer Function, and its Fourier transform yields a line spread function for
the system. Note that in the intermediate region for ˆa2
1 one may retain
the same formalism: in this case though, the exponential function in ¯r′2 in Eq.

ˆDˆz2

ˆDˆz2

≪

∼

{

137

ˆa

Z−ˆa

1

(321) cannot be neglected and results would be diﬀerent, depending also on
the source parameter ˆDy which introduces a factor formally identical to lens
apodization.

ˆDˆz2

However, in the case ˆa2
1, we can proceed in perfect parallelism with the
study of the pinhole camera setup in the previous Section 10. Starting from
Eq. (326), we may present an expression for the Optical Transfer Function of
. This quantity
the pinhole camera, which is the quantity in parenthesis
can be written as

...
}

≪

{

˜Pfp(∆ˆr′, ˆa, ˆz1) =

d¯r′P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′) exp

i2

.

(327)

−

¯r′∆ˆr′

"

ˆz1 #

After introduction of ξ = ¯r′/ˆa and Ω = ˆa2/ˆz1 we can write Eq. (327) as

˜Pfp

∆ˆr′
ˆa

 

, Ω

=

dξP

ξ +

!

Z−1

 

∆ˆr′
ˆa !

P

ξ

 

−

∆ˆr′
ˆa !

"

∆ˆr′
ˆa #

exp

i2ξΩ

.

(328)

Similarly as before, the Fourier transform of Eq. (328) with respect to ∆ˆr′/ˆa
is the line spread function for the system. Since it refers to the focal plane it
will be indicated with lfp. After introduction of y = ˆa¯ri/ ˆf and η = ∆ˆr′/ˆa we
can write such Fourier transform exactly as Eq. (309), that is

1

1

Z−1




Z−1



lfp (Ω, y) =

dξ

dηP (ξ + η) P (ξ

η) exp [i2η (ξΩ

y)]

,

(329)

−

−






{

...
}

−
is the Fourier transform of P (ξ + η)P (ξ

where we accounted for the fact that the Fourier transform integral in dξ is
1, 1]. On the one hand,
limited by the presence of the lens to the range [
η)
the integral in parenthesis
calculated with respect to η as a function of 2(ξΩ + y). On the other hand, the
η) is a window function similar to the pupil function P .
function P (ξ +η)P (ξ
and is zero elsewhere. Therefore, as
It is equal to unity for values of
in the previous Section 10, the quantity in parenthesis
can be calculated
analytically yielding back Eq. (310). Moreover, as in the previous Section 10 we
may use a new variable y′ = y/√Ω in Eq. (329), thus obtaining the following
ﬁnal expression for the line spread function:

...
}

< 1

−|

−

−

{

η

ξ

|

|

|

lfp (Ω, y′) =

dξ

1

Z−1

sin

2(ξΩ + y′√Ω)(1
h
ξΩ + y′√Ω

ξ

)

− |

|

.

i

(330)

138

Eq. (330) is identical to Eq. (313). Therefore, the shapes of the function lfp
and of its asymptotic limit for diﬀerent values of Ω are the same as those for
lpc given in Fig. 37, Fig. 38, Fig. 39 and Fig. 40. As before, once a deﬁnition for
the width of lfp is chosen, the optimal operation point for the pinhole camera
may be set requiring that such width be minimal. Deﬁning the width of lfp
to be the full width half maximum (FWHM) one concludes that the optimal
lens aperture for the imaging in the focal plane is given by

(331)

(332)

(333)

ˆa2

≃

4.5ˆz1

or, in dimensional units

a2

4.5

≃

z1c
ω

.

δrf ≃

1.5

s

c
ωz1

f .

We can estimate the best resolution in the focal plane δrf in dimensional units
requiring that δy′ be equal to the minimal FWHM of the line spread function,
i.e. 1.5, and taking advantage of the deﬁnition of y′, which gives

Note that results in this Section have not been obtained under the assumption
ˆzeﬀ is
M
|
not required in this case.

1 as those in the last Section. Therefore, substitution of ˆz1

−→

| ≫

≪

max[1, ˆD]ˆz2

Similarly as before, we should now discuss the applicability of Eq. (330). Up
to now we discussed about a Gaussian quasi-homogeneous undulator source,
but Eq. (330) can be applied in a wider variety of cases. In particular, Eq.
(330) can be applied when (a) the source is quasi-homogeneous, (b) the lens is
installed in the far zone and (c) ˆa2
1. When conditions (a), (b)
and (c) are satisﬁed, the line spread function for the lens, lfp can be calculated
from Eq. (330). Depending on the situation, one may have a good quality or a
bad quality of the image. This is related with how the width of lfp scales with
the width of the ideal image. The intensity proﬁle at the focal plane (located
at ˆz = ˆz1 + ˆf) is given, in any case, by the convolution product of the line
spread function lfp and the ideal image. In particular, for an undulator source
with Gaussian intensity proﬁle at the virtual plane, such product is given by
ˆN a good
lfp
quality image is formed at the observation plane. In other situations instead,
the width of lfp is of order of the width of the ideal image, and a bad quality
1 the line spread
image will be formed. To be speciﬁc, for values of Ω
function and, therefore, the intensity distribution at the focal plane tends to a
) proﬁle. To sum
stepped proﬁle, while for values of Ω

1 one obtains a sinc2(

¯r2/(2M2 ˆN)], where

= ˆf /ˆz1. When

M
|

exp[

ˆz1/

≫

≫

≫

ˆN

−

q

q

ˆa

∗

|

·

≪

139

up, in order to calculate the intensity distribution at the focal plane behind
the lens, we should ﬁrst calculate Ω = ˆa2/ˆz1. Then use Eq. (330) to calculate
the line spread function lfp. Finally, convolve with the ideal image from the
source. The minimal width of the line spread function, which corresponds
to the best image resolution, is when ˆa2/ˆz1
4.5. Note that conditions (a),
(b) and (c) above do not require the source to be an undulator source. In
particular, (a), (b) and (c) are automatically satisﬁed for thermal sources, or
perfectly incoherent objects. As a result, our theory can be applied for visible
light imaging as well. These remarks simplify our discussion and drastically
widen the applicability region of our results.

≃

12 A uniﬁed theory of incoherent imaging by a single lens

≪

max[1, ˆD]ˆz2

In the present Section 12 we will develop a uniﬁed theory which is applicable
to imaging in an arbitrary plane behind the lens. In the previous Section 11
we discussed the possibility of imaging the source at the focal plane. There
we recognized that under conditions (a) the source is quasi-homogeneous (b)
the lens is installed in the far zone and (c) ˆa2
1, the intensity on
the focal plane can be calculated as a convolution product of the line spread
function of the system and the ideal image, which is a scaled version of the
intensity distribution on the source plane. Moreover, it was shown that the
characteristics of the intensity distribution in the focal plane can be treated
in formal analogy with the pinhole camera setup in Section 10 and with the
physics of aberrations, in particular defocusing aberrations, described in Sec-
tion 9. We have seen that when the lens is in the far ﬁeld (condition (b))
Eq. (127) can be used to characterize the cross-spectral density at the lens
position. In the image plane, this assumption alone allows cancellation of all
phase factors in the integrand of Eq. (133) and yields Eq. (226). In the previ-
ous Section 11 we showed that this cancellation does not hold anymore for the
focal plane. From this viewpoint the focal plane is not privileged in any way
with respect to other observation planes. It is this last remark which suggests
a generalization of the previous results. For a generic observation plane posi-
tioned at ˆz = ˆz2 one may use Eq. (127) to get an expression for the intensity
(∆ˆr = 0) from Eq. (133), in analogy with Eq. (320) and Eq. (296), that is

ˆI(ˆz2, ¯r) =

d¯r′d∆ˆr′

ˆ
(0,
G

(

−

−

¯r′,

∆ˆr′) exp

1
f

+

+

1
ˆz1

1
ˆd !

¯r′∆ˆr′

#

Z

×

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

exp

¯r∆ˆr′

,

(334)

−

)

2i
"

(cid:20)−

 −
2i
ˆd

(cid:21)

where ˆd = ˆz2
ˆz1. As one can see, the phase factor in ¯r′∆ˆr′ is more complicated
than those Eq. (320) and Eq. (296) due to the complete arbitrariness of the

−

140

observation plane. Nevertheless, Eq. (334) can be recast to the same form of
Eq. (320) simply with the help of with a new deﬁnition of ˆzeﬀ, that is

1
ˆzeﬀ

=

1
f

−

+

+

1
ˆz1

1
ˆd

.

(335)

Accounting for Eq. (335) we may rewrite Eq. (334) as

ˆI(ˆz2, ¯r) =

d¯r′d∆ˆr′

ˆ
(0,
G

(

−

−

¯r′,

∆ˆr′) exp

i

¯r′∆ˆr′

Z

×

P (¯r′ + ∆ˆr′)P (¯r′

∆ˆr′)

exp

¯r∆ˆr′

,

(336)

−

)

2
ˆzeﬀ
2i
ˆd

(cid:20)

(cid:20)−

(cid:21)

(cid:21)

which is equivalent to Eq. (320).

All that is left to do is now follow, step by step, the previous Section 11. This
leads to the following results. When conditions (a), (b) and (c) are satisﬁed one
may introduce, as before, a line spread function of the system, characteristic
of the observation plane ˆz = ˆz2. This line spread function is formally identical
to Eq. (330):

lz (Ω, y′) =

dξ

1

Z−1

sin

2(ξΩ + y′√Ω)(1
h
ξΩ + y′√Ω

ξ

)

− |

|

,

i

(337)

with Ω = ˆa2/ˆzeﬀ and y′ = y/√Ω, y′ being deﬁned by y = ˆa¯r/ ˆd. Here similarity
techniques have been employed. The ﬁve dimensional parameters λ, a, f , z1
and z2 have been reduced to the only parameters Ω and y′, so that one is left
with the calculation of a dimensionless function in y′ depending on the single
parameter Ω, Eq. (337). As before, depending on the situation, one may have
a good quality or a bad quality of the image. This is related with how the
width of lz scales with the width of the ideal image. The intensity proﬁle at
the observation plane located at ˆz = ˆz2 is given by the convolution product of
the line spread function lz and the ideal image. In particular, for an undulator
source with Gaussian intensity proﬁle at the virtual plane, such product is
ˆN
given by lz
|
a good quality image is formed at the observation plane. In other situations
instead, the width of lz is of order of the width of the ideal image, and a
bad quality image will be formed. To sum up, we presented here an algorithm
to calculate the intensity distribution of radiation at any observation plane
located at position ˆz = ˆz2 behind the lens, given an arbitrary value of ˆa
and a system satisfying conditions (a), (b) and (c). First one should calculate
Ω = ˆa2/ˆzeﬀ. Then use Eq. (337) to calculate the line spread function lz. Finally,

¯r2/(2M2 ˆN)], where

= ˆd/ˆz1. When

M
|

exp[

ˆz1/

≫

≫

ˆN

−

q

q

ˆa

∗

141

≫

−→

−→

0. Then, from Eq. (337) one obtains lz

1 the line
convolve with the ideal image from the source. As before, when Ω
spread function tends to a stepped proﬁle and, as a result, the intensity proﬁle
reproduces a stepped proﬁle too. Note that, ˆzeﬀ being arbitrary, we cannot
give a relation in terms of ˆa and ˆz1 corresponding to an optimal line spread
ˆzi, i.e. when we consider the asymptotic
function. For instance, when ˆz2
limit for the image plane, we obtain from Eq. (335) that ˆzeﬀ
and
sinc2(ˆa¯ri/ ˆd), exactly as in
Ω
Eq. (311). In this case no defocusing aberration is present, quadratic phase
term having being cancelled by the particular choice of the observation plane.
As a result, we cannot give a criterium for an optimal line spread function: we
only have diﬀraction eﬀects so that the larger the aperture ˆa (always within
the constraint imposed by condition (c), i.e. ˆa2
1) the better the
quality of the image. In closing, it is worth to mention that the asymptote
for ˆf
corresponds to the pinhole camera setup already discussed in
Section 10. As a result, this particular case can be treated in terms of our
uniﬁed theory as well.

max[1, ˆD]ˆz2

−→ ∞

−→ ∞

−→

≪

13 Depth of focus

According to [23] ”the depth of focus of a lens is the permitted displace-
ment, away from the focal or image plane, for which the intensity on axis is
diminished by some permissible amount”. In particular, when plane wave illu-
mination is considered on a perfect circular lens, the focal plane corresponds
to the plane where the radiation assumes the minimal spot size, and the in-
tensity on axis reaches a maximum at that point. It can be shown that, in
this case, the on-axis intensity decreases of about 20% when ”the observation
plane is displaced from the ideal focal plane [...] by an amount” (see [23])

∆′z

=

|

|

λ
2NA2 ,

(338)

where the quantity NA indicates the numerical aperture of the lens. NA =
sin θ, θ being the ”half angle measured from the optic axis at the focus back to
the lens” [23]. The concept of depth of focus described in Eq. (338), describes
a case of coherent illumination of the lens by a plane wave, and the lens is
treated, here, as a condenser. The object to be imaged is, in fact, the radiation
source itself. Since we are dealing with coherent illumination we may say that,
in this case, the depth of focus is diﬀraction limited.

The depth of focus as described in Eq. (338) is parametrically related to an-
other concept of depth of focus which is used, for example, in Optical Lithog-
raphy [23, 24]. In this case one needs to illuminate a wafer with a demagniﬁed
image of a given pattern on a mask. Here the lens (actually the collection of

142

lenses) is no more treated as a condenser: its function is to produce the demag-
niﬁed image of the mask. The mask itself must be illuminated by means of a
condenser system instead, and, as remarked in [23], ”the ability to print ﬁne,
high contrast features is signiﬁcantly aﬀected by the degree of coherence within
the optical system. If there exists a high degree of spatial coherence, diﬀrac-
tion from adjacent mask features will interfere in the image plane, signiﬁcantly
modifying the recorded pattern”. The mask should therefore be illuminated
by incoherent light and should be considered as a quasi-homogeneous source
itself. For a lithography setup, the resolution R is the width of the diﬀraction-
limited point spread function of the system, while the distance X over which
the image is in proper focus is, more quantitatively, the distance over which
R is increased by some permitted amount. Although a lithography setup con-
stitutes a completely diﬀerent setup with respect to the condenser system
illuminated with coherent plane waves, R and X turn out to be respectively
[24]:

R = k1

; X = k2

λ
NA

λ
NA2 .

(339)

The distance X is therefore parametrically related to the distance
deﬁned
in Eq. (338) and even though these two quantities refer to very diﬀerent setups,
involving quite diﬀerent physics, also X is named, as

, depth of focus.

∆′z

|

|

∆′z

|

|

|

|

∆z

To complicate the situation further one is frequently interested in the depth
for a condenser system when the lens is not illuminated by plane
of focus
waves but by other kind of non quasi-homogeneous or quasi-homogeneous
sources, which is a diﬀerent situation from both cases considered in the pre-
vious discussion. In this Section we will treat the case of a condenser lens
illuminated by a quasi-homogeneous source characterized by ˆNx ≫
1 and
ˆDx ≫
1. Separate treatments of the x and y direction are thus allowed, which
simplify to one-dimensional cases. Our study applies to the horizontal direc-
tion only. However, if also ˆNy ≫
1 the same results for the
horizontal direction can be applied to the vertical direction as well. Our deﬁ-
nition of depth of focus will be relative to the plane of smallest spot size of the
radiation. Therefore, in the present Section 13, the depth of focus of a lens is
deﬁned as the permitted displacement, away from the waist plane, for which
the intensity on axis is diminished by some permissible amount.

1 and ˆDy ≫

Before starting to discuss about the depth of focus, it is necessary to derive an
expression for the point where the radiation spot size is the smallest. This can
ˆǫ ˆβ(ˆz2) is
be obtained with the help of Eq. (216) in Section 7. In fact, since 2
the characteristic width of the Gaussian radiation spot size at the observation
plane located at ˆz = ˆz2, it is suﬃcient to look at the point ˆz2best where the
derivative of ˆǫ ˆβ(ˆz2) is zero to obtain the position of the waist plane. With the
help of Eq. (216) one ﬁnds

q

143

ˆz2best = (cid:16)

ˆf + ˆz1

ˆN

ˆD ˆf ˆz2

1 + ˆDˆz3

1

(cid:17)
ˆN + ˆD

−
ˆf

(cid:16)

ˆz1

−

2

(cid:17)

= (cid:16)

ˆf + ˆz1
ˆAˆz2
1 −
(cid:17)
1 + ˆD
ˆAˆz2

ˆf
(cid:16)
ˆf

ˆz1
2
(cid:17)

−
ˆz1

ˆDˆz2
1

.

−

(cid:16)

(cid:17)

(340)

−→

0 respectively. Consider ﬁrst the case when ˆA

ˆD and for
It is interesting to study two limiting cases of Eq. (340) for ˆA
≫
ˆD. From Eq. (340) one
ˆA
ˆzf = ˆf +ˆz1. This means that the waist
may see that, in this ﬁrst case, ˆz2best
−→
plane asymptotically goes to the focal plane of the lens. Consider now the case
when ˆA
0. Again from Eq. (340) one may see that, in this second case,
ˆf ). This means that the waist plane asymptotically
ˆz2best
goes to the image plane of the virtual source (located at ˆz = 0).

ˆzi = ˆz2

1/(ˆz1

−→

−→

≫

−

≫

−→

ˆD and for ˆA

From the analysis of the two limiting cases for ˆA
0, we
conclude that one always has ˆz1 + ˆf < ˆz2best < ˆzi. In other words, the waist
plane is always located between the focal and the image plane. This results
may seem counterintuitive. In fact, for our Gaussian virtual source, the waist
is located at ˆzs = 0, which is imaged, reversed and magniﬁed, at the image
plane. Therefore, at ﬁrst glance, the smallest spot size should be located at
the image plane. The reason why this is not the case is due to the presence of
the magniﬁcation factor, which linearly increases with ˆz2. On the one hand the
source has a waist located at ˆzs = 0 and its size increases symmetrically as one
moves away from ˆzs = 0 in both the positive and the negative direction. On
the other hand the magniﬁcation factor increases linearly with ˆz2 and is not
characterized by the same symmetric dependence on the displacement from
ˆzs = 0.

In the following Section 13.1 and Section 13.2 we study the problem of the
depth of focus in a condenser system with a Gaussian quasi-homogeneous
source. Eﬀects from the pupil width will be neglected in Section 13.1, Finite
pupil dimensions will be accounted for in Section 13.2.

13.1

Large non-limiting aperture

= ˆdi/ˆz1

|

≪

1. In this case,
M
We will discuss, for simplicity, the case when
|
ˆf . Since we assumed as a starting point
from Eq. (30) we obtain ˆdi ≃
1
M
it follows that ˆf
ˆz1, and that the distance between the image and the focal
≪
ˆf. Moreover, the radiation spot size at
ˆf
ˆf 2/ˆz1
plane is ∆ = ˆdi −
ˆN from Eq. (157), while the
the image plane is known to be of order
radiation spot size at the focal plane is obtained from Eq. (154) and is of
ˆD ˆf. As has been discussed above, the position of the waist goes from
order
the focal plane to the image plane as we pass from the near to the far zone.
This can also be seen by comparing the radiation spot sizes at the image and

M
|

| ≪

≃ |

|q

M

≃

q

|

|

144

ˆD ˆf

ˆD. It
at the focal plane in the near and in the far zone. In the near zone ˆA
ˆN ˆf/ˆz1, i.e. the radiation spot size at the focal plane is
follows that
much smaller than that at the image plane. On the contrary in the far zone
ˆN ˆdi/ˆz1, i.e. the radiation spot
ˆN ˆf /ˆz1
ˆA
≫ q
size at the focal plane is much smaller than that at the image plane. We will
analyze these two cases separately.

≪ q
q
ˆD. It follows that

≃ q

ˆD ˆf

≪

≫

q

13.1.1 Far zone

≪

|q

In this case ˆA
ˆD and the waist is near the image. On the one hand, as has
been already remarked, the radiation spot size on the image plane is about
ˆN and does not depend on ˆD. On the other hand, the radiation spot size
M
|
on the non-limiting pupil aperture is deﬁned by the beam divergence and can
ˆDˆz1. This means that the rate of change of the radiation
ˆf .
spot size from the lens to the waist can be estimated as
The parametric dependence of the depth of focus can be found requiring that

be estimated as

q

q

the spot size increase due to a displacement ∆ˆz, that is

ˆDˆz1/ ˆf , since ˆdi ≃
ˆDˆz1/ ˆf
(cid:19)

(cid:18)q
ˆN . This yields the

∆ˆz be

of order of the radiation spot size at the waist, i.e.
following Geometrical Optics prediction for the depth of focus:

|q

M

|

∆ˆz

≃

ˆf
|

ˆN
M
|q
ˆDˆz1

q

M2

≃

ˆN
ˆD

.

v
u
u
t

(341)

(342)

q

One may separately estimate the diﬀraction size related with an aperture
ˆDˆz1 (the radiation spot size at the non-limiting pupil aperture) at

of size
the observation plane. Such estimation yields a diﬀraction size ˆdi/(
ˆf /(
∆′ ˆz, that is
may estimate the diﬀraction limited depth of focus as

≃
ˆDˆz1). Now, requiring that the spot size increase due to a displacement
ˆDˆz1) one

∆′ ˆz, be of order of the diﬀraction size ˆf /(

ˆDˆz1/ ˆf
(cid:19)

ˆDˆz1)

(cid:18)q

q

q

q

∆′ ˆz

≃

ˆf 2
ˆDˆz2
1

.

The following comparison between the diﬀraction limited depth of focus ∆′ ˆz
and the Geometrical Optics prediction for the depth of focus ∆ˆz can be pre-

145

sented:

∆′ ˆz
∆ˆz ≃

ˆf 2
ˆDˆz2

1 ·

ˆD
ˆN ≃

1
M2 v
u
u
t

1
ˆN ˆD

.

q

Eq. (343) allows one to conclude that diﬀraction eﬀects can be neglected within
the accuracy of the quasi-homogeneous approximation, and that Eq. (341) is
a correct estimation of the depth of focus in this case. Note that the deﬁnition
in Eq. (338) has no meaning in the case of a condenser system with a quasi-
homogeneous source. Finally, it is interesting to remark that the depth of focus
is much shorter than the distance ∆ between the waist (image) and the focal
plane. In fact

(343)

(344)

∆ˆz
∆ ≃

M2

ˆN
ˆD ·

v
u
u
t

1

M
|

|

ˆf ≃ v
u
u
t

ˆN
ˆDˆz2

1 ≪

1 ,

because of the far zone assumption ( ˆA

ˆD).

≪

13.1.2 Near zone

Similar estimations can be made in the near zone, i.e. assuming ˆA
ˆD,
when the waist is near the focal plane. On the one hand, as has been already
ˆD ˆf and does not
remarked, the radiation spot size at the focal plane is about
depend on ˆN . On the other hand, the radiation spot size on the non-limiting
pupil aperture is deﬁned by the electron beam waist and can be estimated as
ˆN . This means that the rate of change of the radiation spot size from the
q
ˆN / ˆf since the waist is near the focal
lens to the waist can be estimated as
q
plane. The parametric dependence of the depth of focus can be found imposing

≫

q

that the spot size increase due to a displacement ∆ˆz, that is

of order of the radiation spot size at the waist, i.e.
following Geometrical Optics prediction for the depth of focus:

q

ˆN/ ˆf
(cid:19)

(cid:18)q

∆ˆz be

ˆD ˆf . This yields the

(345)

∆ˆz

≃ q

ˆD ˆf 2
ˆN

.

q

One may separately estimate the diﬀraction size related with an aperture of
ˆN (the radiation spot size at the non-limiting pupil aperture) at the
ˆN .

size
observation plane. Such estimation gives a diﬀraction size ˆdi/

ˆf/

ˆN

q

≃

q

q

146

Now, imposing that the spot size increase due to a displacement ∆ˆz, that is
ˆN one may estimate the

∆ˆz be of order of the diﬀraction size ˆf /

(cid:18)q
diﬀraction limited depth of focus as

q

ˆN / ˆf
(cid:19)

∆′ ˆz

≃

ˆf 2
ˆN

.

The following comparison between the diﬀraction limited depth of focus ∆′ ˆz
and the Geomterical Optics prediction of the depth of focus ∆ˆz:

∆′ ˆz
∆ˆz ≃ q
q

ˆN
ˆD ˆf 2

ˆf 2
ˆN ≃

1
ˆN ˆD

q

Eq. (347) allows one to conclude that diﬀraction eﬀects can be neglected within
the accuracy of the quasi-homogeneous approximation, and that Eq. (345) is
a correct estimation for the depth of focus in this case. Finally, it is interesting
to remark that the depth of focus is much shorter than the distance ∆ between
the waist (focal plane) and the image plane. In fact

ˆD ˆf 2
ˆN ·

∆ˆz
∆ ≃ q
q

1
M
|

|

ˆf ≃ v
u
u
t

ˆDˆz2
1
ˆN ≪

1 ,

because of the near zone assumption ( ˆA

ˆD).

≫

13.2

Eﬀect of aperture size

We will now analyze the inﬂuence of a ﬁnite aperture on our analysis of the
depth of focus. For simplicity we will consider the far ﬁeld case, as all our
examples involving eﬀects of ﬁnite aperture size have been relying on the far
ˆDˆz1
ﬁeld assumption. At ﬁrst glance, substitution of the radiation spot size
with the ﬁnite aperture size ˆa solves all issues, as it allows estimations of the
rate of change of the radiation spot size and of diﬀraction eﬀects. This would
lead to the following equations for the Geometrical Optics prediction of the
depth of focus:

q

ˆf 2

ˆN
q
ˆz1ˆa

,

∆ˆz

≃

147

(346)

(347)

(348)

(349)

for the diﬀraction limited depth of focus:

∆′ ˆz

≃

ˆf 2
ˆa2 ,

for the ratio between ∆′ˆz and ∆ˆz:

∆′ ˆz
∆ˆz ≃

ˆf 2
ˆa2 ·

ˆf 2

ˆN ≃

ˆa

ˆN

,

ˆz1

q

ˆz1ˆa

q

∆ˆz
∆ ≃

ˆf 2

ˆN
q
ˆz1ˆa ·

1

ˆN
ˆf ≃ q
ˆa

.

M
|

|

and for the ratio between the depth of focus and the distance ∆:

(350)

(351)

(352)

{

ˆa2

≫

≫

1 ≫

in Eq. (321) can be neglected.

1/ ˆN one recovers a scaled
ˆz2

ˆa2. Another critical scale to account for is ˆz2

We have seen in Section 11 that there exist particular situations when the
phase factor in parenthesis

...
}
ˆN
In one of these cases, when ˆDˆz2
image of the virtual source at the focal plane, where the scaling factor ˆf /ˆz1
≃
(see Eq. (325)). Thus, in this situation, it is not correct to state that the
M
|
|
radiation spot size at the image plane is smaller than the radiation spot size
at the focal plane, because in both these planes we have the same, identical
image of the virtual source with approximatively the same scaling factor. It
should be remarked that in this case the depth of focus ∆ˆz is longer than the
distance between focal and image plane, ∆, as one may see from Eq. (352)
when ˆN
1/ ˆN. As we have seen
≫
1/ ˆN one obtains, at the focal plane, the diﬀraction
in Section 11, when ˆa2
ˆz2
pattern of the pupil (aberrated or not, depending on how ˆa2 scales with respect
to ˆz1). This case corresponds to coherent illumination of the pupil. In this
situation, the diﬀraction limited depth of focus ∆′ˆz is much longer than the
Geometrical Optics prediction of the depth of focus ∆ˆz, as one may see from
Eq. (351). In this case, Eq. (350) should be used instead of Eq. (349) in order
to estimate the depth of focus of the system. Summing up, Eq. (349) can be
ˆN and
used without any remarks in all the cases when ˆa2
1/ ˆN one should remember that the depth of focus becomes longer than
ˆz2
ˆa2
the distance between the image and the focal plane, this case corresponding the
situation when an image of the virtual source is formed in the focal plane. In
1/ ˆN instead, we have coherent illumination of the pupil.
all cases when ˆa2
ˆz2
The diﬀraction limited depth of focus becomes longer than the Geometrical
Optics prediction of the depth of focus and, for estimations, one should use
Eq. (350) in place of Eq. (349).

1/ ˆN . When ˆa2
ˆz2

≫

≫

≪

≪

≪

148

14

Solutions to the image formation problem for non-homogeneous
undulator sources

We will now consider non-homogeneous undulator sources. The next Section
14.1 will deal with the case of a horizontally quasi-homogenous and vertically
non-homogeneous source. Special emphasis will be given to the study of this
situation, which is relevant for the majority of Synchrotron Radiation sources
of the third generation. In the following Section 14.2 we will discuss, instead,
the case of a horizontally non-homogeneous and vertically diﬀraction limited
source. These two cases practically deal with all third generation light sources,
from the soft to the hard X-rays.

Our treatment is based on the assumption that the beta functions have minima
in the center of the undulator. Placing the virtual source in the center of the
undulator, we will obtain a particularly simple expression for the cross-spectral
density of the source and its Fourier transform. In particular, calculations will
yield real results. Statistical Optics methods conjugated to Fourier Optics
will allow us to give explicit presentations of the cross-spectral density and
its Fourier transform at the virtual source position. Such presentations will
account for all complexities of the source, intrinsic properties of undulator
radiation and electron-beam phase space distribution. Based on our previous
work [2], we will ﬁrst calculate the cross-spectral density ˆG in the far zone
limit. Then, with the help of Eq. (127), we will be able to recover the Fourier
transform of the cross-spectral density ˆ
at the virtual source position. By
G
inverse transforming that expression we will ﬁnally recover the cross-spectral
density as well.

In general, we cannot give an explicit expression for the cross-spectral den-
sity at any observation plane. In other words, as before, Eq. (133) cannot be
calculated explicitly for any value of ˆz1 and ˆz2. However, once the center of
the undulator is ﬁxed as the virtual source position, there exists a privileged
observation plane. This is the plane where the center of the undulator is im-
aged and depends on the position ˆz1 chosen for the lens. Throughout this
paper we simply called it the image plane. Starting from the expression for
the cross-spectral density and its Fourier transform at the virtual source we
will be able to calculate, for any choice of ˆz1, the cross-spectral density on the
focal (ˆz2 = ˆzf ) and on the image (ˆz2 = ˆzi) plane. The procedure that we will
use to perform these calculations is similar to what has been proposed in the
case of homogeneous sources and will take advantage of Eq. (131) and Eq.
(132).

As usual, we will begin our investigations neglecting pupil eﬀects. Results for
a large non-limiting aperture on the image plane will be generalized to include
eﬀects of the pupil with the help of Eq. (135). Finally, in Section 14.3 we will

149

^

M

1,00

0,75

0,50

0,25

0,00

-0,25

0

5

4

3

2

1

2

3

1

4

5

0

Fig. 42. Plot of the universal function ˆM , used to calculate the cross-spectral density
at the focal plane when ˆNx ≫
critically discuss the assumptions made throughout this paper and see how
and up to what extent they can be relaxed.

1, ˆNy and ˆDy are arbitrary.

1, ˆDx ≫

14.1 Horizontally quasi-homogenous and vertically non-homogeneous source

14.1.1 Large non-limiting aperture

1, but allow ˆDy and ˆNy
Let us ﬁrst retain the assumption ˆDx ≫
to assume arbitrary values. Eq. (141) allows the reconstruction of the vertical
cross-spectral density in the far zone. Note that, when both ˆNy . 1 and
ˆDy . 1 the source is non-homogeneous. In this case the far zone limit is for
values ˆzo ≫

1 and ˆNx ≫

1, and one obtains

ˆG(ˆzo, ¯θy, ∆ˆθy) = exp

i2¯θy ˆzo∆ˆθy
h

i

exp

2 ˆNy∆ˆθ2
y

−
h

i

150

∞

×

Z−∞

d ˆφy exp

(¯θy + ˆφy)2
2 ˆDy

"−

M( ˆφy, ∆ˆθy) ,
#

(353)

where the function ˆM(α, δ) is the normalized version of a universal function
ﬁrst deﬁned in [2] and reads:

ˆM (α, δ) =

3
8√π

∞

Z−∞

d ˆφxsinc

ˆφ2
x + (α
4

"

−

δ)2

ˆφ2
x + (α + δ)2
4

.

#

sinc

#

"

(354)

A plot of the ˆM function is given in Fig. 42. The ˆM function is a real function.
Another remarkable property of ˆM is its invariance for exchange of α with δ.
Also, ˆM is invariant for exchange of α with
δ). The following
relations between universal functions hold:

α (or δ with

−

−

ˆIS(α) = ˆM (α, 0) ,

β(δ) =

dξ ˆM(ξ, δ)

1
2π2

∞

Z−∞

and

γ(x) =

dξ exp [

i2xξ] ˆM (ξ, 0) .

−

1
2π2

∞

Z−∞

Using Eq. (127) and Eq. (353) we obtain the Fourier transform of the cross-
spectral density at ˆzo = 0 at the virtual source position

(0, ¯u, ∆ˆu) = exp

2 ˆNy∆ˆu2

d ˆφy exp

ˆ
G

−
h

∞

Z−∞
i

(¯u + ˆφy)2
2 ˆDy

#

"−

ˆM( ˆφy, ∆ˆu) .

Inverse transforming Eq. (358) we obtain the cross-spectral density at the
virtual source position

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

d ˆφ exp

(∆ˆy, ˆφ) .

(359)

∞

Z−∞
i

−
h

(¯y + ˆφ)2
2 ˆNy

ˆ
M

#

"−

In analogy with Eq. (126), we deﬁned ˆ
M

as

151

(355)

(356)

(357)

(358)

^

M

0,25

1,00

0,75

0,50

0,00

-0,25

0

1

2

x

 

3

3

2

4

1

y

5

0

5

4

Fig. 43. Plot of the universal function ˆ
M
1, ˆDx ≫
at the image plane when ˆNx ≫

, used to calculate the cross-spectral density
1, ˆNy and ˆDy are arbitrary.

(x, y) =

ˆ
M

8√π
3

1
2π2

∞

∞

Z−∞

K

Z−∞

−

dα

dδ exp [

2i(αx + δy)] ˆM (α, δ) ,

(360)

K

is given in Eq. (174). A plot of ˆ
is presented in Fig. 43. Note that
where
M
the symmetry of ˆM for exchange of α with
δ implies that
ˆ
is a real function. This fact, together with Eq. (359), implies that ˆG at
M
the virtual plane, that is an ensemble-averaged ﬁeld product, is real as well.
This is a consequence of the fact that single particle sources produce a ﬁeld
characterized by a plane wavefront at the virtual source position. It can be
seen comparing Eq. (36) with Eq. (94) or, directly, by inspecting Eq. (97).
Moreover, note that ˆ
M

is invariant for the exchange of x with y.

α or δ with

−

−

From Eq. (131) and Eq. (358) we obtain the cross-spectral density on the focal
plane in the vertical direction, that is

152

ˆG(ˆzf , ¯yf , ∆ˆyf ) = exp

2i
ˆf 2

"
∞

ˆf

−

(cid:16)
d ˆφy exp



−

ˆz1

¯yf ∆ˆyf

exp

#
(cid:17)

(¯yf / ˆf + ˆφy)2
2 ˆDy

#

"−

2 ˆNy∆ˆy2
f
ˆf 2



ˆM

ˆφy,

 


∆ˆyf
ˆf !

.

×

Z−∞

In the vertical direction, the relative intensity on the focal plane is therefore
given by

ˆI(ˆzf , ¯yf ) =

d ˆφy exp

"−

∞

d ˆφy exp

∞

Z−∞

× 


Z−∞



(¯yf / ˆf + ˆφy)2
2 ˆDy
ˆφ2
y
2 ˆDy

ˆIS

−



(cid:16)

#

ˆφy

ˆIS

ˆφy

(cid:17)

(cid:16)
−1

,




(cid:17)







because ˆIS( ˆφy) = ˆM ( ˆφy, 0). In the limit ˆDy ≪


1, Eq. (362) reduces to

ˆI(ˆzf , ¯yf ) = ˆIS

¯yf
ˆf !

.

 

The modulus of the spectral degree of coherence on the focal plane in the
vertical direction reads

g(ˆzf , ¯yf , ∆ˆyf )

= exp

ˆNy
ˆf 2

∆ˆy2
f

#

2
"−
∞

d ˆφy exp

(¯yf / ˆf + ˆφy)2
2 ˆDy

ˆM

ˆφy,

#

 

∆ˆyf
ˆf !

"−

d ˆφy exp

(¯yf / ˆf + ∆ˆyf / ˆf + ˆφy)2
2 ˆDy

"−

ˆIS( ˆφy)
#

d ˆφy exp

"−

(¯yf / ˆf

−

∆ˆyf / ˆf + ˆφy)2
2 ˆDy

#

ˆIS( ˆφy)

.

×

Z−∞

∞

Z−∞
∞

Z−∞

× 



× 




In the limiting case for ˆDy ≪

1 one obtains the simpliﬁed expression

|

|

|

|

g(ˆzf , ¯yf , ∆ˆyf )

= exp

ˆNy
ˆf 2

2
"−

∆ˆy2
f

χ

#

 

¯yf
ˆf

,

∆ˆyf
ˆf !

,

153

(361)

(362)

(363)

−1/2

−1/2











(364)

(365)

1,0

0,5

0,0

-0,5

-1,0

0

5

4

3

2

1

2

3

1

4

5

0

Fig. 44. Plot of the universal function ˆχ, used to calculate the modulus of the
spectral degree of coherence on the focal plane when ˆNx ≫
1 and
ˆDy ≪

1, ˆDx ≫

1, ˆNy ≪

1.

where, as in Eq. (145) of [2],

χ(α, δ) =

ˆM(α, δ)
1/2

1/2 .

ˆIS(α
h

δ)

−

i

ˆIS(α + δ)
h

i

A plot of χ is given in Fig. 44. Eq. (364) reduces even more in the case when
both ˆDy ≪

1 and ˆNy ≪

1. In this case we have

g(ˆzf , ¯yf , ∆ˆyf )

= χ

|

|

¯yf
ˆf

,

∆ˆyf
ˆf !

.

 

On the image plane, Eq. (132) and Eq. (359) give the following cross-spectral
density in the vertical direction:

154

(366)

(367)

ˆG(ˆzi, ¯yi, ∆ˆyi) = exp

∞

im(m + 1)¯yi∆ˆyi
2ˆz1

"
(m∆ˆyi, ˆφ) exp

d ˆφ exp

#
Z−∞
2 ˆDym2∆ˆy2
i

"−

,

−
h

i

ˆ
M

×

(m¯yi + ˆφ)2
2 ˆNy

#

corresponding to a relative intensity on the image plane

ˆI(ˆzi, ¯yi) =

d ˆφ exp

"−

∞

d ˆφ exp

(m¯yi + ˆφ)2
2 ˆNy
ˆφ2
2 ˆNy #

"−

(0, ˆφ)

ˆ
M

#

(0, ˆφ)

ˆ
M

∞

Z−∞

× 


Z−∞



−1

.






With the help of Eq. (360), Eq. (356) and Eq. (174) one sees that

(368)

(369)

(0, y) =

ˆ
M

1
2π2

∞

Z−∞

K

∞

Z−∞

−





= ˆ
B

(y) .





dδ

exp [i(

2δ)y]

dα ˆM(α, δ)

(370)

The solution of the image formation problem is thus constituted by a con-
volution product between a Gaussian function and the universal function ˆ
,
B
which admits the analytical representation given in Eq. (186). The intensity
on the image plane is independent of the value of ˆDy. In the limit ˆNy ≫
1 Eq.
(369) gives back Eq. (169). Instead, in the limit ˆNy ≪

1 we obtain

ˆI(ˆzi, ¯yi) = ˆ
M

(0, m¯yi) = ˆ
B

(m¯yi) .

(371)

The modulus of the spectral degree of coherence in the vertical direction is
given by

g(ˆzi, ¯yi, ∆ˆyi)

=

|

|

(m¯yi + ˆφ)2
2 ˆNy

#

∞

d ˆφ exp

Z−∞

ˆ
M

×

"−
(m∆ˆyi, ˆφ) exp
∞

d ˆφ exp

−

2 ˆDym2∆ˆy2
i
h
(m¯yi + m∆ˆyy + ˆφ)2
2 ˆNy

i

(0, ˆφ)

ˆ
M

#

d ˆφ exp

(m¯yi −

m∆ˆyy + ˆφ)2
2 ˆNy

(0, ˆφ)

ˆ
M

#

Z−∞
∞

Z−∞

× 



× 




−1/2

−1/2

.











(372)

In the case ˆDy ≪

1 and ˆNy ≪

1 one obtains

"−

"−

155

1,0

0,5

0,0

-0,5

-1,0

0

3

2

(373)

(374)

1

1

y

2

x

3

0

Fig. 45. Plot of the universal function X, used to calculate the modulus of the
1, ˆNy ≪
spectral degree of coherence on the image plane when ˆNx ≫
1
and ˆDy ≪

1, ˆDx ≫

1.

g(ˆzi, ¯yi, ∆ˆyi)

= X (m∆ˆyi, m¯yi)

|

|

where, in analogy with Eq. (366), we deﬁne

X(x, y) =

(x, y)

ˆ
M
1/2

1/2 .

ˆ
(x
B

−

y)

i

h

ˆ
(x + y)
B
h

i

1 and ˆDy assumes arbitrary values, the modulus of the
Note that when ˆNy ≫
spectral degree of coherence, Eq. (372), simpliﬁes to Eq. (170). A plot of the
universal function X is given in Fig. 45.

14.1.2 Eﬀect of aperture size

We will now include, with the help of Eq. (135), the eﬀects of pupil in the
one-dimensional case. The pupil function and ˆ
are given by Eq. (224) and
P
Eq. (225). The r-direction should be now substituted with the y-direction.

156

We can use condition (136) and Eq. (368) to describe the case when the
lens is in the far zone. From Eq. (368) we can estimate the order of the
ˆNy], and the order of the coherence length,
source dimension, that is max[1,

q

q

q

ˆNy]/ˆz1

that is min[1/

ˆDy, 1]. The lens is in the far zone when max[1,
≪
ˆDy, 1]. Note that several particular cases of interest are automatically
max[
included in this condition: the case for ˆDy ≫
1, that gives
ˆDy,
ˆNy/ ˆDy, the case for ˆDy ≫
ˆz1
1/
as well as the case for ˆDy . 1 and ˆNy ≫
ˆNy. All these
situations have been previously discussed in Section 5. The new situation left
to consider is for ˆNy ∼
1. In this case, the lens is in the far ﬁeld
when ˆz1
≫

1 and ˆNy ≫
1 and ˆNy . 1, that gives ˆz1
1, that gives ˆz1

1. From Eq. (135) and Eq. (368) we obtain

1 and ˆDy ∼

≫

≫

≫

q

q

q

q

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

¯yi∆ˆyi

d¯u d∆ˆu exp

2 ˆDy ˆz2

1∆ˆu2

2im
ˆz1

(cid:20)

∞

×

Z−∞

2

(cid:21) Z
ˆφ + ˆz1 ¯u
2 ˆNy

(cid:17)



ˆ
M

−
h
(ˆz1∆ˆu, ˆφ)

− (cid:16)

d ˆφ exp 


(¯yi + ∆ˆyi)

ˆa

sinc

×

×

sinc

ˆa

(cid:26)

(cid:20)

(cid:26)

(cid:20)

m
ˆz1
m
ˆz1



¯u
−

∆ˆu

−

−

(cid:21)(cid:27)

(cid:21)(cid:27)

(¯yi −

∆ˆyi)

¯u + ∆ˆu

.

i

(375)

1 max[1, ˆDy] is of order of the square of the radiation
According to Eq. (353), ˆz2
1/ max[ ˆNy, 1] is of order of the square of the
spot size on the pupil, while ˆz2
coherence length on the pupil. It is interesting to see that if ˆDy ≫
1 the
exponential function in ∆ˆu has a very narrow characteristic length with respect
(0, ˆφy) =
to unity, and one can make the substitution ˆ
M
−→
1 instead, ˆφy can be set to zero
( ˆφy), thus getting back Eq. (256). If ˆNy ≫
ˆ
B
in the exponential function in ˆφy + ˆz1 ¯u, and the entire exponential function
can be taken out of the integral in d ˆφy. Then, it is possible to show that the
surviving integral in d ˆφy is equal to γ(ˆz1∆ˆu), giving back Eq. (250). Finally,
if both ˆNy ≫
1 we get back Eq. (226).
Eq. (375) should be considered as a limiting case when no aberrations are
present. More generally, when aberrations and apodization are present, Eq.
(375) should be substituted by the following expression:

1 and ˆDy ≫

(ˆz1∆ˆu, ˆφy)

ˆ
M

ˆGP (ˆzi, ¯yi, ∆ˆyi) = 4ˆa2 exp

¯yi∆ˆyi

d¯u d∆ˆu exp

2 ˆDy ˆz2

1∆ˆu2

2im
ˆz1

(cid:20)

∞

×

Z−∞

d ˆφ exp 



− (cid:16)

2

(cid:21) Z
ˆφ + ˆz1 ¯u
2 ˆNy

(cid:17)

ˆ
M






−
h
(ˆz1∆ˆu, ˆφ)

i

157

ˆ
Pa
ˆ
Pa

×

×

(cid:20)
∗

m
ˆz1
m
ˆz1

(cid:20)

(¯yi + ∆ˆyi)

−

¯u

∆ˆu

−

(cid:21)
¯u + ∆ˆu

.

(cid:21)

(¯yi −

∆ˆyi)

−

(376)

(377)

(378)

Eq. (376) is very general and is valid under the only assumption that the
lens is in the far ﬁeld region. The use of old coordinates ˆyi1 and ˆyi2 instead
of ¯yi and ∆ˆyi somewhat clariﬁes the meaning of Eq. (376). Eq. (376) states
that the cross-spectral density accounting for the pupil inﬂuence (aberrations
and diﬀraction eﬀects) is a double convolution product of Eq. (368), i.e. the
cross-spectral density in the ideal case, and ˆ

Pa, which can be written as

ˆGP (ˆzi, ˆyi1, ˆyi2) =
=

ˆE(ˆu1) ˆE∗(ˆu2)
ˆ
ˆE
(ˆyi1)
Pa

∗

i

ˆ
Pa(ˆu1)
ˆ
∗
a
P
∗

i

∗
ˆE∗
E
h

hD

Dh

ˆ
∗
a (ˆu2)
∗
P
.
(ˆyi2)

i

E

(ˆyi1, ˆyi2)

The intensity at the image plane is found setting ˆyi1 = ˆyi2 = ˆyi, which gives

ˆIP (ˆzi, ˆyi) =

ˆE(ˆu1) ˆE∗(ˆu2)
2
ˆ
ˆE
Pa

(ˆyi)

∗

∗
.

E

(cid:29)

(cid:12)
(cid:12)
(cid:12)

=

hD

(cid:28)(cid:12)
(cid:12)
(cid:12)

ˆ
Pa(ˆu1)

∗

ˆ
∗
a(ˆu2)
P

(ˆyi, ˆyi)

i

In particular, in the case of a completely coherent source, we may neglect the
ensemble average.

Note that in order to evaluate the intensity at the image plane, it is no more
enough to know the ideal intensity and to convolve with a line spread function.
One has to know the cross-spectral density in the ideal case and convolve twice
with ˆ
Pa, which is known as the amplitude line spread function of the system
(or the amplitude point spread function in the two-dimensional case) and is
a more general identiﬁer of the system characteristics. Even in the non quasi-
homogeneous case one may continue to use, for evaluating the intensity at the
image plane, an algorithm based on the calculation of ideal characteristics and
further convolution with a function characterizing the system. The diﬀerence
with respect to the quasi-homogeneous case is that the amplitude line spread
function must be used in place of the line spread function, and that the cross-
spectral density must be used in place of the intensity.

Note that, in our approach, the Wigner function plays no role, as it con-
stitutes an artiﬁcial quantity in the image formation problem, whereas the
natural quantity to consider is the cross-spectral density. Even if the virtual
source can be characterized by a phase space distribution (i.e. by a positive
Wigner function) one has no simpliﬁcation in the imaging problem. The only
simpliﬁcation of Eq. (378) takes place in the quasi-homogeneous case when,
due to the separability of the cross-spectral density variables and to a short

158

coherence length (compared with the size of the source), one obtains the usual
incoherent line spread function formalism.

14.2 Horizontally non-homogeneous and vertically diﬀraction limited source

We will now relax the assumption of a large horizontal electron beam size
and divergence and deal with the non-homogeneous case when ˆNx assumes
arbitrary values, while ˆDx ≪
1. This is a rather exotic range of parameters,
and we will discuss the case for a large non-limiting aperture only. In this case,
for third generation light sources we have automatically ˆNy ≪
1 and ˆDy ≪
1
24 . In this case, in the limit ˆzo ≫
because ǫy ≪
1, from Eq. (124) we obtain

ǫx

ˆG = exp

i2¯θx∆ˆθx ˆzo
(¯θx −
(cid:16)
sinc

(cid:17)

exp
∆ˆθx)2 + (¯θy −
4

−
h

"

2 ˆNx∆ˆθ2
exp
x
∆ˆθy)2
i

i2¯θy∆ˆθy ˆzo
(cid:16)
sinc

#

"

×

(cid:17)

(¯θx + ∆ˆθx)2 + (¯θy + ∆ˆθy)2
4

Using Eq. (127) and Eq. (379) one obtains the Fourier transform of the cross-
spectral density at ˆzo = 0, i.e. at the virtual-source position, that is given
by

0, ¯θx, ∆ˆθx, ¯θy, ∆ˆθy

= exp

2 ˆNx∆ˆθ2
x

sinc

ˆ
G

(cid:16)

(cid:17)

−

h

sinc

"

×

i

"
(¯θx + ∆ˆθx)2 + (¯θy + ∆ˆθy)2
4

.
#

(¯θx −

∆ˆθx)2 + (¯θy −
4

∆ˆθy)2

#

.

#
(379)

(380)

Inverse transforming Eq. (380) it is possible to express the cross-spectral den-
sity at the virtual source position as

ˆG(0, ¯x, ∆ˆx, ¯y, ∆ˆy) =

d¯θxd∆ˆθxd¯θyd∆ˆθy exp

2 ˆNx∆ˆθ2
x

−

h

i

∞

Z−∞

1, ˆNy arbitrary and ˆDy ≪

24 This treatment can be easily generalized to the more exotic situation for ˆNx
arbitrary, ˆDx ≪
1. However, here we will be concerned
with third generation light sources only. Assuming reasonable values for βx . 10 Lw
and ǫy = χǫx with χ
1.
Therefore we will avoid to make generalizations which are not pertinent to the case
under study, e.g. exotic case for βx > 10 Lw, βy < 10−1 Lw or βy > 10 Lw.

10−2 we see that ˆDx ≪

1 implies both ˆNy ≪

1 and ˆDy ≪

≃

159

∆ˆθy)2

∆ˆθx)2 + (¯θy −
(¯θx −
4
(¯θx + ∆ˆθx)2 + (¯θy + ∆ˆθy)2
4

#

#

sinc

"

sinc

"
exp

×

×

×

2i(∆ˆθx ¯x + ¯θx∆ˆx)
h

i

exp

2i(∆ˆθy ¯y + i¯θy∆ˆy)
h

.
(381)
i

From Eq. (131) and Eq. (380) we obtain the cross-spectral density on the focal
plane

ˆG(ˆzf , ¯xf , ∆ˆxf , ¯yf , ∆ˆyf ) = exp

2 ˆNx
ˆf 2

∆ˆx2
f

#

2i
ˆf 2

"

ˆf

−

ˆz1

¯xf ∆ˆxf

exp

#

"−

#

(cid:17)

(cid:16)

(cid:17)
ˆz1

(cid:16)
2i
ˆf
¯yf ∆ˆyf
ˆf 2
−
∆ˆxf )2 + (¯yf −
(¯xf −
4 ˆf 2
(¯xf + ∆ˆxf )2 + (¯yf + ∆ˆyf )2
4 ˆf 2

∆ˆyf )2

#

.
#

exp

"

sinc

sinc

"

"

×

×

×

The relative intensity on the focal plane is therefore given by

ˆI(ˆzf , ¯xf , ¯yf ) = sinc2

f + ¯y2
¯x2
f
4 ˆf 2

.
#

"

This is just the relative intensity on the focal plane from a single electron, i.e.
Eq. (91). It is interesting to note that the modulus of the spectral degree of
coherence on the focal plane depends on ∆ˆxf only, and can be written as

g(ˆzf , ¯xf , ∆ˆxf , ¯yf , ∆ˆyf )

= exp

|

|

2 ˆNx
ˆf 2

"−

∆ˆx2
f

.

#

In the limit ˆNx ≪
g
this limit
|

|

1 one recovers the deterministic case of a single particle. In

reduces to unity, and the wavefront is perfectly coherent.

As regards the image plane, we should note that Eq. (381) is not easy to
manipulate analytically in the most general case. However, when ∆ˆx = 0 and
∆ˆy = 0, one can calculate the intensity of the virtual source. With the help
of Eq. (175) and Eq. (181) one obtains

160

(382)

(383)

(384)

ˆI(0, ¯x, ¯y) =

d ˆφxd exp

∞

Z−∞

(¯x + ˆφx)2
2 ˆNx

#

"−

˜Ψ( ˆφx, ¯y) ,

where we have set

˜Ψ(x, y) = Ψ

x2 + y2

.

(cid:18)q

(cid:19)

The function Ψ was already deﬁned in Eq. (95). Using Eq. (132) and Eq. (385)
we can now give the following expression for the relative intensity:

ˆI(ˆzi, ¯xi, ¯yi) =

d ˆφx exp

"−

∞

d ˆφx exp

(m¯xi + ˆφx)2
2 ˆNx
ˆφ2
x
2 ˆNx #

"−

˜Ψ( ˆφx, m¯yi)
#

−1

˜Ψ( ˆφx, 0)

.

∞

Z−∞

× 


Z−∞








In the limit ˆNx ≪

1 we have

ˆI(ˆzi, ¯xi, ¯yi) = m2 ˜Ψ(m¯xi, m¯yi) ,

in agreement with Eq. (96).

14.3 General imaging considerations

(385)

(386)

(387)

(388)

In the present Section 14.3 we discuss a general algorithm for the solution to
the image formation problem for undulator sources based on our Statistical
Optics approach.

Eq. (376) is an expression for the cross-spectral density on the image plane
in the case of a non-homogeneous undulator source and of a lens with an
arbitrary pupil function (i.e. a lens with aberrations, apodization and ﬁnite
aperture size). However, we assumed that the electron beam has (i) a Gaussian
transverse proﬁle and (ii) a large horizontal emittance compared with the
radiation wavelength ( ˆNx ≫
1), that (iii) the radiation frequency
is tuned at perfect resonance with the fundamental frequency of the undulator,
i.e. ˆC
1 25 , that (iv) the minimal beta functions in both horizontal and

1 and ˆDx ≫

≪

25 This means that monochromatization is good enough to neglect ﬁnite bandwidth
of the radiation around the fundamental frequency, as well as electron beam energy
spread.

161

vertical directions are located at ˆz = 0, that (v) there is no inﬂuence of
focusing inside the undulator, that (vi) the lens is placed in the far zone and,
ﬁnally, that (vii) the observation plane is located at position ˆz = ˆzi, where
the virtual source (that we assume at ˆz = 0) is imaged. Assumptions (i),
(ii), (iii), (iv) and (v) are related to the form of the cross-spectral density
at the virtual source plane, Eq. (359). They are very often, but not always
veriﬁed. Moreover they do not depend on the particular imaging setup related
with a given photon beamline. Assumptions (vi) and (vii) instead, are related
with the imaging setup i.e. with how the lens and the observation points are
positioned.

ǫy ≃

The majority of the assumptions from (i) to (vii) are often veriﬁed for third
generation light sources. As a matter of fact, our theory is speciﬁcally built to
deal with third generation light sources. However, a generalization to include
the case of spontaneous undulators installed in XFEL facilities (see e.g. [25],
[26]) is certainly desirable. Of all restrictions from (i) to (vii), (v) is the more
diﬃcult to be relaxed. In order to do so, one needs to modify the expression
for the single particle ﬁeld to account for the inﬂuence of focusing inside the
undulator. The other assumptions may be more easily relaxed, to give a more
general algorithm for the calculation of the cross-spectral density in the case
of arbitrary position of the lens (near or far zone). The case of spontaneous
undulators installed in XFEL facilities is a particular one when it is needed to
deal with both horizontal and vertical electron beam emittances comparable
0.3˚A. Results
or smaller than the radiation wavelength. In fact, ǫx ≃
based on a Gaussian model of the electron beam with generic ˆNx,y and ˆDx,y
may be presented. To this purpose one may use Eq. (124) to calculate the
cross-spectral density in free space. As one may see inspecting Eq. (124), it
is no more possible to separate the horizontal and the vertical direction. Eq.
(124) is still subject to assumptions (i), (iii), (iv) and (v). Our theory is built
by exploiting many simplifying assumptions. When some of them fail, one
should go back to the point where the invalid simpliﬁcation is exploited, and
use a more generic expression in its place. In particular, while assumption (i)
is quite realistic in the case if storage ring sources, it is to be regarded as a
conventional assumption when treating sources based on linear accelerators.
Our most generic expression, Eq. (114) should be used in place of Eq. (124)
if one wishes to relax assumption (i), as well as (iii) and (iv). Once the cross-
spectral density in free space is known through Eq. (124) or Eq. (114), one
may account for a generic observation plane, thus relaxing assumption (vii). To
this purpose one needs to put attention on the fact that any observation plane
located at position ˆz = ˆz2 is related with a certain plane at position ˆz = ˆzs in
front of the lens through the lens-maker equation, Eq. (21). The next step in
our algorithm consists in ﬁnding the cross-spectral density at ˆz = ˆzs, which
will be imaged at our chosen observation plane, located at ˆz = ˆz2. To this
purpose, Eq. (128) may be used. In fact, Eq. (128) describes the propagation
of the Fourier transform of the cross-spectral density, ˆ
, in free space. As we
G

162

have seen, the fact that the lens is placed in the far ﬁeld allows cancellation
of one phase factor in the relation between the cross-spectral density on the
image plane and the cross-spectral density on the virtual source plane. This
can be seen using condition (136) in Eq. (132). Such phase factor should be
retained if the lens is in the near zone (that is when condition (136) is not
satisﬁed). In this way, assumption (vi) can be relaxed as well. At this point,
the cross-spectral density ˆG(ˆzs,~¯r, ∆~ˆr) is known. The ﬁnal step consists in the
calculation of the amplitude point spread function ˆ
Pa of the system. The cross-
spectral density at position ˆz = ˆz2 is found convolving twice the product of
the cross-spectral density at the source plane and the extra phase-factor due
to the failure of condition (136) with the amplitude point spread function.
This gives

ˆGP (ˆz2,~¯r, ∆~ˆr) = 4ˆa2 exp

~¯r

∆~ˆr

d~¯u d∆~ˆu

·
∆~ˆu

2im
ˆz1
(cid:20)
2iˆz1~¯u
m
h
ˆz1
m
ˆz1

·
i
~¯r + ∆~ˆr
(cid:16)
(cid:17)
∆~ˆr
~¯r
(cid:16)
(cid:17)

−

exp

×

×

×

ˆ
Pa
ˆ
Pa

(cid:20)

∗

(cid:20)

(cid:21) Z
ˆG

ˆzs,
(cid:16)
~¯u
−

ˆz1~¯u,
−
∆~ˆu

−

ˆz1∆~ˆu

(cid:17)

−
(cid:21)
~¯u + ∆~ˆu

,

(cid:21)

−

(389)

where m is now deﬁned as m = (ˆz1

ˆzs)/(ˆz2

ˆz1), according to Eq. (22).

−

−

It should be noted that, in this paper, together with a theory for third gen-
eration light sources we also developed a particular language that can be
applied for a wider range of problems. Up to now, research works dealing
with transverse coherence properties of Synchrotron Radiation have used the
standard language developed to treat Statistical Optics problems. Such a lan-
guage has a very limited scope because Statistical Optics has mainly dealt
with thermal-like sources. As a result, a time domain approach has often been
used. Quasi-stationary approximation and ergodicity are usually assumed, so
that time averages are used instead of ensemble averages. Then, the concept
of cross-spectral purity [3, 8] must be forcefully evoked in order to separate
longitudinal and transverse coherence eﬀects, which are described through
the mutual intensity function. Such language though, is not suitable to de-
scribe Synchrotron Radiation experiments, where many radiation pulses are
collected and results are averaged over an ensemble. Our approach starts from
the very foundation of Statistical Optics, thus avoiding inconvenient assump-
tions. A language based on a frequency domain description and on ensemble
averages over an ensemble of radiation pulses (each corresponding to a diﬀer-
ent electron bunch) has been developed. In our paper we aimed at presenting a
satisfactory description of the physics involved in the characterization of light
sources from a statistical viewpoint, trying to exhaustively explain where the
main ideas come from and where they lead to. We restricted our attention

163

to a quantitative treatment of third-generation light sources but we also laid
the foundations to describe other kind of radiation sources, e.g. spontaneous
undulator sources installed in XFEL facilities. In fact, many of the features
of the relatively specialized setup considered in this work are common in the
general theory of undulator sources.

15 Supplementary remarks on quasi-homogeneous undulator source

asymptotes

1 and ˆNx ≫

In the last Section 14 we presented quite general results for vertically non-
homogeneous sources. Under the only assumption of a large horizontal emit-
tance ( ˆDx ≫
1), Eq. (353) speciﬁes the cross-spectral density
of the radiation in the far zone and in the vertical direction without con-
straints on ˆNy and ˆDy. Under the same conditions, Eq. (359) speciﬁes the
cross-spectral density of the virtual source in the vertical direction. Note that
Eq. (359) is a convolution. When the dependence of ˆG on ∆ˆy can be isolated
in a single factor, the source is forcefully quasi-homogeneous, while there are
no cases when it is described by a more generic kind of Shell model (i.e.
ˆG
I(y2)g(∆ˆy)). It is important to stress this fact in connection
with several research works [14, 15] devoting particular attention to the rela-
tion between the Gaussian-Shell model and undulator sources. As we remarked
in Section 7, Shell models (and, in particular, Gaussian-Shell models) may cer-
tainly be useful for describing light sources other than undulator-based ones
and for educational purposes, but they do not describe any practical realiza-
tion of undulator radiation sources.

I(y1)

∼

q

q

From Eq. (353), setting ∆ˆθy = 0, one obtains the intensity distribution in the
far zone

ˆI(¯θy) =

d ˆφy exp

∞

Z−∞

(¯θy + ˆφy)2
2 ˆDy

#

"−

ˆIS( ˆφy) ,

having used Eq. (355). From Eq. (359), setting ∆ˆy = 0, one gets the intensity
distribution of the virtual source in the center of the undulator 26 ,

ˆI(0, ¯y) =

d ˆφ exp

∞

Z−∞

(¯yy + ˆφ)2
2 ˆNy

"−

( ˆφ) ,
ˆ
B

#

26 We are always assuming that the minimal beta function of the electron beam is
located at the center of the undulator.

(390)

(391)

164

having taken advantage of Eq. (370). ˆIS in Eq. (390) and ˆ
in Eq. (391)
B
are the universal functions given in Eq. (160) and Eq. (186). Both Eq. (390)
and Eq. (391) are convolutions, and are valid regardless the values of ˆNy and
ˆDy, i.e. regardless the fact that the source is quasi-homogeneous or not. In
the case of a large non-limiting aperture and an ideal lens, other two exact
results can be found in Section 14, which are independent of the values of
ˆNy and ˆDy. In fact, Eq. (362) and Eq. (369) prove that the exact expression
for the intensity distribution is, both on the focal and on the image plane, a
convolution between Gaussian and universal functions.

When the source is quasi-homogeneous, with an accuracy scaling as the inverse
max[ ˆNy, 1] max[ ˆDy, 1], we may take the approximation
number of modes, 1/
ˆ
M

( ˆφ) in Eq. (359).
q

(∆ˆy, ˆφ)

γ(∆ˆy)

≃

B

This fact may be demonstrated as follows. First, let us introduce a normalized
version of the one-dimensional inverse Fourier transform of the function M,
that is

M ′(∆ˆy, ∆ˆθy) =

ˆM

¯θy, ∆ˆθy

exp

2i∆ˆy ¯θy

d¯θy

(cid:16)

(cid:17)

−
h

i

d¯y .

2i∆ˆθy ¯y
i
h

=

(∆ˆy, ¯y) exp

(392)

The normalization factor

in Eq. (392) is deﬁned as

∞

Z−∞
∞

1

A
1

Z−∞

A

ˆ
M

A

∞

=

A

Z−∞

ˆ
M

(0, ¯y) d¯y ,

(393)

so that M ′(0, 0) = 1. The cross-spectral density in Eq. (359) can therefore be
written as

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

−

∞
h

dˆu exp [

−

×

Z−∞

i
2iˆu¯y] exp

−
h

i

2 ˆNy ˆu2

M ′(∆ˆy, ˆu) ,

(394)

having used the convolution theorem. Under the quasi-homogeneous assump-
M ′(∆ˆy, 0)M ′(0, ˆu). To show this, let
tion, we can approximate M ′(∆ˆy, ˆu)
≃
us represent M ′(x, y) using a Taylor expansion around the point (0, 0). One
obtains

165

M ′(x, y) = 1 +

∞

1
k! 


Xk=1
+O(xy) ,

xk ∂kM ′(x, 0)
∂xk

+ yk ∂kM ′(0, y)

∂yk

x=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

y=0





(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

(395)

where the normalization relation M ′(0, 0) = 1 has been taken advantage
of. Similarly, one may consider the following representation of the product
M ′(x, 0) M ′(0, y) also obtained by means of a Taylor expansion:

M ′(x, 0)M ′(0, y) =

M ′(0, 0) +

"

× 

= 1 +

M ′(0, 0) +

∞

1
n! "
+yn dnM ′(0, y)

Xn=1

dyn

∞

Xk=1
∞

xk
dkM ′(x, 0)
dxk
k!
yj
djM ′(0, y)
dyj
j!
Xj=1
xn dnM ′(x, 0)
dxn

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

x=0#

y=0





x=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
+ O(xy) ,



y=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
having used M ′(0, 0) = 1. Comparison of the last equality in (396) with
M ′(x, 0)M ′(0, y) up
the right hand side of Eq. (395) shows that M ′(x, y)
≃
max[ ˆNy, 1] max[ ˆDy, 1], that is the quasi-
to corrections of order xy
homogeneous accuracy. Using this approximation in Eq. (394) yields
q

1/

∼



(396)

ˆG(0, ¯y, ∆ˆy) = exp
∞
h

−

2 ˆDy∆ˆy2

M ′(∆ˆy, 0)

i
2iˆu¯y] exp

dˆu exp [

−

×

Z−∞

2 ˆNy ˆu2

M ′(0, ˆu) .

−
h

i

(397)

Finally, recalling the deﬁnitions of γ and

we can write Eq. (397) as

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

γ(∆ˆy)

d ˆφ exp

−
h

i

(¯y + ˆφ)2
2 ˆNy

"−

( ˆφ) . (398)
ˆ
B

#

Eq. (398) is valid in any quasi-homogeneous case.

B

Note that Eq. (398) accounts for diﬀraction eﬀects through the universal func-
tions γ and
. This may be traced back to the use of the inhomogeneous wave
equation to calculate the cross-spectral density for the virtual source, from
which Eq. (398) follows. Deriving Eq. (398), we assume a large number of
modes, and this justiﬁes the use of phase space representation as an alterna-
tive characterization of the source, in place of the cross-spectral density (i.e.
Eq. (398) itself).

B

∞

Z−∞

166

Setting ∆ˆy = 0, Eq. (398) gives the exact intensity distribution at the vir-
tual source, i.e. Eq. (391). The spectral degree of coherence on the virtual
source is then recovered using the deﬁnition of quasi-homogeneous source
ˆG = ˆI(¯y)g(∆ˆy). Since the source is quasi-homogeneous, the Fourier trans-
form of the spectral degree of coherence g(∆ˆy) yields the intensity in the
far zone. Remembering that γ and IS form a Fourier pair, we conclude that,
starting from Eq. (398) it is possible to reproduce the exact result for the
intensity in the far zone, Eq. (390). Quite remarkably, Eq. (398), which is
derived under the quasi-homogeneous approximation and is related to an ac-
max[ ˆNy, 1] max[ ˆDy, 1], yields back two results, Eq. (390) and Eq.
curacy 1/
(391) which are valid regardless the fact that the source is quasi-homogeneous
or not. Moreover, in the case of perfect optics and non-limiting pupil aperture,
and independently of the quasi-homogeneous assumption, the intensity proﬁle
in the virtual plane reproduces the intensity proﬁle in the image plane, while
the intensity proﬁle in the far zone reproduces the intensity proﬁle in the focal
plane. Therefore, we can also conclude that Eq. (398) gives both the intensity
in the focal and in the image plane for an ideal lens. Note again that also these
two results, Eq. (362) and Eq. (369), have perfect accuracy. They are exact and
max[ ˆNy, 1] max[ ˆDy, 1].
are not subject to the quasi-homogeneous accuracy 1/

q

q

q

q

ˆDy ≪

Let us now consider the particular quasi-homogeneous case when both ˆNy ≫
1
and ˆDy ≫
1. In this case, the number of modes along the virtual source is of
ˆNy ˆDy and the normalized coherence length can be estimated as ˆξc ∼
order
1/
1. In the case of non-ideal optics, once a line spread function l for
the system is found, one may obtain the intensity distribution of the radiation
by convolving l with the ideal image. The accuracy of these calculations is now
ˆNy ˆDy. In the case a
the accuracy of the quasi-homogeneous assumption, 1/
pupil with aperture ˆa is present, we concluded in Section 8.1 that it makes
ˆDˆz1. In this case in fact,
sense to account for diﬀraction eﬀects when ˆa
the ratio between the width of the line spread function and the width of the
ˆNy ˆDy. As a result, when Eq. (398) is
1/
ideal image is of order ˆz1/(ˆa
used to calculate the ideal intensity, it makes sense to account for diﬀraction
eﬀects. Worsening the accuracy in the calculation of the cross-spectral density
of the source, we may reduce Eq. (398) to

≪ q

ˆNy)

≫

q

q

q

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

exp

−
h

i

¯y2
2 ˆNy #

,

"−

(399)

that is Eq. (146). Note that neglecting the product with the γ function can be
ˆDy, while extraction of the exponential function
done with an accuracy 1/
in ¯y from the convolution product with the
function can be done with an
accuracy 1/
1, the overall

ˆNy. In our study case when ˆDy ≫

1 and ˆNy ≫

q

B

q

167

q

q

q

ˆDy, 1/

ˆNy),
accuracy of Eq. (399) (or Eq. (146)) can be estimated as max(1/
that is the accuracy of the Gaussian approximation. Such accuracy is much
worse than that of the quasi-homogeneous assumption in Eq. (398), that is
ˆNy ˆDy. This fact has interesting consequences. In fact, Eq. (399) can ﬁrst
1/
be used to calculate the ideal intensity on the image plane and, then, it may be
convolved with the line spread function of the lens to give a characterization
of the intensity distribution with a reduced accuracy. If, for instance, ˆa
ˆNy)

ˆDˆz1 we can have situation when ˆz1/(ˆa

the intensity with accuracy 1/

≪
q
ˆNy and, as a result, accounting for diﬀraction eﬀects would not modify
ˆNy. In spite of this, going back to Eq. (398) to
ˆNy ˆDy, diﬀraction eﬀects
ˆNy ˆDy.

will appreciably modify the intensity within the accuracy 1/

calculate the ideal intensity with better accuracy 1/

ˆNy ˆDy but ˆz1/(ˆa

ˆNy)

q
1/

≫

≪

1/

q

q

q

q

q

q

1 the accuracy of the quasi-homogeneous ap-

When ˆNy ≫
proximation becomes 1/

1 and ˆDy ≃

q

ˆNy max[1, ˆDy]. When ˆNy ≃

1 it be-
max[1, ˆNy] ˆDy. In these cases, the accuracy of the quasi-
comes, instead, 1/
homogeneous approximation is comparable to the accuracy of the Gaussian
approximation. To be speciﬁc, when ˆNy ≫
1 the accuracy of the
ˆNy (note that the coherence
quasi-homogeneous approximation is of order 1/
length at the pupil is ˆξc ≃
1, that is the diﬀraction size) and Eq. (398) can be
substituted with

1 and ˆDy ≫

1 and ˆDy ≃

q

q

ˆG(0, ¯y, ∆ˆy) = exp

¯y2
2 ˆNy #

"−

exp

2 ˆDy∆ˆy2

γ(∆ˆy)

−

h

i

(400)

q

without loss of accuracy, because the relative accuracy of the convolution is
ˆNy as the accuracy of the quasi-homogenous approximation. Eq.
of order 1/
(400) is just Eq. (162). A similar reasoning can be done when ˆDy ≫
1 and
ˆNy ≃
1. In this case the accuracy of the quasi-homogeneous approximation is
ˆDy (note that the coherence length at the pupil is ˆξc ≪
of order 1/
1, that
is much smaller than the diﬀraction size), and Eq. (398) can be substituted
with

q

ˆG(0, ¯y, ∆ˆy) = exp

2 ˆDy∆ˆy2

d ˆφ exp

∞

Z−∞
i

−
h

(¯y + ˆφ)2
2 ˆNy

"−

( ˆφ) .
ˆ
B

#

(401)

without loss of accuracy. In fact, neglecting the γ function in Eq. (398) is
equivalent to approximate the convolution in Eq. (390) with a Gaussian dis-
ˆDy, the same of
tribution, which can be done with an accuracy of order 1/
the quasi-homogenous approximation. Eq. (401) is just Eq. (188).

q

168

In closing this Section we should stress that, in the case of ideal lenses, the
intensity on the image plane, that is a scaled version of Eq. (391), is exactly
given by a convolution of a known universal function and the electron beam
proﬁle. In the case the electron beam proﬁle is unknown, one may measure
the intensity and deconvolve Eq. (391) in order to ﬁnd back the electron beam
proﬁle. In literature (see, for example, [27]) it is usually accepted that the
resolution of any electron beam size σ inferred from the measurement of the
radiation intensity distribution on the image plane is limited (in the case of an
ideal lens) by the diﬀraction size of the single particle undulator radiation, i.e.
the resolution is of order √λLw/(2πσ). However, we have seen that Eq. (391)
is an exact result. Therefore, any measurement of σ obtained by deconvolution
of Eq. (391) is only limited by the ﬁnite accuracy of the detector.

16 Conclusions

As has been remarked in [28]: ”[...] it is very desirable to have a way to model
the performance of undulator beamlines with signiﬁcant partial coherent ef-
fects, and such modelling would, naturally, start with the source. The calcu-
lation would involve the knowledge of the partial coherence properties of the
source itself and of how to propagate partially coherent ﬁelds through space
and through the optical components used in the beamline. [...] it is impor-
tant to recognize that, although most of these calculations are, in principle,
straightforward applications of conventional coherence theory (Born and Wolf,
1980; Goodman, 1985), there is not much current interest in the visible optics
community. [...] For example, even for the rather simple problem of diﬀrac-
tion by an open aperture with partially coherent illumination, we have found
published solutions only for circular and slit-shaped apertures and only for
sources consisting of an incoherently illuminated aperture of similar shape to
the diﬀracting aperture. Thus, there is no counterpart in these types of Fourier
Optics problem to the highly developed art of ray tracing in geometrical op-
tics, not is there anything as simple as a ray to which an exact system response
can be calculated.”. This program of development of Synchrotron Radiation
theory was formulated more than ten years ago. Operation of third generation
light sources also started in this period. This demonstrates that when third
generation light sources were born, it was immediately recognized that the
usual theory of Synchrotron Radiation was not adequate to describe them.
Yet, up to now, no theoretical progress has been made in that direction. The
present paper, as well as our previous work [2] are devoted to the realization
of the before mentioned program of development of Synchrotron Radiation
theory.

In [2] we described spatial coherence propertied of undulator radiation from
third-generation light sources in free space. In this paper we aim at an exten-

169

sion of [2]. Previous scientiﬁc works and textbooks postulate that the cross-
spectral density at the virtual undulator source can be described in terms of
a Gaussian-Shell model or, even more restrictively, that undulator sources are
perfectly incoherent. Such assumption is not adequate when treating third
generation light sources, because the vertical emittance is comparable or even
much smaller than the radiation wavelength (i.e. ǫy ≪
λ/(2π)) in a wide spec-
tral interval extending from the ˚Amstrong wavelength range up to the soft
X-rays.

In this work we combined Statistical Optics methods with Fourier Optics
techniques in order to describe in an analytical way the propagation of the
cross-spectral density of Synchrotron Radiation through a lens. In particular,
we focused our attention on the problem of ﬁnding both the intensity and the
spectral degree of coherence of undulator radiation at the focal and at the
image plane of the lens. Although our paper is not limited to this situation
alone, our main result deals with the quite generic case of a large normalized
horizontal emittance ǫx ≫
Our paper provides physical understanding of a setup of general interest and
we expect it to be useful for practical estimations in almost all range of the pa-
rameter space for third generation light sources. We expect that, in the future,
numerical codes fully capable of dealing with transverse coherence properties
of Synchrotron Radiation will also be developed, and will be capable of pro-
viding detailed analysis of particular experimental setups. Our theory will
be of help to developers of these codes because it provides both benchmarks
and partially manipulated equations for the ﬁeld correlation, simpler to treat
numerically than ﬁrst principle calculations and still reasonably generic.

λ/(2π) and an arbitrary vertical emittance ǫy.

Two basic non-restrictive assumptions made in our theory are the paraxial
approximation and the resonance approximation. The ﬁrst is justiﬁed by the
fact that we are treating an ultra-relativistic system. The second means that
we are working with an undulator composed of a large number of period
Nw ≫
1 and that we are interested in frequencies near the fundamental. This
allows to neglect the vertical polarization component of the ﬁeld and to treat
the ﬁeld within a scalar theory.

Analytical studies also required the introduction of some restrictive assump-
tions introduced in our theory, to be relaxed in the future. First, we assumed
that the beta functions in both directions have their minima in the center of
the undulator. However, beta functions are (or may be) often tuned around
the center of the undulator in cases of practical interest. Second, we assumed a
single converging thin lens with none or very speciﬁc pupil functions. However,
other shapes of the lens can be accounted for by means of numerical convolu-
tions between a more complicated complex pupil function and our fundamental
results referring to the case when inﬂuence of the pupil is negligible. Note that

170

the situation of a thin lens is often met in practice in the case of X-ray radi-
ation, as grazing incidence reﬂective optics is quite frequently used for image
formation in this spectral range. Third, we assumed that monochromatization
is good enough to neglect ﬁnite bandwidth of the radiation around the funda-
mental and also electron beam energy spread. Both these eﬀects may be taken
into account by an extension of this theory. However, in practical cases of in-
terest these restrictions are often met. For instance, a monochromator relative
bandwidth of 10−3 is suﬃcient to guarantee a reasonably narrow bandwidth
for undulators up to about 40 periods. Also, with this number of undulator
periods, such a monochromator guarantees small corrections to our results for
electron beams with a relative energy spread of 10−3 or better.

The three before mentioned assumptions are somewhat restrictive. However,
they are often met in practice and our theory can be extended to the case when
they are not met. A more restrictive assumption is that radiation frequency is
tuned at perfect resonance with the fundamental frequency of the undulator.
Although this last assumption is also often met in practice, our theory cannot
be easily extended to account for the situation when it is not satisﬁed because
the starting point for the calculation of the cross-spectral density is given by
an expression for the electric ﬁeld around the fundamental frequency.

As a ﬁnal remark, it should be said that we chose not to deal with bending
magnet sources in this paper. This is left for future investigations. However,
some estimates based on dimensional analysis suggest that, as discussed in
Section 7, Geometrical Optics treatments may be suﬃcient to describe in a
satisfactory way bending magnet radiation from third generation light sources.

To conclude, our paper constitutes, to our knowledge, the ﬁrst satisfactory
theory describing imaging of undulator sources by a single non-ideal lens. We
restrict ourselves to the analysis of a single lens for simplicity, the results
for more complicated optical systems involving a larger quantity of optical
elements being a straightforward extension of the present work.

171

Acknowledgements

The authors wish to thank Hermann Franz and Petr Ilinski for many useful
discussions, Jochen Schneider and Edgar Weckert for their interest in this
work.

References

[1] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, Paraxial Green’s
functions in Synchrotron Radiation theory, DESY 05-032, ISSN 0418-9833
(2005)

[2] G. Geloni, E. Saldin, E. Schneidmiller and M. Yurkov, ”Understanding
transverse coherence properties of X-ray beams in third generation Syn-
chrotron Radiation source”, DESY 05-109, ISSN 0418-9833 (2005)
[3] L. Mandel and E. Wolf, Optical Coherence and Quantum Optics, Cam-

bridge University Press, 1995

[4] C. Welnak, G.J. Chen, F. Cerrina, Nucl.Instr. Meth. A 347, 344-347

[5] O.Chubar and P.Elleaume, in Proc. of the 6th European Particle Accel-

erator Conference EPAC-98, 1177-1179 (1998)

[6] C.Chang, P.Naulleau and D.Attwood, Appl. Opt. 42, 2506-2512 (2003)
[7] C.Chang, P.Naulleau, E.Anderson and D.Attwood, Opt. Commun. 182,

[8] J. W. Goodman, Statistical Optics, John Wiley & Sons, Inc., 1985
[9] J. W. Goodman, Introduction to Fourier Optics, Mc Graw-Hill, 1968
[10] M. Yabashi, K. Tamasaku and T. Ishikawa, Phys. Rev. A 69, 023813

(1994)

25-34 (2000)

(2004)

[11] M. Yabashi, K. Tamasaku S. Goto and T. Ishikawa, J. Phys D: Appl.

Phys. 38 (2005) A11-A16

[12] T. Tanaka and H. Kitamura, J. Synchrotron Radiat. 8, 1221 (2001)
[13] F. Pfeiﬀer et al., Phys. Rev. Lett. 94, 164801 (2005)
[14] R. Co¨ısson, Applied Optics 34, No. 5, 904-908 (1995)
[15] R. Co¨ısson and S. Marchesini, J. Synchrotron Radiat. 4, 263 (1997)
[16] J.B. West and H.A. Padmore, ”Optical engineering”, in Handbook of
Synchrotron Radiation, Vol. 2, Elsevier Science Publishers B.V., 1987

[17] J.C. Dainty and R. Shaw, ”Image Science”, Academic Press, 1976
[18] E. L. O’Neill, ”Introduction to statistical optics”, Dover Publications Inc.,

2003

[19] F. Zernike, Physika, 5, 785-795 (1938)
[20] Applied Optics and Optical Engineering, edited by R. R. Shannon and

J. C. Wyant, Academic Press (1980)

172

Company, New York (1968)

2, 209-214 (1995)

University Press, 1999

[21] M. Born and E. Wolf, ”Principles of Optics”, 2nd rev. ed., MacMillan

[22] P. Ellaume, C Fortgang, C. Penel and E. Tarazona, J. Synchrotron Rad.

[23] D. Attwood, ”Soft X-rays and extreme ultraviolet radiation”, Cambridge

[24] J. E. Bjorkholm, ”EUV Lithography – The Successor of Optical Lithog-

raphy?”, in Intel Technology Journal Q3’98 (1998)

[25] P. Audebert et al., ”TESLA XFEL: First stage of the X-ray laser labora-
tory - Technical design report” edited by R. Brinkmann et al., Preprint
DESY 2002-167 (2002)

[26] M. Cornacchia et al., SLAC-PUB-10133 (2003)
[27] A. Hofmann, ”Diagnostics with Synchrotron Radiation”, CERN 98-04

(1998)

[28] M.R. Howells and M.M. Kincaid, ”The properties of undulator radiation”
in New Directions in Research with Third-Generation Soft X-Ray Syn-
chrotron Radiation Sources, Kluwer Academic Publishers, 315-358 (1994)

173

1

2

3

4

5

6

7

8

9

List of Figures

Single lens imaging system with an undulator source as object.

17

Illustration of the undulator geometry and of the observation
plane after the undulator.

Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real
(dashed line) and the imaginary (dash-dotted line) parts of
f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 1.

Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real
(dashed line) and the imaginary (dash-dotted line) parts of
f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 2.

Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real
(dashed line) and the imaginary (dash-dotted line) parts of
f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 5.

Comparison between f (ζ) = sinc(ζ 2/4) (solid line), the real
(dashed line) and the imaginary (dash-dotted line) parts of
f (ζ) = ˆzoS(0, ˆzo, ζ 2) at ˆzo = 10.

Universal function sinc2(α2/4) used to calculate (according
to Eq. (91)) the focal intensity of a single electron at the
fundamental harmonic at perfect resonance.

Universal function Ψ(α) used to calculate (according to Eq.
(96)) the intensity distribution on the image plane from
a single electron at the fundamental harmonic at perfect
resonance.

Comparison between the relative intensity for a single electron
at the image plane ˆIP , Eq. (109), the universal function Ψ, Eq.
(96), and the (Airy) diﬀraction pattern from a circular hole,
Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 1.

10 Comparison between the relative intensity for a single electron
at the image plane ˆIP , Eq. (109), the universal function Ψ, Eq.
(96), and the (Airy) diﬀraction pattern from a circular hole,
Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 5.

174

33

36

37

37

38

40

40

45

46

11 Comparison between the relative intensity for a single electron
at the image plane ˆIP , Eq. (109), the universal function Ψ, Eq.
(96), and the (Airy) diﬀraction pattern from a circular hole,
Eq. (110), as a function of mˆri. Here ˆa/ˆz1 = 10.

12 Measurement of the cross-spectral density of an undulator

source. (a) Young’s double-pinhole interferometer demonstrat-
ing the coherence properties of undulator radiation. Radiation
must be spectrally ﬁltered by a monochromator or detector
(not shown in ﬁgure). (b) In the quasi-homogeneous case the
fringe visibility V of the resultant interference pattern is equal
to the absolute value of the spectral degree of coherence:
V =

g

.

|

|

13 The universal function ˆIS, used to calculate the focal intensity

of a quasi-homogeneous source at ˆNx ≫
ˆNy ≫

1.

1, ˆDx ≫

1 and

14 Absolute value of the universal function γ, used to calculate,

on the image plane, the spectral degree of coherence of a
1, ˆDx ≫
quasi-homogeneous undulator source when ˆNx ≫
and ˆNy ≫

1.

1

15 The universal function ˆ
B

, used to calculate intensity on the
image plane of a quasi-homogeneous undulator source when
ˆNx ≫
1.

1 and ˆDy ≫

1, ˆDx ≫

16 Absolute value of the universal function β, used to calculate

coherence on the focal plane of a quasi-homogeneous undulator
1 and ˆDy ≫
source when ˆNx ≫
Illustration of a grating monochromator.

1, ˆDx ≫

1.

Image intensity for a quasi-homogeneous source, ˆIP , as a
function of ξ = ˆam¯ri/ˆz1, calculated with Eq. (233), for diﬀerent

values of the parameter p = ˆa
the one-dimensional image formation problem (slit aperture,
cylindrical lens).

ˆN/ˆz1. The plot illustrates

q

17

18

19 Upper plots: proﬁle of the pupil function P (slit aperture),

. Lower plots: autocorrelation function of the

together with ˆ
P
pupil, ˜P , together with

).

( ˜
P

F

20 The line spread l function in the presence of defocusing

aberration.

101

175

47

53

65

67

71

72

84

89

90

21 The line spread l function in the presence of coma aberration.

102

22 The line spread l function in the presence of both spherical

and defocusing aberrations.

23 The transfer function in the presence of defocusing aberration.

103

24 The transfer function in the presence of coma aberration.

104

25 The transfer function in the presence of both spherical and

defocusing aberrations.

26 The transfer function in the presence of defocusing aberration
(n = 2, b2 = 9π). Numerical techniques have been used to
calculate the exact autocorrelation function that is compared
to the analytical evaluation of the autocorrelation function in
the severe aberration asymptote.

102

105

112

27 An enlarged version of Fig. 26. Numerical techniques have

been used to calculate the exact autocorrelation function that
is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

113

28 The real part of the transfer function in the presence of coma
aberration (n = 3, b3 = 9π). Numerical techniques have been
use to calculate the exact autocorrelation function that is
compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

114

29 An enlarged version of Fig. 28. Numerical techniques have

been use to calculate the exact autocorrelation function that
is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

115

30 The imaginary part of the transfer function in the presence of
coma aberration (n = 3, b3 = 9π). Numerical techniques have
been use to calculate the exact autocorrelation function that
is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

116

31 An enlarged version of Fig. 30. Numerical techniques have

been use to calculate the exact autocorrelation function that
is compared to the analytical evaluation of the autocorrelation
function in the severe aberration asymptote.

117

176

32 The line spread function versus the reduced coordinate

on the image plane ¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe
defocusing aberration(n = 2, b2 = 9π) and comparison with
the geometrical optics prediction.

33 The line spread function versus the reduced coordinate

on the image plane ¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe
coma aberration (n = 3, b3 = 9π) and comparison with the
geometrical optics prediction.

34 The line spread function versus the reduced coordinate

on the image plane ¯r′′ = ˆa¯ri/( ˆdinbn) in the case of severe
spherical aberration (n = 4, b4 = 9π) and comparison with the
geometrical optics prediction.

120

35 Amount by which a geometrically traced ray departs from a

desired location in the image formed by an optical system.
The ordinate for each curve is the height at which the ray
intersects the image plane. The abscissa is the coordinate of
the ray at the pupil plane. n = 2 represents defocusing, n = 3
represents coma, and n = 4 represents spherical aberration
cases according to Eq. (287).

36 Geometry for a pinhole camera setup. S indicates the virtual

source plane.

37 The line spread function lpc with Ω = 0.5. In this case the
0, Eq. (311), is well-matched to the

asymptote for Ω
−→
numerical evaluations.

38 The line spread function lpc with Ω = 2. In this case the
0, Eq. (311), starts to diverge from

asymptote for Ω
numerical evaluations. The width of lpc is close to its minimum.

−→

39 The line spread function lpc with Ω = 10. An intermediate
.

situation between the two limits for Ω

0 and Ω

−→

−→ ∞

40 The line spread function lpc with Ω = 100. The asymptote in
Eq. (312) starts to match the numerical calculations. In the
limit Ω

they both merge to a rectangular function.

−→ ∞

41 Relative line spread function lpc/lpc(0) for diﬀerent values of

Ω.

177

118

119

121

124

129

130

131

132

133

42 Plot of the universal function ˆM , used to calculate the
cross-spectral density at the focal plane when ˆNx ≫
1,
ˆDx ≫

1, ˆNy and ˆDy are arbitrary.

43 Plot of the universal function ˆ
M
1, ˆNy and ˆDy are arbitrary.

, used to calculate the
cross-spectral density at the image plane when ˆNx ≫
1,
ˆDx ≫

44 Plot of the universal function ˆχ, used to calculate the modulus

of the spectral degree of coherence on the focal plane when
1 and ˆDy ≪
ˆNx ≫
45 Plot of the universal function X, used to calculate the modulus

1, ˆDx ≫

1, ˆNy ≪

1.

of the spectral degree of coherence on the image plane when
1 and ˆDy ≪
ˆNx ≫

1, ˆDx ≫

1, ˆNy ≪

1.

150

152

154

156

178

