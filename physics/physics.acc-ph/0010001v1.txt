0
0
0
2

 

p
e
S
0
3

 

 
 
]
h
p
-
c
c
a
.
s
c
i
s
y
h
p
[
 
 

1
v
1
0
0
0
1
0
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

LARGE-SCALE SIMULATION OF BEAM DYNAMICS IN HIGH

INTENSITY ION LINACS USING PARALLEL SUPERCOMPUTERS∗

Robert D. Ryne and Ji Qiang, LANL, Los Alamos, NM 87545, USA

Abstract

In this paper we present results of using parallel supercom-
puters to simulate beam dynamics in next-generation high
intensity ion linacs. Our approach uses a three-dimensional
space charge calculation with six types of boundary con-
ditions. The simulations use a hybrid approach involving
transfer maps to treat externally applied ﬁelds (including
rf cavities) and parallel particle-in-cell techniques to treat
the space-charge ﬁelds. The large-scale simulation results
presented here represent a three order of magnitude im-
provement in simulation capability, in terms of problem
size and speed of execution, compared with typical two-
dimensional serial simulations. Speciﬁc examples will be
presented, including simulation of the spallation neutron
source (SNS) linac and the Low Energy Demonstrator Ac-
celerator (LEDA) beam halo experiment.

1

INTRODUCTION

The high intensity of future accelerator-driven systems
places stringent requirements on the allowed beam loss,
since very small fractional losses at high energy can pro-
duce unacceptably high levels of radioactivity. Previous
studies suggest that the low density, large amplitude halo
of the beam is a major issue for these systems [1, 2, 3].
Large-scale simulations are an important tool for exploring
the beam dynamics, predicting the beam halo, and facilitat-
ing design decisions aimed at controlling particle loss and
meeting operational requirements.

The most widely used model for simulating intense
beams in ion rf linacs is represented by the Poisson-
Vlasov equations. These equations are often solved us-
ing a particle-in-cell (PIC) approach. In this paper we will
describe a parallel simulation capability that combines the
PIC method with techniques from magnetic optics, and we
will present results of using parallel supercomputers to sim-
ulate beam dynamics in high intensity ion rf linacs.

2 PHYSICAL MODEL AND
NUMERICAL METHODS

In the PIC approach a number of simulation particles,
called macroparticles, are used to solve (indirectly) the evo-
lution equations and model the charged particle dynamics.
The motion of individual particles in the absence of radia-

∗ Work supported by the DOE Grand Challenge in Computational Ac-
celerator Physics, Advanced Computing for 21st Century Accelerator
Science and Technology Project, and the Los Alamos Accelerator Code
Group using resources at the Advanced Computing Laboratory and the
National Energy Research Scientiﬁc Computing Center.

tion can be described by Hamilton’s equations,

d~q
dt

=

∂H
∂~p

,

d~p
dt

= −

∂H
∂~q

,

(1)

where H(~q, ~p, t) denotes the Hamiltonian of the system,
and where ~q and ~p denote canonical coordinates and mo-
menta, respectively. In the language of mappings we would
say that there is a (generally nonlinear) map, M, corre-
sponding to the Hamiltonian H, which maps initial phase
space variables, ζ i, into ﬁnal variables, ζ f , and we write

ζ f = Mζ i.

(2)

The potential in the Hamiltonian includes contributions
from both the external ﬁelds and the space-charge ﬁelds. In
the Poisson-Vlasov approach, discreteness effects are ne-
glected and the space charge is represented by a smoothly
varying mean ﬁeld. Typically, the Hamiltonian can be writ-
ten as a sum of two parts, H = Hext + Hsc, which corre-
spond to the external and space-charge contributions. Such
a situation is ideally suited to multi-map symplectic split-
operator methods [4]. A second-order-accurate algorithm
for a single step is given by

M(τ ) = M1(τ /2) M2(τ ) M1(τ /2) ,

(3)

where τ denotes the step size, M1 is the map correspond-
ing to Hext and M2 is the map corresponding to Hsc. This
approach can be easily generalized to higher order accuracy
using Yoshida’s scheme if desired [5].

The electrostatic scalar potential generated by the
charged particles is obtained by solving Poisson’s equation

∇2Ψ(r) = −ρ(r)/ǫ0.

(4)

where ρ is the charge density. We have developed a
Fourier-based transformation and an eigenfunction expan-
sion method to handle six different boundary conditions:
(1) open in all three dimensions; (2) open transversely and
periodic longitudinally; (3,4) round conducting pipe trans-
versely and open or periodic longitudinally; (5,6) rectangu-
lar conducting pipe transversely and open or periodic lon-
gitudinally. A discussion of the numerical algorithms for
solving the Poisson’s equation with these different bound-
ary conditions can be found in [8].

The charge density ρ on the grid is obtained by using
a volume-weighted linear interpolation scheme[6, 7]. Af-
ter the potential and electric ﬁeld is found on the grid, the
same scheme is used to interpolate the ﬁeld at the particle
locations. During the course of the simulation each step in-
volves the following: transport of a numerical distribution
of particles through a half step based on M1, solving Pois-
son’s equation based on the particle positions and perform-
ing a space-charge “kick” M2, and performing transport
through the remaining half of the step based on M1.

3 APPLICATIONS

We have applied the above 3D parallel PIC approach to an
early design of the SNS linac and to the proposed LEDA
beam halo experiment. Our simulation of the SNS linac
starts at the beginning of the DTL. The code advances par-
ticles through drift spaces, quadrupole ﬁelds and RF gaps.
The dynamics inside the gaps is computed using external
ﬁelds calculated from the electromagnetic code SUPER-
FISH [9]. A schematic plot of the SNS linac conﬁguration
used in this study is shown in Figure 1 [10]. It consists of
three types of RF structures: a DTL, a CCDTL, and a CCL.
There are a total of 425 RF segments in the linac. Figure 2
shows the rms transverse size (xrms, yrms) and the maxi-
mum transverse extent (xmax, ymax) of the bunched beam
in the linac with one set of errors. We see that the maxi-
mum particle amplitude is well-below the aperture size of
the linac. This margin is needed to operate the linac safely
and to avoid beam loss at the high energy end. The jump
in rms beam size between the DTL and CCDTL at 20 MeV
is due to a change of focusing period from 8βλ to 12βλ at
805 MHz.

are two-fold: ﬁrst, to study beam halo formation and test
our physical understanding of the phenomena, and second,
to evaluate our computational models and assess their pre-
dictive capability through a comparison of simulation and
experiment. Fig. 3 gives a schematic plot of the layout of
the experiment [11]. It consists of 52 alternating-focusing
quadrupole magnets with a focusing period of 41.96 cm.
The gradients of the ﬁrst four quadrupole magnets can be
adjusted to create a mismatch that excites the breathing
mode or the quadrupole mode. The transverse beam proﬁle
will be measured using a beam-proﬁle scanner. Fig. 4 and
Fig. 5 present simulation results of the transverse beam size
for the breathing mode and the quadrupole mode, plotted
at the center of the drift spaces between quadrupole mag-
nets, as a function of distance. The plots include both the
rms beam size and the maximum particle extent in the sim-
ulation. The physical parameters for the simulation were
I=100 mA, E=6.7 MeV, and f=350 MHz. The simula-
tion was performed using 100 million macroparticles with
a 128x128x256 (x-y-z) space-charge grid.

Figure 1: The SNS linac conﬁguration

Bore Radius
Xrms
Yrms
Xmax
Ymax

2.5

2

1.5

1

0.5

)

m
c
(

Figure 3: LEDA halo experiment layout

Yrms
Xrms
Ymax
Xmax

1

0.8

0.6

0.4

0.2

0

0

2

4

6

distance (m)

8

10

12

)

m
c
(
 
t
n
e
m
e
c
a
p
s
d

i

l

0

0

200

400

600
Kinetic Energy (MeV)

800

1000

Figure 4: Transverse beam size as a function of distance
for the breathing mode in the LEDA halo experiment

Figure 2: Transverse beam size as a function of kinetic en-
ergy in the SNS linac

In the LEDA beam halo experiment, a mismatched
high-intensity proton beam will be propagated through a
periodic focusing transport system and measurements will
be made of the beam proﬁle. The goals of the experiment

From Fig. 4,

the two transverse components of the
breathing mode are in phase, while the quadrupole mode
in Fig. 5 has the two components out of phase. Evidently,
it will be possible in the experiment to clearly excite ei-
ther of the two modes. Furthermore, the debunching of
the beam will not signiﬁcanly alter the structure of the os-
cillations. Fig. 6 shows the accumulated one-dimensional

1

0.8

)

m
c
(
 
t

0.6

Xrms
Yrms
Xmax
Ymax

n
e
m
e
c
a
p
s
D

i

l

0.4

0.2

0

0

2

4

6

Distance (m)

8

10

12

Figure 5: Transverse beam size as a function of distance
for the quadrupole mode in the LEDA halo experiment

Breathing Mode
Quadrupole Mode

800000

700000

600000

500000

400000

300000

200000

100000

0
-0.008

-0.006

-0.004

-0.002

0

x (cm)

0.002

0.004

0.006

0.008

Figure 6: Accumulated density proﬁle along x for the
breathing mode and the quadrupole mode

density proﬁles (along x) for the breathing mode and the
quadrupole mode just after the magnet #49. The breath-
ing mode is more peaked and has a larger extent than the
quadrupole mode. Measurements will be taken at this loca-
tion and will be compared with our simulations. The data
in Fig. 6 are well-resolved over a range of about 6 decades.
An important piece of information from a design stand-
point is amount of charge beyond a speciﬁed radius or spa-
tial location as a function of distance along the accelerator.
This is shown graphically in Fig. 7 which shows the com-
plement of the horizontal and vertical cumulative density
proﬁles, at every step, when the quadrupole mode is ex-
cited. In other words, the contours describe the fraction of
charge that would be intercepted by a scraper placed at that
transverse position.

The above LEDA simulations used 100 million
macroparticles and a 3D Poisson solver, and required only
2 hours to execute on 256 processors. In contrast, beam
dynamics simulations performed on serial computers typi-
cally use 10,000 to 100,000 macroparticles and a 2D Pois-
son solver. Even if the above large-scale calculations could
be performed on a PC, they would require on the order of a
month to complete. In conclusion, while small-scale simu-

Figure 7: Horizontal and vertical cumulative density pro-
ﬁles of a quadrupole mode mismatch in the LEDA halo
experiment.

lations on serial computers are extremely valuable for rapid
design and predicting rms properties, large-scale simula-
tions are needed for high-resolution studies aimed at mak-
ing quantitative predictions of the beam halo.

4 ACKNOWLEDGMENTS

We thank the SNS linac design team and the LEDA beam
halo experiment team for helpful discussions. We also
thank S. Habib for helpful discussions and C. Thomas Mot-
tershead for graphics support.

5 REFERENCES

[1] R. L. Gluckstern, Phys. Rev. Lett. 73, 1247 (1994).
[2] T. P. Wangler, K. R. Crandall, R. Ryne, and T. S. Wang, Phys.

Rev. ST Accel. Beams 1, 084201 (1998).

[3] J. Qiang and R. D. Ryne, Phys. Rev. ST. Accel. Beams 3,

064201 (2000).

[4] E. Forest et al., Phys. Lett. A 158, 99 (1991).
[5] H. Yoshida, Phys. Lett. A 150, 262 (1990).
[6] R. W. Hockney and J. W. Eastwood, Computer Simulation

Using Particles, Adam Hilger, New York, 1988.

[7] C. K. Birdsall and A. B. Langdon, Plasma Physics Via Com-

puter Simulation, McGraw-Hill Book Company, NY, 1985.

[8] J. Qiang and R. Ryne, ”High Performance Particle-In-Cell
Simulation in a Proton Linac,” to be submitted to PRST-AB.
[9] J. H. Billen and L. M. Young, ”POISSON SUPERFISH”,

LANL Report LA-UR-96-1834 (revised Jan. 8, 2000).

[10] T. Bhatia et al., ”Beam Dynamics Design for the 1-GeV 2-

MW SNS Linac,” LANL Report LA-UR-99-3802, 1999.

[11] T. Wangler, ”LEDA Beam Halo Experiment-Physics and

Concept of the experiment,” LA-UR-00-3181, 2000.

