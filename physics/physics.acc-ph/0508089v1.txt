5
0
0
2
 
g
u
A
 
4
1
 
 
]
h
p
-
c
c
a
.
s
c
i
s
y
h
p
[
 
 
1
v
9
8
0
8
0
5
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

Recirculating BBU thresholds for polarized HOMs with optical coupling

Georg H. Hoﬀstaetter, Ivan V. Bazarov, and Changsheng Song
Laboratory for Elementary Particle Physics, Cornell University, Ithaca, New York 14853

Here we will derive the general theory of the beam-breakup instability in recirculating linear
accelerators with coupled beam optics and with polarized higher order dipole modes. The bunches
do not have to be at the same RF phase during each recirculation turn. This is important for the
description of energy recovery linacs (ERLs) where beam currents become very large and coupled
optics are used on purpose to increase the threshold current. This theory can be used for the
analysis of phase errors of recirculated bunches, and of errors in the optical coupling arrangement.
It is shown how the threshold current for a given linac can be computed and a remarkable agreement
with tracking data is demonstrated. The general formulas are then analyzed for several analytically
solvable cases, which show: (a) Why diﬀerent higher order modes (HOM) in one cavity can couple
and cannot be considered individually, even when their frequencies are separated by much more
than the resonance widths of the HOMs. For the Cornell ERL as an example, it is noted that
optimum advantage of coupled optics is taken when the cavities are designed with an x-y HOM
frequency splitting of above 50MHz. The threshold current is then far above the design current of
this accelerator. (b) How the x-y coupling in the particle optics determines when modes can be
considered separately. (c) That the increase of the threshold current obtainable by coupled optics
and polarized modes diminishes roughly with the square root of the HOMs’ quality factors. Therefore
the largest advantages are achieved with cavities that are not speciﬁcally designed to minimize these
quality factors, e.g. by means of HOM absorbers. (d) How multiple-turn recirculation interferes
with the threshold improvements obtained with a coupled optics. Furthermore, the orbit deviations
produced by cavity misalignments are also generalized to coupled optics. It is shown that the BBU
instability always occurs before the orbit excursion becomes very large.

I.

INTRODUCTION

is prevalent in the accelerator community.

In several applications of

linear accelerators the
charged particle beam passes through the accelerating
structures more than once after being lead back to the
entrance of the linac by a return loop. By this method the
linac can either add energy to electrons several times, or
it can recapture the energy of high energy electrons after
they have already been used for experiments. The former
technique is referred to as recirculating linac, the latter
as energy recovery linac (ERL) [1].

ERLs have received attention in recent years since they
have the potential to accelerator currents much larger
than those of non-recovering linacs, and since they have
the potential for providing emittances smaller than those
in x-ray storage rings at similar energies and for similar
beam currents. This is due to the fact that the emittances
in an ERL can be as small as that of the electron source,
if emittance increase during acceleration can be avoided.
Several laboratories have proposed high power ERLs
for diﬀerent purposes. Designs for light production with
diﬀerent parameter sets and various applications are be-
ing worked on by Cornell University [2, 3], Daresbury
[4], TJNAF [5], JAERI [6], Novosibirsk [7], and KEK
[8]. TJNAF has incorporated an ERL in its design of an
electron–ion collider (EIC) [9] for medium energy physics,
while BNL is working on an ERL–based electron cooler
[10] for the ions in the relativistic ion collider (RHIC).
The work at TJNAF, JAERI and Novosibirsk is based
on existing ERLs of relatively small scale. The ﬁrst in-
ternational ERL workshop with over 150 participants in
early 2005 has also shown the large interest in ERLs that

One important limitation to the current that can be
accelerated in ERLs or recirculating linear accelerators
in general is the regenerative beam-breakup (BBU) in-
stability. The size and cost of all these new accelerators
certainly requires a very detailed understanding of this
limitation. In [11] we have described this theory for par-
ticle motion in one degree of freedom. Here we generalize
this theory to two degrees of freedom, i.e. to accelerators
with polarized HOMs and x-y coupling of the particle
optics.

For one degree of freedom, a theory of BBU instability
in recirculating linacs, where the energy is not recovered
but added in each pass through the linac, was presented
in [12]. This original theory was additionally restricted
to scenarios where the bunches of the diﬀerent turns are
in the linac at about the same accelerating RF phase,
such as in the so-called continuous wave (CW) operation
where every bucket is ﬁlled. Tracking simulations [13]
compared well with this theory. This theory determines
above what threshold current Ith the transverse bunch
position x displays undamped oscillations in the pres-
ence of a higher order mode (HOM) with frequency ωλ.
If there is only one higher order mode and one recircu-
lation turn with a recirculation time tr in the linac, the
following formula is obtained for T12 sin ωλtr < 0:

Ith =

2c2
Q )λQλωλ

−

e( R

1
T ∗
12 sin ωλtr

,

(1)

where c is the speed of light, e is the elementary charge,
(R/Q)λQλ is the impedance (in units of Ω) of the higher
order mode driving the instability, Qλ is its quality fac-

tor. In the case of one degree of freedom, T ∗
12 = T12 is
the element of the transport matrix that relates initial
transverse momentum px before and x after the recircu-
lation loop. A corresponding formula had already been
presented in [14]. Occasionally, additional factors are
found when this equation is stated [15, 16, 17]. But in
[11] it has been shown that no such additional factors are
required.

The beam transport element T12 appears since a HOM
produces a transverse momentum px during the ﬁrst pass
of a particle. This produces a transverse position of x =
T12px when the particle traverses the HOM for a second
time, and this in turn excites the HOM itself by means
of the wake ﬁeld W x = W T12px.

When the mode is polarized with an angle θ, the
kick produced during the ﬁrst turn corresponds to the
momentum (px, py) = p(cos θ, sin θ). With a coupled
optics, the resulting orbit displacement when the par-
ticle reaches the HOM after the return loop is ~x =
p(T12 cos θ + T14 sin θ, T32 cos θ + T34 sin θ). This excites
the higher order mode by the projection of this displace-
ment onto the wake ﬁeld, ~W
~x = W p(T12 cos2 θ + (T14 +
T32) sin θ cos θ + T34 sin2 θ).

·

The HOM therefore produces a transverse kick that
feeds back to itself, exactly as in the case with one degree
of freedom, only that T12 needs to be replaced [18] by

12 = T12 cos2 θ + (T14 + T32) sin θ cos θ + T34 sin2 θ . (2)
T ∗

While equation 1 is derived with one HOM, for one
degree of freedom it is often a good approximation even
when the cavity has several higher order modes. It was
shown in [11] that diﬀerent HOMs can be treated individ-
ually when their frequencies diﬀer by more than about
ωλ
. This statement does not hold for two degrees of
2Qλ
freedom as will be shown in this paper. Modes cannot
in general be treated independently, even when their fre-
quencies are separated by much more than the width of
the HOM’s resonance.

An optics conﬁguration that makes T ∗

12 close to zero in
order to make the threshold current very large has been
proposed [19, 20] and tested for coupled beam transport
and polarized HOMs. This is a good technique when
there is one dominant HOM. When there are several
modes this approach does not apply directly, even if these
modes are separated by more than the width of their res-
onance.

The paper is arranged as following: ﬁrst, a disper-
sion relation for the current I0(ω) is derived including
coupling in a one turn recirculating linac with one cav-
ity having multiple polarized HOMs. The smallest real
value of I0 that can be obtained with real ω determines
the threshold current. Analytical solutions are given for
the case of two polarized HOMs in one cavity. It is ex-
plained how the dispersion relation for this simple case
can be solved eﬃciently on a computer, and comparisons
to analytical approximations are presented. Approxima-
tions are then given for N polarized modes in one cavity.
Subsequently a dispersion relation for multiple cavities

2

and multiple recirculation loops is derived that can only
be solved numerically with similarly eﬃcient techniques.
Finally, misalignments of cavities are considered to in-
vestigate when these misalignments lead to a very large
static displacement of the beam orbit.

II. N POLARIZED MODES IN ONE CAVITY

For simplicity we are here investigating one cavity with
N higher-order dipole modes (HOMs), each having a po-
larization angle θλ to the horizontal. Note that slightly
polarized cavities often have at least two HOMs with
similar characteristics, and looking at a single polarized
HOM can therefore be misleading.

The unit vector in the direction of the polarization is
~eλ = cos θλ~ex + sin θλ~ey. The eﬀective transverse voltage
in each HOM is Vλ, so that a particle traversing this
HOM obtains a transverse-momentum change of e
c ~eλVλ.
When ~V is the vector of all these N voltages, then the
momentum change is

∆~p =

E~V , E =

~e1 . . . ~eN

.

(3)

e
c

When the particle returns to the cavity after the return
time tr, the particle’s position has changed by

(cid:0)

(cid:1)

∆~x(t′) = T∆~p(t′

tr) , T =

−

T12 T14
T32 T34

(cid:18)

(cid:19)

.

(4)

This position will increase the voltage in Vλ(t) by the
t′)~eλ onto
projection of the mode’s wake ﬁeld Wλ(t
∆~x(t′) times the charge I(t′)dt′ that excites the ﬁeld,
∆~x(t′)dt′.
t′)~eλ ·
Integrating over all
i.e.
contributions to the HOM potentials leads to

I(t′)Wλ(t

−

−

I(t′)W(t

t′)D~V (t′

tr)dt′

(5)

−

−

~V (t) =

e
c

t

−∞

Z

with

and therefore

W = diag(Wλ) , D = ET T E

(6)

Dµµ = T12 cos2 θµ + T34 sin2 θµ +

Dµν = T12 cos θµ cos θν + T34 sin θµ sin θν

T32 + T14
2

sin 2θµ ,

+ T32 sin θµ cos θν + T14 cos θµ sin θν .

(7)

Here I(t′) is the current of the bunches that have al-
ready traveled for one turn; in the approximation of short
bunches it is given by

I(t) = I0tb

δ(t

tr −

−

mtb) .

(8)

∞

m=−∞
X

This transforms the integral equation into

~V (t) = I0

tb

e
c

∞

m=−∞
X

W(t

tr −

−

mtb)D~V (mtb)

(9)

where Wλ(t) = 0 for t

0.
The Laplace transform of ~V (t) can be written as

≤

with ˜I = etb
c eiωtr I0 and wλ = 1
tb
this quadratic equation leads to

eiωδtb (WΣ

δ )λλ. Solving

3

(16)

c
etb

e−iωtr I −1

0 =

D11w1 + D22w2
2

D11w1 −
2

(
±r

D22w2

)2 + w1w2D12D21 .

To reduce the threshold current, the left hand side of this
formula should be small.The matrix D is determined by
the mode polarization and by the linear particle optics. It
has been suggested [18, 19] to use these parameters to in-
crease the threshold current. These suggestions amount
to reducing the right hand side of Eq. (16) by making
D11 and D22 small. This is always a valid strategy if
there is only one HOM, i.e. w2 = 0. Then

D11 = T12 cos2 θ1 + T34 sin2 θ1 +

sin 2θ1 (17)

T14 + T32
2

and a horizontally (θ1 = 0) or a vertically (θ1 = π
2 )
polarized mode together with a beam transport that fully
couples the vertical to the horizontal motion and vice
versa, i.e. T12 = T34 = 0, would always lead to D11 = 0
so that there would not be any threshold current. A
formula for this case has been derived in [18].

For the case of two or more HOMs this method is no
longer as eﬀective, even when the modes have very dif-
ferent frequencies. In fact it has been suggested that in
cases with several modes, each mode could be considered
separately when each cavity mode has a resonance width
which is signiﬁcantly smaller than the frequency sepa-
ration between modes [18]. This is however not correct
and it will be seen shortly that the described method
that would seem to increase the threshold current when
all modes are considered separately is not as eﬀective
even when modes frequencies diﬀer by much more than
the resonance width. This is especially important when
there are two HOMs of similar properties, for example in
nearly cylindrically symmetric cavities. To see this eﬀect,
we distinguish three cases.

1. Circular symmetry

For circular symmetric cavities there are two equivalent
modes with perpendicular polarization, w1 = w2, ~e1 =
~ex, ~e2 = ~ey leading to D = T,

}
(14)

I0 =

e
ctb

e−i(ωtr +ϑ±)
T±w1

,

T±eiϑ± =

T12 + T34
2
with T± ∈

(
± r
IR+ .

(18)

T34

T12 −
2

)2 + T14T32 ,

where the threshold current is the smaller of the two val-
ues obtained with the equation for + and for
. For
T12 = T34 = 0 this case has been considered in [21]. If

−

~V (t + δtb) =

~˜Vδ(ω′)e−iω′tdω′ .

(10)

1
2π

∞−ic0

−∞−ic0

Z

And with the following deﬁnition

~˜V Σ
δ (ω) =

~˜Vδ(ω +

2π
tb

n)

(11)

one obtains

~˜V Σ
δ (ω) = tb

~V ([n + δ]tb)eiωntb .

(12)

∞

n=−∞
X

∞

n=−∞
X

Since ~˜V Σ

δ (ω) is periodic with 2π/tb, it has a Fourier
series, and its Fourier coeﬃcients are ~V ([n + δ]tb), which
shows that ~˜V Σ
δ (ω) does not vanish. The transverse mo-
tion is stable when ~˜V (ω) is zero for all ω with positive
If the current is increased the motion
imaginary part.
can become unstable at which point ~˜V (ω) is non-zero for
at least one ω with positive imaginary part. At threshold
it is therefore non-zero for a real value of ω.

As in [11] we will use tr = (nr −

recirculating phases, e.g. δ = 1
equation now leads to a relation for these coeﬃcients,

δ)tb to allow for all
2 for an ERL. The integral

(13)

W([n

nr −

−

m + δ]tb)D~V (mtb)eiωntb

~V Σ
0 (ω)
∞

I −1
0
e
c

t2
b

e
c

=

=

m,n=−∞
X
eiωnr tbWΣ

δ (ω)D~V Σ

0 (ω) .

This formulation shows that ~V Σ
0 (ω) is an eigenvector of
the matrix on the right-hand side, and the corresponding
eigenvalue is 1/I0. Its solution is therefore very similar to
the matrix theory for BBU computation without coupling
in [12]. The threshold current can thus be determined
by ﬁnding the largest real eigenvalue of this matrix for
any real ω. Due to the symmetry properties WΣ
δ (ω +
) = WΣ
2π
δ (ω), it is suﬃcient
tb
to investigate ω
[0, π/tb] to ﬁnd the BBU threshold
current,
e
c

δ (ω)D~V = Λ~V , Λ

δ (ω) and WΣ
δ (

eiωnrtbWΣ
|

max
ω∈[0,π/tb]{

ω) = WΣ∗

I −1
th =

IR

−

Λ

∈

∈

.

A. Two polarized HOMs in one cavity

For a large number of HOMs this equation should be
solved numerically, but for two HOMs a analytical so-
lution is simple. The characteristic polynomial for the
eigenvalue 1/I0 becomes
˜I −1

D11w1

D12w1

= 0 ,

(15)

−
D21w2

−

−
˜I −1

−

D22w2 (cid:19)(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:18)
(cid:12)
(cid:12)
(cid:12)

there is no coupling, T+ =
. This
T12|
|
result is equivalent to what has been found in [11] for
motion in one degree of freedom.

and T− =

T34|
|

As in [11] we now use long range wake ﬁelds of the

form

Wλ(τ ) =

R
Q

(cid:18)

(cid:19)λ

ω2
λ
2c

e−

ωλτ
2Qλ sin(ωλτ ) ,

(19)

where Qλ is the quality factor, ωλ is the frequency, and
(R/Q)λ is the impedance in units of Ω for the linac deﬁ-
nition (2 times the circuit deﬁnition). As shown in [11],
is especially large when ω is close to ωλ.
wλ(ω)
|
|
When motion in only one dimension is considered as

in [11], one obtains

I0 ≈

c
etb

e−iωtr
T12wλ

.

(20)

For simplicity we again use
ωλtb
2Qλ

. For nrǫλ ≪

Kλ = tb

eω2
λ
2c2

R
Q

λ
(cid:17)

1 this leads to the approximation

(cid:16)

and ǫλ =

Ith ≈ (

−

2ǫλ
Kλ
2
Kλ|T12|

1

T12 sin(ωλtr) for T12 sin(ωλ) < 0,

λ + ( mod(ωλtr,π)
ǫ2
1 the approximation derived in

)2 else.

nr

(21)

For ǫλ ≪
[11] is

q
1 but nrǫλ ≫

Ith ≈

2ǫλ
T12|

.

Kλ|
Exactly the same approximation and derivation there-

fore leads leads from Eq. (18) to

Ith± ≈ (

−

2ǫλ
Kλ
2
KλT±

1

T± sin(ωλtr +ϑ±) if it is > 0,
λ + ( mod(ωλtr+ϑ±,π)
ǫ2
1 the approximation derived in

)2 else.

(23)

nr

For ǫλ ≪
[11] is

q
1 but nrǫλ ≫

(22)

(24)

Ith± ≈

2ǫλ
KλT±

.

The threshold current is given by Ith = min±(Ith±).

2

R
Q

R
Q

= 100Ω, ω1 = ω2 = 2π

To clarify the here considered case, we use typical
parameters for the two HOMs: Q1 = Q2 = 104,
2.2GHz,

=
1
δ = 5.5. For a decoupled optics with
tb = 1/1.3GHz, nr −
(cid:17)
(cid:17)
(cid:16)
(cid:16)
10−6 m
eV /c , T14 = T32 = 0 we obtain a threshold
T12 =
current of Ith = 46.40mA that agrees to all speciﬁed dig-
its when computed by particle tracking and by the ap-
proximation in Eq. (24). For a very much coupled beam
transport (abbreviation x =
eV /c is used below)
the following threshold current is obtained:

10−6 m

−

−

·

2. Small coupling

4

2

D22w2|

To cases with

D11w1 −
|

we
refer to it as small coupling. This denomination is moti-
vated by the fact that when one mode is polarized in x
and one in y direction, this case occurs when the optical
coupling is small, as can be seen in Eq. (7). Equation
(16) simpliﬁes to

w1w2D12D21|

≫ |

I0 =

e
ctb

e−iωtr
Dλλwλ

,

(26)

with λ being either 1 or 2.

The approximation that leads from Eq. (20) to Eq. (21)

can again be used and it leads to

2ǫλ
Kλ

1
Dλλ sin(ωλtr)

for Dλλ sin(ωλtr) < 0 , (27)

Ith ≈ −
and similarly an approximation that corresponds to
Eq. (22) is valid. This formula has been used to argue
could be built with
that an optics with very small
extremely large threshold current. But this equation does
not apply when the
are too small, since then the
following case has to be considered.

Dλλ|
|

Dλλ|
|

3. Strong coupling

To the case with

w1w2D12D21|
we refer to as strong coupling. This case is especially
relevant when the mentioned coupling techniques have
been used to make D11 and D22 very small. One obtains

D11w1 −
|

D22w2|

≪ |

2

I 2
0 ≈

(

c
etb

)2

e−iω2tr
w1w2D12D21

.

(28)

At the threshold current only one of the functions in the
denominator will be very large and we call this wµ. The
other mode will be indexed by ν.

In [11] a ﬁrst order approximation in ∆ωtb = (ω

ωµ)tb
and ǫµ is used to obtain Eqs. (21) and (22). Here we again
expand to ﬁrst order in these quantities, which is simple
since w−1
can be evaluated
at ∆ω = 0 and ǫν = 0, leading to

µ is linear in them so that w−1
ν

−

I 2
0 ≈

c
etb

e−i(ω2tr+ϑ)
T w1

.

c wν (ωµ)D12D21, T

With T eiϑ = etb
IR+. Note that the
exponent contains 2tr instead of tr. The approximations
that correspond directly to Eqs. (23) and (24) can again
be applied.

∈

In [11] wλ is evaluated for the long-range wakeﬁeld,

(29)

(30)

(cid:19)λ

(cid:18)
eiω+(δ−1)tb sin(ωλδtb)
cos(ω+tb)

×

eiδω+tb sin(ωλ[δ
cos(ωλtb)

−

1]tb)

.

−
−

T =

1
0
1
−
0

1 3x
x
1
0 1
2x 1 4x
1 0 1

−
−






1
√2 



=

⇒

Ith = 20.28mA .

leading to

wλ =

R
Q

ω2
λ
4c

(25)
Again the threshold current computed by particle track-
ing and by Eq. (23) agree to all speciﬁed digits.

Note that here wλ is deﬁned without a phase factor
e−iωδtb compared to [11] to simplify the notation. For
an ERL, where δ = 1/2, one has

log10(Ith(A))

5

2

0

-2

-4

-6

wλ =

R
Q

(cid:18)

(cid:19)λ

ω2
λ
2c

cos(ω+ tb
cos ω+tb −

2 ) sin(ωλ

tb
2 )
cos ωλtb

,

(31)

with ω+tb = ωtb + iǫλ. Then ω = ωµ + ∆ω with the small
quantity ∆ωtb. We assume that also ǫλ = ωλtb
is small,
2Qλ
which is usually the case whenever BBU is relevant. A
ﬁrst order expansion in these small quantities leads to

I 2
0 ≈

2e−iω2tr (∆ωtb + iǫµ)
KµKνD12D21

cos(ωµtb)
tb
2 ) sin(ων
cos(ωµ

cos(ωνtb)
tb
2 )

−

. (32)

If I0 is the threshold current Ith, the right hand side
has to be a real number, requiring ∆ωtb sin(ω2tr) =
ǫ1 cos(ω2tr). This leads to

I 2
thµ ≈

2ǫµ
KµKν

D12D21 cos(ωµ

cos ωµtb −

cos ωνtb
tb
2 ) sin(ωµ2tr)

tb
2 ) sin(ων

,

(33)
whenever this term is positive. Whenever it is negative,
the following approximation follows from [11],

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

I 2
thµ ≈

2

KµKν (cid:12)
(cid:12)
(cid:12)
(cid:12)
ǫ2
µ + (

× s

cos ωµtb −
D12D21 cos(ωµ

cos ωνtb
tb
2 ) sin(ων

tb
2 )

(34)

mod (ωµ2tr, π)
2nr

)2 .

For ǫµ ≪

1 but nrǫµ ≫

1 one obtains

I 2
thµ ≈

2ǫµ
KµKν (cid:12)
(cid:12)
(cid:12)
(cid:12)

cos ωµtb −
D12D21 cos(ωµ

cos ωνtb
tb
2 ) sin(ων

tb
2 )

.

(35)

These formulas are to be evaluated for µ = 1, ν = 2
and for µ = 2, ν = 1, and the smaller of the two resulting
currents is the threshold current,

Ith = min

µ∈{1,2}{

Ithµ}

.

(36)

λ

(cid:16)

(cid:17)

R
Q

An interesting observation is that for two modes with
, and ωλ, the ratio of the threshold
similar Qλ,
current with and without coupled optics can be found by
comparing Eqs. (33) and (27) and it is proportional to
√Qλ. For cavities that are optimized for large
currents by means of sophisticated HOM damping, the
p
advantage of a coupled optics therefore decreases. This
eﬀect is independent of the length of the return loop and
is already relevant for a single cavity.

1/ǫλ ∝

Figure 1 refers to a linac with one cavity and tr =
555.5tb that has two HOMs, one with ω1 = 2.2GHz po-
larized in x and one with ω2 = 2.3GHz polarized in y
direction,
= 100Ω, and Qx = Qy is varied. The
bottom data refer to a decoupled optics and the top data
to a fully coupled optics with T12 = 0 and T34 = 0. A

R
Q

(cid:17)

(cid:16)

6

8

10

12

log10(Q)

FIG. 1: The threshold with two modes in one cavity scales
with Q−1 for a decoupled and with Q− 1
2 for a fully coupled
optics. The advantage of coupling thus diminishes for low Q.

double-logarithmic plot is shown, which makes it appar-
ent that the threshold current for a decoupled optics de-
creases with Q−1, as indicated by the line with slope
1.
−
1
A closer look shows that the slope is only accurately
−
for relatively small and relatively large Q where either
approximation 21 or 22 hold. A totally coupled optics
with T12 = 0 and T34 = 0 leads to a larger threshold cur-
rent than without coupling, but when Q of the modes is
reduced, the threshold current increases only with Q− 1
2
1
2 . The advantage of
as indicated by a line with slope
coupling decreases proportionally to √Q.

−

Figure 2 similarly shows the advantage of polarizing
the higher order modes in the ERL that is proposed to
upgrade the CESR ring at Cornell University [22]. When
the HOMs are polarized in x and y direction and the
optics is completely coupled by T12 = 0 and T34 = 0,
the threshold current is larger than without coupling,
but again the advantage is smaller when the HOMs are
damped more strongly by HOM absorbers. In fact, for
the HOMs that are computed for 7-cell cavities [23], the
increase of the threshold current due to coupling is only
a factor of 2.5 as can be seen in Tab I when the HOM
frequencies in x and y are separated by 10MHz. However,
the ﬁgure shows that when many cavities are present, as
in the ERL where there are 320, the scaling is not as
simple as in the case of a single cavity and the advantage
of coupling does not decrease as strongly with decreasing
Q.

For Tab. I the 320 cavities of the ERL upgrade of CESR
had nominal HOM frequencies of fx = 1.87394GHz with
horizontal polarization. The mode with vertical polariza-
∆fxy. The cavities have HOM frequen-
tion is fy = fx −
cies that have a Gaussian distribution around these val-
ues with rms width σRF . We used 500 diﬀerent random
distributions of the frequencies and display the average
threshold current Ith as well as the rms σI of the 500 re-
sulting thresholds. All modes have
= 109.60Ω and

R
Q

(cid:16)

(cid:17)

log10(Ith(mA))

6

Ith(A)
}

ℑ{

6

2.5

1.5

3

2

1

0.5

4

2

0

-2

-4

3.8

4

4.4

4.6

4.2
log10(Q)

FIG. 2: The threshold increase due to coupling of the x-ray
ERL upgrade of CESR scales roughly with √Q.

-4

-2

0

2

4

6

Ith(A)
}

ℜ{

FIG. 3: Two eigenvalues trace out loops for I0 in the complex
plain while ω is varied.

TABLE I: Threshold currents for the two most signiﬁcant
HOMs of the Cornell ERL.

log10( ∆I
I )
-1

∆fxy Coupling
NO
10MHz
10MHz YES
10MHz
NO
10MHz YES
60MHz
NO
60MHz YES

σI

σRF
Ith
0MHz 25.8mA 0mA
0MHz
103mA 0mA
1.3MHz 280mA 43mA
1.3MHz 867mA 100mA
10MHz 418mA 69mA
10MHz 2420mA 433mA

-1.5

-2.5

-2

-3

-3.5

-4

Q = 20912.4.

20

40

60

80

100

k

B. Comments about numerical solutions

When the threshold current for two polarized modes
at ων and ωµ should be found by solving Eqs. (26) and
(28) numerically, the eigenvalues are plotted in the com-
plex plain, and the intersections with the real axis are
sought that lead to the smallest current. An example
of the two eigenvalues plotted in the complex plain is
shown in Fig. 3. The eigenvalues are largest in the vicin-
, since there ei-
, λ
)
ity of ω =
|
ther wµ or wν become very large. The subscript on
the mod function indicates that mod+(x, 1)
[0, 1] and
mod−(x, 1)

mod±(ωλ, 2π
tb
|

∈ {

1, 2

∈

}

1

Furthermore, the eigenvalues trace out loops around
the origin of the complex plain about once per 2π
varia-
tb
tion of ω, due to the exponential factor in Eq. (26). We
2π
therefore vary ω only in a
interval around each HOM
tb
frequency. This speeds up the search for eigenvalues by
a factor proportional to nr, which can be very large.

±

A simple approach would be to plot all eigenvalues
in the complex plain and to select the smallest eigen-
value that is reasonably close to the complex plain. Large

[
−

∈

2 , 1
2 ].

∈

−

ωµ

2π
tr

[
−

, 2π
tr

FIG. 4: Variation of the relative accuracy ∆I
for scanning
I
ω
] by k points. By far the best accuracy is
achieved with the elliptical extrapolation of 4 points around
the real axis (black dots). For an approximation by a line
between two points (red, largest at large k), a second order
polynomial y(x) ﬁtted to three points (green, second largest
at large k), and a third order polynomial y(x) ﬁtted to four
pints (blue, third largest at large k) all lead to much worth
accuracies and/or computation times.

factors in speed can be gained when the loops that are
traced out by each eigenvector can be interpolated and
their intersection with the real axis can be found, since
the loops have to be scanned much less densely. We have
found that using values of I0(ω), where two are above and
two below the real axis, and ﬁtting an upright ellipse to
these values is a very good parametrization. The accu-
racy achieve for distributing k particles in the described
region around each HOM frequency lead to the accuracy
documented in Fig. 4.

7

1.25

1.5

1.75

2

2.25

2.5

2.75

3

2.5

2.52

2.54

2.56

2.58

fy

fy

Ith(A)

Ith(A)

4

3

2

1

0

4

3

2

1

0

Ith(A)
5

4

3

2

1

0

FIG. 5: Threshold current for one horizontal HOM with fx =
2.2GHz as a function of the frequency fy of a vertical HOM.
Black curve: dispersion relation, Red dots: tracking, Colored
curves: the diﬀerent applicable approximations derived above.

C. Comparison of results for polarized modes and
coupling

−

T14 = 10−6 m

To demonstrate the excellent agreement between these
numerical solutions and tracking, we depict Fig. 5 where
one HOM with horizontal polarization has been ﬁxed at
fx = 2.2GHz, and another has been varied for fy ∈
[1.2, 3.2]GHz. The optics was completely coupled with
eV /c . Several
T12 = T34 = 0 and T31 =
things can be observed: (1) since tracking is relatively
time consuming, only relatively few frequencies for the
second HOM have been evaluated, but all of them lie ex-
actly on the curve that follows form the dispersion rela-
tion. (2) The threshold current varies strongly when the
second HOM is varied, but the agreement with tracking
shows that this is not numerical noise but a consequence
of the coupling between the two polarized modes whose
frequencies are very far apart.
(3) There are frequen-
cies where the threshold current is relatively small, these
cos(ω2tb) in agree-
are frequencies where cos(ω1tb)
ment with Eq. (32). The displayed minima appear at
(3
2.2)GHz. But
the regions with reduced threshold are relatively wide; in
particularly they are much wider than the width of HOM
resonances.

2.2)GHz, 2.2GHz, and (4

1.3

1.3

≈

−

−

·

·

Depicted in color are the values obtained by approxi-
mations derived above. It is apparent that the approx-
imations are not always very good, especially that they
lead to values that are too large. A magniﬁcation in Fig.6
shows that the reason for that is that the approximate
formulas lead to parabolic shapes that have the correct
minimum value, but not the correct width. This is im-
portant since it shows that the formulas can be used to
ﬁnd the correct minimum value as a conservative esti-
mate. Furthermore, the magniﬁcations again show the
good agreement with tracking results.

2.582

2.584

2.586

2.588

2.59

fy

FIG. 6: Magniﬁcation of regions in Fig. 5

Here an important note is in place. Once place where a
ω2. And this dip is much
strong dip occurs is when ω1 ≈
wider than the width of the HOM resonance of ωλ/Qλ,
showing that the two modes clearly do not decouple when
they are separated by more than their width. For nom-
inally circular symmetric cavities, HOMs are not degen-
erate due to construction errors and each mode splits
into two mode with typically a few MeV distance. But
the dip is much wider than that, showing that an appro-
priate advantage of BBU suppression by damping can
in general only be realized when polarized cavities are
designed, i.e. cavities where the horizontal and vertical
dimensions are designed to be slightly diﬀerent, leading
to HOM frequencies that diﬀer by several 10MeV in the
two planes.

The question arises how far the HOM frequencies have
In Fig. 7 we show for the Cornell ERL
to be apart.
how Ith changes with ∆fxy. In order to avoid averaging
over many diﬀerent frequency distributions we have here
chosen the same two HOM frequencies for each of the 320
cavities. The data indicates that a mode separation of
60MHz is suﬃcient. This has been used to compute the
very large recirculating BBU threshold current of close to
2.5A for this accelerator. It should be noted that only the
two dominant HOMs were considered in this simulation

Ith(mA)
 140

 120

 100

 80

 60

 40

 20

i (t), pI

i (t) = (xI

passes through the linac are numbered by an index I.
The horizontal and vertical phase space coordinates that
the beam has at time t in the HOM i during turn I is
xi(t), yI
denoted ~zI
4
transport matrix that transports the phase space vector
j at HOM j during turn J to ~zI
~zJ
ij and the
time it takes to transport a particle from the beginning
of the ﬁrst turn to HOM i during turn I is denoted tI
i .
The beam is propagated from after HOM i
1 to after
HOM i by

i is denoted T4IJ

yi(t))T . The 4

i (t), pI

−

×

i (t) = T4II
~zI

ii−1 ·

~zI
i−1(t

[tI

i −

−

tI
i−1]) +

~Vi(t) ,

(37)

e
c

with ~Vi = Vi(0, cos θi, 0, sin θi)T . This equation can be it-
erated to obtain the phase space coordinates as a function
of the HOM strength that creates the orbit oscillations.
With the matrix

TIJ

ij =

(T4IJ
(T4IJ

ij )12 (T4IJ
ij )32 (T4IJ

ij )14
ij )34 !

 

(38)

I

NIJ (i−1)

~xI
i (t) =

TIJ

ij ~ei

Vj (t

[tI

i −

−

tJ
j ]) ,(39)

e
c

XJ=1
N,
i

(

−

j=1
X

if I
= J;
if I = J.

1,

The strength Vi(t) of the HOM i with polarization di-
rection ~ej is created by all particles that have traveled
through that HOM via the integral

Vi(t) =

Np

∞

−∞

Z

XI=1

Wi(t

−

t′)I I

i (t′)~eT

i ~xI

i (t′)dt′ ,

(41)

where I I
i (t) is the current at time t that the fraction of the
beam has which passes the HOM i on turn I. Note that
t′) = 0 for t′ > t. Combining this with Eq. (39)
W (t
leads to the following integral-diﬀerence equation:

−

Np

∞

−∞

XI=1
NIJ (i−1)

I

Wi(t

−

t′)I I

i (t′)

Vi(t) =

Z

e
c

×

XJ=1
TIJ

j=1
X

DIJ

ij = ~eT
i

ij ~ej .

DIJ

ij Vj(t′

[tI

i −

−

j ])dt′ ,
tJ

8

(40)

(42)

(43)

-100

-50

 50

 100

 0
∆fxy

FIG. 7: Dependence of Ith on ∆fxy for the Cornell ERL.

and a detailed study is in order when such high currents
are sought. The Cornell ERL is designed for 100mA and
this calculation indicates that polarized cavities with a
coupled optics provide a very comfortable safety margin
with respect to this instability.

one obtains

D. Approximation for N polarized HOMS in one
cavity

NIJ (i

1) =

−

As a ﬁrst approximation one can assume that one com-
ponent of the eigenvectors in Eq. 14 will be very large.
This would lead to a decoupling of HOMs so that each
HOM could be treated separately, as for a single degree of
freedom. One could therefore derive the threshold with
the smallest current for each individual HOM, and this
would approximate the threshold for the complete accel-
erator. When all these thresholds are very large, one has
to investigate the next approximation, where the eigen-
vector has two dominant components. In this case the
eigenvalues are determined from a 2
2 matrix corre-
sponding to Eq. (15). The threshold current has to be
computed for each pair of HOMs. The smallest current
obtained for one pair of polarized modes then approxi-
mates the threshold current of the full accelerator.

×

III. POLARIZED HOMS IN MANY CAVITIES
AND FOR MULTIPLE TURNS

Recirculating linacs with many cavities and several re-
circulation loops have been considered early on [12, 24].
In [11] a description for arbitrary recirculation times has
been presented. Here we want to extend this description
to include orbit coupling and polarized modes. As far
as possible we retain the notation of these earlier papers.
The N higher order modes, which can be associated with
diﬀerent cavities, are numbered by an index i. The Np

This equation is identical to that obtained for one de-
gree of freedom, only that (TIJ
ij )12 is replaced by DIJ
ij .
The following treatment for obtaining the threshold cur-
rent is therefore identical to that in [11]. For completion
it is here presented in simpliﬁed form, and recommenda-
tions for numerical solutions are given.

Now the approximation of short bunches is used. The
current is given at time t by pulses that are equally spaced

6
with the distance tb,

I I
i (t) =

I0tbδ(t

tI
i −

−

mtb) .

(44)

∞

m=−∞
X

This reduces the integral to a sum,

Vi(t) =

I0tb

∞

Np

m=−∞
X
NIJ (i−1)

XI=1

e
c

I

Wi(t

tI
i −

−

mtb)

(45)

DIJ

ij Vj (mtb + tJ

j ) .

×

XJ=1

j=1
X

This leads to

˜V Σ
i,tL

i /tb

(ω) =

I0t2
b

∞

∞

Np

n=−∞
X
NIJ (i−1)

m=∞
X

XI=1

e
c

I

Wi(mtb + tL

tI
i ) (46)

i −

DIJ

ij Vj([n

m]tb + tJ

j )eiωntb .

−

j=1
X

Np

×

=

XJ=1
e
c

I0

˜W Σ
i,tL

i −tI
i

XI=1

XJ=1

j=1
X

I

NIJ (i−1)

DIJ
ij

˜V Σ
j,tJ

j /tb

(ω) .

If a vector ~V is introduced that has the coeﬃcients

, this equation can be written in matrix form,

˜V Σ
i,tI
i

1
I0

~V = M(ω)~V ,

with the matrix coeﬃcients

Np

M LJ

ij =

e
c

tb

XI=J+Θj,i
if j

1,
0, otherwise.

≥

i;

(

Θj,i =

(47)

(48)

i,[tL

i −tI

= ˜W Σ

)tb where
Note that ˜W Σ
Top(x) is the smallest integer that is equal to or larger
than x and δi(I, L) = mod(tI
tL
i , tb). With Kronecker
ˆδik this determines the matrices W and U to be

i,δi(I,L)eiωT op(

i −

i ]/tb

tI
i

−tL
i
tb

tbwi(δ(I, L))eiωTop( tI −tL

tb

)tb δik ,

e
c

W LI

ik =
kj = T IJ

U IJ

kj ΘI,J+Θj,k .

(49)

(50)

For each frequency ω, I −1

is an eigenvalue of M(ω).
0
Since the eigenvalues are in general complex, but I0 has
to be real, the threshold current is determined by the
largest real eigenvalue of M(ω). The matrix has the
properties

M(ω +

) = M(ω) , M(

ω∗) = M∗(ω) ,

(51)

−

2π
tb

9

∈

and it is therefore again suﬃcient to investigate ω
[0, π/tb] to ﬁnd the threshold current.

Note that V Np

N never appears since the last kick on
the last turn does not feed back to any HOM, so that
the dimension of M can be reduced by one to N
Np −
1. Furthermore the dimension can be reduced when two
fractional parts δI
i and
V J
i are identical.

·
i are equal since then V I

i and δJ

A. Multi turn operation and cavity misalignments

Since the formalism presented here that includes po-
larized modes and coupled optics is identical to the for-
malism in one degree of freedom, only that (TIJ
ij )12 has
been replaced by DIJ
ij , all conclusions about multi turn
recirculating and multi turn ERLs hold. For example,
in [11] it was concluded that for one HOM and for Np
passes through the linac, the threshold current should
1). The origin of this conclu-
roughly scale as Np(2Np −
I
sion results from the double sum
J=1. Since the
same summation appears, this conclusion holds also for
polarized modes with coupling.

Np
I=1

P

P

For misaligned cavities, HOMs are excited even when
the current is smaller than the threshold current. This
can lead to large beam excursions, and in [11] it was
analyzed for what currents these excursions become ex-
tremely large. It was found that the BBU threshold cur-
rent is always smaller than the current for which these
orbit excursions would get very large. Since the here pre-
sented formalism with coupling and polarized modes has
the same formal structure, this conclusion again holds.

As pointed out above where numerical solutions for
one return loop and two HOMs were found, it is very
essential to systematically search for real values for the
eigenvalues of M. Each eigenvalue traces out curves in
the complex plain when ω is varied in the region [0, π/tb),
however eigenvalue ﬁnders usually do not return eigenval-
ues in any particular order, so that these curves cannot
be observed easily. If they could be observed, then el-
lipses could be ﬁtted to these curves and the intersection
of the curve with the real axis could very eﬃciently be
found for each eigenvector.

We therefore recommend a sorting algorithm that sorts
eigenvalues rather robustly: (1) Normalize each eigenvec-
tor. (2) Sort these vectors according to their largest com-
ponent, i.e. the vector which has its largest component
in position 1 is the ﬁrst vector, if there are more than one
of this kind, the one with the largest coeﬃcient can be
chosen as ﬁrst vector, etc. (3) Associate the eigenvalues
in the order of these eigenvectors. Small changes of ω do
not change the relative size of the eigenvector elements
much. The intersection of the curve λi(ω) with the real

˜Wi,[tL

i ]/tb (ω)DIJ

ij

i −tJ

B. Comments about numerical solutions

axis can now be found for each eigenvector. This proce-
dure leads to an enormous speed advantage over simply
[0, π/tb], and
scanning all eigenvalues for a mesh of ω

∈

choosing the largest eigenvalue that is reasonably close
to the real axis.

10

[1] M. Tigner, Nuovo Cimento 37, 1228 (1965).
[2] S.M. Gruner, M. Tigner (eds.), Report No. CHESS 01-

003, 2001.

[3] G.H. Hoﬀstaetter et al., in Proceedings of the 2003 Par-
ticle Accelerator Conference, Portland, OR (IEEE, Pis-
cataway, NJ, 2003), pp. 192-194.

[4] M.W. Poole et al., in Proceedings of the 2003 Particle Ac-
celerator Conference, Portland, OR (IEEE, Piscataway,
NJ, 2003), pp. 189-191.

[5] S.V. Benson et al., in Proceedings of the 2001 Particle
Accelerator Conference, Chicago, IL (IEEE, Piscataway,
NJ, 2001), pp. 249-252.

[6] M. Sawamura et al., in Proceedings of the 2003 Parti-
cle Accelerator Conference, Portland, OR (IEEE, Piscat-
away, NJ, 2003), pp. 3446-3448.

[7] G.N. Kulipanov, A.N. Skrinsky, N.A. Vinokurov, J. Syn-

chrotron Rad. 5, 176 (1998).

[8] T. Suwada et al., in Proceedings of the 2002 ICFA Beam
Dynamics Workshop on Future Light Sources, Japan.
[9] L. Merminga et al., in Proceedings of the 2002 European
Particle Accelerator Conference, Paris, France, (CERN,
Geneva, 2002), pp. 203-205.

[10] I. Ben-Zvi et al., in Proceedings of the 2003 Particle Ac-
celerator Conference, Portland, OR (IEEE, Piscataway,
NJ, 2003), pp. 39-41.

[11] G.H. Hoﬀstaetter and I.V. Bazarov, “Beam-breakup in-
stability theory for energy recovery linacs”, Phys. Rev.
ST AB 7, 054401 (2004).

[12] J.J. Bisognano, R.L. Gluckstern, in Proceedings of the
1987 Particle Accelerator Conference, Washington, DC
(IEEE Catalog No. 87CH2387-9), pp. 1078-1080.

[13] G.A. Kraﬀt, J.J. Bisognano, in Proceedings of the 1987
Particle Accelerator Conference, Washington, DC (IEEE
Catalog No. 87CH2387-9), pp. 1356-1358.

[14] R.E. Rand, Recirculating electron accelerators (Harwood
Academic Publishers, New York, 1984), Section 9.5.
[15] N.S.R. Sereno, Ph.D. Dissertation, University of Illinois,

1994

[16] K. Beard, L. Merminga, B.C. Yunn, in Proceedings of
the 2003 Particle Accelerator Conference, Portland, OR
(IEEE, Piscataway, NJ, 2003), pp. 332-334.

[17] L. Merminga, I.E. Campisi, D.R. Douglas, G.A. Kraﬀt,
J. Preble, B.C. Yunn, in Proceedings of the 2001 Particle
Accelerator Conference, Chicago, IL (IEEE, Piscataway,
NJ, 2001), pp. 173-175.

[18] E. Pozdeyev, ”Regenerative multipass beam breakup in

two dimensions”, Phys. Rev. ST AB 8, 054401 (2005).

[19] R.E. Rand and T.I. Smith, Beam optical control of beam
breakup in a recirculating electron accelerator, Particle
Accelerators, Vol. 11, pp. 1-13 (1980)

[20] C.D. Tennant, K.B. Beard, D.R. Kouglas, K.C. Jor-
dan, L.Merminga, E.G. Pozdeyev, “First observations
and suppression of multipass, multibunch beam breakup
in the Jeﬀerson Laboratory free electron laser upgrade”,
Phys. Rev. ST AB 8, 074403 (2005).

[21] B.C. Yunn, in a contribution to the working group 2 of

the ERL workshop (2005)

[22] G.H. Hoﬀstaetter, I.V. Bazarov, S. Belomestnykh, D.H.
Bilderback, M.G. Billing, J.S-H. Choi, Z. Greenwald,
S.M. Gruner, Y. Li, M. Liepe, H. Padamsee, D. Sagan,
C.K. Sinclair, K.W. Smolenski, C. Song, R.M. Talman,
M. Tigner, “Status of a Plan for an ERL Extension to
CESR”, Proceedings PAC05, Knoxville/TN (2005)

[23] M. Liepe, “Conceptual

layout of the cavity string of
the Cornell ERL main linac cryomodule”, Proceedings
SRF03, Travem¨unde/FRG (2003)

[24] G.A. Kraﬀt, J.J. Bisognano, S. Laubach, unpublished,

1987.

