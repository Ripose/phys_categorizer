3
0
0
2
 
v
o
N
 
3
1
 
 
]
h
p
-
c
c
a
.
s
c
i
s
y
h
p
[
 
 
1
v
8
5
0
1
1
3
0
/
s
c
i
s
y
h
p
:
v
i
X
r
a

First-Order Averaging Principles for Maps
with Applications to Beam Dynamics in Particle Accelerators

H. Scott Dumas
Department of Mathematics
University of Cincinnati
Cincinnati, OH 45221–0025
scott.dumas@uc.edu

James A. Ellison
Department of Mathematics
University of New Mexico
Albuquerque, NM 87131
ellison@math.unm.edu

Mathias Vogt
Deutsches Elektronen Synchrotron
Notkestraße 85
22607 Hamburg, Germany
vogtm@mail.desy.de

Abstract. For slowly evolving, discrete-time-dependent systems of diﬀerence equations (iterated maps), we
believe the simplest means of demonstrating the validity of the averaging method at ﬁrst order is by way of
a lemma that we call Besjes’ inequality.
In this paper, we develop the Besjes inequality for identity maps
with perturbations that are (i) at low-order resonance (periodic with short period) and (ii) far from low-order
resonance in the discrete time. We use these inequalities to prove corresponding ﬁrst-order averaging principles,
together with a principle of adiabatic invariance on extended timescales; and we generalize and apply these
mathematical results to model problems in accelerator beam dynamics, and to the H´enon map.

Keywords: Averaging method; averaging principle; diﬀerence equations; iterated maps; small divisors; adia-
batic invariance; accelerator beam dynamics; kick-rotate model; H´enon map

2000 MSC: 39A11; 37J40; 70K65; 70H11; 78A35; 70Fxx

Submitted to SIAM Journal of Applied Dynamical Systems

1. Introduction

In broadest terms, the method of averaging (or “averaging principle”) may be described as follows: to approx-
imate the evolution of a system with motions occurring on both fast and slow timescales, one uses a simpler
system obtained by somehow averaging over the fast motion of the original system. In the context of diﬀerence
equations (or “iterated maps”), the most elementary situation to which the method applies occurs in periodic
systems of the form

(1.1)
Rd is a bounded, locally x-Lipschitz,
where xn ∈
discrete-time-dependent function of period p in n. Solutions of system (1.1) are approximated by solutions of
the associated averaged system

N, ε > 0 is a small parameter, and f : U

xn+1 = xn + εf (xn, n)

Rd, n

→

N

×

⊂

U

∈

yn+1 = yn + ε

f (yn)

p−1
where the autonomous function
n=0 f (y, n). In
this context the averaging principle asserts that solutions xn of Eq. (1.1) and yn of Eq. (1.2) that start at the
same initial condition remain O(ε)-close on a discrete timescale of O(1/ε). It is also often useful to use the
continuous-time solutions of the corresponding averaged ODE

(the average of f ) is given by

f (y) = (1/p)

f : U

Rd

P

→

b

b

b

(1.2)

(1.3)

to approximate the discrete-time solutions of Eq. (1.2) and hence also those of Eq. (1.1), so that we obtain
the two approximation relations xn = yn + O(ε) and xn = y(n) + O(ε) for 0
O(1/ε) (note that yn and
y(n) have diﬀerent meanings). A more precise formulation appears below in Theorem 1, followed by a very
elementary proof that makes no use of the usual transformation that appears in textbooks (it is not always
recognized that ﬁrst-order averaging may be justiﬁed without the sort of coordinate transformations used, for
example, in canonical perturbation theory).

≤

≤

n

Equation (1.1) is a special case of a more general problem on which we focus in this paper. Let ν
Rd, and f : U

R,
Rd be periodic with period 1 in its second argument. We then consider the system

R

∈

U

⊂

×

→

xn+1 = xn + εf (xn, nν) .

(1.4)

The analysis of this problem is similar to the analysis of the ﬂow problem dx/dt = εf (x, t) when f is quasiperiodic
in t with two base frequencies, since small divisors enter both problems in the same way. Clearly Eq. (1.4) reduces
to Eq. (1.1) when ν = q/p is rational. For ν irrational, we know from Weyl’s equidistribution theorem [K¨o]

dy
dt

= ε

f (y)

b

1

Averaging for Maps

yn+1 = yn + εf (yn)

dy
dt

= εf (y) .

that the average of f (x, nν) over n exists and equals f (x) =
values of ν the solutions of Eq. (1.4) can be approximated by solutions of the two systems

1
0 f (x, t) dt. It is therefore natural to ask for what
R

(1.5)

(1.6)

(1.7)

(1.8)

(1.9)

and

In answering this question, it also seems natural (from the mathematical viewpoint) to introduce Diophantine
conditions on ν, but these conditions in their usual form are problematic in applications, and not wholly
necessary, as we shall see. In fact, we present approximation theorems that are both theoretically satisfying
and suited to applications. In particular, we weaken the usual small divisor conditions on ν (in which ν satisﬁes
inﬁnitely many “Diophantine conditions”), requiring instead only ﬁnitely many conditions at appropriately low
order. These conditions exclude ν from zones centered on low-order rationals, and in this “far-from-low-order-
resonance case” (where ν satisﬁes only “truncated Diophantine conditions” and is not necessarily irrational),
we again ﬁnd that xn = yn + O(ε) = y(n) + O(ε) for 0
O(1/ε) (see Theorem 2 below). Under the
additional hypothesis that the average of the perturbation vanishes, we are able to show adiabatic invariance of
solutions of system (1.4) on extended timescales up to O(1/ε2) (see Theorem 3). We thus have results for both
low-order resonant (or rational) ν, and for ν far from low-order resonance.

≤

≤

n

Finally, a simple trick permits us to explore O(ε) neighborhoods of low-order resonances ν = q/p: we set
R should be viewed as a measure of the O(ε) displacement from the resonance) and

ν = q/p + εa (where a
rewrite Eq. (1.4) as the system

∈

This is in the form of Eq. (1.1) with xn replaced by (xn, τn)T. Writing
averaged problem reduces to

f (x, τ ) = 1/p

p−1
n=0 f (x, nq/p + τ ), the

P

and we recapture the relations xn = yn + O(ε) = y(n) + O(ε) for 0
of the system

n

≤

≤

O(1/ε), where y(t) is the solution

xn+1
τn+1 (cid:19)

(cid:18)

=

(cid:18)

xn + ε f (xn, q
τn + εa

p n + τn)

.

(cid:19)

yn+1
τn+1 (cid:19)

(cid:18)

=

(cid:18)

yn + ε

f (yn, τn)

τn + εa
b

b

,

(cid:19)

d
dt (cid:18)

y
τ (cid:19)

= ε

f (y, τ )

(cid:18)

b

a (cid:19)

,

which is equivalent to the non-autonomous system dy/dt = ε

f (y, εat) ; see Proposition C below.

Initially, we state Theorems 1, 2, and 3 under the hypothesis that the perturbation εf has compact support
in its x-domain, which is assumed to be all of Rd; this avoids a priori restrictions on ε and permits clear proofs.
To obtain results better suited to applications, we then give propositions that extend our theorems to more
general perturbations on more general domains, and also to more general Diophantine conditions in which
the zones mentioned above are allowed to depend on ε; this in turn allows ν to come within O(ελ) of low-
order rationals, but with loss of accuracy in the approximation (see Propositions A and B below). Using the
generalized versions of our theorems (provided by Propositions A, B, and C), we obtain an essentially complete
description of solutions of system (1.4) on O(1/ε) timescales for various values of ν (there are however thin gaps
at the boundaries between the ν for which resonant and nonresonant motions occur; cf. Remark 2.5 below).

b

From the viewpoint of applied mathematics, perhaps the most interesting aspect of our results is that our
Theorems 2 and 3 have physically realistic, truncated Diophantine conditions in their hypotheses, yet provide
approximations valid on full O(1/ε) time intervals. For more general multiphase averaging principles, such nice
hypotheses lead to passage through resonance, and thus to approximations that are valid only on somewhat
shorter time intervals (cf. [ABG]); but we have identiﬁed an important class of simpler problems arising from
accelerator beam dynamics in which both the realistic hypotheses and the full O(1/ε) validity times can coexist.
More generally, averaging principles for maps are not new; results in this direction have been available
since the 1960s (cf. for example [Bel], [Dr]). However, a detailed theory of Eq. (1.4) suitable for applications
appears to be missing from the literature, and we proceed to ﬁll that gap in this paper. We do not however
illustrate the full range of applicability of our theorems; instead we discuss a single important example from the
class of problems which motivated this investigation, namely the so-called “kick-rotate” models from accelerator
dynamics, represented by

wn+1 = M (wn + εK(wn)),

2

Averaging for Maps

which takes the form of Eq. (1.4) under the transformation wn = M nxn. In this paper, we emphasize this model’s
application to the so-called weak-strong beam-beam interaction (see
3.2 below), but kick-rotate models also
§
apply to other localized perturbations in accelerators.

We point out that our discussion below in Section 3 is the ﬁrst mathematically rigorous treatment of this
important class of models in the sense of asymptotics. Many beam dynamics treatments start with a smooth
Hamiltonian formulation and apply canonical perturbation theory without rigorous error analysis. Resonances
are often not treated in the spirit of perturbation theory (see however the paper [Ru] for a nice discussion of
the use of perturbation theory in beam dynamics). Futhermore, delta function perturbations are often used in
this smooth Hamiltonian framework (it is of course more natural to use them with maps), making the validity
of any resulting approximations hard to assess. (The paper [CBW] gives a nice introduction to the beam-beam
interaction, but uses this Hamiltonian/delta function approach.) One notable exception to the Hamiltonian
formulation is the work on maps using Lie operators, a good discussion of which may be found in [Fo], where
the author has carried this approach quite far—to realistic machine models—but without focusing on rigorous
asymptotics. We are aware of another research group working on highly mathematical perturbation treatments
of beam dynamics in the context of maps [BGSTT] but our work here is quite distinct from theirs. To begin
with, our perturbation parameter is the size of the “kick” (cf. Section 3.1 below), whereas they study the long
time stability of the origin (which is assumed to be a linearly stable elliptic ﬁxed point), using the distance
from the origin as a perturbation parameter. Futhermore, their analysis is quite complex, as they pursue
Nekhoroshev-type results involving many successive coordinate transformations which give rise to complicated
and restrictive hypotheses that may be diﬃcult to verify in practice. In our own approach, resonances are treated
in the simplest possible rigorous way, and we obtain a natural partition of “tune space” into regions with distinct
resonance properties. We believe this is an important new feature, both conceptually and practically. Of course,
it is important to note that our method gives approximations to leading order only (using no transformations,
as mentioned earlier); this accounts for much of its radical simplicity.
It also allows us to use simple and
realistic hypotheses, in turn permitting meaningful comparison of the kick-rotate approximation with numerical
experiments. Overall, we believe that our treatment provides the starting point for a simple, eﬀective means
of studying mathematical models of beam dynamics rigorously, and that its development should complement
previous theoretical and mathematical work.

The remainder of this paper is organized as follows. In Section 2 we present the details of our averaging
results described informally above. In Section 3 we apply the averaging principles to model problems in ac-
celerator beam dynamics, showing that solutions of a class of “kick-rotate” models are well-approximated by
solutions of the corresponding averaged models. We also apply the adiabatic invariance principle to the H´enon
map (often used to model sextupole magnets in accelerators). In Section 4, we formulate the main technical
tools required to prove the results in Section 2. These are the so-called Besjes inequality for periodic functions
4.2.2). After
4.1), and its generalization to functions far from low-order resonance (Lemma 2,
(Lemma 1,
formulating and proving these inequalities, we use them to prove the mathematical results from Section 2.
Finally, for the sake of completeness, in the Appendix we state and prove two elementary results used in earlier
proofs.

§

§

We end this introduction with a few words about notation. We use the symbols N, R, R+, and Z to
, the real numbers, the positive real numbers, and the
of an integer k), and

0, 1, 2, . . .
}
indicates the Euclidean norm on Rd (or the absolute value

denote, respectively, the counting numbers
integers. The symbol
k kS denotes the uniform norm of a function over the set S; i.e.,

kS := supx∈S |

k
|
|
.
F (x)
|

| |

F

{

k

2. Averaging Principles and Adiabatic Invariance

In this section we state—and provide brief remarks on—our approximation results for maps as discussed in the
introduction above.

2.1 Averaging for Maps with Periodic Perturbations

Let us be more precise about the functions f in Eq. (1.1) to which our results apply. First, taking

S = Rd

×

N, we assume that f : S
(i) f is bounded on S and f (
, n) is locally Lipschitz, uniformly in n
·
(ii) There exists a positive integer p such that (x, n)
(iii) There is an r > 0 such that

R satisﬁes the following:

∈
⇒
f (x, n) = 0

r and n

→

N

S

x
|

| ≥

∈

⇒

f (x, n + p) = f (x, n)

When f satisﬁes (ii), we say it is “periodic with period p in its second argument”; and when it satisﬁes (iii),
it is “compactly supported in x, uniformly in n.” It follows from (i) and (iii) that f is globally Lipschitz in x,
uniformly in n. In Subsection 2.4 we show how to treat the case where f is not compactly supported.

3

Averaging for Maps

We now state a simple averaging principle for maps with periodic perturbation εf (x, n) and corresponding

averaged perturbation ε

f (y) = (ε/p)

Theorem 1. Let S = Rd
b
ε

(0, 1], and consider the system

×

∈

p−1
n=0 f (y, n) :
N, and suppose f : S

P

→

together with the associated averaged systems

Rd satisﬁes assumptions (i), (ii), and (iii) above. Fix

xn+1 = xn + εf (xn, n)

(1.1)

yn+1 = yn + ε

f (yn)

(1.2) ,

and

= ε

f (y) .

(1.3)

b

Choose T > 0 to capture the desired properties of system (1.3) on [0, T /ε]. Then there exist positive constants
C = C(T ) and C′ = C′(T ) such that the solutions xn, yn, and y(t) of Eqs. (1.1), (1.2), and (1.3) with common
initial condition x0 = y0 = y(0) exist uniquely for all time and satisfy
(Cp + C′) ε for 0

Cp ε and

yn| ≤

xn −
|

xn −
|

T /ε.

y(n)

| ≤

n

≤

≤

dy
dt

b

2.2 Averaging for Maps With Perturbations Far From Low-Order Resonance

We now present an averaging principle for system (1.4), where ν is a ﬁxed positive number. When we
write ν = q/p, we mean that q and p > 0 are relatively prime integers with the order of the rational number
ν given by p > 0. Using this convention, we ﬁrst note that if ν = q/p, then f (x, nν) has integer period p in
n, and Theorem 1 applies. In fact, as we shall see in Proposition C, Theorem 1 applies not only at low-order
rationals but also near them. However, since the error estimate in this theorem is proportional to p, it is not
very useful when p is “large.” We therefore restrict use of Theorem 1 to situations where p is “small” (the
“low-order-resonance case”), and we next focus on situations where ν is far from low-order rational numbers
(the “far-from-low-order-resonance case”).
In this case small divisors inevitably enter the analysis (see the
4.2.2) and it might be expected that ν would need to be “highly irrational” (e.g. satisfy
proof of Lemma 2,
inﬁnitely many Diophantine conditions). We show instead that the averaging principle may be established when
ν satisﬁes only ﬁnitely many Diophantine conditions to a certain order, and we call these truncated Diophantine
conditions.

§

In more precise terms, ν satisﬁes truncated Diophantine conditions if it belongs to the set

(φ, R) deﬁned
below in Eq. (4.3), where φ is the zone function of the Diophantine condition and R > 0 is the truncation
order or ultraviolet cutoﬀ, which gives precise meaning to the phrase “p large” used above (i.e., p is large if
p > R). Roughly speaking,
(φ, R) is constructed by removing open intervals centered on low-order rationals
ν = q/p. The zone function φ controls the size of the intervals removed, and the cutoﬀ R is the maximal order
of rationals from around which intervals are removed. These terms are deﬁned precisely in Subsection 4.2.1 (to
fully understand the diﬀerence between truncated and ordinary Diophantine conditions, and to appreciate the
advantages oﬀered by the former, the reader may ﬁnd it worthwhile to read that subsection).

D

D

With truncated Diophantine conditions given explicitly in Eq. (4.3), we now consider the class of functions
Rd satisfying the following

R we consider functions f : S

→

to which our next result applies. For S = Rd
conditions (analogous to (i) through (iii) in

×
2.1):
§

(j) f is of class C4 on S
S
(jj) (x, θ)
⇒
(jjj) There is an r > 0 such that

f (x, θ + 1) = f (x, θ)

∈

x
|

r and θ

R

f (x, θ) = 0

∈

| ≥

⇒
Terminology for describing conditions (jj) and (jjj) is similar to that for describing conditions (ii) and (iii)
above in Subsection 2.1. Since we assume f has unit period in its second argument, its average f is simply
1
f (y) :=
0 f (y, θ) dθ. Finally, we alert the reader that the truncated Diophantine conditions satisﬁed by ν must
be adapted to f in the sense that the zone function φ must decay appropriately; this is made precise in Eq.
(4.2) of Subsection 4.2.1 (basically φ must decay fast enough so that
(φ, R) is nonempty, but slow enough so
that the series in Eq. (4.2) converges; this accounts for assumption (j) above and our speciﬁc choice of φ as
discussed in

4.2.1).

D

R

§

4

Averaging for Maps

∈

dy
dt

We now state our averaging principle for maps with perturbations εf (x, nν) far from low-order resonance

and averaged perturbation εf (y) as above:

Theorem 2. Let S = Rd
R, suppose f : S
the zone function φ is adapted to f on Rd in the sense of Eq. (4.2). Fix ε

→

×

Rd satisﬁes assumptions (j), (jj), and (jjj) above, and suppose

(0, 1], and consider the system

xn+1 = xn + εf (xn, nν)

(1.4)

together with the associated averaged systems

yn+1 = yn + εf (yn)

(1.5) ,

and

= εf (y) .

(1.6)

C ε and

yn| ≤

xn −
|

Choose T > 0 to capture the desired properties of system (1.6) on [0, T /ε]. Then there exist positive constants
Rε, C = C(f, φ, T ), and C′ = C′(f, φ, T ) such that whenever ν
(φ, Rε) (deﬁned in Eq. (4.3)), the solutions
xn, yn, and y(t) of Eqs. (1.4), (1.5), and (1.6) with common initial condition x0 = y0 = y(0) exist uniquely for
all time and satisfy

xn −
|
Remark 2.1 For averaging principles of this type, it is natural to consider the average
N −1
n=0 f (x, nν) of f over n as mentioned in the introduction. Under mild integrability conditions
limN→∞(1/N )
1
on f , it can be shown that when ν is irrational, this average converges to
0 f (x, θ) dθ, which is the average
used here (this is related to Weyl’s equidistribution theorem; cf. [Br] and [K¨o]). However, our results do not
R
require the existence of the average of f (x, nν) over n, nor do they require ν to be irrational; instead we require
ν

(φ, Rε), and this latter set contains many rationals of order greater than Rε.

∈ D
C′ ε for 0

T /ε.

y(n)

| ≤

P

≤

≤

n

∈ D

2.3 Adiabatic Invariance on Extended Timescales

In this subsection, we consider a special system somewhat like a perturbation of an integrable Hamiltonian
system. As in Theorem 2, we assume that ν satisﬁes truncated Diophantine conditions, but now we assume
additionally that the perturbation εf has zero mean; i.e., we assume that

(jw) For each x

f (x, θ) dθ = 0

1

Rd,

∈

Z
0

invariant over timescales longer than O(1/ε):

This extra hypothesis gives an averaging principle showing that the action-like variables are adiabatically

Theorem 3. Let S = Rd
suppose the zone function φ is adapted to f on Rd (as in Eq. (4.2)). Fix ε
the system

R, suppose f : S

Rd satisﬁes conditions (j), (jj), (jjj), and (jw) above, and
(0, 1], choose T > 0, and consider

→

×

∈

xn+1 = xn + εf (xn, nν)

(1.4)

with arbitrary initial condition x0 ∈
K2(f, φ) such that whenever ν
∈ D
K1 ε + K2 ε2n for n
N. In particular, for 0
C(T ) = K1 + K2T .

∈

Rd. Then there exist positive constants Rε, K1 = K1(f, φ), and K2 =
x0| ≤
T /ε2−α, where

(φ, Rε) (cf. Eq. (4.3)), the solution xn of Eq. (1.4) satisﬁes
xn −
|

C(T ) εα for 0 < n

1, we have

xn −
|

x0| ≤

≤

≤

≤

α

Remark 2.2 Using second (or higher) order averaging, it is possible to get a better estimate of
the full O(1/ε2) time interval (see [ES] for a ﬂow version).

xn −
|

x0|

on

2.4 Extensions and Generalizations

In this subsection we give three propositions that extend and generalize our results above, making them
more suitable for applications. Our ﬁrst proposition shows that Theorems 2 and 3 may be generalized to the
case where the zones of the truncated Diophantine conditions depend on ε.

Proposition A (ε-dependent zone functions). Suppose that 0
1, and that in Theorem 2 [or Theorem
3], the zone function φ is replaced by the new zone function ελφ. Then the conclusions of the theorem remain
true, provided that the error estimates C ε and C′ε are modiﬁed to read Cε1−λ and C′ε1−λ [or C(T ) εα is
modiﬁed to read C(T ) εα−λ].

≤

≤

λ

In order to clarify and simplify the mathematical structure of our methods, we have presented Theorems
1, 2, and 3 under the assumption that the perturbations have compact support on spatial domains that are all
of Rd. Our next proposition shows that this assumption may be removed at little cost.

5

Averaging for Maps

Proposition B (more general perturbations). Suppose that the domain S = Rd
N in Theorem 1 is
replaced by the more general domain S′ = U
R in
×
Theorem 2 or 3 is replaced by S′ = U
Rd open], and assumption (iii) is removed from the hypotheses
of Theorem 1 [or (jjj) is removed from the hypotheses of Theorem 2 or 3]. Then the conclusions of Theorem 1
ε < ε0, where the threshold ε0 > 0 may be estimated
[or Theorem 2 or 3] remain true provided that:
≤
as outlined below in Subsection 4.3.2; and (b) the conclusion “exist uniquely for all time” is replaced by “exist
uniquely on the time interval [0, T /ε],” with T > 0 chosen strictly less than β(x0), where [0, β(x0)) is the
maximal forward interval of existence for the averaged ﬂow problem dˇy/dt′ =
f (ˇy) in the domain U [or for the
ﬂow problem dˇy/dt′ = f (ˇy) in U ].

Rd is open [or the domain S = Rd

N, where U

R, U

(a) 0

×

⊂

×

⊂

×

b

Remark 2.3 Of course Proposition A also applies to Proposition B.

The following proposition shows that Theorem 1 may be used to analyze the dynamics of solutions of Eq.

(1.4) in O(ε) neighborhoods of low-order resonances ν = q/p.

n

∈

×

⊂

≤

≤

→

| ≤

y(n)

f (ˇy, at).

Rd be open, S′ = U

ε < ε0 and 0

(cp + c′) ε for 0

), and c′ = c′(T,
a
|
|
T /ε.

R, and suppose
Proposition C (behavior near low-order resonance). Let U
Rd satisﬁes conditions (j) and (jj) of Theorem 2 with S replaced by S′. Fix the rational number q/p,
f : S′
R. Then Eq. (1.4) with ν = q/p + a ε may be rewritten as Eq. (1.7),
p > 0 and q relatively prime, and ﬁx a
and Theorem 1 together with Proposition B apply with x and y replaced by (x, τ )T and (y, τ )T respectively.
In particular there are positive constants ε0, c = c(T,
c p ε and
xn −
≤
|
Remark 2.4 Clearly yn evolves by yn+1 = yn + ε
f (yn, εan); and also y(n) = ˇy(εn), where ˇy evolves via
dˇy/dt =

b
Remark 2.5 Propositions A and B characterize the motion of xn to within O(ε1−λ) for ν away from low-
order rationals, i.e., outside of O(ελφ(p)/p) neighborhoods of rationals q/p with 0 < p
Rε. For these ν the
nonresonant normal form of Eq. (1.6) applies. Proposition C characterizes the motion to within O(εp) for ν
inside O(ε) neighborhoods of q/p. For these ν the resonant normal form of Eq. (1.9) applies. What is missing
is information about the motion for ν in the gaps between the domains of validity of the resonant normal form
and the nonresonant normal form. The size of the gaps decreases to zero as λ
1; however, the error in the
nonresonant normal form simultaneously deteriorates to O(1). High-order rationals, i.e. q/p with p > Rε, are
of course treated using Proposition B. It is interesting to note that they may also be treated using Proposition
C; however, the O(pε + ε) error bound deteriorates to O(1) as p approaches O(1/ε).

) such that
|

yn| ≤

xn −
|

a
|

ր

≤

b

3. Examples from Accelerator Beam Dynamics

Modern particle accelerators operate at the limits of current technology, and their design and operation depend
crucially on an understanding of the dynamics of particle beams. In this section we give examples showing how
Theorems 1 and 2 (supplemented by Propositions A, B and C) may be used to analyze a class of beam dynamics
models, and how Theorem 3 may be used to analyze the H´enon map (which is itself a model of certain features in
beam dynamics). In fact, our averaging principles for maps have features that make them especially eﬀective for
this purpose; namely, they compare solutions of the exact and averaged model problems in the simplest possible
way, and produce rigorous mathematical bounds on the diﬀerence between these solutions in an essentially
optimal fashion. Although O(1/ε) times may be short by accelerator standards (and adiabatic invariance
of actions on O(1/ε2) times is perhaps ideal), we see our work here as an important step in understanding
the dynamics of maps on long timescales. We emphasize that these are rigorous error bounds and not error
estimates. Comparisons between simulations and the averaging appoximations indicate that the error bounds
hold on much longer time intervals.

We point out that this section extends certain results of [ES] in at least two important ways: ﬁrst, by
using maps, we are able to incorporate delta function “kicks” that could not be treated rigorously via the
ﬂow methods of [ES]; second, the truncated Diophantine conditions used here are more physically realistic and
4.2.1). Finally, we note that our maps need not be
explicit than the small divisor conditions used there (cf.
polynomial here; this is particularly important for the weak-strong beam-beam problem where the perturbation
is not polynomial. (We also remind the reader of our discussion of this section in the Introduction.)

§

We begin in Subsection 3.1 with a general “kick-rotate” model in one degree of freedom. In Subsection 3.2
we apply the results of Subsection 3.1 to the important case of the weak-strong beam-beam interaction, and in
Subsection 3.3 we apply Theorem 3 and Proposition B to the H´enon map.

6

Averaging for Maps

3.1 The One Degree of Freedom Kick-Rotate Model

In this subsection, for purposes of illustration we focus on a simple but widely used class of beam dynamics
models: the so-called one degree of freedom “kick-rotate” models. We note, however, that our methods may be
generalized to treat models with several degrees of freedom and at higher order (this will be the subject of a
future publication [DEVS]).

A circular accelerator (in storage mode) has a closed orbit, that is, there exists a unique solution of the
equations of motion which has the periodicity of the (circular) acclerator. A complete, three-degree-of-freedom
description of single-particle beam dynamics involves three spatial coordinates in the co-moving (Frenet-Serret)
system deﬁned by the projection of the closed orbit on conﬁguration space, and their three conjugate momenta.
It is convenient to study the dynamics in terms of a Poincar´e map (one-turn map) at a ﬁxed azimuthal location
in the ring. Here we consider one transverse degree of freedom and let w1 and w2 denote the spatial coordinate
and conjugate momentum in the Poincar´e section. The base-model consists of a “rotation with unperturbed
tune ν” representing the linear “betatron motion.” Perturbations of this model often consist of an instantaneous
change in momentum w2 at a ﬁxed location in the ring, which depends only on the spatial coordinate w1 (a
“kick-map”).
If we take this ﬁxed location to be the azimuthal position of the Poincar´e section, then the
perturbed dynamics is given by the so-called “kick-rotate” model

wn+1 = R wn + ε R

,

where R := eJ 2πν ,

(3.1)

0

(cid:18)

H ′(w1,n) (cid:19)

−

J

0
1

−

(cid:18)

1
0 (cid:19)

that is, a kick followed by a rotation through the angle 2πν about the origin. Here

:=

is the

∈

unit symplectic matrix and H ′ is the “kick function.” Since R depends only on the fractional part of ν we shall
[0, 1] in the following. The map deﬁned by Eq. (3.1) is symplectic since it is the composition of
assume ν
symplectic maps. The notation w1,n indicates the ﬁrst component of the vector wn = (w1, w2)T
n (we hope the
reader will forgive us the ambiguity of using wn to denote a vector and w1 or w1,n its ﬁrst component, and w2
or w2,n its second component; the meaning should be clear from context, since we rarely explicitly set n = 1 or
n = 2).

0, 1

For R = 1, i.e. ν

nH ′(w1,0))T and thus
is
−
∈ {
2nH ′(w1,0))T and the motion is
monotonically increasing to inﬁnity. For R =
−
again unbounded. Thus for ν
= 0, the distance from
the origin is monotonically increasing. The basic question is, What happens for general ν? We shall apply the
results of Section 2 to answer this question for most ν in [0, 1].

, Eq. (3.1) is easily solved and gives wn = (w1,0,
1 (i.e., ν = 1/2), w2n = (w1,0,

and for all initial conditions where H ′(w1,0)

w2,n|
|

0, 1/2, 1

∈ {

−

}

}

Eq. (3.1) may be written as

wn+1 = R wn + ε R F (wn)

and the transformation wn = Rn xn recasts Eq. (3.2) as:

xn+1 = xn + ε R−n F (Rn xn) =: xn + ε f (xn, nν) ,

which is in the standard form for averaging (cf. Eq. (1.4)).

It is easy to see that f (x, θ) = H ′(x1 cos 2πθ + x2 sin 2πθ) (sin 2πθ,

cos 2πθ)T = (∂H/∂x2 ,

∂H/∂x1)T.

−

−

Thus if we deﬁne

(x, θ) := H(x1 cos 2πθ + x2 sin 2πθ), then Eq. (3.3) becomes

H

xn+1 = xn + ε

(xn, nν) .

J ∇xH

Equations (3.3) and (3.4) also deﬁne symplectic maps, since the transformation is symplectic.

3.1.1 The kick-rotate model in the far-from-low-order-resonance case

In this subsection, we examine the behavior of the kick-rotate model (3.1) in the case where the tune
(ελφ, Rε). In physical terms, this means that the tune

belongs to the ε-dependent truncated Diophantine set
is “far from low-order resonance.”
The most useful form of

D

k∈Z Hk(J) ei2πkt, from which it follows that

(x, nν) =

k∈Z Hk(J(x)) ei2πk(Φ(x)+nν), where Φ and J are

H

in Eq. (3.4) is given in terms of the Fourier series H(√2J sin 2πt) =

deﬁned by x1 = √2J sin(2πΦ) and x2 = √2J cos(2πΦ). The averaged problem is then
P

P

H

(3.2)

(3.3)

(3.4)

(3.5)

yn+1 = yn + ε

J ∇yH0(J(yn)) ,
7

6
Averaging for Maps

where H0(J) =

1

0 H(√2J sin 2πt) dt. The associated (scaled) ﬂow problem is
R

dˇy
dt

= 2π ω(J(ˇy))

ˇy ,

ˇy(0) = x0

J

where 2πω(J) = H ′
0(J). We note that the map deﬁned in Eq. (3.5) is only symplectic through O(ε); however,
the vector ﬁeld in Eq. (3.6) is Hamiltonian with Hamiltonian H(J(ˇy)). It is easy to check that J(ˇy) = 1
1 + ˇy2
2)
is constant along orbits so that J(ˇy) = J0 = J(x0) and thus ˇy(t) = eJ 2πω(J0)t x0. Finally, Theorem 2 together
with Propositions A and B give

2 (ˇy2

wn = eJ 2πn(ν+εω(J0)) x0 + O(ε1−λ)

for 0
≤
with λ

n
[0, 1), ν

≤

∈

∈ D

T /ε, with ε suitably restricted as in Proposition B for non-compactly supported perturbations,

(ελφ, Rε), and with Rε deﬁned by the condition

H ′

k(J)

∇xJ

kD(δ) +

k

Hk(J)2π

∇xΦ

kD(δ) < ζε ,

k

X|k|>Rε

where D(δ) is the δ-tube around the solution of Eq. (3.6) (see the deﬁnition of the δ-tube in

4.3.2).

§

3.1.2 The kick-rotate model in the near-to-low-order-resonance case

For ν near low-order resonance, we write ν = q

p +εa when p is not too large (more precisely, when 0 < p

for suitable ζ, ε > 0 in (3.8)). Thus using Eq. (1.7), our problem becomes

xn+1
τn+1 (cid:19)

(cid:18)

=

(cid:18)

xn + ε

J ∇xH

τn + εa

(xn, n q

p + τn)

.

(cid:19)

We are now in the periodic case, with averaged Hamiltonian
x2 sin(2π[n q
ated scaled ﬂow (dˇy/dt, dτ /dt) = (
Propositions B and C then give

p + τ ])). The averaged problem is (yn+1, τn+1) = (yn + ε

J ∇y
(ˇy, τ ), a). Solving for τ gives dˇy

J ∇ˇy

H
b

H
dt =
b

(x, τ ) = (1/p)

H
b

p−1

n=0 H(x1 cos(2π[n q
p + τ ]) +
(yn, τn), τn + εa), with its associ-
(ˇy, at). Theorem 1 with

P

J ∇ˇy

H
b

wn = eJ 2πnν xn = eJ 2πn( q

p +εa) ˇy(εn) + O(ε)

(3.10)

T /ε and for ν = q

n

≤

≤

for 0

look more closely. It turns out that
H
Hamiltonian system might be found with the symplectic transformation ˇy
b
is indeed true and gives the autonomous system

p + εa. However, it is not clear we have achieved a great simpliﬁcation and so we
θ′), which suggests that an autonomous
ˇz deﬁned by ˇy = e−J 2πat ˇz. This

2πθ′)ˇy, θ) =

(exp(

(ˇy, θ

H
b

−J

7→

−

with Hamiltonian

(ˇz) = 2πaJ(ˇz) +

(ˇz, 0). Equation (3.10) thus becomes

K

H
b

dˇz
dt

= 2πa

ˇz +

J

(ˇz, 0)

J ∇ˇz

H
b

wn = eJ 2πn q

p ˇz(εn) + O(ε)

from which the behavior of the approximation is now quite transparent.

3.1.3 Summary of the kick-rotate model

We now have the following picture of the solutions of Eq. (3.1) on O(1/ε) time intervals. For ν

(ελφ, Rε)
the motion is given by Eq. (3.7) and thus our kick-rotate map behaves like a twist map with tune ν + εω(J0).
For these ν the eﬀect of the perturbation is slight; the up and down kicks on the integral curves essentially
cancel and the main eﬀect of the perturbation is to create an amplitude-dependent tune. For ν = q
p + εa, we
see that in the p-periodic Poincar´e map, the approximate motion moves slowly along the phase curves given by
the level curves of
(ˇz). We thus have an essentially complete picture of the motion (except for small gaps in
ν as discussed in Remark 2.5).

∈ D

K

(3.6)

(3.7)

(3.8)

Rε

≤

(3.9)

(3.11)

(3.12)

8

Averaging for Maps

3.2 The Weak-Strong Beam-Beam Eﬀect

As a concrete example, we study the weak-strong beam-beam eﬀect for round Gaussian beams in collider
rings. We treat the lattice (the sequence of transport maps through the various components of the accelerator)
as a stable, linear symplectic map, and the beam-beam interaction as localized at the point of the ring where the
bunches collide (the “interaction point”). The phase space distribution of the strong beam at the interaction
point is assumed to be stationary; in particular the beam-beam eﬀect of the weak beam on the strong beam
is ignored. Therefore the beam-beam eﬀect on the particle trajectories of the weak beam may be treated in
the single particle picture, i.e., as a nonlinear kick due to the electromagnetic forces experienced while passing
through a (longitudinally) short and time-independent external charge distribution. We ignore coupling to
the longitudinal motion, and we assume that the strong beam is represented by an axially symmetric charge
distribution around the common closed orbit of the two beams in the transverse coordinate plane, so that it
suﬃces to study a single phase plane. We start by stating the model in the so-called canonical accelerator
(v1, v2)T, where v1 has the dimension of a length and v2 := pv1 /p0 is dimensionless (p0 is the
coordinates v
constant longitudinal momentum of the particle on the closed orbit, usually much larger than pv1, the canonical
conjugate of v1). Normally the lattice is chosen so that the unperturbed beam envelope at the interaction

≡

(cid:18)

v2 −

cos(2πQ0)
sin(2πQ0)/β

ηK(v1), where η := 8π σ

β sin(2πQ0)
point has a local minimum, and thus the linear lattice is represented by M :=
cos(2πQ0) (cid:19)
R and β > 0 are the unperturbed tune and the unperturbed beta-function of the weak beam
where Q0 ∈
at the interaction point, respectively (the beam envelope has width of order √β). The beam-beam kick is
given by v2 7→
1 is
the spatial standard deviation of the Gaussian representing the strong beam, and ξ is the (typically small)
linear beam-beam tune shift parameter. Our diﬀerence equation in the accelerator coordinates now reads
vn+1 = M vn + η M (0,
Remark 3.1 In the special case of two matched, axially symmetric Gaussian beams, ξ is given by ξ =
1), where N ∗ is the number of particles in the strong beam, rp is the so-called classical particle
±
radius of the species, σ1 is the spatial RMS beam width of the two beams, and γ > 1 is the Lorentz factor of
the weak beam.

β ξ, and where K(v1) := 1

N ∗rpβ/(4πγσ2

K(v1,n))T.

. Here σ∗

v2
1
2σ∗2

v1 (cid:16)

1 (cid:17)(cid:17)

(cid:16)−

exp

∗2
1

−

−

−

1

,

We now rescale the variables according to w

(w1, w2)T := (v1/σ1, βv2/σ1)T, where σ1 is the standard
deviation of v1 for the weak beam when matched to its unperturbed lattice (i.e., when the phase space density
depends only on vT B−1 v, where B := diag(β, 1/β) is the beam matrix at the interaction point; note that
σ2 := σ1/β is then the standard deviation of v2 for the weak beam). In the rescaled variables the diﬀerence
equation becomes

≡

wn+1 = R wn + ε R

0

(cid:18)

H ′(w1,n)(cid:19)

−

,

(3.13)

where R := eJ 2πQ0 , ε := 8πr2ξ, r := σ∗

1 /σ1, and H ′(w1) :=

1
1
w1 (cid:18)

−

exp

(cid:18)−

w2
1
2r2 (cid:19)(cid:19)

. Thus Eq. (3.13) has

the form of Eq. (3.1). We note that ε is dimensionless and small whenever ξ is small, that w1 and w2 are
dimensionless and O(1) for a typical particle trajectory of the weak beam, and that in a collider the two beams
1/(2r2 + s′) one can
are typically matched to each other so that r
show that

1. By using the substitution s2/(2r2) = w2

≈

w1

H(w1) :=

1
0 (cid:18)
Z

−

exp

(cid:18)−

s2
2r2 (cid:19)(cid:19)

ds
s

=

1
2 Z

∞

1
0 (cid:18)

−

exp

(cid:18)−

w2
1
2r2 + s′ (cid:19)(cid:19)

ds′
2r2 + s′ ,

(3.14)

where we have taken H(0) = 0.

Before proceeding we check the linearized behavior about the equilibrium w = 0. The linearization of

Eq. (3.13) is wn+1 = G wn , G := R

1
4πξ
(cid:18)
−
The system is linearly stable if and only if
tr G
|
|
by cos(2πQ) := 1
Q = Q0+ξ+O(ξ2), thus justifying the name “linear beam-beam tune shift parameter” for ξ. For Q0 ∈ {
we see that
Q0 ∈ {
3.2.2.

0
1 (cid:19)
< 2, i.e., provided the linearly perturbed tune Q, deﬁned
It follows that
0, 1/2, 1
}
= 2, consistent with the discussion in the paragraph immediately following Eq. (3.1). For
tr G
|
|
and thus we have linear stability, which is consistent with the results of Subsection
tr G
,
|
|

, where we have used the fact that H ′′(0) = (2r2)−1.

2πξ sin(2πQ0), is real and satisﬁes

2 tr G = cos(2πQ0)

cos(2πQ)
|

1/4, 3/4

= 2π

< 1.

ξ
|

−

}

|

|

9

Averaging for Maps

3.2.1 The weak-strong beam-beam eﬀect in the far-from-low-order-resonance case

For Q0 ∈ D

(ελφ, Rε) the motion is given by Eq. (3.7), where ν

Q0, and where ω is determined as
follows. We use Eq. (3.14) to obtain H0(J) :=
w , where
I0 is the zero-th order modiﬁed Bessel function and where we have used the expansion exp(x cos(y)) = I0(x) +
2

0 H(√2J sin(2πt)) dt = 1
R

∞
k=1 Ik(x) cos(ky). Omega is given by

J/(2r2)
0
R

e−wI0(w)) dw

(1

≡

−

2

1

P

2πω(J) := H ′

0(J) =

1
1
2J (cid:18)

−

exp

(cid:18)−

J
2r2 (cid:19)

J
2r2 (cid:19)(cid:19)

I0 (cid:18)

=

1
4πJ Z

2π

1
0 (cid:18)

−

exp

J sin2 ϑ

(cid:18)−

r2 (cid:19)(cid:19)

dϑ .

(3.15)

The amplitude-dependent tune shift εω(J0) is identical to that derived in [ES] and justiﬁes the use of the delta
function there. Notice also that εω(0) = ξ, in agreement with the linearization above.

3.2.2 The weak-strong beam-beam eﬀect in the near-to-low-order-resonance case

K

K

P

H
b

H
b

1/4, 3/4

(ˇz, 0), where

(ˇz, 0) = (1/p)

(ˇz) approaches 2πaJ(ˇz), and for a

(ˇz, 0) = H(ˇz1), and for q/p
1/3, 2/3

In Subsection 3.1.2 we found the Hamiltonian for the autonomous system (3.11) to be

(ˇz) = 2πaJ(ˇz) +
p−1
n=0 H(ˇz1 cos[2πnq/p] + ˇz2 sin[2πnq/p]) and Q0 = q/p + aε. Since H(x)
H
= 0 the integral curves become circles at large
approaches zero for large x,
b
distances from the origin. The motion on these circles is clockwise for positive a and counterclockwise for negative
a, thus a bifurcation in the phase plane portrait occurs at a = 0. In the case where q/p
it is easy to
(ˇz, 0) = 1/2 [H(ˇz1) + H(ˇz2)] since H is
see that
one also easily ﬁnds
}
H
ˇz1/2+√3ˇz2/2)+H(
√3ˇz2/2)].
an even function. For q/p
(ˇz, 0) = 1/3 [H(ˇz1)+H(
b
H
−
−
in these cases (see [DEV] for more ﬁgures).
We brieﬂy discuss the phase plane portraits for
b
) and for a = 0 we have dˇz1/dt = 0 and dˇz2/dt = H ′(ˇz1,0). Thus the motion
is identical to the exact case, as discussed just before Eq. (3.2), since Eqs. (3.1) and (3.3) and the associated
averaged problem are identical. For a small but positive, the origin is a (nonlinearly) stable center and the phase
portrait is a one-parameter family of ovals which are long and thin in the ˇz2 and ˇz1 directions respectively. As
a increases to modest values the ovals become circular, consistent with the expectation of “stability far from
low-order resonance.” As a decreases from zero, the origin becomes a saddle, and two centers emerge from
for
small. As a decreases further, the centers coalesce with the
inﬁnity at (
saddle at 4πar2 =
1 the only critical point is a center at the origin, again consistent with
our expectation of stability (see Figure 1).

a
2π
|
∼
1, and for 4πar2 <

In the ﬁrst case (q/p

∈ {
we ﬁnd
}

c, 0), where c

0, 1/2, 1

ˇz1/2

|
−

∈ {

0, 1

∈ {

∈ {

a
|

1/

p

−

±

−

K

}

}

|

The motion for q/p = 1/2 in the period two Poincar´e map is identical with the motion for q/p = 1; the

intermediate values may be obtained by rotating the phase plane portrait by a half turn (also see Figure 1).

a=−1/4

π

a<<0

a<0

a>0

a=0

a>>0

Figure 1: The qualitative phase plane portraits for r = 1 in the case q/p

0, 1/2, 1

∈ {

}

}

±

∈ {

2πi(a

For q/p

1/4, 3/4

the phase plane portrait (see Figure 2) has a four-fold symmetry, being invariant
under reﬂections about the two axes and about the lines ˇz2 =
ˇz1. The origin is a critical point and its
±
1/(8πr2). Thus the origin is a (nonlinearly)
linearized vector ﬁeld has eigenvalues
ac), where ac =
−
stable center for a
= ac, and it is easily checked that the origin is also a stable center for a = ac and that the
0 there are no other equilibria and the
rotation is clockwise for a > ac and counterclockwise for a
ac. For a
phase plane portrait is a one-parameter family of concentric ovals. For a small the (closed) integral curves look
like four-pointed stars, with smoothed points on the axes, and as a increases the curves become circles. For
ac < a < 0 there are eight nonzero critical points. The four critical points (
c) are centers and the four at
c, 0) are saddle points, where c is the unique positive root of 4πac + H ′(c) = 0. The critical points
(0,
form an island structure in a neighborhood of radius c of the origin in the phase plane. This island structure
ac,
emerges from inﬁnity as a decreases through zero and coalesces into the origin as a decreases to ac. For a

c) and (

±

±

≥

−

≤

±

±

c,

≤

10

6
6
Averaging for Maps

the origin is again the only equilibrium, and it is a stable center with counterclockwise rotation. The portrait
is again a one-parameter family of ovals approaching circles as a decreases from ac.

a =

0.050

a =

π/8 a =

0.005

a =

0.000

a = +0.005

a= +0.005

−

a = +0.050

a= +0.05

10

a= -.05

−

10

y(t)

5

–5

–10

a= –0.005

−

10

y(t)

5

0

–5

–10

a= 0

−

10

y(t)

5

–5

–10

y(t)

y(t)

4

2

0

–2

–4

5

0

–5

–10

–10

–5

10

–10

–5

5

10

–10

–5

10

–4

–2

2

4

–10

–5

10

x(t)

x(t)

5

x(t)

5

x(t)

5

x(t)

Figure 2: The phase plane portraits for r = 1 in the case q/p

1/4, 3/4

.

∈ {

}

is the same for all q/p

Because H is an even function,

. Thus the phase plane
}
portraits are the same for resonances of order three and six, and these portraits have a six-fold symmetry,
√3 ˇz1.
ˇz1/√3 and ˇz2 =
being invariant under reﬂections about the axes ˇz1 = 0, ˇz2 = 0 and the lines ˇz2 =
Qualitatively, the behavior as a function of a is similar to that in the case of resonance of order four (e.g., the
island structure is similar, but there are now six rather than four islands). The critical value ac at which the
islands coalesce in the origin turns out to be the same as in the case p = 4.

1/6, 1/3, 2/3, 5/6

H
b

∈ {

±

±

3.2.3 Summary of the weak-strong beam-beam eﬀect

Our basic equation is Eq. (3.13) with R and H ′ deﬁned there. Remark 2.5 and the summary in Subsection
3.1.3 apply. Here we emphasize that the motion depends only on ξ (or equivalently ε), and on the fractional
[0, 1] over O(1/ξ) time intervals. Away
part of Q0, and that we have a fairly complete description for Q0 ∈
from low-order resonances, the motion is given by Eq. (3.7), with ν = Q0 and with ω deﬁned in Eq. (3.15).
Thus the motion takes place approximately on circles with an amplitude-dependent tune. Near low-order
resonances the behavior is given by Eq. (3.12), and ˇz(t) evolves according to the time-independent Hamiltonian
p−1
n=0 H(ˇz1 cos(2πnq/p)+ ˇz2 sin(2πnq/p)). As described above in Subsection 3.2.2, this
K
Hamiltonian has a rich variety of behaviors depending on the order p of the resonance, and on the displacement
aε from the resonance. In particular the behavior varies considerably for a > 0, a = 0 and a < 0. Finally, we
again emphasize that while our description is fairly complete, there are gaps between the regions of validity of
the nonresonant normal form which does not depend on Q0, and the resonant normal form which does depend
on Q0 (cf. Remark 2.5).

(ˇz) := 2πaJ(ˇz)+(1/p)

P

3.3 The H´enon Map

We now apply Theorem 3 to the H´enon map (in beam dynamics this map is a standard model for the eﬀect
of a localized sextupole magnet in an otherwise linear lattice). The standard form of the H´enon map is Eq.
(x, θ) = (x1 cos 2πθ + x2 sin 2πθ)3/3, which clearly has
(3.1) with H(w1) = w3
(x, θ) in Eq. (1.4) has zero average, so that hypothesis (jw) of
zero average. It follows that f (x, θ) =
Theorem 3 is satisﬁed. Thus, by Theorem 3 and Proposition B, for appropriate ε, T > 0, ν
D(φ, Rε), and for
any 0

= O(εα) on the discrete time interval 0

1/3. This gives Eq. (3.4) with

1, we have

J ∇xH

T /ε2−α.

H

∈

α

n

≤

≤

xn −
|

x0|

Remark 3.2 The above discussion simply applies Theorem 3 as is (and thus also covers the case of more general
has a ﬁnite Fourier series (e.g. when H is a polynomial, as above) the proof of Theorem 3 may
H), but when
be simpliﬁed, both in terms of the smoothness requirement (see Remark 4.4) and in terms of the estimates in
Lemma 2. In particular, for the H´enon map above, gk = 0 except for
, so taking Rε = 3, we see that
the series deﬁning C1 and C2 in Lemma 2 have only four terms each, while the tail-series of Lemma 2 vanishes.

| ∈ {

1, 3

k
|

H

}

≤

≤

4. Proofs and Additional Mathematical Results

As the title indicates, this is the most mathematical section of the paper. Subsection 4.1 treats periodic maps;
this is quite straightforward, and may be read as a kind of introduction to the deeper results of the next
subsection. Subsection 4.2 concerns the considerably more complex case of maps far from low-order resonance,
and requires a (short) discussion of small divisors and truncated Diophantine conditions. The use of such
conditions is not new (for example, related conditions are used to obtain general multiphase averaging results
in [ABG]), but as explained in the introduction, we believe our use of them in the present context is the most
innovative aspect of this paper from the viewpoint of applied mathematics.

11

Averaging for Maps

4.1 Periodic Systems

In this subsection we give a self-contained presentation of the remarkably simple technology required to
prove the averaging principle for maps with periodic perturbations. This consists of the Besjes inequality for
periodic functions (below), followed by its application to the proof of Theorem 1.

4.1.1 The Besjes inequality for periodic functions

Let U

Rd be open, and S = U

×
assumption concerning the function g : S

⊂

N. The Besjes inequality relies in an essential way upon the following

R, periodic with period p in its second argument:

(iv) For each x

U ,

g(x, n) = 0

p−1

Xn=0

∈

→

When g has period p in n and satisﬁes (iv), we say it has zero mean in n. We now state the Besjes inequality

for periodic maps as

Rd be open, S = U

Lemma 1. Let U
⊂
and (iv) above and is globally x-Lipschitz with Lipschitz constant L
which the successive diﬀerences xn+1 −

×
≥
xn are bounded by M (i.e., supn |

N, and suppose g : S

→

R satisﬁes assumptions (i), (ii) (from

2.1)
U is a sequence for
N,

M ), then for all N

∞
n=0 ⊂

§

0. If
{
xn+1 −

xn}
xn| ≤

∈

N −1

g(xn, n)
(cid:12)
(cid:12)
(cid:12)

Xn=0

(cid:12)
(cid:12)
(cid:12)

1
2

≤

N pLM + p

g

kS.

k

Proof. Using the notation [a] to designate the greatest integer in a, we ﬁrst set l = [(N
number of periods of g contained in the segment
and of zero mean, we write

0, 1, 2, . . . , N

1)/p] (so that l is the
). Then using the fact that g is periodic

−

−

{

}

1

N −1

Xn=0

g(xn, n) =

g(xn+kp, n)

g(xkp, n)

+

g(xn, n) .

l−1

p−1

Xk=0

Xn=0(cid:16)

N −1

−

(cid:17)

Xn=lp

Now since g is Lipschitz in its ﬁrst argument, and since

xn+kp −
|

xkp| ≤

M n, we have

N −1

l−1

p−1

LM n +

≤

Xk=0

Xn=0

N −1

Xn=lp

g(xn, n)
|
|

g(xn, n)
(cid:12)
(cid:12)
(cid:12)

Xn=0

(cid:12)
(cid:12)
(cid:12)

p(p

1)

lLM

≤

−
2

+ p

g

k

kS ≤

N pLM + p

g

kS . //

k

1
2

Remark 4.1 The original version of this lemma (Lemma 1 of [Bes]) was formulated for use in the proof of
averaging principles for ODEs on O(1/ε) timescales, and we use its analog in a similar way below for maps. The
original lemma bounds the time by a constant that is O(1/ε) and gives a ﬁnal bound that is O(ε), independent
of time. We have found, however, that retaining the (here discrete) time-dependence makes the result more
versatile (cf. the proof of Theorem 3 below).

Remark 4.2 Lemma 1 (and many of its generalizations) may also be proved using “summation by parts,” as
in the proof of Lemma 2 below.

We now illustrate the use of Lemma 1 by using it to prove Theorem 1.

4.1.2 Proof of Theorem 1

Assume the hypotheses of Theorem 1 (cf.

2.1). It is clear from assumption (iii) that the solutions xN and
§

yN exist uniquely for all N

N. To see that the approximation relation holds, we write

xN −
|

yN |

= ε

f (xn, n)

f (yn)

= ε

f (xn, n)

f (yn, n) + f (yn, n)

f (yn)

−

−

b

(cid:17)(cid:12)
(cid:12)
(cid:12)
(cid:12)

∈

N −1

Xn=0 (cid:16)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

−

(cid:17)(cid:12)
(cid:12)
(cid:12)
(cid:12)
xn −
|

b
N −1

Xn=0

εL

≤

N −1

Xn=0 (cid:16)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

N −1

Xn=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)

f (yn, n)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

e

+ ε

yn|

12

Averaging for Maps

N −1

f (y, n) := f (y, n)

where L is the x-Lipschitz constant of f , and where
f (y) (the “oscillating part of f ”)
satisﬁes the hypotheses of Lemma 1 with U = Rd (in particular,
f has zero mean and y-Lipschitz constant 2L).
e
yN | ≤
yn| ≤
yn+1 −
Using the fact (from Eq. (1.2) and assumption (i)) that
e
|
f
εL
yN | ≤
xN −
kS
|
(cid:1)
e
T /ε. Applying Gronwall’s inequality for sequences (Lemma 3 in the Appendix) and setting
T /ε, as claimed. The second part of
T /ε) follows from Lemma 4 (Appendix) and the

kS. Thus
e
yN | ≤
xN −
|
(Cp + C′)ε for 0

k
k
b
yn|
xn −
|

xN −
|
Rd +
f

Cp ε for 0 < N

M := ε
N −1

Rd, we have

LT
(cid:0)

xn −
|

Rd + ε p

N p 2L ε

+ ε p

yn|

Rd +

k
b

+ ε

Xn=0

ε L

1
2

k
b
eLT gives
kS
y(n)
xn −
(cid:1)
e
|

| ≤

Xn=0
for 0 < N
≤
C =
k
k
k
Theorem 1 (namely
b
triangle inequality. //

LT
(cid:0)

−

≤

≤

≤

n

b

k

k

k

k

f

f

f

f

f

Remark 4.3 The preceding is no doubt one of the simplest possible proofs of an averaging principle for
maps. Part of the simplicity derives from the use of Lemma 1, and part derives from the assumption of
compact support (iii), which permits us to dispense with questions of the existence intervals for solutions.
Thus, although assumption (iii) is often invalid in practice, by using it we are able to show that the basic
estimates of the averaging method do not require restrictions on the size of ε; such restrictions are instead
introduced by considering solutions’ existence intervals, or by methods of proof which rely on near-identity
transformations (which may in turn require restrictions on ε for their inversion). Of course our results may be
2.4), and may also be combined with more
extended to cases with ﬁnite existence intervals (see Proposition B,
traditional transformation methods to obtain eﬃcient results at higher order [DESV].

§

4.2 Systems Far From Low-Order Resonance

In this subsection we generalize the Besjes inequality to functions far from low-order resonance in their second
argument. We then use this inequality to prove Theorems 2 and 3. First, however, we present the following
brief discussion.

4.2.1 Resonant zones, Diophantine conditions, and the ultraviolet cutoﬀ

Before stating and proving our next analog of Besjes’ inequality, we discuss aspects of resonance, small
divisors and Diophantine conditions that will be needed in the sequel. A more comprehensive introduction may
be found in [Yo].

Zone Functions and Diophantine Conditions

= ν

In dynamical systems, Diophantine conditions arise naturally as a means of “controlling small divisors”
and “avoiding resonances.” Typically, in one dimension, divisors of the form e2πikν
Z and
R) occur as the denominators of terms in a series indexed over k, together with numerators which
0
. Clearly divisors cannot vanish, so rational (or “resonant”) values of ν
decrease to zero with increasing
|
must be avoided. And although irrational ν do not cause divisors to vanish, when “nearly resonant,” they may
generate such small divisors as to cause divergence of the series in which they occur.

1 (with 0

= k

k
|

−

∈

∈

By using a suitably decreasing zone function φ : R+ →

R+ (the inverse of which is called an “approximation
function” in [R¨u]), we deﬁne the “highly nonresonant” values of ν as those belonging to the corresponding
Diophantine set

(φ) =

ν

R

e2πikν
|

1

k
φ(
|

), k
|

Z

0

,

|

ν

1

{

{

(cid:12)
(cid:12)

∈

∈

D

−

−

R

\{

| ≥

Zk =

}}
∈
(cid:12)
(φ) may be thought of as R with countably many zones removed,
which is a Cantor set. The Diophantine set
(cid:12)
D
e2πikν
= 0 is the countable union
k
< φ(
where the zone
|
|
of open intervals centered on rational numbers of the form q/k (q
(φ),
consider its intersection with the interval [0, 1]. For each ﬁxed k > 0 we remove k intervals of length 2δ from
ei2πk(δ+l/k)
φ(k)/(2πk), and thus the
[0, 1], where
|
[0, 1] of the
total length of
Zk ∩
∞
1 φ(k) dk.
overlaps of all zones
Thus a typical zone function of the form φ(r) = γr−(τ +1) with τ > 0 removes zones of total length no more
R
than γ/(πτ ) from [0, 1]. When this total length is less than one, the Diophantine set
(φ) has positive measure
(and is therefore nonempty).

=
−
|
[0, 1] is 2δk
Zk with [0, 1] is (approximately) bounded by

< φ(k). For small φ(k), this gives δ
φ(k)/π. It follows that the total length of the union
[0, 1])

Z). To better see the structure of

corresponding to a particular k

∪kZk ∩
(1/π)
≈

ei2πkδ
|
≈

k length(

Zk ∩

)
}
|

P

≈

−

D

D

∈

1

1

|

(4.1)

More generally, if the zone function φ decreases too slowly, then the union of the excluded zones may be so
large that its complement,
(φ) may be too large,
(φ), is empty. Conversely, if φ decreases too rapidly, then
and may contain values of ν so close to resonance as to cause divergence of the series in which small divisors
appear.

D

D

The following terminology is useful for describing zone functions that permit convergence of the series arising
Rd has period 1 in its second argument and

in the proof of Lemma 2 below. If U

Rd is open, and f : U

R

⊂

×

→

13

6
6
6
Averaging for Maps

Fourier series f (x, θ)
requiring only that f is integrable in θ), then given a zone function φ such that
P
adapted to f on U provided

0 f (x, θ) e−2πikθ dθ,
k∈Z fk(x) e2πikθ (where the kth Fourier coeﬃcient is fk(x) =
, we say that φ is
=
(φ)
R
∅

∼

D

1

fkkU
k
)
k
φ(
|
|

X06=k∈Z

<

∞

and

k

DfkkU
)
k
φ(
|
|

<

,

∞

X06=k∈Z

(4.2)

where Dfk denotes the derivative of the function fk : U
existence of zone functions adapted to f are not severe, as we now show.

→

Rd. Smoothness conditions on f assuring the

Smoothness Conditions Ensuring the Existence of Adapted Zone Functions

Several questions naturally arise concerning the relationship between the smoothness of f and the existence
of zone functions adapted to f as in Eq. (4.2). Formulating the sharpest possible conditions in this direction is
somewhat delicate, but the following brief discussion should serve as a good starting point.

1

×

R

→

Rd is of class Cp+1(U

We ﬁrst recall that for τ > 0, the zone function φ(r) = γr−(τ +1) generates a nonempty Diophantine set
(φ) provided γ > 0 is suﬃciently small (see the preceding discussion, or the more extensive discussion in
D
R) and of compact support in the
1.2 of [BHS]). We assume that f : U
§
2.2). Integrating the kth Fourier
ﬁrst argument, uniformly with respect to the second (cf. assumption (jjj) in
coeﬃcient fk(x) =
fk(x) = (2πik)−p
expression gives

§
0 f (x, θ) e−2πikθ dθ by parts p times with respect to θ gives
1
R
∂pf /∂θp
0
R
(cid:2)
fkkU ≤

C(f, p)
k
|
DfkkU with C(f, p) replaced by C′(f, p) = 1
k
Using these estimates, we immediately deduce that both of the series in Eq. (4.2) are convergent provided
3, there exists a zone function φ(r) = γr−(τ +1) with
(φ) (for γ suﬃciently small) and which is adapted

that p > τ + 2. Conversely, we see that whenever p
0 < τ < p
to f in the sense of Eq. (4.2). This justiﬁes our assumption (j) in Theorems 2 and 3.

1
0
R
∂p+1f
∂x∂θp (x, θ)
(cid:12)
(cid:12)
(cid:12)

(x, θ)e−2πikθ dθ. Then taking the supremum over x

(2π)p supx∈U
1
0
R

2 which generates nonempty Diophantine sets

−p, where C(f, p) = 1
|

∂pf
∂θp (x, θ)
(cid:12)
(cid:12)
dθ.
(cid:12)

dθ. The same estimate holds

U of both sides of this

(2π)p supx∈U

for

×

≥

−

D

(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)

∈

k

(cid:3)

Remark 4.4 A more reﬁned (and lengthy) argument shows that the existence of φ adapted to f does not require
R)
quite as much smoothness as we demand above; we start our discussion under the assumption f
primarily for simplicity. Of course, when f has a (suﬃciently short) ﬁnite Fourier series, the decay rate of its
terms is not an issue, and the smoothness requirement may be reduced to C1.

Cp+1(U

×

∈

Remark 4.5 Although our results for system (1.4) as presented in this paper do not apply to the case
of analytic perturbations εf (since analytic f with compact support vanishes identically), it would not be
T1
R with Fourier coeﬃcients
especially diﬃcult to extend our theory to this case. For analytic f : U
Γe−β|k|, it would be appropriate to use exponentially decreasing
fk decreasing exponentially as, say,
zone functions, for which the preceding discussion is easily modiﬁed. In fact, given any ρ > 0, the zone function
φ(r) = γe−ρr generates nonempty Diophantine sets
(φ) for small enough γ > 0. The decay rate β of the fk
must of course exceed ρ, which can be arranged provided f is analytic in its second argument with analyticity
parameter α > ρ (this is an instance of the Paley-Wiener Lemma; cf. [PW] or [BHS]). Roughly speaking, the
analyticity parameter α is a measure of the minimum distance by which f may be extended as an analytic
4.3.3 of [DEG] for an elementary discussion in the two-dimensional
function of the complex torus (see also
case).

fkkU ≤

→

×

D

k

§

It is interesting to note that Diophantine conditions corresponding to exponentially decaying zone functions
φ may be strictly weaker than the weakest small-divisor conditions ordinarily used in dynamical systems, the so-
(φ) properly
called Bruno conditions (also spelled Brjuno or Bryuno; here “strictly weaker” means that the set
contains the set of ν subject to Bruno conditions). This is however not surprising, since Bruno conditions apply
to situations (such as conjugacies of circle diﬀeomorphisms, or KAM theory) in which countably many series
with small divisors must simultaneously converge. By contrast, in Lemma 2 we require the convergence of only
two series (in the language of [BHS], ours is a “one-bite” small-divisor problem).

D

The Ultraviolet Cutoﬀ and Truncated Diophantine Conditions

Finally, we introduce the notion of ultraviolet cutoﬀ, which is important in physical applications of Dio-
phantine conditions. To understand why, note that typically in applications, the ν that are required to be
(φ)
Diophantine are physical parameters. But checking whether a given ν belongs to a Cantor set of the form
is a practical impossibility, since each point of
(φ).
(φ) has points arbitrarily close to it that are not in
(φ) requires ν to be speciﬁed with inﬁnite precision. Practically of
In other words, deciding if ν belongs to

D
D

D

D

14

6
Averaging for Maps

course, it is only possible to specify physical parameters with ﬁnite precision. We surmount this diﬃculty by
introducing truncated Diophantine conditions of the form

(cid:12)
(cid:12)

(φ, R) =

D

ν

{

∈

R

e2πikν
|

1

−

| ≥

k
φ(
|

), k
|

∈

Z with 0 <

k
|

| ≤

R

.

}

(4.3)

∈ D

When ν
order or (ultraviolet) cutoﬀ. Note that
which converges to
inequalities.

→ ∞

D

(φ, R), we say ν is Diophantine to order R with respect to φ, and we call R the truncation
(φ) with nonempty interior
(φ, R) is an approximating superset of
(φ, R), one checks only ﬁnitely many

. To decide whether ν belongs to

(φ) as R

D

D

D

As a rough general rule, results in dynamical systems which are established for Diophantine sets

(φ)
D
may also be established (usually in slightly weaker form) for the corresponding larger, nicer sets
(φ, R).
The standard technique for doing so involves removing the “R-tail” of a series before applying Diophantine
conditions, then checking that the tail is small. This technique was called the “ultraviolet cutoﬀ” by Arnold in
his proof of the KAM theorem [Ar], and is illustrated in the proof of Lemma 2 below.

D

4.2.2 Besjes’ inequality generalized to functions far from low-order resonance

×

R, and suppose g : S

Lemma 2. Let S = Rd
Rd satisﬁes assumptions (j), (jj) from Subsection 2.2, along
with assumption (jw) from Subsection 2.3. Let the zone function φ be adapted to g on Rd in the sense of
)
Eq. (4.2), and deﬁne the positive constants C1 = C1(g, φ) and C2 = C2(g, φ) by C1 = 2
|
Rd is a sequence for which the successive
and C2 =
06=k k
diﬀerences xn+1 −

Dgkk
). Let ν
|
xn are bounded by M (i.e., supn |

xn}
{
xn+1 −

∞
n=0 ⊂
xn| ≤

k
Rd/φ(
|

k
Rd/φ(
|

(φ, R). If

M ), then

06=k k

gkk

∈ D

P

P

→

N −1

Xn=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)

g(xn, nν)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

≤

Proof. Since C1 <
that

∞
N −1

C1 + N

C2M +

(cid:16)

gkk

k

Rd

,

(cid:17)

X|k|>R

where

X|k|>R

gkk

k

Rd

→

0

as R

.
→ ∞

N −1

n=0 an(bn+1 −
so that an(bn+1 −
P

N −1

X0<|k|≤R

Xn=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)

, we write g as its uniformly convergent Fourier series g(x, θ) =

06=k∈Z gk(x)e2πikθ , so

N −1

N −1

gk(xn)e2πiknν

+

gk(xn) e2πiknν

.

(4.4)

Xn=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)

g(xn, nν)
(cid:12)
(cid:12)
(cid:12)
(cid:12)

≤ (cid:12)
(cid:12)
(cid:12)
(cid:12)

Xn=0 X0<|k|≤R

(cid:12)
(cid:12)
(cid:12)
(cid:12)

(cid:12)
(cid:12)
(cid:12)
(cid:12)

Xn=0 X|k|>R

We shall treat separately each of the double sums on the right-hand side of inequality (4.4). For the ﬁrst double
sum, we reverse the order of summation and use the “summation by parts” formula

bn) = (aN bN −
−
bn) = gk(xn)e2πiknν . It then follows that

n=0 (an+1 −

a0b0)

P

N −1

an)bn+1 with an = gk(xn) and bn = e2πiknν /(e2πikν

1)

−

P

(cid:12)
(cid:12)
(cid:12)
(cid:12)

gk(xn)e2πiknν

≤ X0<|k|≤R

(cid:12)
(cid:12)
(cid:12)
(cid:12)
Rd
1

(cid:12)
(cid:12)
(cid:12)
(cid:12)
Dgkk
gkk
2
+ k
k
e2πikν
e2πikν
−
−
|
|
|
Rd + N M
Dgkk
)
k
φ(
|
|

gkk

k

k

2

Rd
1

Rd

≤ X0<|k|≤R

(cid:18)

≤ X0<|k|≤R

gk(xN )e2πiN kν

gk(x0)

e2πikν

−
1

−

N −1

−

Xn=0 (cid:0)

gk(xn+1)

−

gk(xn)
(cid:1)

e2πi(n+1)kν
e2πikν

−

1 (cid:12)
(cid:12)
(cid:12)
(cid:12)

N −1

Xn=0

|

xn+1 −
|

xn| (cid:19) ≤ X0<|k|≤R
Dgkk
gkk

Rd + N M
)
k
φ(
|
|

k

2

k

≤ X06=k

Rd

2

gkk

k

Rd + N M
e2πikν
|

−

Dgkk
k
1
|

Rd

= C1 + N M C2 .

(4.5)

We next treat the second double sum (the R-tail) on the right-hand side of inequality (4.4) using the simple
estimate

N −1

(cid:12)
(cid:12)
(cid:12)
(cid:12)

Xn=0 X|k|>R

(cid:12)
(cid:12)
(cid:12)
(cid:12)

gk(xn) e2πiknν

N

≤

X|k|>R

gkk

k

Rd

→

0

as R

.

→ ∞

(4.6)

Inserting estimates (4.5) and (4.6) into inequality (4.4) concludes the proof. //
Remark 4.6 A related analogous result for ﬂows (but without the ultraviolet cutoﬀ) appears as Lemma 13 of
[S´a], and in Theorem 2 of [ES], and a more general Besjes-type inequality for so-called KBM vector ﬁelds also
appears in [S´a] as Lemma 2. A still more closely related result for ﬂows appears as Lemma 2 in our previous
paper [DEG], where it was used in averaging methods applied to certain classes of charged particle motions in
crystals.
Remark 4.7 In the case where g has a ﬁnite Fourier series, the above proof simpliﬁes in obvious ways; but
these simpliﬁcations become problematic as the Fourier series grows in length (note that the example in
3.3
has a Fourier series with only four terms).

§

15

Averaging for Maps

4.2.3 Proof of Theorem 2

Assume the hypotheses of Theorem 2 (cf.

2.2; note that assumption (j) ensures the existence of zone
functions adapted to f , as discussed before Remark 4.4). The proof is essentially the same as the proof of
Theorem 1 with appropriate changes as needed in order to use Lemma 2. As in the previous proof, the solutions
xN and yN clearly exist uniquely for all N

N. For the approximation relation, we write as before

§

∈

N −1

Xn=0

xN −
|

yN | ≤

εL

xn −
|

yn|

+ ε

N −1

f (yn, nν)
(cid:12)
(cid:12)
(cid:12)

e

Xn=0

(cid:12)
(cid:12)
(cid:12)

f (y, θ) := f (y, θ)

f (y) is the oscillating part of f . The hypotheses clearly imply that

where
,
−
∞
and since φ is adapted to f on Rd, the constants C1 and C2 from Lemma 2 are well deﬁned. We may thus
Rd + 1)eLT . Finally, we ﬁx the parameter ζ > 0 and choose Rε > 0 so large that
set C = (C1 + C2T
ζε, where fk(x) is the kth Fourier coeﬃcient of f . It is now a simple matter to check that if
fkk

kS <

≤

Rd

e

k

k

k

f

f

(φ, Rε), then the hypotheses of Lemma 2 are satisﬁed with M := ε

f

kS. We thus have

k

P
ν

|k|>Rε k
∈ D

xN −
|

yN | ≤

ε L

xn −
|

yn|

+ εC1 + εN

C2M +

(cid:16)

fkk

k

Rd

(cid:17)

X|k|>R

N −1

Xn=0

ε L

≤

xn −
|

yn|

N −1

Xn=0

+ εC1 + εN

f

Rd + ζε

,

C2ε
(cid:0)

k

k

(cid:1)

N −1

≤

εL

Xn=0

+ ε

k
| ≤

xn −
|

xN −
|

yN | ≤

T /ε, we have

and so for 0 < N

eLT = Cε for 0 < N

Rd + ζ
f
k
C′ε for 0
(cid:1)
≤

yn|
xN −
|
T /ε) again follows from Lemma 4 (Appendix) and the triangle inequality. //

Gronwall’s inequality for sequences (Lemma 3, Appendix) gives
ε
C1 + C2T
y(n)
xn −
(cid:0)
|
Remark 4.8 It is important to note that for ﬁxed positive ζ and ε, the ultraviolet cutoﬀ Rε need not be
ζ ε, whence the number of inequalities to be checked in Eq. (4.3)
very large to ensure that
(with R = Rε) is also modest. In fact, straightforward estimation shows that when the Fourier coeﬃcients of f
(and
decrease as

C1 + C2T
≤
(cid:0)
T /ε, as claimed. The second part of Theorem 2 (namely

C1 + C2T
(cid:0)
yN | ≤

P
−(p+1) (e.g. when f is of class Cp+1), it is enough to take Rε ≥
k
|
|
Ce−ρ|k|, it is enough to take Rε ≥

fkk
when the coeﬃcients decrease as

. Applying
(cid:1)
Rd + ζ

|k|>Rε k

Rd + ζ

fkk

fkk

eεLN

2C
ρζε

2C
pζε

1 +

1/ρ

1/p

≤

≤

≤

≤

≤

Rd

Rd

Rd

C

).

n

k

k

k

k

k

k

f

f

ε

(cid:1)

(cid:1)

(cid:0)

Remark 4.9 If an O(ε2) term is added to Eq. (1.4) so that it reads xn+1 = xn + εf (xn, nν) + ε2g(xn, nν) ,
Rd satisﬁes the hypotheses of Theorem 2, then it is a simple matter to check that Theorem 2
where g : S
kS)eLT . This form of
continues to hold with the order constant C replaced by C′ = (C1 + C2T
Theorem 2 is often useful in applications.

Rd + ζ +

→

k

k

k

f

g

1 + ln
(cid:0)

(cid:1)

4.2.4 Proof of Theorem 3

Assume the hypotheses of Theorem 3 (these include those of Theorem 2 together with the additional zero-
, and since φ is adapted to
mean assumption (jw); cf.
§
f on Rd, the constants C1 and C2 from the conclusion of Lemma 2 are well deﬁned. We may thus choose
kS + ζ. Finally, we choose Rε > 0 so large that
the parameter ζ > 0 and set K1 = C1 and K2 = C2k
(φ, Rε), the hypotheses of
≤
Lemma 2 are satisﬁed with M := ε
P

It is now a simple matter to check that whenever ν

2.3). The hypotheses clearly imply that

kS <

|k|>Rε k

fkk

∈ D

ζ ε.

∞

Rd

k

f

f

f

kS, from which we conclude that

k

xN −
|

x0|

N −1

= ε

Xn=0

(cid:12)
(cid:12)
(cid:12)
(cid:12)
ε C1 + εN

≤

≤

f (xn, nν)
(cid:12)
(cid:12)
(cid:12)
(cid:12)
kS + ζε

C2ε
(cid:0)

k

f

≤

(cid:1)

εC1 + εN

C2M +

(cid:16)

fkk

k

Rd

(cid:17)

X|k|>Rε

K1ε + K2ε2N. //

Remark 4.10 The proof of Theorem 3 is so short, and its hypotheses are so closely related to those of Lemma
2, that it is nearly a corollary of Lemma 2. The interesting features of Theorem 3 are that long-time invariance
is shown without the traditional transformation of variables, while ν is required to be Diophantine only to low
order Rε.

16

Averaging for Maps

4.3 Proofs of Propositions A, B, and C

For the statements of Propositions A, B, and C, see Subsection 2.4.

4.3.1 Proof of Proposition A

The zone functions enter the proofs of Theorems 2 and 3 only through Lemma 2. It is clear that if φ is
replaced by ελφ in Eq. (4.5), then the ﬁnal estimate of Lemma 2 is changed to ε−λ(C1+N M C2). The error bound
in Theorem 2 then changes to
yN | ≤
T /ε, while
K1ε1−λ + K2ε2−λN .
the error bound in Theorem 3 changes to
//

ε1−λ(C1 +C2T
x0| ≤
xN −
|

Rd)eLT +εζeLT = O(ε1−λ) for 0

k
ε1−λC1 + εN

kS + ζε

xN −
|

C2ε1−λ
(cid:0)

N

≤

≤

≤

k

k

f

f

(cid:1)

4.3.2 Proof of Proposition B

Theorems 2 and 3 are nearly the same.

Here we give the proof of Proposition B as it applies to Theorem 1 only; the proofs of its applicability to

Fix ε > 0, let U

Rd be open, take S′ = U

N, and suppose g : S′

have compact support in U (in other words, g satisﬁes assumptions (i) and (ii) of
but does not satisfy assumption (iii)).

§

⊂

×

→

Rd, where g is not assumed to
2.1, with S′ in place of S,

We now use g to deﬁne the systems (1′), (2′), and (3′), which are simply the previous systems (1.1), (1.2),
and (1.3), respectively, in which the perturbation εf has been replaced by εg. We assume that the common
initial condition x0 = y0 = y(0) is ﬁxed in U , and we choose the positive timescale parameter T < β(x0), where
[0, β(x0)) is the maximal forward interval of existence for the initial value problem

dˇy
dt′ =

g(ˇy) ,

b

ˇy(0) = x0 ∈

U,

(3′′)

|

z

}

{

T

∈

t′

U

≤

≤

z = ˇy(t′), 0

which is simply the scaled, ε-independent version of system (3′) obtained by introducing the “slow time” t′ = εt.
denote the solution curve of system (3′′) over [0, T ], and we
We then let Z =
choose δ > 0 such that δ < dist(Z, ∂U ). Then the closure D(δ) of the open “δ-tube” D(δ) around Z formed
by the union of open balls of radius δ having centers in Z is contained in U ; i.e., D(δ) :=
U, where Bδ(y) denotes the open ball of radius δ centered on y in Rd.
D(δ)

Rd which (a) coincides with g on D(δ)

⊂
function f : Rd
denotes “complement”), and (c) interpolates g on Br(x0)
class as g and such that
Rd×N =
extension theorem” as given, for example, on p. 380 of [AMR].

We next choose r > 0 so that the open ball Br(x0) contains D(δ), and we deﬁne the compactly supported
N (here c
(b) vanishes on Br(x0)c
D(δ)c in such a way that f is of the same smoothness
kD(δ)×N. The existence of such f is guaranteed by the “smooth Tietze
T of the solution ˇy(t′) of (3′′),
t′
T /ε for the solution y(t) = ˇy(εt) of (3′)), we apply Theorem 1

Using this f , and the constant T (from the existence interval 0

corresponding to the existence interval 0
t
and Lemma 4 from the Appendix to conclude that, for appropriate C1, C2 > 0, we have:

y(t)
(cid:1)
(cid:0)

t∈[0,T ] Bδ

N,

→

N

S

×

≤

≤

×

≤

≤

×

⊂

∩

k

k

k

f

g

xn −
|

yn| ≤

C1 ε

for

0

n

≤

and xn ∈

D(δ) ;

and

T /ε ,

D(δ/2) ,

≤
for

yn ∈
n

0

yn −
|

ˇy(εn)

C2 ε

T /ε and yn ∈

D(δ/2) .

≤

| ≤

D(δ) are ensured for 0

D(δ/2) and xn ∈
n
≤

≤
Using these inequalities together with the triangle inequality, if we now impose a smallness condition on ε by
requiring it to be strictly less than the threshold ε0 := min
, we ﬁnd that the conditions
δ/(2C1), δ/(2C2)
}
(C1 + C2)ε < δ also
yn ∈
xn −
≤
|
≤
holds for 0
T /ε, and since f and
T /ε. Finally, since xn, yn, and y(n) = ˇy(εn) remain in D(δ) for 0
ε < ε0, the dynamics of systems (1′), (2′), and (3′) coincide with
g coincide on D(δ), we see that whenever 0
T /ε, which completes the
the dynamics of the respective systems (1.1), (1.2), and (1.3) on the interval 0
proof. //
Remark 4.11 In the above proof, the order constants C1, C2 and the threshold ε0 depend on δ. We note
that, since the motions of systems (1.1), (1.2), and (1.3) remain in the δ-tube D(δ), the uniform norms which
appear in the proofs of Theorem 1, 2, and 3 may be taken over D(δ) rather than all of Rd.

T /ε, and it follows that

ˇy(εn)
n

| ≤
≤

≤

≤

≤

≤

≤

n

n

{

17

Averaging for Maps

4.3.3 Proof of Proposition C

Let g(u, n) := (f (x, nq/p + τ ), a)T where u := (x, τ )T, so that g : U

Rd+1. The system
un+1 = un + εg(un, n) clearly satisﬁes the hypotheses of Proposition B applied to Theorem 1, with d replaced
R. Thus the conclusion of Theorem 1 applies to un as well as to xn. The constants
by d+1 and U replaced by U
c and c′ may be easily estimated along the lines of the proofs of Theorem 1 and Lemma 4 respectively. Taking
kD eLgT . Here
g
kD +
into account Remark 4.11, we ﬁnd c(T,
LgT
g
kD and
Lg is the u-Lipschitz constant of g, which is independent of a. On the other hand, the norms
(cid:0)
kD×N
k
b
b
2 + a2.
f (x, nq/p + τ )
e
b
|

) = T Lgk
|
g
k

2 + a2 and
f (v)
|

eLgT and c′(T,
kD×N
(cid:1)
e
kD×N = supv∈D,n∈N
e

kD = supv∈D q|
b

depend on
//

, since
|

) =
|

f (v)

q|

a
|

a
|

a
|

→

N

R

×

×

−

×

b

b

k

k

k

k

g

g

g

g

Appendix.

In this appendix, for the sake of completeness we supply statements and proofs of two elementary results with
which the reader may be unfamiliar.

Lemma 3 (The Gronwall inequality for sequences). Let A

0, B

0, and

≥

≥
{
En + B. Then EN ≤

N −1

Xn=0

BeAN .

∞
n=0 be a sequence of

En}

nonnegative real numbers with E0 = 0 satisfying EN ≤

A

N −1

Proof. Set RN −1 = A
inductively, we ﬁnd that RN ≤
P
(1 + x)1/x
R0 = B and x > 0
Lemma 4 (Equivalence of autonomous ﬂows and maps). Let ε > 0, and suppose f : Rd
Lipschitz continuous and has compact support. Then

n=0 En + B so that RN −
. . .
(1 + A)RN −1 ≤
e. //
≤

ARN −1 ⇒
(1 + A)N R0 = B(1 + A)N

RN −1 = AEN ≤
≤

RN ≤
≤

⇒

(1+A)RN −1. Proceeding
BeAN , where we have used

Rd is

→

the map

yn+1 = yn + εf (yn)

(1.5)

and the ﬂow

= εf (y)

(1.6)

dy
dt

are equivalent in the sense that there exists a constant K > 0 such that the solutions yn and y(t) of (1.5) and
(1.6), respectively, with common initial condition y0 = y(0)
Kε for 0

Rd satisfy the nearness condition

yn −
|

T /ε.

y(n)

| ≤

∈

n

≤

≤

Let L > 0 denote the global Lipschitz constant of f . First we note that y(n + 1)

f (y(t)) dt = εf (y(n)) + ε

Proof.
n+1
n+1
ε
n
n
n+1
R
R
f (y(n))
ε
f (y(t))
f (y(n))
n
−
n+1
(cid:1)
R
(cid:1)
(cid:0)
f (y(t))
dt
εL
since ε
n
| ≤
(cid:0)
R
E0 ≤
telescoping sum, we arrive to En −
n
E0 = 0 and 0
≤
≤
Rd eεLn
f
En ≤

εT L

εT L

−

≤

k

k

k

k

f

(cid:0)

|

−

f (y(t))

−
Rd,
Rd. Using this last inequality to form a
n−1
k=0 Ek + εT L
Rd (since
T /ε). Finally, we apply the Gronwall inequality for sequences (Lemma 3, above) to get

dt. Thus yn+1 −
f (y(n))
−
(cid:1)
y(n)
dt. Now setting En =
, we obtain En+1 ≤
yn −
|
|
ε2L
dt
y(n)
y(t)
f
≤
|
k
|
−
k
n−1
k=0 Ek + nε2L
Rd, or En ≤
f
k
k

y(n + 1) = yn −

f (y(n))
(cid:1)

n+1
n
R
εL

εL

k

k

k

f

P

P

y(n) =
f (yn)
(cid:0)
En +εLEn+ε2L
f

−
y(n) + ε

Rd eLT , so the desired conclusion is true with K = T L

k
Rd eLT . //

f

k

k

Acknowledgments. HSD thanks F. Golse and L. Michelotti for stimulating discussions, and acknowledges
the support of the C.P. Taft Foundation at the University of Cincinnati. JAE and MV gratefully acknowledge
discussions with L. Michelotti and T. Sen, as well as support from DOE grant DE-FG03-99ER41104.

References

[AMR] R. Abraham, J. Marsden, and T. Ratiu, Manifolds, Tensor Analysis, and Applications (2nd Ed.),

Springer-Verlag, New York, 1988.

[ABG] M. Andreolli, D. Bambusi, and A. Giorgilli, On a weakened form of the averaging principle in multi-

frequency systems, Nonlinearity 8 (2): 283–293 (1995).

[Ar] V.I. Arnold, Proof of A.N. Kolmogorov’s theorem on the preservation of quasi-periodic motions under
small perturbations of the Hamiltonian [Russian], Usp. Mat. Nauk. SSSR 18 (5): 13–40 (1963) [English
translation: Russian Math. Surveys 18 (5): 9–36 (1963)].

[BGSTT] A. Bazzani, M. Giovannozzi, G. Servizi, G. Turchetti, E. Todesco, Resonant normal forms and stability

analysis for area preserving maps, Physica D 64, 66 (1993).

18

Averaging for Maps

[Bel] E.P. Belan, On the averaging method in the theory of ﬁnite diﬀerence equations [Russian], Ukrain.

[Bes] J. Besjes, On the asymptotic methods for non-linear diﬀerential equations, J. M´ecanique 8: 357–372

Mat. Z. 19, no. 3: 85–90 (1967).

(1969).

[BM] N.N. Bogoliubov and Y.A. Mitropolsky, Asymptotic Methods in the Theory of Non-Linear Oscillations
(2nd Ed.) [translated from Russian], Gordon and Breach Science Publishers, New York, 1961.

[BHS] H.W. Broer, G.B. Huitema, and M.B. Sevryuk, Quasiperiodic Motions in Families of Dynamical Sys-

tems, Lecture Notes in Mathematics, Vol. 1645, Springer-Verlag, New York, 1996.

[Br] A. Browder, Mathematical Analysis, Springer-Verlag, New York, 1996.

[CBW] A.W. Chao, P. Bambade and W.T. Weng, Nonlinear Beam-Beam Resonances, in Lecture Notes in

Physics 247, 77–103, Springer-Verlag, New York, 1986.

[Dr] V.A. Dragan, Method of averaging for systems of sum-diﬀerence equations [Russian], Mat. Issled.
(Computational Methods of Mechanics), No. 64: 172–181, 195–196 (1981); Methods of averaging and
freezing of systems of ﬁnite diﬀerence equations of two variables [Russian], Mat. Issled., No. 64: 182–
188, 196–197 (1981).

[DEG] H.S. Dumas, J.A. Ellison, and F. Golse, A mathematical theory of planar particle channeling in crystals,

Physica D 146 (1–4): 341–366 (2000).

[DESV] H.S. Dumas, J.A. Ellison, T. Sen, and M. Vogt, work in preparation.

[DEV] H.S. Dumas, J.A. Ellison, and M. Vogt, presentation at 2002 Spring Meeting of APS, in Albuquerque,

NM; see http://www.math.unm.edu/~ellison/papers/APS02 MAP.ps.gz

[ES] J.A. Ellison and H.-J. Shi, The method of averaging in beam dynamics, in Accelerator Physics Lectures
at the Superconducting Super Collider (AIP Conf. Procs. 326, Y. Yan and M. Syphers, Eds.): 590–632
(1995).

[Fo] ´E. Forest, Beam Dynamics: A New Attitude and Framework, Harwood Academic Publishers, Amster-

dam, 1998.

[K¨o] T.W. K¨orner, Fourier Analysis, Cambridge University Press, Cambridge, 1988.

[Ne] A. Neishtadt (private communication w/HSD), June, 2000.

[PW] R.E.A.C. Paley and N. Wiener, Fourier Transforms in the Complex Domain, AMS Colloquium Pub-

lications, Vol. 19, New York, 1934.

[Ru] R.D. Ruth, Single Particle Dynamics and Nonlinear Resonances in Circular Accelerators, in Lecture

Notes in Physics 247, 37–63, Springer-Verlag, New York, 1986.

[R¨u] H. R¨ußmann, On optimal estimates for the solutions of linear partial diﬀerential equations of ﬁrst order
with constant coeﬃcients on the torus, in Lecture Notes in Physics 38, 598–624, Springer-Verlag, New
York, 1975; On the frequencies of quasi periodic solutions of analytic integrable Hamiltonian systems,
in Seminar on Dynamical Systems (Proceedings of the Euler International Mathematical Institute, St.
Petersburg, 1991; V. Lazutkin et al., Eds.), 160–183, Birkh¨auser, Berlin, 1994.

[S´a] A.W. S´aenz, Higher order averaging for nonperiodic systems, J. Math. Phys. 41: 5342–5368 (2000).

[Yo] J.-C. Yoccoz, An introduction to small divisors problems, in From Number Theory to Physics (Les

Houches, 1989), 659–679, Springer-Verlag, Berlin, 1992.

19

